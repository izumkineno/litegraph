var bt=Object.defineProperty,pt=a=>{throw TypeError(a)},yt=(a,t,s)=>t in a?bt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,m=(a,t,s)=>yt(a,typeof t!="symbol"?t+"":t,s),Lt=(a,t,s)=>t.has(a)||pt("Cannot "+s),ct=(a,t,s)=>t.has(a)?pt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,s),st=(a,t,s)=>(Lt(a,t,"access private method"),s);class LLink{constructor(t,s,n,o,l,p){this.id=t,this.type=s,this.origin_id=n,this.origin_slot=o,this.target_id=l,this.target_slot=p,this._data=null,this._pos=new Float32Array(2)}configure(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}}const J=class Ot{constructor(t){var s;(s=LiteGraph.log)==null||s.call(LiteGraph,"Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}getSupportedTypes(){var t;return(t=this.supported_types)!=null?t:Ot.supported_types}clear(){var t;this.stop(),this.status=Ot.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,(t=this._nodes)==null||t.forEach(s=>{var n;(n=s.onRemoved)==null||n.call(s)}),this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.configApplyDefaults(),this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.history={actionHistory:[],actionHistoryVersions:[],actionHistoryPtr:0},this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[],this._configuring=!1,this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")}configApply(t){this.config=Object.assign(this.config,t)}configApplyDefaults(){var t=LiteGraph.graphDefaultConfig;this.configApply(t)}attachCanvas(t){var s;if(!t instanceof LiteGraph.LGraphCanvas)throw new Error("attachCanvas expects a LiteGraph.LGraphCanvas instance");t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,(s=this.list_of_graphcanvas)!=null||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)}detachCanvas(t){if(this.list_of_graphcanvas){var s=this.list_of_graphcanvas.indexOf(t);s!=-1&&(t.graph=null,this.list_of_graphcanvas.splice(s,1))}}start(t=0){var s;if(this.status===Ot.STATUS_RUNNING)return;this.status=Ot.STATUS_RUNNING,(s=this.onPlayEvent)==null||s.call(this),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime;const n=()=>{var o,l;this.execution_timer_id===-1&&(window.requestAnimationFrame(n),(o=this.onBeforeStep)==null||o.call(this),this.runStep(1,!this.catch_errors),(l=this.onAfterStep)==null||l.call(this))};t===0&&typeof window=="object"&&window.requestAnimationFrame?(this.execution_timer_id=-1,n()):this.execution_timer_id=setInterval(()=>{var o,l;(o=this.onBeforeStep)==null||o.call(this),this.runStep(1,!this.catch_errors),(l=this.onAfterStep)==null||l.call(this)},t)}stop(){var t;this.status!=Ot.STATUS_STOPPED&&(this.status=Ot.STATUS_STOPPED,(t=this.onStopEvent)==null||t.call(this),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))}runStep(t=1,s,n){var o,l,p,h,u,c,d=LiteGraph.getTime();this.globaltime=.001*(d-this.starttime);var f=(o=this._nodes_executable)!=null?o:this._nodes;if(f){if(n||(n=f.length),s){for(let g=0;g<t;g++)f.forEach(L=>{var G,T;LiteGraph.use_deferred_actions&&(G=L._waiting_actions)!=null&&G.length&&L.executePendingActions(),L.mode===LiteGraph.ALWAYS&&((T=L.doExecute)==null||T.call(L))}),this.fixedtime+=this.fixedtime_lapse,(l=this.onExecuteStep)==null||l.call(this);(p=this.onAfterExecute)==null||p.call(this)}else try{for(let g=0;g<t;g++)f.forEach(L=>{var G,T;LiteGraph.use_deferred_actions&&(G=L._waiting_actions)!=null&&G.length&&L.executePendingActions(),L.mode===LiteGraph.ALWAYS&&((T=L.doExecute)==null||T.call(L))}),this.fixedtime+=this.fixedtime_lapse,(h=this.onExecuteStep)==null||h.call(this);(u=this.onAfterExecute)==null||u.call(this),this.errors_in_execution=!1}catch(g){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw g;(c=LiteGraph.log)==null||c.call(LiteGraph,`Error during execution: ${g}`),this.stop()}var b=LiteGraph.getTime(),_=b-d;_==0&&(_=1),this.execution_time=.001*_,this.globaltime+=.001*_,this.iteration+=1,this.elapsed_time=(b-this.last_update_time)*.001,this.last_update_time=b,this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[]}}updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])}computeExecutionOrder(t,s){var n,o=[],l=[],p={},h={},u={};for(let g=0,L=this._nodes.length;g<L;++g){let G=this._nodes[g];if(!(t&&!G.onExecute)){p[G.id]=G;var c=0;if(G.inputs)for(var d=0,f=G.inputs.length;d<f;d++)G.inputs[d]&&G.inputs[d].link!=null&&(c+=1);c==0?(l.push(G),s&&(G._level=1)):(s&&(G._level=0),u[G.id]=c)}}for(;l.length!=0;){var b=l.shift();if(o.push(b),delete p[b.id],!!b.outputs)for(let g=0;g<b.outputs.length;g++){let L=b.outputs[g];if(!(L==null||L.links==null||L.links.length==0))for(let G=0;G<L.links.length;G++){let T=L.links[G],E=this.links[T];if(!E||h[E.id])continue;let C=this.getNodeById(E.target_id);if(C==null){h[E.id]=!0;continue}s&&(!C._level||C._level<=b._level)&&(C._level=b._level+1),h[E.id]=!0,u[C.id]-=1,u[C.id]==0&&l.push(C)}}}for(let g in p)o.push(p[g]);o.length!=this._nodes.length&&LiteGraph.debug&&((n=LiteGraph.warn)==null||n.call(LiteGraph,"something went wrong, nodes missing"));var _=o.length;for(let g=0;g<_;++g)o[g].order=g;o=o.sort((g,L)=>{let G=g.constructor.priority||g.priority||0,T=L.constructor.priority||L.priority||0;return G==T?g.order-L.order:G-T});for(let g=0;g<_;++g)o[g].order=g;return o}getAncestors(t,s={}){for(var n={modesSkip:[],modesOnly:[],typesSkip:[],typesOnly:[]},o=Object.assign(n,s),l=[],p=[],h=[t],u={};h.length;){var c=h.shift();if(c&&!u[c.id]){if(u[c.id]=!0,c.id!=t.id){if(o.modesSkip&&o.modesSkip.length&&o.modesSkip.indexOf(c.mode)!=-1||o.modesOnly&&o.modesOnly.length&&o.modesOnly.indexOf(c.mode)==-1)continue;p.indexOf(c.id)==-1&&(l.push(c),p.push(c.id))}if(c.inputs)for(var d=0;d<c.inputs.length;++d){var f=c.getInputNode(d);if(f){var b=c.inputs[d].type;o.typesSkip&&o.typesSkip.length&&o.typesSkip.indexOf(b)!=-1||o.typesOnly&&o.typesOnly.length&&o.typesOnly.indexOf(f.mode)==-1||p.indexOf(f.id)==-1&&(u[f.id]||h.push(f))}}}}return l.sort((_,g)=>_.order-g.order),l}arrange(t=100,s){var n;const o=this.computeExecutionOrder(!1,!0),l=[];for(let h=0;h<o.length;++h){const u=o[h],c=u._level||1;(n=l[c])!=null||(l[c]=[]),l[c].push(u)}let p=t;for(let h=0;h<l.length;++h){const u=l[h];if(!u)continue;let c=100,d=t+LiteGraph.NODE_TITLE_HEIGHT;for(let f=0;f<u.length;++f){const b=u[f];b.pos[0]=s==LiteGraph.VERTICAL_LAYOUT?d:p,b.pos[1]=s==LiteGraph.VERTICAL_LAYOUT?p:d;const _=s==LiteGraph.VERTICAL_LAYOUT?1:0;b.size[_]>c&&(c=b.size[_]);const g=s==LiteGraph.VERTICAL_LAYOUT?0:1;d+=b.size[g]+t+LiteGraph.NODE_TITLE_HEIGHT}p+=c+t}this.setDirtyCanvas(!0,!0)}getTime(){return this.globaltime}getFixedTime(){return this.fixedtime}getElapsedTime(){return this.elapsed_time}sendEventToAllNodes(t,s,n=LiteGraph.ALWAYS){var o=this._nodes_in_order?this._nodes_in_order:this._nodes;if(o)for(let l=0,p=o.length;l<p;++l){const h=o[l];if(h.constructor===LiteGraph.Subgraph&&t!=="onExecute"){h.mode==n&&h.sendEventToAllNodes(t,s,n);continue}!h[t]||h.mode!==n||(s===void 0?h[t]():Array.isArray(s)?h[t].apply(h,s):h[t](s))}}sendActionToCanvas(t,s){if(this.list_of_graphcanvas)for(const n of this.list_of_graphcanvas)n[t]&&s&&n[t](...s)}add(t,s,n={}){var o,l,p,h={doProcessChange:!0,doCalcSize:!0},u=Object.assign(h,n);if(t){if(t.constructor===LiteGraph.LGraphGroup){this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,this.onGraphChanged({action:"groupAdd",doSave:u.doProcessChange});return}if(t.id!=-1&&this._nodes_by_id[t.id]!=null&&((o=LiteGraph.warn)==null||o.call(LiteGraph,"LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?t.id=LiteGraph.uuidv4():t.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw new Error("LiteGraph: max number of nodes in a graph reached");return LiteGraph.use_uuids?(t.id==null||t.id==-1)&&(t.id=LiteGraph.uuidv4()):t.id==null||t.id==-1?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this.onGraphChanged({action:"nodeAdd",doSave:u.doProcessChange}),this._nodes.push(t),this._nodes_by_id[t.id]=t,(l=t.onAdded)==null||l.call(t,this),this.config.align_to_grid&&t.alignToGrid(),s||this.updateExecutionOrder(),(p=this.onNodeAdded)==null||p.call(this,t),u.doCalcSize&&t.setSize(t.computeSize()),this.setDirtyCanvas(!0),this.change(),t}}remove(t){var s,n;if(t.constructor===LiteGraph.LGraphGroup){var o=this._groups.indexOf(t);o!=-1&&this._groups.splice(o,1),t.graph=null,this.onGraphChanged({action:"groupRemove"}),this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[t.id]!=null&&!t.ignore_remove){if(t.inputs)for(let p=0;p<t.inputs.length;p++)t.inputs[p].link!=null&&t.disconnectInput(p,{doProcessChange:!1});if(t.outputs)for(let p=0;p<t.outputs.length;p++){let h=t.outputs[p];h.links!=null&&h.links.length&&t.disconnectOutput(p,!1,{doProcessChange:!1})}if((s=t.onRemoved)==null||s.call(t),t.graph=null,this.onGraphChanged({action:"nodeRemove"}),this.list_of_graphcanvas)for(let p=0;p<this.list_of_graphcanvas.length;++p){let h=this.list_of_graphcanvas[p];h.selected_nodes[t.id]&&delete h.selected_nodes[t.id],h.node_dragged==t&&(h.node_dragged=null)}var l=this._nodes.indexOf(t);l!=-1&&this._nodes.splice(l,1),delete this._nodes_by_id[t.id],(n=this.onNodeRemoved)==null||n.call(this,t),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}}getNodeById(t){return t==null?null:this._nodes_by_id[t]}findNodesByClass(t,s=[]){return s=this._nodes.filter(n=>n.constructor===t),s}findNodesByType(t,s=[]){const n=t.toLowerCase();return s=this._nodes.filter(o=>o.type.toLowerCase()===n),s}findNodeByTitle(t){var s;return(s=this._nodes.find(n=>n.title===t))!=null?s:null}findNodesByTitle(t){return this._nodes.filter(s=>s.title===t)}getNodeOnPos(t,s,n=this._nodes,o=0){var l;return(l=n.reverse().find(p=>p.isPointInside(t,s,o)))!=null?l:null}getGroupOnPos(t,s){var n;return(n=this._groups.find(o=>o.isPointInside(t,s,2,!0)))!=null?n:null}checkNodeTypes(){for(var t,s=0;s<this._nodes.length;s++){var n=this._nodes[s],o=LiteGraph.registered_node_types[n.type];if(n.constructor!=o){LiteGraph.debug&&((t=LiteGraph.log)==null||t.call(LiteGraph,`node being replaced by newer version: ${n.type}`));var l=LiteGraph.createNode(n.type);this._nodes[s]=l,l.configure(n.serialize()),l.graph=this,this._nodes_by_id[l.id]=l,n.inputs&&(l.inputs=n.inputs.concat()),n.outputs&&(l.outputs=n.outputs.concat())}}this.updateExecutionOrder()}onAction(t,s,n){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var o=0;o<this._input_nodes.length;++o){var l=this._input_nodes[o];if(l.properties.name==t){l.actionDo(t,s,n);break}}}trigger(t,s){var n;(n=this.onTrigger)==null||n.call(this,t,s)}addInput(t,s,n){var o,l,p=this.inputs[t];p||(this.beforeChange(),this.inputs[t]={name:t,type:s,value:n},this.onGraphChanged({action:"addInput"}),this.afterChange(),(o=this.onInputAdded)==null||o.call(this,t,s),(l=this.onInputsOutputsChange)==null||l.call(this))}setInputData(t,s){var n=this.inputs[t];n&&(n.value=s)}getInputData(t){var s=this.inputs[t];return s?s.value:null}renameInput(t,s){var n,o,l;if(s!=t){if(!this.inputs[t])return!1;if(this.inputs[s])return(n=LiteGraph.error)==null||n.call(LiteGraph,"there is already one input with that name"),!1;this.inputs[s]=this.inputs[t],delete this.inputs[t],this.onGraphChanged({action:"renameInput"}),(o=this.onInputRenamed)==null||o.call(this,t,s),(l=this.onInputsOutputsChange)==null||l.call(this)}}changeInputType(t,s){var n;if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(s).toLowerCase()||(this.inputs[t].type=s,this.onGraphChanged({action:"changeInputType"}),(n=this.onInputTypeChanged)==null||n.call(this,t,s))}removeInput(t){var s,n;return this.inputs[t]?(delete this.inputs[t],this.onGraphChanged({action:"graphRemoveInput"}),(s=this.onInputRemoved)==null||s.call(this,t),(n=this.onInputsOutputsChange)==null||n.call(this),!0):!1}addOutput(t,s,n){var o,l;this.outputs[t]={name:t,type:s,value:n},this.onGraphChanged({action:"addOutput"}),(o=this.onOutputAdded)==null||o.call(this,t,s),(l=this.onInputsOutputsChange)==null||l.call(this)}setOutputData(t,s){var n=this.outputs[t];n&&(n.value=s)}getOutputData(t){var s=this.outputs[t];return s?s.value:null}renameOutput(t,s){var n,o,l;if(!this.outputs[t])return!1;if(this.outputs[s])return(n=LiteGraph.error)==null||n.call(LiteGraph,"there is already one output with that name"),!1;this.outputs[s]=this.outputs[t],delete this.outputs[t],this._version++,(o=this.onOutputRenamed)==null||o.call(this,t,s),(l=this.onInputsOutputsChange)==null||l.call(this)}changeOutputType(t,s){var n;if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(s).toLowerCase()||(this.outputs[t].type=s,this.onGraphChanged({action:"changeOutputType"}),(n=this.onOutputTypeChanged)==null||n.call(this,t,s))}removeOutput(t){var s,n;return this.outputs[t]?(delete this.outputs[t],this.onGraphChanged({action:"removeOutput"}),(s=this.onOutputRemoved)==null||s.call(this,t),(n=this.onInputsOutputsChange)==null||n.call(this),!0):!1}triggerInput(t,s){for(var n=this.findNodesByTitle(t),o=0;o<n.length;++o)n[o].onTrigger(s)}setCallback(t,s){for(var n=this.findNodesByTitle(t),o=0;o<n.length;++o)n[o].setTrigger(s)}beforeChange(t){var s;(s=this.onBeforeChange)==null||s.call(this,this,t),this.sendActionToCanvas("onBeforeChange",this)}afterChange(t){var s;(s=this.onAfterChange)==null||s.call(this,this,t),this.sendActionToCanvas("onAfterChange",this)}connectionChange(t){var s;this.updateExecutionOrder(),(s=this.onConnectionChange)==null||s.call(this,t),this.onGraphChanged({action:"connectionChange",doSave:!1}),this.sendActionToCanvas("onConnectionChange")}isLive(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){var s=this.list_of_graphcanvas[t];if(s.live_mode)return!0}return!1}clearTriggeredSlots(){for(var t in this.links){var s=this.links[t];s&&s._last_time&&(s._last_time=0)}}change(){var t,s;(t=LiteGraph.log)==null||t.call(LiteGraph,"Graph visually changed"),this.sendActionToCanvas("setDirty",[!0,!0]),(s=this.on_change)==null||s.call(this,this)}setDirtyCanvas(t,s){this.sendActionToCanvas("setDirty",[t,s])}removeLink(t){var s=this.links[t];if(s){var n=this.getNodeById(s.target_id);n&&(this.beforeChange(),n.disconnectInput(s.target_slot),this.afterChange())}}serialize(){var t,s;const n=this._nodes.map(f=>f.serialize());var o=[];for(var l in this.links){var p=this.links[l];if(!p.serialize){(t=LiteGraph.warn)==null||t.call(LiteGraph,"weird LLink bug, link info is not a LLink but a regular object");var h=new LiteGraph.LLink;for(var u in p)h[u]=p[u];this.links[l]=h,p=h}o.push(p.serialize())}const c=this._groups.map(f=>f.serialize());var d={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:n,links:o,groups:c,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return(s=this.onSerialize)==null||s.call(this,d),d}configure(t,s){var n,o,l,p,h;if(t){s||this.clear();var u=t.nodes;if(t.links&&t.links.constructor===Array){for(var c=[],d=0;d<t.links.length;++d){var f=t.links[d];if(!f){(n=LiteGraph.warn)==null||n.call(LiteGraph,"serialized graph link data contains errors, skipping.");continue}var b=new LiteGraph.LLink;b.configure(f),c[b.id]=b}t.links=c}for(let G in t)["nodes","groups"].includes(G)||(this[G]=t[G]);var _=!1;this._configuring=!0;try{if(this._nodes=[],u){for(let G=0,T=u.length;G<T;++G){var g=u[G],L=LiteGraph.createNode(g.type,g.title);L||((o=LiteGraph.log)==null||o.call(LiteGraph,`Node not found or has errors: ${g.type}`),L=new LiteGraph.LGraphNode,L.last_serialization=g,L.has_errors=!0,_=!0),L.id=g.id,this.add(L,!0,{doProcessChange:!1})}u.forEach(G=>{const T=this.getNodeById(G.id);T==null||T.configure(G)})}this._groups.length=0,t.groups&&t.groups.forEach(G=>{const T=new LiteGraph.LGraphGroup;T.configure(G),this.add(T,!0,{doProcessChange:!1})})}finally{this._configuring=!1}return this.updateExecutionOrder(),this.extra=(l=t.extra)!=null?l:{},(p=this.onConfigure)==null||p.call(this,t),t._version?(h=LiteGraph.debug)==null||h.call(LiteGraph,"skip onGraphChanged when configure passing version too!"):this.onGraphChanged({action:"graphConfigure",doSave:!1}),this.setDirtyCanvas(!0,!0),_}}load(t,s){var n=this;if(t.constructor===File||t.constructor===Blob){var o=new FileReader;o.addEventListener("load",p=>{var h=JSON.parse(p.target.result);n.configure(h),s==null||s()}),o.readAsText(t);return}var l=new XMLHttpRequest;l.open("GET",t,!0),l.send(null),l.onload=p=>{var h;if(l.status!==200){(h=LiteGraph.error)==null||h.call(LiteGraph,"Error loading graph:",l.status,l.response);return}var u=JSON.parse(l.response);n.configure(u),s==null||s()},l.onerror=p=>{var h;(h=LiteGraph.error)==null||h.call(LiteGraph,"Error loading graph:",p)}}onGraphSaved(t={}){var s={};Object.assign(s,t),this.savedVersion=this._version}onGraphLoaded(t={}){var s={};Object.assign(s,t),this.savedVersion=this._version}onGraphChanged(t={}){var s,n,o,l,p,h,u={action:"",doSave:!0,doSaveGraph:!0},c=Object.assign(u,t);if(!(this._configuring&&c.action!=="graphConfigure")&&(this._version++,c.action?(s=LiteGraph.debug)==null||s.call(LiteGraph,"Graph change",c.action):(n=LiteGraph.debug)==null||n.call(LiteGraph,"Graph change, no action",c),c.doSave&&LiteGraph.actionHistory_enabled)){(o=LiteGraph.debug)==null||o.call(LiteGraph,"onGraphChanged SAVE :: "+c.action);var d={actionName:c.action};c.doSaveGraph&&(d=Object.assign(d,{graphSave:this.serialize()}));for(var f=this.history;f.actionHistoryPtr<f.actionHistoryVersions.length-1;)(l=LiteGraph.debug)==null||l.call(LiteGraph,"popping: gone back? "+(f.actionHistoryPtr+" < "+(f.actionHistoryVersions.length-1))),f.actionHistoryVersions.pop();if(f.actionHistoryVersions.length>=LiteGraph.actionHistoryMaxSave){var b=f.actionHistoryVersions.shift();(p=LiteGraph.debug)==null||p.call(LiteGraph,"maximum saves reached: "+f.actionHistoryVersions.length+", remove older: "+b),f.actionHistory[b]=!1}f.actionHistoryPtr=f.actionHistoryVersions.length,f.actionHistoryVersions.push(f.actionHistoryPtr),f.actionHistory[f.actionHistoryPtr]=d,(h=LiteGraph.debug)==null||h.call(LiteGraph,"history saved: "+f.actionHistoryPtr,d.actionName)}}actionHistoryBack(t={}){var s,n,o,l,p,h={};Object.assign(h,t);var u=this.history;return u.actionHistoryPtr!=null&&u.actionHistoryPtr>=0?(u.actionHistoryPtr--,(s=LiteGraph.debug)==null||s.call(LiteGraph,"history step back: "+u.actionHistoryPtr),this.actionHistoryLoad({iVersion:u.actionHistoryPtr})?((o=LiteGraph.debug)==null||o.call(LiteGraph,"history loaded back: "+u.actionHistoryPtr),(l=LiteGraph.debug)==null||l.call(LiteGraph,this.history),!0):((n=LiteGraph.warn)==null||n.call(LiteGraph,"historyLoad failed, restore pointer? "+u.actionHistoryPtr),u.actionHistoryPtr++,!1)):((p=LiteGraph.debug)==null||p.call(LiteGraph,"history is already at older state"),!1)}actionHistoryForward(t={}){var s,n,o,l,p={};Object.assign(p,t);var h=this.history;return h.actionHistoryPtr<h.actionHistoryVersions.length?(h.actionHistoryPtr++,(s=LiteGraph.debug)==null||s.call(LiteGraph,"history step forward: "+h.actionHistoryPtr),this.actionHistoryLoad({iVersion:h.actionHistoryPtr})?((o=LiteGraph.debug)==null||o.call(LiteGraph,"history loaded forward: "+h.actionHistoryPtr),!0):((n=LiteGraph.warn)==null||n.call(LiteGraph,"historyLoad failed, restore pointer? "+h.actionHistoryPtr),h.actionHistoryPtr--,!1)):((l=LiteGraph.debug)==null||l.call(LiteGraph,"history is already at newer state"),!1)}actionHistoryLoad(t={}){var s,n={iVersion:!1,backStep:!1},o=Object.assign(n,t),l=this.history;if(l.actionHistory[o.iVersion]&&l.actionHistory[o.iVersion].graphSave){var p=JSON.stringify(this.history);return this.configure(l.actionHistory[o.iVersion].graphSave),this.history=JSON.parse(p),(s=LiteGraph.debug)==null||s.call(LiteGraph,"history loaded: "+o.iVersion,l.actionHistory[o.iVersion].actionName),!0}else return!1}};m(J,"supported_types",["number","string","boolean"]),m(J,"STATUS_STOPPED",1),m(J,"STATUS_RUNNING",2);let LGraph=J;class LGraphNode{constructor(t="Unnamed"){this.title=t,this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}}set pos(t){var s;!t||t.length<2||((s=this._pos)!=null||(this._pos=new Float32Array(10,10)),this._pos[0]=t[0],this._pos[1]=t[1])}get pos(){return this._pos}configure(t){var s,n,o,l,p;Object.entries(t).forEach(([h,u])=>{var c;if(h==="properties"){for(var d in u)this.properties[d]=u[d],(c=this.onPropertyChanged)==null||c.call(this,d,u[d]);return}u!==null&&(typeof u=="object"?this[h]&&this[h].configure?this[h].configure(u):this[h]=LiteGraph.cloneObject(u,this[h]):this[h]=u)}),t.title||(this.title=this.constructor.title),(s=this.inputs)==null||s.forEach((h,u)=>{var c,d;if(!h.link)return;const f=this.graph?this.graph.links[h.link]:null;(c=this.onConnectionsChange)==null||c.call(this,LiteGraph.INPUT,u,!0,f,h),(d=this.onInputAdded)==null||d.call(this,h)}),(n=this.outputs)==null||n.forEach((h,u)=>{var c;h.links&&(h.links.forEach(()=>{var d;const f=this.graph;(d=this.onConnectionsChange)==null||d.call(this,LiteGraph.OUTPUT,u,!0,f,h)}),(c=this.onOutputAdded)==null||c.call(this,h))}),this.widgets&&(this.widgets.forEach(h=>{h&&h.options&&h.options.property&&this.properties[h.options.property]!==void 0&&(h.value=JSON.parse(JSON.stringify(this.properties[h.options.property])))}),(o=t.widgets_values)==null||o.forEach((h,u)=>{this.widgets[u]&&(this.widgets[u].value=h)})),(l=this.onConfigure)==null||l.call(this,t),(p=this.graph)==null||p.onGraphChanged({action:"nodeConfigure",doSave:!1})}serialize(){var t,s,n,o={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};return this.constructor===LGraphNode&&this.last_serialization?this.last_serialization:(this.inputs&&(o.inputs=LiteGraph.cloneObject(this.inputs)),this.outputs&&(this.outputs.forEach(l=>{delete l._data}),o.outputs=LiteGraph.cloneObject(this.outputs)),this.title&&this.title!=this.constructor.title&&(o.title=this.title),this.properties&&(o.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets&&(o.widgets_values=this.widgets.map(l=>{var p;return(p=l==null?void 0:l.value)!=null?p:null})),(t=o.type)!=null||(o.type=this.constructor.type),this.color&&(o.color=this.color),this.bgcolor&&(o.bgcolor=this.bgcolor),this.boxcolor&&(o.boxcolor=this.boxcolor),this.shape&&(o.shape=this.shape),(s=this.onSerialize)!=null&&s.call(this,o)&&((n=LiteGraph.warn)==null||n.call(LiteGraph,"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter")),o)}clone(){var t,s,n=LiteGraph.createNode(this.type);if(!n)return null;var o=LiteGraph.cloneObject(this.serialize());return(t=o.inputs)==null||t.forEach(l=>{l.link=null}),(s=o.outputs)==null||s.forEach(l=>{l.links&&(l.links.length=0)}),delete o.id,LiteGraph.use_uuids&&(o.id=LiteGraph.uuidv4()),n.configure(o),n}toString(){return JSON.stringify(this.serialize())}getTitle(){var t;return(t=this.title)!=null?t:this.constructor.title}setProperty(t,s){var n,o;if(this.properties||(this.properties={}),s===this.properties[t])return;const l=this.properties[t];this.properties[t]=s,((n=this.onPropertyChanged)==null?void 0:n.call(this,t,s,l))===!1&&(this.properties[t]=l);const p=(o=this.widgets)==null?void 0:o.find(h=>{var u;return h&&((u=h.options)==null?void 0:u.property)===t});p&&(p.value=s)}setOutputData(t,s){var n;if(this.outputs){if((t==null?void 0:t.constructor)===String)t=this.findOutputSlot(t);else if(t==-1||t>=this.outputs.length)return;var o=this.outputs[t];o&&(o._data=s,(n=this.outputs[t].links)==null||n.forEach(l=>{const p=this.graph.links[l];p&&(p.data=s)}))}}setOutputDataType(t,s){var n,o;if(this.outputs&&!(t==-1||t>=this.outputs.length)){var l=this.outputs[t];l&&(l.type=s,(o=(n=this.outputs[t])==null?void 0:n.links)==null||o.forEach(p=>{this.graph.links[p]&&(this.graph.links[p].type=s)}))}}getInputData(t,s,n){var o;if(this.inputs&&!(t>=this.inputs.length||this.inputs[t].link==null)){var l=this.inputs[t].link,p=this.graph.links[l];if(!p)return null;if(!s)return p.data;var h=this.graph.getNodeById(p.origin_id);if(!h)return p.data;if(n){var u=this.id+"_getInputData_forced_"+Math.floor(Math.random()*9999),c={action:u,options:{action_call:u}};this.refreshAncestors(c)}return h.updateOutputData?h.updateOutputData(p.origin_slot):(o=h.doExecute)==null||o.call(h),p.data}}getInputDataType(t){if(!this.inputs||t>=this.inputs.length||this.inputs[t].link==null)return null;var s=this.inputs[t].link,n=this.graph.links[s];if(!n)return null;var o=this.graph.getNodeById(n.origin_id);if(!o)return n.type;var l=o.outputs[n.origin_slot];return l?l.type:null}getInputDataByName(t,s){var n=this.findInputSlot(t);return n==-1?null:this.getInputData(n,s)}isInputConnected(t){return this.inputs?t<this.inputs.length&&this.inputs[t].link!=null:!1}getInputInfo(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null}getInputLink(t){if(!this.inputs)return null;if(t<this.inputs.length){var s=this.inputs[t];return this.graph.links[s.link]}return null}getInputNode(t){if(!this.inputs||t>=this.inputs.length)return null;var s=this.inputs[t];if(!s||s.link===null)return null;var n=this.graph.links[s.link];return n?this.graph.getNodeById(n.origin_id):null}getInputOrProperty(t){if(this.inputs)for(var s=0,n=this.inputs.length;s<n;++s){var o=this.inputs[s];if(t==o.name&&o.link!=null){var l=this.graph.links[o.link];if(l)return l.data}}return this.properties?this.properties[t]:null}getOutputData(t){if(!this.outputs||t>=this.outputs.length)return null;var s=this.outputs[t];return s._data}getOutputInfo(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null}isOutputConnected(t){return this.outputs?t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length:!1}isAnyOutputConnected(){return this.outputs?this.outputs.some(t=>t.links&&t.links.length):!1}getOutputNodes(t){if(!this.outputs||t>=this.outputs.length)return null;const s=this.outputs[t];return!s.links||s.links.length===0?null:s.links.map(n=>this.graph.links[n]).filter(n=>n).map(n=>this.graph.getNodeById(n.target_id)).filter(n=>n)}addOnTriggerInput(){var t=this.findInputSlot("onTrigger");return t==-1?(this.addInput("onTrigger",LiteGraph.EVENT,{removable:!0,nameLocked:!0}),this.findInputSlot("onTrigger")):t}addOnExecutedOutput(){var t=this.findOutputSlot("onExecuted");return t==-1?(this.addOutput("onExecuted",LiteGraph.ACTION,{removable:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")):t}onAfterExecuteNode(t,s){var n,o=this.findOutputSlot("onExecuted");o!=-1&&((n=LiteGraph.debug)==null||n.call(LiteGraph,this.id+":"+this.order+" triggering slot onAfterExecute",t,s),this.triggerSlot(o,t,null,s))}changeMode(t){switch(t){case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.ON_EVENT:break;case LiteGraph.NEVER:break;case LiteGraph.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=t,!0}executePendingActions(){!this._waiting_actions||!this._waiting_actions.length||(this._waiting_actions.forEach(t=>{this.onAction(t[0],t[1],t[2],t[3],t[4])}),this._waiting_actions.length=0)}doExecute(t,s={}){var n,o,l,p,h;if(this.onExecute){if((n=s.action_call)!=null||(s.action_call=`${this.id}_exec_${Math.floor(Math.random()*9999)}`),this.graph.nodes_executing&&this.graph.nodes_executing[this.id]){(o=LiteGraph.debug)==null||o.call(LiteGraph,"NODE already executing! Prevent! "+this.id+":"+this.order);return}if(LiteGraph.ensureNodeSingleExecution&&this.exec_version&&this.exec_version>=this.graph.iteration&&this.exec_version!==void 0){(l=LiteGraph.debug)==null||l.call(LiteGraph,"!! NODE already EXECUTED THIS STEP !! "+this.exec_version);return}if(LiteGraph.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&s&&s.action_call&&this.graph.nodes_executedAction[this.id]==s.action_call){(p=LiteGraph.debug)==null||p.call(LiteGraph,"!! NODE already ACTION THIS STEP !! "+s.action_call);return}this.graph.nodes_executing[this.id]=!0,this.onExecute(t,s),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,s&&s.action_call&&(this.action_call=s.action_call,this.graph.nodes_executedAction[this.id]=s.action_call)}this.execute_triggered=2,(h=this.onAfterExecuteNode)==null||h.call(this,t,s)}execute(t,s={}){return this.doExecute(t,s)}actionDo(t,s,n={},o){var l,p,h,u;if(this.onAction){if((l=n.action_call)!=null||(n.action_call=`${this.id}_${t||"action"}_${Math.floor(Math.random()*9999)}`),LiteGraph.ensureNodeSingleAction&&this.graph.nodes_actioning&&this.graph.nodes_actioning[this.id]==n.action_call)return;if((p=LiteGraph.debug)==null||p.call(LiteGraph,"CheckActioned ? "+this.id+":"+this.order+" :: "+this.action_call),LiteGraph.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&n&&n.action_call&&this.graph.nodes_executedAction[this.id]==n.action_call){(h=LiteGraph.debug)==null||h.call(LiteGraph,"!! NODE already ACTION THIS STEP !! "+n.action_call),\u00E7;return}this.graph.nodes_actioning[this.id]=t||"actioning",this.onAction(t,s,n,o),this.graph.nodes_actioning[this.id]=!1,n&&n.action_call&&(this.action_call=n.action_call,this.graph.nodes_executedAction[this.id]=n.action_call)}this.action_triggered=2,(u=this.onAfterExecuteNode)==null||u.call(this,s,n)}trigger(t,s,n){!this.outputs||this.outputs.length===0||(this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime()),this.outputs.forEach((o,l)=>{o&&o.type===LiteGraph.EVENT&&(!t||o.name===t)&&this.triggerSlot(l,s,null,n)}))}triggerSlot(t,s,n,o={}){var l,p,h,u;if(this.outputs){if(t==null){(l=LiteGraph.error)==null||l.call(LiteGraph,"triggerSlot","slot must be a number");return}t.constructor!==Number&&((p=LiteGraph.warn)==null||p.call(LiteGraph,"triggerSlot","slot must be a number, use node.trigger('name') if you want to use a string"));var c=this.outputs[t];if(c){var d=c.links;if(!(!d||!d.length)&&!(this.graph&&this.graph.ancestorsCall)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var f=0;f<d.length;++f){var b=d[f];if(!(n!=null&&n!=b)){var _=this.graph.links[d[f]];if(_){_._last_time=LiteGraph.getTime();var g=this.graph.getNodeById(_.target_id);if(g){if(g.mode===LiteGraph.ON_TRIGGER)o.action_call||(o.action_call=`${this.id}_trigg_${Math.floor(Math.random()*9999)}`),LiteGraph.refreshAncestorsOnTriggers&&g.refreshAncestors({action:"trigger",param:s,options:o}),g.onExecute&&g.doExecute(s,o);else if(g.onAction){o.action_call||(o.action_call=`${this.id}_act_${Math.floor(Math.random()*9999)}`);let L=g.inputs[_.target_slot];(h=LiteGraph.debug)==null||h.call(LiteGraph,"triggerSlot","will call onACTION: "+this.id+":"+this.order+" :: "+L.name),LiteGraph.refreshAncestorsOnActions&&g.refreshAncestors({action:L.name,param:s,options:o}),LiteGraph.use_deferred_actions&&g.onExecute?((u=g._waiting_actions)!=null||(g._waiting_actions=[]),g._waiting_actions.push([L.name,s,o,_.target_slot])):g.actionDo(L.name,s,o,_.target_slot)}}}}}}}}}clearTriggeredSlot(t,s){!this.outputs||!this.outputs[t]||!this.outputs[t].links||this.outputs[t].links.forEach(n=>{if(s!==null&&s!==n)return;const o=this.graph.links[n];o&&(o._last_time=0)})}setSize(t){var s;this.size=t,(s=this.onResize)==null||s.call(this,this.size)}addProperty(t,s,n,o){var l,p;const h={name:t,type:n,default_value:s,...o};return this.properties_info=(l=this.properties_info)!=null?l:[],this.properties_info.push(h),this.properties=(p=this.properties)!=null?p:{},this.properties[t]=s,h}addInput(t,s,n){return this.addSlot(t,s,n,!0)}addOutput(t,s,n){return this.addSlot(t,s,n,!1)}addSlot(t,s,n,o){var l,p,h,u;const c=o?{name:t,type:s,link:null,...n}:{name:t,type:s,links:null,...n};return o?(this.inputs=(l=this.inputs)!=null?l:[],this.inputs.push(c),(p=this.onInputAdded)==null||p.call(this,c),LiteGraph.registerNodeAndSlotType(this,s)):(this.outputs=(h=this.outputs)!=null?h:[],this.outputs.push(c),(u=this.onOutputAdded)==null||u.call(this,c),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,s,!0)),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),c}addInputs(t){this.addSlots(t,!0)}addOutputs(t){this.addSlots(t,!1)}addSlots(t,s){var n;typeof t=="string"&&(t=[t]),t.forEach(o=>{var l,p,h,u,c,d;const f=s?{name:o[0],type:o[1],link:null,...(l=o[2])!=null?l:{}}:{name:o[0],type:o[1],links:null,...(p=o[2])!=null?p:{}};s?(this.inputs=(h=this.inputs)!=null?h:[],this.inputs.push(f),(u=this.onInputAdded)==null||u.call(this,f),LiteGraph.registerNodeAndSlotType(this,o[1])):(this.outputs=(c=this.outputs)!=null?c:[],this.outputs.push(f),(d=this.onOutputAdded)==null||d.call(this,f),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,o[1],!0))}),this.setSize(this.computeSize()),(n=this.setDirtyCanvas)==null||n.call(this,!0,!0)}removeInput(t){var s;this.disconnectInput(t);const n=this.inputs.splice(t,1)[0];this.inputs.slice(t).filter(o=>!!o).forEach(o=>{const l=this.graph.links[o.link];l!=null&&l.target_slot&&l.target_slot--}),this.setSize(this.computeSize()),(s=this.onInputRemoved)==null||s.call(this,t,n),this.setDirtyCanvas(!0,!0)}removeOutput(t){var s;this.disconnectOutput(t),this.outputs=this.outputs.filter((n,o)=>o!==t),this.outputs.slice(t).forEach(n=>{!n||!n.links||n.links.forEach(o=>{const l=this.graph.links[o];l&&(l.origin_slot-=1)})}),this.setSize(this.computeSize()),(s=this.onOutputRemoved)==null||s.call(this,t),this.setDirtyCanvas(!0,!0)}addConnection(t,s,n,o){var l={name:t,type:s,pos:n,direction:o,links:null};return this.connections.push(l),l}computeSize(t){if(this.constructor.size)return this.constructor.size.concat();var s=t||new Float32Array([0,0]),n=LiteGraph.NODE_TEXT_SIZE;const o=b=>b?n*b.length*.6:0;var l=o(this.title),p=0,h=0;this.inputs&&(p=this.inputs.reduce((b,_)=>{const g=_.label||_.name||"",L=o(g);return Math.max(b,L)},0)),this.outputs&&(h=this.outputs.reduce((b,_)=>{const g=_.label||_.name||"",L=o(g);return Math.max(b,L)},0)),s[0]=Math.max(p+h+10,l),s[0]=Math.max(s[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(s[0]=Math.max(s[0],LiteGraph.NODE_WIDTH*1.5));const u=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1,1)*LiteGraph.NODE_SLOT_HEIGHT;s[1]=u+(this.constructor.slot_start_y||0);let c=0;if(this.widgets&&this.widgets.length){for(var d=0,f=this.widgets.length;d<f;++d)this.widgets[d].computeSize?c+=this.widgets[d].computeSize(s[0])[1]+4:c+=LiteGraph.NODE_WIDGET_HEIGHT+4;c+=8}return this.widgets_up?s[1]=Math.max(s[1],c):this.widgets_start_y!=null?s[1]=Math.max(s[1],c+this.widgets_start_y):s[1]+=c,this.constructor.min_height&&s[1]<this.constructor.min_height&&(s[1]=this.constructor.min_height),s[1]+=6,s}getPropertyInfo(t){var s=null;if(this.properties_info){for(var n=0;n<this.properties_info.length;++n)if(this.properties_info[n].name==t){s=this.properties_info[n];break}}return this.constructor[`@${t}`]&&(s=this.constructor[`@${t}`]),this.constructor.widgets_info&&this.constructor.widgets_info[t]&&(s=this.constructor.widgets_info[t]),!s&&this.onGetPropertyInfo&&(s=this.onGetPropertyInfo(t)),s||(s={}),s.type||(s.type=typeof this.properties[t]),s.widget=="combo"&&(s.type="enum"),s}addWidget(t,s,n,o,l){var p,h,u;(p=this.widgets)!=null||(this.widgets=[]),!l&&o&&o.constructor===Object&&(l=o,o=null),l&&l.constructor===String&&(l={property:l}),o&&o.constructor===String&&(l!=null||(l={}),l.property=o,o=null),o&&o.constructor!==Function&&((h=LiteGraph.warn)==null||h.call(LiteGraph,"addWidget: callback must be a function"),o=null);var c={type:t.toLowerCase(),name:s,value:n,callback:o,options:l||{}};if(c.options.y!==void 0&&(c.y=c.options.y),!o&&!c.options.callback&&!c.options.property&&((u=LiteGraph.warn)==null||u.call(LiteGraph,"LiteGraph addWidget(...) without a callback or property assigned")),t=="combo"&&!c.options.values)throw Error("LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }");return this.widgets.push(c),this.setSize(this.computeSize()),c}addCustomWidget(t){var s;return(s=this.widgets)!=null||(this.widgets=[]),this.widgets.push(t),t}getBounding(t=new Float32Array(4),s){const n=this.pos,o=this.flags.collapsed,l=this.size;let p=0,h=1,u=0,c=0;return s&&(p=4,h=6+p,u=4,c=5+u),t[0]=n[0]-p,t[1]=n[1]-LiteGraph.NODE_TITLE_HEIGHT-u,t[2]=o?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+h:l[0]+h,t[3]=o?LiteGraph.NODE_TITLE_HEIGHT+c:l[1]+LiteGraph.NODE_TITLE_HEIGHT+c,this.onBounding&&this.onBounding(t),t}isPointInside(t,s,n=0,o){var l=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(o&&(l=0),this.flags&&this.flags.collapsed){if(LiteGraph.isInsideRectangle(t,s,this.pos[0]-n,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-n,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*n,LiteGraph.NODE_TITLE_HEIGHT+2*n))return!0}else if(this.pos[0]-4-n<t&&this.pos[0]+this.size[0]+4+n>t&&this.pos[1]-l-n<s&&this.pos[1]+this.size[1]+n>s)return!0;return!1}getSlotInPosition(t,s){var n=new Float32Array(2);if(this.inputs)for(let o=0,l=this.inputs.length;o<l;++o){let p=this.inputs[o];if(this.getConnectionPos(!0,o,n),LiteGraph.isInsideRectangle(t,s,n[0]-10,n[1]-5,20,10))return{input:p,slot:o,link_pos:n}}if(this.outputs)for(let o=0,l=this.outputs.length;o<l;++o){let p=this.outputs[o];if(this.getConnectionPos(!1,o,n),LiteGraph.isInsideRectangle(t,s,n[0]-10,n[1]-5,20,10))return{output:p,slot:o,link_pos:n}}return null}findInputSlot(t,s){if(!this.inputs)return-1;for(var n=0,o=this.inputs.length;n<o;++n)if(t==this.inputs[n].name)return s?this.inputs[n]:n;return-1}findOutputSlot(t,s=!1){if(!this.outputs)return-1;for(var n=0,o=this.outputs.length;n<o;++n)if(t==this.outputs[n].name)return s?this.outputs[n]:n;return-1}findInputSlotFree(t={}){var s={returnObj:!1,typesNotAccepted:[]},n=Object.assign(s,t);if(!this.inputs)return-1;for(var o=0,l=this.inputs.length;o<l;++o)if(!(this.inputs[o].link&&this.inputs[o].link!=null)&&!(n.typesNotAccepted&&n.typesNotAccepted.includes&&n.typesNotAccepted.includes(this.inputs[o].type)))return n.returnObj?this.inputs[o]:o;return-1}findOutputSlotFree(t={}){var s={returnObj:!1,typesNotAccepted:[]},n=Object.assign(s,t);if(!this.outputs)return-1;for(let o=0,l=this.outputs.length;o<l;++o)if(!(this.outputs[o].links&&this.outputs[o].links!=null)&&!(n.typesNotAccepted&&n.typesNotAccepted.includes&&n.typesNotAccepted.includes(this.outputs[o].type)))return n.returnObj?this.outputs[o]:o;return-1}findInputSlotByType(t,s,n,o){return this.findSlotByType(!0,t,s,n,o)}findOutputSlotByType(t,s,n,o){return this.findSlotByType(!1,t,s,n,o)}findSlotByType(t=!1,s,n=!1,o=!1,l=!1){var p=t?this.inputs:this.outputs;if(!p)return-1;(s==""||s=="*")&&(s=0);for(let h=0,u=p.length;h<u;++h){let c=(s+"").toLowerCase().split(","),d=p[h].type=="0"||p[h].type=="*"?"0":p[h].type;d=(d+"").toLowerCase().split(",");for(let f=0;f<c.length;f++)for(let b=0;b<d.length;b++)if(c[f]=="_event_"&&(c[f]=LiteGraph.EVENT),d[f]=="_event_"&&(d[f]=LiteGraph.EVENT),c[f]=="*"&&(c[f]=0),d[f]=="*"&&(d[f]=0),c[f]==d[b]){if(o&&p[h].links&&p[h].links!==null)continue;return n?p[h]:h}}if(o&&!l)for(let h=0,u=p.length;h<u;++h){let c=(s+"").toLowerCase().split(","),d=p[h].type=="0"||p[h].type=="*"?"0":p[h].type;d=(d+"").toLowerCase().split(",");for(let f=0;f<c.length;f++)for(let b=0;b<d.length;b++)if(c[f]=="*"&&(c[f]=0),d[f]=="*"&&(d[f]=0),c[f]==d[b])return n?p[h]:h}return-1}connectByType(t,s,n="*",o={}){var l,p,h,u,c,d={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},f=Object.assign(d,o);s&&s.constructor===Number&&(s=this.graph.getNodeById(s));var b=s.findInputSlotByType(n,!1,!0);return b>=0&&b!==null?((l=LiteGraph.debug)==null||l.call(LiteGraph,"CONNbyTYPE type "+n+" for "+b),this.connect(t,s,b)):f.createEventInCase&&n==LiteGraph.EVENT?((p=LiteGraph.debug)==null||p.call(LiteGraph,"connect WILL CREATE THE onTrigger "+n+" to "+s),this.connect(t,s,-1)):f.generalTypeInCase&&(b=s.findInputSlotByType(0,!1,!0,!0),(h=LiteGraph.debug)==null||h.call(LiteGraph,"connect TO a general type (*, 0), if not found the specific type ",n," to ",s,"RES_SLOT:",b),b>=0)?this.connect(t,s,b):f.firstFreeIfOutputGeneralInCase&&(n==0||n=="*"||n=="")&&(b=s.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]}),(u=LiteGraph.debug)==null||u.call(LiteGraph,"connect TO TheFirstFREE ",n," to ",s,"RES_SLOT:",b),b>=0)?this.connect(t,s,b):((c=LiteGraph.debug)==null||c.call(LiteGraph,"no way to connect type: ",n," to targetNODE ",s),null)}connectByTypeOutput(t,s,n="*",o={}){var l,p,h,u={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},c=Object.assign(u,o);s&&s.constructor===Number&&(s=this.graph.getNodeById(s));var d=s.findOutputSlotByType(n,!1,!0);return d>=0&&d!==null?((l=LiteGraph.debug)==null||l.call(LiteGraph,"CONNbyTYPE OUT! type "+n+" for "+d),s.connect(d,this,t)):c.generalTypeInCase&&(d=s.findOutputSlotByType(0,!1,!0,!0),d>=0)?s.connect(d,this,t):c.createEventInCase&&n==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots?(d=s.addOnExecutedOutput(),s.connect(d,this,t)):c.firstFreeIfInputGeneralInCase&&(n==0||n=="*"||n==""||n=="undefined")&&(d=s.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]}),d>=0)?s.connect(d,this,t):((p=LiteGraph.debug)==null||p.call(LiteGraph,"no way to connect byOUT type: ",n," to sourceNODE ",s),(h=LiteGraph.log)==null||h.call(LiteGraph,"type OUT! "+n+" not found or not free?"),null)}connect(t,s,n=0){var o,l,p,h,u,c,d,f,b,_,g,L,G,T;if(!this.graph)return(o=LiteGraph.log)==null||o.call(LiteGraph,"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return(l=LiteGraph.log)==null||l.call(LiteGraph,`Connect: Error, no slot of name ${t}`),null}else if(!this.outputs||t>=this.outputs.length)return(p=LiteGraph.log)==null||p.call(LiteGraph,"Connect: Error, slot number not found"),null;if(s&&s.constructor===Number&&(s=this.graph.getNodeById(s)),!s)throw new Error("target node is null");if(s==this)return null;if(n.constructor===String){if(n=s.findInputSlot(n),n==-1)return(h=LiteGraph.log)==null||h.call(LiteGraph,`Connect: Error, no slot of name ${n}`),null}else if(n===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)s.changeMode(LiteGraph.ON_TRIGGER),n=s.findInputSlot("onTrigger");else return null;else if(!s.inputs||n>=s.inputs.length)return(u=LiteGraph.log)==null||u.call(LiteGraph,"Connect: Error, slot number not found"),null;var E=!1,C=s.inputs[n],I=null,D=this.outputs[t];if(!this.outputs[t])return(c=LiteGraph.log)==null||c.call(LiteGraph,"Invalid slot passed: ",t,this.outputs),null;if(s.onBeforeConnectInput&&(n=s.onBeforeConnectInput(s)),((d=this.onConnectOutput)==null?void 0:d.call(this,t,C.type,C,s,n))===!1)return null;if(n===!1||n===null||!LiteGraph.isValidConnection(D.type,C.type))return this.setDirtyCanvas(!1,!0),E&&this.graph.connectionChange(this,I),null;if((f=LiteGraph.debug)==null||f.call(LiteGraph,"DBG targetSlot",n),((b=s.onConnectInput)==null?void 0:b.call(s,n,D.type,D,this,t))===!1||((_=this.onConnectOutput)==null?void 0:_.call(this,t,C.type,C,s,n))===!1)return null;s.inputs[n]&&s.inputs[n].link!=null&&(this.graph.beforeChange(),s.disconnectInput(n,{doProcessChange:!1}),E=!0),(g=D.links)!=null&&g.length&&D.type===LiteGraph.EVENT&&(LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(t,!1,{doProcessChange:!1}),E=!0));var R;return LiteGraph.use_uuids?R=LiteGraph.uuidv4():R=++this.graph.last_link_id,I=new LiteGraph.LLink(R,C.type||D.type,this.id,t,s.id,n),this.graph.links[I.id]=I,D.links==null&&(D.links=[]),D.links.push(I.id),!s.inputs||typeof s.inputs[n]=="undefined"?((L=LiteGraph.warn)==null||L.call(LiteGraph,"connect aborted: target slot does not exist on target node",s,n),D.links.pop(),delete this.graph.links[I.id],null):(s.inputs[n].link=I.id,(G=this.onConnectionsChange)==null||G.call(this,LiteGraph.OUTPUT,t,!0,I,D),(T=s.onConnectionsChange)==null||T.call(s,LiteGraph.INPUT,n,!0,I,C),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,s,n,this,t),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t,s,n)),this.graph.onGraphChanged({action:"connect"}),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,I),I)}disconnectOutput(t,s,n={}){var o,l,p,h,u,c,d={doProcessChange:!0},f=Object.assign(d,n);if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return(o=LiteGraph.log)==null||o.call(LiteGraph,`Connect: Error, no slot of name ${t}`),!1}else if(!this.outputs||t>=this.outputs.length)return(l=LiteGraph.log)==null||l.call(LiteGraph,"Connect: Error, slot number not found"),!1;var b=this.outputs[t];if(!b||!b.links||b.links.length==0)return!1;if(s){if(s.constructor===Number&&(s=this.graph.getNodeById(s)),!s)throw new Error("Target Node not found");for(let g=0,L=b.links.length;g<L;g++){let G=b.links[g],T=this.graph.links[G];if(T.target_id==s.id){b.links.splice(g,1);var _=s.inputs[T.target_slot];_.link=null,delete this.graph.links[G],(p=this.graph)==null||p.onGraphChanged({action:"disconnectOutput",doSave:f.doProcessChange}),(h=s.onConnectionsChange)==null||h.call(s,LiteGraph.INPUT,T.target_slot,!1,T,_),(u=this.onConnectionsChange)==null||u.call(this,LiteGraph.OUTPUT,t,!1,T,b),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,s,T.target_slot));break}}}else{for(let g=0,L=b.links.length;g<L;g++){let G=b.links[g],T=this.graph.links[G];T&&(s=this.graph.getNodeById(T.target_id),_=null,(c=this.graph)==null||c.onGraphChanged({action:"disconnectOutput",doSave:f.doProcessChange}),s&&(_=s.inputs[T.target_slot],_.link=null,s.onConnectionsChange&&s.onConnectionsChange(LiteGraph.INPUT,T.target_slot,!1,T,_),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,s,T.target_slot)),delete this.graph.links[G],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,T,b),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,s,T.target_slot)))}b.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0}disconnectInput(t,s={}){var n,o,l,p={doProcessChange:!0},h=Object.assign(p,s);if(t.constructor===String){if(t=this.findInputSlot(t),t==-1)return(n=LiteGraph.log)==null||n.call(LiteGraph,`Connect: Error, no slot of name ${t}`),!1}else if(!this.inputs||t>=this.inputs.length)return(o=LiteGraph.log)==null||o.call(LiteGraph,"Connect: Error, slot number not found"),!1;var u=this.inputs[t];if(!u)return!1;var c=this.inputs[t].link;if(c!=null){this.inputs[t].link=null;var d=this.graph.links[c];if(d){var f=this.graph.getNodeById(d.origin_id);if(!f)return!1;var b=f.outputs[d.origin_slot];if(!b||!b.links||b.links.length==0)return!1;for(var _=0,g=b.links.length;_<g;_++)if(b.links[_]==c){b.links.splice(_,1);break}delete this.graph.links[c],(l=this.graph)==null||l.onGraphChanged({action:"disconnectInput",doSave:h.doProcessChange}),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,t,!1,d,u),f.onConnectionsChange&&f.onConnectionsChange(LiteGraph.OUTPUT,_,!1,d,b),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,f,_),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,t))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0}getConnectionPos(t,s,n=new Float32Array(2)){var o=0;t&&this.inputs&&(o=this.inputs.length),!t&&this.outputs&&(o=this.outputs.length);var l=LiteGraph.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var p=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(n[0]=this.pos[0]+p*.5,t?n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:n[1]=this.pos[1]):(t?n[0]=this.pos[0]:n[0]=this.pos[0]+p,n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT*.5),n}return t&&s==-1?(n[0]=this.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*.5,n[1]=this.pos[1]+LiteGraph.NODE_TITLE_HEIGHT*.5,n):t&&o>s&&this.inputs[s].pos?(n[0]=this.pos[0]+this.inputs[s].pos[0],n[1]=this.pos[1]+this.inputs[s].pos[1],n):!t&&o>s&&this.outputs[s].pos?(n[0]=this.pos[0]+this.outputs[s].pos[0],n[1]=this.pos[1]+this.outputs[s].pos[1],n):this.horizontal?(n[0]=this.pos[0]+(s+.5)*(this.size[0]/o),t?n[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:n[1]=this.pos[1]+this.size[1],n):(t?n[0]=this.pos[0]+l:n[0]=this.pos[0]+this.size[0]+1-l,n[1]=this.pos[1]+(s+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),n)}alignToGrid(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)}trace(t){var s,n,o,l;this.console||(this.console=[]),(n=(s=this.console).push)==null||n.call(s,t),this.console.length>LGraphNode.MAX_CONSOLE&&((l=(o=this.console).shift)==null||l.call(o)),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,t)}setDirtyCanvas(t,s){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,s])}loadImage(t){var s=new Image;s.src=LiteGraph.node_images_path+t,s.ready=!1;var n=this;return s.onload=function(){this.ready=!0,n.setDirtyCanvas(!0)},s}captureInput(t){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var s=this.graph.list_of_graphcanvas,n=0;n<s.length;++n){var o=s[n];!t&&o.node_capturing_input!=this||(o.node_capturing_input=t?this:null)}}collapse(t){this.graph.onGraphChanged({action:"collapse"}),!(this.constructor.collapsable===!1&&!t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))}pin(t){this.graph.onGraphChanged({action:"pin"}),t===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=t}localToScreen(t,s,n){return[(t+this.pos[0])*n.scale+n.offset[0],(s+this.pos[1])*n.scale+n.offset[1]]}refreshAncestors(t={}){var s={action:"",param:null,options:null,passParam:!0},n=Object.assign(s,t);if(this.inputs&&!(LiteGraph.preventAncestorRecalculation&&this.graph.node_ancestorsCalculated&&this.graph.node_ancestorsCalculated[this.id])){(!n.action||n.action=="")&&(n.action=this.id+"_ancestors"),(!n.param||n.param=="")&&(n.param=this.id+"_ancestors"),n.options||(n.options={}),n.options=Object.assign({action_call:n.action},n.options),this.graph.ancestorsCall=!0;var o={modesSkip:[LiteGraph.NEVER,LiteGraph.ON_EVENT,LiteGraph.ON_TRIGGER],modesOnly:[LiteGraph.ALWAYS,LiteGraph.ON_REQUEST],typesSkip:[LiteGraph.ACTION],typesOnly:[]},l=this.graph.getAncestors(this,o);for(iN in l)l[iN].doExecute(n.param,n.options),this.graph.node_ancestorsCalculated[l[iN].id]=!0;return this.graph.ancestorsCall=!1,this.graph.node_ancestorsCalculated[this.id]=!0,!0}}}class LGraphGroup{constructor(t="Group"){m(this,"isPointInside",LiteGraph.LGraphNode.prototype.isPointInside),m(this,"setDirtyCanvas",LiteGraph.LGraphNode.prototype.setDirtyCanvas);var s,n;this.title=t,this.font_size=24,this.color=(n=(s=LiteGraph.LGraphCanvas.node_colors.pale_blue)==null?void 0:s.groupcolor)!=null?n:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null}set pos(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])}get pos(){return this._pos}set size(t){!t||t.length<2||(this._size[0]=Math.max(140,t[0]),this._size[1]=Math.max(80,t[1]))}get size(){return this._size}configure(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,t.font_size&&(this.font_size=t.font_size)}serialize(){var t=this._bounding;return{title:this.title,bounding:t.map(s=>Math.round(s)),color:this.color,font_size:this.font_size}}move(t,s,n){var o,l;isNaN(t)&&((o=console.error)==null||o.call(console,"LGraphGroup.move() deltax NaN")),isNaN(s)&&((l=console.error)==null||l.call(console,"LGraphGroup.move() deltay NaN")),this._pos[0]+=t,this._pos[1]+=s,!n&&this._nodes.forEach(p=>{p.pos[0]+=t,p.pos[1]+=s})}recomputeInsideNodes(){this._nodes.length=0;var t=this.graph._nodes,s=new Float32Array(4);this._nodes=t.filter(n=>(n.getBounding(s),LiteGraph.overlapBounding(this._bounding,s)))}}const _LGraphCanvas=class __LGraphCanvas{constructor(a,t,s){m(this,"processMouseWheel",n=>{if(!(!this.graph||!this.allow_dragcanvas)){var o=n.wheelDeltaY!=null?n.wheelDeltaY:n.detail*-60;this.adjustMouseEvent(n);var l=n.clientX,p=n.clientY,h=!this.viewport||this.viewport&&l>=this.viewport[0]&&l<this.viewport[0]+this.viewport[2]&&p>=this.viewport[1]&&p<this.viewport[1]+this.viewport[3];if(h){var u=this.ds.scale;return u*=Math.pow(1.1,o*.01),this.ds.changeScale(u,[n.clientX,n.clientY]),this.graph.change(),n.preventDefault(),!1}}}),m(this,"processKey",n=>{var o,l,p,h,u;if(this.graph){var c=!1;if(n.target.localName!="input"){if(n.type=="keydown"){if(n.keyCode==32&&(this.dragging_canvas=!0,c=!0),n.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),c=!0),n.keyCode==65&&n.ctrlKey&&(this.selectNodes(),c=!0),n.keyCode===67&&(n.metaKey||n.ctrlKey)&&!n.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),c=!0),n.keyCode===86&&(n.metaKey||n.ctrlKey)&&this.pasteFromClipboard(n.shiftKey),(n.keyCode==46||LiteGraph.backspace_delete&&n.keyCode==8)&&n.target.localName!="input"&&n.target.localName!="textarea"&&(this.deleteSelectedNodes(),c=!0),LiteGraph.actionHistory_enabled&&(n.keyCode==89&&n.ctrlKey||n.keyCode==90&&n.ctrlKey&&n.shiftKey?this.graph.actionHistoryForward():n.keyCode==90&&n.ctrlKey&&this.graph.actionHistoryBack()),(o=LiteGraph.debug)==null||o.call(LiteGraph,"Canvas keydown "+n.keyCode),this.selected_nodes)for(let d in this.selected_nodes)(p=(l=this.selected_nodes[d]).onKeyDown)==null||p.call(l,n)}else if(n.type=="keyup"&&(n.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(let d in this.selected_nodes)(u=(h=this.selected_nodes[d]).onKeyUp)==null||u.call(h,n);if(this.graph.change(),c)return n.preventDefault(),n.stopImmediatePropagation(),!1}}}),m(this,"processDrop",n=>{n.preventDefault(),this.adjustMouseEvent(n);var o=n.clientX,l=n.clientY,p=!this.viewport||this.viewport&&o>=this.viewport[0]&&o<this.viewport[0]+this.viewport[2]&&l>=this.viewport[1]&&l<this.viewport[1]+this.viewport[3];if(p){o=n.localX,l=n.localY;var p=!this.viewport||this.viewport&&o>=this.viewport[0]&&o<this.viewport[0]+this.viewport[2]&&l>=this.viewport[1]&&l<this.viewport[1]+this.viewport[3];if(p){var h=[n.canvasX,n.canvasY],u=this.graph?this.graph.getNodeOnPos(h[0],h[1]):null;if(!u){var c=null;this.onDropItem&&(c=this.onDropItem(event)),c||this.checkDropItem(n);return}if(u.onDropFile||u.onDropData){var d=n.dataTransfer.files;if(d&&d.length)for(let G=0;G<d.length;G++){var f=n.dataTransfer.files[0],b=f.name;if(u.onDropFile&&u.onDropFile(f),u.onDropData){var _=new FileReader;_.onload=function(T){var E=T.target.result;u.onDropData(E,b,f)};var g=f.type.split("/")[0];g=="text"||g==""?_.readAsText(f):g=="image"?_.readAsDataURL(f):_.readAsArrayBuffer(f)}}}return u.onDropItem&&u.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}}}),s!=null||(s={skip_render:!1,autoresize:!1,clip_all_nodes:!1}),this.options=s,this.background_image=__LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,a&&a.constructor===String&&(a=document.querySelector(a)),this.ds=new LiteGraph.DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=`${LiteGraph.NODE_TEXT_SIZE}px Arial`,this.inner_text_font=`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.move_destination_link_without_shift=!1,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.free_resize=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.autoresize=s.autoresize,this.skip_render=s.skip_render,this.clip_all_nodes=s.clip_all_nodes,this.free_resize=s.free_resize,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=s.viewport||null,this.low_quality_rendering_threshold=5,t==null||t.attachCanvas(this),this.setCanvas(a,s.skip_events),this.clear(),!this.skip_render&&!s.skip_render&&this.startRendering()}clear(){var a;this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.low_quality_rendering_counter=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),(a=this.onClear)==null||a.call(this)}setGraph(a,t){var s;if(this.graph!=a){if(t||this.clear(),!a){(s=this.graph)==null||s.detachCanvas(this);return}a.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}}getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}openSubgraph(a){if(!a)throw new Error("graph cannot be null");if(this.graph==a)throw new Error("graph cannot be the same");this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),a.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)}closeSubgraph(){if(!(!this._graph_stack||this._graph_stack.length==0)){var a=this.graph._subgraph_node,t=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},t.attachCanvas(this),this.setDirty(!0,!0),a&&(this.centerOnNode(a),this.selectNodes([a])),this.ds.offset=[0,0],this.ds.scale=1}}getCurrentGraph(){return this.graph}setCanvas(a,t){var s;if(a&&a.constructor===String&&(a=document.getElementById(a),!a))throw new Error("Error creating LiteGraph canvas: Canvas not found");if(a!==this.canvas&&(!a&&this.canvas&&(t||this.unbindEvents()),this.canvas=a,this.ds.element=a,!!a)){if(a.className+=" lgraphcanvas",a.data=this,a.tabindex="1",this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,a.getContext==null)throw a.localName!="canvas"?new Error("Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+a.localName):new Error("This browser doesn't support Canvas");var n=this.ctx=a.getContext("2d");n==null&&(a.webgl_enabled||(s=LiteGraph.info)==null||s.call(LiteGraph,"This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),t||this.bindEvents()}}_doNothing(a){return a.preventDefault(),!1}_doReturnTrue(a){return a.preventDefault(),!0}bindEvents(){var a;if(this._events_binded){(a=LiteGraph.warn)==null||a.call(LiteGraph,"LGraphCanvas: events already binded");return}this._events_binded=!0;var t=this.canvas,s=this.getCanvasWindow(),n=s.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),t.addEventListener("pointerdown",this._mousedown_callback,!0),t.addEventListener("pointermove",this._mousemove_callback),t.addEventListener("pointerup",this._mouseup_callback,!0),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("wheel",this.processMouseWheel),t.addEventListener("keydown",this.processKey),n.addEventListener("keyup",this.processKey),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this.processDrop),t.addEventListener("dragenter",this._doReturnTrue,!1)}unbindEvents(){var a;if(!this._events_binded){(a=LiteGraph.warn)==null||a.call(LiteGraph,"LGraphCanvas: no events binded");return}this._events_binded=!1;var t=this.canvas,s=this.getCanvasWindow(),n=s.document;t.removeEventListener("pointerdown",this._mousedown_callback),t.removeEventListener("pointermove",this._mousemove_callback),t.removeEventListener("pointerup",this._mouseup_callback),t.removeEventListener("contextmenu",this._doNothing),t.removeEventListener("wheel",this.processMouseWheel),t.removeEventListener("keydown",this.processKey),n.removeEventListener("keyup",this.processKey),t.removeEventListener("dragover",this._doNothing,!1),t.removeEventListener("dragend",this._doNothing,!1),t.removeEventListener("drop",this.processDrop),t.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null}static getFileExtension(a){const t=new URL(a).pathname,s=t.lastIndexOf(".");return s===-1?"":t.slice(s+1).toLowerCase()}enableWebGL(){if(typeof GL=="undefined")throw new Error("litegl.js must be included to use a WebGL canvas");if(typeof enableWebGLCanvas=="undefined")throw new Error("webglCanvas.js must be included to use this feature");this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0}setDirty(a,t){a&&(this.dirty_canvas=!0),t&&(this.dirty_bgcanvas=!0)}getCanvasWindow(){var a;if(!this.canvas)return window;var t=this.canvas.ownerDocument;return(a=t.defaultView)!=null?a:t.parentWindow}startRendering(){if(this.is_rendering)return;this.is_rendering=!0,a.call(this);function a(){this.pause_rendering||this.draw();var t=this.getCanvasWindow();this.is_rendering&&t.requestAnimationFrame(a.bind(this))}}stopRendering(){this.is_rendering=!1}blockClick(){this.block_click=!0,this.last_mouseclick=0}processUserInputDown(a){var t,s;if(this.pointer_is_down&&a.isPrimary!==void 0&&!a.isPrimary?this.userInput_isNotPrimary=!0:this.userInput_isNotPrimary=!1,this.userInput_type=a.pointerType?a.pointerType:!1,this.userInput_id=a.pointerId?a.pointerId:!1,a.pointerType)switch(a.pointerType){case"mouse":break;case"pen":break;case"touch":break;default:(t=LiteGraph.log)==null||t.call(LiteGraph,"pointerType unknown "+ev.pointerType)}return a.button!==void 0&&(this.userInput_button=a.button,a.button),a.buttons!==void 0&&(this.userInput_button_s=a.buttons),this.userInput_touches=a.changedTouches!==void 0&&a.changedTouches.length!==void 0?a.changedTouches:!1,this.userInput_touches&&this.userInput_touches.length&&((s=LiteGraph.debug)==null||s.call(LiteGraph,"check multiTouches",a.changedTouches)),this.processMouseDown(a)}processMouseDown(a){var t,s,n,o,l,p,h,u,c;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(a);var d=this.getCanvasWindow();__LGraphCanvas.active_canvas=this;var f=a.clientX,b=a.clientY;(t=LiteGraph.log)==null||t.call(LiteGraph,"pointerevents: processMouseDown pointerId:"+a.pointerId+" which:"+a.which+" isPrimary:"+a.isPrimary+" :: x y "+f+" "+b,"previousClick",this.last_mouseclick,"diffTimeClick",this.last_mouseclick?LiteGraph.getTime()-this.last_mouseclick:"notlast"),this.ds.viewport=this.viewport;var _=!this.viewport||this.viewport&&f>=this.viewport[0]&&f<this.viewport[0]+this.viewport[2]&&b>=this.viewport[1]&&b<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(this.canvas.removeEventListener("pointermove",this._mousemove_callback),d.document.addEventListener("pointermove",this._mousemove_callback,!0),d.document.addEventListener("pointerup",this._mouseup_callback,!0)),!!_){var g=this.graph.getNodeOnPos(a.canvasX,a.canvasY,this.visible_nodes,5),L=!1,G=LiteGraph.getTime(),T=a.isPrimary===void 0||a.isPrimary,E=G-this.last_mouseclick<300&&T;if(this.mouse[0]=a.clientX,this.mouse[1]=a.clientY,this.graph_mouse[0]=a.canvasX,this.graph_mouse[1]=a.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&T?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.ContextMenu.closeAll(d),!((s=this.onMouse)!=null&&s.call(this,a))){if(a.which==1&&!this.userInput_isNotPrimary){if(a.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=a.canvasX,this.dragging_rectangle[1]=a.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,L=!0),LiteGraph.alt_drag_do_clone_nodes&&a.altKey&&g&&this.allow_interaction&&!L&&!this.read_only){let M=g,q=g.clone();if(q){if(q.pos[0]+=5,q.pos[1]+=5,this.graph.add(q,!1,{doCalcSize:!1}),g=q,LiteGraph.alt_shift_drag_connect_clone_with_input&&a.shiftKey&&M.inputs&&M.inputs.length)for(var C=0;C<M.inputs.length;++C){var I=M.inputs[C];if(!(!I||I.link==null)){var D=this.graph.links[I.link];if(D&&D.type!==LiteGraph.EVENT){var R;D.origin_id&&(R=this.graph.getNodeById(D.origin_id));var P=g;R&&P&&R.connect(D.origin_slot,P,D.target_slot)}}}L=!0,S||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=g),this.selected_nodes[g.id]||this.processNodeSelected(g,a))}}var N=!1;if(g&&(this.allow_interaction||g.flags.allow_interaction)&&!L&&!this.read_only){if(!this.live_mode&&!g.flags.pinned&&this.bringToFront(g),this.allow_interaction&&!this.connecting_node&&!g.flags.collapsed&&!this.live_mode)if(!L&&g.resizable!==!1&&LiteGraph.isInsideRectangle(a.canvasX,a.canvasY,g.pos[0]+g.size[0]-5,g.pos[1]+g.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=g,this.canvas.style.cursor="se-resize",L=!0;else{if(g.outputs)for(let M=0,q=g.outputs.length;M<q;++M){let it=g.outputs[M],W=g.getConnectionPos(!1,M);if(LiteGraph.isInsideRectangle(a.canvasX,a.canvasY,W[0]-15,W[1]-10,30,20)){this.connecting_node=g,this.connecting_output=it,this.connecting_output.slot_index=M,this.connecting_pos=g.getConnectionPos(!1,M),this.connecting_slot=M,LiteGraph.shift_click_do_break_link_from&&a.shiftKey&&g.disconnectOutput(M),E?(n=g.onOutputDblClick)==null||n.call(g,M,a):(o=g.onOutputClick)==null||o.call(g,M,a),L=!0;break}}if(g.inputs)for(let M=0,q=g.inputs.length;M<q;++M){let it=g.inputs[M],W=g.getConnectionPos(!0,M);if(LiteGraph.isInsideRectangle(a.canvasX,a.canvasY,W[0]-15,W[1]-10,30,20)){if(E?(l=g.onInputDblClick)==null||l.call(g,M,a):(p=g.onInputClick)==null||p.call(g,M,a),it.link!==null){var A=this.graph.links[it.link];LiteGraph.click_do_break_link_to&&(g.disconnectInput(M),this.dirty_bgcanvas=!0,L=!0),a.shiftKey&&(LiteGraph.click_do_break_link_to||g.disconnectInput(M),this.connecting_node=this.graph._nodes_by_id[A.origin_id],this.connecting_slot=A.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,L=!0)}L||(this.connecting_node=g,this.connecting_input=it,this.connecting_input.slot_index=M,this.connecting_pos=g.getConnectionPos(!0,M),this.connecting_slot=M,this.dirty_bgcanvas=!0,L=!0)}}}if(!L){var S=!1,O=[a.canvasX-g.pos[0],a.canvasY-g.pos[1]],B=this.processNodeWidgets(g,this.graph_mouse,a);B&&(S=!0,this.node_widget=[g,B]),this.allow_interaction&&E&&this.selected_nodes[g.id]&&((h=g.onDblClick)==null||h.call(g,a,O,this),this.processNodeDblClicked(g),S=!0),g.onMouseDown&&g.onMouseDown(a,O,this)?S=!0:(g.subgraph&&!g.skip_subgraph_button&&!g.flags.collapsed&&O[0]>g.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&O[1]<0&&setTimeout(()=>{this.openSubgraph(g.subgraph)},10),this.live_mode&&(N=!0,S=!0)),S?g.is_selected||this.processNodeSelected(g,a):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=g),this.processNodeSelected(g,a)),this.dirty_canvas=!0}}else if(!L){if(!this.read_only)for(let M=0;M<this.visible_links.length;++M){var $=this.visible_links[M],et=$._pos;if(!(!et||a.canvasX<et[0]-4||a.canvasX>et[0]+4||a.canvasY<et[1]-4||a.canvasY>et[1]+4)){this.showLinkMenu($,a),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(a.canvasX,a.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){a.ctrlKey&&(this.dragging_rectangle=null);var lt=LiteGraph.distance([a.canvasX,a.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);lt*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}E&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(a),a.preventDefault(),a.stopPropagation()),(u=LiteGraph.debug)==null||u.call(LiteGraph,"DEBUG canvas click is_double_click,this.allow_searchbox",E,this.allow_searchbox),N=!0}!L&&N&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(a.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(g&&this.allow_interaction&&!L&&!this.read_only&&!this.connecting_node&&!g.flags.collapsed&&!this.live_mode){var ht=!1,V=!1,F=!1;if(g.outputs)for(let M=0,q=g.outputs.length;M<q;++M){var U=g.outputs[M];let it=g.getConnectionPos(!1,M);if(LiteGraph.isInsideRectangle(a.canvasX,a.canvasY,it[0]-15,it[1]-10,30,20)){ht=U,V=M,F=!0;break}}if(g.inputs)for(let M=0,q=g.inputs.length;M<q;++M){var I=g.inputs[M];let W=g.getConnectionPos(!0,M);if(LiteGraph.isInsideRectangle(a.canvasX,a.canvasY,W[0]-15,W[1]-10,30,20)){ht=I,V=M,F=!1;break}}if(ht&&V!==!1){var z=.5-(V+1)/(F?g.outputs.length:g.inputs.length),Z=g.getBounding(),Ct=[F?Z[0]+Z[2]:Z[0],a.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:F?g:null,slotFrom:F?V:null,nodeTo:F?null:g,slotTo:F?null:V,position:Ct,nodeType:"AUTO",posAdd:[F?30:-30,-z*130],posSizeFix:[F?0:-1,0]})}}}else!L&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(a.which==3||LiteGraph.two_fingers_opens_menu&&this.userInput_isNotPrimary)&&this.allow_interaction&&!L&&!this.read_only&&(g&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[g.id]||a.shiftKey||a.ctrlKey||a.metaKey)?this.selected_nodes[g.id]||this.selectNodes([g],!0):this.selectNodes([g])),this.processContextMenu(g,a));return this.last_mouse[0]=a.clientX,this.last_mouse[1]=a.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!d.document.activeElement||d.document.activeElement.nodeName.toLowerCase()!="input"&&d.document.activeElement.nodeName.toLowerCase()!="textarea")&&a.preventDefault(),a.stopPropagation(),(c=this.onMouseDown)==null||c.call(this,a),!1}}}}processMouseMove(a){var t,s;if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){__LGraphCanvas.active_canvas=this,this.adjustMouseEvent(a);var n=[a.clientX,a.clientY];this.mouse[0]=n[0],this.mouse[1]=n[1];var o=[n[0]-this.last_mouse[0],n[1]-this.last_mouse[1]];if(this.last_mouse=n,this.graph_mouse[0]=a.canvasX,this.graph_mouse[1]=a.canvasY,this.block_click)return a.preventDefault(),!1;a.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,a,this.node_widget[1]),this.dirty_canvas=!0);var l=this.graph.getNodeOnPos(a.canvasX,a.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=a.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=a.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[a.canvasX-this.selected_group.pos[0],a.canvasY-this.selected_group.pos[1]];else{var p=o[0]/this.ds.scale,h=o[1]/this.ds.scale;this.selected_group.move(p,h,a.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=o[0]/this.ds.scale,this.ds.offset[1]+=o[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||l&&l.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(let _=0,g=this.graph._nodes.length;_<g;++_)this.graph._nodes[_].mouseOver&&l!=this.graph._nodes[_]&&(this.graph._nodes[_].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(a),this.node_over=null,this.dirty_canvas=!0);if(l){if(l.redraw_on_mouse&&(this.dirty_canvas=!0),l.mouseOver||(l.mouseOver=!0,this.node_over=l,this.dirty_canvas=!0,(t=l.onMouseEnter)==null||t.call(l,a)),(s=l.onMouseMove)==null||s.call(l,a,[a.canvasX-l.pos[0],a.canvasY-l.pos[1]],this),this.connecting_node){let _;if(this.connecting_output){if(_=this._highlight_input||[0,0],!this.isOverNodeBox(l,a.canvasX,a.canvasY)){let g=this.isOverNodeInput(l,a.canvasX,a.canvasY,_);if(g!=-1&&l.inputs[g]){let L=l.inputs[g].type;LiteGraph.isValidConnection(this.connecting_output.type,L)&&(this._highlight_input=_,this._highlight_input_slot=l.inputs[g])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input&&(_=this._highlight_output||[0,0],this.isOverNodeBox(l,a.canvasX,a.canvasY))){let g=this.isOverNodeOutput(l,a.canvasX,a.canvasY,_);if(g!=-1&&l.outputs[g]){let L=l.outputs[g].type;LiteGraph.isValidConnection(this.connecting_input.type,L)&&(this._highlight_output=_)}else this._highlight_output=null}}this.canvas&&(LiteGraph.isInsideRectangle(a.canvasX,a.canvasY,l.pos[0]+l.size[0]-5,l.pos[1]+l.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var u=null;for(let _=0;_<this.visible_links.length;++_){var c=this.visible_links[_],d=c._pos;if(!(!d||a.canvasX<d[0]-4||a.canvasX>d[0]+4||a.canvasY<d[1]-4||a.canvasY>d[1]+4)){u=c;break}}u!=this.over_link_center&&(this.over_link_center=u,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=l&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(a,[a.canvasX-this.node_capturing_input.pos[0],a.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(let _ in this.selected_nodes){let g=this.selected_nodes[_];g.pos[0]+=o[0]/this.ds.scale,g.pos[1]+=o[1]/this.ds.scale,g.is_selected||this.processNodeSelected(g,a)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var f=[a.canvasX-this.resizing_node.pos[0],a.canvasY-this.resizing_node.pos[1]],b=this.resizing_node.computeSize();f[0]=Math.max(b[0],f[0]),f[1]=Math.max(b[1],f[1]),this.resizing_node.setSize(f),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return a.preventDefault(),!1}}processMouseUp(a){var t,s=a.isPrimary===void 0||a.isPrimary;if(!s)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var n=this.getCanvasWindow(),o=n.document;__LGraphCanvas.active_canvas=this,this.options.skip_events||(o.removeEventListener("pointermove",this._mousemove_callback,!0),this.canvas.addEventListener("pointermove",this._mousemove_callback,!0),o.removeEventListener("pointerup",this._mouseup_callback,!0)),this.adjustMouseEvent(a);var l=LiteGraph.getTime();if(a.click_time=l-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),a.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,a),this.node_widget=null,this.selected_group){var p=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),h=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(p,h,a.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var u=this.graph.getNodeOnPos(a.canvasX,a.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var c=this.graph._nodes,d=new Float32Array(4),f=Math.abs(this.dragging_rectangle[2]),b=Math.abs(this.dragging_rectangle[3]),_=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-f:this.dragging_rectangle[0],g=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-b:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=_,this.dragging_rectangle[1]=g,this.dragging_rectangle[2]=f,this.dragging_rectangle[3]=b,!u||f>10&&b>10){var L=[];for(let C=0;C<c.length;++C){var G=c[C];G.getBounding(d),LiteGraph.overlapBounding(this.dragging_rectangle,d)&&L.push(G)}L.length&&this.selectNodes(L,a.shiftKey)}else this.selectNodes([u],a.shiftKey||a.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var T=this.connecting_output||this.connecting_input,E=T.type;if(u=this.graph.getNodeOnPos(a.canvasX,a.canvasY,this.visible_nodes),u){let C;this.connecting_output?(C=this.isOverNodeInput(u,a.canvasX,a.canvasY),C!=-1?this.connecting_node.connect(this.connecting_slot,u,C):this.connecting_node.connectByType(this.connecting_slot,u,E)):this.connecting_input&&(C=this.isOverNodeOutput(u,a.canvasX,a.canvasY),C!=-1?u.connect(C,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,u,E))}else LiteGraph.release_link_on_empty_shows_menu&&(a.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(a,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(a,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:a}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:a}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null):this.node_dragged?(u=this.node_dragged,u&&a.click_time<300&&LiteGraph.isInsideRectangle(a.canvasX,a.canvasY,u.pos[0],u.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&u.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),(t=this.onNodeMoved)==null||t.call(this,this.node_dragged),this.graph.onGraphChanged({action:"nodeDrag",doSave:!0}),this.graph.afterChange(this.node_dragged),this.node_dragged=null):(u=this.graph.getNodeOnPos(a.canvasX,a.canvasY,this.visible_nodes),!u&&a.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(a,[a.canvasX-this.node_over.pos[0],a.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(a,[a.canvasX-this.node_capturing_input.pos[0],a.canvasY-this.node_capturing_input.pos[1]]))}else a.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):a.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return s&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),a.stopPropagation(),a.preventDefault(),!1}}isOverNodeBox(a,t,s){var n=LiteGraph.NODE_TITLE_HEIGHT;return!!LiteGraph.isInsideRectangle(t,s,a.pos[0]+2,a.pos[1]+2-n,n-4,n-4)}isOverNodeInput(a,t,s,n){if(a.inputs)for(let p=0,h=a.inputs.length;p<h;++p){var o=a.getConnectionPos(!0,p),l=!1;if(a.horizontal?l=LiteGraph.isInsideRectangle(t,s,o[0]-5,o[1]-10,10,20):l=LiteGraph.isInsideRectangle(t,s,o[0]-10,o[1]-5,40,10),l)return n&&(n[0]=o[0],n[1]=o[1]),p}return-1}isOverNodeOutput(a,t,s,n){if(a.outputs)for(let p=0,h=a.outputs.length;p<h;++p){var o=a.getConnectionPos(!1,p),l=!1;if(a.horizontal?l=LiteGraph.isInsideRectangle(t,s,o[0]-5,o[1]-10,10,20):l=LiteGraph.isInsideRectangle(t,s,o[0]-10,o[1]-5,40,10),l)return n&&(n[0]=o[0],n[1]=o[1]),p}return-1}copyToClipboard(){var a,t={nodes:[],links:[]},s=0,n=[];for(let c in this.selected_nodes){let d=this.selected_nodes[c];d.clonable!==!1&&(d._relative_id=s,n.push(d),s+=1)}for(let c=0;c<n.length;++c){let d=n[c];if(d.clonable!==!1){var o=d.clone();if(!o){(a=LiteGraph.warn)==null||a.call(LiteGraph,"node type not found: "+d.type);continue}if(t.nodes.push(o.serialize()),d.inputs&&d.inputs.length)for(var l=0;l<d.inputs.length;++l){var p=d.inputs[l];if(!(!p||p.link==null)){var h=this.graph.links[p.link];if(h){var u=this.graph.getNodeById(h.origin_id);u&&t.links.push([u._relative_id,h.origin_slot,d._relative_id,h.target_slot,u.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))}pasteFromClipboard(a=!1){var t;if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&a)){var s=localStorage.getItem("litegrapheditor_clipboard");if(s){this.graph.beforeChange();var n=JSON.parse(s),o=!1,l=!1;for(let g=0;g<n.nodes.length;++g)o?(o[0]>n.nodes[g].pos[0]&&(o[0]=n.nodes[g].pos[0],l[0]=g),o[1]>n.nodes[g].pos[1]&&(o[1]=n.nodes[g].pos[1],l[1]=g)):(o=[n.nodes[g].pos[0],n.nodes[g].pos[1]],l=[g,g]);var p=[];for(let g=0;g<n.nodes.length;++g){var h=n.nodes[g],u=LiteGraph.createNode(h.type);u&&(u.configure(h),u.pos[0]+=this.graph_mouse[0]-o[0],u.pos[1]+=this.graph_mouse[1]-o[1],this.graph.add(u,{doProcessChange:!1}),p.push(u))}for(let g=0;g<n.links.length;++g){var c=n.links[g],d=void 0,f=c[0];if(f!=null)d=p[f];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&a){var b=c[4];b&&(d=this.graph.getNodeById(b))}var _=p[c[2]];d&&_?d.connect(c[1],_,c[3]):(t=LiteGraph.warn)==null||t.call(LiteGraph,"Warning, nodes missing on pasting")}this.selectNodes(p),this.graph.onGraphChanged({action:"paste",doSave:!0}),this.graph.afterChange()}}}checkDropItem(a){var t;if(a.dataTransfer.files.length){var s=a.dataTransfer.files[0],n=__LGraphCanvas.getFileExtension(s.name).toLowerCase(),o=LiteGraph.node_types_by_file_extension[n];if(o){this.graph.beforeChange();var l=LiteGraph.createNode(o.type);l.pos=[a.canvasX,a.canvasY],this.graph.add(l,!1,{doProcessChange:!1}),(t=l.onDropFile)==null||t.call(l,s),this.graph.onGraphChanged({action:"fileDrop",doSave:!0}),this.graph.afterChange()}}}processNodeDblClicked(a){var t;this.onShowNodePanel?this.onShowNodePanel(a):this.showShowNodePanel(a),(t=this.onNodeDblClicked)==null||t.call(this,a),this.setDirty(!0)}processNodeSelected(a,t){var s;this.selectNode(a,t&&(t.shiftKey||t.ctrlKey||this.multi_select)),(s=this.onNodeSelected)==null||s.call(this,a)}selectNode(a,t){a==null?this.deselectAllNodes():this.selectNodes([a],t)}selectNodes(a,t){var s;t||this.deselectAllNodes(),a=a||this.graph._nodes,typeof a=="string"&&(a=[a]),Object.values(a).forEach(n=>{var o,l,p;if(n.is_selected){this.deselectNode(n);return}n.is_selected=!0,this.selected_nodes[n.id]=n,(o=n.onSelected)==null||o.call(n),(l=n.inputs)==null||l.forEach(h=>{this.highlighted_links[h.link]=!0}),(p=n.outputs)==null||p.forEach(h=>{var u;(u=h.links)==null||u.forEach(c=>{this.highlighted_links[c]=!0})})}),(s=this.onSelectionChange)==null||s.call(this,this.selected_nodes),this.setDirty(!0)}deselectNode(a){var t,s,n,o;a.is_selected&&((t=a.onDeselected)==null||t.call(a),a.is_selected=!1,(s=this.onNodeDeselected)==null||s.call(this,a),(n=a.inputs)==null||n.forEach(l=>{var p;(p=this.highlighted_links)==null||delete p[l.link]}),(o=a.outputs)==null||o.forEach(l=>{var p;(p=l.links)==null||p.forEach(h=>{var u;return(u=this.highlighted_links)==null?!0:delete u[h]})}))}deselectAllNodes(){var a,t;this.graph&&((a=this.graph._nodes)==null||a.forEach(s=>{var n,o;s.is_selected&&((n=s.onDeselected)==null||n.call(s),s.is_selected=!1,(o=this.onNodeDeselected)==null||o.call(this,s))}),this.selected_nodes={},this.current_node=null,this.highlighted_links={},(t=this.onSelectionChange)==null||t.call(this,this.selected_nodes),this.setDirty(!0))}deleteSelectedNodes(){this.graph.beforeChange();for(let l in this.selected_nodes){var a=this.selected_nodes[l];if(!a.block_delete){if(a.inputs&&a.inputs.length&&a.outputs&&a.outputs.length&&LiteGraph.isValidConnection(a.inputs[0].type,a.outputs[0].type)&&a.inputs[0].link&&a.outputs[0].links&&a.outputs[0].links.length){var t=a.graph.links[a.inputs[0].link],s=a.graph.links[a.outputs[0].links[0]],n=a.getInputNode(0),o=a.getOutputNodes(0)[0];n&&o&&n.connect(t.origin_slot,o,s.target_slot)}this.graph.remove(a),this.onNodeDeselected&&this.onNodeDeselected(a)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()}centerOnNode(a){this.ds.offset[0]=-a.pos[0]-a.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-a.pos[1]-a.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)}adjustMouseEvent(a){var t=0,s=0;if(this.canvas){var n=this.canvas.getBoundingClientRect();t=a.clientX-n.left,s=a.clientY-n.top}else t=a.clientX,s=a.clientY;this.last_mouse_position[0]=t,this.last_mouse_position[1]=s,a.canvasX=t/this.ds.scale-this.ds.offset[0],a.canvasY=s/this.ds.scale-this.ds.offset[1]}setZoom(a,t){this.ds.changeScale(a,t),this.dirty_canvas=!0,this.dirty_bgcanvas=!0}convertOffsetToCanvas(a,t){return this.ds.convertOffsetToCanvas(a,t)}convertCanvasToOffset(a,t){return this.ds.convertCanvasToOffset(a,t)}convertEventToCanvasOffset(a){var t=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([a.clientX-t.left,a.clientY-t.top])}bringToFront(a){var t=this.graph._nodes.indexOf(a);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.push(a))}sendToBack(a){var t=this.graph._nodes.indexOf(a);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.unshift(a))}computeVisibleNodes(a,t){var s=t||[];s.length=0,a=a||this.graph._nodes;for(var n=0,o=a.length;n<o;++n){var l=a[n];this.live_mode&&!l.onDrawBackground&&!l.onDrawForeground||LiteGraph.overlapBounding(this.visible_area,l.getBounding(temp,!0))&&s.push(l)}return s}draw(a,t){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var s=LiteGraph.getTime();this.render_time=(s-this.last_draw_time)*.001,this.last_draw_time=s,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||t||this.always_render_background||this.graph&&this.graph._last_trigger_time&&s-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas();var n=this.dirty_canvas||a;if(n&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1,this.ds.scale<.7){if(n){var o=this.low_quality_rendering_threshold;const l=45;this.fps<l?(this.low_quality_rendering_counter+=l/this.fps,this.low_quality_rendering_counter=Math.min(this.low_quality_rendering_counter,2*o)):(this.low_quality_rendering_counter-=this.fps/l*.01,this.low_quality_rendering_counter=Math.max(this.low_quality_rendering_counter,0))}}else this.low_quality_rendering_counter=0}}drawFrontCanvas(){var a,t,s,n,o;this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var l=this.ctx;if(l){var p=this.canvas;l.start2D&&!this.viewport&&(l.start2D(),l.restore(),l.setTransform(1,0,0,1,0,0));var h=this.viewport||this.dirty_area;if(h&&(l.save(),l.beginPath(),l.rect(h[0],h[1],h[2],h[3]),l.clip()),this.clear_background&&(h?l.clearRect(h[0],h[1],h[2],h[3]):l.clearRect(0,0,p.width,p.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():l.drawImage(this.bgcanvas,0,0),(a=this.onRender)==null||a.call(this,p,l),this.show_info&&this.renderInfo(l,h?h[0]:0,h?h[1]:0),this.graph){l.save(),this.ds.toCanvasContext(l);var u=this.computeVisibleNodes(null,this.visible_nodes);for(let L=0;L<u.length;++L){let G=u[L];l.save(),l.translate(G.pos[0],G.pos[1]),this.drawNode(G,l),l.restore()}if(this.render_execution_order&&this.drawExecutionOrder(l),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(l)),this.connecting_pos!=null){l.lineWidth=this.connections_width;var c=null,d=this.connecting_output||this.connecting_input,f=d.type,b=d.dir;b==null&&(this.connecting_output?b=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:b=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var _=d.shape;switch(f){case LiteGraph.EVENT:case LiteGraph.ACTION:c=LiteGraph.EVENT_LINK_COLOR;break;default:c=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(l,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,c,b,LiteGraph.CENTER),l.beginPath(),f===LiteGraph.EVENT||f===LiteGraph.ACTION||_===LiteGraph.BOX_SHAPE?(l.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),l.fill(),l.beginPath(),l.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):_===LiteGraph.ARROW_SHAPE?(l.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),l.closePath()):(l.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),l.fill(),l.beginPath(),l.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),l.fill(),l.fillStyle="#ffcc00",this._highlight_input){l.beginPath();var g=this._highlight_input_slot.shape;g===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),l.closePath()):l.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),l.fill()}this._highlight_output&&(l.beginPath(),g===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),l.closePath()):l.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),l.fill())}this.dragging_rectangle&&(l.strokeStyle="#FFF",l.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(l,this.over_link_center):(t=this.onDrawLinkTooltip)==null||t.call(this,l,null),(s=this.onDrawForeground)==null||s.call(this,l,this.visible_rect),l.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(l),(n=this.onDrawOverlay)==null||n.call(this,l),h&&l.restore(),(o=l.finish2D)==null||o.call(l)}}drawSubgraphPanel(a){var t,s=this.graph;if(s){var n=s._subgraph_node;if(!n){(t=LiteGraph.warn)==null||t.call(LiteGraph,"subgraph without subnode");return}this.drawSubgraphPanelLeft(s,n,a),this.drawSubgraphPanelRight(s,n,a)}}drawSubgraphPanelLeft(a,t,s){var n,o=t.inputs?t.inputs.length:0,l=200,p=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(10,10,l,(o+1)*p+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left",s.fillText("Graph Inputs",20,34),this.drawButton(l-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var h=50;if(s.font="14px Arial",t.inputs)for(var u=0;u<t.inputs.length;++u){var c=t.inputs[u];if(!c.not_subgraph_input){if(this.drawButton(20,h+2,l-20,p-2)){var d=t.constructor.input_node_type||"graph/input";this.graph.beforeChange();var f=LiteGraph.createNode(d);f?(a.add(f,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([f]),this.node_dragged=f,this.dragging_canvas=!1,f.setProperty("name",c.name),f.setProperty("type",c.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(n=LiteGraph.error)==null||n.call(LiteGraph,"graph input node not found:",d)}s.fillStyle="#9C9",s.beginPath(),s.arc(l-16,h+p*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(c.name,30,h+p*.75),s.fillStyle="#777",s.fillText(c.type,130,h+p*.75),h+=p}}this.drawButton(20,h+2,l-20,p-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(t)}drawSubgraphPanelRight(a,t,s){var n,o=t.outputs?t.outputs.length:0,l=this.bgcanvas.width,p=200,h=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(l-p-10,10,p,(o+1)*h+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left";const u="Graph Outputs";var c=s.measureText(u).width;if(s.fillText(u,l-c-20,34),this.drawButton(l-p,20,20,20,"X","#151515")){this.closeSubgraph();return}var d=50;if(s.font="14px Arial",t.outputs)for(var f=0;f<t.outputs.length;++f){var b=t.outputs[f];if(!b.not_subgraph_input){if(this.drawButton(l-p,d+2,p-20,h-2)){var _=t.constructor.output_node_type||"graph/output";this.graph.beforeChange();var g=LiteGraph.createNode(_);g?(a.add(g,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([g]),this.node_dragged=g,this.dragging_canvas=!1,g.setProperty("name",b.name),g.setProperty("type",b.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(n=LiteGraph.error)==null||n.call(LiteGraph,"graph input node not found:",_)}s.fillStyle="#9C9",s.beginPath(),s.arc(l-p+16,d+h*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(b.name,l-p+30,d+h*.75),s.fillStyle="#777",s.fillText(b.type,l-p+130,d+h*.75),d+=h}}this.drawButton(l-p,d+2,p-20,h-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(t)}drawButton(a,t,s,n,o,l,p,h){var u=this.ctx;l=l||LiteGraph.NODE_DEFAULT_COLOR,p=p||"#555",h=h||LiteGraph.NODE_TEXT_COLOR;var c=this.ds.convertOffsetToCanvas(this.graph_mouse),d=LiteGraph.isInsideRectangle(c[0],c[1],a,t,s,n);if(c=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,c){var f=this.canvas.getBoundingClientRect();c[0]-=f.left,c[1]-=f.top}var b=c&&LiteGraph.isInsideRectangle(c[0],c[1],a,t,s,n);u.fillStyle=d?p:l,b&&(u.fillStyle="#AAA"),u.beginPath(),u.roundRect(a,t,s,n,[4]),u.fill(),o!=null&&o.constructor==String&&(u.fillStyle=h,u.textAlign="center",u.font=(n*.65|0)+"px Arial",u.fillText(o,a+s*.5,t+n*.75),u.textAlign="left");var _=b&&!this.block_click;return b&&this.blockClick(),_}isAreaClicked(a,t,s,n,o){var l=this.last_click_position,p=l&&LiteGraph.isInsideRectangle(l[0],l[1],a,t,s,n),h=p&&!this.block_click;return p&&o&&this.blockClick(),h}renderInfo(a,t,s){t=t||10,s=s||this.canvas.height-80,a.save(),a.translate(t,s),a.font="10px Arial",a.fillStyle="#888",a.textAlign="left",this.graph?(a.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),a.fillText("I: "+this.graph.iteration,5,26),a.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),a.fillText("V: "+this.graph._version,5,52),a.fillText("FPS:"+this.fps.toFixed(2),5,65)):a.fillText("No graph selected",5,13),a.restore()}drawBackCanvas(){var a,t,s,n=this.bgcanvas;this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var o=this.bgctx;o.start&&o.start();var l=this.viewport||[0,0,o.canvas.width,o.canvas.height];if(this.clear_background&&o.clearRect(l[0],l[1],l[2],l[3]),this._graph_stack&&this._graph_stack.length){o.save();var p=this.graph._subgraph_node;o.strokeStyle=p.bgcolor,o.lineWidth=10,o.strokeRect(1,1,n.width-2,n.height-2),o.lineWidth=1,o.font="40px Arial",o.textAlign="center",o.fillStyle=p.bgcolor||"#AAA";let d="";this._graph_stack.slice(1).forEach((f,b)=>{d+=`${f._subgraph_node.getTitle()} ${b<this._graph_stack.length-2?">> ":""}`}),o.fillText(d+p.getTitle(),n.width*.5,40),o.restore()}var h=!1;if(this.onRenderBackground&&(h=this.onRenderBackground(n,o)),this.viewport||(o.restore(),o.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(o.save(),this.ds.toCanvasContext(o),this.ds.scale<1.5&&!h&&this.clear_background_color&&(o.fillStyle=this.clear_background_color,o.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!h){if(this.zoom_modify_alpha?o.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:o.globalAlpha=this.editor_alpha,o.imageSmoothingEnabled=o.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var u=this;this._bg_img.onload=function(){u.draw(!0,!0)}}var c=null;this._pattern==null&&this._bg_img.width>0?(c=o.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=c):c=this._pattern,c&&(o.fillStyle=c,o.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),o.fillStyle="transparent"),o.globalAlpha=1,o.imageSmoothingEnabled=o.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(n,o),(a=this.onDrawBackground)==null||a.call(this,o,this.visible_area),this.onBackgroundRender&&((t=LiteGraph.error)==null||t.call(LiteGraph,"WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(o.strokeStyle="#235",o.strokeRect(0,0,n.width,n.height)),this.render_connections_shadows?(o.shadowColor="#000",o.shadowOffsetX=0,o.shadowOffsetY=0,o.shadowBlur=6):o.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(o),o.shadowColor="rgba(0,0,0,0)",o.restore()}(s=o.finish)==null||s.call(o),this.dirty_bgcanvas=!1,this.dirty_canvas=!0}drawNode(a,t){var s,n,o;this.current_node=a;var l=a.color||a.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,p=a.bgcolor||a.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR,h=this.ds.scale<.6;if(this.live_mode){a.flags.collapsed||(t.shadowColor="transparent",(s=a.onDrawForeground)==null||s.call(a,t,this,this.canvas));return}var u=this.editor_alpha;if(t.globalAlpha=u,this.render_shadows&&!h?(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,t.shadowOffsetX=2*this.ds.scale,t.shadowOffsetY=2*this.ds.scale,t.shadowBlur=3*this.ds.scale):t.shadowColor="transparent",!(a.flags.collapsed&&(n=a.onDrawCollapsed)!=null&&n.call(a,t,this))){var c=a._shape||LiteGraph.BOX_SHAPE,d=temp_vec2;temp_vec2.set(a.size);var f=a.horizontal;if(a.flags.collapsed){t.font=this.inner_text_font;var b=a.getTitle?a.getTitle():a.title;b!=null&&(a._collapsed_width=Math.min(a.size[0],t.measureText(b).width+LiteGraph.NODE_TITLE_HEIGHT*2),d[0]=a._collapsed_width,d[1]=0)}(a.clip_area||this.clip_all_nodes)&&(t.save(),t.beginPath(),c==LiteGraph.BOX_SHAPE?t.rect(0,0,d[0],d[1]):c==LiteGraph.ROUND_SHAPE?t.roundRect(0,0,d[0],d[1],[10]):c==LiteGraph.CIRCLE_SHAPE&&t.arc(d[0]*.5,d[1]*.5,d[0]*.5,0,Math.PI*2),t.clip()),a.has_errors&&(p="red"),this.drawNodeShape(a,t,d,l,p,a.is_selected,a.mouseOver),t.shadowColor="transparent",(o=a.onDrawForeground)==null||o.call(a,t,this,this.canvas),LiteGraph.show_node_tooltip&&a.mouseOver&&a.is_selected&&(!this.selected_nodes||Object.keys(this.selected_nodes).length<=1)&&this.drawNodeTooltip(t,a),t.textAlign=f?"center":"left",t.font=this.inner_text_font;var _=!this.lowQualityRenderingRequired(.6),g=this.connecting_output,L=this.connecting_input;t.lineWidth=1;var G=0,T=new Float32Array(2),E;if(a.flags.collapsed){if(this.render_collapsed_slots){var C=null,I=null;if(a.inputs)for(let P=0;P<a.inputs.length;P++){var D=a.inputs[P];if(D.link!=null){C=D;break}}if(a.outputs)for(let P=0;P<a.outputs.length;P++){var D=a.outputs[P];!D.links||!D.links.length||(I=D)}if(C){let P=0,N=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(P=a._collapsed_width*.5,N=-LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#686",t.beginPath(),D.type===LiteGraph.EVENT||D.type===LiteGraph.ACTION||D.shape===LiteGraph.BOX_SHAPE?t.rect(P-7+.5,N-4,14,8):D.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(P+8,N),t.lineTo(P+-4,N-4),t.lineTo(P+-4,N+4),t.closePath()):t.arc(P,N,4,0,Math.PI*2),t.fill()}if(I){let P=a._collapsed_width,N=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(P=a._collapsed_width*.5,N=0),t.fillStyle="#686",t.strokeStyle="black",t.beginPath(),D.type===LiteGraph.EVENT||D.type===LiteGraph.ACTION||D.shape===LiteGraph.BOX_SHAPE?t.rect(P-7+.5,N-4,14,8):D.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(P+6,N),t.lineTo(P-6,N-4),t.lineTo(P-6,N+4),t.closePath()):t.arc(P,N,4,0,Math.PI*2),t.fill()}}}else{if(a.inputs)for(let P=0;P<a.inputs.length;P++){let N=a.inputs[P],A=N.type,S=N.shape;t.globalAlpha=u,this.connecting_output&&!LiteGraph.isValidConnection(N.type,g.type)&&(t.globalAlpha=.4*u),t.fillStyle=N.link!=null?N.color_on||this.default_connection_color_byType[A]||this.default_connection_color.input_on:N.color_off||this.default_connection_color_byTypeOff[A]||this.default_connection_color_byType[A]||this.default_connection_color.input_off;let O=a.getConnectionPos(!0,P,T);if(O[0]-=a.pos[0],O[1]-=a.pos[1],G<O[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(G=O[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.beginPath(),A=="array"?S=LiteGraph.GRID_SHAPE:N.name=="onTrigger"||N.name=="onExecuted"?S=LiteGraph.ARROW_SHAPE:(A===LiteGraph.EVENT||A===LiteGraph.ACTION)&&(S=LiteGraph.BOX_SHAPE),E=!0,S===LiteGraph.BOX_SHAPE?f?t.rect(O[0]-5+.5,O[1]-8+.5,10,14):t.rect(O[0]-6+.5,O[1]-5+.5,14,10):S===LiteGraph.ARROW_SHAPE?(t.moveTo(O[0]+8,O[1]+.5),t.lineTo(O[0]-4,O[1]+6+.5),t.lineTo(O[0]-4,O[1]-6+.5),t.closePath()):S===LiteGraph.GRID_SHAPE?(t.rect(O[0]-4,O[1]-4,2,2),t.rect(O[0]-1,O[1]-4,2,2),t.rect(O[0]+2,O[1]-4,2,2),t.rect(O[0]-4,O[1]-1,2,2),t.rect(O[0]-1,O[1]-1,2,2),t.rect(O[0]+2,O[1]-1,2,2),t.rect(O[0]-4,O[1]+2,2,2),t.rect(O[0]-1,O[1]+2,2,2),t.rect(O[0]+2,O[1]+2,2,2),E=!1):h?t.rect(O[0]-4,O[1]-4,8,8):t.arc(O[0],O[1],4,0,Math.PI*2),t.fill(),_&&!(N.name=="onTrigger"||N.name=="onExecuted")){let B=N.label!=null?N.label:N.name;B&&(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||N.dir==LiteGraph.UP?t.fillText(B,O[0],O[1]-10):t.fillText(B,O[0]+10,O[1]+5))}}if(t.textAlign=f?"center":"right",t.strokeStyle="black",a.outputs)for(let P=0;P<a.outputs.length;P++){let N=a.outputs[P],A=N.type,S=N.shape;this.connecting_input&&!LiteGraph.isValidConnection(A,L.type)&&(t.globalAlpha=.4*u);let O=a.getConnectionPos(!1,P,T);if(O[0]-=a.pos[0],O[1]-=a.pos[1],G<O[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(G=O[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.fillStyle=N.links&&N.links.length?N.color_on||this.default_connection_color_byType[A]||this.default_connection_color.output_on:N.color_off||this.default_connection_color_byTypeOff[A]||this.default_connection_color_byType[A]||this.default_connection_color.output_off,t.beginPath(),A=="array"?S=LiteGraph.GRID_SHAPE:N.name=="onTrigger"||N.name=="onExecuted"?S=LiteGraph.ARROW_SHAPE:(A===LiteGraph.EVENT||A===LiteGraph.ACTION)&&(S=LiteGraph.BOX_SHAPE),E=!0,S===LiteGraph.BOX_SHAPE?f?t.rect(O[0]-5+.5,O[1]-8+.5,10,14):t.rect(O[0]-6+.5,O[1]-5+.5,14,10):S===LiteGraph.ARROW_SHAPE?(t.moveTo(O[0]+8,O[1]+.5),t.lineTo(O[0]-4,O[1]+6+.5),t.lineTo(O[0]-4,O[1]-6+.5),t.closePath()):S===LiteGraph.GRID_SHAPE?(t.rect(O[0]-4,O[1]-4,2,2),t.rect(O[0]-1,O[1]-4,2,2),t.rect(O[0]+2,O[1]-4,2,2),t.rect(O[0]-4,O[1]-1,2,2),t.rect(O[0]-1,O[1]-1,2,2),t.rect(O[0]+2,O[1]-1,2,2),t.rect(O[0]-4,O[1]+2,2,2),t.rect(O[0]-1,O[1]+2,2,2),t.rect(O[0]+2,O[1]+2,2,2),E=!1):h?t.rect(O[0]-4,O[1]-4,8,8):t.arc(O[0],O[1],4,0,Math.PI*2),t.fill(),!h&&E&&t.stroke(),_&&!(N.name=="onTrigger"||N.name=="onExecuted")){let B=N.label!=null?N.label:N.name;B&&(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||N.dir==LiteGraph.DOWN?t.fillText(B,O[0],O[1]-8):t.fillText(B,O[0]-10,O[1]+5))}}if(t.textAlign="left",t.globalAlpha=1,a.widgets){var R=G;(f||a.widgets_up)&&(R=2),a.widgets_start_y!=null&&(R=a.widgets_start_y),this.drawNodeWidgets(a,R,t,this.node_widget&&this.node_widget[0]==a?this.node_widget[1]:null)}}(a.clip_area||this.clip_all_nodes)&&t.restore(),t.globalAlpha=1}}drawNodeTooltip(a,t){var s;if(!t||!a){(s=LiteGraph.warn)==null||s.call(LiteGraph,"drawNodeTooltip: invalid node or ctx",t,a);return}var n=t.properties.tooltip!=null?t.properties.tooltip:"";if((!n||n=="")&&LiteGraph.show_node_tooltip_use_descr_property&&t.constructor.desc&&(n=t.constructor.desc),n=(n+"").trim(),!(!n||n=="")){var o=[0,-LiteGraph.NODE_TITLE_HEIGHT],l=t.flags.collapsed?[LiteGraph.NODE_COLLAPSED_WIDTH,LiteGraph.NODE_TITLE_HEIGHT]:t.size;a.font="14px Courier New",a.measureText(n);var p=Math.max(t.size[0],160)+20,h=t.ttip_oTMultiRet?t.ttip_oTMultiRet.height+15:21;a.globalAlpha=.7*this.editor_alpha,a.shadowColor=t.ttip_oTMultiRet?"black":"transparent",a.shadowOffsetX=2,a.shadowOffsetY=2,a.shadowBlur=3,a.fillStyle=t.ttip_oTMultiRet?"#454":"transparent",a.beginPath(),a.roundRect(o[0]-p*.5+l[0]/2,o[1]-15-h,p,h,[3]),a.moveTo(o[0]-10+l[0]/2,o[1]-15),a.lineTo(o[0]+10+l[0]/2,o[1]-15),a.lineTo(o[0]+l[0]/2,o[1]-5),a.fill(),a.shadowColor="transparent",a.textAlign="center",a.fillStyle=t.ttip_oTMultiRet?"#CEC":"transparent",a.globalAlpha=this.editor_alpha;var u=LiteGraph.canvasFillTextMultiline(a,n,o[0]+l[0]/2,o[1]-h,p,14);t.ttip_oTMultiRet=u,a.closePath()}}drawLinkTooltip(a,t){var s,n=t._pos;if(a.fillStyle="black",a.beginPath(),a.arc(n[0],n[1],3,0,Math.PI*2),a.fill(),t.data!=null&&!((s=this.onDrawLinkTooltip)!=null&&s.call(this,a,t,this))){var o=t.data,l=null;if(o.constructor===Number?l=o.toFixed(2):o.constructor===String?l='"'+o+'"':o.constructor===Boolean?l=String(o):o.toToolTip?l=o.toToolTip():l="["+o.constructor.name+"]",l!=null){l=l.substr(0,30),a.font="14px Courier New";var p=a.measureText(l),h=p.width+20,u=24;a.shadowColor="black",a.shadowOffsetX=2,a.shadowOffsetY=2,a.shadowBlur=3,a.fillStyle="#454",a.beginPath(),a.roundRect(n[0]-h*.5,n[1]-15-u,h,u,[3]),a.moveTo(n[0]-10,n[1]-15),a.lineTo(n[0]+10,n[1]-15),a.lineTo(n[0],n[1]-5),a.fill(),a.shadowColor="transparent",a.textAlign="center",a.fillStyle="#CEC",a.fillText(l,n[0],n[1]-15-u*.3)}}}drawNodeShape(a,t,s,n,o,l,p){var h;t.strokeStyle=n,t.fillStyle=o;var u=LiteGraph.NODE_TITLE_HEIGHT,c=this.lowQualityRenderingRequired(.5),d=a._shape||a.constructor.shape||LiteGraph.ROUND_SHAPE,f=a.constructor.title_mode,b=!0;f==LiteGraph.TRANSPARENT_TITLE||f==LiteGraph.NO_TITLE?b=!1:f==LiteGraph.AUTOHIDE_TITLE&&p&&(b=!0);var _=tmp_area;_[0]=0,_[1]=b?-u:0,_[2]=s[0]+1,_[3]=b?s[1]+u:s[1];var g=t.globalAlpha;if(t.beginPath(),d==LiteGraph.BOX_SHAPE||c?t.fillRect(_[0],_[1],_[2],_[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE?t.roundRect(_[0],_[1],_[2],_[3],d==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):d==LiteGraph.CIRCLE_SHAPE&&t.arc(s[0]*.5,s[1]*.5,s[0]*.5,0,Math.PI*2),t.fill(),!a.flags.collapsed&&b&&(t.shadowColor="transparent",t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(0,-1,_[2],2)),t.shadowColor="transparent",(h=a.onDrawBackground)==null||h.call(a,t,this,this.canvas,this.graph_mouse),b||f==LiteGraph.TRANSPARENT_TITLE){if(a.onDrawTitleBar)a.onDrawTitleBar(t,u,s,this.ds.scale,n);else if(f!=LiteGraph.TRANSPARENT_TITLE&&(a.constructor.title_color||this.render_title_colored)){var L=a.constructor.title_color||n;if(a.flags.collapsed&&(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var G=__LGraphCanvas.gradients[L];if(!G){G=__LGraphCanvas.gradients[L]=t.createLinearGradient(0,0,400,0);try{G.addColorStop(0,L)}catch{G.addColorStop(0,LiteGraph.NODE_DEFAULT_COLOR)}G.addColorStop(1,"#000")}t.fillStyle=G}else t.fillStyle=L;t.beginPath(),d==LiteGraph.BOX_SHAPE||c?t.rect(0,-u,s[0]+1,u):(d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE)&&t.roundRect(0,-u,s[0]+1,u,a.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),t.fill(),t.shadowColor="transparent"}let R=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[a.mode]&&(R=LiteGraph.NODE_MODES_COLORS[a.mode]),LiteGraph.node_box_coloured_when_on&&(R=a.action_triggered?"#FFF":a.execute_triggered?"#AAA":R);var T=10;if(a.onDrawTitleBox?a.onDrawTitleBox(t,u,s,this.ds.scale):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CIRCLE_SHAPE||d==LiteGraph.CARD_SHAPE?(c&&(t.fillStyle="black",t.beginPath(),t.arc(u*.5,u*-.5,T*.5+1,0,Math.PI*2),t.fill()),t.fillStyle=a.boxcolor||R||LiteGraph.NODE_DEFAULT_BOXCOLOR,c?t.fillRect(u*.5-T*.5,u*-.5-T*.5,T,T):(t.beginPath(),t.arc(u*.5,u*-.5,T*.5,0,Math.PI*2),t.fill())):(c&&(t.fillStyle="black",t.fillRect((u-T)*.5-1,(u+T)*-.5-1,T+2,T+2)),t.fillStyle=a.boxcolor||R||LiteGraph.NODE_DEFAULT_BOXCOLOR,t.fillRect((u-T)*.5,(u+T)*-.5,T,T)),t.globalAlpha=g,a.onDrawTitleText&&a.onDrawTitleText(t,u,s,this.ds.scale,this.title_text_font,l),!c){t.font=this.title_text_font;var E=String(a.getTitle());E&&(l?t.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:t.fillStyle=a.constructor.title_text_color||this.node_title_color,a.flags.collapsed?(t.textAlign="left",t.fillText(E.substring(0,20),u,LiteGraph.NODE_TITLE_TEXT_Y-u),t.textAlign="left"):(t.textAlign="left",t.fillText(E,u,LiteGraph.NODE_TITLE_TEXT_Y-u)))}if(!a.flags.collapsed&&a.subgraph&&!a.skip_subgraph_button){var C=LiteGraph.NODE_TITLE_HEIGHT,I=a.size[0]-C,D=LiteGraph.isInsideRectangle(this.graph_mouse[0]-a.pos[0],this.graph_mouse[1]-a.pos[1],I+2,-C+2,C-4,C-4);t.fillStyle=D?"#888":"#555",d==LiteGraph.BOX_SHAPE||c?t.fillRect(I+2,-C+2,C-4,C-4):(t.beginPath(),t.roundRect(I+2,-C+2,C-4,C-4,[4]),t.fill()),t.fillStyle="#333",t.beginPath(),t.moveTo(I+C*.2,-C*.6),t.lineTo(I+C*.8,-C*.6),t.lineTo(I+C*.5,-C*.3),t.fill()}a.onDrawTitle&&a.onDrawTitle(t)}l&&(a.onBounding&&a.onBounding(_),f==LiteGraph.TRANSPARENT_TITLE&&(_[1]-=u,_[3]+=u),t.lineWidth=1,t.globalAlpha=.8,t.beginPath(),d==LiteGraph.BOX_SHAPE?t.rect(-6+_[0],-6+_[1],12+_[2],12+_[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE&&a.flags.collapsed?t.roundRect(-6+_[0],-6+_[1],12+_[2],12+_[3],[this.round_radius*2]):d==LiteGraph.CARD_SHAPE?t.roundRect(-6+_[0],-6+_[1],12+_[2],12+_[3],[this.round_radius*2,2,this.round_radius*2,2]):d==LiteGraph.CIRCLE_SHAPE&&t.arc(s[0]*.5,s[1]*.5,s[0]*.5+6,0,Math.PI*2),t.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,t.stroke(),t.strokeStyle=n,t.globalAlpha=1),a.execute_triggered>0&&a.execute_triggered--,a.action_triggered>0&&a.action_triggered--}drawConnections(a){var t=LiteGraph.getTime(),s=this.visible_area;margin_area[0]=s[0]-20,margin_area[1]=s[1]-20,margin_area[2]=s[2]+40,margin_area[3]=s[3]+40,a.lineWidth=this.connections_width,a.fillStyle="#AAA",a.strokeStyle="#AAA",a.globalAlpha=this.editor_alpha;for(var n=this.graph._nodes,o=0,l=n.length;o<l;++o){var p=n[o];if(!(!p.inputs||!p.inputs.length))for(let I=0;I<p.inputs.length;++I){var h=p.inputs[I];if(!(!h||h.link==null)){var u=h.link,c=this.graph.links[u];if(c){var d=this.graph.getNodeById(c.origin_id);if(d!=null){var f=c.origin_slot,b=null;f==-1?b=[d.pos[0]+10,d.pos[1]+10]:b=d.getConnectionPos(!1,f,tempA);var _=p.getConnectionPos(!0,I,tempB);if(link_bounding[0]=b[0],link_bounding[1]=b[1],link_bounding[2]=_[0]-b[0],link_bounding[3]=_[1]-b[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!LiteGraph.overlapBounding(link_bounding,margin_area)){var g=d.outputs[f],L=p.inputs[I];if(!(!g||!L)){var G=g.dir||(d.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),T=L.dir||(p.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(a,b,_,c,!1,0,null,G,T),c&&c._last_time&&t-c._last_time<1e3){var E=2-(t-c._last_time)*.002,C=a.globalAlpha;a.globalAlpha=C*E,this.renderLink(a,b,_,c,!0,E,"white",G,T),a.globalAlpha=C}}}}}}}}a.globalAlpha=1}renderLink(a,t,s,n,o,l,p,h,u,c){n&&this.visible_links.push(n),!p&&n&&(p=n.color||__LGraphCanvas.link_type_colors[n.type]),p||(p=this.default_link_color),n!=null&&this.highlighted_links[n.id]&&(p="#FFF"),h=h||LiteGraph.RIGHT,u=u||LiteGraph.LEFT;var d=LiteGraph.distance(t,s);this.render_connections_border&&this.ds.scale>.6&&(a.lineWidth=this.connections_width+4),a.lineJoin="round",c=c||1,c>1&&(a.lineWidth=.5),a.beginPath();for(let A=0;A<c;A+=1){var f=(A-(c-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){a.moveTo(t[0],t[1]+f);let S=0,O=0,B=0,$=0;switch(h){case LiteGraph.LEFT:S=d*-.25;break;case LiteGraph.RIGHT:S=d*.25;break;case LiteGraph.UP:O=d*-.25;break;case LiteGraph.DOWN:O=d*.25;break}switch(u){case LiteGraph.LEFT:B=d*-.25;break;case LiteGraph.RIGHT:B=d*.25;break;case LiteGraph.UP:$=d*-.25;break;case LiteGraph.DOWN:$=d*.25;break}a.bezierCurveTo(t[0]+S,t[1]+O+f,s[0]+B,s[1]+$+f,s[0],s[1]+f)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){a.moveTo(t[0],t[1]+f);let S=0,O=0,B=0,$=0;switch(h){case LiteGraph.LEFT:S=-1;break;case LiteGraph.RIGHT:S=1;break;case LiteGraph.UP:O=-1;break;case LiteGraph.DOWN:O=1;break}switch(u){case LiteGraph.LEFT:B=-1;break;case LiteGraph.RIGHT:B=1;break;case LiteGraph.UP:$=-1;break;case LiteGraph.DOWN:$=1;break}var b=15;a.lineTo(t[0]+S*b,t[1]+O*b+f),a.lineTo(s[0]+B*b,s[1]+$*b+f),a.lineTo(s[0],s[1]+f)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){a.moveTo(t[0],t[1]);var _=t[0],g=t[1],L=s[0],G=s[1];h==LiteGraph.RIGHT?_+=10:g+=10,u==LiteGraph.LEFT?L-=10:G-=10,a.lineTo(_,g),a.lineTo((_+L)*.5,g),a.lineTo((_+L)*.5,G),a.lineTo(L,G),a.lineTo(s[0],s[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!o&&(a.strokeStyle="rgba(0,0,0,0.5)",a.stroke()),a.lineWidth=this.connections_width,a.fillStyle=a.strokeStyle=p,a.stroke();var T=this.computeConnectionPoint(t,s,.5,h,u);if(n&&n._pos&&(n._pos[0]=T[0],n._pos[1]=T[1]),this.ds.scale>=.6&&this.highquality_render&&u!=LiteGraph.CENTER){if(this.render_connection_arrows){var E=this.computeConnectionPoint(t,s,.25,h,u),C=this.computeConnectionPoint(t,s,.26,h,u),I=this.computeConnectionPoint(t,s,.75,h,u),D=this.computeConnectionPoint(t,s,.76,h,u),R=0,P=0;this.render_curved_connections?(R=-Math.atan2(C[0]-E[0],C[1]-E[1]),P=-Math.atan2(D[0]-I[0],D[1]-I[1])):P=R=s[1]>t[1]?0:Math.PI,a.save(),a.translate(E[0],E[1]),a.rotate(R),a.beginPath(),a.moveTo(-5,-3),a.lineTo(0,7),a.lineTo(5,-3),a.fill(),a.restore(),a.save(),a.translate(I[0],I[1]),a.rotate(P),a.beginPath(),a.moveTo(-5,-3),a.lineTo(0,7),a.lineTo(5,-3),a.fill(),a.restore()}a.beginPath(),a.arc(T[0],T[1],5,0,Math.PI*2),a.fill()}if(l){a.fillStyle=p;for(let A=0;A<5;++A){var N=(LiteGraph.getTime()*.001+A*.2)%1;T=this.computeConnectionPoint(t,s,N,h,u),a.beginPath(),a.arc(T[0],T[1],5,0,2*Math.PI),a.fill()}}}computeConnectionPoint(a,t,s,n,o){n=n||LiteGraph.RIGHT,o=o||LiteGraph.LEFT;var l=LiteGraph.distance(a,t),p=a,h=[a[0],a[1]],u=[t[0],t[1]],c=t;switch(n){case LiteGraph.LEFT:h[0]+=l*-.25;break;case LiteGraph.RIGHT:h[0]+=l*.25;break;case LiteGraph.UP:h[1]+=l*-.25;break;case LiteGraph.DOWN:h[1]+=l*.25;break}switch(o){case LiteGraph.LEFT:u[0]+=l*-.25;break;case LiteGraph.RIGHT:u[0]+=l*.25;break;case LiteGraph.UP:u[1]+=l*-.25;break;case LiteGraph.DOWN:u[1]+=l*.25;break}var d=(1-s)*(1-s)*(1-s),f=3*((1-s)*(1-s))*s,b=3*(1-s)*(s*s),_=s*s*s,g=d*p[0]+f*h[0]+b*u[0]+_*c[0],L=d*p[1]+f*h[1]+b*u[1]+_*c[1];return[g,L]}drawExecutionOrder(a){a.shadowColor="transparent",a.globalAlpha=.25,a.textAlign="center",a.strokeStyle="white",a.globalAlpha=.75;var t=this.visible_nodes;for(let n=0;n<t.length;++n){var s=t[n];a.fillStyle="black",a.fillRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),s.order==0&&a.strokeRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),a.fillStyle="#FFF",a.fillText(s.order,s.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,s.pos[1]-6)}a.globalAlpha=1}drawNodeWidgets(a,t,s,n){if(!a.widgets||!a.widgets.length)return 0;var o=a.size[0],l=a.widgets;t+=2;var p=LiteGraph.NODE_WIDGET_HEIGHT,h=!this.lowQualityRenderingRequired(.5);s.save(),s.globalAlpha=this.editor_alpha;var u=LiteGraph.WIDGET_OUTLINE_COLOR,c=LiteGraph.WIDGET_BGCOLOR,d=LiteGraph.WIDGET_TEXT_COLOR,f=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,b=15;for(let D=0;D<l.length;++D){var _=l[D],g=t;_.y&&(g=_.y),_.last_y=g,s.strokeStyle=u,s.fillStyle="#222",s.textAlign="left",_.disabled&&(s.globalAlpha*=.5);var L=_.width||o;switch(_.type){case"button":_.clicked&&(s.fillStyle="#AAA",_.clicked=!1,this.dirty_canvas=!0),s.fillRect(b,g,L-b*2,p),h&&!_.disabled&&s.strokeRect(b,g,L-b*2,p),h&&(s.textAlign="center",s.fillStyle=d,s.fillText(_.label||_.name,L*.5,g+p*.7));break;case"toggle":if(s.textAlign="left",s.strokeStyle=u,s.fillStyle=c,s.beginPath(),h?s.roundRect(b,g,L-b*2,p,[p*.5]):s.rect(b,g,L-b*2,p),s.fill(),h&&!_.disabled&&s.stroke(),s.fillStyle=_.value?"#89A":"#333",s.beginPath(),s.arc(L-b*2,g+p*.5,p*.36,0,Math.PI*2),s.fill(),h){s.fillStyle=f;const R=_.label||_.name;R!=null&&s.fillText(R,b*2,g+p*.7),s.fillStyle=_.value?d:f,s.textAlign="right",s.fillText(_.value?_.options.on||"true":_.options.off||"false",L-40,g+p*.7)}break;case"slider":s.fillStyle=c,s.fillRect(b,g,L-b*2,p);var G=_.options.max-_.options.min,T=(_.value-_.options.min)/G;if(T<0&&(T=0),T>1&&(T=1),s.fillStyle=_.options.hasOwnProperty("slider_color")?_.options.slider_color:n==_?"#89A":"#678",s.fillRect(b,g,T*(L-b*2),p),h&&!_.disabled&&s.strokeRect(b,g,L-b*2,p),_.marker){var E=(_.marker-_.options.min)/G;E<0&&(E=0),E>1&&(E=1),s.fillStyle=_.options.hasOwnProperty("marker_color")?_.options.marker_color:"#AA9",s.fillRect(b+E*(L-b*2),g,2,p)}h&&(s.textAlign="center",s.fillStyle=d,s.fillText(_.label||_.name+"  "+Number(_.value).toFixed(_.options.precision!=null?_.options.precision:3),L*.5,g+p*.7));break;case"number":case"combo":if(s.textAlign="left",s.strokeStyle=u,s.fillStyle=c,s.beginPath(),h?s.roundRect(b,g,L-b*2,p,[p*.5]):s.rect(b,g,L-b*2,p),s.fill(),h)if(_.disabled||s.stroke(),s.fillStyle=d,_.disabled||(s.beginPath(),s.moveTo(b+16,g+5),s.lineTo(b+6,g+p*.5),s.lineTo(b+16,g+p-5),s.fill(),s.beginPath(),s.moveTo(L-b-16,g+5),s.lineTo(L-b-6,g+p*.5),s.lineTo(L-b-16,g+p-5),s.fill()),s.fillStyle=f,s.fillText(_.label||_.name,b*2+5,g+p*.7),s.fillStyle=d,s.textAlign="right",_.type=="number")s.fillText(Number(_.value).toFixed(_.options.precision!==void 0?_.options.precision:3),L-b*2-20,g+p*.7);else{var C=_.value;if(_.options.values){var I=_.options.values;I.constructor===Function&&(I=I()),I&&I.constructor!==Array&&(C=I[_.value])}s.fillText(C,L-b*2-20,g+p*.7)}break;case"string":case"text":if(s.textAlign="left",s.strokeStyle=u,s.fillStyle=c,s.beginPath(),h?s.roundRect(b,g,L-b*2,p,[p*.5]):s.rect(b,g,L-b*2,p),s.fill(),h){_.disabled||s.stroke(),s.save(),s.beginPath(),s.rect(b,g,L-b*2,p),s.clip(),s.fillStyle=f;const R=_.label||_.name;R!=null&&s.fillText(R,b*2,g+p*.7),s.fillStyle=d,s.textAlign="right",s.fillText(String(_.value).substr(0,30),L-b*2,g+p*.7),s.restore()}break;default:_.draw&&_.draw(s,a,L,g,p);break}t+=(_.computeSize?_.computeSize(L)[1]:p)+4,s.globalAlpha=this.editor_alpha}s.restore(),s.textAlign="left"}processNodeWidgets(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow();for(let i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type==="pointerdown"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var nvalue=LiteGraph.clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value,old_value)},20),this.dirty_canvas=!0;break;case"number":case"combo":case"enum":if(event.type=="pointermove"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type=="pointerdown"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));let a=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=a*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(a){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+a:index=values_list.indexOf(w.value)+a,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let t=function(s){return values!=values_list&&(s=text_values.indexOf(s)),this.value=s,inner_value_change(this,s,old_value),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:t.bind(w)},ref_window)}}else if(event.type=="pointerup"&&w.type=="number"){let delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,function(v){var r;if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(a){(r=LiteGraph.warn)==null||r.call(LiteGraph,a)}this.value=Number(v),inner_value_change(this,this.value,old_value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value,old_value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type=="pointerdown"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type=="pointerdown"&&this.prompt("Value",w.value,function(a){inner_value_change(this,a)}.bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return w}}}function inner_value_change(a,t,s){var n;(n=LiteGraph.debug)==null||n.call(LiteGraph,"inner_value_change for processNodeWidgets",a,t),s!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,s,w),node.graph.onGraphChanged({action:"widgetChanged",doSave:!0})),a.type=="number"&&(t=Number(t)),a.value=t,a.options&&a.options.property&&node.properties[a.options.property]!==void 0&&node.setProperty(a.options.property,t),a.callback&&a.callback(a.value,that,node,pos,event)}return null}drawGroups(a,t){if(this.graph){var s=this.graph._groups;t.save(),t.globalAlpha=.5*this.editor_alpha;for(let h=0;h<s.length;++h){var n=s[h];if(LiteGraph.overlapBounding(this.visible_area,n._bounding)){t.fillStyle=n.color||"#335",t.strokeStyle=n.color||"#335";var o=n._pos,l=n._size;t.globalAlpha=.25*this.editor_alpha,t.beginPath(),t.rect(o[0]+.5,o[1]+.5,l[0],l[1]),t.fill(),t.globalAlpha=this.editor_alpha,t.stroke(),t.beginPath(),t.moveTo(o[0]+l[0],o[1]+l[1]),t.lineTo(o[0]+l[0]-10,o[1]+l[1]),t.lineTo(o[0]+l[0],o[1]+l[1]-10),t.fill();var p=n.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;t.font=p+"px Arial",t.textAlign="left",t.fillText(n.title,o[0]+4,o[1]+p)}}t.restore()}}adjustNodesSize(){var a=this.graph._nodes;for(let t=0;t<a.length;++t)a[t].size=a[t].computeSize();this.setDirty(!0,!0)}resize(a,t){if(!a&&!t){var s=this.canvas.parentNode;a=s.offsetWidth,t=s.offsetHeight}this.canvas.width==a&&this.canvas.height==t||(this.canvas.width=a,this.canvas.height=t,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))}switchLiveMode(a){if(!a){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var t=this,s=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var n=setInterval(function(){t.editor_alpha*=s,t.dirty_canvas=!0,t.dirty_bgcanvas=!0,s<1&&t.editor_alpha<.01&&(clearInterval(n),s<1&&(t.live_mode=!0)),s>1&&t.editor_alpha>.99&&(clearInterval(n),t.editor_alpha=1)},1)}static onGroupAdd(a,t,s){var n=__LGraphCanvas.active_canvas,o=new LiteGraph.LGraphGroup;o.pos=n.convertEventToCanvasOffset(s),n.graph.add(o)}static getBoundaryNodes(a){let t=null,s=null,n=null,o=null;for(const l in a){const p=a[l],[h,u]=p.pos,[c,d]=p.size;(t===null||u<t.pos[1])&&(t=p),(s===null||h+c>s.pos[0]+s.size[0])&&(s=p),(n===null||u+d>n.pos[1]+n.size[1])&&(n=p),(o===null||h<o.pos[0])&&(o=p)}return{top:t,right:s,bottom:n,left:o}}boundaryNodesForSelection(){return __LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))}static alignNodes(a,t,s){if(!a)return;const n=__LGraphCanvas.active_canvas;let o=[];s===void 0?o=__LGraphCanvas.getBoundaryNodes(a):o={top:s,right:s,bottom:s,left:s};for(const[l,p]of Object.entries(n.selected_nodes))switch(t){case"right":p.pos[0]=o.right.pos[0]+o.right.size[0]-p.size[0];break;case"left":p.pos[0]=o.left.pos[0];break;case"top":p.pos[1]=o.top.pos[1];break;case"bottom":p.pos[1]=o.bottom.pos[1]+o.bottom.size[1]-p.size[1];break}n.dirty_canvas=!0,n.dirty_bgcanvas=!0}static onNodeAlign(a,t,s,n,o){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:l,parentMenu:n});function l(p){__LGraphCanvas.alignNodes(__LGraphCanvas.active_canvas.selected_nodes,p.toLowerCase(),o)}}static onGroupAlign(a,t,s,n){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:o,parentMenu:n});function o(l){__LGraphCanvas.alignNodes(__LGraphCanvas.active_canvas.selected_nodes,l.toLowerCase())}}static onMenuAdd(a,t,s,n,o){var l=__LGraphCanvas.active_canvas,p=l.getCanvasWindow(),h=l.graph;if(!h)return;function u(c,d){var f=LiteGraph.getNodeTypesCategories(l.filter||h.filter).filter(function(g){return g.startsWith(c)}),b=[];f.map(function(g){if(g){var L=new RegExp("^("+c+")"),G=g.replace(L,"").split("/")[0],T=c===""?G+"/":c+G+"/",E=G;E.indexOf("::")!=-1&&(E=E.split("::")[1]);var C=b.findIndex(function(I){return I.value===T});C===-1&&b.push({value:T,content:E,has_submenu:!0,callback:function(I,D,R,P){u(I.value,P)}})}});var _=LiteGraph.getNodeTypesInCategory(c.slice(0,-1),l.filter||h.filter);_.map(function(g){if(!g.skip_list){var L={value:g.type,content:g.title,has_submenu:!1,callback:function(G,T,E,C){var I=C.getFirstEvent();l.graph.beforeChange();var D=LiteGraph.createNode(G.value);D&&(D.pos=l.convertEventToCanvasOffset(I),l.graph.add(D)),o&&o(D),l.graph.afterChange()}};b.push(L)}}),new LiteGraph.ContextMenu(b,{event:s,parentMenu:d},p)}return u("",n),!1}static onMenuCollapseAll(){}static onMenuNodeEdit(){}static showMenuNodeOptionalInputs(a,t,s,n,o){var l;if(!o)return;var p=this,h=__LGraphCanvas.active_canvas,u=h.getCanvasWindow();t=o.optional_inputs,o.onGetInputs&&(t=o.onGetInputs());var c=[];if(t)for(let L=0;L<t.length;L++){var d=t[L];if(!d){c.push(null);continue}var f=d[0];d[2]||(d[2]={}),d[2].label&&(f=d[2].label),d[2].removable=!0;var b={content:f,value:d};d[1]==LiteGraph.ACTION&&(b.className="event"),c.push(b)}if(o.onMenuNodeInputs){var _=o.onMenuNodeInputs(c);_&&(c=_)}if(LiteGraph.do_add_triggers_slots&&o.findInputSlot("onTrigger")==-1&&c.push({content:"On Trigger",value:["onTrigger",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),!c.length){LiteGraph.debug&&((l=LiteGraph.log)==null||l.call(LiteGraph,"no input entries"));return}new LiteGraph.ContextMenu(c,{event:s,callback:g,parentMenu:n,node:o},u);function g(L,G,T){var E;if(o&&(L.callback&&L.callback.call(p,o,L,G,T),L.value)){o.graph.beforeChange();const C=L.value[2]?Object.assign({},L.value[2]):{};o.addInput(L.value[0],L.value[1],C),(E=o.onNodeInputAdd)==null||E.call(o,L.value),o.setDirtyCanvas(!0,!0),o.graph.afterChange()}}return!1}static showMenuNodeOptionalOutputs(a,t,s,n,o){if(!o)return;var l=this,p=__LGraphCanvas.active_canvas,h=p.getCanvasWindow();t=o.optional_outputs,o.onGetOutputs&&(t=o.onGetOutputs());var u=[];if(t)for(let g=0;g<t.length;g++){var c=t[g];if(!c){u.push(null);continue}if(!(o.flags&&o.flags.skip_repeated_outputs&&o.findOutputSlot(c[0])!=-1)){var d=c[0];c[2]||(c[2]={}),c[2].label&&(d=c[2].label),c[2].removable=!0;var f={content:d,value:c};c[1]==LiteGraph.EVENT&&(f.className="event"),u.push(f)}}if(this.onMenuNodeOutputs&&(u=this.onMenuNodeOutputs(u)),LiteGraph.do_add_triggers_slots&&o.findOutputSlot("onExecuted")==-1&&u.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),o.onMenuNodeOutputs){var b=o.onMenuNodeOutputs(u);b&&(u=b)}if(!u.length)return;new LiteGraph.ContextMenu(u,{event:s,callback:_,parentMenu:n,node:o},h);function _(g,L,G){var T;if(o&&(g.callback&&g.callback.call(l,o,g,L,G),!!g.value)){var E=g.value[1];if(E&&(E.constructor===Object||E.constructor===Array)){var C=[];for(let I in E)C.push({content:I,value:E[I]});return new LiteGraph.ContextMenu(C,{event:L,callback:_,parentMenu:n,node:o}),!1}else{o.graph.beforeChange();const I=g.value[2]?Object.assign({},g.value[2]):{};o.addOutput(g.value[0],g.value[1],I),(T=o.onNodeOutputAdd)==null||T.call(o,g.value),o.setDirtyCanvas(!0,!0),o.graph.afterChange()}}}return!1}static onShowMenuNodeProperties(a,t,s,n,o){if(!o||!o.properties)return;var l=__LGraphCanvas.active_canvas,p=l.getCanvasWindow(),h=[];for(let d in o.properties){a=o.properties[d]!==void 0?o.properties[d]:" ",typeof a=="object"&&(a=JSON.stringify(a));var u=o.getPropertyInfo(d);(u.type=="enum"||u.type=="combo")&&(a=__LGraphCanvas.getPropertyPrintableValue(a,u.values)),a=__LGraphCanvas.decodeHTML(a),h.push({content:"<span class='property_name'>"+(u.label?u.label:d)+"</span><span class='property_value'>"+a+"</span>",value:d})}if(!h.length)return;new LiteGraph.ContextMenu(h,{event:s,callback:c,parentMenu:n,allow_html:!0,node:o},p);function c(d){if(o){var f=this.getBoundingClientRect();l.showEditPropertyValue(o,d.value,{position:[f.left,f.top]})}}return!1}static decodeHTML(a){var t=document.createElement("div");return t.innerText=a,t.innerHTML}static onMenuResizeNode(a,t,s,n,o){if(!o)return;const l=h=>{h.size=h.computeSize(),h.onResize&&h.onResize(h.size)};var p=__LGraphCanvas.active_canvas;if(!p.selected_nodes||Object.keys(p.selected_nodes).length<=1)l(o);else for(let h in p.selected_nodes)l(p.selected_nodes[h]);o.setDirtyCanvas(!0,!0)}showLinkMenu(a,t){var s=this,n=s.graph.getNodeById(a.origin_id),o=s.graph.getNodeById(a.target_id),l=!1;n&&n.outputs&&n.outputs[a.origin_slot]&&(l=n.outputs[a.origin_slot].type);var p=!1;o&&o.outputs&&o.outputs[a.target_slot]&&(p=o.inputs[a.target_slot].type);var h=["Add Node",null,"Delete"],u=new LiteGraph.ContextMenu(h,{event:t,title:a.data!=null?a.data.constructor.name:null,callback:c});function c(d,f,b){switch(d){case"Add Node":__LGraphCanvas.onMenuAdd(null,null,b,u,function(_){var g;(g=LiteGraph.debug)==null||g.call(LiteGraph,"node autoconnect"),!(!_.inputs||!_.inputs.length||!_.outputs||!_.outputs.length)&&n.connectByType(a.origin_slot,_,l)&&(_.connectByType(a.target_slot,o,p),_.pos[0]-=_.size[0]*.5)});break;case"Delete":s.graph.removeLink(a.id);break}}return!1}createDefaultNodeForSlot(a={}){var t,s,n,o,l,p=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},a),h=this,u=p.nodeFrom&&p.slotFrom!==null,c=!u&&p.nodeTo&&p.slotTo!==null;if(!u&&!c)return(t=LiteGraph.warn)==null||t.call(LiteGraph,"No data passed to createDefaultNodeForSlot "+p.nodeFrom+" "+p.slotFrom+" "+p.nodeTo+" "+p.slotTo),!1;if(!p.nodeType)return(s=LiteGraph.warn)==null||s.call(LiteGraph,"No type to createDefaultNodeForSlot"),!1;var d=u?p.nodeFrom:p.nodeTo,f=u?p.slotFrom:p.slotTo,b=!1;switch(typeof f){case"string":b=u?d.findOutputSlot(f,!1):d.findInputSlot(f,!1),f=u?d.outputs[f]:d.inputs[f];break;case"object":b=u?d.findOutputSlot(f.name):d.findInputSlot(f.name);break;case"number":b=f,f=u?d.outputs[f]:d.inputs[f];break;default:return(n=LiteGraph.warn)==null||n.call(LiteGraph,"Cant get slot information "+f),!1}(f===!1||b===!1)&&((o=LiteGraph.warn)==null||o.call(LiteGraph,"createDefaultNodeForSlot bad slotX "+f+" "+b));var _=f.type==LiteGraph.EVENT?"_event_":f.type,g=u?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(g&&g[_]){f.link;var L=!1;if(typeof g[_]=="object"){for(var G in g[_])if(p.nodeType==g[_][G]||p.nodeType=="AUTO"){L=g[_][G];break}}else(p.nodeType==g[_]||p.nodeType=="AUTO")&&(L=g[_]);if(L){var T=!1;typeof L=="object"&&L.node&&(T=L,L=L.node);var E=LiteGraph.createNode(L);if(E){if(T){if(T.properties)for(const[C,I]of Object.entries(T.properties))E.addProperty(C,I);T.inputs&&(E.inputs=[],Object.values(T.inputs).forEach(C=>{E.addOutput(C[0],C[1])})),T.outputs&&(E.outputs=[],Object.values(T.outputs).forEach(C=>{E.addOutput(C[0],C[1])})),T.title&&(E.title=T.title),T.json&&E.configure(T.json)}return h.graph.add(E),E.pos=[p.position[0]+p.posAdd[0]+(p.posSizeFix[0]?p.posSizeFix[0]*E.size[0]:0),p.position[1]+p.posAdd[1]+(p.posSizeFix[1]?p.posSizeFix[1]*E.size[1]:0)],u?p.nodeFrom.connectByType(b,E,_):p.nodeTo.connectByTypeOutput(b,E,_),!0}else(l=LiteGraph.warn)==null||l.call(LiteGraph,"failed creating "+L)}}return!1}showConnectionMenu(a={}){var t,s,n=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},a),o=this,l=n.nodeFrom&&n.slotFrom,p=!l&&n.nodeTo&&n.slotTo;if(!l&&!p)return(t=LiteGraph.warn)==null||t.call(LiteGraph,"No data passed to showConnectionMenu"),!1;var h=l?n.nodeFrom:n.nodeTo,u=l?n.slotFrom:n.slotTo,c=!1;switch(typeof u){case"string":c=l?h.findOutputSlot(u,!1):h.findInputSlot(u,!1),u=l?h.outputs[u]:h.inputs[u];break;case"object":c=l?h.findOutputSlot(u.name):h.findInputSlot(u.name);break;case"number":c=u,u=l?h.outputs[u]:h.inputs[u];break;default:return(s=LiteGraph.warn)==null||s.call(LiteGraph,"Cant get slot information "+u),!1}var d=["Add Node",null];o.allow_searchbox&&(d.push("Search"),d.push(null));const f=u.type===LiteGraph.EVENT?"_event_":u.type,b=l?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(b&&b[f]){const g=b[f];Array.isArray(g)||typeof g=="object"?Object.values(g).forEach(L=>{d.push(L)}):d.push(g)}var _=new LiteGraph.ContextMenu(d,{event:n.e,title:(u&&u.name!=""?u.name+(f?" | ":""):"")+(u&&f?f:""),callback:(g,L,G)=>{const T={"Add Node":()=>{__LGraphCanvas.onMenuAdd(null,null,G,_,E=>{l?n.nodeFrom.connectByType(c,E,f):n.nodeTo.connectByTypeOutput(c,E,f)})},Search:()=>{l?o.showSearchBox(G,{node_from:n.nodeFrom,slot_from:u,type_filter_in:f}):o.showSearchBox(G,{node_to:n.nodeTo,slot_from:u,type_filter_out:f})},default:()=>{o.createDefaultNodeForSlot(Object.assign(n,{position:[n.e.canvasX,n.e.canvasY],nodeType:g}))}};(T[g]||T.default)()}});return!1}static onShowPropertyEditor(a,t,s,n,o){var l=a.property||"title",p=o[l],h=document.createElement("div");h.is_modified=!1,h.className="graphdialog",h.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",h.close=()=>{var C;(C=h.parentNode)==null||C.removeChild(h)};var u=h.querySelector(".name");u.innerText=l;var c=h.querySelector(".value");const d=()=>{c&&E(c.value)};c&&(c.value=p,c.addEventListener("blur",function(C){this.focus()}),c.addEventListener("keydown",function(C){if(h.is_modified=!0,C.keyCode==27)h.close();else if(C.keyCode==13)d();else if(C.keyCode!=13&&C.target.localName!="textarea")return;C.preventDefault(),C.stopPropagation()}));var f=__LGraphCanvas.active_canvas,b=f.canvas,_=b.getBoundingClientRect(),g=-20,L=-20;_&&(g-=_.left,L-=_.top),event?(h.style.left=event.clientX+g+"px",h.style.top=event.clientY+L+"px"):(h.style.left=b.width*.5+g+"px",h.style.top=b.height*.5+L+"px");var G=h.querySelector("button");G.addEventListener("click",d),b.parentNode.appendChild(h),c&&c.focus();let T=null;h.addEventListener("pointerleave",C=>{LiteGraph.dialog_close_on_mouse_leave&&!h.is_modified&&(T=setTimeout(h.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),h.addEventListener("pointerenter",C=>{LiteGraph.dialog_close_on_mouse_leave&&T&&clearTimeout(T)});const E=C=>{var I;switch(a.type){case"Number":C=Number(C);break;case"Boolean":C=!!C;break}o[l]=C,(I=h.parentNode)==null||I.removeChild(h),o.setDirtyCanvas(!0,!0)}}prompt(a="",t,s,n,o){var l,p=document.createElement("div");p.is_modified=!1,p.className="graphdialog rounded",o?p.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":p.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",p.close=()=>{var E;this.prompt_box=null,(E=p.parentNode)==null||E.removeChild(p)};var h=__LGraphCanvas.active_canvas,u=h.canvas;u.parentNode.appendChild(p),this.ds.scale>1&&(p.style.transform=`scale(${this.ds.scale})`);var c=null,d=0;p.addEventListener("pointerleave",E=>{d>0||LiteGraph.dialog_close_on_mouse_leave&&!p.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(c=setTimeout(p.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),p.addEventListener("pointerenter",E=>{LiteGraph.dialog_close_on_mouse_leave&&c&&clearTimeout(c)});const f=p.querySelectorAll("select");f&&(d=0,f.forEach(E=>{E.addEventListener("pointerdown",C=>{d++}),E.addEventListener("focus",C=>{d++}),E.addEventListener("blur",C=>{d=Math.max(0,d-1)}),E.addEventListener("change",C=>{d=0})})),(l=this.prompt_box)==null||l.close(),this.prompt_box=p;var b=p.querySelector(".name");b.innerText=a;var _=p.querySelector(".value");_.value=t;const g=_;g.addEventListener("keydown",E=>{var C;switch(p.is_modified=!0,E.key){case"Escape":p.close();break;case"Enter":E.target.localName!=="textarea"&&typeof s=="function"&&(s(g.value),this.setDirty(!0)),(C=LiteGraph.debug)==null||C.call(LiteGraph,"prompt v2 ENTER",g.value,E.target.localName,s),p.close();break;default:return}E.preventDefault(),E.stopPropagation()}),p.querySelector("button").addEventListener("click",E=>{var C;typeof s=="function"&&(s(g.value),this.setDirty(!0)),(C=LiteGraph.debug)==null||C.call(LiteGraph,"prompt v2 OK",g.value,s),p.close()});var L=u.getBoundingClientRect(),G=-20,T=-20;return L&&(G-=L.left,T-=L.top),n?(p.style.left=n.clientX+G+"px",p.style.top=n.clientY+T+"px"):(p.style.left=u.width*.5+G+"px",p.style.top=u.height*.5+T+"px"),setTimeout(function(){g.focus()},10),p}showSearchBox(a,t){var s={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled&&(Object.keys(LiteGraph.registered_slot_in_types||{}).length>0||Object.keys(LiteGraph.registered_slot_out_types||{}).length>0),type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};t=Object.assign(s,t||{});var n=this,o=__LGraphCanvas.active_canvas,l=o.canvas,p=l.ownerDocument||document,h=document.createElement("div");if(h.className="litegraph litesearchbox graphdialog rounded",h.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",t.do_type_filter&&(h.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",h.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),t.show_close_button&&(h.innerHTML+="<button class='close_searchbox close'>X</button>"),h.innerHTML+="<div class='helper'></div>",p.fullscreenElement?p.fullscreenElement.appendChild(h):(p.body.appendChild(h),p.body.style.overflow="hidden"),t.do_type_filter)var u=h.querySelector(".slot_in_type_filter"),c=h.querySelector(".slot_out_type_filter");if(h.close=function(){n.search_box=null,this.blur(),l.focus(),p.body.style.overflow="",setTimeout(function(){n.canvas.focus()},20),h.parentNode&&h.parentNode.removeChild(h)},this.ds.scale>1&&(h.style.transform=`scale(${this.ds.scale})`),t.hide_on_mouse_leave){var d=0,f=null;if(h.addEventListener("pointerenter",function(N){f&&(clearTimeout(f),f=null)}),h.addEventListener("pointerleave",function(N){d>0||(f=setTimeout(function(){h.close()},500))}),t.do_type_filter){const N=function(A){A&&(A.addEventListener("pointerdown",function(S){d++}),A.addEventListener("focus",function(S){d++}),A.addEventListener("blur",function(S){d=Math.max(0,d-1)}),A.addEventListener("change",function(S){d=0}))};N(u),N(c)}}n.search_box&&n.search_box.close(),n.search_box=h;var b=h.querySelector(".helper"),_=null,g=null,L=null,G=h.querySelector("input");if(G&&(G.addEventListener("blur",function(N){n.search_box&&this.focus()}),G.addEventListener("keydown",function(N){if(N.key==="ArrowUp")R(!1);else if(N.key==="ArrowDown")R(!0);else if(N.key==="Escape")h.close();else if(N.key==="Enter")P(),L?D(L.innerHTML):_?D(_):h.close();else{g&&clearInterval(g),g=setTimeout(P,250);return}return N.preventDefault(),N.stopPropagation(),N.stopImmediatePropagation(),!0})),t.do_type_filter){if(u){let N=LiteGraph.slot_types_in,A=N.length;(t.type_filter_in==LiteGraph.EVENT||t.type_filter_in==LiteGraph.ACTION)&&(t.type_filter_in="_event_");for(let S=0;S<A;S++){let O=document.createElement("option");O.value=N[S],O.innerHTML=N[S],u.appendChild(O),t.type_filter_in!==!1&&(t.type_filter_in+"").toLowerCase()==(N[S]+"").toLowerCase()&&(O.selected=!0)}u.addEventListener("change",function(){P()})}if(c){let N=LiteGraph.slot_types_out,A=N.length;(t.type_filter_out==LiteGraph.EVENT||t.type_filter_out==LiteGraph.ACTION)&&(t.type_filter_out="_event_");for(let S=0;S<A;S++){let O=document.createElement("option");O.value=N[S],O.innerHTML=N[S],c.appendChild(O),t.type_filter_out!==!1&&(t.type_filter_out+"").toLowerCase()==(N[S]+"").toLowerCase()&&(O.selected=!0)}c.addEventListener("change",function(){P()})}}if(t.show_close_button){var T=h.querySelector(".close");T.addEventListener("click",h.close)}var E=l.getBoundingClientRect(),C=(a?a.clientX:E.left+E.width*.5)-80,I=(a?a.clientY:E.top+E.height*.5)-20;E.width-C<470&&(C=E.width-470),E.height-I<220&&(I=E.height-220),C<E.left+20&&(C=E.left+20),I<E.top+20&&(I=E.top+20),h.style.left=C+"px",h.style.top=I+"px",G.focus(),t.show_all_on_open&&P();function D(N){if(N)if(n.onSearchBoxSelection)n.onSearchBoxSelection(N,a,o);else{var A=LiteGraph.searchbox_extras[N.toLowerCase()];A&&(N=A.type),o.graph.beforeChange();var S=LiteGraph.createNode(N);if(S&&(S.pos=o.convertEventToCanvasOffset(a),o.graph.add(S,!1,{doProcessChange:!1})),A&&A.data){if(A.data.properties)for(let B in A.data.properties)S.addProperty(B,A.data.properties[B]);if(A.data.inputs){S.inputs=[];for(let B in A.data.inputs)S.addOutput(A.data.inputs[B][0],A.data.inputs[B][1])}if(A.data.outputs){S.outputs=[];for(let B in A.data.outputs)S.addOutput(A.data.outputs[B][0],A.data.outputs[B][1])}A.data.title&&(S.title=A.data.title),A.data.json&&S.configure(A.data.json)}let O;if(t.node_from){switch(O=!1,typeof t.slot_from){case"string":O=t.node_from.findOutputSlot(t.slot_from);break;case"object":t.slot_from.name?O=t.node_from.findOutputSlot(t.slot_from.name):O=-1,O==-1&&typeof t.slot_from.slot_index!="undefined"&&(O=t.slot_from.slot_index);break;case"number":O=t.slot_from;break;default:O=0}typeof t.node_from.outputs[O]!="undefined"&&O!==!1&&O>-1&&t.node_from.connectByType(O,S,t.node_from.outputs[O].type)}if(t.node_to){switch(O=!1,typeof t.slot_from){case"string":O=t.node_to.findInputSlot(t.slot_from);break;case"object":t.slot_from.name?O=t.node_to.findInputSlot(t.slot_from.name):O=-1,O==-1&&typeof t.slot_from.slot_index!="undefined"&&(O=t.slot_from.slot_index);break;case"number":O=t.slot_from;break;default:O=0}typeof t.node_to.inputs[O]!="undefined"&&O!==!1&&O>-1&&t.node_to.connectByTypeOutput(O,S,t.node_to.inputs[O].type)}o.graph.afterChange()}h.close()}function R(N){var A=L;L&&L.classList.remove("selected"),L?(L=N?L.nextSibling:L.previousSibling,L||(L=A)):L=N?b.childNodes[0]:b.childNodes[b.childNodes.length],L&&(L.classList.add("selected"),L.scrollIntoView({block:"end",behavior:"smooth"}))}function P(){g=null;var N=G.value;if(_=null,b.innerHTML="",!N&&!t.show_all_if_empty)return;if(n.onSearchBox){var A=n.onSearchBox(b,N,o);if(A)for(let V=0;V<A.length;++V)ht(A[V])}else{let V=function(z,Z={}){var Ct={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},M=Object.assign(Ct,Z),q=LiteGraph.registered_node_types[z];if(O&&q.filter!=O||(!t.show_all_if_empty||N)&&z.toLowerCase().indexOf(N)===-1)return!1;if(t.do_type_filter&&!M.skipFilter){var it=z;let Et;var W=F.value;if(M.inTypeOverride!==!1&&(W=M.inTypeOverride),F&&W&&LiteGraph.registered_slot_in_types[W]&&LiteGraph.registered_slot_in_types[W].nodes&&(Et=LiteGraph.registered_slot_in_types[W].nodes.includes(it),Et===!1)||(W=U.value,M.outTypeOverride!==!1&&(W=M.outTypeOverride),U&&W&&LiteGraph.registered_slot_out_types[W]&&LiteGraph.registered_slot_out_types[W].nodes&&(Et=LiteGraph.registered_slot_out_types[W].nodes.includes(it),Et===!1)))return!1}return!0};var S=0;N=N.toLowerCase();var O=o.filter||o.graph.filter;let F,U;t.do_type_filter&&n.search_box?(F=n.search_box.querySelector(".slot_in_type_filter"),U=n.search_box.querySelector(".slot_out_type_filter")):(F=!1,U=!1);for(let z in LiteGraph.searchbox_extras){var B=LiteGraph.searchbox_extras[z];if(!((!t.show_all_if_empty||N)&&B.desc.toLowerCase().indexOf(N)===-1)){var $=LiteGraph.registered_node_types[B.type];if(!($&&$.filter!=O)&&V(B.type)&&(ht(B.desc,"searchbox_extra"),__LGraphCanvas.search_limit!==-1&&S++>__LGraphCanvas.search_limit))break}}var et=null;if(Array.prototype.filter)et=Object.keys(LiteGraph.registered_node_types).filter(V);else{et=[];for(let z in LiteGraph.registered_node_types)V(z)&&et.push(z)}for(let z=0;z<et.length&&(ht(et[z]),!(__LGraphCanvas.search_limit!==-1&&S++>__LGraphCanvas.search_limit));z++);if(t.show_general_after_typefiltered&&(F.value||U.value)){var lt=[];for(let z in LiteGraph.registered_node_types)V(z,{inTypeOverride:F&&F.value?"*":!1,outTypeOverride:U&&U.value?"*":!1})&&lt.push(z);for(let z=0;z<lt.length&&(ht(lt[z],"generic_type"),!(__LGraphCanvas.search_limit!==-1&&S++>__LGraphCanvas.search_limit));z++);}if((F.value||U.value)&&b.childNodes.length==0&&t.show_general_if_none_on_typefilter){var lt=[];for(let Z in LiteGraph.registered_node_types)V(Z,{skipFilter:!0})&&lt.push(Z);for(let Z=0;Z<lt.length&&(ht(lt[Z],"not_in_filter"),!(__LGraphCanvas.search_limit!==-1&&S++>__LGraphCanvas.search_limit));Z++);}}function ht(V,F){var U=document.createElement("div");_||(_=V),U.innerText=V,U.dataset.type=encodeURIComponent(V),U.className="litegraph lite-search-item",F&&(U.className+=" "+F),U.addEventListener("click",function(z){D(decodeURIComponent(this.dataset.type))}),b.appendChild(U)}}return h}showEditPropertyValue(a,t,s){var n,o,l,p,h;if(!a||a.properties[t]===void 0)return;s=s||{};var u=a.getPropertyInfo(t),c=u.type;let d;if(c=="string"||c=="number"||c=="array"||c=="object")d="<input autofocus type='text' class='value'/>";else if((c=="enum"||c=="combo")&&u.values){(n=LiteGraph.debug)==null||n.call(LiteGraph,"CREATING showEditPropertyValue ENUM COMBO",_,c,b),d="<select autofocus type='text' class='value'>";for(let T in u.values){var f=T;u.values.constructor===Array&&(f=u.values[T]),d+="<option value='"+f+"' "+(f==a.properties[t]?"selected":"")+">"+u.values[T]+"</option>"}d+="</select>"}else if(c=="boolean"||c=="toggle")d="<input autofocus type='checkbox' class='value' "+(a.properties[t]?"checked":"")+"/>";else{(o=LiteGraph.warn)==null||o.call(LiteGraph,"unknown type: "+c);return}var b=this.createDialog("<span class='name'>"+(u.label?u.label:t)+"</span>"+d+"<button>OK</button>",s),_=!1;(c=="enum"||c=="combo")&&u.values?((l=LiteGraph.debug)==null||l.call(LiteGraph,"showEditPropertyValue ENUM COMBO",_,c,b),_=b.querySelector("select"),_.addEventListener("change",function(T){var E;b.modified(),(E=LiteGraph.debug)==null||E.call(LiteGraph,"Enum change",_,u,T.target),G(T.target.value)})):c=="boolean"||c=="toggle"?((p=LiteGraph.debug)==null||p.call(LiteGraph,"showEditPropertyValue TOGGLE",_,c,b),_=b.querySelector("input"),_&&_.addEventListener("click",function(T){b.modified(),G(!!_.checked)})):(_=b.querySelector("input"),(h=LiteGraph.debug)==null||h.call(LiteGraph,"showEditPropertyValue",_,c,b),_&&(_.addEventListener("blur",function(T){this.focus()}),f=a.properties[t]!==void 0?a.properties[t]:"",c!=="string"&&(f=JSON.stringify(f)),_.value=f,_.addEventListener("keydown",function(T){if(T.keyCode==27)b.close();else if(T.keyCode==13)L();else if(T.keyCode!=13){b.modified();return}T.preventDefault(),T.stopPropagation()}))),_&&_.focus();var g=b.querySelector("button");g.addEventListener("click",L);function L(){G(_.value)}function G(T){var E;u&&u.values&&u.values.constructor===Object&&u.values[T]!=null&&(T=u.values[T]),typeof a.properties[t]=="number"&&(T=Number(T)),(c=="array"||c=="object")&&(T=JSON.parse(T)),a.properties[t]=T,(E=a.graph)==null||E.onGraphChanged({action:"propertyChanged",doSave:!0}),a.onPropertyChanged&&a.onPropertyChanged(t,T),s.onclose&&s.onclose(),b.close(),a.setDirtyCanvas(!0,!0)}return b}createDialog(a,t){var s={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};t=Object.assign(s,t||{});var n=document.createElement("div");n.className="graphdialog",n.innerHTML=a,n.is_modified=!1;var o=this.canvas.getBoundingClientRect(),l=-20,p=-20;if(o&&(l-=o.left,p-=o.top),t.position?(l+=t.position[0],p+=t.position[1]):t.event?(l+=t.event.clientX,p+=t.event.clientY):(l+=this.canvas.width*.5,p+=this.canvas.height*.5),n.style.left=l+"px",n.style.top=p+"px",this.canvas.parentNode.appendChild(n),t.checkForInput){var h=[],u=!1;h=n.querySelectorAll("input"),h&&h.forEach(function(b){b.addEventListener("keydown",function(_){if(n.modified(),_.keyCode==27)n.close();else if(_.keyCode!=13)return;_.preventDefault(),_.stopPropagation()}),u||b.focus()})}n.modified=function(){n.is_modified=!0},n.close=function(){n.parentNode&&n.parentNode.removeChild(n)};var c=null,d=0;n.addEventListener("pointerleave",function(b){d>0||(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!n.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(c=setTimeout(n.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),n.addEventListener("pointerenter",function(b){(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&c&&clearTimeout(c)});var f=n.querySelectorAll("select");return f&&f.forEach(function(b){b.addEventListener("pointerdown",function(_){d++}),b.addEventListener("focus",function(_){d++}),b.addEventListener("blur",function(_){d=Math.max(0,d-1)}),b.addEventListener("change",function(_){d=0})}),n}createPanel(a,t){t=t||{};var s=t.window||window,n=document.createElement("div");if(n.className="litegraph dialog",n.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",n.header=n.querySelector(".dialog-header"),t.width&&(n.style.width=t.width+(t.width.constructor===Number?"px":"")),t.height&&(n.style.height=t.height+(t.height.constructor===Number?"px":"")),t.closable){var o=document.createElement("span");o.innerHTML="&#10005;",o.classList.add("close"),o.addEventListener("click",function(){n.close()}),n.header.appendChild(o)}return n.title_element=n.querySelector(".dialog-title"),n.title_element.innerText=a,n.content=n.querySelector(".dialog-content"),n.alt_content=n.querySelector(".dialog-alt-content"),n.footer=n.querySelector(".dialog-footer"),n.close=function(){n.onClose&&typeof n.onClose=="function"&&n.onClose(),n.parentNode&&n.parentNode.removeChild(n)},n.toggleAltContent=function(l){let p,h;typeof l!="undefined"?(p=l?"block":"none",h=l?"none":"block"):(p=n.alt_content.style.display!="block"?"block":"none",h=n.alt_content.style.display!="block"?"none":"block"),n.alt_content.style.display=p,n.content.style.display=h},n.toggleFooterVisibility=function(l){let p;typeof l!="undefined"?p=l?"block":"none":p=n.footer.style.display!="block"?"block":"none",n.footer.style.display=p},n.clear=function(){this.content.innerHTML=""},n.addHTML=function(l,p,h){var u=document.createElement("div");return p&&(u.className=p),u.innerHTML=l,h?n.footer.appendChild(u):n.content.appendChild(u),u},n.addButton=function(l,p,h){var u=document.createElement("button");return u.innerText=l,u.options=h,u.classList.add("btn"),u.addEventListener("click",p),n.footer.appendChild(u),u},n.addSeparator=function(){var l=document.createElement("div");l.className="separator",n.content.appendChild(l)},n.addWidget=function(l,p,h,u,c){var d,f;u=u||{};var b=String(h);l=l.toLowerCase(),l=="number"&&(b=h.toFixed(3));var _=document.createElement("div");_.className="property",_.innerHTML="<span class='property_name'></span><span class='property_value'></span>",_.querySelector(".property_name").innerText=u.label||p;var g=_.querySelector(".property_value");g.innerText=b,_.dataset.property=p,_.dataset.type=u.type||l,_.options=u,_.value=h,(d=LiteGraph.debug)==null||d.call(LiteGraph,"addWidget",l,h,g,u),l=="code"?_.addEventListener("click",function(G){n.inner_showCodePad(this.dataset.property)}):l=="boolean"?(_.classList.add("boolean"),h&&_.classList.add("bool-on"),_.addEventListener("click",function(){var G=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",L(G,this.value)})):l=="string"||l=="number"?(g.setAttribute("contenteditable",!0),g.addEventListener("keydown",function(G){G.code=="Enter"&&(l!="string"||!G.shiftKey)&&(G.preventDefault(),this.blur())}),g.addEventListener("blur",function(){var G=this.innerText,T=this.parentNode.dataset.property,E=this.parentNode.dataset.type;E=="number"&&(G=Number(G)),L(T,G)})):(l=="enum"||l=="combo")&&(b=__LGraphCanvas.getPropertyPrintableValue(h,u.values),g.innerText=b,(f=LiteGraph.debug)==null||f.call(LiteGraph,"addWidget ENUM COMBO",l,b,g,u),g.addEventListener("click",function(G){var T=u.values||[],E=this.parentNode.dataset.property,C=this;new LiteGraph.ContextMenu(T,{event:G,className:"dark",callback:I},s);function I(D){return C.innerText=D,L(E,D),!1}})),n.content.appendChild(_);function L(G,T){var E;(E=LiteGraph.debug)==null||E.call(LiteGraph,"widgetInnerChange",G,T,u),u.callback&&u.callback(G,T,u),c&&c(G,T,u)}return _},n.onOpen&&typeof n.onOpen=="function"&&n.onOpen(),n}static getPropertyPrintableValue(a,t){if(!t||t.constructor===Array)return String(a);if(t.constructor===Object){var s="";for(var n in t)if(t[n]==a){s=n;break}return String(a)+" ("+s+")"}}closePanels(){var a=document.querySelector("#node-panel");a&&a.close(),a=document.querySelector("#option-panel"),a&&a.close()}showShowGraphOptionsPanel(a,t){var s,n,o,l;let p;if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!((n=(s=t==null?void 0:t.event)==null?void 0:s.target)!=null&&n.lgraphcanvas)){(o=LiteGraph.warn)==null||o.call(LiteGraph,"References not found to add optionPanel",a,t),LiteGraph.debug&&((l=LiteGraph.debug)==null||l.call(LiteGraph,"!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas",t,t.event,t.event.target,t.event.target.lgraphcanvas));return}p=t.event.target.lgraphcanvas}else p=this;p.closePanels();var h=p.getCanvasWindow();panel=p.createPanel("Options",{closable:!0,window:h,onOpen:function(){p.OPTIONPANEL_IS_OPEN=!0},onClose:function(){p.OPTIONPANEL_IS_OPEN=!1,p.options_panel=null}}),p.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function u(){panel.content.innerHTML="";const c=(_,g,L)=>{L&&L.key&&(_=L.key),L.values&&(g=Object.values(L.values).indexOf(g)),p[_]=g};var d=LiteGraph.availableCanvasOptions;d.sort();for(var f in d){var b=d[f];panel.addWidget("boolean",b,p[b],{key:b,on:"True",off:"False"},c)}panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[p.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},c),panel.addSeparator(),panel.footer.innerHTML=""}u(),p.canvas.parentNode.appendChild(panel)}showShowNodePanel(a){this.SELECTED_NODE=a,this.closePanels();var t=this.getCanvasWindow(),s=this,n=this.createPanel(a.title||"",{closable:!0,window:t,onOpen:function(){s.NODEPANEL_IS_OPEN=!0},onClose:function(){s.NODEPANEL_IS_OPEN=!1,s.node_panel=null}});s.node_panel=n,n.id="node-panel",n.node=a,n.classList.add("settings");function o(){n.content.innerHTML="",n.addHTML("<span class='node_type'>"+a.type+"</span><span class='node_desc'>"+(a.constructor.desc||"")+"</span><span class='separator'></span>"),n.addHTML("<h3>Properties</h3>");const l=(d,f)=>{var b,_;switch(s.graph.beforeChange(a),d){case"Title":a.title=f;break;case"Mode":var g=Object.values(LiteGraph.NODE_MODES).indexOf(f);g>=0&&LiteGraph.NODE_MODES[g]?a.changeMode(g):(b=LiteGraph.warn)==null||b.call(LiteGraph,"unexpected mode: "+f);break;case"Color":__LGraphCanvas.node_colors[f]?(a.color=__LGraphCanvas.node_colors[f].color,a.bgcolor=__LGraphCanvas.node_colors[f].bgcolor):(_=LiteGraph.warn)==null||_.call(LiteGraph,"unexpected color: "+f);break;default:a.setProperty(d,f);break}s.graph.afterChange(),s.dirty_canvas=!0};n.addWidget("string","Title",a.title,{},l),n.addWidget("combo","Mode",LiteGraph.NODE_MODES[a.mode],{values:LiteGraph.NODE_MODES},l);var p="";a.color!==void 0&&(p=Object.keys(__LGraphCanvas.node_colors).filter(function(d){return __LGraphCanvas.node_colors[d].color==a.color})),n.addWidget("combo","Color",p,{values:Object.keys(__LGraphCanvas.node_colors)},l);for(var h in a.properties){var u=a.properties[h],c=a.getPropertyInfo(h);a.onAddPropertyToPanel&&a.onAddPropertyToPanel(h,n,u,c,l)||n.addWidget(c.widget||c.type,h,u,c,l)}n.addSeparator(),a.onShowCustomPanelInfo&&a.onShowCustomPanelInfo(n),n.footer.innerHTML="",n.addButton("Delete",function(){a.block_delete||(a.graph.remove(a),n.close())}).classList.add("delete")}n.inner_showCodePad=function(l){n.classList.remove("settings"),n.classList.add("centered"),n.alt_content.innerHTML="<textarea class='code'></textarea>";var p=n.alt_content.querySelector("textarea"),h=()=>{n.toggleAltContent(!1),n.toggleFooterVisibility(!0),p.parentNode.removeChild(p),n.classList.add("settings"),n.classList.remove("centered"),o()};p.value=a.properties[l],p.addEventListener("keydown",function(d){d.code=="Enter"&&d.ctrlKey&&(a.setProperty(l,p.value),h())}),n.toggleAltContent(!0),n.toggleFooterVisibility(!1),p.style.height="calc(100% - 40px)";var u=n.addButton("Assign",function(){a.setProperty(l,p.value),h()});n.alt_content.appendChild(u);var c=n.addButton("Close",h);c.style.float="right",n.alt_content.appendChild(c)},o(),this.canvas.parentNode.appendChild(n)}showSubgraphPropertiesDialog(a){var t;(t=LiteGraph.log)==null||t.call(LiteGraph,"showing subgraph properties dialog");var s=this.canvas.parentNode.querySelector(".subgraph_dialog");s&&s.close();var n=this.createPanel("Subgraph Inputs",{closable:!0,width:500});n.node=a,n.classList.add("subgraph_dialog");function o(){if(n.clear(),a.inputs)for(let d=0;d<a.inputs.length;++d){var h=a.inputs[d];if(!h.not_subgraph_input){var u="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",c=n.addHTML(u,"subgraph_property");c.dataset.name=h.name,c.dataset.slot=d,c.querySelector(".name").innerText=h.name,c.querySelector(".type").innerText=h.type,c.querySelector("button").addEventListener("click",function(f){a.removeInput(Number(this.parentNode.dataset.slot)),o()})}}}var l=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",p=n.addHTML(l,"subgraph_property extra",!0);return p.querySelector("button").addEventListener("click",function(h){var u=this.parentNode,c=u.querySelector(".name").value,d=u.querySelector(".type").value;!c||a.findInputSlot(c)!=-1||(a.addInput(c,d),u.querySelector(".name").value="",u.querySelector(".type").value="",o())}),o(),this.canvas.parentNode.appendChild(n),n}showSubgraphPropertiesDialogRight(a){var t=this.canvas.parentNode.querySelector(".subgraph_dialog");t&&t.close();var s=this.createPanel("Subgraph Outputs",{closable:!0,width:500});s.node=a,s.classList.add("subgraph_dialog");function n(){if(s.clear(),a.outputs)for(let d=0;d<a.outputs.length;++d){var h=a.outputs[d];if(!h.not_subgraph_output){var u="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",c=s.addHTML(u,"subgraph_property");c.dataset.name=h.name,c.dataset.slot=d,c.querySelector(".name").innerText=h.name,c.querySelector(".type").innerText=h.type,c.querySelector("button").addEventListener("click",function(f){a.removeOutput(Number(this.parentNode.dataset.slot)),n()})}}}var o=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",l=s.addHTML(o,"subgraph_property extra",!0);l.querySelector(".name").addEventListener("keydown",function(h){e.keyCode==13&&p.apply(this)}),l.querySelector("button").addEventListener("click",function(h){p.apply(this)});function p(){var h=this.parentNode,u=h.querySelector(".name").value,c=h.querySelector(".type").value;!u||a.findOutputSlot(u)!=-1||(a.addOutput(u,c),h.querySelector(".name").value="",h.querySelector(".type").value="",n())}return n(),this.canvas.parentNode.appendChild(s),s}checkPanels(){if(this.canvas){var a=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(let s=0;s<a.length;++s){var t=a[s];t.node&&(!t.node.graph||t.graph!=this.graph)&&t.close()}}}static onMenuNodeCollapse(a,t,s,n,o){o.graph.beforeChange();var l=function(h){h.collapse()},p=__LGraphCanvas.active_canvas;if(!p.selected_nodes||Object.keys(p.selected_nodes).length<=1)l(o);else for(let h in p.selected_nodes)l(p.selected_nodes[h]);o.graph.afterChange()}static onMenuNodePin(a,t,s,n,o){o.pin()}static onMenuNodeMode(a,t,s,n,o){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:s,callback:l,parentMenu:n,node:o});function l(p){if(!o)return;var h=Object.values(LiteGraph.NODE_MODES).indexOf(p);const u=d=>{var f;h>=0&&LiteGraph.NODE_MODES[h]?d.changeMode(h):((f=LiteGraph.warn)==null||f.call(LiteGraph,"unexpected mode: "+p),d.changeMode(LiteGraph.ALWAYS))};var c=__LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)u(o);else for(let d in c.selected_nodes)u(c.selected_nodes[d])}return!1}static onMenuNodeColors(a,t,s,n,o){if(!o)throw new Error("no node for color");var l=[];l.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(let h in __LGraphCanvas.node_colors){let u=__LGraphCanvas.node_colors[h];a={value:h,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+u.color+"; background-color:"+u.bgcolor+"'>"+h+"</span>"},l.push(a)}new LiteGraph.ContextMenu(l,{event:s,callback:p,parentMenu:n,node:o});function p(h){if(!o)return;let u=h.value?__LGraphCanvas.node_colors[h.value]:null;const c=f=>{u?f.constructor===LiteGraph.LGraphGroup?f.color=u.groupcolor:(f.color=u.color,f.bgcolor=u.bgcolor):(delete f.color,delete f.bgcolor)};var d=__LGraphCanvas.active_canvas;if(!d.selected_nodes||Object.keys(d.selected_nodes).length<=1)c(o);else for(let f in d.selected_nodes)c(d.selected_nodes[f]);o.setDirtyCanvas(!0,!0)}return!1}static onMenuNodeShapes(a,t,s,n,o){if(!o)throw new Error("no node passed");new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:s,callback:l,parentMenu:n,node:o});function l(p){if(!o)return;o.graph.beforeChange();const h=c=>{c.shape=p};var u=__LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)h(o);else for(let c in u.selected_nodes)h(u.selected_nodes[c]);o.graph.afterChange(),o.setDirtyCanvas(!0)}return!1}static onMenuNodeRemove(a,t,s,n,o){if(!o)throw new Error("no node passed");var l=o.graph;l.beforeChange();const p=u=>{u.removable!==!1&&l.remove(u)};var h=__LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)p(o);else for(let u in h.selected_nodes)p(h.selected_nodes[u]);l.afterChange(),o.setDirtyCanvas(!0,!0)}static onMenuNodeToSubgraph(a,t,s,n,o){var l=o.graph,p=__LGraphCanvas.active_canvas;if(p){var h=Object.values(p.selected_nodes||{});h.length||(h=[o]);var u=LiteGraph.createNode("graph/subgraph");u.pos=o.pos.concat(),l.add(u),u.buildFromNodes(h),p.deselectAllNodes(),o.setDirtyCanvas(!0,!0)}}static onMenuNodeClone(a,t,s,n,o){o.graph.beforeChange();var l={};const p=u=>{if(u.clonable!==!1){var c=u.clone();c&&(c.pos=[u.pos[0]+5,u.pos[1]+5],u.graph.add(c),l[c.id]=c)}};var h=__LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)p(o);else for(let u in h.selected_nodes)p(h.selected_nodes[u]);Object.keys(l).length&&h.selectNodes(l),o.graph.afterChange(),o.setDirtyCanvas(!0,!0)}getCanvasMenuOptions(){var a=null;if(this.getMenuOptions?a=this.getMenuOptions():(a=[{content:"Add Node",has_submenu:!0,callback:__LGraphCanvas.onMenuAdd},{content:"Add Group",callback:__LGraphCanvas.onGroupAdd}],LiteGraph.showCanvasOptions&&a.push({content:"Options",callback:this.showShowGraphOptionsPanel}),Object.keys(this.selected_nodes).length>1&&a.push({content:"Align",has_submenu:!0,callback:__LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&a.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var t=this.getExtraMenuOptions(this,a);t&&(a=a.concat(t))}return a}getNodeMenuOptions(a){var t=null;if(a.getMenuOptions?t=a.getMenuOptions(this):(t=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:__LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:__LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:__LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:__LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:__LGraphCanvas.onMenuNodeMode}],a.resizable!==!1&&t.push({content:"Resize",callback:__LGraphCanvas.onMenuResizeNode}),t.push({content:"Collapse",callback:__LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:__LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:__LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:__LGraphCanvas.onMenuNodeShapes},null)),a.onGetInputs){var s=a.onGetInputs();s&&s.length&&(t[0].disabled=!1)}if(a.onGetOutputs){var n=a.onGetOutputs();n&&n.length&&(t[1].disabled=!1)}if(LiteGraph.do_add_triggers_slots&&(t[1].disabled=!1),a.getExtraMenuOptions){var o=a.getExtraMenuOptions(this,t);o&&(o.push(null),t=o.concat(t))}return a.clonable!==!1&&t.push({content:"Clone",callback:__LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&t.push({content:"Align Selected To",has_submenu:!0,callback:__LGraphCanvas.onNodeAlign}),t.push(null,{content:"Remove",disabled:!(a.removable!==!1&&!a.block_delete),callback:__LGraphCanvas.onMenuNodeRemove}),a.graph&&a.graph.onGetNodeMenuOptions&&a.graph.onGetNodeMenuOptions(t,a),t}getGroupMenuOptions(){var a=[{content:"Title",callback:__LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:__LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:__LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:__LGraphCanvas.onMenuNodeRemove}];return a}processContextMenu(a,t){var s,n,o,l=this,p=__LGraphCanvas.active_canvas,h=p.getCanvasWindow(),u=null,c={event:t,callback:g,extra:a};a&&(c.title=a.type);var d=null;if(a&&(d=a.getSlotInPosition(t.canvasX,t.canvasY),__LGraphCanvas.active_node=a),d){if(u=[],a.getSlotMenuOptions)u=a.getSlotMenuOptions(d);else{((n=(s=d==null?void 0:d.output)==null?void 0:s.links)!=null&&n.length||(o=d.input)!=null&&o.link)&&u.push({content:"Disconnect Links",slot:d});var f=d.input||d.output;f.removable&&LiteGraph.canRemoveSlots&&u.push(f.locked?"Cannot remove":{content:"Remove Slot",slot:d}),!f.nameLocked&&LiteGraph.canRenameSlots&&u.push({content:"Rename Slot",slot:d})}var b=d.input||d.output;c.title=b.type||"*",b.type==LiteGraph.ACTION?c.title="Action":b.type==LiteGraph.EVENT&&(c.title="Event")}else if(a)u=this.getNodeMenuOptions(a);else{u=this.getCanvasMenuOptions();var _=this.graph.getGroupOnPos(t.canvasX,t.canvasY);_&&u.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:_,options:this.getGroupMenuOptions(_)}})}if(!u)return;new LiteGraph.ContextMenu(u,c,h);function g(L,G){if(!L)return;let T;if(L.content=="Remove Slot"){T=L.slot,a.graph.beforeChange(),T.input?a.removeInput(T.slot):T.output&&a.removeOutput(T.slot),a.graph.afterChange();return}else if(L.content=="Disconnect Links"){T=L.slot,a.graph.beforeChange(),T.output?a.disconnectOutput(T.slot):T.input&&a.disconnectInput(T.slot),a.graph.afterChange();return}else if(L.content=="Rename Slot"){T=L.slot;var E=T.input?a.getInputInfo(T.slot):a.getOutputInfo(T.slot),C=l.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",G),I=C.querySelector("input");I&&E&&(I.value=E.label||"");var D=function(){a.graph.beforeChange(),I.value&&(E&&(E.label=I.value),l.setDirty(!0)),C.close(),a.graph.afterChange()};C.querySelector("button").addEventListener("click",D),I.addEventListener("keydown",function(R){if(C.is_modified=!0,R.keyCode==27)C.close();else if(R.keyCode==13)D();else if(R.keyCode!=13&&R.target.localName!="textarea")return;R.preventDefault(),R.stopPropagation()}),I.focus()}}}lowQualityRenderingRequired(a){return this.ds.scale<a?this.low_quality_rendering_counter>this.low_quality_rendering_threshold:!1}};m(_LGraphCanvas,"DEFAULT_BACKGROUND_IMAGE","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII="),m(_LGraphCanvas,"link_type_colors",{"-1":"#A86",number:"#AAA",node:"#DCA",string:"#77F",boolean:"#F77"}),m(_LGraphCanvas,"gradients",{}),m(_LGraphCanvas,"search_limit",-1),m(_LGraphCanvas,"node_colors",{red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}});let LGraphCanvas=_LGraphCanvas;var temp=new Float32Array(4),temp_vec2=new Float32Array(2),tmp_area=new Float32Array(4),margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);class DragAndScale{constructor(t,s){m(this,"onMouseDown",n=>{if(!this.enabled)return;const o=this.element.getBoundingClientRect();var l=n.clientX-o.left,p=n.clientY-o.top;n.canvasx=l,n.canvasy=p,n.dragging=this.dragging;var h=!this.viewport||this.viewport&&l>=this.viewport[0]&&l<this.viewport[0]+this.viewport[2]&&p>=this.viewport[1]&&p<this.viewport[1]+this.viewport[3];h&&(this.dragging=!0,this.abortController=new AbortController,document.addEventListener("pointermove",this.onMouseMove,{signal:this.abortController.signal}),document.addEventListener("pointerup",this.onMouseUp,{signal:this.abortController.signal})),this.last_mouse[0]=l,this.last_mouse[1]=p}),m(this,"onMouseMove",n=>{if(!this.enabled)return;const o=this.element.getBoundingClientRect();var l=n.clientX-o.left,p=n.clientY-o.top;n.canvasx=l,n.canvasy=p,n.dragging=this.dragging;var h=l-this.last_mouse[0],u=p-this.last_mouse[1];this.dragging&&this.mouseDrag(h,u),this.last_mouse[0]=l,this.last_mouse[1]=p}),m(this,"onMouseUp",n=>{var o;this.dragging=!1,(o=this.abortController)==null||o.abort()}),m(this,"onWheel",n=>{n.wheel=-n.deltaY,n.delta=n.wheelDelta?n.wheelDelta/40:n.deltaY?-n.deltaY/3:0,this.changeDeltaScale(1+n.delta*.05)}),this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,s||this.bindEvents(t))}bindEvents(t){this.last_mouse=new Float32Array(2),t.addEventListener("pointerdown",this.onMouseDown),t.addEventListener("wheel",this.onWheel)}computeVisibleArea(t){if(!this.element){this.visible_area.set([0,0,0,0]);return}let s=this.element.width,n=this.element.height,o=-this.offset[0],l=-this.offset[1];if(t){o+=t[0]/this.scale,l+=t[1]/this.scale;const[u,c]=t.slice(2);s=u,n=c}const p=o+s/this.scale,h=l+n/this.scale;this.visible_area.set([o,l,p-o,h-l])}toCanvasContext(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]}convertCanvasToOffset(t,s=[0,0]){return s[0]=t[0]/this.scale-this.offset[0],s[1]=t[1]/this.scale-this.offset[1],s}mouseDrag(t,s){var n;this.offset[0]+=t/this.scale,this.offset[1]+=s/this.scale,(n=this.onredraw)==null||n.call(this,this)}changeScale(t,s){var n;if(t=LiteGraph.clamp(t,this.min_scale,this.max_scale),t==this.scale||!this.element)return;const o=this.element.getBoundingClientRect();if(o){s=s||[o.width*.5,o.height*.5];var l=this.convertCanvasToOffset(s);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var p=this.convertCanvasToOffset(s),h=[p[0]-l[0],p[1]-l[1]];this.offset[0]+=h[0],this.offset[1]+=h[1],(n=this.onredraw)==null||n.call(this,this)}}changeDeltaScale(t,s){this.changeScale(this.scale*t,s)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}var j,dt,ft,gt,_t,vt,mt;const ot=class xt{constructor(t,s={}){ct(this,j);var n;this.options=s,(n=s.scroll_speed)!=null||(s.scroll_speed=.1),this.menu_elements=[],st(this,j,gt).call(this),st(this,j,_t).call(this),st(this,j,dt).call(this),st(this,j,ft).call(this),this.setTitle(this.options.title),this.addItems(t),st(this,j,vt).call(this),st(this,j,mt).call(this)}setTitle(t){var s;if(!t)return;(s=this.titleElement)!=null||(this.titleElement=document.createElement("div"));const n=this.titleElement;n.className="litemenu-title",n.innerHTML=t,this.root.parentElement||this.root.appendChild(n)}addItems(t){for(let s=0;s<t.length;s++){let n=t[s];typeof n!="string"&&(n=n&&n.content!==void 0?String(n.content):String(n));let o=t[s];this.menu_elements.push(this.addItem(n,o,this.options))}}addItem(t,s,n={}){var o;const l=document.createElement("div");l.className="litemenu-entry submenu";let p=!1;s===null?l.classList.add("separator"):(l.innerHTML=(o=s==null?void 0:s.title)!=null?o:t,l.value=s,s&&(s.disabled&&(p=!0,l.classList.add("disabled")),(s.submenu||s.has_submenu)&&l.classList.add("has_submenu")),typeof s=="function"?(l.dataset.value=t,l.onclick_callback=s):l.dataset.value=s,s.className&&(l.className+=" "+s.className)),this.root.appendChild(l),p||l.addEventListener("click",u),!p&&n.autoopen&&l.addEventListener("pointerenter",c=>{const d=this.value;!d||!d.has_submenu||u.call(this,c)});var h=this;function u(c){var d,f,b,_,g;const L=this.value;let G=!0;if((d=LiteGraph.debug)==null||d.call(LiteGraph,"ContextMenu handleMenuItemClick",L,n,G,this.current_submenu,this),(f=h.current_submenu)==null||f.close(c),n.callback&&((b=LiteGraph.debug)==null||b.call(LiteGraph,"ContextMenu handleMenuItemClick callback",this,L,n,c,h,n.node),n.callback.call(this,L,n,c,h,n.node)===!0&&(G=!1)),L&&(L.callback&&!n.ignore_item_callbacks&&L.disabled!==!0&&((_=LiteGraph.debug)==null||_.call(LiteGraph,"ContextMenu using value callback and !ignore_item_callbacks",this,L,n,c,h,n.node),L.callback.call(this,L,n,c,h,n.extra)===!0&&(G=!1)),L.submenu)){if((g=LiteGraph.debug)==null||g.call(LiteGraph,"ContextMenu SUBMENU",this,L,L.submenu.options,e,h,n),!L.submenu.options)throw new Error("ContextMenu submenu needs options");new h.constructor(L.submenu.options,{callback:L.submenu.callback,event:c,parentMenu:h,ignore_item_callbacks:L.submenu.ignore_item_callbacks,title:L.submenu.title,extra:L.submenu.extra,autoopen:n.autoopen}),G=!1}G&&!h.lock&&h.close()}return l}close(t,s){var n,o;if(this.root.f_textfilter){const l=this._filterDoc||((n=t==null?void 0:t.target)==null?void 0:n.ownerDocument)||document;l.removeEventListener("keydown",this.root.f_textfilter,!0),l.removeEventListener("keydown",this.root.f_textfilter,!1),this._filterDoc=null}this.parentMenu&&!s&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,t===void 0?this.parentMenu.close():t&&!xt.isCursorOverElement(t,this.parentMenu.root)&&xt.trigger(this.parentMenu.root,"pointerleave",t)),(o=this.current_submenu)==null||o.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer),this.root.parentNode&&this.root.parentNode.removeChild(this.root)}static trigger(t,s,n,o){const l=new CustomEvent(s,{bubbles:!0,cancelable:!0,detail:n});return o&&Object.defineProperty(l,"litegraphTarget",{value:o}),t.dispatchEvent?t.dispatchEvent(l):t.__events&&t.__events.dispatchEvent(l),l}getTopMenu(){var t,s;return(s=(t=this.options.parentMenu)==null?void 0:t.getTopMenu())!=null?s:this}getFirstEvent(){var t,s;return(s=(t=this.options.parentMenu)==null?void 0:t.getFirstEvent())!=null?s:this.options.event}static isCursorOverElement(t,s){return LiteGraph.isInsideRectangle(t.clientX,t.clientY,s.left,s.top,s.width,s.height)}};j=new WeakSet,dt=function(){const a=this.root=document.createElement("div");return this.options.className&&(a.className=this.options.className),a.classList.add("litegraph","litecontextmenu","litemenubar-panel"),a.style.minWidth="80px",a.style.minHeight="10px",a},ft=function(){const a=this.root;a.style.pointerEvents="none",setTimeout(()=>{a.style.pointerEvents="auto"},100),a.addEventListener("pointerup",t=>(t.preventDefault(),!0)),a.addEventListener("contextmenu",t=>(t.button!=2||t.preventDefault(),!1)),a.addEventListener("pointerdown",t=>{if(t.button==2)return this.close(),t.preventDefault(),!0}),a.addEventListener("wheel",t=>{var s=parseInt(a.style.top);return a.style.top=(s+t.deltaY*this.options.scroll_speed).toFixed()+"px",t.preventDefault(),!0}),a.addEventListener("pointerenter",t=>{a.closing_timer&&clearTimeout(a.closing_timer)})},gt=function(){var a;const t=this.options.parentMenu;if(t){if(t.constructor!==this.constructor){(a=LiteGraph.error)==null||a.call(LiteGraph,"parentMenu must be of class ContextMenu, ignoring it"),this.options.parentMenu=null;return}this.parentMenu=t,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this}},_t=function(){var a;if(!this.options.event)return;const t=this.options.event.constructor.name;t!=="MouseEvent"&&t!=="CustomEvent"&&t!=="PointerEvent"&&((a=LiteGraph.error)==null||a.call(LiteGraph,`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${t})`),this.options.event=null)},vt=function(){var a,t,s,n;const o=(t=(a=this.options.event)==null?void 0:a.target.ownerDocument)!=null?t:document,l=(s=o.fullscreenElement)!=null?s:o.body,p=this.root,h=this;LiteGraph.context_menu_filter_enabled&&!this.options.parentMenu&&(o?(p.f_textfilter&&(o.removeEventListener("keydown",p.f_textfilter,!1),o.removeEventListener("keydown",p.f_textfilter,!0),p.f_textfilter=!1),p.f_textfilter=function(u){var c,d,f,b,_,g,L;if(h.current_submenu){(c=LiteGraph.debug)==null||c.call(LiteGraph,"Prevent filtering on ParentMenu",h);return}if(h.allOptions||(h.allOptions=h.menu_elements,h.selectedOption=!1),h.currentOptions||(h.currentOptions=h.allOptions),h.filteringText||(h.filteringText=""),u.key){var G=!1;switch(u.key){case"Backspace":h.filteringText.length&&(h.filteringText=h.filteringText.substring(0,h.filteringText.length-1),G=!0);break;case"Escape":p.f_textfilter&&(o.removeEventListener("keydown",p.f_textfilter,!1),o.removeEventListener("keydown",p.f_textfilter,!0),p.f_textfilter=!1),h.close();break;case"ArrowDown":do h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption+1,0),h.allOptions.length-1):0;while(h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.selectedOption<h.allOptions.length-1);h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&(h.selectedOption=h.currentOptions[h.currentOptions.length-1].menu_index),G=!0;break;case"ArrowUp":do h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption-1,0),h.allOptions.length-1):0;while(h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.selectedOption>0);h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&(h.currentOptions&&h.currentOptions.length?h.selectedOption=h.currentOptions[0].menu_index:h.selectedOption=!1),G=!0;break;case"ArrowLeft":break;case"ArrowRight":case"Enter":if(h.selectedOption!==!1)h.allOptions[h.selectedOption]?((d=LiteGraph.debug)==null||d.call(LiteGraph,"ContextElement simCLICK",h.allOptions[h.selectedOption]),h.allOptions[h.selectedOption].do_click&&h.allOptions[h.selectedOption].do_click(h.options.event,T)):((f=LiteGraph.debug)==null||f.call(LiteGraph,"ContextElement selection wrong",h.selectedOption),h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption,0),h.allOptions.length-1):0);else if(h.filteringText.length){for(let O in h.allOptions)if(h.allOptions[O].style.display!=="none"&&!(h.allOptions[O].classList+"").includes("separator")&&h.allOptions[O].textContent!=="Search"){(b=LiteGraph.debug)==null||b.call(LiteGraph,"ContextElement simCLICK",h.allOptions[O]),p.f_textfilter&&o&&(o.removeEventListener("keydown",p.f_textfilter,!1),o.removeEventListener("keydown",p.f_textfilter,!0),(_=LiteGraph.debug)==null||_.call(LiteGraph,"Cleaned ParentContextMenu listener",o,h));var T=!1;h.allOptions[O].do_click(u,T);break}}G=!0;break;default:(g=LiteGraph.debug)==null||g.call(LiteGraph,"ContextMenu filter: keyEvent",u.key);break}!G&&u.key.length==1&&(h.filteringText+=u.key,h.parentMenu)}if(h.filteringText&&h.filteringText!==""){var E=[];h.currentOptions=[];for(let O in h.allOptions){var C=h.allOptions[O].textContent,I=C.toLocaleLowerCase().includes(h.filteringText.toLocaleLowerCase()),D=C.toLocaleLowerCase().startsWith(h.filteringText.toLocaleLowerCase()),R=C.split("/"),P=!1;P=R.length>1&&R[R.length-1].toLocaleLowerCase().startsWith(h.filteringText.toLocaleLowerCase())||R.length==1&&D;var N=(h.allOptions[O].classList+"").includes("separator")||C==="Search";h.allOptions[O].menu_index=O,I&&!N?(E.push(h.allOptions[O]),h.allOptions[O].style.display="block",h.allOptions[O].hidden=!1,h.currentOptions.push(h.allOptions[O]),h.allOptions[O].filtered_index=h.currentOptions.length-1):(h.allOptions[O].hidden=!0,h.allOptions[O].style.display="none",h.allOptions[O].filtered_index=!1),P?h.allOptions[O].style.fontWeight="bold":D&&(h.allOptions[O].style.fontStyle="italic")}h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption,0),h.allOptions.length-1):0,h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.currentOptions.length&&(h.selectedOption=h.currentOptions[0].menu_index)}else{E=h.allOptions,h.currentOptions=h.allOptions;for(let O in h.allOptions)h.allOptions[O].style.display="block",h.allOptions[O].style.fontStyle="inherit",h.allOptions[O].style.fontWeight="inherit",h.allOptions[O].hidden=!1,h.allOptions[O].filtered_index=!1,h.allOptions[O].menu_index=O}var A=h.selectedOption!==!1;if(A){(L=LiteGraph.debug)==null||L.call(LiteGraph,"ContextMenu selection: ",h.selectedOption);for(let O in h.allOptions){var S=h.selectedOption+""==O+"";S?h.allOptions[O].classList.add("selected"):h.allOptions[O].classList.remove("selected")}}document.body.getBoundingClientRect(),p.getBoundingClientRect(),p.style.top=h.top_original+"px"},o.removeEventListener("keydown",p.f_textfilter,!0),o.addEventListener("keydown",p.f_textfilter,!0),this._filterDoc=o):(n=LiteGraph.warn)==null||n.call(LiteGraph,"NO root document to add context menu and event",o,options)),l.appendChild(this.root)},mt=function(){var a;const t=this.options,s=this.root;let n=t.left||0,o=t.top||0;if(this.top_original=o,t.event){if(n=t.event.clientX-10,o=t.event.clientY-10,t.title&&(o-=20),this.top_original=o,t.parentMenu){const h=t.parentMenu.root.getBoundingClientRect();n=h.left+h.width}const l=document.body.getBoundingClientRect(),p=s.getBoundingClientRect();l.height===0&&((a=LiteGraph.error)==null||a.call(LiteGraph,"document.body height is 0. That is dangerous, set html,body { height: 100%; }")),l.width&&n>l.width-p.width-10&&(n=l.width-p.width-10),l.height&&o>l.height-p.height-10&&(o=l.height-p.height-10)}s.style.left=`${n}px`,s.style.top=`${o}px`,t.scale&&(s.style.transform=`scale(${t.scale})`)},m(ot,"closeAll",(a=window)=>{const t=a.document.querySelectorAll(".litecontextmenu");t.length&&t.forEach(s=>{var n;s.close?s.close():(n=s.parentNode)==null||n.removeChild(s)})});let ContextMenu=ot;var LiteGraph=new class{constructor(){m(this,"extendClass",(a,t)=>{for(let s in t)a.hasOwnProperty(s)||(a[s]=t[s]);if(t.prototype)for(let s in t.prototype)t.prototype.hasOwnProperty(s)&&(a.prototype.hasOwnProperty(s)||(t.prototype.__lookupGetter__(s)?a.prototype.__defineGetter__(s,t.prototype.__lookupGetter__(s)):a.prototype[s]=t.prototype[s],t.prototype.__lookupSetter__(s)&&a.prototype.__defineSetter__(s,t.prototype.__lookupSetter__(s))))}),m(this,"getParameterNames",a=>(a+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)),m(this,"clamp",(a,t,s)=>t>a?t:s<a?s:a),m(this,"pointer_to_mouse_events",Object.freeze({pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mouseup",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"})),m(this,"mouse_to_pointer_events",Object.freeze({mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseenter:"pointerenter",mouseleave:"pointerleave"})),m(this,"pointerAddListener",(a,t,s,n)=>{if(!(a!=null&&a.addEventListener)||typeof s!="function")return!1;const o=this.resolvePointerEventName(t);return a.addEventListener(o,s,n),!0}),m(this,"pointerRemoveListener",(a,t,s,n)=>{if(!(a!=null&&a.removeEventListener)||typeof s!="function")return!1;const o=this.resolvePointerEventName(t);return a.removeEventListener(o,s,n),!0}),m(this,"closeAllContextMenus",()=>{LiteGraph.warn("LiteGraph.closeAllContextMenus is deprecated in favor of ContextMenu.closeAll()"),ContextMenu.closeAll()}),this.VERSION="0.10.2",this.LLink=LLink,this.LGraph=LGraph,this.LGraphNode=LGraphNode,this.LGraphGroup=LGraphGroup,this.LGraphCanvas=LGraphCanvas,this.DragAndScale=DragAndScale,this.ContextMenu=ContextMenu,this.CANVAS_GRID_SIZE=10,this.NODE_TITLE_HEIGHT=30,this.NODE_TITLE_TEXT_Y=20,this.NODE_SLOT_HEIGHT=20,this.NODE_WIDGET_HEIGHT=20,this.NODE_WIDTH=140,this.NODE_MIN_WIDTH=50,this.NODE_COLLAPSED_RADIUS=10,this.NODE_COLLAPSED_WIDTH=80,this.NODE_TITLE_COLOR="#999",this.NODE_SELECTED_TITLE_COLOR="#FFF",this.NODE_TEXT_SIZE=14,this.NODE_TEXT_COLOR="#AAA",this.NODE_SUBTEXT_SIZE=12,this.NODE_DEFAULT_COLOR="#333",this.NODE_DEFAULT_BGCOLOR="#353535",this.NODE_DEFAULT_BOXCOLOR="#666",this.NODE_DEFAULT_SHAPE="box",this.NODE_BOX_OUTLINE_COLOR="#FFF",this.DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)",this.DEFAULT_GROUP_FONT=24,this.WIDGET_BGCOLOR="#222",this.WIDGET_OUTLINE_COLOR="#666",this.WIDGET_TEXT_COLOR="#DDD",this.WIDGET_SECONDARY_TEXT_COLOR="#999",this.LINK_COLOR="#9A9",this.EVENT_LINK_COLOR="#A86",this.CONNECTING_LINK_COLOR="#AFA",this.MAX_NUMBER_OF_NODES=1e3,this.DEFAULT_POSITION=[100,100],this.VALID_SHAPES=["default","box","round","card"],this.BOX_SHAPE=1,this.ROUND_SHAPE=2,this.CIRCLE_SHAPE=3,this.CARD_SHAPE=4,this.ARROW_SHAPE=5,this.GRID_SHAPE=6,this.INPUT=1,this.OUTPUT=2,this.EVENT=-1,this.ACTION=-1,this.NODE_MODES=["Always","On Event","Never","On Trigger","On Request"],this.NODE_MODES_COLORS=["#666","#422","#333","#224","#626"],this.ALWAYS=0,this.ON_EVENT=1,this.NEVER=2,this.ON_TRIGGER=3,this.ON_REQUEST=4,this.UP=1,this.DOWN=2,this.LEFT=3,this.RIGHT=4,this.CENTER=5,this.LINK_RENDER_MODES=["Straight","Linear","Spline"],this.STRAIGHT_LINK=0,this.LINEAR_LINK=1,this.SPLINE_LINK=2,this.NORMAL_TITLE=0,this.NO_TITLE=1,this.TRANSPARENT_TITLE=2,this.AUTOHIDE_TITLE=3,this.VERTICAL_LAYOUT="vertical",this.proxy=null,this.node_images_path="",this.catch_exceptions=!0,this.throw_errors=!0,this.allow_scripts=!1,this.use_deferred_actions=!0,this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.Globals={},this.searchbox_extras={},this.auto_sort_node_types=!1,this.node_box_coloured_when_on=!1,this.node_box_coloured_by_mode=!1,this.dialog_close_on_mouse_leave=!0,this.dialog_close_on_mouse_leave_delay=500,this.shift_click_do_break_link_from=!1,this.click_do_break_link_to=!1,this.search_hide_on_mouse_leave=!0,this.search_filter_enabled=!1,this.search_show_all_on_open=!0,this.applyPointerDefaults(),this.show_node_tooltip=!1,this.show_node_tooltip_use_descr_property=!1,this.auto_load_slot_types=!1,this.registered_slot_in_types={},this.registered_slot_out_types={},this.slot_types_in=[],this.slot_types_out=[],this.slot_types_default_in=[],this.slot_types_default_out=[],this.graphDefaultConfig={align_to_grid:!0,links_ontop:!1},this.alt_drag_do_clone_nodes=!1,this.alt_shift_drag_connect_clone_with_input=!0,this.do_add_triggers_slots=!1,this.allow_multi_output_for_events=!0,this.middle_click_slot_add_default_node=!1,this.release_link_on_empty_shows_menu=!1,this.two_fingers_opens_menu=!1,this.backspace_delete=!0,this.ctrl_shift_v_paste_connect_unselected_outputs=!1,this.actionHistory_enabled=!1,this.actionHistoryMaxSave=40,this.refreshAncestorsOnTriggers=!1,this.refreshAncestorsOnActions=!1,this.ensureUniqueExecutionAndActionCall=!1,this.use_uuids=!1,this.context_menu_filter_enabled=!1,this.showCanvasOptions=!1,this.availableCanvasOptions=["allow_addOutSlot_onExecuted","free_resize","highquality_render","use_gradients","pause_rendering","clear_background","read_only","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","move_destination_link_without_shift","set_canvas_dirty_on_mouse_event","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip"],this.actionHistoryMaxSave=40,this.canRemoveSlots=!0,this.canRemoveSlots_onlyOptional=!0,this.canRenameSlots=!0,this.canRenameSlots_onlyOptional=!0,this.ensureNodeSingleExecution=!1,this.ensureNodeSingleAction=!1,this.preventAncestorRecalculation=!1,this.ensureUniqueExecutionAndActionCall=!0,this.allowMultiOutputForEvents=!1,this.log_methods=["error","warn","info","log","debug"],this.logging_set_level(2)}logging_set_level(a){this.debug_level=Number(a)}logging(a){if(a>this.debug_level)return;function t(n){let o=[];for(let l=1;l<n.length;l++)typeof n[l]!="undefined"&&o.push(n[l]);return o}let s="debug";if(a>=0&&a<=4&&(s=["error","warn","info","log","debug"][a]),typeof console[s]!="function")throw console.warn("[LG-log] invalid console method",s,t(arguments)),new RangeError;console[s]("[LG]",...t(arguments))}error(){this.logging(0,...arguments)}warn(){this.logging(1,...arguments)}info(){this.logging(2,...arguments)}log(){this.logging(3,...arguments)}debug(){this.logging(4,...arguments)}registerNodeType(a,t){var s,n,o,l,p,h,u;if(!t.prototype)throw new Error("Cannot register a simple object, it must be a class with a prototype");t.type=a,(s=this.debug)==null||s.call(this,"registerNodeType","start",a);const c=t.name,d=a.lastIndexOf("/");t.category=a.substring(0,d),t.title||(t.title=c);const f=Object.getOwnPropertyDescriptors(LGraphNode.prototype);Object.keys(f).forEach(L=>{t.prototype.hasOwnProperty(L)||Object.defineProperty(t.prototype,L,f[L])});const b=this.registered_node_types[a];if(b&&((n=this.debug)==null||n.call(this,"registerNodeType","replacing node type",a,b)),!Object.prototype.hasOwnProperty.call(t.prototype,"shape")&&(Object.defineProperty(t.prototype,"shape",{set:function(L){switch(L){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=L}},get:function(){return this._shape},enumerable:!0,configurable:!0}),t.supported_extensions))for(let L in t.supported_extensions){const G=t.supported_extensions[L];G&&G.constructor===String&&(this.node_types_by_file_extension[G.toLowerCase()]=t)}if(this.registered_node_types[a]=t,t.constructor.name&&(this.Nodes[c]=t),(o=LiteGraph.onNodeTypeRegistered)==null||o.call(LiteGraph,a,t),b&&((l=LiteGraph.onNodeTypeReplaced)==null||l.call(LiteGraph,a,t,b)),t.prototype.onPropertyChange&&LiteGraph.warn("LiteGraph node class "+a+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),t.supported_extensions)for(var _=0;_<t.supported_extensions.length;_++){var g=t.supported_extensions[_];g&&g.constructor===String&&(this.node_types_by_file_extension[g.toLowerCase()]=t)}(p=this.debug)==null||p.call(this,"registerNodeType","type registered",a),this.auto_load_slot_types&&((h=this.debug)==null||h.call(this,"registerNodeType","do auto_load_slot_types",a)),new t((u=t.title)!=null?u:"tmpnode")}unregisterNodeType(a){const t=a.constructor===String?this.registered_node_types[a]:a;if(!t)throw new Error("node type not found: "+a);delete this.registered_node_types[t.type],t.constructor.name&&delete this.Nodes[t.constructor.name]}registerNodeAndSlotType(a,t,s=!1){const n=(a.constructor===String&&this.registered_node_types[a]!=="anonymous"?this.registered_node_types[a]:a).constructor.type;let o=[];typeof t=="string"?o=t.split(","):t==this.EVENT||t==this.ACTION?o=["_event_"]:o=["*"];for(let l=0;l<o.length;++l){let p=o[l];p===""&&(p="*");const h=s?"registered_slot_out_types":"registered_slot_in_types";this[h][p]===void 0&&(this[h][p]={nodes:[]}),this[h][p].nodes.includes(n)||this[h][p].nodes.push(n),s?this.slot_types_out.includes(p.toLowerCase())||(this.slot_types_out.push(p.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(p.toLowerCase())||(this.slot_types_in.push(p.toLowerCase()),this.slot_types_in.sort())}}buildNodeClassFromObject(a,t){var s="";if(t.inputs)for(let o=0;o<t.inputs.length;++o){let l=t.inputs[o][0],p=t.inputs[o][1];p&&p.constructor===String&&(p='"'+p+'"'),s+="this.addInput('"+l+"',"+p+`);
`}if(t.outputs)for(let o=0;o<t.outputs.length;++o){let l=t.outputs[o][0],p=t.outputs[o][1];p&&p.constructor===String&&(p='"'+p+'"'),s+="this.addOutput('"+l+"',"+p+`);
`}if(t.properties)for(let o in t.properties){let l=t.properties[o];l&&l.constructor===String&&(l='"'+l+'"'),s+="this.addProperty('"+o+"',"+l+`);
`}s+="if(this.onCreate)this.onCreate()";var n=Function(s);for(let o in t)o!="inputs"&&o!="outputs"&&o!="properties"&&(n.prototype[o]=t[o]);return n.title=t.title||a.split("/").pop(),n.desc=t.desc||"Generated from object",this.registerNodeType(a,n),n}wrapFunctionAsNode(a,t,s,n,o){const l=LiteGraph.getParameterNames(t),p=l.map((d,f)=>{const b=s!=null&&s[f]?`'${s[f]}'`:"0";return`this.addInput('${d}', ${b});`}).join(`
`),h=n?`'${n}'`:0,u=o?`this.properties = ${JSON.stringify(o)};`:"",c=new Function(`
            ${p}
            this.addOutput('out', ${h});
            ${u}
        `);return c.title=a.split("/").pop(),c.desc=`Generated from ${t.name}`,c.prototype.onExecute=function(){const d=l.map((b,_)=>this.getInputData(_)),f=t.apply(this,d);this.setOutputData(0,f)},this.registerNodeType(a,c),c}clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}}addNodeMethod(a,t){LGraphNode.prototype[a]=t;for(var s in this.registered_node_types){var n=this.registered_node_types[s];n.prototype[a]&&(n.prototype["_"+a]=n.prototype[a]),n.prototype[a]=t}}createNode(a,t,s={}){var n,o,l,p,h,u,c,d,f,b,_,g;const L=(n=this.registered_node_types[a])!=null?n:null;if(!L)return(o=this.log)==null||o.call(this,`GraphNode type "${a}" not registered.`),null;t=(l=t!=null?t:L.title)!=null?l:a;let G=null;if(LiteGraph.catch_exceptions)try{G=new L(t)}catch(T){return(p=this.error)==null||p.call(this,T),null}else G=new L(t);return G.type=a,(h=G.title)!=null||(G.title=t),(u=G.properties)!=null||(G.properties={}),(c=G.properties_info)!=null||(G.properties_info=[]),(d=G.flags)!=null||(G.flags={}),(f=G.size)!=null||(G.size=G.computeSize()),(b=G.pos)!=null||(G.pos=LiteGraph.DEFAULT_POSITION.concat()),(_=G.mode)!=null||(G.mode=LiteGraph.ALWAYS),Object.assign(G,s),(g=G.onNodeCreated)==null||g.call(G),G}getNodeType(a){return this.registered_node_types[a]}getNodeTypesInCategory(a,t){const s=Object.values(this.registered_node_types).filter(n=>n.filter!==t?!1:a===""?n.category===null:n.category===a);return this.auto_sort_node_types&&s.sort((n,o)=>n.title.localeCompare(o.title)),s}getNodeTypesCategories(a){const t={"":1};Object.values(this.registered_node_types).forEach(n=>{n.category&&!n.skip_list&&n.filter===a&&(t[n.category]=1)});const s=Object.keys(t);return this.auto_sort_node_types?s.sort():s}reloadNodes(a){var t,s,n,o=document.getElementsByTagName("script"),l=[];for(let c=0;c<o.length;c++)l.push(o[c]);var p=document.getElementsByTagName("head")[0];a=document.location.href+a;for(let c=0;c<l.length;c++){var h=l[c].src;if(!(!h||h.substr(0,a.length)!=a))try{(t=this.log)==null||t.call(this,"Reloading: "+h);var u=document.createElement("script");u.type="text/javascript",u.src=h,p.appendChild(u),p.removeChild(l[c])}catch(d){if(LiteGraph.throw_errors)throw d;(s=this.log)==null||s.call(this,"Error while reloading "+h)}}(n=this.log)==null||n.call(this,"Nodes reloaded")}cloneObject(a,t){if(a==null)return null;const s=JSON.parse(JSON.stringify(a));if(!t)return s;for(const n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);return t}uuidv4(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,a=>(a^Math.random()*16>>a/4).toString(16))}isValidConnection(a,t){if((a===""||a==="*")&&(a=0),(t===""||t==="*")&&(t=0),!a||!t||a===t||a===LiteGraph.EVENT&&t===LiteGraph.ACTION)return!0;if(a=String(a).toLowerCase(),t=String(t).toLowerCase(),!a.includes(",")&&!t.includes(","))return a===t;const s=a.split(","),n=t.split(",");for(const o of s)for(const l of n)if(this.isValidConnection(o,l))return!0;return!1}registerSearchboxExtra(a,t,s){this.searchbox_extras[t.toLowerCase()]={type:a,desc:t,data:s}}fetchFile(a,t,s,n){if(!a)return null;if(t=t||"text",a.constructor===String)return a.substr(0,4)=="http"&&LiteGraph.proxy&&(a=LiteGraph.proxy+a.substr(a.indexOf(":")+3)),fetch(a).then(l=>{if(!l.ok)throw new Error("File not found");if(t=="arraybuffer")return l.arrayBuffer();if(t=="text"||t=="string")return l.text();if(t=="json")return l.json();if(t=="blob")return l.blob()}).then(l=>{s&&s(l)}).catch(l=>{var p;(p=this.error)==null||p.call(this,"error fetching file:",a),n&&n(l)});if(a.constructor===File||a.constructor===Blob){var o=new FileReader;if(o.onload=l=>{var p=l.target.result;t=="json"&&(p=JSON.parse(p)),s&&s(p)},t=="arraybuffer")return o.readAsArrayBuffer(a);if(t=="text"||t=="json")return o.readAsText(a);if(t=="blob")return o.readAsBinaryString(a)}return null}applyPointerDefaults(){typeof window=="undefined"||typeof window.matchMedia!="function"||window.matchMedia("(pointer: coarse)").matches&&(this.dialog_close_on_mouse_leave=!1,this.search_hide_on_mouse_leave=!1)}compareObjects(a,t){const s=Object.keys(a);return s.length!==Object.keys(t).length?!1:s.every(n=>a[n]===t[n])}distance(a,t){const[s,n]=a,[o,l]=t;return Math.sqrt((o-s)**2+(l-n)**2)}colorToString(a){return"rgba("+Math.round(a[0]*255).toFixed()+","+Math.round(a[1]*255).toFixed()+","+Math.round(a[2]*255).toFixed()+","+(a.length==4?a[3].toFixed(2):"1.0")+")"}canvasFillTextMultiline(a,t,s,n,o,l){var p=(t+"").trim().split(" "),h="",u={lines:[],maxW:0,height:0};if(p.length>1)for(var c=0;c<p.length;c++){var d=h+p[c]+" ",f=a.measureText(d),b=f.width;b>o&&c>0?(a.fillText(h,s,n+l*u.lines.length),h=p[c]+" ",u.max=b,u.lines.push(h)):h=d}else h=p[0];return a.fillText(h,s,n+l*u.lines.length),u.lines.push(h),u.height=l*u.lines.length||l,u}isInsideRectangle(a,t,s,n,o,l){return a>s&&a<s+o&&t>n&&t<n+l}growBounding(a,t,s){t<a[0]?a[0]=t:t>a[2]&&(a[2]=t),s<a[1]?a[1]=s:s>a[3]&&(a[3]=s)}isInsideBounding(a,t){return a[0]>=t[0][0]&&a[1]>=t[0][1]&&a[0]<=t[1][0]&&a[1]<=t[1][1]}overlapBounding(a,t){const s=a[0]+a[2],n=a[1]+a[3],o=t[0]+t[2],l=t[1]+t[3];return!(a[0]>o||a[1]>l||s<t[0]||n<t[1])}hex2num(a){a.charAt(0)=="#"&&(a=a.slice(1)),a=a.toUpperCase();for(var t="0123456789ABCDEF",s=new Array(3),n=0,o,l,p=0;p<6;p+=2)o=t.indexOf(a.charAt(p)),l=t.indexOf(a.charAt(p+1)),s[n]=o*16+l,n++;return s}num2hex(a){for(var t="0123456789ABCDEF",s="#",n,o,l=0;l<3;l++)n=a[l]/16,o=a[l]%16,s+=t.charAt(n)+t.charAt(o);return s}resolvePointerEventName(a){if(typeof a!="string")return a;const t=a.toLowerCase(),s=this.pointerevents_method;return s==="mouse"?this.pointer_to_mouse_events[t]||t:s==="pointer"&&this.mouse_to_pointer_events[t]||t}set pointerevents_method(a){const t=typeof a=="string"?a.toLowerCase():"";if(t==="mouse"||t==="pointer"){this._pointerevents_method=t;return}this._pointerevents_method="pointer"}get pointerevents_method(){return this._pointerevents_method||"pointer"}};typeof performance!="undefined"?LiteGraph.getTime=performance.now.bind(performance):typeof Date!="undefined"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process!="undefined"?LiteGraph.getTime=()=>{var a=process.hrtime();return a[0]*.001+a[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()},typeof window!="undefined"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||(a=>{window.setTimeout(a,1e3/60)}));class Time{constructor(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}onExecute(){this.setOutputData(0,this.graph.globaltime*1e3),this.setOutputData(1,this.graph.globaltime)}}m(Time,"title","Time"),m(Time,"desc","Time"),LiteGraph.registerNodeType("basic/time",Time);class Subgraph{constructor(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new LiteGraph.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}onGetInputs(){return[["enabled","boolean"]]}onDblClick(t,s,n){var o=this;setTimeout(function(){n.openSubgraph(o.subgraph)},10)}onAction(t,s){this.subgraph.onAction(t,s)}onExecute(){if(this.enabled=this.getInputOrProperty("enabled"),!!this.enabled){if(this.inputs)for(let t=0;t<this.inputs.length;t++){let s=this.inputs[t],n=this.getInputData(t);this.subgraph.setInputData(s.name,n)}if(this.subgraph.runStep(),this.outputs)for(let t=0;t<this.outputs.length;t++){let s=this.outputs[t],n=this.subgraph.getOutputData(s.name);this.setOutputData(t,n)}}}sendEventToAllNodes(t,s,n){this.enabled&&this.subgraph.sendEventToAllNodes(t,s,n)}onDrawBackground(t,s,n,o){if(this.flags.collapsed)return;var l=this.size[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,p=LiteGraph.isInsideRectangle(o[0],o[1],this.pos[0],this.pos[1]+l,this.size[0],LiteGraph.NODE_TITLE_HEIGHT);let h=LiteGraph.isInsideRectangle(o[0],o[1],this.pos[0],this.pos[1]+l,this.size[0]/2,LiteGraph.NODE_TITLE_HEIGHT);t.fillStyle=p?"#555":"#222",t.beginPath(),this._shape==LiteGraph.BOX_SHAPE?h?t.rect(0,l,this.size[0]/2+1,LiteGraph.NODE_TITLE_HEIGHT):t.rect(this.size[0]/2,l,this.size[0]/2+1,LiteGraph.NODE_TITLE_HEIGHT):h?t.roundRect(0,l,this.size[0]/2+1,LiteGraph.NODE_TITLE_HEIGHT,[0,0,8,8]):t.roundRect(this.size[0]/2,l,this.size[0]/2+1,LiteGraph.NODE_TITLE_HEIGHT,[0,0,8,8]),p?t.fill():t.fillRect(0,l,this.size[0]+1,LiteGraph.NODE_TITLE_HEIGHT),t.textAlign="center",t.font="24px Arial",t.fillStyle=p?"#DDD":"#999",t.fillText("+",this.size[0]*.25,l+24),t.fillText("+",this.size[0]*.75,l+24)}onMouseDown(t,s,n){var o,l,p,h=this.size[1]-LiteGraph.NODE_TITLE_HEIGHT+.5;(o=console.log)==null||o.call(console,0),s[1]>h&&(s[0]<this.size[0]/2?((l=console.log)==null||l.call(console,1),n.showSubgraphPropertiesDialog(this)):((p=console.log)==null||p.call(console,2),n.showSubgraphPropertiesDialogRight(this)))}computeSize(){var t=this.inputs?this.inputs.length:0,s=this.outputs?this.outputs.length:0;return[200,Math.max(t,s)*LiteGraph.NODE_SLOT_HEIGHT+LiteGraph.NODE_TITLE_HEIGHT]}onSubgraphTrigger(t){var s=this.findOutputSlot(t);s!=-1&&this.triggerSlot(s)}onSubgraphNewInput(t,s){var n=this.findInputSlot(t);n==-1&&this.addInput(t,s)}onSubgraphRenamedInput(t,s){var n=this.findInputSlot(t);if(n!=-1){var o=this.getInputInfo(n);o.name=s}}onSubgraphTypeChangeInput(t,s){var n=this.findInputSlot(t);if(n!=-1){var o=this.getInputInfo(n);o.type=s}}onSubgraphRemovedInput(t){var s=this.findInputSlot(t);s!=-1&&this.removeInput(s)}onSubgraphNewOutput(t,s){var n=this.findOutputSlot(t);n==-1&&this.addOutput(t,s)}onSubgraphRenamedOutput(t,s){var n=this.findOutputSlot(t);if(n!=-1){var o=this.getOutputInfo(n);o.name=s}}onSubgraphTypeChangeOutput(t,s){var n=this.findOutputSlot(t);if(n!=-1){var o=this.getOutputInfo(n);o.type=s}}onSubgraphRemovedOutput(t){var s=this.findOutputSlot(t);s!=-1&&this.removeOutput(s)}getExtraMenuOptions(t){var s=this;return[{content:"Open",callback:function(){t.openSubgraph(s.subgraph)}}]}onResize(t){t[1]+=20}serialize(){var t=LiteGraph.LGraphNode.prototype.serialize.call(this);return t.subgraph=this.subgraph.serialize(),t}reassignSubgraphUUIDs(t){const s={nodeIDs:{},linkIDs:{}};for(const n of t.nodes){const o=n.id,l=LiteGraph.uuidv4();if(n.id=l,s.nodeIDs[o]||s.nodeIDs[l])throw new Error(`New/old node UUID wasn't unique in changed map! ${o} ${l}`);s.nodeIDs[o]=l,s.nodeIDs[l]=o}for(const n of t.links){const o=n[0],l=LiteGraph.uuidv4();if(n[0]=l,s.linkIDs[o]||s.linkIDs[l])throw new Error(`New/old link UUID wasn't unique in changed map! ${o} ${l}`);s.linkIDs[o]=l,s.linkIDs[l]=o;const p=n[1],h=n[3];if(!s.nodeIDs[p])throw new Error(`Old node UUID not found in mapping! ${p}`);if(n[1]=s.nodeIDs[p],!s.nodeIDs[h])throw new Error(`Old node UUID not found in mapping! ${h}`);n[3]=s.nodeIDs[h]}for(const n of t.nodes){if(n.inputs)for(const o of n.inputs)o.link&&(o.link=s.linkIDs[o.link]);if(n.outputs)for(const o of n.outputs)o.links&&(o.links=o.links.map(l=>s.linkIDs[l]))}for(const n of t.nodes)if(n.type==="graph/subgraph"){const o=reassignGraphUUIDs(n.subgraph);s.nodeIDs.assign(o.nodeIDs),s.linkIDs.assign(o.linkIDs)}}clone(){var t=LiteGraph.createNode(this.type),s=this.serialize();if(LiteGraph.use_uuids){const n=LiteGraph.cloneObject(s.subgraph);this.reassignSubgraphUUIDs(n),s.subgraph=n}return delete s.id,delete s.inputs,delete s.outputs,t.configure(s),t}buildFromNodes(t){var s={};for(let n=0;n<t.length;++n){const o=t[n];o&&o.id!=null&&(s[o.id]=o)}for(let n=0;n<t.length;++n){let o=t[n];if(o.inputs)for(let l=0;l<o.inputs.length;++l){let p=o.inputs[l];if(!p||!p.link)continue;let h=o.graph.links[p.link];h&&(s[h.origin_id]||this.subgraph.addInput(p.name,h.type))}if(o.outputs)for(let l=0;l<o.outputs.length;++l){let p=o.outputs[l];if(!(!p||!p.links||!p.links.length))for(let h=0;h<p.links.length;++h){let u=o.graph.links[p.links[h]];if(u&&!s[u.target_id])break}}}}}m(Subgraph,"title","Subgraph"),m(Subgraph,"desc","Graph inside a node"),m(Subgraph,"title_color","#334"),LiteGraph.Subgraph=Subgraph,LiteGraph.registerNodeType("graph/subgraph",Subgraph);class GraphInput{constructor(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var t=this;this.name_widget=this.addWidget("text","Name",this.properties.name,function(s){s&&t.setProperty("name",s)}),this.type_widget=this.addWidget("text","Type",this.properties.type,function(s){t.setProperty("type",s)}),this.value_widget=this.addWidget("number","Value",this.properties.value,function(s){t.setProperty("value",s)}),this.widgets_up=!0,this.size=[180,90]}onConfigure(){this.updateType()}updateType(){var t=this.properties.type;this.type_widget.value=t,this.outputs[0].type!=t&&(LiteGraph.isValidConnection(this.outputs[0].type,t)||this.disconnectOutput(0),this.outputs[0].type=t),t=="number"?(this.value_widget.type="number",this.value_widget.value=0):t=="boolean"?(this.value_widget.type="toggle",this.value_widget.value=!0):t=="string"?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,t)}onPropertyChanged(t,s){if(t=="name"){if(s==""||s==this.name_in_graph||s=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,s):this.graph.addInput(s,this.properties.type)),this.name_widget.value=s,this.name_in_graph=s}else t=="type"&&this.updateType()}getTitle(){return this.flags.collapsed?this.properties.name:this.title}onAction(t,s){this.properties.type==LiteGraph.EVENT&&this.triggerSlot(0,s)}onExecute(){var t=this.properties.name,s=this.graph.inputs[t];if(!s){this.setOutputData(0,this.properties.value);return}this.setOutputData(0,s.value!==void 0?s.value:this.properties.value)}onRemoved(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)}}m(GraphInput,"title","Input"),m(GraphInput,"desc","Input of the graph"),LiteGraph.GraphInput=GraphInput,LiteGraph.registerNodeType("graph/input",GraphInput);class GraphOutput{constructor(){this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}onPropertyChanged(t,s){if(t=="name"){if(s==""||s==this.name_in_graph||s=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,s):this.graph.addOutput(s,this.properties.type)),this.name_widget.value=s,this.name_in_graph=s}else t=="type"&&this.updateType()}updateType(){var t=this.properties.type;this.type_widget&&(this.type_widget.value=t),this.inputs[0].type!=t&&((t=="action"||t=="event")&&(t=LiteGraph.EVENT),LiteGraph.isValidConnection(this.inputs[0].type,t)||this.disconnectInput(0),this.inputs[0].type=t),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,t)}onExecute(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)}onAction(t,s){this.properties.type==LiteGraph.ACTION&&this.graph.trigger(this.properties.name,s)}onRemoved(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)}getTitle(){return this.flags.collapsed?this.properties.name:this.title}}m(GraphOutput,"title","Output"),m(GraphOutput,"desc","Output of the graph"),LiteGraph.GraphOutput=GraphOutput,LiteGraph.registerNodeType("graph/output",GraphOutput);class ConstantNumber{constructor(){this.addOutput("value","number"),this.addProperty("value",1),this.widget=this.addWidget("number","value",1,"value"),this.widgets_up=!0,this.size=[180,30]}onExecute(){this.setOutputData(0,parseFloat(this.properties.value))}getTitle(){return this.flags.collapsed?this.properties.value:this.title}setValue(t){this.setProperty("value",t)}onDrawBackground(){this.outputs[0].label=this.properties.value.toFixed(3)}}m(ConstantNumber,"title","Const Number"),m(ConstantNumber,"desc","Constant number"),LiteGraph.registerNodeType("basic/const",ConstantNumber);class ConstantBoolean{constructor(){this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value"),this.serialize_widgets=!0,this.widgets_up=!0,this.size=[140,30]}onExecute(){this.setOutputData(0,this.properties.value)}onGetInputs(){return[["toggle",LiteGraph.ACTION]]}onAction(){this.setValue(!this.properties.value)}}m(ConstantBoolean,"title","Const Boolean"),m(ConstantBoolean,"desc","Constant boolean"),ConstantBoolean.prototype.getTitle=ConstantNumber.prototype.getTitle,ConstantBoolean.prototype.setValue=ConstantNumber.prototype.setValue,LiteGraph.registerNodeType("basic/boolean",ConstantBoolean);class ConstantString{constructor(){this.addOutput("string","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0,this.size=[180,30]}onExecute(){this.setOutputData(0,this.properties.value)}onDropFile(t){var s=this,n=new FileReader;n.onload=function(o){s.setProperty("value",o.target.result)},n.readAsText(t)}}m(ConstantString,"title","Const String"),m(ConstantString,"desc","Constant string"),ConstantString.prototype.getTitle=ConstantNumber.prototype.getTitle,ConstantString.prototype.setValue=ConstantNumber.prototype.setValue,LiteGraph.registerNodeType("basic/string",ConstantString);class ConstantObject{constructor(){this.addOutput("obj","object"),this.size=[120,30],this._object={}}onExecute(){this.setOutputData(0,this._object)}}m(ConstantObject,"title","Const Object"),m(ConstantObject,"desc","Constant Object"),LiteGraph.registerNodeType("basic/object",ConstantObject);class ConstantFile{constructor(){this.addInput("url","string"),this.addOutput("file","string"),this.addProperty("url",""),this.addProperty("type","text"),this.widget=this.addWidget("text","url","","url"),this._data=null}onPropertyChanged(t,s){t=="url"&&(s==null||s==""?this._data=null:this.fetchFile(s))}onExecute(){var t=this.getInputData(0)||this.properties.url;t&&(t!=this._url||this._type!=this.properties.type)&&this.fetchFile(t),this.setOutputData(0,this._data)}fetchFile(t){var s=this;if(!t||t.constructor!==String){s._data=null,s.boxcolor=null;return}this._url=t,this._type=this.properties.type,t.substr(0,4)=="http"&&LiteGraph.proxy&&(t=LiteGraph.proxy+t.substr(t.indexOf(":")+3)),fetch(t).then(function(n){if(!n.ok)throw new Error("File not found");if(s.properties.type=="arraybuffer")return n.arrayBuffer();if(s.properties.type=="text")return n.text();if(s.properties.type=="json")return n.json();if(s.properties.type=="blob")return n.blob()}).then(function(n){s._data=n,s.boxcolor="#AEA"}).catch(n=>{var o;s._data=null,s.boxcolor="red",(o=console.error)==null||o.call(console,"error fetching file:",t)})}onDropFile(t){var s=this;this._url=t.name,this._type=this.properties.type,this.properties.url=t.name;var n=new FileReader;if(n.onload=function(o){s.boxcolor="#AEA";var l=o.target.result;s.properties.type=="json"&&(l=JSON.parse(l)),s._data=l},s.properties.type=="arraybuffer")n.readAsArrayBuffer(t);else if(s.properties.type=="text"||s.properties.type=="json")n.readAsText(t);else if(s.properties.type=="blob")return n.readAsBinaryString(t)}}m(ConstantFile,"title","Const File"),m(ConstantFile,"desc","Fetches a file from an url"),m(ConstantFile,"@type",{type:"enum",values:["text","arraybuffer","blob","json"]}),ConstantFile.prototype.setValue=ConstantNumber.prototype.setValue,LiteGraph.registerNodeType("basic/file",ConstantFile);class JSONParse{constructor(){this.addInput("parse",LiteGraph.ACTION),this.addInput("json","string"),this.addOutput("done",LiteGraph.EVENT),this.addOutput("object","object"),this.widget=this.addWidget("button","parse","",this.parse.bind(this)),this._str=null,this._obj=null}parse(){if(this._str)try{this._str=this.getInputData(1),this._obj=JSON.parse(this._str),this.boxcolor="#AEA",this.triggerSlot(0)}catch{this.boxcolor="red"}}onExecute(){this._str=this.getInputData(1),this.setOutputData(1,this._obj)}onAction(t){t=="parse"&&this.parse()}}m(JSONParse,"title","JSON Parse"),m(JSONParse,"desc","Parses JSON String into object"),LiteGraph.registerNodeType("basic/jsonparse",JSONParse);class ConstantData{constructor(){this.addOutput("data","object"),this.addProperty("value",""),this.widget=this.addWidget("text","json","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}onPropertyChanged(t,s){if(this.widget.value=s,!(s==null||s==""))try{this._value=JSON.parse(s),this.boxcolor="#AEA"}catch{this.boxcolor="red"}}onExecute(){this.setOutputData(0,this._value)}}m(ConstantData,"title","Const Data"),m(ConstantData,"desc","Constant Data"),ConstantData.prototype.setValue=ConstantNumber.prototype.setValue,LiteGraph.registerNodeType("basic/data",ConstantData);class ConstantArray{constructor(){this._value=[],this.addInput("json",""),this.addOutput("arrayOut","array"),this.addOutput("length","number"),this.addProperty("value","[]"),this.widget=this.addWidget("text","array",this.properties.value,"value"),this.widgets_up=!0,this.size=[140,50]}onPropertyChanged(t,s){if(this.widget.value=s,!(s==null||s==""))try{s[0]!="["?this._value=JSON.parse("["+s+"]"):this._value=JSON.parse(s),this.boxcolor="#AEA"}catch{this.boxcolor="red"}}onExecute(){var t=this.getInputData(0);if(t&&t.length){this._value||(this._value=new Array),this._value.length=t.length;for(var s=0;s<t.length;++s)this._value[s]=t[s];this.changeOutputType("arrayOut","array")}this.setOutputData(0,this._value),this.setOutputData(1,this._value&&this._value.length||0)}}m(ConstantArray,"title","Const Array"),m(ConstantArray,"desc","Constant Array"),ConstantArray.prototype.setValue=ConstantNumber.prototype.setValue,LiteGraph.registerNodeType("basic/array",ConstantArray);class ArrayLength{constructor(){this.addInput("arr","array"),this.addOutput("length","number")}onExecute(){var t,s=this.getInputData(0);s&&(["array","object"].includes(typeof s)&&typeof s.length!="undefined"?this.setOutputData(0,s.length):((t=console.debug)==null||t.call(console,"Not an array or object",typeof s,s),this.setOutputData(0,null)))}}m(ArrayLength,"title","aLength"),m(ArrayLength,"desc","Get the length of an array"),LiteGraph.registerNodeType("basic/array_length",ArrayLength);class SetArray{constructor(){this.addInput("arr","array"),this.addInput("value",""),this.addOutput("arr","array"),this.properties={index:0},this.widget=this.addWidget("number","i",this.properties.index,"index",{precision:0,step:10,min:0})}onExecute(){var t=this.getInputData(0);if(t){var s=this.getInputData(1);s!==void 0&&(this.properties.index&&(t[Math.floor(this.properties.index)]=s),this.setOutputData(0,t))}}}m(SetArray,"title","Set Array"),m(SetArray,"desc","Sets index of array"),LiteGraph.registerNodeType("basic/set_array",SetArray);class ArrayElement{constructor(){this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0)}onExecute(){var t=this.getInputData(0),s=this.getInputData(1);s==null&&(s=this.properties.index),!(t==null||s==null)&&this.setOutputData(0,t[Math.floor(Number(s))])}}m(ArrayElement,"title","Array[i]"),m(ArrayElement,"desc","Returns an element from an array"),LiteGraph.registerNodeType("basic/array[]",ArrayElement);class TableElement{constructor(){this.addInput("table","table"),this.addInput("row","number"),this.addInput("col","number"),this.addOutput("value",""),this.addProperty("row",0),this.addProperty("column",0)}onExecute(){var t=this.getInputData(0),s=this.getInputData(1),n=this.getInputData(2);s==null&&(s=this.properties.row),n==null&&(n=this.properties.column),!(t==null||s==null||n==null)&&(s=t[Math.floor(Number(s))],s?this.setOutputData(0,s[Math.floor(Number(n))]):this.setOutputData(0,null))}}m(TableElement,"title","Table[row][col]"),m(TableElement,"desc","Returns an element from a table"),LiteGraph.registerNodeType("basic/table[][]",TableElement);class ObjectProperty{constructor(){this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.widget=this.addWidget("text","prop.","",this.setValue.bind(this)),this.widgets_up=!0,this.size=[140,30],this._value=null}setValue(t){this.properties.value=t,this.widget.value=t}getTitle(){return this.flags.collapsed?"in."+this.properties.value:this.title}onPropertyChanged(t,s){this.widget.value=s}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,t[this.properties.value])}}m(ObjectProperty,"title","Object property"),m(ObjectProperty,"desc","Outputs the property of an object"),LiteGraph.registerNodeType("basic/object_property",ObjectProperty);class ObjectKeys{constructor(){this.addInput("obj",""),this.addOutput("keys","array"),this.size=[140,30]}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,Object.keys(t))}}m(ObjectKeys,"title","Object keys"),m(ObjectKeys,"desc","Outputs an array with the keys of an object"),LiteGraph.registerNodeType("basic/object_keys",ObjectKeys);class SetObject{constructor(){this.addInput("obj",""),this.addInput("value",""),this.addOutput("obj",""),this.properties={property:""},this.name_widget=this.addWidget("text","prop.",this.properties.property,"property")}onExecute(){var t=this.getInputData(0);if(t){var s=this.getInputData(1);s!==void 0&&(this.properties.property&&(t[this.properties.property]=s),this.setOutputData(0,t))}}}m(SetObject,"title","Set Object"),m(SetObject,"desc","Adds propertiesrty to object"),LiteGraph.registerNodeType("basic/set_object",SetObject);class MergeObjects{constructor(){this.addInput("A","object"),this.addInput("B","object"),this.addOutput("out","object"),this._result={};var t=this;this.addWidget("button","clear","",function(){t._result={}}),this.size=this.computeSize()}onExecute(){var t=this.getInputData(0),s=this.getInputData(1),n=this._result;if(t)for(let o in t)n[o]=t[o];if(s)for(let o in s)n[o]=s[o];this.setOutputData(0,n)}}m(MergeObjects,"title","Merge Objects"),m(MergeObjects,"desc","Creates an object copying properties from others"),LiteGraph.registerNodeType("basic/merge_objects",MergeObjects);const rt=class wt{constructor(){this.size=[60,30],this.addInput("in"),this.addOutput("out"),this.properties={varname:"myname",container:wt.LITEGRAPH},this.value=null}onExecute(){var t=this.getContainer();if(this.isInputConnected(0)){this.value=this.getInputData(0),t[this.properties.varname]=this.value,this.setOutputData(0,this.value);return}this.setOutputData(0,t[this.properties.varname])}getContainer(){switch(this.properties.container){case wt.GRAPH:return this.graph?this.graph.vars:{};case wt.GLOBALSCOPE:return globalThis;default:return LiteGraph.Globals}}getTitle(){return this.properties.varname}};m(rt,"title","Variable"),m(rt,"desc","store/read variable value");let Variable=rt;Variable.LITEGRAPH=0,Variable.GRAPH=1,Variable.GLOBALSCOPE=2,Variable["@container"]={type:"enum",values:{litegraph:Variable.LITEGRAPH,graph:Variable.GRAPH,global:Variable.GLOBALSCOPE}},LiteGraph.registerNodeType("basic/variable",Variable);function length(a){return a&&a.length!=null?Number(a.length):0}LiteGraph.wrapFunctionAsNode("basic/length",length,[""],"number"),LiteGraph.wrapFunctionAsNode("basic/not",function(a){return!a},[""],"boolean");class DownloadData{constructor(){this.size=[60,30],this.addInput("data",0),this.addInput("download",LiteGraph.ACTION),this.properties={filename:"data.json"},this.value=null;var t=this;this.addWidget("button","Download","",()=>{t.value&&t.downloadAsFile()})}downloadAsFile(){if(this.value!=null){var t=null;this.value.constructor===String?t=this.value:t=JSON.stringify(this.value);var s=new Blob([t]),n=URL.createObjectURL(s),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download",this.properties.filename),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(function(){URL.revokeObjectURL(n)},1e3*60)}}onAction(){var t=this;setTimeout(function(){t.downloadAsFile()},100)}onExecute(){this.inputs[0]&&(this.value=this.getInputData(0))}getTitle(){return this.flags.collapsed?this.properties.filename:this.title}}m(DownloadData,"title","Download"),m(DownloadData,"desc","Download some data"),LiteGraph.registerNodeType("basic/download",DownloadData);const at=class Nt{constructor(){this.size=[60,30],this.addInput("value",0,{label:""}),this.value=0}onExecute(){this.inputs[0]&&(this.value=this.getInputData(0))}getTitle(){return this.flags.collapsed?this.inputs[0].label:this.title}static toString(t){if(t==null)return"null";if(t.constructor===Number)return t.toFixed(3);if(t.constructor===Array){for(var s="[",n=0;n<t.length;++n)s+=Nt.toString(t[n])+(n+1!=t.length?",":"");return s+="]",s}else return String(t)}onDrawBackground(){this.inputs[0].label=Nt.toString(this.value)}};m(at,"title","Watch"),m(at,"desc","Show value of input");let Watch=at;LiteGraph.registerNodeType("basic/watch",Watch);class Cast{constructor(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,30]}onExecute(){this.setOutputData(0,this.getInputData(0))}}m(Cast,"title","Cast"),m(Cast,"desc","Allows to connect different types"),LiteGraph.registerNodeType("basic/cast",Cast);class Console{constructor(){this.mode=LiteGraph.ON_EVENT,this.size=[80,30],this.addProperty("msg",""),this.addInput("log",LiteGraph.EVENT),this.addInput("msg",0)}onAction(t,s){var n,o,l,p=this.getInputData(1);p||(p=this.properties.msg),p||(p="Event: "+s),t=="log"?(n=console.log)==null||n.call(console,p):t=="warn"?(o=console.warn)==null||o.call(console,p):t=="error"&&((l=console.error)==null||l.call(console,p))}onExecute(){var t,s=this.getInputData(1);s||(s=this.properties.msg),s!=null&&typeof s!="undefined"&&(this.properties.msg=s,(t=console.log)==null||t.call(console,s))}onGetInputs(){return[["log",LiteGraph.ACTION],["warn",LiteGraph.ACTION],["error",LiteGraph.ACTION]]}}m(Console,"title","Console"),m(Console,"desc","Show value inside the console"),LiteGraph.registerNodeType("basic/console",Console);class Alert{constructor(){this.mode=LiteGraph.ON_EVENT,this.addProperty("msg",""),this.addInput("",LiteGraph.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}onConfigure(t){this.widget.value=t.properties.msg}onAction(){var t=this.properties.msg;setTimeout(function(){alert(t)},10)}}m(Alert,"title","Alert"),m(Alert,"desc","Show an alert window"),m(Alert,"color","#510"),LiteGraph.registerNodeType("basic/alert",Alert);class NodeScript{constructor(){this.size=[60,30],this.addProperty("onExecute","return A;"),this.addInput("A",0),this.addInput("B",0),this.addOutput("out",0),this._func=null,this.data={}}onConfigure(t){var s;t.properties.onExecute&&LiteGraph.allow_scripts?this.compileCode(t.properties.onExecute):(s=console.warn)==null||s.call(console,"Script not compiled, LiteGraph.allow_scripts is false")}onPropertyChanged(t,s){var n;t=="onExecute"&&LiteGraph.allow_scripts?this.compileCode(s):(n=console.warn)==null||n.call(console,"Script not compiled, LiteGraph.allow_scripts is false")}compileCode(t){var s,n,o,l;if(this._func=null,t.length>256)(s=console.warn)==null||s.call(console,"Script too long, max 256 chars");else{for(var p=t.toLowerCase(),h=["script","body","document","eval","nodescript","function"],u=0;u<h.length;++u)if(p.indexOf(h[u])!=-1){(n=console.warn)==null||n.call(console,"invalid script");return}try{this._func=new Function("A","B","C","DATA","node",t)}catch(c){(o=console.error)==null||o.call(console,"Error parsing script"),(l=console.error)==null||l.call(console,c)}}}onExecute(){var t,s;if(this._func)try{var n=this.getInputData(0),o=this.getInputData(1),l=this.getInputData(2);this.setOutputData(0,this._func(n,o,l,this.data,this))}catch(p){(t=console.error)==null||t.call(console,"Error in script"),(s=console.error)==null||s.call(console,p)}}onGetOutputs(){return[["C",""]]}}m(NodeScript,"title","Script"),m(NodeScript,"desc","executes a code (max 256 characters)"),m(NodeScript,"widgets_info",{onExecute:{type:"code"}}),LiteGraph.registerNodeType("basic/script",NodeScript);const Q=class kt{constructor(){this.addInput("A",0),this.addInput("B",0),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","==","enum",{values:kt.values}),this.addWidget("combo","Op.",this.properties.OP,{property:"OP",values:kt.values}),this.size=[80,60]}getTitle(){return"*A "+this.properties.OP+" *B"}onExecute(){var t=this.getInputData(0);t===void 0?t=this.properties.A:this.properties.A=t;var s=this.getInputData(1);s===void 0?s=this.properties.B:this.properties.B=s;var n=!1;if(typeof t==typeof s)switch(this.properties.OP){case"==":case"!=":switch(n=!0,typeof t){case"object":var o=Object.getOwnPropertyNames(t),l=Object.getOwnPropertyNames(s);if(o.length!=l.length){n=!1;break}for(var p=0;p<o.length;p++){var h=o[p];if(t[h]!==s[h]){n=!1;break}}break;default:n=t==s}this.properties.OP=="!="&&(n=!n);break}this.setOutputData(0,n),this.setOutputData(1,!n)}};m(Q,"title","Compare *"),m(Q,"desc","evaluates condition between A and B"),m(Q,"values",["==","!="]),m(Q,"@OP",{type:"enum",title:"operation",values:Q.values});let GenericCompare=Q;LiteGraph.registerNodeType("basic/CompareValues",GenericCompare);class LogEvent{constructor(){this.size=[60,30],this.addInput("event",LiteGraph.ACTION)}onAction(t,s){var n;(n=console.log)==null||n.call(console,t,s)}}m(LogEvent,"title","Log Event"),m(LogEvent,"desc","Log event in console"),LiteGraph.registerNodeType("events/log",LogEvent);class TriggerEvent{constructor(){this.size=[60,30],this.addInput("if",""),this.addOutput("true",LiteGraph.EVENT),this.addOutput("change",LiteGraph.EVENT),this.addOutput("false",LiteGraph.EVENT),this.properties={only_on_change:!0,tooltip:"Triggers event if input evaluates to true"},this.prev=0}onExecute(t,s){var n=this.getInputData(0),o=n!=this.prev;this.prev===0&&(o=!1);var l=o&&this.properties.only_on_change||!o&&!this.properties.only_on_change;n&&l&&this.triggerSlot(0,t,null,s),!n&&l&&this.triggerSlot(2,t,null,s),o&&this.triggerSlot(1,t,null,s),this.prev=n}}m(TriggerEvent,"title","TriggerEvent"),m(TriggerEvent,"desc","Triggers event if input evaluates to true"),LiteGraph.registerNodeType("events/trigger",TriggerEvent);var ut;let Sequence$1=(ut=class{constructor(){var a=this;this.addInput("in_1",LiteGraph.ACTION),this.addInput("in_2",LiteGraph.ACTION),this.addInput("in_3",LiteGraph.ACTION),this.addOutput("out_1",LiteGraph.EVENT),this.addOutput("out_2",LiteGraph.EVENT),this.addOutput("out_3",LiteGraph.EVENT),this.addWidget("button","+",null,function(){var t;const s=(((t=a.outputs)==null?void 0:t.length)||0)+1;a.addInput(`in_${s}`,LiteGraph.ACTION),a.addOutput(`out_${s}`,LiteGraph.EVENT)}),this.size=[90,70],this.flags={horizontal:!0,render_box:!1}}getTitle(){return""}onAction(a,t,s){if(this.outputs){s=s||{};for(var n=0;n<this.outputs.length;++n)s.action_call?s.action_call=s.action_call+"_seq_"+n:s.action_call=this.id+"_"+(a||"action")+"_seq_"+n+"_"+Math.floor(Math.random()*9999),this.triggerSlot(n,t,null,s)}}},m(ut,"title","Sequence"),m(ut,"desc","Triggers a sequence of events when an event arrives"),ut);LiteGraph.registerNodeType("events/sequence",Sequence$1);class WaitAll{constructor(){var t=this;this.addInput("",LiteGraph.ACTION),this.addInput("",LiteGraph.ACTION),this.addOutput("",LiteGraph.EVENT),this.addWidget("button","+",null,function(){t.addInput("",LiteGraph.ACTION),t.size[0]=90}),this.size=[90,70],this.ready=[]}getTitle(){return""}onDrawBackground(t){if(!this.flags.collapsed)for(var s=0;s<this.inputs.length;++s){var n=s*LiteGraph.NODE_SLOT_HEIGHT+10;t.fillStyle=this.ready[s]?"#AFB":"#000",t.fillRect(20,n,10,10)}}onAction(t,s,n,o){if(o!=null){this.ready.length=this.outputs.length,this.ready[o]=!0;for(var l=0;l<this.ready.length;++l)if(!this.ready[l])return;this.reset(),this.triggerSlot(0)}}reset(){this.ready.length=0}}m(WaitAll,"title","WaitAll"),m(WaitAll,"desc","Wait until all input events arrive then triggers output"),LiteGraph.registerNodeType("events/waitAll",WaitAll);class Stepper{constructor(){var t=this;this.properties={index:0},this.addInput("index","number"),this.addInput("step",LiteGraph.ACTION),this.addInput("reset",LiteGraph.ACTION),this.addOutput("index","number"),this.addOutput("",LiteGraph.EVENT),this.addOutput("",LiteGraph.EVENT),this.addOutput("",LiteGraph.EVENT,{removable:!0}),this.addWidget("button","+",null,function(){t.addOutput("",LiteGraph.EVENT,{removable:!0})}),this.size=[120,120],this.flags={render_box:!1}}onDrawBackground(t){if(!this.flags.collapsed){var s=this.properties.index||0;t.fillStyle="#AFB";var n=this.size[0],o=(s+1)*LiteGraph.NODE_SLOT_HEIGHT+4;t.beginPath(),t.moveTo(n-30,o),t.lineTo(n-30,o+LiteGraph.NODE_SLOT_HEIGHT),t.lineTo(n-15,o+LiteGraph.NODE_SLOT_HEIGHT*.5),t.fill()}}onExecute(){var t=this.getInputData(0);t!=null&&(t=Math.floor(t),t=LiteGraph.clamp(t,0,this.outputs?this.outputs.length-2:0),t!=this.properties.index&&(this.properties.index=t,this.triggerSlot(t+1))),this.setOutputData(0,this.properties.index)}onAction(t,s){if(t=="reset")this.properties.index=0;else if(t=="step"){this.triggerSlot(this.properties.index+1,s);var n=this.outputs?this.outputs.length-1:0;this.properties.index=(this.properties.index+1)%n}}}m(Stepper,"title","Stepper"),m(Stepper,"desc","Trigger events sequentially when an tick arrives"),LiteGraph.registerNodeType("events/stepper",Stepper);class FilterEvent{constructor(){this.size=[60,30],this.addInput("event",LiteGraph.ACTION),this.addOutput("event",LiteGraph.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}onAction(t,s,n){if(s!=null&&!(this.properties.equal_to&&this.properties.equal_to!=s)){if(this.properties.has_property){var o=s[this.properties.has_property];if(o==null||this.properties.property_equal_to&&this.properties.property_equal_to!=o)return}this.triggerSlot(0,s,null,n)}}}m(FilterEvent,"title","Filter Event"),m(FilterEvent,"desc","Blocks events that do not match the filter"),LiteGraph.registerNodeType("events/filter",FilterEvent);class EventBranch{constructor(){this.addInput("in",LiteGraph.ACTION),this.addInput("cond","boolean"),this.addOutput("true",LiteGraph.EVENT),this.addOutput("false",LiteGraph.EVENT),this.size=[120,60],this._value=!1}onExecute(){this._value=this.getInputData(1)}onAction(t,s,n){this._value=this.getInputData(1),this.triggerSlot(this._value?0:1,s,null,n)}}m(EventBranch,"title","Branch"),m(EventBranch,"desc","If condition is true, outputs triggers true, otherwise false"),LiteGraph.registerNodeType("events/branch",EventBranch);class EventCounter{constructor(){this.addInput("inc",LiteGraph.ACTION),this.addInput("dec",LiteGraph.ACTION),this.addInput("reset",LiteGraph.ACTION),this.addOutput("change",LiteGraph.EVENT),this.addOutput("num","number"),this.addProperty("doCountExecution",!1,"boolean",{name:"Count Executions"}),this.addWidget("toggle","Count Exec.",this.properties.doCountExecution,"doCountExecution"),this.num=0}getTitle(){return this.flags.collapsed?String(this.num):this.title}onAction(t){var s=this.num;t=="inc"?this.num+=1:t=="dec"?this.num-=1:t=="reset"&&(this.num=0),this.num!=s&&this.trigger("change",this.num)}onDrawBackground(t){this.flags.collapsed||(t.fillStyle="#AAA",t.font="20px Arial",t.textAlign="center",t.fillText(this.num,this.size[0]*.5,this.size[1]*.5))}onExecute(){this.properties.doCountExecution&&(this.num+=1),this.setOutputData(1,this.num)}}m(EventCounter,"title","Counter"),m(EventCounter,"desc","Counts events"),LiteGraph.registerNodeType("events/counter",EventCounter);class DelayEvent{constructor(){this.size=[60,30],this.addProperty("time_in_ms",1e3),this.addInput("event",LiteGraph.ACTION),this.addOutput("on_time",LiteGraph.EVENT),this._pending=[]}onAction(t,s,n){var o=this.properties.time_in_ms;o<=0?this.trigger(null,s,n):this._pending.push([o,s])}onExecute(t,s){var n=this.graph.elapsed_time*1e3;this.isInputConnected(1)&&(this.properties.time_in_ms=this.getInputData(1));for(var o=0;o<this._pending.length;++o){var l=this._pending[o];l[0]-=n,!(l[0]>0)&&(this._pending.splice(o,1),--o,this.trigger(null,l[1],s))}}onGetInputs(){return[["event",LiteGraph.ACTION],["time_in_ms","number"]]}}m(DelayEvent,"title","Delay"),m(DelayEvent,"desc","Delays one event"),LiteGraph.registerNodeType("events/delay",DelayEvent);const nt=class It{constructor(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",LiteGraph.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}onStart(){this.time=0}getTitle(){return"Timer: "+this.last_interval.toString()+"ms"}onDrawBackground(){this.boxcolor=this.triggered?It.on_color:It.off_color,this.triggered=!1}onExecute(){var t=this.graph.elapsed_time*1e3,s=this.time==0;if(this.time+=t,this.last_interval=Math.max(1,this.getInputOrProperty("interval")|0),!s&&(this.time<this.last_interval||isNaN(this.last_interval))){this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1);return}this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)}onGetInputs(){return[["interval","number"]]}onGetOutputs(){return[["tick","boolean"]]}};m(nt,"title","Timer"),m(nt,"desc","Sends an event every N milliseconds");let TimerEvent=nt;TimerEvent.on_color="#AAA",TimerEvent.off_color="#222",LiteGraph.registerNodeType("events/timer",TimerEvent);class SemaphoreEvent{constructor(){this.addInput("go",LiteGraph.ACTION),this.addInput("green",LiteGraph.ACTION),this.addInput("red",LiteGraph.ACTION),this.addOutput("continue",LiteGraph.EVENT),this.addOutput("blocked",LiteGraph.EVENT),this.addOutput("is_green","boolean"),this._ready=!1,this.properties={};var t=this;this.addWidget("button","reset","",function(){t._ready=!1})}onExecute(){this.setOutputData(1,this._ready),this.boxcolor=this._ready?"#9F9":"#FA5"}onAction(t){t=="go"?this.triggerSlot(this._ready?0:1):t=="green"?this._ready=!0:t=="red"&&(this._ready=!1)}}m(SemaphoreEvent,"title","Semaphore Event"),m(SemaphoreEvent,"desc","Until both events are not triggered, it doesnt continue."),LiteGraph.registerNodeType("events/semaphore",SemaphoreEvent);class OnceEvent{constructor(){this.addInput("in",LiteGraph.ACTION),this.addInput("reset",LiteGraph.ACTION),this.addOutput("out",LiteGraph.EVENT),this._once=!1,this.properties={};var t=this;this.addWidget("button","reset","",function(){t._once=!1})}onAction(t,s){t=="in"&&!this._once?(this._once=!0,this.triggerSlot(0,s)):t=="reset"&&(this._once=!1)}}m(OnceEvent,"title","Once"),m(OnceEvent,"desc","Only passes an event once, then gets locked"),LiteGraph.registerNodeType("events/once",OnceEvent);class DataStore{constructor(){this.addInput("data",0),this.addInput("assign",LiteGraph.ACTION),this.addOutput("data",0),this._last_value=null,this.properties={data:null,serialize:!0};var t=this;this.addWidget("button","store","",function(){t.properties.data=t._last_value})}onExecute(){this._last_value=this.getInputData(0),this.setOutputData(0,this.properties.data)}onAction(){this.properties.data=this._last_value}onSerialize(t){t.data!=null&&(!this.properties.serialize||t.data.constructor!==String&&t.data.constructor!==Number&&t.data.constructor!==Boolean&&t.data.constructor!==Array&&t.data.constructor!==Object)&&(t.data=null)}}m(DataStore,"title","Data Store"),m(DataStore,"desc","Stores data and only changes when event is received"),LiteGraph.registerNodeType("basic/data_store",DataStore);const H=class K{constructor(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",LiteGraph.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}onExecute(){var t=this.getGamepad(),s=this.properties.threshold||0;if(t&&(this._left_axis[0]=Math.abs(t.xbox.axes.lx)>s?t.xbox.axes.lx:0,this._left_axis[1]=Math.abs(t.xbox.axes.ly)>s?t.xbox.axes.ly:0,this._right_axis[0]=Math.abs(t.xbox.axes.rx)>s?t.xbox.axes.rx:0,this._right_axis[1]=Math.abs(t.xbox.axes.ry)>s?t.xbox.axes.ry:0,this._triggers[0]=Math.abs(t.xbox.axes.ltrigger)>s?t.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(t.xbox.axes.rtrigger)>s?t.xbox.axes.rtrigger:0),this.outputs)for(var n=0;n<this.outputs.length;n++){var o=this.outputs[n];if(!(!o.links||!o.links.length)){var l=null;if(t)switch(o.name){case"left_axis":l=this._left_axis;break;case"right_axis":l=this._right_axis;break;case"left_x_axis":l=this._left_axis[0];break;case"left_y_axis":l=this._left_axis[1];break;case"right_x_axis":l=this._right_axis[0];break;case"right_y_axis":l=this._right_axis[1];break;case"trigger_left":l=this._triggers[0];break;case"trigger_right":l=this._triggers[1];break;case"a_button":l=t.xbox.buttons.a?1:0;break;case"b_button":l=t.xbox.buttons.b?1:0;break;case"x_button":l=t.xbox.buttons.x?1:0;break;case"y_button":l=t.xbox.buttons.y?1:0;break;case"lb_button":l=t.xbox.buttons.lb?1:0;break;case"rb_button":l=t.xbox.buttons.rb?1:0;break;case"ls_button":l=t.xbox.buttons.ls?1:0;break;case"rs_button":l=t.xbox.buttons.rs?1:0;break;case"hat_left":l=t.xbox.hatmap&K.LEFT;break;case"hat_right":l=t.xbox.hatmap&K.RIGHT;break;case"hat_up":l=t.xbox.hatmap&K.UP;break;case"hat_down":l=t.xbox.hatmap&K.DOWN;break;case"hat":l=t.xbox.hatmap;break;case"start_button":l=t.xbox.buttons.start?1:0;break;case"back_button":l=t.xbox.buttons.back?1:0;break;case"button_pressed":for(var p=0;p<this._current_buttons.length;++p)this._current_buttons[p]&&!this._previous_buttons[p]&&this.triggerSlot(n,K.buttons[p]);break}else switch(o.name){case"button_pressed":break;case"left_axis":case"right_axis":l=K.zero;break;default:l=0}this.setOutputData(n,l)}}}getGamepad(){var t=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!t)return null;var s=t.call(navigator),n=null;this._previous_buttons.set(this._current_buttons);for(var o=this.properties.gamepad_index;o<4;o++)if(s[o]){n=s[o];var l=this.xbox_mapping;l||(l=this.xbox_mapping={axes:[],buttons:{},hat:"",hatmap:K.CENTER}),l.axes.lx=n.axes[0],l.axes.ly=n.axes[1],l.axes.rx=n.axes[2],l.axes.ry=n.axes[3],l.axes.ltrigger=n.buttons[6].value,l.axes.rtrigger=n.buttons[7].value,l.hat="",l.hatmap=K.CENTER;for(var p=0;p<n.buttons.length;p++)if(this._current_buttons[p]=n.buttons[p].pressed,p<12)l.buttons[K.mapping_array[p]]=n.buttons[p].pressed,n.buttons[p].was_pressed&&this.trigger(K.mapping_array[p]+"_button_event");else switch(p){case 12:n.buttons[p].pressed&&(l.hat+="up",l.hatmap|=K.UP);break;case 13:n.buttons[p].pressed&&(l.hat+="down",l.hatmap|=K.DOWN);break;case 14:n.buttons[p].pressed&&(l.hat+="left",l.hatmap|=K.LEFT);break;case 15:n.buttons[p].pressed&&(l.hat+="right",l.hatmap|=K.RIGHT);break;case 16:l.buttons.home=n.buttons[p].pressed;break}return n.xbox=l,n}}onDrawBackground(t){if(!this.flags.collapsed){var s=this._left_axis,n=this._right_axis;t.strokeStyle="#88A",t.strokeRect((s[0]+1)*.5*this.size[0]-4,(s[1]+1)*.5*this.size[1]-4,8,8),t.strokeStyle="#8A8",t.strokeRect((n[0]+1)*.5*this.size[0]-4,(n[1]+1)*.5*this.size[1]-4,8,8);var o=this.size[1]/this._current_buttons.length;t.fillStyle="#AEB";for(var l=0;l<this._current_buttons.length;++l)this._current_buttons[l]&&t.fillRect(0,o*l,6,o)}}onGetOutputs(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start_button","number"],["back_button","number"],["a_button_event",LiteGraph.EVENT],["b_button_event",LiteGraph.EVENT],["x_button_event",LiteGraph.EVENT],["y_button_event",LiteGraph.EVENT],["lb_button_event",LiteGraph.EVENT],["rb_button_event",LiteGraph.EVENT],["ls_button_event",LiteGraph.EVENT],["rs_button_event",LiteGraph.EVENT],["start_button_event",LiteGraph.EVENT],["back_button_event",LiteGraph.EVENT],["hat_left","number"],["hat_right","number"],["hat_up","number"],["hat_down","number"],["hat","number"],["button_pressed",LiteGraph.EVENT]]}};m(H,"title","Gamepad"),m(H,"desc","gets the input of the gamepad"),m(H,"zero",new Float32Array(2)),m(H,"buttons",["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"]),m(H,"mapping",{a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11}),m(H,"mapping_array",["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs"]);let GamepadInput=H;GamepadInput.CENTER=0,GamepadInput.LEFT=1,GamepadInput.RIGHT=2,GamepadInput.UP=4,GamepadInput.DOWN=8,LiteGraph.registerNodeType("input/gamepad",GamepadInput);class Converter{constructor(){this.addInput("in",0),this.addOutput("out",0),this.size=[80,30]}onExecute(){var t=this.getInputData(0);if(t!=null&&this.outputs)for(var s=0;s<this.outputs.length;s++){var n=this.outputs[s];if(!(!n.links||!n.links.length)){var o=null;switch(n.name){case"number":o=t.length?t[0]:parseFloat(t);break;case"vec2":case"vec3":case"vec4":o=null;var l=1;switch(n.name){case"vec2":l=2;break;case"vec3":l=3;break;case"vec4":l=4;break}if(o=new Float32Array(l),t.length)for(var p=0;p<t.length&&p<o.length;p++)o[p]=t[p];else o[0]=parseFloat(t);break}this.setOutputData(s,o)}}}onGetOutputs(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]}}m(Converter,"title","Converter"),m(Converter,"desc","type A to type B"),LiteGraph.registerNodeType("math/converter",Converter);class Bypass{constructor(){this.addInput("in"),this.addOutput("out"),this.size=[80,30]}onExecute(){var t=this.getInputData(0);this.setOutputData(0,t)}}m(Bypass,"title","Bypass"),m(Bypass,"desc","removes the type"),LiteGraph.registerNodeType("math/bypass",Bypass);class ToNumber{constructor(){this.addInput("in"),this.addOutput("out")}onExecute(){var t=this.getInputData(0);this.setOutputData(0,Number(t))}}m(ToNumber,"title","to Number"),m(ToNumber,"desc","Cast to number"),LiteGraph.registerNodeType("math/to_number",ToNumber);class MathRange{constructor(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addOutput("clamped","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[120,50]}getTitle(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title}onExecute(){let t;if(this.inputs)for(let p=0;p<this.inputs.length;p++){let h=this.inputs[p];t=this.getInputData(p),t!==void 0&&(this.properties[h.name]=t)}t=this.properties.in,(t==null||t.constructor!==Number)&&(t=0);var s=this.properties.in_min,n=this.properties.in_max,o=this.properties.out_min,l=this.properties.out_max;this._last_v=(t-s)/(n-s)*(l-o)+o,this.setOutputData(0,this._last_v),this.setOutputData(1,LiteGraph.clamp(this._last_v,o,l))}onDrawBackground(t){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"}onGetInputs(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]}}m(MathRange,"title","Range"),m(MathRange,"desc","Convert a number from one range to another"),LiteGraph.registerNodeType("math/range",MathRange);class MathRand{constructor(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[80,30]}onExecute(){if(this.inputs)for(var t=0;t<this.inputs.length;t++){var s=this.inputs[t],n=this.getInputData(t);n!==void 0&&(this.properties[s.name]=n)}var o=this.properties.min,l=this.properties.max;this._last_v=Math.random()*(l-o)+o,this.setOutputData(0,this._last_v)}onDrawBackground(t){this.outputs[0].label=(this._last_v||0).toFixed(3)}onGetInputs(){return[["min","number"],["max","number"]]}}m(MathRand,"title","Rand"),m(MathRand,"desc","Random number"),LiteGraph.registerNodeType("math/rand",MathRand);const Y=class Gt{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("min",0),this.addProperty("max",1),this.addProperty("smooth",!0),this.addProperty("seed",0),this.addProperty("octaves",1),this.addProperty("persistence",.8),this.addProperty("speed",1),this.size=[90,30]}static getValue(t,s){if(!Gt.data){Gt.data=new Float32Array(1024);for(var n=0;n<Gt.data.length;++n)Gt.data[n]=Math.random()}t=t%1024,t<0&&(t+=1024);var o=Math.floor(t);t-=o;var l=Gt.data[o],p=Gt.data[o==1023?0:o+1];return s&&(t=t*t*t*(t*(t*6-15)+10)),l*(1-t)+p*t}onExecute(){var t=this.getInputData(0)||0,s=this.properties.octaves||1,n=0,o=1,l=this.properties.seed||0;t+=l;for(var p=this.properties.speed||1,h=0,u=0;u<s&&(n+=Gt.getValue(t*(1+u)*p,this.properties.smooth)*o,h+=o,o*=this.properties.persistence,!(o<.001));++u);n/=h;var c=this.properties.min,d=this.properties.max;this._last_v=n*(d-c)+c,this.setOutputData(0,this._last_v)}onDrawBackground(t){this.outputs[0].label=(this._last_v||0).toFixed(3)}};m(Y,"title","Noise"),m(Y,"desc","Random number with temporal continuity"),m(Y,"data",null);let MathNoise=Y;LiteGraph.registerNodeType("math/noise",MathNoise);class MathSpikes{constructor(){this.addOutput("out","number"),this.addProperty("min_time",1),this.addProperty("max_time",2),this.addProperty("duration",.2),this.size=[90,30],this._remaining_time=0,this._blink_time=0}onExecute(){var t=this.graph.elapsed_time;this._remaining_time-=t,this._blink_time-=t;var s=0;if(this._blink_time>0){var n=this._blink_time/this.properties.duration;s=1/(Math.pow(n*8-4,4)+1)}this._remaining_time<0?(this._remaining_time=Math.random()*(this.properties.max_time-this.properties.min_time)+this.properties.min_time,this._blink_time=this.properties.duration,this.boxcolor="#FFF"):this.boxcolor="#000",this.setOutputData(0,s)}}LiteGraph.registerNodeType("math/spikes",MathSpikes);class MathClamp{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("min",0),this.addProperty("max",1)}onExecute(){var t=this.getInputData(0);t!=null&&(t=Math.max(this.properties.min,t),t=Math.min(this.properties.max,t),this.setOutputData(0,t))}getCode(){var t="";return this.isInputConnected(0)&&(t+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),t}}m(MathClamp,"title","Clamp"),m(MathClamp,"desc","Clamp number between min and max"),LiteGraph.registerNodeType("math/clamp",MathClamp);class MathLerp{constructor(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}onExecute(){var t=this.getInputData(0);t==null&&(t=0);var s=this.getInputData(1);s==null&&(s=0);var n=this.properties.f,o=this.getInputData(2);o!==void 0&&(n=o),this.setOutputData(0,t*(1-n)+s*n)}onGetInputs(){return[["f","number"]]}}m(MathLerp,"title","Lerp"),m(MathLerp,"desc","Linear Interpolation"),LiteGraph.registerNodeType("math/lerp",MathLerp);class MathAbs{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,Math.abs(t))}}m(MathAbs,"title","Abs"),m(MathAbs,"desc","Absolute"),LiteGraph.registerNodeType("math/abs",MathAbs);class MathFloor{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,Math.floor(t))}}m(MathFloor,"title","Floor"),m(MathFloor,"desc","Floor number to remove fractional part"),LiteGraph.registerNodeType("math/floor",MathFloor);class MathFrac{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,t%1)}}m(MathFrac,"title","Frac"),m(MathFrac,"desc","Returns fractional part"),LiteGraph.registerNodeType("math/frac",MathFrac);class MathSmoothStep{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.properties={A:0,B:1}}onExecute(){var t=this.getInputData(0);if(t!==void 0){var s=this.properties.A,n=this.properties.B;t=LiteGraph.clamp((t-s)/(n-s),0,1),t=t*t*(3-2*t),this.setOutputData(0,t)}}}m(MathSmoothStep,"title","Smoothstep"),m(MathSmoothStep,"desc","Smoothstep"),LiteGraph.registerNodeType("math/smoothstep",MathSmoothStep);class MathScale{constructor(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[80,30],this.addProperty("factor",1)}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,t*this.properties.factor)}}m(MathScale,"title","Scale"),m(MathScale,"desc","v * factor"),LiteGraph.registerNodeType("math/scale",MathScale);class Gate{constructor(){this.addInput("v","boolean"),this.addInput("A"),this.addInput("B"),this.addOutput("out")}onExecute(){var t=this.getInputData(0);this.setOutputData(0,this.getInputData(t?1:2))}}m(Gate,"title","Gate"),m(Gate,"desc","if v is true, then outputs A, otherwise B"),LiteGraph.registerNodeType("math/gate",Gate);class MathAverageFilter{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}onExecute(){var t=this.getInputData(0);t==null&&(t=0);var s=this._values.length;this._values[this._current%s]=t,this._current+=1,this._current>s&&(this._current=0);for(var n=0,o=0;o<s;++o)n+=this._values[o];this.setOutputData(0,n/s)}onPropertyChanged(t,s){s<1&&(s=1),this.properties.samples=Math.round(s);var n=this._values;this._values=new Float32Array(this.properties.samples),n.length<=this._values.length?this._values.set(n):this._values.set(n.subarray(0,this._values.length))}onPropertyChanged(t,s){t=="formula"&&(this.code_widget.value=s)}}m(MathAverageFilter,"title","Average"),m(MathAverageFilter,"desc","Average Filter"),LiteGraph.registerNodeType("math/average",MathAverageFilter);class MathTendTo{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[80,30],this._value=null}onExecute(){var t=this.getInputData(0);t==null&&(t=0);var s=this.properties.factor;this._value==null?this._value=t:this._value=this._value*(1-s)+t*s,this.setOutputData(0,this._value)}}m(MathTendTo,"title","TendTo"),m(MathTendTo,"desc","moves the output value always closer to the input"),LiteGraph.registerNodeType("math/tendTo",MathTendTo);const X=class Tt{constructor(){this.addInput("A","number,array,object"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:Tt.values}),this._func=Tt.funcs[this.properties.OP],this._result=[]}getTitle(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"}setValue(t){typeof t=="string"&&(t=parseFloat(t)),this.properties.value=t}onPropertyChanged(t,s){var n;t=="OP"&&(this._func=Tt.funcs[this.properties.OP],this._func||((n=console.warn)==null||n.call(console,"Unknown operation: "+this.properties.OP),this._func=function(o){return o}))}onExecute(){var t=this.getInputData(0),s=this.getInputData(1);t!=null?t.constructor===Number&&(this.properties.A=t):t=this.properties.A,s!=null?this.properties.B=s:s=this.properties.B;var n=Tt.funcs[this.properties.OP],o;if(t.constructor===Number)o=0,o=n(t,s);else if(t.constructor===Array){o=this._result,o.length=t.length;for(let l=0;l<t.length;++l)o[l]=n(t[l],s)}else{o={};for(let l in t)o[l]=n(t[l],s)}this.setOutputData(0,o)}onDrawBackground(t){this.flags.collapsed||(t.font="40px Arial",t.fillStyle="#666",t.textAlign="center",t.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+LiteGraph.NODE_TITLE_HEIGHT)*.5),t.textAlign="left")}};m(X,"title","Operation"),m(X,"desc","Easy math operators"),m(X,"values",["+","-","*","/","%","^","max","min"]),m(X,"funcs",{"+":function(a,t){return a+t},"-":function(a,t){return a-t},x:function(a,t){return a*t},X:function(a,t){return a*t},"*":function(a,t){return a*t},"/":function(a,t){return a/t},"%":function(a,t){return a%t},"^":function(a,t){return Math.pow(a,t)},max:function(a,t){return Math.max(a,t)},min:function(a,t){return Math.min(a,t)}}),m(X,"@OP",{type:"enum",title:"operation",values:X.values}),m(X,"size",[100,60]);let MathOperation=X;LiteGraph.registerNodeType("math/operation",MathOperation),LiteGraph.registerSearchboxExtra("math/operation","MAX",{properties:{OP:"max"},title:"MAX()"}),LiteGraph.registerSearchboxExtra("math/operation","MIN",{properties:{OP:"min"},title:"MIN()"});class MathCompare{constructor(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}onExecute(){var t=this.getInputData(0),s=this.getInputData(1);t!==void 0?this.properties.A=t:t=this.properties.A,s!==void 0?this.properties.B=s:s=this.properties.B;for(var n=0,o=this.outputs.length;n<o;++n){var l=this.outputs[n];if(!(!l.links||!l.links.length)){var p;switch(l.name){case"A==B":p=t==s;break;case"A!=B":p=t!=s;break;case"A>B":p=t>s;break;case"A<B":p=t<s;break;case"A<=B":p=t<=s;break;case"A>=B":p=t>=s;break}this.setOutputData(n,p)}}}onGetOutputs(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]}}m(MathCompare,"title","Compare"),m(MathCompare,"desc","compares between two values"),LiteGraph.registerNodeType("math/compare",MathCompare),LiteGraph.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),LiteGraph.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),LiteGraph.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),LiteGraph.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),LiteGraph.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),LiteGraph.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"});const tt=class St{constructor(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","enum",{values:St.values}),this.addWidget("combo","Cond.",this.properties.OP,{property:"OP",values:St.values}),this.size=[80,60]}getTitle(){return"A "+this.properties.OP+" B"}onExecute(){var t=this.getInputData(0);t===void 0?t=this.properties.A:this.properties.A=t;var s=this.getInputData(1);s===void 0?s=this.properties.B:this.properties.B=s;var n=!0;switch(this.properties.OP){case">":n=t>s;break;case"<":n=t<s;break;case"==":n=t==s;break;case"!=":n=t!=s;break;case"<=":n=t<=s;break;case">=":n=t>=s;break;case"||":n=t||s;break;case"&&":n=t&&s;break}this.setOutputData(0,n),this.setOutputData(1,!n)}};m(tt,"title","Condition"),m(tt,"desc","evaluates condition between A and B"),m(tt,"values",[">","<","==","!=","<=",">=","||","&&"]),m(tt,"@OP",{type:"enum",title:"operation",values:tt.values});let MathCondition=tt;LiteGraph.registerNodeType("math/condition",MathCondition);class MathBranch{constructor(){this.addInput("in",0),this.addInput("cond","boolean"),this.addOutput("true",0),this.addOutput("false",0),this.size=[80,60]}onExecute(){var t=this.getInputData(0),s=this.getInputData(1);s?(this.setOutputData(0,t),this.setOutputData(1,null)):(this.setOutputData(0,null),this.setOutputData(1,t))}}m(MathBranch,"title","Branch"),m(MathBranch,"desc","If condition is true, outputs IN in true, otherwise in false"),LiteGraph.registerNodeType("math/branch",MathBranch);class MathAccumulate{constructor(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}onExecute(){this.properties.value===null&&(this.properties.value=0);var t=this.getInputData(0);t!==null?this.properties.value+=t:this.properties.value+=this.properties.increment,this.setOutputData(0,this.properties.value)}}m(MathAccumulate,"title","Accumulate"),m(MathAccumulate,"desc","Increments a value every time"),LiteGraph.registerNodeType("math/accumulate",MathAccumulate);class MathTrigonometry{constructor(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}onExecute(){var t=this.getInputData(0);t==null&&(t=0);var s=this.properties.amplitude,n=this.findInputSlot("amplitude");n!=-1&&(s=this.getInputData(n));var o=this.properties.offset;n=this.findInputSlot("offset"),n!=-1&&(o=this.getInputData(n));for(var l=0,p=this.outputs.length;l<p;++l){var h=this.outputs[l],u;switch(h.name){case"sin":u=Math.sin(t);break;case"cos":u=Math.cos(t);break;case"tan":u=Math.tan(t);break;case"asin":u=Math.asin(t);break;case"acos":u=Math.acos(t);break;case"atan":u=Math.atan(t);break}this.setOutputData(l,s*u+o)}}onGetInputs(){return[["v","number"],["amplitude","number"],["offset","number"]]}onGetOutputs(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]}}m(MathTrigonometry,"title","Trigonometry"),m(MathTrigonometry,"desc","Sin Cos Tan"),LiteGraph.registerNodeType("math/trigonometry",MathTrigonometry),LiteGraph.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),LiteGraph.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),LiteGraph.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"});class MathFormula{constructor(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.code_widget=this.addWidget("text","F(x,y)",this.properties.formula,function(t,s,n){n.properties.formula=t}),this.addWidget("toggle","allow",LiteGraph.allow_scripts,function(t){LiteGraph.allow_scripts=t}),this._func=null}onExecute(){if(LiteGraph.allow_scripts){var t=this.getInputData(0),s=this.getInputData(1);t!=null?this.properties.x=t:t=this.properties.x,s!=null?this.properties.y=s:s=this.properties.y;var n;try{(!this._func||this._func_code!=this.properties.formula)&&(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula),n=this._func(t,s,this.graph.globaltime),this.boxcolor=null}catch{this.boxcolor="red"}this.setOutputData(0,n)}}getTitle(){return this._func_code||"Formula"}onDrawBackground(){var t=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=t)}}m(MathFormula,"title","Formula"),m(MathFormula,"desc","Compute formula"),m(MathFormula,"size",[160,100]),LiteGraph.registerNodeType("math/formula",MathFormula);class Math3DVec2ToXY{constructor(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}onExecute(){var t=this.getInputData(0);t!=null&&(this.setOutputData(0,t[0]),this.setOutputData(1,t[1]))}}m(Math3DVec2ToXY,"title","Vec2->XY"),m(Math3DVec2ToXY,"desc","vector 2 to components"),LiteGraph.registerNodeType("math3d/vec2-to-xy",Math3DVec2ToXY);class Math3DXYToVec2{constructor(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}onExecute(){var t=this.getInputData(0);t==null&&(t=this.properties.x);var s=this.getInputData(1);s==null&&(s=this.properties.y);var n=this._data;n[0]=t,n[1]=s,this.setOutputData(0,n)}}m(Math3DXYToVec2,"title","XY->Vec2"),m(Math3DXYToVec2,"desc","components to vector2"),LiteGraph.registerNodeType("math3d/xy-to-vec2",Math3DXYToVec2);class Math3DVec3ToXYZ{constructor(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}onExecute(){var t=this.getInputData(0);t!=null&&(this.setOutputData(0,t[0]),this.setOutputData(1,t[1]),this.setOutputData(2,t[2]))}}m(Math3DVec3ToXYZ,"title","Vec3->XYZ"),m(Math3DVec3ToXYZ,"desc","vector 3 to components"),LiteGraph.registerNodeType("math3d/vec3-to-xyz",Math3DVec3ToXYZ);class Math3DXYZToVec3{constructor(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}onExecute(){var t=this.getInputData(0);t==null&&(t=this.properties.x);var s=this.getInputData(1);s==null&&(s=this.properties.y);var n=this.getInputData(2);n==null&&(n=this.properties.z);var o=this._data;o[0]=t,o[1]=s,o[2]=n,this.setOutputData(0,o)}}m(Math3DXYZToVec3,"title","XYZ->Vec3"),m(Math3DXYZToVec3,"desc","components to vector3"),LiteGraph.registerNodeType("math3d/xyz-to-vec3",Math3DXYZToVec3);class Math3DVec4ToXYZW{constructor(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}onExecute(){var t=this.getInputData(0);t!=null&&(this.setOutputData(0,t[0]),this.setOutputData(1,t[1]),this.setOutputData(2,t[2]),this.setOutputData(3,t[3]))}}m(Math3DVec4ToXYZW,"title","Vec4->XYZW"),m(Math3DVec4ToXYZW,"desc","vector 4 to components"),LiteGraph.registerNodeType("math3d/vec4-to-xyzw",Math3DVec4ToXYZW);class Math3DXYZWToVec4{constructor(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}onExecute(){var t=this.getInputData(0);t==null&&(t=this.properties.x);var s=this.getInputData(1);s==null&&(s=this.properties.y);var n=this.getInputData(2);n==null&&(n=this.properties.z);var o=this.getInputData(3);o==null&&(o=this.properties.w);var l=this._data;l[0]=t,l[1]=s,l[2]=n,l[3]=o,this.setOutputData(0,l)}}m(Math3DXYZWToVec4,"title","XYZW->Vec4"),m(Math3DXYZWToVec4,"desc","components to vector4"),LiteGraph.registerNodeType("math3d/xyzw-to-vec4",Math3DXYZWToVec4);function toString(a){if(a&&a.constructor===Object)try{return JSON.stringify(a)}catch{return String(a)}return String(a)}LiteGraph.wrapFunctionAsNode("string/toString",toString,[""],"string");function compare(a,t){return a==t}LiteGraph.wrapFunctionAsNode("string/compare",compare,["string","string"],"boolean");function concatenate(a,t){return a===void 0?t:t===void 0?a:a+""+t}LiteGraph.wrapFunctionAsNode("string/concatenate",concatenate,["string","string"],"string");function contains(a,t){return a===void 0||t===void 0?!1:a.indexOf(t)!=-1}LiteGraph.wrapFunctionAsNode("string/contains",contains,["string","string"],"boolean");function toUpperCase(a){return a!=null&&a.constructor===String?a.toUpperCase():a}LiteGraph.wrapFunctionAsNode("string/toUpperCase",toUpperCase,["string"],"string");function split(a,t){if(t==null&&(t=this.properties.separator),a==null)return[];if(a.constructor===String)return a.split(t||" ");if(a.constructor===Array){for(var s=[],n=0;n<a.length;++n)typeof a[n]=="string"&&(s[n]=a[n].split(t||" "));return s}return null}LiteGraph.wrapFunctionAsNode("string/split",split,["string,array","string"],"array",{separator:","});function toFixed(a){return a!=null&&a.constructor===Number?a.toFixed(this.properties.precision):a}LiteGraph.wrapFunctionAsNode("string/toFixed",toFixed,["number"],"string",{precision:0});class StringToTable{constructor(){this.addInput("","string"),this.addOutput("table","table"),this.addOutput("rows","number"),this.addProperty("value",""),this.addProperty("separator",","),this._table=null}onExecute(){var t=this.getInputData(0);if(t){var s=this.properties.separator||",";(t!=this._str||s!=this._last_separator)&&(this._last_separator=s,this._str=t,this._table=t.split(`
`).map(function(n){return n.trim().split(s)})),this.setOutputData(0,this._table),this.setOutputData(1,this._table?this._table.length:0)}}}m(StringToTable,"title","toTable"),m(StringToTable,"desc","Splits a string to table"),LiteGraph.registerNodeType("string/toTable",StringToTable);class Selector{constructor(){this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0}onDrawBackground(t){if(!this.flags.collapsed){t.fillStyle="#AFB";var s=(this.selected+1)*LiteGraph.NODE_SLOT_HEIGHT+6;t.beginPath(),t.moveTo(50,s),t.lineTo(50,s+LiteGraph.NODE_SLOT_HEIGHT),t.lineTo(34,s+LiteGraph.NODE_SLOT_HEIGHT*.5),t.fill()}}onExecute(){var t=this.getInputData(0);(t==null||t.constructor!==Number)&&(t=0),this.selected=t=Math.round(t)%(this.inputs.length-1);var s=this.getInputData(t+1);s!==void 0&&this.setOutputData(0,s)}onGetInputs(){return[["E",0],["F",0],["G",0],["H",0]]}}m(Selector,"title","Selector"),m(Selector,"desc","selects an output"),LiteGraph.registerNodeType("logic/selector",Selector);class Sequence{constructor(){this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(",")}onPropertyChanged(t,s){t=="sequence"&&(this.values=s.split(","))}onExecute(){var t=this.getInputData(1);t&&t!=this.current_sequence&&(this.values=t.split(","),this.current_sequence=t);var s=this.getInputData(0);s==null&&(s=0),this.index=s=Math.round(s)%this.values.length,this.setOutputData(0,this.values[s])}}m(Sequence,"title","Sequence"),m(Sequence,"desc","select one element from a sequence from a string"),LiteGraph.registerNodeType("logic/sequence",Sequence);class logicAnd{constructor(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}onExecute(){let t=!0;for(let s in this.inputs)if(!this.getInputData(s)){t=!1;break}this.setOutputData(0,t)}onGetInputs(){return[["and","boolean"]]}}m(logicAnd,"title","AND"),m(logicAnd,"desc","Return true if all inputs are true"),LiteGraph.registerNodeType("logic/AND",logicAnd);class logicOr{constructor(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}onExecute(){var t=!1;for(var s in this.inputs)if(this.getInputData(s)){t=!0;break}this.setOutputData(0,t)}onGetInputs(){return[["or","boolean"]]}}m(logicOr,"title","OR"),m(logicOr,"desc","Return true if at least one input is true"),LiteGraph.registerNodeType("logic/OR",logicOr);class logicNot{constructor(){this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean")}onExecute(){var t=!this.getInputData(0);this.setOutputData(0,t)}}m(logicNot,"title","NOT"),m(logicNot,"desc","Return the logical negation"),LiteGraph.registerNodeType("logic/NOT",logicNot);class logicCompare{constructor(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}onExecute(){var t=null,s=!0;for(var n in this.inputs)if(t===null)t=this.getInputData(n);else if(t!=this.getInputData(n)){s=!1;break}this.setOutputData(0,s)}onGetInputs(){return[["bool","boolean"]]}}m(logicCompare,"title","bool == bool"),m(logicCompare,"desc","Compare for logical equality"),LiteGraph.registerNodeType("logic/CompareBool",logicCompare);class logicBranch{constructor(){this.properties={},this.addInput("onTrigger",LiteGraph.ACTION),this.addInput("condition","boolean"),this.addOutput("true",LiteGraph.EVENT),this.addOutput("false",LiteGraph.EVENT),this.mode=LiteGraph.ON_TRIGGER}onExecute(t,s){this.getInputData(1)?this.triggerSlot(0):this.triggerSlot(1)}}m(logicBranch,"title","Branch"),m(logicBranch,"desc","Branch execution on condition"),LiteGraph.registerNodeType("logic/IF",logicBranch);class logicFor{constructor(){this.properties={},this.addInput("start","number"),this.addInput("nElements","number"),this.addInput("do",LiteGraph.ACTION),this.addInput("break",LiteGraph.ACTION),this.addOutput("do",LiteGraph.EVENT),this.addOutput("index","number"),this.started=!1,this.stopped=!1}onExecute(t){var s,n;if(this.started){for(var o=this.getInputData(0),l=this.getInputData(1),p=o;p<o+l;p++){if((s=console.debug)==null||s.call(console,"for cycle "+p),this.triggerSlot(0,t),this.stopped){(n=console.debug)==null||n.call(console,"for cycle stopped on index "+p);break}this.setOutputData(1,p)}this.started=!1,this.stopped=!0}}onAction(t){switch(t){case"break":this.stopped=!0;break;case"do":this.started=!0,this.stopped=!1,this.execute();break}}}m(logicFor,"title","FOR"),m(logicFor,"desc","Cycle FOR"),LiteGraph.registerNodeType("logic/CycleFOR",logicFor);class logicWhile{constructor(){this.properties={cycleLimit:999,checkOnStart:!0},this.addInput("do",LiteGraph.ACTION),this.addInput("condition","boolean"),this.addInput("break",LiteGraph.ACTION),this.addOutput("do",LiteGraph.EVENT),this.addOutput("index","number"),this.started=!1,this.stopped=!1,this.k=0,this.cond=!1,this.addWidget("toggle","checkOnStart",this.properties.checkOnStart,"checkOnStart")}onExecute(){this.setOutputData(1,this.k),this.cond=this.getInputData(1)}onAction(t,s){var n,o;switch(t){case"break":this.stopped=!0;break;case"do":this.started=!0,this.stopped=!1;var l=this.getInputOrProperty("checkOnStart");for(this.cond=!l||this.getInputData(1),this.k=0,cycleLimit=this.properties.cycleLimit||999;this.cond&&this.k<cycleLimit;){if((n=console.debug)==null||n.call(console,"while cycle "+this.k),this.setOutputData(1,this.k),this.triggerSlot(0,s),this.stopped){(o=console.debug)==null||o.call(console,"while cycle stopped on index "+k);break}this.k++,this.cond=this.getInputData(1,!0,!0)}this.k=0,this.setOutputData(1,this.k),this.cond=this.getInputData(1),this.started=!1,this.stopped=!0;break}}}m(logicWhile,"title","WHILE"),m(logicWhile,"desc","Cycle WHILE"),LiteGraph.registerNodeType("logic/CycleWHILE",logicWhile);class LGWebSocket{constructor(){this.size=[60,20],this.addInput("send",LiteGraph.ACTION),this.addOutput("received",LiteGraph.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph",only_send_changes:!0},this._ws=null,this._last_sent_data=[],this._last_received_data=[]}onPropertyChanged(t,s){t=="url"&&this.connectSocket()}onExecute(){if(!this._ws&&this.properties.url&&this.connectSocket(),!(!this._ws||this._ws.readyState!=WebSocket.OPEN)){var t=this.properties.room,s=this.properties.only_send_changes;for(let l=1;l<this.inputs.length;++l){var n=this.getInputData(l);if(n!=null){var o;try{o=JSON.stringify({type:0,room:t,channel:l,data:n})}catch{continue}s&&this._last_sent_data[l]==o||(this._last_sent_data[l]=o,this._ws.send(o))}}for(let l=1;l<this.outputs.length;++l)this.setOutputData(l,this._last_received_data[l]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}}connectSocket(){var t=this,s=this.properties.url;s.substr(0,2)!="ws"&&(s="ws://"+s),this._ws=new WebSocket(s),this._ws.onopen=function(){var n;(n=console.log)==null||n.call(console,"ready"),t.boxcolor="#6C6"},this._ws.onmessage=function(n){t.boxcolor="#AFA";var o=JSON.parse(n.data);if(!(o.room&&o.room!=t.properties.room))if(o.type==1)if(o.data.object_class&&LiteGraph[o.data.object_class]){var l=null;try{l=new LiteGraph[o.data.object_class](o.data),t.triggerSlot(0,l)}catch{return}}else t.triggerSlot(0,o.data);else t._last_received_data[o.channel||0]=o.data},this._ws.onerror=function(n){var o;(o=console.log)==null||o.call(console,"couldnt connect to websocket"),t.boxcolor="#E88"},this._ws.onclose=function(n){var o;(o=console.log)==null||o.call(console,"connection closed"),t.boxcolor="#000"}}send(t){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send(JSON.stringify({type:1,msg:t}))}onAction(t,s){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send({type:1,room:this.properties.room,action:t,data:s})}onGetInputs(){return[["in",0]]}onGetOutputs(){return[["out",0]]}}m(LGWebSocket,"title","WebSocket"),m(LGWebSocket,"desc","Send data through a websocket"),LiteGraph.registerNodeType("network/websocket",LGWebSocket);class HTTPRequestNode{constructor(){this.addInput("request",LiteGraph.ACTION),this.addInput("url","string"),this.addProperty("url",""),this.addOutput("ready",LiteGraph.EVENT),this.addOutput("data","string"),this.addWidget("button","Fetch",null,this.fetch.bind(this)),this._data=null,this._fetching=null}fetch(){var t=this.getInputOrProperty("url");if(t){this.boxcolor="#FF0";var s=this;this._fetching=fetch(t).then(n=>{if(!n.ok)this.boxcolor="#F00",s.trigger("error");else return this.boxcolor="#0F0",n.text()}).then(n=>{s._data=n,s._fetching=null,s.trigger("ready")})}}onAction(t){t=="request"&&this.fetch()}onExecute(){this.setOutputData(1,this._data)}onGetOutputs(){return[["error",LiteGraph.EVENT]]}}m(HTTPRequestNode,"title","HTTP Request"),m(HTTPRequestNode,"desc","Fetch data through HTTP"),LiteGraph.registerNodeType("network/httprequest",HTTPRequestNode);export{ContextMenu,DragAndScale,LGraph,LGraphCanvas,LGraphGroup,LGraphNode,LLink,LiteGraph};
