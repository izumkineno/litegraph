var De=Object.defineProperty,Ce=(m,t,e)=>t in m?De(m,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[t]=e,a=(m,t,e)=>Ce(m,typeof t!="symbol"?t+"":t,e);import{LiteGraph as n}from"./litegraph.core.js";const ge=class T{static getAudioContext(){var t;if(!this._audio_context){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,!window.AudioContext)return(t=console.error)==null||t.call(console,"AudioContext not supported by browser"),null;this._audio_context=new AudioContext,this._audio_context.onmessage=function(e){var s;(s=console.log)==null||s.call(console,"msg",e)},this._audio_context.onended=function(e){var s;(s=console.log)==null||s.call(console,"ended",e)},this._audio_context.oncomplete=function(e){var s;(s=console.log)==null||s.call(console,"complete",e)}}return this._audio_context}static connect(t,e){var s;try{t.connect(e)}catch(r){(s=console.warn)==null||s.call(console,"LGraphAudio:",r)}}static disconnect(t,e){var s;try{t.disconnect(e)}catch(r){(s=console.warn)==null||s.call(console,"LGraphAudio:",r)}}static changeAllAudiosConnections(t,e){if(t.inputs)for(let s=0;s<t.inputs.length;++s){let r=t.inputs[s],o=t.graph.links[r.link];if(!o)continue;let l=t.graph.getNodeById(o.origin_id),u=null;l.getAudioNodeInOutputSlot?u=l.getAudioNodeInOutputSlot(o.origin_slot):u=l.audionode;let h=null;t.getAudioNodeInInputSlot?h=t.getAudioNodeInInputSlot(s):h=t.audionode,e?T.connect(u,h):T.disconnect(u,h)}if(t.outputs)for(let s=0;s<t.outputs.length;++s){let r=t.outputs[s];for(let o=0;o<r.links.length;++o){let l=t.graph.links[r.links[o]];if(!l)continue;let u=null;t.getAudioNodeInOutputSlot?u=t.getAudioNodeInOutputSlot(s):u=t.audionode;let h=t.graph.getNodeById(l.target_id),d=null;h.getAudioNodeInInputSlot?d=h.getAudioNodeInInputSlot(l.target_slot):d=h.audionode,e?T.connect(u,d):T.disconnect(u,d)}}}static onConnectionsChange(t,e,s,r){if(t==n.OUTPUT){var o=null;if(r&&(o=this.graph.getNodeById(r.target_id)),!!o){var l=null;this.getAudioNodeInOutputSlot?l=this.getAudioNodeInOutputSlot(e):l=this.audionode;var u=null;o.getAudioNodeInInputSlot?u=o.getAudioNodeInInputSlot(r.target_slot):u=o.audionode,s?T.connect(l,u):T.disconnect(l,u)}}}static createAudioNodeWrapper(t){var e=t.prototype.onPropertyChanged;t.prototype.onPropertyChanged=function(s,r){e&&e.call(this,s,r),this.audionode&&this.audionode[s]!==void 0&&(this.audionode[s].value!==void 0?this.audionode[s].value=r:this.audionode[s]=r)},t.prototype.onConnectionsChange=T.onConnectionsChange}static loadSound(t,e,s){if(T.cached_audios[t]&&t.includes("blob:")){e&&e(T.cached_audios[t]);return}T.onProcessAudioURL&&(t=T.onProcessAudioURL(t));var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer";var o=T.getAudioContext();r.onload=function(){var u;(u=console.log)==null||u.call(console,"AudioSource loaded"),o.decodeAudioData(r.response,function(h){var d;(d=console.log)==null||d.call(console,"AudioSource decoded"),T.cached_audios[t]=h,e&&e(h)},l)},r.send();function l(u){var h;(h=console.log)==null||h.call(console,"Audio loading sample error:",u),s&&s(u)}return r}};a(ge,"cached_audios",{});let f=ge;class U{constructor(){this.properties={src:"",gain:.5,loop:!0,autoplay:!0,playbackRate:1},this._loading_audio=!1,this._audiobuffer=null,this._audionodes=[],this._last_sourcenode=null,this.addOutput("out","audio"),this.addInput("gain","number");var t=f.getAudioContext();this.audionode=t.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain,this.properties.src&&this.loadSound(this.properties.src)}onAdded(t){t.status===n.LGraph.STATUS_RUNNING&&this.onStart()}onStart(){this._audiobuffer&&this.properties.autoplay&&this.playBuffer(this._audiobuffer)}onStop(){this.stopAllSounds()}onPause(){this.pauseAllSounds()}onUnpause(){this.unpauseAllSounds()}onRemoved(){this.stopAllSounds(),this._dropped_url&&URL.revokeObjectURL(this._url)}stopAllSounds(){for(var t=0;t<this._audionodes.length;++t)this._audionodes[t].started&&(this._audionodes[t].started=!1,this._audionodes[t].stop());this._audionodes.length=0}pauseAllSounds(){f.getAudioContext().suspend()}unpauseAllSounds(){f.getAudioContext().resume()}onExecute(){if(this.inputs)for(let t=0;t<this.inputs.length;++t){let e=this.inputs[t];if(e.link==null)continue;let s=this.getInputData(t);if(s!==void 0){if(e.name=="gain")this.audionode.gain.value=s;else if(e.name=="src")this.setProperty("src",s);else if(e.name=="playbackRate"){this.properties.playbackRate=s;for(let r=0;r<this._audionodes.length;++r)this._audionodes[r].playbackRate.value=s}}}if(this.outputs)for(let t=0;t<this.outputs.length;++t)this.outputs[t].name=="buffer"&&this._audiobuffer&&this.setOutputData(t,this._audiobuffer)}onAction(t){this._audiobuffer&&(t=="Play"?this.playBuffer(this._audiobuffer):t=="Stop"&&this.stopAllSounds())}onPropertyChanged(t,e){if(t=="src")this.loadSound(e);else if(t=="gain")this.audionode.gain.value=e;else if(t=="playbackRate")for(var s=0;s<this._audionodes.length;++s)this._audionodes[s].playbackRate.value=e}playBuffer(t){var e=this,s=f.getAudioContext(),r=s.createBufferSource();return this._last_sourcenode=r,r.graphnode=this,r.buffer=t,r.loop=this.properties.loop,r.playbackRate.value=this.properties.playbackRate,this._audionodes.push(r),r.connect(this.audionode),this._audionodes.push(r),this.trigger("start"),r.onended=function(){e.trigger("ended");var o=e._audionodes.indexOf(r);o!=-1&&e._audionodes.splice(o,1)},r.started||(r.started=!0,r.start()),r}loadSound(t){var e=this;this._request&&(this._request.abort(),this._request=null),this._audiobuffer=null,this._loading_audio=!1,t&&(this._request=f.loadSound(t,s=>{this.boxcolor=n.NODE_DEFAULT_BOXCOLOR,e._audiobuffer=s,e._loading_audio=!1,e.graph&&e.graph.status===n.LGraph.STATUS_RUNNING&&e.onStart()}),this._loading_audio=!0,this.boxcolor="#AA4")}onGetInputs(){return[["playbackRate","number"],["src","string"],["Play",n.ACTION],["Stop",n.ACTION]]}onGetOutputs(){return[["buffer","audiobuffer"],["start",n.EVENT],["ended",n.EVENT]]}onDropFile(t){this._dropped_url&&URL.revokeObjectURL(this._dropped_url);var e=URL.createObjectURL(t);this.properties.src=e,this.loadSound(e),this._dropped_url=e}}a(U,"title","Source"),a(U,"desc","Plays an audio file"),a(U,"supported_extensions",["wav","ogg","mp3"]),a(U,"@src",{widget:"resource"}),U.prototype.onConnectionsChange=f.onConnectionsChange,n.registerNodeType("audio/source",U);class it{constructor(){this.properties={gain:.5},this._audionodes=[],this._media_stream=null,this.addOutput("out","audio"),this.addInput("gain","number");var t=f.getAudioContext();this.audionode=t.createGain(),this.audionode.graphnode=this,this.audionode.gain.value=this.properties.gain}onAdded(t){t.status===n.LGraph.STATUS_RUNNING&&this.onStart()}onStart(){this._media_stream==null&&!this._waiting_confirmation&&this.openStream()}onStop(){this.audionode.gain.value=0}onPause(){this.audionode.gain.value=0}onUnpause(){this.audionode.gain.value=this.properties.gain}onRemoved(){if(this.audionode.gain.value=0,this.audiosource_node&&(this.audiosource_node.disconnect(this.audionode),this.audiosource_node=null),this._media_stream){var t=this._media_stream.getTracks();t.length&&t[0].stop()}}openStream(){var t;if(!navigator.mediaDevices){(t=console.log)==null||t.call(console,"getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(this.streamReady.bind(this)).catch(s);var e=this;function s(r){var o;(o=console.log)==null||o.call(console,"Media rejected",r),e._media_stream=!1,e.boxcolor="red"}}streamReady(t){this._media_stream=t,this.audiosource_node&&this.audiosource_node.disconnect(this.audionode);var e=f.getAudioContext();this.audiosource_node=e.createMediaStreamSource(t),this.audiosource_node.graphnode=this,this.audiosource_node.connect(this.audionode),this.boxcolor="white"}onExecute(){if(this._media_stream==null&&!this._waiting_confirmation&&this.openStream(),this.inputs)for(var t=0;t<this.inputs.length;++t){var e=this.inputs[t];if(e.link!=null){var s=this.getInputData(t);s!==void 0&&e.name=="gain"&&(this.audionode.gain.value=this.properties.gain=s)}}}onAction(t){t=="Play"?this.audionode.gain.value=this.properties.gain:t=="Stop"&&(this.audionode.gain.value=0)}onPropertyChanged(t,e){t=="gain"&&(this.audionode.gain.value=e)}onGetInputs(){return[["playbackRate","number"],["Play",n.ACTION],["Stop",n.ACTION]]}}a(it,"title","MediaSource"),a(it,"desc","Plays microphone"),it.prototype.onConnectionsChange=f.onConnectionsChange,n.registerNodeType("audio/media_source",it);class St{constructor(){this.properties={fftSize:2048,minDecibels:-100,maxDecibels:-10,smoothingTimeConstant:.5};var t=f.getAudioContext();this.audionode=t.createAnalyser(),this.audionode.graphnode=this,this.audionode.fftSize=this.properties.fftSize,this.audionode.minDecibels=this.properties.minDecibels,this.audionode.maxDecibels=this.properties.maxDecibels,this.audionode.smoothingTimeConstant=this.properties.smoothingTimeConstant,this.addInput("in","audio"),this.addOutput("freqs","array"),this.addOutput("samples","array"),this._freq_bin=null,this._time_bin=null}onPropertyChanged(t,e){this.audionode[t]=e}onExecute(){let t;this.isOutputConnected(0)&&(t=this.audionode.frequencyBinCount,(!this._freq_bin||this._freq_bin.length!=t)&&(this._freq_bin=new Uint8Array(t)),this.audionode.getByteFrequencyData(this._freq_bin),this.setOutputData(0,this._freq_bin)),this.isOutputConnected(1)&&(t=this.audionode.frequencyBinCount,(!this._time_bin||this._time_bin.length!=t)&&(this._time_bin=new Uint8Array(t)),this.audionode.getByteTimeDomainData(this._time_bin),this.setOutputData(1,this._time_bin));for(var e=1;e<this.inputs.length;++e){var s=this.inputs[e];if(s.link!=null){var r=this.getInputData(e);r!==void 0&&(this.audionode[s.name].value=r)}}}onGetInputs(){return[["minDecibels","number"],["maxDecibels","number"],["smoothingTimeConstant","number"]]}onGetOutputs(){return[["freqs","array"],["samples","array"]]}}a(St,"title","Analyser"),a(St,"desc","Audio Analyser"),n.registerNodeType("audio/analyser",St);class st{constructor(){this.properties={gain:1},this.audionode=f.getAudioContext().createGain(),this.addInput("in","audio"),this.addInput("gain","number"),this.addOutput("out","audio")}onExecute(){if(!(!this.inputs||!this.inputs.length))for(var t=1;t<this.inputs.length;++t){var e=this.inputs[t],s=this.getInputData(t);s!==void 0&&(this.audionode[e.name].value=s)}}}a(st,"title","Gain"),a(st,"desc","Audio gain"),f.createAudioNodeWrapper(st),n.registerNodeType("audio/gain",st);class rt{constructor(){this.properties={impulse_src:"",normalize:!0},this.audionode=f.getAudioContext().createConvolver(),this.addInput("in","audio"),this.addOutput("out","audio")}onRemove(){this._dropped_url&&URL.revokeObjectURL(this._dropped_url)}onPropertyChanged(t,e){t=="impulse_src"?this.loadImpulse(e):t=="normalize"&&(this.audionode.normalize=e)}onDropFile(t){this._dropped_url&&URL.revokeObjectURL(this._dropped_url),this._dropped_url=URL.createObjectURL(t),this.properties.impulse_src=this._dropped_url,this.loadImpulse(this._dropped_url)}loadImpulse(t){var e=this;if(this._request&&(this._request.abort(),this._request=null),this._impulse_buffer=null,this._loading_impulse=!1,!t)return;this._request=f.loadSound(t,s),this._loading_impulse=!0;function s(r){var o;e._impulse_buffer=r,e.audionode.buffer=r,(o=console.log)==null||o.call(console,"Impulse signal set"),e._loading_impulse=!1}}}a(rt,"title","Convolver"),a(rt,"desc","Convolves the signal (used for reverb)"),f.createAudioNodeWrapper(rt),n.registerNodeType("audio/convolver",rt);class ot{constructor(){this.properties={threshold:-50,knee:40,ratio:12,reduction:-20,attack:0,release:.25},this.audionode=f.getAudioContext().createDynamicsCompressor(),this.addInput("in","audio"),this.addOutput("out","audio")}onExecute(){if(!(!this.inputs||!this.inputs.length))for(var t=1;t<this.inputs.length;++t){var e=this.inputs[t];if(e.link!=null){var s=this.getInputData(t);s!==void 0&&(this.audionode[e.name].value=s)}}}onGetInputs(){return[["threshold","number"],["knee","number"],["ratio","number"],["reduction","number"],["attack","number"],["release","number"]]}}a(ot,"title","DynamicsCompressor"),a(ot,"desc","Dynamics Compressor"),f.createAudioNodeWrapper(ot),n.registerNodeType("audio/dynamicsCompressor",ot);class kt{constructor(){this.properties={},this.audionode=f.getAudioContext().createWaveShaper(),this.addInput("in","audio"),this.addInput("shape","waveshape"),this.addOutput("out","audio")}onExecute(){if(!(!this.inputs||!this.inputs.length)){var t=this.getInputData(1);t!==void 0&&(this.audionode.curve=t)}}setWaveShape(t){this.audionode.curve=t}}a(kt,"title","WaveShaper"),a(kt,"desc","Distortion using wave shape"),f.createAudioNodeWrapper(kt);class at{constructor(){this.properties={gain1:.5,gain2:.5},this.audionode=f.getAudioContext().createGain(),this.audionode1=f.getAudioContext().createGain(),this.audionode1.gain.value=this.properties.gain1,this.audionode2=f.getAudioContext().createGain(),this.audionode2.gain.value=this.properties.gain2,this.audionode1.connect(this.audionode),this.audionode2.connect(this.audionode),this.addInput("in1","audio"),this.addInput("in1 gain","number"),this.addInput("in2","audio"),this.addInput("in2 gain","number"),this.addOutput("out","audio")}getAudioNodeInInputSlot(t){if(t==0)return this.audionode1;if(t==2)return this.audionode2}onPropertyChanged(t,e){t=="gain1"?this.audionode1.gain.value=e:t=="gain2"&&(this.audionode2.gain.value=e)}onExecute(){if(!(!this.inputs||!this.inputs.length))for(var t=1;t<this.inputs.length;++t){var e=this.inputs[t];if(!(e.link==null||e.type=="audio")){var s=this.getInputData(t);s!==void 0&&(t==1?this.audionode1.gain.value=s:t==3&&(this.audionode2.gain.value=s))}}}}a(at,"title","Mixer"),a(at,"desc","Audio mixer"),f.createAudioNodeWrapper(at),n.registerNodeType("audio/mixer",at);class nt{constructor(){this.properties={A:.1,D:.1,S:.1,R:.1},this.audionode=f.getAudioContext().createGain(),this.audionode.gain.value=0,this.addInput("in","audio"),this.addInput("gate","boolean"),this.addOutput("out","audio"),this.gate=!1}onExecute(){var t=f.getAudioContext(),e=t.currentTime,s=this.audionode,r=s.gain,o=this.getInputData(1),l=this.getInputOrProperty("A"),u=this.getInputOrProperty("D"),h=this.getInputOrProperty("S"),d=this.getInputOrProperty("R");!this.gate&&o?(r.cancelScheduledValues(0),r.setValueAtTime(0,e),r.linearRampToValueAtTime(1,e+l),r.linearRampToValueAtTime(h,e+l+u)):this.gate&&!o&&(r.cancelScheduledValues(0),r.setValueAtTime(r.value,e),r.linearRampToValueAtTime(0,e+d)),this.gate=o}onGetInputs(){return[["A","number"],["D","number"],["S","number"],["R","number"]]}}a(nt,"title","ADSR"),a(nt,"desc","Audio envelope"),f.createAudioNodeWrapper(nt),n.registerNodeType("audio/adsr",nt);class lt{constructor(){this.properties={delayTime:.5},this.audionode=f.getAudioContext().createDelay(10),this.audionode.delayTime.value=this.properties.delayTime,this.addInput("in","audio"),this.addInput("time","number"),this.addOutput("out","audio")}onExecute(){var t=this.getInputData(1);t!==void 0&&(this.audionode.delayTime.value=t)}}a(lt,"title","Delay"),a(lt,"desc","Audio delay"),f.createAudioNodeWrapper(lt),n.registerNodeType("audio/delay",lt);class ut{constructor(){this.properties={frequency:350,detune:0,Q:1},this.addProperty("type","lowpass","enum",{values:["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"]}),this.audionode=f.getAudioContext().createBiquadFilter(),this.addInput("in","audio"),this.addOutput("out","audio")}onExecute(){if(!(!this.inputs||!this.inputs.length))for(var t=1;t<this.inputs.length;++t){var e=this.inputs[t];if(e.link!=null){var s=this.getInputData(t);s!==void 0&&(this.audionode[e.name].value=s)}}}onGetInputs(){return[["frequency","number"],["detune","number"],["Q","number"]]}}a(ut,"title","BiquadFilter"),a(ut,"desc","Audio filter"),f.createAudioNodeWrapper(ut),n.registerNodeType("audio/biquadfilter",ut);class ht{constructor(){this.properties={frequency:440,detune:0,type:"sine"},this.addProperty("type","sine","enum",{values:["sine","square","sawtooth","triangle","custom"]}),this.audionode=f.getAudioContext().createOscillator(),this.addOutput("out","audio")}onStart(){var t;if(!this.audionode.started){this.audionode.started=!0;try{this.audionode.start()}catch(e){(t=console.warn)==null||t.call(console,e)}}}onStop(){this.audionode.started&&(this.audionode.started=!1,this.audionode.stop())}onPause(){this.onStop()}onUnpause(){this.onStart()}onExecute(){if(!(!this.inputs||!this.inputs.length))for(var t=0;t<this.inputs.length;++t){var e=this.inputs[t];if(e.link!=null){var s=this.getInputData(t);s!==void 0&&(this.audionode[e.name].value=s)}}}onGetInputs(){return[["frequency","number"],["detune","number"],["type","string"]]}}a(ht,"title","Oscillator"),a(ht,"desc","Oscillator"),f.createAudioNodeWrapper(ht),n.registerNodeType("audio/oscillator",ht);class Pt{constructor(){this.properties={continuous:!0,mark:-1},this.addInput("data","array"),this.addInput("mark","number"),this.size=[300,200],this._last_buffer=null}onExecute(){this._last_buffer=this.getInputData(0);var t=this.getInputData(1);t!==void 0&&(this.properties.mark=t),this.setDirtyCanvas(!0,!1)}onDrawForeground(t){if(this._last_buffer){var e=this._last_buffer,s=e.length/this.size[0],r=this.size[1];t.fillStyle="black",t.fillRect(0,0,this.size[0],this.size[1]),t.strokeStyle="white",t.beginPath();var o=0;if(this.properties.continuous){t.moveTo(o,r);for(let h=0;h<e.length;h+=s)t.lineTo(o,r-e[h|0]/255*r),o++}else for(let h=0;h<e.length;h+=s)t.moveTo(o+.5,r),t.lineTo(o+.5,r-e[h|0]/255*r),o++;if(t.stroke(),this.properties.mark>=0){var l=f.getAudioContext().sampleRate,u=l/e.length;o=2*(this.properties.mark/u)/s,o>=this.size[0]&&(o=this.size[0]-1),t.strokeStyle="red",t.beginPath(),t.moveTo(o,r),t.lineTo(o,0),t.stroke()}}}}a(Pt,"title","Visualization"),a(Pt,"desc","Audio Visualization"),n.registerNodeType("audio/visualization",Pt);class Rt{constructor(){this.properties={band:440,amplitude:1},this.addInput("freqs","array"),this.addOutput("signal","number")}onExecute(){if(this._freqs=this.getInputData(0),!!this._freqs){var t=this.properties.band,e=this.getInputData(1);e!==void 0&&(t=e);var s=f.getAudioContext().sampleRate,r=s/this._freqs.length,o=2*(t/r);if(e=0,o<0&&(e=this._freqs[0]),o>=this._freqs.length)e=this._freqs[this._freqs.length-1];else{var l=o|0,u=this._freqs[l],h=this._freqs[l+1],d=o-l;e=u*(1-d)+h*d}this.setOutputData(0,e/255*this.properties.amplitude)}}onGetInputs(){return[["band","number"]]}}a(Rt,"title","Signal"),a(Rt,"desc","extract the signal of some frequency"),n.registerNodeType("audio/signal",Rt);const Lt=class k{constructor(){a(this,"@code",{widget:"code",type:"code"});var t;if(!k.default_code){var e=k.default_function.toString(),s=e.indexOf("{")+1,r=e.lastIndexOf("}");k.default_code=e.substr(s,r-s)}this.properties={code:k.default_code};var o=f.getAudioContext();o.createScriptProcessor?this.audionode=o.createScriptProcessor(4096,1,1):((t=console.warn)==null||t.call(console,"ScriptProcessorNode deprecated"),this.audionode=o.createGain()),this.processCode(),k._bypass_function||(k._bypass_function=this.audionode.onaudioprocess),this.addInput("in","audio"),this.addOutput("out","audio")}onAdded(t){t.status==n.LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback)}onStart(){this.audionode.onaudioprocess=this._callback}onStop(){this.audionode.onaudioprocess=k._bypass_function}onPause(){this.audionode.onaudioprocess=k._bypass_function}onUnpause(){this.audionode.onaudioprocess=this._callback}onExecute(){}onRemoved(){this.audionode.onaudioprocess=k._bypass_function}processCode(){var t;try{var e=new Function("properties",this.properties.code);this._script=new e(this.properties),this._old_code=this.properties.code,this._callback=this._script.onaudioprocess}catch(s){(t=console.error)==null||t.call(console,"Error in onaudioprocess code",s),this._callback=k._bypass_function,this.audionode.onaudioprocess=this._callback}}onPropertyChanged(t,e){t=="code"&&(this.properties.code=e,this.processCode(),this.graph&&this.graph.status==n.LGraph.STATUS_RUNNING&&(this.audionode.onaudioprocess=this._callback))}static default_function(){this.onaudioprocess=function(t){for(var e=t.inputBuffer,s=t.outputBuffer,r=0;r<s.numberOfChannels;r++)for(var o=e.getChannelData(r),l=s.getChannelData(r),u=0;u<e.length;u++)l[u]=o[u]}}};a(Lt,"title","Script"),a(Lt,"desc","apply script to signal");let _e=Lt;f.createAudioNodeWrapper(_e),n.registerNodeType("audio/script",_e);class Ft{constructor(){this.audionode=f.getAudioContext().destination,this.addInput("in","audio")}}a(Ft,"title","Destination"),a(Ft,"desc","Audio output"),n.registerNodeType("audio/destination",Ft);function V(){return Math.random()*1e5|0}const N=class w{constructor(){this.addInput("obj",""),this.addInput("radius","number"),this.addOutput("out","geometry"),this.addOutput("points","[vec3]"),this.properties={radius:1,num_points:4096,generate_normals:!0,regular:!1,mode:w.SPHERE,force_update:!1},this.points=new Float32Array(this.properties.num_points*3),this.normals=new Float32Array(this.properties.num_points*3),this.must_update=!0,this.version=0;var t=this;this.addWidget("button","update",null,function(){t.must_update=!0}),this.geometry={vertices:null,_id:V()},this._old_obj=null,this._last_radius=null}onPropertyChanged(t,e){this.must_update=!0}onExecute(){var t=this.getInputData(0);(t!=this._old_obj||t&&t._version!=this._old_obj_version)&&(this._old_obj=t,this.must_update=!0);var e=this.getInputData(1);e==null&&(e=this.properties.radius),this._last_radius!=e&&(this._last_radius=e,this.must_update=!0),(this.must_update||this.properties.force_update)&&(this.must_update=!1,this.updatePoints()),this.geometry.vertices=this.points,this.geometry.normals=this.normals,this.geometry._version=this.version,this.setOutputData(0,this.geometry)}updatePoints(){var t=this.properties.num_points|0;t<1&&(t=1),(!this.points||this.points.length!=t*3)&&(this.points=new Float32Array(t*3)),this.properties.generate_normals?(!this.normals||this.normals.length!=this.points.length)&&(this.normals=new Float32Array(this.points.length)):this.normals=null;var e=this._last_radius||this.properties.radius,s=this.properties.mode,r=this.getInputData(0);this._old_obj_version=r?r._version:null,this.points=w.generatePoints(e,t,s,this.points,this.normals,this.properties.regular,r),this.version++}static generatePoints(t,e,s,r,o,l,u){var h,d=e*3;(!r||r.length!=d)&&(r=new Float32Array(d));var c=new Float32Array(3),g=new Float32Array([0,1,0]);if(l){if(s==w.RECTANGLE){let p=Math.floor(Math.sqrt(e));for(let y=0;y<p;++y)for(let _=0;_<p;++_){let b=y*3+_*3*p;r[b]=(y/p-.5)*t*2,r[b+1]=0,r[b+2]=(_/p-.5)*t*2}if(r=new Float32Array(r.subarray(0,p*p*3)),o)for(let y=0;y<o.length;y+=3)o.set(g,y)}else if(s==w.SPHERE){let p=Math.floor(Math.sqrt(e));for(let y=0;y<p;++y)for(let _=0;_<p;++_){let b=y*3+_*3*p;const I=y/p*2*Math.PI,x=(_/p-.5)*2*Math.PI;c[0]=Math.cos(I)*Math.cos(x)*t,c[1]=Math.sin(x)*t,c[2]=Math.sin(I)*Math.cos(x)*t,r[b]=c[0],r[b+1]=c[1],r[b+2]=c[2]}r=new Float32Array(r.subarray(0,p*p*3)),o&&w.generateSphericalNormals(r,o)}else if(s==w.CIRCLE){for(let p=0;p<d;p+=3){let y=2*Math.PI*(p/d);r[p]=Math.cos(y)*t,r[p+1]=0,r[p+2]=Math.sin(y)*t}if(o)for(let p=0;p<o.length;p+=3)o.set(g,p)}}else if(s==w.RECTANGLE){for(let p=0;p<d;p+=3)r[p]=(Math.random()-.5)*t*2,r[p+1]=0,r[p+2]=(Math.random()-.5)*t*2;if(o)for(let p=0;p<o.length;p+=3)o.set(g,p)}else if(s==w.CUBE){for(let p=0;p<d;p+=3)r[p]=(Math.random()-.5)*t*2,r[p+1]=(Math.random()-.5)*t*2,r[p+2]=(Math.random()-.5)*t*2;if(o)for(let p=0;p<o.length;p+=3)o.set(g,p)}else if(s==w.SPHERE)w.generateSphere(r,d,t),o&&w.generateSphericalNormals(r,o);else if(s==w.HEMISPHERE)w.generateHemisphere(r,d,t),o&&w.generateSphericalNormals(r,o);else if(s==w.CIRCLE)w.generateInsideCircle(r,d,t),o&&w.generateSphericalNormals(r,o);else if(s==w.INSIDE_SPHERE)w.generateInsideSphere(r,d,t),o&&w.generateSphericalNormals(r,o);else if(s==w.OBJECT){if(typeof GL=="undefined"||typeof vec3=="undefined")return r;w.generateFromObject(r,o,d,u,!1)}else if(s==w.OBJECT_UNIFORMLY){if(typeof GL=="undefined"||typeof vec3=="undefined")return r;w.generateFromObject(r,o,d,u,!0)}else if(s==w.OBJECT_INSIDE){if(typeof GL=="undefined"||typeof vec3=="undefined")return r;w.generateFromInsideObject(r,d,u)}else(h=console.warn)==null||h.call(console,"wrong mode in LGraphPoints3D");return r}static generateSphericalNormals(t,e){if(typeof vec3!="undefined")for(var s=new Float32Array(3),r=0;r<e.length;r+=3)s[0]=t[r],s[1]=t[r+1],s[2]=t[r+2],vec3.normalize(s,s),e.set(s,r)}static generateSphere(t,e,s){for(var r=0;r<e;r+=3){var o=Math.random(),l=Math.random(),u=2*Math.cos(2*Math.PI*o)*Math.sqrt(l*(1-l)),h=1-2*l,d=2*Math.sin(2*Math.PI*o)*Math.sqrt(l*(1-l));t[r]=u*s,t[r+1]=h*s,t[r+2]=d*s}}static generateHemisphere(t,e,s){for(var r=0;r<e;r+=3){var o=Math.random(),l=Math.random(),u=Math.cos(2*Math.PI*o)*Math.sqrt(1-l*l),h=l,d=Math.sin(2*Math.PI*o)*Math.sqrt(1-l*l);t[r]=u*s,t[r+1]=h*s,t[r+2]=d*s}}static generateInsideCircle(t,e,s){for(var r=0;r<e;r+=3){var o=Math.random(),l=Math.random(),u=Math.cos(2*Math.PI*o)*Math.sqrt(1-l*l),h=Math.sin(2*Math.PI*o)*Math.sqrt(1-l*l);t[r]=u*s,t[r+1]=0,t[r+2]=h*s}}static generateInsideSphere(t,e,s){for(var r=0;r<e;r+=3){var o=Math.random(),l=Math.random(),u=o*2*Math.PI,h=Math.acos(2*l-1),d=Math.cbrt(Math.random())*s,c=Math.sin(u),g=Math.cos(u),p=Math.sin(h),y=Math.cos(h);t[r]=d*p*g,t[r+1]=d*p*c,t[r+2]=d*y}}static generateFromObject(t,e,s,r,o){if(typeof GL=="undefined"||typeof vec3=="undefined")return null;if(!r)return;var l=null,u=null,h=null,d=null;function c(E,me){var Mt=E.length,Y=0,j=0,et=Mt;if(Mt==0)return-1;if(Mt==1)return 0;for(;et>=Y;){j=(et+Y)*.5|0;var ve=E[j];if(ve==me)return j;if(Y==et-1)return Y;ve<me?Y=j:et=j}return j}if(r.constructor===GL.Mesh&&(l=r.vertexBuffers.vertices.data,u=r.vertexBuffers.normals?r.vertexBuffers.normals.data:null,h=r.indexBuffers.indices?r.indexBuffers.indices.data:null,h||(h=r.indexBuffers.triangles?r.indexBuffers.triangles.data:null)),!l)return null;var g=h?h.length/3:l.length/9,p=0;if(o){d=new Float32Array(g);for(let E=0;E<g;++E){h?(A=h[E*3]*3,D=h[E*3+1]*3,C=h[E*3+2]*3):(A=E*9,D=E*9+3,C=E*9+6);var y=l.subarray(A,A+3),_=l.subarray(D,D+3),b=l.subarray(C,C+3),I=vec3.distance(y,_),x=vec3.distance(_,b),S=vec3.distance(b,y),F=(I+x+S)/2;p+=Math.sqrt(F*(F-I)*(F-x)*(F-S)),d[E]=p}for(let E=0;E<g;++E)d[E]/=p}for(let E=0;E<s;E+=3){var de=Math.random(),G=o?c(d,de):Math.floor(de*g),A=0,D=0,C=0;h?(A=h[G*3]*3,D=h[G*3+1]*3,C=h[G*3+2]*3):(A=G*9,D=G*9+3,C=G*9+6);var F=Math.random(),pe=Math.random(),Ct=Math.sqrt(F),z=1-Ct,q=Ct*(1-pe),B=pe*Ct;if(t[E]=z*l[A]+q*l[D]+B*l[C],t[E+1]=z*l[A+1]+q*l[D+1]+B*l[C+1],t[E+2]=z*l[A+2]+q*l[D+2]+B*l[C+2],e&&u){e[E]=z*u[A]+q*u[D]+B*u[C],e[E+1]=z*u[A+1]+q*u[D+1]+B*u[C+1],e[E+2]=z*u[A+2]+q*u[D+2]+B*u[C+2];var ce=e.subarray(E,E+3);vec3.normalize(ce,ce)}}}static generateFromInsideObject(t,e,s){if(!(!s||s.constructor!==GL.Mesh)){var r=s.getBoundingBox();s.octree||(s.octree=new GL.Octree(s));for(var o=s.octree,l=vec3.create(),u=vec3.fromValues(1,0,0),h=vec3.create(),d=0,c=0;d<e&&c<t.length*10;){c+=1;var g=vec3.random(h);g[0]=(g[0]*2-1)*r[3]+r[0],g[1]=(g[1]*2-1)*r[4]+r[1],g[2]=(g[2]*2-1)*r[5]+r[2],l.set(g);var p=o.testRay(l,u,0,1e4,!0,GL.Octree.ALL);!p||p.length%2==0||(t.set(g,d),d+=3)}}}};a(N,"RECTANGLE",1),a(N,"CIRCLE",2),a(N,"CUBE",10),a(N,"SPHERE",11),a(N,"HEMISPHERE",12),a(N,"INSIDE_SPHERE",13),a(N,"OBJECT",20),a(N,"OBJECT_UNIFORMLY",21),a(N,"OBJECT_INSIDE",22),a(N,"MODE_VALUES",{rectangle:N.RECTANGLE,circle:N.CIRCLE,cube:N.CUBE,sphere:N.SPHERE,hemisphere:N.HEMISPHERE,inside_sphere:N.INSIDE_SPHERE,object:N.OBJECT,object_uniformly:N.OBJECT_UNIFORMLY,object_inside:N.OBJECT_INSIDE}),a(N,"widgets_info",{mode:{widget:"combo",values:N.MODE_VALUES}}),a(N,"title","list of points"),a(N,"desc","returns an array of points");let Me=N;n.registerNodeType("geometry/points3D",Me);const P=class W{constructor(){this.addInput("points","geometry"),this.addOutput("instances","[mat4]"),this.properties={mode:1,autoupdate:!0},this.must_update=!0,this.matrices=[],this.first_time=!0}onExecute(){var t=this.getInputData(0);if(!t){this.setOutputData(0,null);return}if(this.isOutputConnected(0)){var e=t._version!=this._version||t._id!=this._geometry_id;(e&&this.properties.autoupdate||this.first_time)&&(this.first_time=!1,this.updateInstances(t)),this.setOutputData(0,this.matrices)}}updateInstances(t){var e=t.vertices;if(!e)return null;var s=t.normals,r=this.matrices,o=e.length/3;r.length!=o&&(r.length=o);for(var l=mat4.create(),u=vec3.create(),h=vec3.fromValues(0,1,0),d=vec3.fromValues(0,0,-1),c=quat.create(),g=vec3.create(),p=vec3.create(),y=vec3.create(),_=0;_<e.length;_+=3){var b=_/3,I=r[b];I||(I=r[b]=mat4.create()),I.set(l);var x=e.subarray(_,_+3);switch(this.properties.mode){case W.NORMAL:if(mat4.setTranslation(I,x),s){var S=s.subarray(_,_+3);y.set(S),vec3.normalize(y,y),vec3.cross(p,d,y),vec3.normalize(p,p),vec3.cross(g,p,y),vec3.normalize(g,g),I.set(p,0),I.set(y,4),I.set(g,8),mat4.setTranslation(I,x)}break;case W.VERTICAL:mat4.setTranslation(I,x);break;case W.SPHERICAL:g.set(x),vec3.normalize(g,g),vec3.cross(p,h,g),vec3.normalize(p,p),vec3.cross(y,g,p),vec3.normalize(y,y),I.set(p,0),I.set(y,4),I.set(g,8),mat4.setTranslation(I,x);break;case W.RANDOM:u[0]=Math.random()*2-1,u[1]=Math.random()*2-1,u[2]=Math.random()*2-1,vec3.normalize(u,u),quat.setAxisAngle(c,u,Math.random()*2*Math.PI),mat4.fromQuat(I,c),mat4.setTranslation(I,x);break;case W.RANDOM_VERTICAL:quat.setAxisAngle(c,h,Math.random()*2*Math.PI),mat4.fromQuat(I,c),mat4.setTranslation(I,x);break}}this._version=t._version,this._geometry_id=t._id}};a(P,"NORMAL",0),a(P,"VERTICAL",1),a(P,"SPHERICAL",2),a(P,"RANDOM",3),a(P,"RANDOM_VERTICAL",4),a(P,"modes",{normal:0,vertical:1,spherical:2,random:3,random_vertical:4}),a(P,"widgets_info",{mode:{widget:"combo",values:P.modes}}),a(P,"title","points to inst");let Se=P;n.registerNodeType("geometry/points_to_instances",Se);class ye{constructor(){this.addInput("in","geometry,[mat4]"),this.addInput("mat4","mat4"),this.addOutput("out","geometry"),this.properties={},this.geometry={type:"triangles",vertices:null,_id:V(),_version:0},this._last_geometry_id=-1,this._last_version=-1,this._last_key="",this.must_update=!0}onExecute(){var t=this.getInputData(0),e=this.getInputData(1);if(t){if(t.constructor===Array){if(t.length==0||(this.outputs[0].type="[mat4]",!this.isOutputConnected(0)))return;if(!e){this.setOutputData(0,t);return}this._output||(this._output=new Array),this._output.length!=t.length&&(this._output.length=t.length);for(var s=0;s<t.length;++s){var r=this._output[s];r||(r=this._output[s]=mat4.create()),mat4.multiply(r,t[s],e)}this.setOutputData(0,this._output);return}if(!(!t.vertices||!t.vertices.length)){var o=t;if(this.outputs[0].type="geometry",!!this.isOutputConnected(0)){if(!e){this.setOutputData(0,o);return}var l=Array.from(e).join(",");(this.must_update||o._id!=this._last_geometry_id||o._version!=this._last_version||l!=this._last_key)&&(this.updateGeometry(o,e),this._last_key=l,this._last_version=o._version,this._last_geometry_id=o._id,this.must_update=!1),this.setOutputData(0,this.geometry)}}}}updateGeometry(t,e){var s=t.vertices,r=this.geometry.vertices;(!r||r.length!=s.length)&&(r=this.geometry.vertices=new Float32Array(s.length));var o=vec3.create();for(let d=0,c=r.length;d<c;d+=3)o[0]=s[d],o[1]=s[d+1],o[2]=s[d+2],mat4.multiplyVec3(o,e,o),r[d]=o[0],r[d+1]=o[1],r[d+2]=o[2];if(t.normals){(!this.geometry.normals||this.geometry.normals.length!=t.normals.length)&&(this.geometry.normals=new Float32Array(t.normals.length));var l=this.geometry.normals,u=mat4.invert(mat4.create(),e);u&&mat4.transpose(u,u);var h=t.normals;for(let d=0,c=l.length;d<c;d+=3)o[0]=h[d],o[1]=h[d+1],o[2]=h[d+2],mat4.multiplyVec3(o,u,o),l[d]=o[0],l[d+1]=o[1],l[d+2]=o[2]}this.geometry.type=t.type,this.geometry._version++}}a(ye,"title","Transform"),n.registerNodeType("geometry/transform",ye);class fe{constructor(){this.addInput("sides","number"),this.addInput("radius","number"),this.addOutput("out","geometry"),this.properties={sides:6,radius:1,uvs:!1},this.geometry={type:"line_loop",vertices:null,_id:V()},this.geometry_id=-1,this.version=-1,this.must_update=!0,this.last_info={sides:-1,radius:-1}}onExecute(){if(this.isOutputConnected(0)){var t=this.getInputOrProperty("sides"),e=this.getInputOrProperty("radius");t=Math.max(3,t)|0,(this.last_info.sides!=t||this.last_info.radius!=e)&&this.updateGeometry(t,e),this.setOutputData(0,this.geometry)}}updateGeometry(t,e){var s=3*t,r=this.geometry.vertices;(!r||r.length!=s)&&(r=this.geometry.vertices=new Float32Array(3*t));var o=Math.PI*2/t,l=this.properties.uvs;l&&(uvs=this.geometry.coords=new Float32Array(3*t));for(var u=0;u<t;++u){var h=o*-u,d=Math.cos(h)*e,c=0,g=Math.sin(h)*e;r[u*3]=d,r[u*3+1]=c,r[u*3+2]=g}this.geometry._id=++this.geometry_id,this.geometry._version=++this.version,this.last_info.sides=t,this.last_info.radius=e}}a(fe,"title","Polygon"),n.registerNodeType("geometry/polygon",fe);class be{constructor(){this.addInput("","geometry"),this.addOutput("","geometry"),this.properties={top_cap:!0,bottom_cap:!0,offset:[0,100,0]},this.version=-1,this._last_geo_version=-1,this._must_update=!0}onPropertyChanged(t,e){this._must_update=!0}onExecute(){var t=this.getInputData(0);!t||!this.isOutputConnected(0)||((t.version!=this._last_geo_version||this._must_update)&&(this._geo=this.extrudeGeometry(t,this._geo),this._geo&&(this._geo.version=this.version++),this._must_update=!1),this.setOutputData(0,this._geo))}extrudeGeometry(t){var e=t.vertices,s=e.length/3,r=vec3.create(),o=vec3.create(),l=vec3.create(),u=vec3.create(),h=new Float32Array(this.properties.offset);if(t.type=="line_loop")for(var d=new Float32Array(s*6*3),c=0,g=0,p=e.length;g<p;g+=3)r[0]=e[g],r[1]=e[g+1],r[2]=e[g+2],g+3<p?(o[0]=e[g+3],o[1]=e[g+4],o[2]=e[g+5]):(o[0]=e[0],o[1]=e[1],o[2]=e[2]),vec3.add(l,r,h),vec3.add(u,o,h),d.set(r,c),c+=3,d.set(o,c),c+=3,d.set(l,c),c+=3,d.set(o,c),c+=3,d.set(u,c),c+=3,d.set(l,c),c+=3;var y={_id:V(),type:"triangles",vertices:d};return y}}a(be,"title","extrude"),n.registerNodeType("geometry/extrude",be);class dt{constructor(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={code:"V[1] += 0.01 * Math.sin(I + T*0.001);",execute_every_frame:!1},this.geometry=null,this.geometry_id=-1,this.version=-1,this.must_update=!0,this.vertices=null,this.func=null}onConfigure(){this.compileCode()}compileCode(){if(this.properties.code)try{this.func=new Function("V","I","T",this.properties.code),this.boxcolor="#AFA",this.must_update=!0}catch{this.boxcolor="red"}}onPropertyChanged(t,e){t=="code"&&(this.properties.code=e,this.compileCode())}onExecute(){var t=this.getInputData(0);if(t){if(!this.func){this.setOutputData(0,t);return}if(this.geometry_id!=t._id||this.version!=t._version||this.must_update||this.properties.execute_every_frame){this.must_update=!1,this.geometry_id=t._id,this.properties.execute_every_frame?this.version++:this.version=t._version;var e=this.func,s=getTime();this.geometry||(this.geometry={});for(let l in t)t[l]!=null&&(t[l].constructor==Float32Array?this.geometry[l]=new Float32Array(t[l]):this.geometry[l]=t[l]);this.geometry._id=t._id,this.properties.execute_every_frame?this.geometry._version=this.version:this.geometry._version=t._version+1;var r=vec3.create(),o=this.vertices;!o||this.vertices.length!=t.vertices.length?o=this.vertices=new Float32Array(t.vertices):o.set(t.vertices);for(let l=0;l<o.length;l+=3)r[0]=o[l],r[1]=o[l+1],r[2]=o[l+2],e(r,l/3,s),o[l]=r[0],o[l+1]=r[1],o[l+2]=r[2];this.geometry.vertices=o}this.setOutputData(0,this.geometry)}}}a(dt,"title","geoeval"),a(dt,"desc","eval code"),a(dt,"widgets_info",{code:{widget:"code"}}),n.registerNodeType("geometry/eval",dt);class Gt{constructor(){this.addInput("in","geometry"),this.addOutput("out","geometry"),this.properties={min_dist:.4,max_dist:.5,max_connections:0,probability:1},this.geometry_id=-1,this.version=-1,this.my_version=1,this.must_update=!0}onPropertyChanged(t,e){this.must_update=!0}onExecute(){var t=this.getInputData(0);if(t){if(this.geometry_id!=t._id||this.version!=t._version||this.must_update){this.must_update=!1,this.geometry_id=t._id,this.version=t._version,this.geometry={};for(let x in t)this.geometry[x]=t[x];this.geometry._id=V(),this.geometry._version=this.my_version++;var e=t.vertices,s=e.length,r=this.properties.min_dist,o=this.properties.max_dist,l=this.properties.probability,u=this.properties.max_connections,h=[];for(let x=0;x<s;x+=3){var d=e[x],c=e[x+1],g=e[x+2],p=0;for(let S=x+3;S<s;S+=3){var y=e[S],_=e[S+1],b=e[S+2],I=Math.sqrt((d-y)*(d-y)+(c-_)*(c-_)+(g-b)*(g-b));if(!(I>o||I<r||l<1&&l<Math.random())&&(h.push(x/3,S/3),p+=1,u&&p>u))break}}this.geometry.indices=this.indices=new Uint32Array(h)}this.indices&&this.indices.length?(this.geometry.indices=this.indices,this.setOutputData(0,this.geometry)):this.setOutputData(0,null)}}}if(a(Gt,"title","connect points"),a(Gt,"desc","adds indices between near points"),n.registerNodeType("geometry/connectPoints",Gt),typeof GL!="undefined"){class m{constructor(){this.addInput("mesh","mesh"),this.addOutput("out","geometry"),this.geometry={},this.last_mesh=null}onExecute(){var h=this.getInputData(0);if(h){if(h!=this.last_mesh){this.last_mesh=h;for(i in h.vertexBuffers){var d=h.vertexBuffers[i];this.geometry[i]=d.data}h.indexBuffers.triangles&&(this.geometry.indices=h.indexBuffers.triangles.data),this.geometry._id=V(),this.geometry._version=0}this.setOutputData(0,this.geometry),this.geometry&&this.setOutputData(1,this.geometry.vertices)}}}a(m,"title","to geometry"),a(m,"desc","converts a mesh to geometry"),n.registerNodeType("geometry/toGeometry",m);class t{constructor(){this.addInput("in","geometry"),this.addOutput("mesh","mesh"),this.properties={},this.version=-1,this.mesh=null}updateMesh(h){this.mesh||(this.mesh=new GL.Mesh);for(let b in h)if(b[0]!="_"){var d=h[b],c=GL.Mesh.common_buffers[b];if(!(!c&&b!="indices")){var g=c?c.spacing:3,p=this.mesh.vertexBuffers[b];!p||p.data.length!=d.length?p=new GL.Buffer(b=="indices"?GL.ELEMENT_ARRAY_BUFFER:GL.ARRAY_BUFFER,d,g,GL.DYNAMIC_DRAW):(p.data.set(d),p.upload(GL.DYNAMIC_DRAW)),this.mesh.addBuffer(b,p)}}if(this.mesh.vertexBuffers.normals&&this.mesh.vertexBuffers.normals.data.length!=this.mesh.vertexBuffers.vertices.data.length){var y=new Float32Array([0,1,0]),_=new Float32Array(this.mesh.vertexBuffers.vertices.data.length);for(let b=0;b<_.length;b+=3)_.set(y,b);p=new GL.Buffer(GL.ARRAY_BUFFER,_,3),this.mesh.addBuffer("normals",p)}return this.mesh.updateBoundingBox(),this.geometry_id=this.mesh.id=h._id,this.version=this.mesh.version=h._version,this.mesh}onExecute(){var h=this.getInputData(0);h&&((this.version!=h._version||this.geometry_id!=h._id)&&this.updateMesh(h),this.setOutputData(0,this.mesh))}}a(t,"title","Geo to Mesh"),n.registerNodeType("geometry/toMesh",t);const e=class{constructor(){this.addInput("mesh","mesh"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,primitive:GL.TRIANGLES,additive:!1,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.model_matrix=mat4.create(),this.uniforms={u_color:this.color,u_model:this.model_matrix}}onExecute(){var h;if(this.properties.enabled){var d=this.getInputData(0);if(d){(h=console.warn)==null||h.call(console,"cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}}}};a(e,"title","Render Mesh"),a(e,"desc","renders a mesh flat"),a(e,"PRIMITIVE_VALUES",{points:GL.POINTS,lines:GL.LINES,line_loop:GL.LINE_LOOP,line_strip:GL.LINE_STRIP,triangles:GL.TRIANGLES,triangle_fan:GL.TRIANGLE_FAN,triangle_strip:GL.TRIANGLE_STRIP}),a(e,"widgets_info",{primitive:{widget:"combo",values:e.PRIMITIVE_VALUES},color:{widget:"color"}});let s=e;n.registerNodeType("geometry/render_mesh",s);const r=class{constructor(){this.addInput("size","number"),this.addOutput("out","mesh"),this.properties={type:1,size:1,subdivisions:32},this.version=Math.random()*1e5|0,this.last_info={type:-1,size:-1,subdivisions:-1}}onExecute(){if(this.isOutputConnected(0)){var h=this.getInputOrProperty("size");(this.last_info.type!=this.properties.type||this.last_info.size!=h||this.last_info.subdivisions!=this.properties.subdivisions)&&this.updateMesh(this.properties.type,h,this.properties.subdivisions),this.setOutputData(0,this._mesh)}}updateMesh(h,d,c){switch(c=Math.max(0,c)|0,h){case 1:this._mesh=GL.Mesh.cube({size:d,normals:!0,coords:!0});break;case 2:this._mesh=GL.Mesh.plane({size:d,xz:!0,detail:c,normals:!0,coords:!0});break;case 3:this._mesh=GL.Mesh.cylinder({size:d,subdivisions:c,normals:!0,coords:!0});break;case 4:this._mesh=GL.Mesh.sphere({size:d,long:c,lat:c,normals:!0,coords:!0});break;case 5:this._mesh=GL.Mesh.circle({size:d,slices:c,normals:!0,coords:!0});break;case 6:this._mesh=GL.Mesh.sphere({size:d,long:c,lat:c,normals:!0,coords:!0,hemi:!0});break;case 7:this._mesh=GL.Mesh.icosahedron({size:d,subdivisions:c});break;case 8:this._mesh=GL.Mesh.cone({radius:d,height:d,subdivisions:c});break;case 9:this._mesh=GL.Mesh.plane({size:d,xz:!1,detail:c,normals:!0,coords:!0});break}this.last_info.type=h,this.last_info.size=d,this.last_info.subdivisions=c,this._mesh.version=this.version++}};a(r,"title","Primitive"),a(r,"VALID",{CUBE:1,PLANE:2,CYLINDER:3,SPHERE:4,CIRCLE:5,HEMISPHERE:6,ICOSAHEDRON:7,CONE:8,QUAD:9}),a(r,"widgets_info",{type:{widget:"combo",values:r.VALID}});let o=r;n.registerNodeType("geometry/mesh_primitive",o);class l{constructor(){this.addInput("in","geometry"),this.addInput("mat4","mat4"),this.addInput("tex","texture"),this.properties={enabled:!0,point_size:.1,fixed_size:!1,additive:!0,color:[1,1,1],opacity:1},this.color=vec4.create([1,1,1,1]),this.uniforms={u_point_size:1,u_perspective:1,u_point_perspective:1,u_color:this.color},this.geometry_id=-1,this.version=-1,this.mesh=null}updateMesh(h){!this.buffer||!this.buffer.data||this.buffer.data.length!=h.vertices.length?this.buffer=new GL.Buffer(GL.ARRAY_BUFFER,h.vertices,3,GL.DYNAMIC_DRAW):(this.buffer.data.set(h.vertices),this.buffer.upload(GL.DYNAMIC_DRAW)),this.mesh||(this.mesh=new GL.Mesh),this.mesh.addBuffer("vertices",this.buffer),this.geometry_id=this.mesh.id=h._id,this.version=this.mesh.version=h._version}onExecute(){var h;if(this.properties.enabled){var d=this.getInputData(0);if(d){(this.version!=d._version||this.geometry_id!=d._id)&&this.updateMesh(d);{(h=console.warn)==null||h.call(console,"cannot render geometry, LiteGraph.onRequestCameraMatrices is null, remember to fill this with a callback(view_matrix, projection_matrix,viewprojection_matrix) to use 3D rendering from the graph");return}}}}}a(l,"title","renderPoints"),a(l,"desc","render points with a texture"),a(l,"widgets_info",{color:{widget:"color"}}),a(l,"vertex_shader_code",`
            precision mediump float;
            attribute vec3 a_vertex;
            varying vec3 v_vertex;
            attribute vec3 a_normal;
            varying vec3 v_normal;
            #ifdef USE_COLOR
                attribute vec4 a_color;
                varying vec4 v_color;
            #endif
            attribute vec2 a_coord;
            varying vec2 v_coord;
            #ifdef USE_SIZE
                attribute float a_extra;
            #endif
            #ifdef USE_INSTANCING
                attribute mat4 u_model;
            #else
                uniform mat4 u_model;
            #endif
            uniform mat4 u_viewprojection;
            uniform float u_point_size;
            uniform float u_perspective;
            uniform float u_point_perspective;
            float computePointSize(float radius, float w)
            {
                if(radius < 0.0)
                    return -radius;
                return u_perspective * radius / w;
            }
            void main() {
                v_coord = a_coord;
                #ifdef USE_COLOR
                    v_color = a_color;
                #endif
                v_vertex = ( u_model * vec4( a_vertex, 1.0 )).xyz;
                v_normal = ( u_model * vec4( a_normal, 0.0 )).xyz;
                gl_Position = u_viewprojection * vec4(v_vertex,1.0);
                gl_PointSize = u_point_size;
                #ifdef USE_SIZE
                    gl_PointSize = a_extra;
                #endif
                if(u_point_perspective != 0.0)
                    gl_PointSize = computePointSize( gl_PointSize, gl_Position.w );
            }
        `),a(l,"fragment_shader_code",`
            precision mediump float;
            uniform vec4 u_color;
            #ifdef USE_COLOR
                varying vec4 v_color;
            #endif
            varying vec2 v_coord;
            uniform sampler2D u_texture;
            void main() {
                vec4 color = u_color;
                #ifdef USE_TEXTURED_POINTS
                    color *= texture2D(u_texture, gl_PointCoord.xy);
                #else
                    #ifdef USE_TEXTURE
                        color *= texture2D(u_texture, v_coord);
                        if(color.a < 0.1)
                            discard;
                    #endif
                    #ifdef USE_POINTS
                        float dist = length( gl_PointCoord.xy - vec2(0.5) );
                        if( dist > 0.45 )
                            discard;
                    #endif
                #endif
                #ifdef USE_COLOR
                    color *= v_color;
                #endif
                gl_FragColor = color;
            }
        `),n.registerNodeType("geometry/render_points",l)}const pt=class Ne{constructor(){this.addInput("A","Number"),this.addInput("B","Number"),this.addInput("C","Number"),this.addInput("D","Number"),this.values=[[],[],[],[]],this.properties={scale:2}}onExecute(){if(!this.flags.collapsed)for(var t=this.size,e=0;e<4;++e){var s=this.getInputData(e);if(s!=null){var r=this.values[e];r.push(s),r.length>t[0]&&r.shift()}}}onDrawBackground(t){if(!this.flags.collapsed){var e=this.size,s=.5*e[1]/this.properties.scale,r=Ne.colors,o=e[1]*.5;if(t.fillStyle="#000",t.fillRect(0,0,e[0],e[1]),t.strokeStyle="#555",t.beginPath(),t.moveTo(0,o),t.lineTo(e[0],o),t.stroke(),this.inputs)for(let l=0;l<4;++l){let u=this.values[l];if(!this.inputs[l]||!this.inputs[l].link)continue;t.strokeStyle=r[l],t.beginPath();let h=u[0]*s*-1+o;t.moveTo(0,n.clamp(h,0,e[1]));for(let d=1;d<u.length&&d<e[0];++d)h=u[d]*s*-1+o,t.lineTo(d,n.clamp(h,0,e[1]));t.stroke()}}}};a(pt,"title","Plot"),a(pt,"desc","Plots data over time"),a(pt,"colors",["#FFF","#F99","#9F9","#99F"]);let ke=pt;n.registerNodeType("graphics/plot",ke);class K{constructor(){this.addOutput("frame","image"),this.properties={url:""}}onAdded(){this.properties.url!=""&&this.img==null&&this.loadImage(this.properties.url)}onDrawBackground(t){this.flags.collapsed||this.img&&this.size[0]>5&&this.size[1]>5&&this.img.width&&t.drawImage(this.img,0,0,this.size[0],this.size[1])}onExecute(){this.img||(this.boxcolor="#000"),this.img&&this.img.width?this.setOutputData(0,this.img):this.setOutputData(0,null),this.img&&this.img.dirty&&(this.img.dirty=!1)}onPropertyChanged(t,e){return this.properties[t]=e,t=="url"&&e!=""&&this.loadImage(e),!0}loadImage(t,e){if(t==""){this.img=null;return}this.img=document.createElement("img"),t.substr(0,4)=="http"&&n.proxy&&(t=n.proxy+t.substr(t.indexOf(":")+3)),this.img.src=t,this.boxcolor="#F95";var s=this;this.img.onload=function(){var r;e&&e(this),(r=console.log)==null||r.call(console,`Image loaded, size: ${s.img.width}x${s.img.height}`),this.dirty=!0,s.boxcolor="#9F9",s.setDirtyCanvas(!0)},this.img.onerror=function(){var r;(r=console.log)==null||r.call(console,"error loading the image:"+t)}}onWidget(t,e){e.name=="load"&&this.loadImage(this.properties.url)}onDropFile(t){var e=this;this._url&&URL.revokeObjectURL(this._url),this._url=URL.createObjectURL(t),this.properties.url=this._url,this.loadImage(this._url,function(s){e.size[1]=s.height/s.width*e.size[0]})}}a(K,"title","Image"),a(K,"desc","Image loader"),a(K,"widgets",[{name:"load",text:"Load",type:"button"}]),a(K,"supported_extensions",["jpg","jpeg","png","gif"]),n.registerNodeType("graphics/image",K);class zt{constructor(){this.addInput("f","number"),this.addOutput("Color","color"),this.properties={colorA:"#444444",colorB:"#44AAFF",colorC:"#44FFAA",colorD:"#FFFFFF"}}onExecute(){var t=[];this.properties.colorA!=null&&t.push(hex2num(this.properties.colorA)),this.properties.colorB!=null&&t.push(hex2num(this.properties.colorB)),this.properties.colorC!=null&&t.push(hex2num(this.properties.colorC)),this.properties.colorD!=null&&t.push(hex2num(this.properties.colorD));var e=this.getInputData(0);if(e==null&&(e=.5),e>1?e=1:e<0&&(e=0),t.length!=0){var s=[0,0,0];if(e==0)s=t[0];else if(e==1)s=t[t.length-1];else{var r=(t.length-1)*e,o=t[Math.floor(r)],l=t[Math.floor(r)+1],u=r-Math.floor(r);s[0]=o[0]*(1-u)+l[0]*u,s[1]=o[1]*(1-u)+l[1]*u,s[2]=o[2]*(1-u)+l[2]*u}for(var h=0;h<s.length;h++)s[h]/=255;this.boxcolor=colorToString(s),this.setOutputData(0,s)}}}a(zt,"title","Palette"),a(zt,"desc","Generates a color"),n.registerNodeType("color/palette",zt);class ct{constructor(){this.addInput("","image,canvas"),this.size=[200,200]}onDrawBackground(t){this.frame&&!this.flags.collapsed&&t.drawImage(this.frame,0,0,this.size[0],this.size[1])}onExecute(){this.frame=this.getInputData(0),this.setDirtyCanvas(!0)}onWidget(t,e){if(e.name=="resize"&&this.frame){var s=this.frame.width,r=this.frame.height;!s&&this.frame.videoWidth!=null&&(s=this.frame.videoWidth,r=this.frame.videoHeight),s&&r&&(this.size=[s,r]),this.setDirtyCanvas(!0,!0)}else e.name=="view"&&this.show()}show(){showElement&&this.frame&&showElement(this.frame)}}a(ct,"title","Frame"),a(ct,"desc","Frame viewer"),a(ct,"widgets",[{name:"resize",text:"Resize box",type:"button"},{name:"view",text:"View Image",type:"button"}]),n.registerNodeType("graphics/frame",ct);class mt{constructor(){this.addInputs([["img1","image"],["img2","image"],["fade","number"]]),this.addOutput("","image"),this.properties={fade:.5,width:512,height:512}}onAdded(){this.createCanvas();var t=this.canvas.getContext("2d");t.fillStyle="#000",t.fillRect(0,0,this.properties.width,this.properties.height)}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height}onExecute(){var t=this.canvas.getContext("2d"),e=this.getInputData(0);e!=null&&t.drawImage(e,0,0,this.canvas.width,this.canvas.height);var s=this.getInputData(2);s==null?s=this.properties.fade:this.properties.fade=s,t.globalAlpha=s;var r=this.getInputData(1);r!=null&&t.drawImage(r,0,0,this.canvas.width,this.canvas.height),t.globalAlpha=1,this.setOutputData(0,this.canvas),this.setDirtyCanvas(!0)}}a(mt,"title","Image fade"),a(mt,"desc","Fades between images"),a(mt,"widgets",[{name:"resizeA",text:"Resize to A",type:"button"},{name:"resizeB",text:"Resize to B",type:"button"}]),n.registerNodeType("graphics/imagefade",mt);class qt{constructor(){this.addInput("","image"),this.addOutput("","image"),this.properties={width:256,height:256,x:0,y:0,scale:1},this.size=[50,20]}onAdded(){this.createCanvas()}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.width=this.properties.width,this.canvas.height=this.properties.height}onExecute(){var t=this.getInputData(0);if(t)if(t.width){var e=this.canvas.getContext("2d");e.drawImage(t,-this.properties.x,-this.properties.y,t.width*this.properties.scale,t.height*this.properties.scale),this.setOutputData(0,this.canvas)}else this.setOutputData(0,null)}onDrawBackground(t){this.flags.collapsed||this.canvas&&t.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,this.size[0],this.size[1])}onPropertyChanged(t,e){var s;return this.properties[t]=e,t=="scale"?(this.properties[t]=parseFloat(e),this.properties[t]==0&&((s=console.error)==null||s.call(console,"Error in scale"),this.properties[t]=1)):this.properties[t]=parseInt(e),this.createCanvas(),!0}}a(qt,"title","Crop"),a(qt,"desc","Crop Image"),n.registerNodeType("graphics/cropImage",qt);class Bt{constructor(){this.addInput("clear",n.ACTION),this.addOutput("","canvas"),this.properties={width:512,height:512,autoclear:!0},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}onExecute(){var t=this.canvas,e=this.properties.width|0,s=this.properties.height|0;t.width!=e&&(t.width=e),t.height!=s&&(t.height=s),this.properties.autoclear&&this.ctx.clearRect(0,0,t.width,t.height),this.setOutputData(0,t)}onAction(t){t=="clear"&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}a(Bt,"title","Canvas"),a(Bt,"desc","Canvas to render stuff"),n.registerNodeType("graphics/canvas",Bt);class jt{constructor(){this.addInput("canvas","canvas"),this.addInput("img","image,canvas"),this.addInput("x","number"),this.addInput("y","number"),this.properties={x:0,y:0,opacity:1}}onExecute(){var t=this.getInputData(0);if(t){var e=this.getInputOrProperty("img");if(e){var s=this.getInputOrProperty("x"),r=this.getInputOrProperty("y"),o=t.getContext("2d");o.drawImage(e,s,r)}}}}a(jt,"title","DrawImage"),a(jt,"desc","Draws image into a canvas"),n.registerNodeType("graphics/drawImage",jt);class Ut{constructor(){this.addInput("canvas","canvas"),this.addInput("x","number"),this.addInput("y","number"),this.addInput("w","number"),this.addInput("h","number"),this.properties={x:0,y:0,w:10,h:10,color:"white",opacity:1}}onExecute(){var t=this.getInputData(0);if(t){var e=this.getInputOrProperty("x"),s=this.getInputOrProperty("y"),r=this.getInputOrProperty("w"),o=this.getInputOrProperty("h"),l=t.getContext("2d");l.fillRect(e,s,r,o)}}}a(Ut,"title","DrawRectangle"),a(Ut,"desc","Draws rectangle in canvas"),n.registerNodeType("graphics/drawRectangle",Ut);class vt{constructor(){this.addInput("t","number"),this.addOutputs([["frame","image"],["t","number"],["d","number"]]),this.properties={url:"",use_proxy:!0}}onExecute(){if(this.properties.url&&(this.properties.url!=this._video_url&&this.loadVideo(this.properties.url),!(!this._video||this._video.width==0))){var t=this.getInputData(0);t&&t>=0&&t<=1&&(this._video.currentTime=t*this._video.duration,this._video.pause()),this._video.dirty=!0,this.setOutputData(0,this._video),this.setOutputData(1,this._video.currentTime),this.setOutputData(2,this._video.duration),this.setDirtyCanvas(!0)}}onStart(){this.play()}onStop(){this.stop()}loadVideo(t){this._video_url=t;var e=t.substr(0,10).indexOf(":"),s="";e!=-1&&(s=t.substr(0,e));var r="";s&&(r=t.substr(0,t.indexOf("/",s.length+3)),r=r.substr(s.length+3)),this.properties.use_proxy&&s&&n.proxy&&r!=location.host&&(t=n.proxy+t.substr(t.indexOf(":")+3)),this._video=document.createElement("video"),this._video.src=t,this._video.type="type=video/mp4",this._video.muted=!0,this._video.autoplay=!0;var o=this;this._video.addEventListener("loadedmetadata",l=>{var u,h;(u=console.log)==null||u.call(console,"Duration: "+this.duration+" seconds"),(h=console.log)==null||h.call(console,"Size: "+this.videoWidth+","+this.videoHeight),o.setDirtyCanvas(!0),this.width=this.videoWidth,this.height=this.videoHeight}),this._video.addEventListener("progress",l=>{var u;(u=console.log)==null||u.call(console,"video loading...")}),this._video.addEventListener("error",l=>{var u,h,d,c,g;if((u=console.error)==null||u.call(console,"Error loading video: "+this.src),this.error)switch(this.error.code){case this.error.MEDIA_ERR_ABORTED:(h=console.error)==null||h.call(console,"You stopped the video.");break;case this.error.MEDIA_ERR_NETWORK:(d=console.error)==null||d.call(console,"Network error - please try again later.");break;case this.error.MEDIA_ERR_DECODE:(c=console.error)==null||c.call(console,"Video is broken..");break;case this.error.MEDIA_ERR_SRC_NOT_SUPPORTED:(g=console.error)==null||g.call(console,"Sorry, your browser can't play this video.");break}}),this._video.addEventListener("ended",l=>{var u;(u=console.log)==null||u.call(console,"Video Ended."),this.play()})}onPropertyChanged(t,e){return this.properties[t]=e,t=="url"&&e!=""&&this.loadVideo(e),!0}play(){this._video&&this._video.videoWidth&&this._video.play()}playPause(){this._video&&(this._video.paused?this.play():this.pause())}stop(){this._video&&(this._video.pause(),this._video.currentTime=0)}pause(){var t;this._video&&((t=console.log)==null||t.call(console,"Video paused"),this._video.pause())}onWidget(t,e){}}a(vt,"title","Video"),a(vt,"desc","Video playback"),a(vt,"widgets",[{name:"play",text:"PLAY",type:"minibutton"},{name:"stop",text:"STOP",type:"minibutton"},{name:"demo",text:"Demo video",type:"button"},{name:"mute",text:"Mute video",type:"button"}]),n.registerNodeType("graphics/video",vt);const gt=class Tt{constructor(){this.addOutput("Webcam","image"),this.properties={filterFacingMode:!1,facingMode:"user"},this.boxcolor="black",this.frame=0}openStream(){var t;if(!navigator.mediaDevices.getUserMedia){(t=console.log)==null||t.call(console,"getUserMedia() is not supported in your browser, use chrome and enable WebRTC from about://flags");return}this._waiting_confirmation=!0;var e={audio:!1,video:this.properties.filterFacingMode?{facingMode:this.properties.facingMode}:!0};navigator.mediaDevices.getUserMedia(e).then(this.streamReady.bind(this)).catch(r);var s=this;function r(o){var l;(l=console.log)==null||l.call(console,"Webcam rejected",o),s._webcam_stream=!1,Tt.is_webcam_open=!1,s.boxcolor="red",s.trigger("stream_error")}}closeStream(){if(this._webcam_stream){var t=this._webcam_stream.getTracks();if(t.length)for(var e=0;e<t.length;++e)t[e].stop();Tt.is_webcam_open=!1,this._webcam_stream=null,this._video=null,this.boxcolor="black",this.trigger("stream_closed")}}onPropertyChanged(t,e){t=="facingMode"&&(this.properties.facingMode=e,this.closeStream(),this.openStream())}onRemoved(){this.closeStream()}streamReady(t){this._webcam_stream=t,this.boxcolor="green";var e=this._video;e||(e=document.createElement("video"),e.autoplay=!0,e.srcObject=t,this._video=e,e.onloadedmetadata=function(s){var r;(r=console.log)==null||r.call(console,s),Tt.is_webcam_open=!0}),this.trigger("stream_ready",e)}onExecute(){if(this._webcam_stream==null&&!this._waiting_confirmation&&this.openStream(),!(!this._video||!this._video.videoWidth)){this._video.frame=++this.frame,this._video.width=this._video.videoWidth,this._video.height=this._video.videoHeight,this.setOutputData(0,this._video);for(var t=1;t<this.outputs.length;++t)if(this.outputs[t])switch(this.outputs[t].name){case"width":this.setOutputData(t,this._video.videoWidth);break;case"height":this.setOutputData(t,this._video.videoHeight);break}}}getExtraMenuOptions(){var t=this,e=t.properties.show?"Hide Frame":"Show Frame";return[{content:e,callback:function(){t.properties.show=!t.properties.show}}]}onDrawBackground(t){this.flags.collapsed||this.size[1]<=20||!this.properties.show||this._video&&(t.save(),t.drawImage(this._video,0,0,this.size[0],this.size[1]),t.restore())}onGetOutputs(){return[["width","number"],["height","number"],["stream_ready",n.EVENT],["stream_closed",n.EVENT],["stream_error",n.EVENT]]}};a(gt,"title","Webcam"),a(gt,"desc","Webcam image"),a(gt,"is_webcam_open",!1);let Pe=gt;n.registerNodeType("graphics/webcam",Pe);class Vt{constructor(){this.addInput("selector","string"),this.addOutput("result","htmlelement"),this.properties={}}onExecute(){var t=this.getInputData(0),e=null;if(t)try{e=document.querySelector(t)}catch{e=!1}this.setOutputData(0,e)}}a(Vt,"title","DOMSelector"),a(Vt,"desc","Execute a selection query on the document returning the corresponging DOM element"),n.registerNodeType("html/dom_selector",Vt);class Ht{constructor(){this.addInput("selector","string"),this.addOutput("result","array"),this.properties={}}onExecute(){var t=this.getInputData(0),e=null;t&&(e=document.querySelectorAll(t)),this.setOutputData(0,e)}}a(Ht,"title","DOMSelectorAll"),a(Ht,"desc","Execute a querySelectorAll() on the document returning the corresponding Elements"),n.registerNodeType("html/dom_selector_all",Ht);class Wt{constructor(){this.addInput("element","htmlelement"),this.addInput("add_listener",n.ACTION),this.addOutput("listener","htmlelement_listener"),this.addOutput("on_event",n.EVENT),this.addOutput("last_event",""),this.addOutput("current_event",""),this.addProperty("eventType",""),this.addWidget("combo","eventType",this.properties.eventType,"eventType",{values:["click","dblclick","mouseover","mousedown","mouseup","mousemove","mouseout","keydown","keyup","keypress","load","unload","mousewheel","contextmenu","focus","change","blur","pointerdown","pointerup","pointermove","pointerover","pointerout","pointerenter","pointerleave","pointercancel","gotpointercapture","lostpointercapture","touchstart","touchmove","touchend","touchcancel","submit","scroll","resize","hashchange"]}),this.mode=n.ON_ACTION}onExecute(t,e){this.mode==n.ON_TRIGGER?(action=this.id+"_"+(action||"action")+"_exectoact_"+Math.floor(Math.random()*9999),this.onAction(action,t,e)):this.setOutputData(3,null)}onAction(t){var e,s=this.getInputData(0),r=this.getInputOrProperty("eventType"),o=null;if(s&&r&&s.addEventListener)switch(t){default:var l;if(s.attributes["data-listener-"+r])l=s.attributes["data-listener-"+r];else{var u=this;l=function(h){u.setOutputData(2,h),u.setOutputData(3,h),u.triggerSlot(1)},s.addEventListener(r,l),s.attributes["data-listener-"+r]=l}o={element:s,function:l,event:r};break}else(e=console.log)==null||e.call(console,"no el to add event");this.setOutputData(0,o)}}a(Wt,"title","HTML Listener"),a(Wt,"desc","Add an event listener on an html element"),n.registerNodeType("html/event_listener",Wt);class Yt{constructor(){this.addInput("listener","htmlelement_listener"),this.addInput("remove_listener",n.ACTION),this.addOutput("result","boolean"),this.mode=n.ON_ACTION}onExecute(t,e){this.mode==n.ON_TRIGGER&&(action=this.id+"_"+(action||"action")+"_exectoact_"+Math.floor(Math.random()*9999),this.onAction(action,t,e))}onAction(){var t,e=this.getInputData(0),s=!1;e&&e.element&&e.function&&e.event&&e.element.removeEventListener?(e.element.attributes["data-listener-"+e.event]=!1,e.element.removeEventListener(e.event,e.function),s=!0):(t=console.log)==null||t.call(console,"bad element to remove listener"),this.setOutputData(0,s)}}a(Yt,"title","HTML Remove Listener"),a(Yt,"desc","Remove an event listener by passing his reference"),n.registerNodeType("html/event_listener_remove",Yt);class Kt{constructor(){this.addInput("element","htmlelement"),this.addOutput("result","string")}onExecute(){var t=this.getInputData(0),e=!1;t&&typeof t=="object"&&(typeof t.value!="undefined"?e=t.value:typeof t.checked!="undefined"?e=!!t.checked:typeof t.textContent!="undefined"?e=t.textContent:e=""),this.setOutputData(0,e)}}a(Kt,"title","HTML GET Value"),a(Kt,"desc","Get the value (or the text content) of an HTML element"),n.registerNodeType("html/element_value",Kt);class Jt{constructor(){this.addInput("element","htmlelement"),this.addInput("value","string"),this.addOutput("result","boolean"),this.addProperty("value","")}onExecute(){var t,e=this.getInputData(0),s=this.getInputOrProperty("value"),r=!1;e&&typeof e=="object"&&(typeof e.value!="undefined"?(e.value=s+"",r=!0):typeof e.checked!="undefined"?(e.checked=!!s,r=!0):typeof e.textContent!="undefined"?(e.textContent=s+"",r=!0):(t=console.log)==null||t.call(console,"unkonwn element to set value")),this.setOutputData(0,r)}}a(Jt,"title","HTML SET Value"),a(Jt,"desc","Set the value (or the text content) of an HTML element"),n.registerNodeType("html/element_value_set",Jt);class Qt{constructor(){this.addInput("create",n.ACTION),this.addInput("type","string"),this.addInput("id","string"),this.addInput("class","string"),this.addOutput("element","htmlelement"),this.addProperty("type",""),this.addProperty("id",""),this.addProperty("class",""),this.addWidget("combo","type",this.properties.type,"type",{values:["div","a","span","input","form","br","hr","table","th","tr","td","h1","h2","h3","h4","h5","h6"]}),this.mode=n.ON_ACTION}onExecute(t,e){this.mode==n.ON_TRIGGER&&(action=this.id+"_"+(action||"action")+"_exectoact_"+Math.floor(Math.random()*9999),this.onAction(action,t,e))}onAction(){var t=this.getInputOrProperty("type"),e=this.getInputOrProperty("id"),s=this.getInputOrProperty("class"),r=null;if(t){var o=document.createElement(t);o&&(e&&(o.id=e+""),s&&(o.className=s+""),r=o)}this.setOutputData(0,r)}}a(Qt,"title","HTML Create El"),a(Qt,"desc","Create an HTML element"),n.registerNodeType("html/create_element",Qt);class Xt{constructor(){this.addInput("parent","htmlelement"),this.addInput("child","htmlelement"),this.addInput("add",n.ACTION),this.addOutput("result",""),this.mode=n.ON_ACTION}onExecute(t,e){this.mode==n.ON_TRIGGER&&(action=this.id+"_"+(action||"action")+"_exectoact_"+Math.floor(Math.random()*9999),this.onAction(action,t,e))}onAction(){var t=this.getInputData(0),e=this.getInputData(1),s=null;t&&e&&t.appendChild&&(s=!!t.appendChild(e)),this.setOutputData(0,s)}}a(Xt,"title","HTML Append Child"),a(Xt,"desc","Append an HTML element to another"),n.registerNodeType("html/append_child",Xt);class Zt{constructor(){this.addInput("element","htmlelement"),this.addInput("remove",n.ACTION),this.addOutput("result",""),this.mode=n.ON_ACTION}onExecute(t,e){this.mode==n.ON_TRIGGER&&(action=this.id+"_"+(action||"action")+"_exectoact_"+Math.floor(Math.random()*9999),this.onAction(action,t,e))}onAction(){var t=this.getInputData(0),e=null;t&&t.remove&&(e=!!t.remove()),this.setOutputData(0,e)}}a(Zt,"title","HTML Remove element"),a(Zt,"desc","Remove an HTML element"),n.registerNodeType("html/remove_element",Zt);class _t{constructor(){this.addInput("element","htmlelement"),this.addInput("apply",n.ACTION),this.addProperty("cssProperty",""),this.addProperty("cssValue",""),this.addOutput("result",""),this.mode=n.ON_ACTION}onGetInputs(){var t=[];return t.push(["cssProperty","string",{nameLocked:!0,removable:!0}]),t.push(["cssValue","",{nameLocked:!0,removable:!0}]),t}onGetOutputs(){var t=[];return t.push(["some output"]),t}onExecute(t,e){this.mode==n.ON_TRIGGER&&(action=this.id+"_"+(action||"action")+"_exectoact_"+Math.floor(Math.random()*9999),this.onAction(action,t,e))}onAction(){var t,e,s=this.getInputData(0),r=null,o=this.getInputOrProperty("cssProperty"),l=this.getInputOrProperty("cssValue");s&&s.style?(r=s.style[o]=l,(t=console.log)==null||t.call(console,"applied",o,l,"to",s)):(e=console.log)==null||e.call(console,"no el to apply css"),this.setOutputData(0,r)}}a(_t,"title","HTML Css"),a(_t,"desc","HTML Element apply Css Style"),a(_t,"commonProperties",[{property:"box-decoration-break",values:null},{property:"hyphens",values:null},{property:"line-break",values:null},{property:"overflow-wrap",values:null},{property:"text-combine-upright",values:null},{property:"text-underline-position",values:null},{property:"@font-feature-values",values:null},{property:"font-feature-settings",values:null},{property:"font-kerning",values:null},{property:"font-language-override",values:null},{property:"font-synthesis",values:null},{property:"font-variant-alternates",values:null},{property:"font-variant-caps",values:null},{property:"font-variant-east-asian",values:null},{property:"font-variant-ligatures",values:null},{property:"font-variant-numeric",values:null},{property:"font-variant-position",values:null},{property:"text-orientation",values:null},{property:"text-combine-upright",values:null},{property:"writing-mode",values:null},{property:"ime-mode",values:null},{property:"break-after",values:null},{property:"break-before",values:null},{property:"break-inside",values:null},{property:"widows",values:null},{property:"orphans",values:null},{property:"marks",values:null},{property:"image-orientation",values:null},{property:"image-rendering",values:null},{property:"image-resolution",values:null},{property:"object-fit",values:null},{property:"object-position",values:null},{property:"mask",values:null},{property:"mask-type",values:null},{property:"mark",values:null},{property:"mark-after",values:null},{property:"mark-before",values:null},{property:"phonemes",values:null},{property:"rest",values:null},{property:"rest-after",values:null},{property:"rest-before",values:null},{property:"voice-balance",values:null},{property:"voice-duration",values:null},{property:"voice-pitch",values:null},{property:"voice-pitch-range",values:null},{property:"voice-rate",values:null},{property:"voice-stress",values:null},{property:"voice-volume",values:null},{property:"marquee-direction",values:null},{property:"marquee-play-count",values:null},{property:"marquee-speed",values:null},{property:"marquee-style",values:null},{property:"color",values:["color","initial","inherit"]},{property:"opacity",values:["number","initial","inherit"]},{property:"background-position",values:[`left top\r
      left center\r
      left bottom\r
      right top\r
      right center\r
      right bottom\r
      center top\r
      center center\r
      center bottom`,"x% y%","xpos ypos","initial","inherit"]},{property:"background-image",values:["url('URL')","none","initial","inherit"]},{property:"background-color",values:["color","transparent","initial","inherit"]},{property:"border",values:["border-width","border-style","border-color","initial","inherit"]},{property:"word-wrap",values:["normal","break-word","initial","inherit"]},{property:"direction",values:["ltr","rtl","initial","inherit"]},{property:"unicode-bidi",values:["normal","embed","bidi-override","initial","inherit"]},{property:"font-size",values:["medium","xx-small","x-small","small","large","x-large","xx-large","smaller","larger","length","%","initial","inherit"]},{property:"text-decoration-line",values:["none","underline","overline","line-through","initial","inherit"]},{property:"border-collapse",values:["separate","collapse","initial","inherit"]},{property:"background-size",values:["auto","length","percentage"," cover"," contain","initial","inherit"]},{property:"list-style-type",values:["disc","armenian","circle","cjk-ideographic","decimal","decimal-leading-zero","georgian","hebrew","hiragana","hiragana-iroha","katakana","katakana-iroha","lower-alpha","lower-greek","lower-latin","lower-roman","none","square","upper-alpha","upper-latin","upper-roman","initial","inherit"]},{property:"@keyframes",values:["animationname","keyframes-selector","css-styles"]},{property:"border-top-width",values:["medium","thin","thick","length","initial","inherit"]},{property:"background-blend-mode",values:["normal","multiply","screen","overlay","darken","lighten","color-dodge","saturation","color","luminosity"]},{property:"background-repeat",values:["repeat","repeat-x","repeat-y","no-repeat","initial","inherit"]},{property:"background-clip",values:["border-box","padding-box","content-box","initial","inherit"]},{property:"animation-direction",values:["normal","reverse","alternate","alternate-reverse","initial","inherit"]},{property:"animation-duration",values:["time","initial","inherit"]},{property:"counter-reset",values:["none","name","number","initial","inherit"]},{property:"padding-left",values:["length","%","initial","inherit"]},{property:"border-bottom-style",values:["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset","initial","inherit"]},{property:"list-style",values:["list-style-type","list-style-position","list-style-image","initial","inherit"]},{property:"counter-increment",values:["none","id number","initial","inherit"]},{property:"align-self",values:["auto","stretch","center","flex-start","flex-end","baseline","initial","inherit"]},{property:"min-height",values:["length","%","initial","inherit"]},{property:"visibility",values:["visible","hidden","collapse","initial","inherit"]},{property:"max-height",values:["none","length","%","initial","inherit"]},{property:"position",values:["static","absolute","fixed","relative","initial","inherit"]},{property:"border-left-width",values:["medium","thin","thick","length","initial","inherit"]},{property:"border-image-outset",values:["length"," number","initial","inherit"]},{property:"overflow-x",values:["visible","hidden","scroll","auto","initial","inherit"]},{property:"border-left-color",values:["color","transparent","initial","inherit"]},{property:"quotes",values:["none","string string string string","initial","inherit","",'"',"'","\u2039","\u203A","\xAB","\xBB","\u2018","\u2019","\u201C","\u201D","\u201E"]},{property:"perspective-origin",values:["x-axis","y-axis","initial","inherit"]},{property:"flex",values:["flex-grow","flex-shrink","flex-basis","auto","initial","none","inherit"]},{property:"border-image",values:[" border-image-source"," border-image-slice"," border-image-width"," border-image-outset"," border-image-repeat","initial","inherit"]},{property:"animation-delay",values:["time","initial","inherit"]},{property:"border-color",values:["color","transparent","initial","inherit"]},{property:"clear",values:["none","left","right","both","initial","inherit"]},{property:"border-width",values:["medium","thin","thick","length","initial","inherit"]},{property:`overflow\r
    `,values:["visible","hidden","scroll","auto","initial","inherit"]},{property:"column-rule-color",values:[" color","initial","inherit"]},{property:"border-right-width",values:["medium","thin","thick","length","initial","inherit"]},{property:"border-image-source",values:[" none"," image","initial","inherit"]},{property:"background-attachment",values:["scroll","fixed","local","initial","inherit"]},{property:"border-right",values:["border-right-width","border-right-style","border-right-color","initial","inherit"]},{property:"margin-right",values:["length","%","auto","initial","inherit"]},{property:"border-bottom",values:["border-bottom-width","border-bottom-style","border-bottom-color","initial","inherit"]},{property:"border-right-color",values:["color","transparent","initial","inherit"]},{property:"margin-top",values:["length","%","auto","initial","inherit"]},{property:"border-radius",values:["length","%","initial","inherit"]},{property:"max-width",values:["none","length","%","initial","inherit"]},{property:"min-width",values:["length","%","initial","inherit"]},{property:"z-index",values:["auto","number","initial","inherit"]},{property:"border-bottom-left-radius",values:["length","%","initial","inherit"]},{property:"text-transform",values:["none","capitalize","uppercase","lowercase","initial","inherit"]},{property:"text-indent",values:["length","%","initial","inherit"]},{property:"text-justify",values:["auto","inter-word","inter-ideograph","inter-cluster","distribute","kashida","trim","none","initial","inherit"]},{property:"text-align",values:["left","right","center","justify","initial","inherit"]},{property:"border-bottom-color",values:["color","transparent","initial","inherit"]},{property:"background",values:["background-color","background-image","background-position","background-size","background-repeat","background-origin","background-clip","background-attachment","initial","inherit"]},{property:"letter-spacing",values:["normal","length","initial","inherit"]},{property:"align-items",values:["stretch","center","flex-start","flex-end","baseline","initial","inherit"]},{property:"tab-size",values:["number","length","initial","inherit"]},{property:"flex-wrap",values:["nowrap","wrap","wrap-reverse","initial","inherit"]},{property:"flex-direction",values:["row","row-reverse","column","column-reverse","initial","inherit"]},{property:"flex-basis",values:["number","auto","initial","inherit"]},{property:"flex-shrink",values:["number","initial","inherit"]},{property:"bottom",values:["auto","length","%","initial","inherit"]},{property:"clip",values:["auto","shape","initial","inherit"]},{property:"flex-grow",values:["number","initial","inherit"]},{property:"font",values:["font-style","font-variant","font-weight","font-size/line-height","font-family","caption","icon","menu","message-box","small-caption","status-bar","initial","inherit"]},{property:"margin-left",values:["length","%","auto","initial","inherit"]},{property:"text-decoration-color",values:["color","initial","inherit"]},{property:"border-bottom-right-radius",values:["length","%","initial","inherit"]},{property:"list-style-position",values:["inside","outside","initial","inherit"]},{property:"top",values:["auto","length","%","initial","inherit"]},{property:"right",values:["auto","length","%","initial","inherit"]},{property:"background-origin",values:["padding-box","border-box","content-box","initial","inherit"]},{property:"table-layout",values:["auto","fixed","initial","inherit"]},{property:"margin-bottom",values:["length","%","auto","initial","inherit"]},{property:"padding-bottom",values:["length","%","initial","inherit"]},{property:"border-image-slice",values:[" number"," %"," fill","initial","inherit"]},{property:"flex-flow",values:["flex-direction","flex-wrap","initial","inherit"]},{property:"float",values:["none","left","right","initial","inherit"]},{property:"vertical-align",values:["baseline","length","%","sub","super","top","text-top","middle","bottom","text-bottom","initial","inherit"]},{property:"padding-right",values:["length","%","initial","inherit"]},{property:"width",values:["auto","length","%","initial","inherit"]},{property:"align-content",values:["stretch","center","flex-start","flex-end","space-between","space-around","initial","inherit"]},{property:"padding",values:["length","%","initial","inherit"]},{property:"hanging-punctuation",values:["none","first","last","allow-end","force-end","initial","inherit"]},{property:"border-bottom-width",values:["medium","thin","thick","length","initial","inherit"]},{property:"border-left-style",values:["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset","initial","inherit"]},{property:"text-align-last",values:["auto","left","right","center","justify","start","end","initial","inherit"]},{property:"order",values:["number","initial","inherit"]},{property:"border-top-style",values:["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset","initial","inherit"]},{property:"border-top-color",values:["color","transparent","initial","inherit"]},{property:"display",values:["inline","block","flex","inline-block","inline-flex","inline-table","list-item","run-in","table","table-caption",`\r
      table-column-group`,"table-header-group","table-footer-group","table-row-group","table-cell","table-column","table-row","none","initial","inherit"]},{property:"left",values:["auto","length","%","initial","inherit"]},{property:"border-top-left-radius",values:["length","%","initial","inherit"]},{property:"margin",values:["length","%","auto","initial","inherit"]},{property:"border-image-repeat",values:[" stretch"," repeat"," round","space","initial","inherit"]},{property:"box-shadow",values:["none","h-shadow","v-shadow","blur","spread","color","inset","initial","inherit"]},{property:"border-top-right-radius",values:["length","%","initial","inherit"]},{property:"text-decoration-style",values:["solid","double","dotted","dashed","wavy","initial","inherit"]},{property:"height",values:["auto","length","%","initial","inherit"]},{property:"border-right-style",values:["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset","initial","inherit"]},{property:"border-left",values:["border-left-width","border-left-style","border-left-color","initial","inherit"]},{property:"border-image-width",values:["length","number","%","auto","initial","inherit"]},{property:"font-family",values:[`family-name\r
      generic-family`,"initial","inherit"]},{property:"border-top",values:["border-top-width","border-top-style","border-top-color","initial","inherit"]},{property:"empty-cells",values:["show","hide","initial","inherit"]},{property:"justify-content",values:["flex-start","flex-end","center","space-between","space-around","initial","inherit"]},{property:"text-shadow",values:["h-shadow","v-shadow","blur-radius","color","none","initial","inherit"]},{property:"overflow-y",values:["visible","hidden","scroll","auto","initial","inherit"]},{property:"padding-top",values:["length","%","initial","inherit"]},{property:"border-style",values:["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset","initial","inherit"]},{property:"border-spacing",values:["length length","initial","inherit"]},{property:"word-break",values:["normal","break-all","keep-all ","initial","inherit"]},{property:"@font-face",values:["font-family","src","font-stretch","font-style","font-weight","unicode-range"]},{property:"text-decoration",values:["none","underline","overline","line-through","initial","inherit"]},{property:"white-space",values:["normal","nowrap","pre","pre-line","pre-wrap","initial","inherit"]},{property:"font-size-adjust",values:["number","none","initial","inherit"]},{property:"font-style",values:["normal","italic","oblique","initial","inherit"]},{property:"line-height",values:["normal","number","length","%","initial","inherit"]},{property:"font-weight",values:["normal","bold","bolder","lighter",`100\r
      200\r
      300\r
      400\r
      500\r
      600\r
      700\r
      800\r
      900`,"initial","inherit"]},{property:"word-spacing",values:["normal","length","initial","inherit"]},{property:"page-break-after",values:["auto","always","avoid","left","right","initial","inherit"]},{property:"outline-color",values:["invert","color","initial","inherit"]},{property:"column-gap",values:["length","normal","initial","inherit"]},{property:"column-rule",values:[" column-rule-width"," column-rule-style"," column-rule-color","initial","inherit"]},{property:"columns",values:["auto","column-width","column-count","initial","inherit"]},{property:"column-rule-style",values:[" none"," hidden"," dotted"," dashed"," solid"," double"," groove"," ridge"," inset"," outset","initial","inherit"]},{property:"font-variant",values:["normal","small-caps","initial","inherit"]},{property:"column-rule-width",values:[" medium"," thin"," thick"," length","initial","inherit"]},{property:"cursor",values:["alias","all-scroll","auto","cell","context-menu","col-resize","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","n-resize","ne-resize","nesw-resize","ns-resize","nw-resize","nwse-resize","no-drop","none","not-allowed","pointer","progress","row-resize","s-resize","se-resize","sw-resize","text","URL","vertical-text","w-resize","wait","zoom-in","zoom-out","initial","inherit"]},{property:"column-fill",values:["balance","auto","initial","inherit"]},{property:"animation-fill-mode",values:["none","forwards","backwards","both","initial","inherit"]},{property:"nav-left",values:["auto","id","target-name","initial","inherit"]},{property:"outline-width",values:["medium","thin","thick","length","initial","inherit"]},{property:"nav-right",values:["auto","id","target-name","initial","inherit"]},{property:"nav-up",values:["auto","id","target-name","initial","inherit"]},{property:"nav-down",values:["auto","id","target-name","initial","inherit"]},{property:"outline",values:["outline-color","outline-style","outline-width","initial","inherit"]},{property:"animation",values:["animation-name","animation-duration",`\r
	animation-timing-function`,"animation-delay",`\r
	animation-iteration-count`,"animation-direction","animation-fill-mode","animation-play-state","initial","inherit"]},{property:"nav-index",values:["auto","number","initial","inherit"]},{property:"font-stretch",values:["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded","initial","inherit"]},{property:"list-style-image",values:["none","url","initial","inherit"]},{property:"transition-duration",values:["time","initial","inherit"]},{property:"perspective",values:["length","none","initial","inherit"]},{property:"animation-play-state",values:["paused","running","initial","inherit"]},{property:"backface-visibility",values:["visible","hidden","initial","inherit"]},{property:"column-count",values:["number","auto","initial","inherit"]},{property:"transition-delay",values:["time","initial","inherit"]},{property:"transform",values:["none","matrix(n,n,n,n,n,n)",`matrix3d\r
	(n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n)`,"translate(x,y)","translate3d(x,y,z)","translateX(x)","translateY(y)","translateZ(z)","scale(x,y)","scale3d(x,y,z)","scaleX(x)","scaleY(y)","scaleZ(z)","rotate(angle)","rotate3d(x,y,z,angle)","rotateX(angle)","rotateY(angle)","rotateZ(angle)","skew(x-angle,y-angle)","skewX(angle)","skewY(angle)","perspective(n)","initial","inherit"]},{property:"resize",values:[" none"," both"," horizontal"," vertical","initial","inherit"]},{property:"text-overflow",values:["clip","ellipsis","string","initial","inherit"]},{property:"caption-side",values:["top","bottom","initial","inherit"]},{property:"filter",values:["none","blur(px)","brightness(%)","contrast(%)","drop-shadow(h-shadow v-shadow blur spread color)","grayscale(%)","hue-rotate(deg)","invert(%)","opacity(%)","saturate(%)","sepia(%)","url()","initial","inherit"]},{property:"content",values:["normal","none","counter","attr(attribute)","string","open-quote","close-quote","no-open-quote","no-close-quote","url(url)","initial","inherit"]},{property:"transition-timing-function",values:["ease","linear","ease-in","ease-out","ease-in-out","cubic-bezier(n,n,n,n)","initial","inherit"]},{property:"box-sizing",values:[" content-box"," border-box","initial","inherit"]},{property:"page-break-before",values:["auto","always","avoid","left","right","initial","inherit"]},{property:"animation-timing-function",values:["linear","ease","ease-in","ease-out","ease-in-out","cubic-bezier(n,n,n,n)","initial","inherit"]},{property:"outline-offset",values:[" length","initial","inherit"]},{property:"column-width",values:["auto","length","initial","inherit"]},{property:"outline-style",values:["none","hidden","dotted","dashed","solid","double","groove","ridge","inset","outset","initial","inherit"]},{property:"transform-origin",values:["x-axis","y-axis","z-axis","initial","inherit"]},{property:"transform-style",values:["flat","preserve-3d","initial","inherit"]},{property:"transition",values:["transition-property","transition-duration","transition-timing-function","transition-delay","initial","inherit"]},{property:"page-break-inside",values:["auto","avoid","initial","inherit"]},{property:"column-span",values:["1","all","initial","inherit"]},{property:"transition-property",values:["none","all","property","initial","inherit"]},{property:"animation-iteration-count",values:["number","infinite","initial","inherit"]},{property:"animation-name",values:["keyframename","none","initial","inherit"]}][{}]),n.registerNodeType("html/apply_element_css",_t);class $t{constructor(){this.addInput("search",n.ACTION),this.addProperty("name","","string"),this.addOutput("ready",n.EVENT),this.addOutput("results","array"),this.addOutput("first name","object"),this.addOutput("first object","object"),this.addWidget("string","name",this.properties.name,"name"),this._data=null,this._fetching=null,this.base_url="https://api.cdnjs.com/libraries"}search(){var t=this,e=this.base_url,s=this.getInputOrProperty("name");s&&s!==""&&(e+="?search="+s),this._fetching=fetch(e).then(r=>{if(!r.ok)this.boxcolor="#F00",t.trigger("error");else return this.boxcolor="#0F0",r.text()}).then(r=>{var o;if(t._data=r,t._fetching=null,this._data&&typeof this._data=="string")try{this._data=JSON.parse(this._data)}catch{(o=console.warn)==null||o.call(console,"Not a JSON resp",this._data)}this._data&&typeof this._data=="object"?this._data.results&&this._data.results.length&&this._data.results[0].name?(this.setOutputData(1,this._data.results),this.setOutputData(2,this._data.results[0].name),this.setOutputData(3,this._data.results[0])):(this.setOutputData(2,null),this.setOutputData(3,null)):(this.setOutputData(2,null),this.setOutputData(3,null)),t.trigger("ready")})}onAction(t){t=="search"&&this.search()}onExecute(){}onGetInputs(){return[["name","string"]]}onGetOutputs(){return[["error",n.EVENT]]}}a($t,"title","CDN Search"),a($t,"desc","Search and fetch CDN libraries"),n.registerNodeType("libraries/search_CDN_lib",$t);class te{constructor(){this.addInput("load",n.ACTION),this.addInput("lib_spec","object"),this.addOutput("ready",n.EVENT),this.addOutput("error",n.EVENT)}load(){var t=this,e=this.getInputOrProperty("lib_spec");if(e&&typeof e=="object"&&e.latest){var s=e.latest,r=document.createElement("script");r.type="text/javascript",r.onload=function(o){t.on_loaded(e,o)},r.onerror=function(o){t.on_error(e,o)},r.src=s,document.head.appendChild(r)}}on_loaded(t,e){var s;(s=console.debug)==null||s.call(console,"Loaded library",t,e),t&&t.name?(this.trigger("ready"),libraries_loaded[t.name]=t,this.boxcolor="#0F0"):this.on_error(t)}on_error(t,e){var s;this.trigger("error"),this.boxcolor="#F00",(s=console.warn)==null||s.call(console,"Lib loading failed",t,e)}onAction(t){t=="load"&&this.load()}onExecute(){}onGetInputs(){}onGetOutputs(){}}a(te,"title","CDN Load"),a(te,"desc","Load and include a CDN library"),n.registerNodeType("libraries/load",te);const ee=.0174532925,J=class At{constructor(){this.addInput("T","vec3"),this.addInput("R","vec3"),this.addInput("S","vec3"),this.addOutput("mat4","mat4"),this.properties={T:[0,0,0],R:[0,0,0],S:[1,1,1],R_in_degrees:!0},this._result=mat4.create(),this._must_update=!0}onPropertyChanged(t,e){this._must_update=!0}onExecute(){var t=this._result,e=At.temp_quat,s=At.temp_mat4,r=At.temp_vec3,o=this.getInputData(0),l=this.getInputData(1),u=this.getInputData(2);(this._must_update||o||l||u)&&(o=o||this.properties.T,l=l||this.properties.R,u=u||this.properties.S,mat4.identity(t),mat4.translate(t,t,o),this.properties.R_in_degrees?(r.set(l),vec3.scale(r,r,ee),quat.fromEuler(e,r)):quat.fromEuler(e,l),mat4.fromQuat(s,e),mat4.multiply(t,t,s),mat4.scale(t,t,u)),this.setOutputData(0,t)}};a(J,"title","mat4"),a(J,"temp_quat",new Float32Array([0,0,0,1])),a(J,"temp_mat4",new Float32Array(16)),a(J,"temp_vec3",new Float32Array(3));let Re=J;n.registerNodeType("math3d/mat4",Re);const R=class Te{constructor(){this.addInput("A","number,vec3"),this.addInput("B","number,vec3"),this.addOutput("=","number,vec3"),this.addProperty("OP","+","enum",{values:Te.values}),this._result=vec3.create()}getTitle(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"}onExecute(){var t,e=this.getInputData(0),s=this.getInputData(1);if(!(e==null||s==null)){e.constructor===Number&&(e=[e,e,e]),s.constructor===Number&&(s=[s,s,s]);var r=this._result;switch(this.properties.OP){case"+":r=vec3.add(r,e,s);break;case"-":r=vec3.sub(r,e,s);break;case"x":case"X":case"*":r=vec3.mul(r,e,s);break;case"/":r=vec3.div(r,e,s);break;case"%":r[0]=e[0]%s[0],r[1]=e[1]%s[1],r[2]=e[2]%s[2];break;case"^":r[0]=Math.pow(e[0],s[0]),r[1]=Math.pow(e[1],s[1]),r[2]=Math.pow(e[2],s[2]);break;case"max":r[0]=Math.max(e[0],s[0]),r[1]=Math.max(e[1],s[1]),r[2]=Math.max(e[2],s[2]);break;case"min":r[0]=Math.min(e[0],s[0]),r[1]=Math.min(e[1],s[1]),r[2]=Math.min(e[2],s[2]);break;case"dot":r=vec3.dot(e,s);break;case"cross":vec3.cross(r,e,s);break;default:(t=console.warn)==null||t.call(console,"Unknown operation: "+this.properties.OP)}this.setOutputData(0,r)}}onDrawBackground(t){this.flags.collapsed||(t.font="40px Arial",t.fillStyle="#666",t.textAlign="center",t.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+n.NODE_TITLE_HEIGHT)*.5),t.textAlign="left")}};a(R,"title","Operation"),a(R,"desc","Easy math 3D operators"),a(R,"values",["+","-","*","/","%","^","max","min","dot","cross"]),a(R,"@OP",{type:"enum",title:"operation",values:R.values}),a(R,"size",[100,60]);let Le=R;n.registerSearchboxExtra("math3d/operation","CROSS()",{properties:{OP:"cross"},title:"CROSS()"}),n.registerSearchboxExtra("math3d/operation","DOT()",{properties:{OP:"dot"},title:"DOT()"}),n.registerNodeType("math3d/operation",Le);class ie{constructor(){this.addInput("in","vec3"),this.addInput("f","number"),this.addOutput("out","vec3"),this.properties={f:1},this._data=new Float32Array(3)}onExecute(){var t=this.getInputData(0);if(t!=null){var e=this.getInputData(1);e==null&&(e=this.properties.f);var s=this._data;s[0]=t[0]*e,s[1]=t[1]*e,s[2]=t[2]*e,this.setOutputData(0,s)}}}a(ie,"title","vec3_scale"),a(ie,"desc","scales the components of a vec3"),n.registerNodeType("math3d/vec3-scale",ie);class se{constructor(){this.addInput("in","vec3"),this.addOutput("out","number")}onExecute(){var t=this.getInputData(0);if(t!=null){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.setOutputData(0,e)}}}a(se,"title","vec3_length"),a(se,"desc","returns the module of a vector"),n.registerNodeType("math3d/vec3-length",se);class re{constructor(){this.addInput("in","vec3"),this.addOutput("out","vec3"),this._data=new Float32Array(3)}onExecute(){var t=this.getInputData(0);if(t!=null){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),s=this._data;s[0]=t[0]/e,s[1]=t[1]/e,s[2]=t[2]/e,this.setOutputData(0,s)}}}a(re,"title","vec3_normalize"),a(re,"desc","returns the vector normalized"),n.registerNodeType("math3d/vec3-normalize",re);class oe{constructor(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addInput("f","vec3"),this.addOutput("out","vec3"),this.properties={f:.5},this._data=new Float32Array(3)}onExecute(){var t=this.getInputData(0);if(t!=null){var e=this.getInputData(1);if(e!=null){var s=this.getInputOrProperty("f"),r=this._data;r[0]=t[0]*(1-s)+e[0]*s,r[1]=t[1]*(1-s)+e[1]*s,r[2]=t[2]*(1-s)+e[2]*s,this.setOutputData(0,r)}}}}a(oe,"title","vec3_lerp"),a(oe,"desc","returns the interpolated vector"),n.registerNodeType("math3d/vec3-lerp",oe);class ae{constructor(){this.addInput("A","vec3"),this.addInput("B","vec3"),this.addOutput("out","number")}onExecute(){var t=this.getInputData(0);if(t!=null){var e=this.getInputData(1);if(e!=null){var s=t[0]*e[0]+t[1]*e[1]+t[2]*e[2];this.setOutputData(0,s)}}}}a(ae,"title","vec3_dot"),a(ae,"desc","returns the dot product"),n.registerNodeType("math3d/vec3-dot",ae);var Ie;if(glMatrix){class m{constructor(){this.addOutput("quat","quat"),this.properties={x:0,y:0,z:0,w:1,normalize:!1},this._value=quat.create()}onExecute(){this._value[0]=this.getInputOrProperty("x"),this._value[1]=this.getInputOrProperty("y"),this._value[2]=this.getInputOrProperty("z"),this._value[3]=this.getInputOrProperty("w"),this.properties.normalize&&quat.normalize(this._value,this._value),this.setOutputData(0,this._value)}onGetInputs(){return[["x","number"],["y","number"],["z","number"],["w","number"]]}}a(m,"title","Quaternion"),a(m,"desc","quaternion"),n.registerNodeType("math3d/quaternion",m);class t{constructor(){this.addInputs([["degrees","number"],["axis","vec3"]]),this.addOutput("quat","quat"),this.properties={angle:90,axis:vec3.fromValues(0,1,0)},this._value=quat.create()}onExecute(){var d=this.getInputData(0);d==null&&(d=this.properties.angle);var c=this.getInputData(1);c==null&&(c=this.properties.axis);var g=quat.setAxisAngle(this._value,c,d*.0174532925);this.setOutputData(0,g)}}a(t,"title","Rotation"),a(t,"desc","quaternion rotation"),n.registerNodeType("math3d/rotation",t);class e{constructor(){this.addInput("euler","vec3"),this.addOutput("quat","quat"),this.properties={euler:[0,0,0],use_yaw_pitch_roll:!1},this._degs=vec3.create(),this._value=quat.create()}onExecute(){var d=this.getInputData(0);d==null&&(d=this.properties.euler),vec3.scale(this._degs,d,ee),this.properties.use_yaw_pitch_roll&&(this._degs=[this._degs[2],this._degs[0],this._degs[1]]);var c=quat.fromEuler(this._value,this._degs);this.setOutputData(0,c)}}a(e,"title","Euler->Quat"),a(e,"desc","Converts euler angles (in degrees) to quaternion"),n.registerNodeType("math3d/euler_to_quat",e);class s{constructor(){this.addInput(["quat","quat"]),this.addOutput("euler","vec3"),this._value=vec3.create()}onExecute(){var d=this.getInputData(0);d&&(quat.toEuler(this._value,d),vec3.scale(this._value,this._value,ee),this.setOutputData(0,this._value))}}a(s,"title","Euler->Quat"),a(s,"desc","Converts rotX,rotY,rotZ in degrees to quat"),n.registerNodeType("math3d/quat_to_euler",s);class r{constructor(){this.addInputs([["vec3","vec3"],["quat","quat"]]),this.addOutput("result","vec3"),this.properties={vec:[0,0,1]}}onExecute(){var d=this.getInputData(0);d==null&&(d=this.properties.vec);var c=this.getInputData(1);c==null?this.setOutputData(d):this.setOutputData(0,vec3.transformQuat(vec3.create(),d,c))}}a(r,"title","Rot. Vec3"),a(r,"desc","rotate a point"),n.registerNodeType("math3d/rotate_vec3",r);class o{constructor(){this.addInputs([["A","quat"],["B","quat"]]),this.addOutput("A*B","quat"),this._value=quat.create()}onExecute(){var d=this.getInputData(0);if(d!=null){var c=this.getInputData(1);if(c!=null){var g=quat.multiply(this._value,d,c);this.setOutputData(0,g)}}}}a(o,"title","Mult. Quat"),a(o,"desc","rotate quaternion"),n.registerNodeType("math3d/mult-quat",o);class l{constructor(){this.addInputs([["A","quat"],["B","quat"],["factor","number"]]),this.addOutput("slerp","quat"),this.addProperty("factor",.5),this._value=quat.create()}onExecute(){var d=this.getInputData(0);if(d!=null){var c=this.getInputData(1);if(c!=null){var g=this.properties.factor;this.getInputData(2)!=null&&(g=this.getInputData(2));var p=quat.slerp(this._value,d,c,g);this.setOutputData(0,p)}}}}a(l,"title","Quat Slerp"),a(l,"desc","quaternion spherical interpolation"),n.registerNodeType("math3d/quat-slerp",l);class u{constructor(){this.addInput("vec3","vec3"),this.addOutput("remap","vec3"),this.addOutput("clamped","vec3"),this.properties={clamp:!0,range_min:[-1,-1,0],range_max:[1,1,0],target_min:[-1,-1,0],target_max:[1,1,0]},this._value=vec3.create(),this._clamped=vec3.create()}onExecute(){var d=this.getInputData(0);d&&this._value.set(d);for(var c=this.properties.range_min,g=this.properties.range_max,p=this.properties.target_min,y=this.properties.target_max,_=0;_<3;++_){var b=g[_]-c[_];if(this._clamped[_]=n.clamp(this._value[_],c[_],g[_]),b==0){this._value[_]=(p[_]+y[_])*.5;continue}var I=(this._value[_]-c[_])/b;this.properties.clamp&&(I=n.clamp(I,0,1));var x=y[_]-p[_];this._value[_]=p[_]+I*x}this.setOutputData(0,this._value),this.setOutputData(1,this._clamped)}}a(u,"title","Remap Range"),a(u,"desc","remap a 3D range"),n.registerNodeType("math3d/remap_range",u)}else n.debug&&((Ie=console.warn)==null||Ie.call(console,"No glmatrix found, some Math3D nodes may not work"));var M="#243";const H=class O{constructor(t){this.channel=0,this.cmd=0,this.data=new Uint32Array(3),t&&this.setup(t)}fromJSON(t){this.setup(t.data)}setup(t){var e=t;t.constructor===Object&&(e=t.data),this.data.set(e);var s=e[0];this.status=s;var r=s&240;s>=240?this.cmd=s:this.cmd=r,this.cmd==O.NOTEON&&this.velocity==0&&(this.cmd=O.NOTEOFF),this.cmd_str=O.commands[this.cmd]||"",(r>=O.NOTEON||r<=O.NOTEOFF)&&(this.channel=s&15)}get velocity(){return this.cmd==O.NOTEON?this.data[2]:-1}set velocity(t){this.data[2]=t}get note(){return this.cmd!=O.NOTEON?-1:O.toNoteString(this.data[1],!0)}set note(t){throw new Error("notes cannot be assigned this way, must modify the data[1]")}get octave(){if(this.cmd!=O.NOTEON)return-1;var t=this.data[1]-24;return Math.floor(t/12+1)}set octave(t){throw new Error("octave cannot be assigned this way, must modify the data[1]")}getPitch(){return Math.pow(2,(this.data[1]-69)/12)*440}static computePitch(t){return Math.pow(2,(t-69)/12)*440}getCC(){return this.data[1]}getCCValue(){return this.data[2]}getPitchBend(){return this.data[1]+(this.data[2]<<7)-8192}static computePitchBend(t,e){return t+(e<<7)-8192}setCommandFromString(t){this.cmd=O.computeCommandFromString(t)}static computeCommandFromString(t){if(!t)return 0;if(t&&t.constructor===Number)return t;switch(t=t.toUpperCase(),t){case"NOTE ON":case"NOTEON":return O.NOTEON;case"NOTE OFF":case"NOTEOFF":return O.NOTEON;case"KEY PRESSURE":case"KEYPRESSURE":return O.KEYPRESSURE;case"CONTROLLER CHANGE":case"CONTROLLERCHANGE":case"CC":return O.CONTROLLERCHANGE;case"PROGRAM CHANGE":case"PROGRAMCHANGE":case"PC":return O.PROGRAMCHANGE;case"CHANNEL PRESSURE":case"CHANNELPRESSURE":return O.CHANNELPRESSURE;case"PITCH BEND":case"PITCHBEND":return O.PITCHBEND;case"TIME TICK":case"TIMETICK":return O.TIMETICK;default:return Number(t)}}static toNoteString(t,e){t=Math.round(t);var s=t-21,r=Math.floor((t-24)/12+1);return s=s%12,s<0&&(s=12+s),O.notes[s]+(e?"":r)}static NoteStringToPitch(t){t=t.toUpperCase();var e=t[0],s=4;t[1]=="#"?(e+="#",t.length>2&&(s=Number(t[2]))):t.length>1&&(s=Number(t[1]));var r=O.note_to_index[e];return r==null?null:(s-1)*12+r+21}toString(){var t=""+this.channel+". ";switch(this.cmd){case O.NOTEON:t+="NOTEON "+O.toNoteString(this.data[1]);break;case O.NOTEOFF:t+="NOTEOFF "+O.toNoteString(this.data[1]);break;case O.CONTROLLERCHANGE:t+="CC "+this.data[1]+" "+this.data[2];break;case O.PROGRAMCHANGE:t+="PC "+this.data[1];break;case O.PITCHBEND:t+="PITCHBEND "+this.getPitchBend();break;case O.KEYPRESSURE:t+="KEYPRESS "+this.data[1];break}return t}toHexString(){return this.data.map(t=>t.toString(16)).join(" ")}toJSON(){return{data:[this.data[0],this.data[1],this.data[2]],object_class:"MIDIEvent"}}};a(H,"notes",["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"]),a(H,"note_to_index",{A:0,"A#":1,B:2,C:3,"C#":4,D:5,"D#":6,E:7,F:8,"F#":9,G:10,"G#":11}),a(H,"commands",{128:"note off",144:"note on",160:"key pressure",176:"controller change",192:"program change",208:"channel pressure",224:"pitch bend",240:"system",242:"Song pos",243:"Song select",246:"Tune request",248:"time tick",250:"Start Song",251:"Continue Song",252:"Stop Song",254:"Sensing",255:"Reset"}),a(H,"commands_short",{128:"NOTEOFF",144:"NOTEOFF",160:"KEYP",176:"CC",192:"PC",208:"CP",224:"PB",240:"SYS",242:"POS",243:"SELECT",246:"TUNEREQ",248:"TT",250:"START",251:"CONTINUE",252:"STOP",254:"SENS",255:"RESET"}),a(H,"commands_reversed",{});let v=H;v.NOTEOFF=128,v.NOTEON=144,v.KEYPRESSURE=160,v.CONTROLLERCHANGE=176,v.PROGRAMCHANGE=192,v.CHANNELPRESSURE=208,v.PITCHBEND=224,v.TIMETICK=248,n.MIDIEvent=v;for(var Oe in v.commands)v.commands_reversed[v.commands[Oe]]=Oe;const xe=class tt{constructor(t,e){var s;if(!navigator.requestMIDIAccess){this.error="not suppoorted",e?e("Not supported"):(s=console.error)==null||s.call(console,"MIDI NOT SUPPORTED, enable by chrome://flags");return}this.on_ready=t,this.state={note:[],cc:[]},this.input_ports=null,this.input_ports_info=[],this.output_ports=null,this.output_ports_info=[],navigator.requestMIDIAccess().then(this.onMIDISuccess.bind(this),this.onMIDIFailure.bind(this))}onMIDISuccess(t){var e,s;(e=console.log)==null||e.call(console,"MIDI ready!"),n.debug&&((s=console.log)==null||s.call(console,t)),this.midi=t,this.updatePorts(),this.on_ready&&this.on_ready(this)}updatePorts(){var t,e,s=this.midi;this.input_ports=s.inputs,this.input_ports_info=[],this.output_ports=s.outputs,this.output_ports_info=[];for(var r=0,o=this.input_ports.values(),l=o.next();l&&l.done===!1;){let u=l.value;this.input_ports_info.push(u),n.debug&&((t=console.log)==null||t.call(console,"Input port [type:'"+u.type+"'] id:'"+u.id+"' manufacturer:'"+u.manufacturer+"' name:'"+u.name+"' version:'"+u.version+"'")),r++,l=o.next()}for(this.num_input_ports=r,r=0,o=this.output_ports.values(),l=o.next();l&&l.done===!1;){let u=l.value;this.output_ports_info.push(u),n.debug&&((e=console.log)==null||e.call(console,"Output port [type:'"+u.type+"'] id:'"+u.id+"' manufacturer:'"+u.manufacturer+"' name:'"+u.name+"' version:'"+u.version+"'")),r++,l=o.next()}this.num_output_ports=r}onMIDIFailure(t){var e;(e=console.error)==null||e.call(console,"Failed to get MIDI access - "+t)}openInputPort(t,e){var s,r=this.input_ports.get("input-"+t);if(!r)return!1;tt.input=this;var o=this;return r.onmidimessage=function(l){var u=new v(l.data);o.updateState(u),e&&e(l.data,u),tt.on_message&&tt.on_message(l.data,u)},(s=console.log)==null||s.call(console,"port open: ",r),!0}updateState(t){switch(t.cmd){case v.NOTEON:this.state.note[t.value1|0]=t.value2;break;case v.NOTEOFF:this.state.note[t.value1|0]=0;break;case v.CONTROLLERCHANGE:this.state.cc[t.getCC()]=t.getCCValue();break}}sendMIDI(t,e){if(e){var s=this.output_ports_info[t];s&&(tt.output=this,e.constructor===v?s.send(e.data):s.send(e))}}};a(xe,"input",null);let L=xe;L.MIDIEvent=v;class Q{constructor(){this.addOutput("on_midi",n.EVENT),this.addOutput("out","midi"),this.properties={port:0},this._last_midi_event=null,this._current_midi_event=null,this.boxcolor="#AAA",this._last_time=0;var t=this;new L(function(e){t._midi=e,t._waiting&&t.onStart(),t._waiting=!1})}getPropertyInfo(t){if(this._midi&&t=="port"){for(var e={},s=0;s<this._midi.input_ports_info.length;++s){var r=this._midi.input_ports_info[s];e[s]=s+".- "+r.name+" version:"+r.version}return{type:"enum",values:e}}}onStart(){this._midi?this._midi.openInputPort(this.properties.port,this.onMIDIEvent.bind(this)):this._waiting=!0}onMIDIEvent(t,e){this._last_midi_event=e,this.boxcolor="#AFA",this._last_time=n.getTime(),this.trigger("on_midi",e),e.cmd==v.NOTEON?this.trigger("on_noteon",e):e.cmd==v.NOTEOFF?this.trigger("on_noteoff",e):e.cmd==v.CONTROLLERCHANGE?this.trigger("on_cc",e):e.cmd==v.PROGRAMCHANGE?this.trigger("on_pc",e):e.cmd==v.PITCHBEND&&this.trigger("on_pitchbend",e)}onDrawBackground(t){if(this.boxcolor="#AAA",!this.flags.collapsed&&this._last_midi_event){t.fillStyle="white";var e=n.getTime(),s=1-Math.max(0,(e-this._last_time)*.001);if(s>0){var r=t.globalAlpha;t.globalAlpha*=s,t.font="12px Tahoma",t.fillText(this._last_midi_event.toString(),2,this.size[1]*.5+3),t.globalAlpha=r}}}onExecute(){if(this.outputs)for(var t=this._last_midi_event,e=0;e<this.outputs.length;++e){var s=this.outputs[e],r=null;switch(s.name){case"midi":r=this._midi;break;case"last_midi":r=t;break;default:continue}this.setOutputData(e,r)}}onGetOutputs(){return[["last_midi","midi"],["on_midi",n.EVENT],["on_noteon",n.EVENT],["on_noteoff",n.EVENT],["on_cc",n.EVENT],["on_pc",n.EVENT],["on_pitchbend",n.EVENT]]}}a(Q,"title","MIDI Input"),a(Q,"desc","Reads MIDI from a input port"),a(Q,"color",M),Q.MIDIInterface=L,n.registerNodeType("midi/input",Q);const X=class Ae{constructor(){this.addInput("send",n.EVENT),this.properties={port:0};var t=this;new L(function(e){t._midi=e,t.widget.options.values=t.getMIDIOutputs()}),this.widget=this.addWidget("combo","Device",this.properties.port,{property:"port",values:this.getMIDIOutputs.bind(this)}),this.size=[340,60]}onGetPropertyInfo(t){if(this._midi&&t=="port"){var e=this.getMIDIOutputs();return{type:"enum",values:e}}}getMIDIOutputs(){var t={};if(!this._midi)return Ae.default_ports;if(this._midi.output_ports_info)for(var e=0;e<this._midi.output_ports_info.length;++e){var s=this._midi.output_ports_info[e];if(s){var r=e+".- "+s.name+" version:"+s.version;t[e]=r}}return t}onAction(t,e){this._midi&&(t=="send"&&this._midi.sendMIDI(this.properties.port,e),this.trigger("midi",e))}onGetInputs(){return[["send",n.ACTION]]}onGetOutputs(){return[["on_midi",n.EVENT]]}};a(X,"title","MIDI Output"),a(X,"desc","Sends MIDI to output channel"),a(X,"color",M),a(X,"default_ports",{0:"unknown"});let Ee=X;Ee.MIDIInterface=L,n.registerNodeType("midi/output",Ee);class yt{constructor(){this.addInput("on_midi",n.EVENT),this._str="",this.size=[200,40]}getTitle(){return this.flags.collapsed?this._str:this.title}onAction(t,e){e&&(e.constructor===v?this._str=e.toString():this._str="???")}onDrawForeground(t){!this._str||this.flags.collapsed||(t.font="30px Arial",t.fillText(this._str,10,this.size[1]*.8))}onGetInputs(){return[["in",n.ACTION]]}onGetOutputs(){return[["on_midi",n.EVENT]]}}a(yt,"title","MIDI Show"),a(yt,"desc","Shows MIDI in the graph"),a(yt,"color",M),n.registerNodeType("midi/show",yt);class Z{constructor(){this.properties={channel:-1,cmd:-1,min_value:-1,max_value:-1};var t=this;this._learning=!1,this.addWidget("button","Learn","",function(){t._learning=!0,t.boxcolor="#FA3"}),this.addInput("in",n.EVENT),this.addOutput("on_midi",n.EVENT),this.boxcolor="#AAA"}getTitle(){var t=null;return this.properties.cmd==-1?t="Nothing":t=v.commands_short[this.properties.cmd]||"Unknown",this.properties.min_value!=-1&&this.properties.max_value!=-1&&(t+=" "+(this.properties.min_value==this.properties.max_value?this.properties.max_value:this.properties.min_value+".."+this.properties.max_value)),"Filter: "+t}onPropertyChanged(t,e){if(t=="cmd"){var s=Number(e);isNaN(s)&&(s=v.commands[e]||0),this.properties.cmd=s}}onAction(t,e){if(!(!e||e.constructor!==v)){if(this._learning)this._learning=!1,this.boxcolor="#AAA",this.properties.channel=e.channel,this.properties.cmd=e.cmd,this.properties.min_value=this.properties.max_value=e.data[1];else if(this.properties.channel!=-1&&e.channel!=this.properties.channel||this.properties.cmd!=-1&&e.cmd!=this.properties.cmd||this.properties.min_value!=-1&&e.data[1]<this.properties.min_value||this.properties.max_value!=-1&&e.data[1]>this.properties.max_value)return;this.trigger("on_midi",e)}}}a(Z,"title","MIDI Filter"),a(Z,"desc","Filters MIDI messages"),a(Z,"color",M),a(Z,"@cmd",{type:"enum",title:"Command",values:v.commands_reversed}),n.registerNodeType("midi/filter",Z);class ft{constructor(){this.properties={channel:0,cmd:144,value1:1,value2:1},this.addInput("send",n.EVENT),this.addInput("assign",n.EVENT),this.addOutput("on_midi",n.EVENT),this.midi_event=new v,this.gate=!1}onAction(t,e){if(t=="assign"){this.properties.channel=e.channel,this.properties.cmd=e.cmd,this.properties.value1=e.data[1],this.properties.value2=e.data[2],e.cmd==v.NOTEON?this.gate=!0:e.cmd==v.NOTEOFF&&(this.gate=!1);return}e=this.midi_event,e.channel=this.properties.channel,this.properties.cmd&&this.properties.cmd.constructor===String?e.setCommandFromString(this.properties.cmd):e.cmd=this.properties.cmd,e.data[0]=e.cmd|e.channel,e.data[1]=Number(this.properties.value1),e.data[2]=Number(this.properties.value2),this.trigger("on_midi",e)}onExecute(){var t=this.properties;if(this.inputs)for(let r=0;r<this.inputs.length;++r){var e=this.inputs[r];if(e.link==-1)continue;let o;switch(e.name){case"note":o=this.getInputData(r),o!=null&&(o.constructor===String&&(o=v.NoteStringToPitch(o)),this.properties.value1=(o|0)%255);break;case"cmd":o=this.getInputData(r),o!=null&&(this.properties.cmd=o);break;case"value1":o=this.getInputData(r),o!=null&&(this.properties.value1=n.clamp(o|0,0,127));break;case"value2":o=this.getInputData(r),o!=null&&(this.properties.value2=n.clamp(o|0,0,127));break}}if(this.outputs)for(let r=0;r<this.outputs.length;++r){var s=this.outputs[r];let o=null;switch(s.name){case"midi":o=new v,o.setup([t.cmd,t.value1,t.value2]),o.channel=t.channel;break;case"command":o=t.cmd;break;case"cc":o=t.value1;break;case"cc_value":o=t.value2;break;case"note":o=t.cmd==v.NOTEON||t.cmd==v.NOTEOFF?t.value1:null;break;case"velocity":o=t.cmd==v.NOTEON?t.value2:null;break;case"pitch":o=t.cmd==v.NOTEON?v.computePitch(t.value1):null;break;case"pitchbend":o=t.cmd==v.PITCHBEND?v.computePitchBend(t.value1,t.value2):null;break;case"gate":o=this.gate;break;default:continue}o!==null&&this.setOutputData(r,o)}}onPropertyChanged(t,e){t=="cmd"&&(this.properties.cmd=v.computeCommandFromString(e))}onGetInputs(){return[["cmd","number"],["note","number"],["value1","number"],["value2","number"]]}onGetOutputs(){return[["midi","midi"],["on_midi",n.EVENT],["command","number"],["note","number"],["velocity","number"],["cc","number"],["cc_value","number"],["pitch","number"],["gate","bool"],["pitchbend","number"]]}}a(ft,"title","MIDIEvent"),a(ft,"desc","Create a MIDI Event"),a(ft,"color",M),n.registerNodeType("midi/event",ft);class bt{constructor(){this.properties={cc:1,value:0},this.addOutput("value","number")}onExecute(){L.input&&(this.properties.value=L.input.state.cc[this.properties.cc]),this.setOutputData(0,this.properties.value)}}a(bt,"title","MIDICC"),a(bt,"desc","gets a Controller Change"),a(bt,"color",M),n.registerNodeType("midi/cc",bt);const It=class Dt{constructor(){this.addInput("generate",n.ACTION),this.addInput("scale","string"),this.addInput("octave","number"),this.addOutput("note",n.EVENT),this.properties={notes:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#",octave:2,duration:.5,mode:"sequence"},this.notes_pitches=Dt.processScale(this.properties.notes),this.sequence_index=0}static processScale(t){for(var e=t.split(","),s=0;s<e.length;++s){var r=e[s];r.length==2&&r[1]!="#"||r.length>2?e[s]=-n.MIDIEvent.NoteStringToPitch(r):e[s]=v.note_to_index[r]||0}return e}onPropertyChanged(t,e){t=="notes"&&(this.notes_pitches=Dt.processScale(e))}onExecute(){var t=this.getInputData(2);t!=null&&(this.properties.octave=t);var e=this.getInputData(1);e&&(this.notes_pitches=Dt.processScale(e))}onAction(t,e){var s=0,r=this.notes_pitches.length,o=0;this.properties.mode=="sequence"?o=this.sequence_index=(this.sequence_index+1)%r:this.properties.mode=="random"&&(o=Math.floor(Math.random()*r));var l=this.notes_pitches[o];l>=0?s=l+(this.properties.octave-1)*12+33:s=-l,e=new v,e.setup([v.NOTEON,s,10]);var u=this.properties.duration||1;this.trigger("note",e),setTimeout(function(){var h=new v;h.setup([v.NOTEOFF,s,0]),this.trigger("note",h)}.bind(this),u*1e3)}};a(It,"title","MIDI Generator"),a(It,"desc","Generates a random MIDI note"),a(It,"color",M);let we=It;n.registerNodeType("midi/generator",we);class Ot{constructor(){this.properties={amount:0},this.addInput("in",n.ACTION),this.addInput("amount","number"),this.addOutput("out",n.EVENT),this.midi_event=new v}onAction(t,e){!e||e.constructor!==v||(e.data[0]==v.NOTEON||e.data[0]==v.NOTEOFF?(this.midi_event=new v,this.midi_event.setup(e.data),this.midi_event.data[1]=Math.round(this.midi_event.data[1]+this.properties.amount),this.trigger("out",this.midi_event)):this.trigger("out",e))}onExecute(){var t=this.getInputData(1);t!=null&&(this.properties.amount=t)}}a(Ot,"title","MIDI Transpose"),a(Ot,"desc","Transpose a MIDI note"),a(Ot,"color",M),n.registerNodeType("midi/transpose",Ot);class xt{constructor(){this.properties={scale:"A,A#,B,C,C#,D,D#,E,F,F#,G,G#"},this.addInput("note",n.ACTION),this.addInput("scale","string"),this.addOutput("out",n.EVENT),this.valid_notes=new Array(12),this.offset_notes=new Array(12),this.processScale(this.properties.scale)}onPropertyChanged(t,e){t=="scale"&&this.processScale(e)}processScale(t){this._current_scale=t,this.notes_pitches=we.processScale(t);for(let s=0;s<12;++s)this.valid_notes[s]=this.notes_pitches.indexOf(s)!=-1;for(let s=0;s<12;++s){if(this.valid_notes[s]){this.offset_notes[s]=0;continue}for(var e=1;e<12;++e){if(this.valid_notes[(s-e)%12]){this.offset_notes[s]=-e;break}if(this.valid_notes[(s+e)%12]){this.offset_notes[s]=e;break}}}}onAction(t,e){if(!(!e||e.constructor!==v))if(e.data[0]==v.NOTEON||e.data[0]==v.NOTEOFF){this.midi_event=new v,this.midi_event.setup(e.data);var s=e.note,r=v.note_to_index[s],o=this.offset_notes[r];this.midi_event.data[1]+=o,this.trigger("out",this.midi_event)}else this.trigger("out",e)}onExecute(){var t=this.getInputData(1);t!=null&&t!=this._current_scale&&this.processScale(t)}}a(xt,"title","MIDI Quantize Pitch"),a(xt,"desc","Transpose a MIDI note tp fit an scale"),a(xt,"color",M),n.registerNodeType("midi/quantize",xt);class Et{constructor(){var t;this.properties={url:"",autoplay:!0},this.addInput("play",n.ACTION),this.addInput("pause",n.ACTION),this.addOutput("note",n.EVENT),this._midi=null,this._current_time=0,this._playing=!1,typeof MidiParser=="undefined"&&((t=console.error)==null||t.call(console,"midi-parser.js not included, LGMidiPlay requires that library: https://raw.githubusercontent.com/colxi/midi-parser-js/master/src/main.js"),this.boxcolor="red")}onAction(t){t=="play"?this.play():t=="pause"&&(this._playing=!this._playing)}onPropertyChanged(t,e){t=="url"&&this.loadMIDIFile(e)}onExecute(){if(this._midi&&this._playing){this._current_time+=this.graph.elapsed_time;for(var t=this._current_time*100,e=0;e<this._midi.tracks;++e){var s=this._midi.track[e];s._last_pos||(s._last_pos=0,s._time=0);var r=s.event[s._last_pos];if(r&&s._time+r.deltaTime<=t&&(s._last_pos++,s._time+=r.deltaTime,r.data)){var o=r.type<<4+r.channel,l=new v;l.setup([o,r.data[0],r.data[1]]),this.trigger("note",l)}}}}play(){if(this._playing=!0,this._current_time=0,!!this._midi)for(var t=0;t<this._midi.tracks;++t){var e=this._midi.track[t];e._last_pos=0,e._time=0}}loadMIDIFile(t){n.fetchFile(t,"arraybuffer",e=>{this.boxcolor="#AFA",this._midi=MidiParser.parse(new Uint8Array(e)),this.properties.autoplay&&this.play()},()=>{this.boxcolor="#FAA",this._midi=null})}onDropFile(t){this.properties.url="",this.loadMIDIFile(t)}}a(Et,"title","MIDI fromFile"),a(Et,"desc","Plays a MIDI file"),a(Et,"color",M),n.registerNodeType("midi/fromFile",Et);class wt{constructor(){var t;if(this.properties={volume:.5,duration:1},this.addInput("note",n.ACTION),this.addInput("volume","number"),this.addInput("duration","number"),this.addOutput("note",n.EVENT),typeof AudioSynth=="undefined")(t=console.error)==null||t.call(console,"Audiosynth.js not included, LGMidiPlay requires that library"),this.boxcolor="red";else{var e=this.synth=new AudioSynth;this.instrument=e.createInstrument("piano")}}onAction(t,e){if(!(!e||e.constructor!==v)){if(this.instrument&&e.data[0]==v.NOTEON){var s=e.note;if(!s||s=="undefined"||s.constructor!==String)return;this.instrument.play(s,e.octave,this.properties.duration,this.properties.volume)}this.trigger("note",e)}}onExecute(){var t=this.getInputData(1);t!=null&&(this.properties.volume=t);var e=this.getInputData(2);e!=null&&(this.properties.duration=e)}}a(wt,"title","MIDI Play"),a(wt,"desc","Plays a MIDI note"),a(wt,"color",M),n.registerNodeType("midi/play",wt);const $=class he{constructor(){this.properties={num_octaves:2,start_octave:2},this.addInput("note",n.ACTION),this.addInput("reset",n.ACTION),this.addOutput("note",n.EVENT),this.size=[400,100],this.keys=[],this._last_key=-1}onDrawForeground(t){if(!this.flags.collapsed){var e=this.properties.num_octaves*12;this.keys.length=e;var s=this.size[0]/(this.properties.num_octaves*7),r=this.size[1];t.globalAlpha=1;for(var o=0;o<2;o++)for(var l=0;l<e;++l){var u=he.keys[l%12];if(u.t==o){var h=Math.floor(l/12),d=h*7*s+u.x*s;o==0?t.fillStyle=this.keys[l]?"#CCC":"white":t.fillStyle=this.keys[l]?"#333":"black",t.fillRect(d+1,0,s*u.w-2,r*u.h)}}}}getKeyIndex(t){for(var e=this.size[0]/(this.properties.num_octaves*7),s=this.size[1],r=1;r>=0;r--)for(var o=0;o<this.keys.length;++o){var l=he.keys[o%12];if(l.t==r){var u=Math.floor(o/12),h=u*7*e+l.x*e,d=e*l.w,c=s*l.h;if(!(t[0]<h||t[0]>h+d||t[1]>c))return o}}return-1}onAction(t,e){if(t=="reset"){for(var s=0;s<this.keys.length;++s)this.keys[s]=!1;return}if(!(!e||e.constructor!==v)){var r=e,o=(this.properties.start_octave-1)*12+29,l=r.data[1]-o;l>=0&&l<this.keys.length&&(r.data[0]==v.NOTEON?this.keys[l]=!0:r.data[0]==v.NOTEOFF&&(this.keys[l]=!1)),this.trigger("note",r)}}onMouseDown(t,e){if(!(e[1]<0)){var s=this.getKeyIndex(e);this.keys[s]=!0,this._last_key=s;var r=(this.properties.start_octave-1)*12+29+s,o=new v;return o.setup([v.NOTEON,r,100]),this.trigger("note",o),!0}}onMouseMove(t,e){if(!(e[1]<0||this._last_key==-1)){this.setDirtyCanvas(!0);var s=this.getKeyIndex(e);if(this._last_key==s)return!0;this.keys[this._last_key]=!1;var r=(this.properties.start_octave-1)*12+29+this._last_key,o=new v;return o.setup([v.NOTEOFF,r,100]),this.trigger("note",o),this.keys[s]=!0,r=(this.properties.start_octave-1)*12+29+s,o=new v,o.setup([v.NOTEON,r,100]),this.trigger("note",o),this._last_key=s,!0}}onMouseUp(t,e){if(!(e[1]<0)){var s=this.getKeyIndex(e);this.keys[s]=!1,this._last_key=-1;var r=(this.properties.start_octave-1)*12+29+s,o=new v;return o.setup([v.NOTEOFF,r,100]),this.trigger("note",o),!0}}};a($,"title","MIDI Keys"),a($,"desc","Keyboard to play notes"),a($,"color",M),a($,"keys",[{x:0,w:1,h:1,t:0},{x:.75,w:.5,h:.6,t:1},{x:1,w:1,h:1,t:0},{x:1.75,w:.5,h:.6,t:1},{x:2,w:1,h:1,t:0},{x:2.75,w:.5,h:.6,t:1},{x:3,w:1,h:1,t:0},{x:4,w:1,h:1,t:0},{x:4.75,w:.5,h:.6,t:1},{x:5,w:1,h:1,t:0},{x:5.75,w:.5,h:.6,t:1},{x:6,w:1,h:1,t:0}]);let Fe=$;n.registerNodeType("midi/keys",Fe);class ne{constructor(){this.addInput("obj","object"),this.addOutput("properties","array"),this._value=null,this._properties=[]}onExecute(){var t,e=this.getInputData(0);if(e!=null){this._value=e;try{this._properties=Object.keys(this._value)}catch(s){(t=console.error)==null||t.call(console,s)}this.setOutputData(0,this._properties)}}onAction(){}onGetInputs(){}onGetOutputs(){}getTitle(){return this.title}onPropertyChanged(){}}a(ne,"title","OBJ props"),a(ne,"desc","Properties for objects"),n.registerNodeType("objects/properties",ne);class le{constructor(){this.addInput("obj","object"),this.addOutput("value","*"),this.addProperty("prop",0),this.widg_prop=this.addWidget("combo","prop.",this.properties.prop,{property:"prop",values:[]}),this._obin=null,this._value=null,this._properties=[],this._properties_signature=""}setValue(t){this.properties.prop=t,this.widg_prop.value=t}updateFromInput(){var t,e=this.getInputData(0);if(e!=null)if(this._obin=e,this._obin){try{const s=Object.keys(this._obin).sort(),r=s.join("|");r!==this._properties_signature&&(this._properties=s,this._properties_signature=r,this.widgets=[],this.widg_prop=this.addWidget("combo","prop",this.properties.prop,{property:"prop",values:this._properties}))}catch(s){(t=console.error)==null||t.call(console,s)}typeof this._obin[this.properties.prop]!="undefined"?this._value=this._obin[this.properties.prop]:this._value=null}else this._value=null,this._properties=[];this.widg_prop.options||(this.widg_prop.options={}),this.widg_prop.options.values=this._properties,this.setOutputData(0,this._value)}onExecute(){this.updateFromInput()}onAction(){this.updateFromInput()}onGetInputs(){}onGetOutputs(){}getTitle(){return this.flags.collapsed?this.properties.prop:this.title}onPropertyChanged(t,e){t=="value"&&(this.widg_prop.value=e)}getExtraMenuOptions(){return[{content:"Console DBG",callback:function(t,e,s,r,o){var l,u;(l=console.debug)==null||l.call(console,o.widg_prop),(u=console.debug)==null||u.call(console,o)}}]}}a(le,"title","Obj Prop widget"),a(le,"desc","Choose a property for an object"),n.registerNodeType("objects/property_widget",le);class ue{constructor(){this.addInput("obj","object"),this.addInput("refresh",n.ACTION),this.addInput("execute",n.ACTION),this.addOutput("executed",n.EVENT),this.addOutput("method","function"),this.addOutput("return","*"),this.addProperty("method",null),this.widg_prop=this.addWidget("combo","method",this.properties.method,{property:"method",values:[]}),this._obin=null,this._function=null,this._methods=[],this._methods_signature=""}setValue(t){this.properties.method=t,this.widg_prop.value=t}updateFromInput(){var t,e,s=this.getInputData(0);if(s!=null)if(this._obin=s,this._obin)try{var r=Object.keys(this._obin);const l=[];for(var o in r)typeof this._obin[r[o]]=="function"&&l.push(r[o]);l.sort();const u=l.join("|");u!==this._methods_signature&&(this._methods=l,this._methods_signature=u,this.widgets=[],this.widg_prop=this.addWidget("combo","method",this.properties.method,{property:"method",values:this._methods}))}catch(l){(t=console.warn)==null||t.call(console,"Err on methods get",l)}else(e=console.debug)==null||e.call(console,"Invalid obj",s),this._function=null,this._methods=[];this.widg_prop.options||(this.widg_prop.options={}),this.widg_prop.options.values=this._methods,this.updateInputsForMethod()}updateInputsForMethod(){var t,e=this.widg_prop.value;if(this.properties.method=e,e&&this._obin&&typeof this._obin[e]!="undefined"){this._function=this._obin[e];for(var s=n.getParameterNames(this._function),r=0;r<s.length;++r){var o=this.findInputSlot(s[r]);o==-1&&this.addInput(s[r],"",{auto:!0,removable:!1,nameLocked:!0})}this._params=s}else(t=console.debug)==null||t.call(console,"Invalid method",e),this._function=null;this.setOutputData(1,this._function)}onExecute(){}onWidgetChanged(t,e,s){var r;if((r=console.debug)==null||r.call(console,"Widget changed",t,e,s),this.properties.method!==e)for(var o=3;o<this.inputs.length;++o)this.removeInput(o);this.updateInputsForMethod()}onAction(t){var e;if(t=="refresh")this.updateFromInput();else if(t=="execute")if(this._function&&typeof this._function=="function"){for(var s=[],r=3;r<this.inputs.length;r++)s.push(this.getInputData(r));(e=console.debug)==null||e.call(console,"NodeObjMethod Execute",s);var o=this._function(s);this.triggerSlot(0),this.setOutputData(2,o)}else this.setOutputData(1,null),this.setOutputData(2,null)}onGetInputs(){}onGetOutputs(){}getTitle(){return this.flags.collapsed?this.properties.method:this.title}onPropertyChanged(t,e){t=="value"&&(this.widg_prop.value=e)}getExtraMenuOptions(){return[{content:"NodeObjMethod DBG",callback:function(t,e,s,r,o){var l;(l=console.debug)==null||l.call(console,NodeObjMethod,o.widg_prop,o)}}]}}a(ue,"title","Obj Method widget"),a(ue,"desc","Choose and execute a method from an object"),n.registerNodeType("objects/method_widget",ue);class Nt{constructor(){this.size=[60,30],this.addProperty("obj_eval","window"),this.addOutput("obj","object"),this._func=null,this.data={}}onConfigure(t){var e;t.properties.obj_eval&&n.allow_scripts?this.compileCode(t.properties.obj_eval):(e=console.warn)==null||e.call(console,"Obj string not evaluated, LiteGraph.allow_scripts is false")}onPropertyChanged(t,e){var s;t=="obj_eval"&&n.allow_scripts?this.compileCode(e):(s=console.warn)==null||s.call(console,"Obj string not evaluated, LiteGraph.allow_scripts is false")}compileCode(t){var e,s,r;if(this._func=null,t.length>256)(e=console.warn)==null||e.call(console,"Script too long, max 256 chars");else{var o="return "+t;try{this._func=new Function("DATA","node",o)}catch(l){(s=console.error)==null||s.call(console,"Error parsing obj evaluation"),(r=console.error)==null||r.call(console,l)}}}onExecute(){var t,e;if(this._func)try{this.setOutputData(0,this._func(this.data,this))}catch(s){(t=console.error)==null||t.call(console,"Error in code eval"),(e=console.error)==null||e.call(console,s)}}}a(Nt,"title","Eval Obj"),a(Nt,"desc","Evaluate an object"),a(Nt,"widgets_info",{obj_eval:{type:"code"}}),n.registerNodeType("objects/evaluate",Nt),typeof n.slot_types_default_in=="undefined"&&(n.slot_types_default_in={}),n.slot_types_default_in._event_="widget/button",n.slot_types_default_in.array="basic/array",n.slot_types_default_in.boolean="basic/boolean",n.slot_types_default_in.number="widget/number",n.slot_types_default_in.object="basic/data",n.slot_types_default_in.string=["basic/string","string/concatenate"],n.slot_types_default_in.vec2="math3d/xy-to-vec2",n.slot_types_default_in.vec3="math3d/xyz-to-vec3",n.slot_types_default_in.vec4="math3d/xyzw-to-vec4",n.slot_types_default_in.audio=["audio/source","audio/media_source"],n.slot_types_default_in.canvas="graphics/canvas",n.slot_types_default_in.geometry=["geometry/polygon","geometry/eval"],n.slot_types_default_in.image=["graphics/image","graphics/video","graphics/webcam"],n.slot_types_default_in.mat4="math3d/mat4",n.slot_types_default_in.quat=["math3d/quaternion","math3d/rotation"],n.slot_types_default_in.table="string/toTable",typeof n.slot_types_default_out=="undefined"&&(n.slot_types_default_out={}),n.slot_types_default_out._event_=["logic/IF","events/sequence","events/log","events/counter"],n.slot_types_default_out.array=["basic/watch","basic/set_array","basic/array[]"],n.slot_types_default_out.boolean=["logic/IF","basic/watch","math/branch","math/gate"],n.slot_types_default_out.number=["basic/watch",{node:"math/operation",properties:{OP:"*"},title:"A*B"},{node:"math/operation",properties:{OP:"/"},title:"A/B"},{node:"math/operation",properties:{OP:"+"},title:"A+B"},{node:"math/operation",properties:{OP:"-"},title:"A-B"},{node:"math/compare",outputs:[["A==B","boolean"]],title:"A==B"},{node:"math/compare",outputs:[["A>B","boolean"]],title:"A>B"},{node:"math/compare",outputs:[["A<B","boolean"]],title:"A<B"}],n.slot_types_default_out.object=["objects/property_widget","objects/method_widget","objects/properties","basic/object_property","basic/keys","string/toString","basic/watch"],n.slot_types_default_out.string=["basic/watch","string/compare","string/concatenate","string/contains"],n.slot_types_default_out.vec2="math3d/vec2-to-xy",n.slot_types_default_out.vec3="math3d/vec3-to-xyz",n.slot_types_default_out.vec4="math3d/vec4-to-xyzw",n.slot_types_default_out.audio=["audio/destination","audio/mixer","audio/analyser"],n.slot_types_default_out.canvas=["graphics/frame","graphics/drawImage"],n.slot_types_default_out.geometry=["geometry/points_to_instances","geometry/extrude","geometry/eval","geometry/connectPoints","geometry/transform"],n.slot_types_default_out.image=["graphics/frame","graphics/drawImage"],n.slot_types_default_out.quat=["math3d/rotate_vec3","math3d/rotation"],n.slot_types_default_out.table="string/toTable";
