var xu=Object.defineProperty,mu=$h=>{throw TypeError($h)},Au=($h,Lh,Sh)=>Lh in $h?xu($h,Lh,{enumerable:!0,configurable:!0,writable:!0,value:Sh}):$h[Lh]=Sh,Kl=($h,Lh,Sh)=>Au($h,typeof Lh!="symbol"?Lh+"":Lh,Sh),Pu=($h,Lh,Sh)=>Lh.has($h)||mu("Cannot "+Sh),$u=($h,Lh,Sh)=>Lh.has($h)?mu("Cannot add the same private member more than once"):Lh instanceof WeakSet?Lh.add($h):Lh.set($h,Sh),Th=($h,Lh,Sh)=>(Pu($h,Lh,"access private method"),Sh),t;(function($h){$h[$h.No=0]="No",$h[$h.Yes=1]="Yes",$h[$h.NoAndSkip=2]="NoAndSkip",$h[$h.YesAndSkip=3]="YesAndSkip"})(t||(t={}));const e$1={};function s($h){return $h===void 0}function r($h){return $h==null}function i($h){return typeof $h=="string"}const{isFinite:n}=Number;function o($h){return typeof $h=="number"}const a=/^-?\d+(?:\.\d+)?$/;function h($h){return typeof $h=="string"&&a.test($h)?+$h:$h}const{isArray:l}=Array;function d($h){return $h&&typeof $h=="object"}function c($h){return d($h)&&!l($h)}function u($h){return JSON.stringify($h)==="{}"}const _={default:($h,Lh)=>(p(Lh,$h),p($h,Lh),$h),assign($h,Lh,Sh){let Eh;Object.keys(Lh).forEach(Gh=>{var Ah,Ph;if(Eh=Lh[Gh],(Eh==null?void 0:Eh.constructor)===Object&&((Ah=$h[Gh])===null||Ah===void 0?void 0:Ah.constructor)===Object)return p($h[Gh],Lh[Gh],Sh&&Sh[Gh]);Sh&&Gh in Sh?((Ph=Sh[Gh])===null||Ph===void 0?void 0:Ph.constructor)===Object&&p($h[Gh]={},Lh[Gh],Sh[Gh]):$h[Gh]=Lh[Gh]})},copyAttrs:($h,Lh,Sh)=>(Sh.forEach(Eh=>{s(Lh[Eh])||($h[Eh]=Lh[Eh])}),$h),clone:$h=>JSON.parse(JSON.stringify($h)),toMap($h){const Lh={};for(let Sh=0,Eh=$h.length;Sh<Eh;Sh++)Lh[$h[Sh]]=!0;return Lh},stintSet($h,Lh,Sh){Sh||(Sh=void 0),$h[Lh]!==Sh&&($h[Lh]=Sh)}},{assign:p}=_;class f{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:Lh}=this;return Lh&&Lh.length===6&&Lh[0]===1}get __usePathBox(){return this.__pathInputed}get __blendMode(){if(this.eraser&&this.eraser!=="path")return"destination-out";const{blendMode:Lh}=this;return Lh==="pass-through"?null:Lh}constructor(Lh){this.__leaf=Lh}__get(Lh){if(this.__input){const Sh=this.__input[Lh];if(!s(Sh))return Sh}return this[Lh]}__getData(){const Lh={tag:this.__leaf.tag},{__input:Sh}=this;let Eh;for(let Gh in this)Gh[0]!=="_"&&(Eh=Sh?Sh[Gh]:void 0,Lh[Gh]=s(Eh)?this[Gh]:Eh);return Lh}__setInput(Lh,Sh){this.__input||(this.__input={}),this.__input[Lh]=Sh}__getInput(Lh){if(this.__input){const Sh=this.__input[Lh];if(!s(Sh))return Sh}if(Lh!=="path"||this.__pathInputed)return this["_"+Lh]}__removeInput(Lh){this.__input&&!s(this.__input[Lh])&&(this.__input[Lh]=void 0)}__getInputData(Lh,Sh){const Eh={};if(Lh)if(l(Lh))for(let Gh of Lh)Eh[Gh]=this.__getInput(Gh);else for(let Gh in Lh)Eh[Gh]=this.__getInput(Gh);else{let Gh,Ah,{__input:Ph}=this;Eh.tag=this.__leaf.tag;for(let Nh in this)if(Nh[0]!=="_"&&(Gh=this["_"+Nh],!s(Gh))){if(Nh==="path"&&!this.__pathInputed)continue;Ah=Ph?Ph[Nh]:void 0,Eh[Nh]=s(Ah)?Gh:Ah}}if(Sh&&Sh.matrix){const{a:Gh,b:Ah,c:Ph,d:Nh,e:Mh,f:Dh}=this.__leaf.__localMatrix;Eh.matrix={a:Gh,b:Ah,c:Ph,d:Nh,e:Mh,f:Dh}}return Eh}__setMiddle(Lh,Sh){this.__middle||(this.__middle={}),this.__middle[Lh]=Sh}__getMiddle(Lh){return this.__middle&&this.__middle[Lh]}__checkSingle(){const Lh=this;if(Lh.blendMode==="pass-through"){const Sh=this.__leaf;Lh.opacity<1&&(Sh.isBranch||Lh.__hasMultiPaint)||Sh.__hasEraser||Lh.eraser||Lh.filter?Lh.__single=!0:Lh.__single&&(Lh.__single=!1)}else Lh.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}const g={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create($h){const{types:Lh}=y;return Lh[$h]?Lh[$h]++:(Lh[$h]=1,0)}},y=g;let m,x,w;const{max:b}=Math,B=[0,0,0,0],v={zero:[...B],tempFour:B,set:($h,Lh,Sh,Eh,Gh)=>(Sh===void 0&&(Sh=Eh=Gh=Lh),$h[0]=Lh,$h[1]=Sh,$h[2]=Eh,$h[3]=Gh,$h),setTemp:($h,Lh,Sh,Eh)=>k(B,$h,Lh,Sh,Eh),toTempAB($h,Lh,Sh){w=Sh?o($h)?Lh:$h:[],o($h)?(m=O($h),x=Lh):o(Lh)?(m=$h,x=O(Lh)):(m=$h,x=Lh),m.length!==4&&(m=C(m)),x.length!==4&&(x=C(x))},get($h,Lh){let Sh;if(!o($h))switch($h.length){case 4:Sh=s(Lh)?$h:[...$h];break;case 2:Sh=[$h[0],$h[1],$h[0],$h[1]];break;case 3:Sh=[$h[0],$h[1],$h[2],$h[1]];break;case 1:$h=$h[0];break;default:$h=0}if(Sh||(Sh=[$h,$h,$h,$h]),!s(Lh))for(let Eh=0;Eh<4;Eh++)Sh[Eh]>Lh&&(Sh[Eh]=Lh);return Sh},max:($h,Lh,Sh)=>o($h)&&o(Lh)?b($h,Lh):(T($h,Lh,Sh),k(w,b(m[0],x[0]),b(m[1],x[1]),b(m[2],x[2]),b(m[3],x[3]))),add:($h,Lh,Sh)=>o($h)&&o(Lh)?$h+Lh:(T($h,Lh,Sh),k(w,m[0]+x[0],m[1]+x[1],m[2]+x[2],m[3]+x[3])),swapAndScale($h,Lh,Sh,Eh){if(o($h))return Lh===Sh?$h*Lh:[$h*Sh,$h*Lh];const Gh=Eh?$h:[],[Ah,Ph,Nh,Mh]=$h.length===4?$h:C($h);return k(Gh,Nh*Sh,Mh*Lh,Ah*Sh,Ph*Lh)}},{set:k,get:C,setTemp:O,toTempAB:T}=v,{round:P,pow:S,max:L,floor:R,PI:E}=Math,I$1={within:($h,Lh,Sh)=>(d(Lh)&&(Sh=Lh.max,Lh=Lh.min),!s(Lh)&&$h<Lh&&($h=Lh),!s(Sh)&&$h>Sh&&($h=Sh),$h),fourNumber:v.get,formatRotation:($h,Lh)=>($h%=360,Lh?$h<0&&($h+=360):($h>180&&($h-=360),$h<-180&&($h+=360)),I$1.float($h)),getGapRotation($h,Lh,Sh=0){let Eh=$h+Sh;if(Lh>1){const Gh=Math.abs(Eh%Lh);(Gh<1||Gh>Lh-1)&&(Eh=Math.round(Eh/Lh)*Lh)}return Eh-Sh},float($h,Lh){const Sh=s(Lh)?1e12:S(10,Lh);return($h=P($h*Sh)/Sh)===-0?0:$h},sign:$h=>$h<0?-1:1,getScaleData($h,Lh,Sh,Eh){if(Eh||(Eh={}),Lh){const Gh=(o(Lh)?Lh:Lh.width||0)/Sh.width,Ah=(o(Lh)?Lh:Lh.height||0)/Sh.height;Eh.scaleX=Gh||Ah||1,Eh.scaleY=Ah||Gh||1}else $h&&I$1.assignScale(Eh,$h);return Eh},assignScale($h,Lh){o(Lh)?$h.scaleX=$h.scaleY=Lh:($h.scaleX=Lh.x,$h.scaleY=Lh.y)},getFloorScale:($h,Lh=1)=>L(R($h),Lh)/$h,randInt:M,randColor:$h=>`rgba(${M(255)},${M(255)},${M(255)},${$h||1})`};function M($h){return Math.round(Math.random()*$h)}const A=E/180,W$1=2*E,N$1=E/2;function Y$1(){return{x:0,y:0}}function D(){return{x:0,y:0,width:0,height:0}}function X$1(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:z$1,cos:F$1,acos:U$1,sqrt:j$1}=Math,{float:V$1}=I$1,H={};function G$1(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const q$1={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:G$1(),tempMatrix:{},set($h,Lh=1,Sh=0,Eh=0,Gh=1,Ah=0,Ph=0){$h.a=Lh,$h.b=Sh,$h.c=Eh,$h.d=Gh,$h.e=Ah,$h.f=Ph},get:X$1,getWorld:G$1,copy($h,Lh){$h.a=Lh.a,$h.b=Lh.b,$h.c=Lh.c,$h.d=Lh.d,$h.e=Lh.e,$h.f=Lh.f},translate($h,Lh,Sh){$h.e+=Lh,$h.f+=Sh},translateInner($h,Lh,Sh,Eh){$h.e+=$h.a*Lh+$h.c*Sh,$h.f+=$h.b*Lh+$h.d*Sh,Eh&&($h.e-=Lh,$h.f-=Sh)},scale($h,Lh,Sh=Lh){$h.a*=Lh,$h.b*=Lh,$h.c*=Sh,$h.d*=Sh},pixelScale($h,Lh,Sh){Sh||(Sh=$h),Sh.a=$h.a*Lh,Sh.b=$h.b*Lh,Sh.c=$h.c*Lh,Sh.d=$h.d*Lh,Sh.e=$h.e*Lh,Sh.f=$h.f*Lh},scaleOfOuter($h,Lh,Sh,Eh){Q$1.toInnerPoint($h,Lh,H),Q$1.scaleOfInner($h,H,Sh,Eh)},scaleOfInner($h,Lh,Sh,Eh=Sh){Q$1.translateInner($h,Lh.x,Lh.y),Q$1.scale($h,Sh,Eh),Q$1.translateInner($h,-Lh.x,-Lh.y)},rotate($h,Lh){const{a:Sh,b:Eh,c:Gh,d:Ah}=$h,Ph=F$1(Lh*=A),Nh=z$1(Lh);$h.a=Sh*Ph-Eh*Nh,$h.b=Sh*Nh+Eh*Ph,$h.c=Gh*Ph-Ah*Nh,$h.d=Gh*Nh+Ah*Ph},rotateOfOuter($h,Lh,Sh){Q$1.toInnerPoint($h,Lh,H),Q$1.rotateOfInner($h,H,Sh)},rotateOfInner($h,Lh,Sh){Q$1.translateInner($h,Lh.x,Lh.y),Q$1.rotate($h,Sh),Q$1.translateInner($h,-Lh.x,-Lh.y)},skew($h,Lh,Sh){const{a:Eh,b:Gh,c:Ah,d:Ph}=$h;Sh&&(Sh*=A,$h.a=Eh+Ah*Sh,$h.b=Gh+Ph*Sh),Lh&&(Lh*=A,$h.c=Ah+Eh*Lh,$h.d=Ph+Gh*Lh)},skewOfOuter($h,Lh,Sh,Eh){Q$1.toInnerPoint($h,Lh,H),Q$1.skewOfInner($h,H,Sh,Eh)},skewOfInner($h,Lh,Sh,Eh=0){Q$1.translateInner($h,Lh.x,Lh.y),Q$1.skew($h,Sh,Eh),Q$1.translateInner($h,-Lh.x,-Lh.y)},multiply($h,Lh){const{a:Sh,b:Eh,c:Gh,d:Ah,e:Ph,f:Nh}=$h;$h.a=Lh.a*Sh+Lh.b*Gh,$h.b=Lh.a*Eh+Lh.b*Ah,$h.c=Lh.c*Sh+Lh.d*Gh,$h.d=Lh.c*Eh+Lh.d*Ah,$h.e=Lh.e*Sh+Lh.f*Gh+Ph,$h.f=Lh.e*Eh+Lh.f*Ah+Nh},multiplyParent($h,Lh,Sh,Eh,Gh){const{e:Ah,f:Ph}=$h;if(Sh||(Sh=$h),s(Eh)&&(Eh=$h.a!==1||$h.b||$h.c||$h.d!==1),Eh){const{a:Nh,b:Mh,c:Dh,d:Fh}=$h;Sh.a=Nh*Lh.a+Mh*Lh.c,Sh.b=Nh*Lh.b+Mh*Lh.d,Sh.c=Dh*Lh.a+Fh*Lh.c,Sh.d=Dh*Lh.b+Fh*Lh.d,Gh&&(Sh.scaleX=Lh.scaleX*Gh.scaleX,Sh.scaleY=Lh.scaleY*Gh.scaleY)}else Sh.a=Lh.a,Sh.b=Lh.b,Sh.c=Lh.c,Sh.d=Lh.d,Gh&&(Sh.scaleX=Lh.scaleX,Sh.scaleY=Lh.scaleY);Sh.e=Ah*Lh.a+Ph*Lh.c+Lh.e,Sh.f=Ah*Lh.b+Ph*Lh.d+Lh.f},divide($h,Lh){Q$1.multiply($h,Q$1.tempInvert(Lh))},divideParent($h,Lh){Q$1.multiplyParent($h,Q$1.tempInvert(Lh))},tempInvert($h){const{tempMatrix:Lh}=Q$1;return Q$1.copy(Lh,$h),Q$1.invert(Lh),Lh},invert($h){const{a:Lh,b:Sh,c:Eh,d:Gh,e:Ah,f:Ph}=$h;if(Sh||Eh){const Nh=1/(Lh*Gh-Sh*Eh);$h.a=Gh*Nh,$h.b=-Sh*Nh,$h.c=-Eh*Nh,$h.d=Lh*Nh,$h.e=-(Ah*Gh-Ph*Eh)*Nh,$h.f=-(Ph*Lh-Ah*Sh)*Nh}else if(Lh===1&&Gh===1)$h.e=-Ah,$h.f=-Ph;else{const Nh=1/(Lh*Gh);$h.a=Gh*Nh,$h.d=Lh*Nh,$h.e=-Ah*Gh*Nh,$h.f=-Ph*Lh*Nh}},toOuterPoint($h,Lh,Sh,Eh){const{x:Gh,y:Ah}=Lh;Sh||(Sh=Lh),Sh.x=Gh*$h.a+Ah*$h.c,Sh.y=Gh*$h.b+Ah*$h.d,Eh||(Sh.x+=$h.e,Sh.y+=$h.f)},toInnerPoint($h,Lh,Sh,Eh){const{a:Gh,b:Ah,c:Ph,d:Nh}=$h,Mh=1/(Gh*Nh-Ah*Ph),{x:Dh,y:Fh}=Lh;if(Sh||(Sh=Lh),Sh.x=(Dh*Nh-Fh*Ph)*Mh,Sh.y=(Fh*Gh-Dh*Ah)*Mh,!Eh){const{e:Ih,f:Hh}=$h;Sh.x-=(Ih*Nh-Hh*Ph)*Mh,Sh.y-=(Hh*Gh-Ih*Ah)*Mh}},setLayout($h,Lh,Sh,Eh,Gh){const{x:Ah,y:Ph,scaleX:Nh,scaleY:Mh}=Lh;if(s(Gh)&&(Gh=Lh.rotation||Lh.skewX||Lh.skewY),Gh){const{rotation:Dh,skewX:Fh,skewY:Ih}=Lh,Hh=Dh*A,Wh=F$1(Hh),zh=z$1(Hh);if(Fh||Ih){const Uh=Fh*A,Yh=Ih*A;$h.a=(Wh+Yh*-zh)*Nh,$h.b=(zh+Yh*Wh)*Nh,$h.c=(Uh*Wh-zh)*Mh,$h.d=(Wh+Uh*zh)*Mh}else $h.a=Wh*Nh,$h.b=zh*Nh,$h.c=-zh*Mh,$h.d=Wh*Mh}else $h.a=Nh,$h.b=0,$h.c=0,$h.d=Mh;$h.e=Ah,$h.f=Ph,(Sh=Sh||Eh)&&Q$1.translateInner($h,-Sh.x,-Sh.y,!Eh)},getLayout($h,Lh,Sh,Eh){const{a:Gh,b:Ah,c:Ph,d:Nh,e:Mh,f:Dh}=$h;let Fh,Ih,Hh,Wh,zh,Uh=Mh,Yh=Dh;if(Ah||Ph){const Xh=Gh*Nh-Ah*Ph;if(Ph&&!Eh){Fh=j$1(Gh*Gh+Ah*Ah),Ih=Xh/Fh;const Kh=Gh/Fh;Hh=Ah>0?U$1(Kh):-U$1(Kh)}else{Ih=j$1(Ph*Ph+Nh*Nh),Fh=Xh/Ih;const Kh=Ph/Ih;Hh=N$1-(Nh>0?U$1(-Kh):-U$1(Kh))}const jh=V$1(F$1(Hh)),qh=z$1(Hh);Fh=V$1(Fh),Ih=V$1(Ih),Wh=jh?V$1((Ph/Ih+qh)/jh/A,9):0,zh=jh?V$1((Ah/Fh-qh)/jh/A,9):0,Hh=V$1(Hh/A)}else Fh=Gh,Ih=Nh,Hh=Wh=zh=0;return(Lh=Sh||Lh)&&(Uh+=Lh.x*Gh+Lh.y*Ph,Yh+=Lh.x*Ah+Lh.y*Nh,Sh||(Uh-=Lh.x,Yh-=Lh.y)),{x:Uh,y:Yh,scaleX:Fh,scaleY:Ih,rotation:Hh,skewX:Wh,skewY:zh}},withScale($h,Lh,Sh=Lh){const Eh=$h;if(!Lh||!Sh){const{a:Gh,b:Ah,c:Ph,d:Nh}=$h;Ah||Ph?Sh=(Gh*Nh-Ah*Ph)/(Lh=j$1(Gh*Gh+Ah*Ah)):(Lh=Gh,Sh=Nh)}return Eh.scaleX=Lh,Eh.scaleY=Sh,Eh},reset($h){Q$1.set($h)}},Q$1=q$1,{float:J$2}=I$1,{toInnerPoint:Z$2,toOuterPoint:$$1}=q$1,{sin:K$1,cos:tt$2,abs:et$2,sqrt:st$2,atan2:rt$2,min:it$2,round:nt$2}=Math,ot$2={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set($h,Lh=0,Sh=0){$h.x=Lh,$h.y=Sh},setRadius($h,Lh,Sh){$h.radiusX=Lh,$h.radiusY=s(Sh)?Lh:Sh},copy($h,Lh){$h.x=Lh.x,$h.y=Lh.y},copyFrom($h,Lh,Sh){$h.x=Lh,$h.y=Sh},round($h,Lh){$h.x=Lh?nt$2($h.x-.5)+.5:nt$2($h.x),$h.y=Lh?nt$2($h.y-.5)+.5:nt$2($h.y)},move($h,Lh,Sh){d(Lh)?($h.x+=Lh.x,$h.y+=Lh.y):($h.x+=Lh,$h.y+=Sh)},scale($h,Lh,Sh=Lh){$h.x&&($h.x*=Lh),$h.y&&($h.y*=Sh)},scaleOf($h,Lh,Sh,Eh=Sh){$h.x+=($h.x-Lh.x)*(Sh-1),$h.y+=($h.y-Lh.y)*(Eh-1)},rotate($h,Lh,Sh){Sh||(Sh=at$2.defaultPoint);const Eh=tt$2(Lh*=A),Gh=K$1(Lh),Ah=$h.x-Sh.x,Ph=$h.y-Sh.y;$h.x=Sh.x+Ah*Eh-Ph*Gh,$h.y=Sh.y+Ah*Gh+Ph*Eh},tempToInnerOf($h,Lh){const{tempPoint:Sh}=at$2;return lt$2(Sh,$h),Z$2(Lh,Sh,Sh),Sh},tempToOuterOf($h,Lh){const{tempPoint:Sh}=at$2;return lt$2(Sh,$h),$$1(Lh,Sh,Sh),Sh},tempToInnerRadiusPointOf($h,Lh){const{tempRadiusPoint:Sh}=at$2;return lt$2(Sh,$h),at$2.toInnerRadiusPointOf($h,Lh,Sh),Sh},copyRadiusPoint:($h,Lh,Sh,Eh)=>(lt$2($h,Lh),dt$2($h,Sh,Eh),$h),toInnerRadiusPointOf($h,Lh,Sh){Sh||(Sh=$h),Z$2(Lh,$h,Sh),Sh.radiusX=Math.abs($h.radiusX/Lh.scaleX),Sh.radiusY=Math.abs($h.radiusY/Lh.scaleY)},toInnerOf($h,Lh,Sh){Z$2(Lh,$h,Sh)},toOuterOf($h,Lh,Sh){$$1(Lh,$h,Sh)},getCenter:($h,Lh)=>({x:$h.x+(Lh.x-$h.x)/2,y:$h.y+(Lh.y-$h.y)/2}),getCenterX:($h,Lh)=>$h+(Lh-$h)/2,getCenterY:($h,Lh)=>$h+(Lh-$h)/2,getDistance:($h,Lh)=>ht$2($h.x,$h.y,Lh.x,Lh.y),getDistanceFrom($h,Lh,Sh,Eh){const Gh=et$2(Sh-$h),Ah=et$2(Eh-Lh);return st$2(Gh*Gh+Ah*Ah)},getMinDistanceFrom:($h,Lh,Sh,Eh,Gh,Ah)=>it$2(ht$2($h,Lh,Sh,Eh),ht$2(Sh,Eh,Gh,Ah)),getAngle:($h,Lh)=>ct$2($h,Lh)/A,getRotation:($h,Lh,Sh,Eh)=>(Eh||(Eh=Lh),at$2.getRadianFrom($h.x,$h.y,Lh.x,Lh.y,Sh.x,Sh.y,Eh.x,Eh.y)/A),getRadianFrom($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh){s(Ph)&&(Ph=Sh,Nh=Eh);const Mh=$h-Sh,Dh=Lh-Eh,Fh=Gh-Ph,Ih=Ah-Nh;return Math.atan2(Mh*Ih-Dh*Fh,Mh*Fh+Dh*Ih)},getAtan2:($h,Lh)=>rt$2(Lh.y-$h.y,Lh.x-$h.x),getDistancePoint($h,Lh,Sh,Eh,Gh){const Ah=ct$2($h,Lh);return Gh&&($h=Lh),Eh||(Lh={}),Lh.x=$h.x+tt$2(Ah)*Sh,Lh.y=$h.y+K$1(Ah)*Sh,Lh},toNumberPoints($h){let Lh=$h;return d($h[0])&&(Lh=[],$h.forEach(Sh=>Lh.push(Sh.x,Sh.y))),Lh},isSame:($h,Lh)=>J$2($h.x)===J$2(Lh.x)&&J$2($h.y)===J$2(Lh.y),reset($h){at$2.reset($h)}},at$2=ot$2,{getDistanceFrom:ht$2,copy:lt$2,setRadius:dt$2,getAtan2:ct$2}=at$2;let ut$2=class Ul{constructor(Lh,Sh){this.set(Lh,Sh)}set(Lh,Sh){return d(Lh)?ot$2.copy(this,Lh):ot$2.set(this,Lh,Sh),this}get(){const{x:Lh,y:Sh}=this;return{x:Lh,y:Sh}}clone(){return new Ul(this)}move(Lh,Sh){return ot$2.move(this,Lh,Sh),this}scale(Lh,Sh){return ot$2.scale(this,Lh,Sh),this}scaleOf(Lh,Sh,Eh){return ot$2.scaleOf(this,Lh,Sh,Eh),this}rotate(Lh,Sh){return ot$2.rotate(this,Lh,Sh),this}rotateOf(Lh,Sh){return ot$2.rotate(this,Sh,Lh),this}getRotation(Lh,Sh,Eh){return ot$2.getRotation(this,Lh,Sh,Eh)}toInnerOf(Lh,Sh){return ot$2.toInnerOf(this,Lh,Sh),this}toOuterOf(Lh,Sh){return ot$2.toOuterOf(this,Lh,Sh),this}getCenter(Lh){return new Ul(ot$2.getCenter(this,Lh))}getDistance(Lh){return ot$2.getDistance(this,Lh)}getDistancePoint(Lh,Sh,Eh,Gh){return new Ul(ot$2.getDistancePoint(this,Lh,Sh,Eh,Gh))}getAngle(Lh){return ot$2.getAngle(this,Lh)}getAtan2(Lh){return ot$2.getAtan2(this,Lh)}isSame(Lh){return ot$2.isSame(this,Lh)}reset(){return ot$2.reset(this),this}};const _t$2=new ut$2;let pt$2=class _d{constructor(Lh,Sh,Eh,Gh,Ah,Ph){this.set(Lh,Sh,Eh,Gh,Ah,Ph)}set(Lh,Sh,Eh,Gh,Ah,Ph){return d(Lh)?q$1.copy(this,Lh):q$1.set(this,Lh,Sh,Eh,Gh,Ah,Ph),this}setWith(Lh){return q$1.copy(this,Lh),this.scaleX=Lh.scaleX,this.scaleY=Lh.scaleY,this}get(){const{a:Lh,b:Sh,c:Eh,d:Gh,e:Ah,f:Ph}=this;return{a:Lh,b:Sh,c:Eh,d:Gh,e:Ah,f:Ph}}clone(){return new _d(this)}translate(Lh,Sh){return q$1.translate(this,Lh,Sh),this}translateInner(Lh,Sh){return q$1.translateInner(this,Lh,Sh),this}scale(Lh,Sh){return q$1.scale(this,Lh,Sh),this}scaleWith(Lh,Sh){return q$1.scale(this,Lh,Sh),this.scaleX*=Lh,this.scaleY*=Sh||Lh,this}pixelScale(Lh){return q$1.pixelScale(this,Lh),this}scaleOfOuter(Lh,Sh,Eh){return q$1.scaleOfOuter(this,Lh,Sh,Eh),this}scaleOfInner(Lh,Sh,Eh){return q$1.scaleOfInner(this,Lh,Sh,Eh),this}rotate(Lh){return q$1.rotate(this,Lh),this}rotateOfOuter(Lh,Sh){return q$1.rotateOfOuter(this,Lh,Sh),this}rotateOfInner(Lh,Sh){return q$1.rotateOfInner(this,Lh,Sh),this}skew(Lh,Sh){return q$1.skew(this,Lh,Sh),this}skewOfOuter(Lh,Sh,Eh){return q$1.skewOfOuter(this,Lh,Sh,Eh),this}skewOfInner(Lh,Sh,Eh){return q$1.skewOfInner(this,Lh,Sh,Eh),this}multiply(Lh){return q$1.multiply(this,Lh),this}multiplyParent(Lh){return q$1.multiplyParent(this,Lh),this}divide(Lh){return q$1.divide(this,Lh),this}divideParent(Lh){return q$1.divideParent(this,Lh),this}invert(){return q$1.invert(this),this}invertWith(){return q$1.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(Lh,Sh,Eh){q$1.toOuterPoint(this,Lh,Sh,Eh)}toInnerPoint(Lh,Sh,Eh){q$1.toInnerPoint(this,Lh,Sh,Eh)}setLayout(Lh,Sh,Eh){return q$1.setLayout(this,Lh,Sh,Eh),this}getLayout(Lh,Sh,Eh){return q$1.getLayout(this,Lh,Sh,Eh)}withScale(Lh,Sh){return q$1.withScale(this,Lh,Sh)}reset(){q$1.reset(this)}};const ft$2=new pt$2,gt$2={tempPointBounds:{},setPoint($h,Lh,Sh){$h.minX=$h.maxX=Lh,$h.minY=$h.maxY=Sh},addPoint($h,Lh,Sh){$h.minX=Lh<$h.minX?Lh:$h.minX,$h.minY=Sh<$h.minY?Sh:$h.minY,$h.maxX=Lh>$h.maxX?Lh:$h.maxX,$h.maxY=Sh>$h.maxY?Sh:$h.maxY},addBounds($h,Lh,Sh,Eh,Gh){yt$2($h,Lh,Sh),yt$2($h,Lh+Eh,Sh+Gh)},copy($h,Lh){$h.minX=Lh.minX,$h.minY=Lh.minY,$h.maxX=Lh.maxX,$h.maxY=Lh.maxY},addPointBounds($h,Lh){$h.minX=Lh.minX<$h.minX?Lh.minX:$h.minX,$h.minY=Lh.minY<$h.minY?Lh.minY:$h.minY,$h.maxX=Lh.maxX>$h.maxX?Lh.maxX:$h.maxX,$h.maxY=Lh.maxY>$h.maxY?Lh.maxY:$h.maxY},toBounds($h,Lh){Lh.x=$h.minX,Lh.y=$h.minY,Lh.width=$h.maxX-$h.minX,Lh.height=$h.maxY-$h.minY}},{addPoint:yt$2}=gt$2;var mt$3,xt$2;(function($h){$h[$h.top=0]="top",$h[$h.right=1]="right",$h[$h.bottom=2]="bottom",$h[$h.left=3]="left"})(mt$3||(mt$3={})),(function($h){$h[$h.topLeft=0]="topLeft",$h[$h.top=1]="top",$h[$h.topRight=2]="topRight",$h[$h.right=3]="right",$h[$h.bottomRight=4]="bottomRight",$h[$h.bottom=5]="bottom",$h[$h.bottomLeft=6]="bottomLeft",$h[$h.left=7]="left",$h[$h.center=8]="center",$h[$h["top-left"]=0]="top-left",$h[$h["top-right"]=2]="top-right",$h[$h["bottom-right"]=4]="bottom-right",$h[$h["bottom-left"]=6]="bottom-left"})(xt$2||(xt$2={}));const wt$2=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];wt$2.forEach($h=>$h.type="percent");const bt$3={directionData:wt$2,tempPoint:{},get:Bt$3,toPoint($h,Lh,Sh,Eh,Gh,Ah){const Ph=Bt$3($h);Sh.x=Ph.x,Sh.y=Ph.y,Ph.type==="percent"&&(Sh.x*=Lh.width,Sh.y*=Lh.height,Gh&&(Ah||(Sh.x-=Gh.x,Sh.y-=Gh.y),Ph.x&&(Sh.x-=Ph.x===1?Gh.width:Ph.x===.5?Ph.x*Gh.width:0),Ph.y&&(Sh.y-=Ph.y===1?Gh.height:Ph.y===.5?Ph.y*Gh.height:0))),Eh||(Sh.x+=Lh.x,Sh.y+=Lh.y)},getPoint:($h,Lh,Sh)=>(Sh||(Sh={}),bt$3.toPoint($h,Lh,Sh,!0),Sh)};function Bt$3($h){return i($h)?wt$2[xt$2[$h]]:$h}const{toPoint:vt$2}=bt$3,kt$3={toPoint($h,Lh,Sh,Eh,Gh,Ah){vt$2($h,Sh,Eh,Gh,Lh,Ah)}},{tempPointBounds:Ct$3,setPoint:Ot$3,addPoint:Tt$3,toBounds:Pt$3}=gt$2,{toOuterPoint:St$3}=q$1,{float:Lt$3,fourNumber:Rt$3}=I$1,{floor:Et$3,ceil:It$3}=Math;let Mt$3,At$3,Wt$3,Nt$3;const Yt$3={},Dt$3={},Xt$3={},zt$2={tempBounds:Xt$3,set($h,Lh=0,Sh=0,Eh=0,Gh=0){$h.x=Lh,$h.y=Sh,$h.width=Eh,$h.height=Gh},copy($h,Lh){$h.x=Lh.x,$h.y=Lh.y,$h.width=Lh.width,$h.height=Lh.height},copyAndSpread($h,Lh,Sh,Eh,Gh){const{x:Ah,y:Ph,width:Nh,height:Mh}=Lh;if(l(Sh)){const Dh=Rt$3(Sh);Eh?Ft$3.set($h,Ah+Dh[3],Ph+Dh[0],Nh-Dh[1]-Dh[3],Mh-Dh[2]-Dh[0]):Ft$3.set($h,Ah-Dh[3],Ph-Dh[0],Nh+Dh[1]+Dh[3],Mh+Dh[2]+Dh[0])}else Eh&&(Sh=-Sh),Ft$3.set($h,Ah-Sh,Ph-Sh,Nh+2*Sh,Mh+2*Sh);Gh&&(Gh==="width"?($h.y=Ph,$h.height=Mh):($h.x=Ah,$h.width=Nh))},minX:$h=>$h.width>0?$h.x:$h.x+$h.width,minY:$h=>$h.height>0?$h.y:$h.y+$h.height,maxX:$h=>$h.width>0?$h.x+$h.width:$h.x,maxY:$h=>$h.height>0?$h.y+$h.height:$h.y,move($h,Lh,Sh){$h.x+=Lh,$h.y+=Sh},scroll($h,Lh){$h.x+=Lh.scrollX,$h.y+=Lh.scrollY},getByMove:($h,Lh,Sh)=>($h=Object.assign({},$h),Ft$3.move($h,Lh,Sh),$h),toOffsetOutBounds($h,Lh,Sh){Lh?jt$3(Lh,$h):Lh=$h,Sh||(Sh=$h),Lh.offsetX=Ft$3.maxX(Sh),Lh.offsetY=Ft$3.maxY(Sh),Ft$3.move(Lh,-Lh.offsetX,-Lh.offsetY)},scale($h,Lh,Sh=Lh,Eh){Eh||ot$2.scale($h,Lh,Sh),$h.width*=Lh,$h.height*=Sh},scaleOf($h,Lh,Sh,Eh=Sh){ot$2.scaleOf($h,Lh,Sh,Eh),$h.width*=Sh,$h.height*=Eh},tempToOuterOf:($h,Lh)=>(Ft$3.copy(Xt$3,$h),Ft$3.toOuterOf(Xt$3,Lh),Xt$3),getOuterOf:($h,Lh)=>($h=Object.assign({},$h),Ft$3.toOuterOf($h,Lh),$h),toOuterOf($h,Lh,Sh){if(Sh||(Sh=$h),Lh.b===0&&Lh.c===0){const{a:Eh,d:Gh,e:Ah,f:Ph}=Lh;Eh>0?(Sh.width=$h.width*Eh,Sh.x=Ah+$h.x*Eh):(Sh.width=$h.width*-Eh,Sh.x=Ah+$h.x*Eh-Sh.width),Gh>0?(Sh.height=$h.height*Gh,Sh.y=Ph+$h.y*Gh):(Sh.height=$h.height*-Gh,Sh.y=Ph+$h.y*Gh-Sh.height)}else Yt$3.x=$h.x,Yt$3.y=$h.y,St$3(Lh,Yt$3,Dt$3),Ot$3(Ct$3,Dt$3.x,Dt$3.y),Yt$3.x=$h.x+$h.width,St$3(Lh,Yt$3,Dt$3),Tt$3(Ct$3,Dt$3.x,Dt$3.y),Yt$3.y=$h.y+$h.height,St$3(Lh,Yt$3,Dt$3),Tt$3(Ct$3,Dt$3.x,Dt$3.y),Yt$3.x=$h.x,St$3(Lh,Yt$3,Dt$3),Tt$3(Ct$3,Dt$3.x,Dt$3.y),Pt$3(Ct$3,Sh)},toInnerOf($h,Lh,Sh){Sh||(Sh=$h),Ft$3.move(Sh,-Lh.e,-Lh.f),Ft$3.scale(Sh,1/Lh.a,1/Lh.d)},getFitMatrix($h,Lh,Sh=1){const Eh=Math.min(Sh,Ft$3.getFitScale($h,Lh));return new pt$2(Eh,0,0,Eh,-Lh.x*Eh,-Lh.y*Eh)},getFitScale($h,Lh,Sh){const Eh=$h.width/Lh.width,Gh=$h.height/Lh.height;return Sh?Math.max(Eh,Gh):Math.min(Eh,Gh)},put($h,Lh,Sh="center",Eh=1,Gh=!0,Ah){Ah||(Ah=Lh),i(Eh)&&(Eh=Ft$3.getFitScale($h,Lh,Eh==="cover")),Xt$3.width=Gh?Lh.width*=Eh:Lh.width*Eh,Xt$3.height=Gh?Lh.height*=Eh:Lh.height*Eh,kt$3.toPoint(Sh,Xt$3,$h,Ah,!0,!0)},getSpread($h,Lh,Sh){const Eh={};return Ft$3.copyAndSpread(Eh,$h,Lh,!1,Sh),Eh},spread($h,Lh,Sh){Ft$3.copyAndSpread($h,$h,Lh,!1,Sh)},shrink($h,Lh,Sh){Ft$3.copyAndSpread($h,$h,Lh,!0,Sh)},ceil($h){const{x:Lh,y:Sh}=$h;$h.x=Et$3($h.x),$h.y=Et$3($h.y),$h.width=Lh>$h.x?It$3($h.width+Lh-$h.x):It$3($h.width),$h.height=Sh>$h.y?It$3($h.height+Sh-$h.y):It$3($h.height)},unsign($h){$h.width<0&&($h.x+=$h.width,$h.width=-$h.width),$h.height<0&&($h.y+=$h.height,$h.height=-$h.height)},float($h,Lh){$h.x=Lt$3($h.x,Lh),$h.y=Lt$3($h.y,Lh),$h.width=Lt$3($h.width,Lh),$h.height=Lt$3($h.height,Lh)},add($h,Lh,Sh){Mt$3=$h.x+$h.width,At$3=$h.y+$h.height,Wt$3=Lh.x,Nt$3=Lh.y,Sh||(Wt$3+=Lh.width,Nt$3+=Lh.height),Mt$3=Mt$3>Wt$3?Mt$3:Wt$3,At$3=At$3>Nt$3?At$3:Nt$3,$h.x=$h.x<Lh.x?$h.x:Lh.x,$h.y=$h.y<Lh.y?$h.y:Lh.y,$h.width=Mt$3-$h.x,$h.height=At$3-$h.y},addList($h,Lh){Ft$3.setListWithFn($h,Lh,void 0,!0)},setList($h,Lh,Sh=!1){Ft$3.setListWithFn($h,Lh,void 0,Sh)},addListWithFn($h,Lh,Sh){Ft$3.setListWithFn($h,Lh,Sh,!0)},setListWithFn($h,Lh,Sh,Eh=!1){let Gh,Ah=!0;for(let Ph=0,Nh=Lh.length;Ph<Nh;Ph++)Gh=Sh?Sh(Lh[Ph],Ph):Lh[Ph],Gh&&(Gh.width||Gh.height)&&(Ah?(Ah=!1,Eh||jt$3($h,Gh)):Ut$3($h,Gh));Ah&&Ft$3.reset($h)},setPoints($h,Lh){Lh.forEach((Sh,Eh)=>Eh===0?Ot$3(Ct$3,Sh.x,Sh.y):Tt$3(Ct$3,Sh.x,Sh.y)),Pt$3(Ct$3,$h)},setPoint($h,Lh){Ft$3.set($h,Lh.x,Lh.y)},addPoint($h,Lh){Ut$3($h,Lh,!0)},getPoints($h){const{x:Lh,y:Sh,width:Eh,height:Gh}=$h;return[{x:Lh,y:Sh},{x:Lh+Eh,y:Sh},{x:Lh+Eh,y:Sh+Gh},{x:Lh,y:Sh+Gh}]},hitRadiusPoint:($h,Lh,Sh)=>(Sh&&(Lh=ot$2.tempToInnerRadiusPointOf(Lh,Sh)),Lh.x>=$h.x-Lh.radiusX&&Lh.x<=$h.x+$h.width+Lh.radiusX&&Lh.y>=$h.y-Lh.radiusY&&Lh.y<=$h.y+$h.height+Lh.radiusY),hitPoint:($h,Lh,Sh)=>(Sh&&(Lh=ot$2.tempToInnerOf(Lh,Sh)),Lh.x>=$h.x&&Lh.x<=$h.x+$h.width&&Lh.y>=$h.y&&Lh.y<=$h.y+$h.height),hit:($h,Lh,Sh)=>(Sh&&(Lh=Ft$3.tempToOuterOf(Lh,Sh)),!($h.y+$h.height<Lh.y||Lh.y+Lh.height<$h.y||$h.x+$h.width<Lh.x||Lh.x+Lh.width<$h.x)),includes:($h,Lh,Sh)=>(Sh&&(Lh=Ft$3.tempToOuterOf(Lh,Sh)),$h.x<=Lh.x&&$h.y<=Lh.y&&$h.x+$h.width>=Lh.x+Lh.width&&$h.y+$h.height>=Lh.y+Lh.height),getIntersectData($h,Lh,Sh){if(Sh&&(Lh=Ft$3.tempToOuterOf(Lh,Sh)),!Ft$3.hit($h,Lh))return{x:0,y:0,width:0,height:0};let{x:Eh,y:Gh,width:Ah,height:Ph}=Lh;return Mt$3=Eh+Ah,At$3=Gh+Ph,Wt$3=$h.x+$h.width,Nt$3=$h.y+$h.height,Eh=Eh>$h.x?Eh:$h.x,Gh=Gh>$h.y?Gh:$h.y,Mt$3=Mt$3<Wt$3?Mt$3:Wt$3,At$3=At$3<Nt$3?At$3:Nt$3,Ah=Mt$3-Eh,Ph=At$3-Gh,{x:Eh,y:Gh,width:Ah,height:Ph}},intersect($h,Lh,Sh){Ft$3.copy($h,Ft$3.getIntersectData($h,Lh,Sh))},isSame:($h,Lh)=>$h.x===Lh.x&&$h.y===Lh.y&&$h.width===Lh.width&&$h.height===Lh.height,isEmpty:$h=>$h.x===0&&$h.y===0&&$h.width===0&&$h.height===0,hasSize:$h=>$h.width&&$h.height,reset($h){Ft$3.set($h)}},Ft$3=zt$2,{add:Ut$3,copy:jt$3}=Ft$3;let Vt$3=class td{get minX(){return zt$2.minX(this)}get minY(){return zt$2.minY(this)}get maxX(){return zt$2.maxX(this)}get maxY(){return zt$2.maxY(this)}constructor(Lh,Sh,Eh,Gh){this.set(Lh,Sh,Eh,Gh)}set(Lh,Sh,Eh,Gh){return d(Lh)?zt$2.copy(this,Lh):zt$2.set(this,Lh,Sh,Eh,Gh),this}get(){const{x:Lh,y:Sh,width:Eh,height:Gh}=this;return{x:Lh,y:Sh,width:Eh,height:Gh}}clone(){return new td(this)}move(Lh,Sh){return zt$2.move(this,Lh,Sh),this}scale(Lh,Sh,Eh){return zt$2.scale(this,Lh,Sh,Eh),this}scaleOf(Lh,Sh,Eh){return zt$2.scaleOf(this,Lh,Sh,Eh),this}toOuterOf(Lh,Sh){return zt$2.toOuterOf(this,Lh,Sh),this}toInnerOf(Lh,Sh){return zt$2.toInnerOf(this,Lh,Sh),this}getFitMatrix(Lh,Sh){return zt$2.getFitMatrix(this,Lh,Sh)}put(Lh,Sh,Eh){zt$2.put(this,Lh,Sh,Eh)}spread(Lh,Sh){return zt$2.spread(this,Lh,Sh),this}shrink(Lh,Sh){return zt$2.shrink(this,Lh,Sh),this}ceil(){return zt$2.ceil(this),this}unsign(){return zt$2.unsign(this),this}float(Lh){return zt$2.float(this,Lh),this}add(Lh){return zt$2.add(this,Lh),this}addList(Lh){return zt$2.setList(this,Lh,!0),this}setList(Lh){return zt$2.setList(this,Lh),this}addListWithFn(Lh,Sh){return zt$2.setListWithFn(this,Lh,Sh,!0),this}setListWithFn(Lh,Sh){return zt$2.setListWithFn(this,Lh,Sh),this}setPoint(Lh){return zt$2.setPoint(this,Lh),this}setPoints(Lh){return zt$2.setPoints(this,Lh),this}addPoint(Lh){return zt$2.addPoint(this,Lh),this}getPoints(){return zt$2.getPoints(this)}hitPoint(Lh,Sh){return zt$2.hitPoint(this,Lh,Sh)}hitRadiusPoint(Lh,Sh){return zt$2.hitRadiusPoint(this,Lh,Sh)}hit(Lh,Sh){return zt$2.hit(this,Lh,Sh)}includes(Lh,Sh){return zt$2.includes(this,Lh,Sh)}intersect(Lh,Sh){return zt$2.intersect(this,Lh,Sh),this}getIntersect(Lh,Sh){return new td(zt$2.getIntersectData(this,Lh,Sh))}isSame(Lh){return zt$2.isSame(this,Lh)}isEmpty(){return zt$2.isEmpty(this)}reset(){zt$2.reset(this)}};const Ht$3=new Vt$3;let Gt$2=class{constructor($h,Lh,Sh,Eh,Gh,Ah){d($h)?this.copy($h):this.set($h,Lh,Sh,Eh,Gh,Ah)}set($h=0,Lh=0,Sh=0,Eh=0,Gh=0,Ah=0){this.top=$h,this.right=Lh,this.bottom=Sh,this.left=Eh,this.width=Gh,this.height=Ah}copy($h){const{top:Lh,right:Sh,bottom:Eh,left:Gh,width:Ah,height:Ph}=$h;this.set(Lh,Sh,Eh,Gh,Ah,Ph)}getBoundsFrom($h){const{top:Lh,right:Sh,bottom:Eh,left:Gh,width:Ah,height:Ph}=this;return new Vt$3(Gh,Lh,Ah||$h.width-Gh-Sh,Ph||$h.height-Lh-Eh)}};const qt$2={number:($h,Lh)=>d($h)?$h.type==="percent"?$h.value*Lh:$h.value:$h},Qt$2={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1},{floor:Jt$2,max:Zt$2}=Math,$t$2={toURL($h,Lh){let Sh=encodeURIComponent($h);return Lh==="text"?Sh="data:text/plain;charset=utf-8,"+Sh:Lh==="svg"&&(Sh="data:image/svg+xml,"+Sh),Sh},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",isLarge:($h,Lh,Sh,Eh)=>$h.width*$h.height*(Lh?Lh*Sh:1)>(Eh||Kt$3.maxCacheSize),isSuperLarge:($h,Lh,Sh)=>Kt$3.isLarge($h,Lh,Sh,Kt$3.maxPatternSize),getRealURL($h){const{prefix:Lh,suffix:Sh}=Kt$3;return!Sh||$h.startsWith("data:")||$h.startsWith("blob:")||($h+=($h.includes("?")?"&":"?")+Sh),Lh&&$h[0]==="/"&&($h=Lh+$h),$h},resize($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh){const Fh=Zt$2(Jt$2(Lh+(Eh||0)),1),Ih=Zt$2(Jt$2(Sh+(Gh||0)),1);let Hh,Wh,zh;Dh&&(zh=qt$2.number(Dh.offset,Dh.type==="x"?Lh:Sh))&&(Dh.type==="x"?Hh=!0:Wh=!0);const Uh=$t$2.origin.createCanvas(Wh?2*Fh:Fh,Hh?2*Ih:Ih),Yh=Uh.getContext("2d");if(Nh&&(Yh.globalAlpha=Nh),Yh.imageSmoothingEnabled=Ph!==!1,Kt$3.canUse($h)){if(Ah){const Xh=Lh/Ah.width,jh=Sh/Ah.height;Yh.setTransform(Xh,0,0,jh,-Ah.x*Xh,-Ah.y*jh),Yh.drawImage($h,0,0,$h.width,$h.height)}else Yh.drawImage($h,0,0,Lh,Sh);zh&&(Yh.drawImage(Uh,0,0,Fh,Ih,Hh?zh-Fh:Fh,Hh?Ih:zh-Ih,Fh,Ih),Yh.drawImage(Uh,0,0,Fh,Ih,Hh?zh:Fh,Hh?Ih:zh,Fh,Ih))}return Uh},canUse:$h=>$h&&$h.width&&!$h.__closed,setPatternTransform($h,Lh,Sh){try{Lh&&$h.setTransform&&($h.setTransform(Lh),Lh=void 0)}catch{}Sh&&_.stintSet(Sh,"transform",Lh)}}},{image:Kt$3}=$t$2,{randColor:te$2}=I$1;let ee$2=class ed{constructor(Lh){this.repeatMap={},this.name=Lh}static get(Lh){return new ed(Lh)}static set filter(Lh){this.filterList=se$2(Lh)}static set exclude(Lh){this.excludeList=se$2(Lh)}static drawRepaint(Lh,Sh){const Eh=te$2();Lh.fillWorld(Sh,Eh.replace("1)",".1)")),Lh.strokeWorld(Sh,Eh)}static drawBounds(Lh,Sh,Eh){const Gh=ed.showBounds==="hit",Ah=Lh.__nowWorld,Ph=te$2();Gh&&(Sh.setWorld(Ah),Lh.__drawHitPath(Sh),Sh.fillStyle=Ph.replace("1)",".2)"),Sh.fill()),Sh.resetTransform(),Sh.setStroke(Ph,2),Gh?Sh.stroke():Sh.strokeWorld(Ah,Ph)}log(...Lh){if(re$2.enable){if(re$2.filterList.length&&re$2.filterList.every(Sh=>Sh!==this.name)||re$2.excludeList.length&&re$2.excludeList.some(Sh=>Sh===this.name))return;console.log("%c"+this.name,"color:#21ae62",...Lh)}}tip(...Lh){re$2.enable&&this.warn(...Lh)}warn(...Lh){re$2.showWarn&&console.warn(this.name,...Lh)}repeat(Lh,...Sh){this.repeatMap[Lh]||(this.warn("repeat:"+Lh,...Sh),this.repeatMap[Lh]=!0)}error(...Lh){try{throw new Error}catch(Sh){console.error(this.name,...Lh,Sh)}}};function se$2($h){return $h?i($h)&&($h=[$h]):$h=[],$h}ee$2.filterList=[],ee$2.excludeList=[],ee$2.showWarn=!0;const re$2=ee$2,ie$2=ee$2.get("RunTime"),ne$2={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start($h,Lh){const Sh=g.create(g.RUNTIME);return oe$2.currentId=oe$2.idMap[Sh]=Lh?performance.now():Date.now(),oe$2.currentName=oe$2.nameMap[Sh]=$h,oe$2.nameToIdMap[$h]=Sh,Sh},end($h,Lh){const Sh=oe$2.idMap[$h],Eh=oe$2.nameMap[$h],Gh=Lh?(performance.now()-Sh)/1e3:Date.now()-Sh;oe$2.idMap[$h]=oe$2.nameMap[$h]=oe$2.nameToIdMap[Eh]=void 0,ie$2.log(Eh,Gh,"ms")},endOfName($h,Lh){const Sh=oe$2.nameToIdMap[$h];s(Sh)||oe$2.end(Sh,Lh)}},oe$2=ne$2,ae$2=[],he$2={list:{},add($h,...Lh){this.list[$h]=!0,ae$2.push(...Lh)},has($h,Lh){const Sh=this.list[$h];return!Sh&&Lh&&this.need($h),Sh},need($h){console.error("please install and import plugin: "+($h.includes("-x")?"":"@leafer-in/")+$h)}};setTimeout(()=>ae$2.forEach($h=>he$2.has($h,!0)));const le$2={editor:$h=>he$2.need("editor")},de$2=ee$2.get("UICreator"),ce$2={list:{},register($h){const{__tag:Lh}=$h.prototype;ue$2[Lh]&&de$2.repeat(Lh),ue$2[Lh]=$h},get($h,Lh,Sh,Eh,Gh,Ah){if(!ue$2[$h])return void de$2.warn("not register "+$h);const Ph=new ue$2[$h](Lh);return s(Sh)||(Ph.x=Sh,Eh&&(Ph.y=Eh),Gh&&(Ph.width=Gh),Ah&&(Ph.height=Ah)),Ph}},{list:ue$2}=ce$2,_e$2=ee$2.get("EventCreator"),pe$2={nameList:{},register($h){let Lh;Object.keys($h).forEach(Sh=>{Lh=$h[Sh],i(Lh)&&(fe$2[Lh]&&_e$2.repeat(Lh),fe$2[Lh]=$h)})},changeName($h,Lh){const Sh=fe$2[$h];if(Sh){const Eh=Object.keys(Sh).find(Gh=>Sh[Gh]===$h);Eh&&(Sh[Eh]=Lh,fe$2[Lh]=Sh)}},has($h){return!!this.nameList[$h]},get:($h,...Lh)=>new fe$2[$h](...Lh)},{nameList:fe$2}=pe$2;let ge$2=class{constructor(){this.list=[]}add($h){$h.manager=this,this.list.push($h)}get($h){let Lh;const{list:Sh}=this;for(let Gh=0,Ah=Sh.length;Gh<Ah;Gh++)if(Lh=Sh[Gh],Lh.recycled&&Lh.isSameSize($h))return Lh.recycled=!1,Lh.manager||(Lh.manager=this),Lh;const Eh=le$2.canvas($h);return this.add(Eh),Eh}recycle($h){$h.recycled=!0}clearRecycled(){let $h;const Lh=[];for(let Sh=0,Eh=this.list.length;Sh<Eh;Sh++)$h=this.list[Sh],$h.recycled?$h.destroy():Lh.push($h);this.list=Lh}clear(){this.list.forEach($h=>{$h.destroy()}),this.list.length=0}destroy(){this.clear()}};function ye$2($h,Lh,Sh,Eh){var Gh,Ah=arguments.length,Ph=Ah<3?Lh:Eh===null?Eh=Object.getOwnPropertyDescriptor(Lh,Sh):Eh;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Ph=Reflect.decorate($h,Lh,Sh,Eh);else for(var Nh=$h.length-1;Nh>=0;Nh--)(Gh=$h[Nh])&&(Ph=(Ah<3?Gh(Ph):Ah>3?Gh(Lh,Sh,Ph):Gh(Lh,Sh))||Ph);return Ah>3&&Ph&&Object.defineProperty(Lh,Sh,Ph),Ph}function me$2($h,Lh,Sh,Eh){return new(Sh||(Sh=Promise))(function(Gh,Ah){function Ph(Dh){try{Mh(Eh.next(Dh))}catch(Fh){Ah(Fh)}}function Nh(Dh){try{Mh(Eh.throw(Dh))}catch(Fh){Ah(Fh)}}function Mh(Dh){var Fh;Dh.done?Gh(Dh.value):(Fh=Dh.value,Fh instanceof Sh?Fh:new Sh(function(Ih){Ih(Fh)})).then(Ph,Nh)}Mh((Eh=Eh.apply($h,[])).next())})}function xe$2($h){return(Lh,Sh)=>{$h||($h=Sh);const Eh={get(){return this.context[$h]},set(Gh){this.context[$h]=Gh}};Sh==="strokeCap"&&(Eh.set=function(Gh){this.context[$h]=Gh==="none"?"butt":Gh}),Object.defineProperty(Lh,Sh,Eh)}}const we$2=[];function be$2(){return($h,Lh)=>{we$2.push(Lh)}}const Be$2=[];let ve$2=class{set blendMode($h){$h==="normal"&&($h="source-over"),this.context.globalCompositeOperation=$h}get blendMode(){return this.context.globalCompositeOperation}set dashPattern($h){this.context.setLineDash($h||Be$2)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let $h;we$2.forEach(Lh=>{$h=this.context[Lh],$h&&(this[Lh]=$h.bind(this.context))}),this.textBaseline="alphabetic"}setTransform($h,Lh,Sh,Eh,Gh,Ah){}resetTransform(){}getTransform(){}save(){}restore(){}transform($h,Lh,Sh,Eh,Gh,Ah){d($h)?this.context.transform($h.a,$h.b,$h.c,$h.d,$h.e,$h.f):this.context.transform($h,Lh,Sh,Eh,Gh,Ah)}translate($h,Lh){}scale($h,Lh){}rotate($h){}fill($h,Lh){}stroke($h){}clip($h,Lh){}fillRect($h,Lh,Sh,Eh){}strokeRect($h,Lh,Sh,Eh){}clearRect($h,Lh,Sh,Eh){}drawImage($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh){switch(arguments.length){case 9:if(Lh<0){const Dh=-Lh/Eh*Nh;Eh+=Lh,Lh=0,Ah+=Dh,Nh-=Dh}if(Sh<0){const Dh=-Sh/Gh*Mh;Gh+=Sh,Sh=0,Ph+=Dh,Mh-=Dh}this.context.drawImage($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh);break;case 5:this.context.drawImage($h,Lh,Sh,Eh,Gh);break;case 3:this.context.drawImage($h,Lh,Sh)}}beginPath(){}moveTo($h,Lh){}lineTo($h,Lh){}bezierCurveTo($h,Lh,Sh,Eh,Gh,Ah){}quadraticCurveTo($h,Lh,Sh,Eh){}closePath(){}arc($h,Lh,Sh,Eh,Gh,Ah){}arcTo($h,Lh,Sh,Eh,Gh){}ellipse($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh){}rect($h,Lh,Sh,Eh){}roundRect($h,Lh,Sh,Eh,Gh){}createConicGradient($h,Lh,Sh){}createLinearGradient($h,Lh,Sh,Eh){}createPattern($h,Lh){}createRadialGradient($h,Lh,Sh,Eh,Gh,Ah){}fillText($h,Lh,Sh,Eh){}measureText($h){}strokeText($h,Lh,Sh,Eh){}destroy(){this.context=null}};ye$2([xe$2("imageSmoothingEnabled")],ve$2.prototype,"smooth",void 0),ye$2([xe$2("imageSmoothingQuality")],ve$2.prototype,"smoothLevel",void 0),ye$2([xe$2("globalAlpha")],ve$2.prototype,"opacity",void 0),ye$2([xe$2()],ve$2.prototype,"fillStyle",void 0),ye$2([xe$2()],ve$2.prototype,"strokeStyle",void 0),ye$2([xe$2("lineWidth")],ve$2.prototype,"strokeWidth",void 0),ye$2([xe$2("lineCap")],ve$2.prototype,"strokeCap",void 0),ye$2([xe$2("lineJoin")],ve$2.prototype,"strokeJoin",void 0),ye$2([xe$2("lineDashOffset")],ve$2.prototype,"dashOffset",void 0),ye$2([xe$2()],ve$2.prototype,"miterLimit",void 0),ye$2([xe$2()],ve$2.prototype,"shadowBlur",void 0),ye$2([xe$2()],ve$2.prototype,"shadowColor",void 0),ye$2([xe$2()],ve$2.prototype,"shadowOffsetX",void 0),ye$2([xe$2()],ve$2.prototype,"shadowOffsetY",void 0),ye$2([xe$2()],ve$2.prototype,"filter",void 0),ye$2([xe$2()],ve$2.prototype,"font",void 0),ye$2([xe$2()],ve$2.prototype,"fontKerning",void 0),ye$2([xe$2()],ve$2.prototype,"fontStretch",void 0),ye$2([xe$2()],ve$2.prototype,"fontVariantCaps",void 0),ye$2([xe$2()],ve$2.prototype,"textAlign",void 0),ye$2([xe$2()],ve$2.prototype,"textBaseline",void 0),ye$2([xe$2()],ve$2.prototype,"textRendering",void 0),ye$2([xe$2()],ve$2.prototype,"wordSpacing",void 0),ye$2([xe$2()],ve$2.prototype,"letterSpacing",void 0),ye$2([xe$2()],ve$2.prototype,"direction",void 0),ye$2([be$2()],ve$2.prototype,"setTransform",null),ye$2([be$2()],ve$2.prototype,"resetTransform",null),ye$2([be$2()],ve$2.prototype,"getTransform",null),ye$2([be$2()],ve$2.prototype,"save",null),ye$2([be$2()],ve$2.prototype,"restore",null),ye$2([be$2()],ve$2.prototype,"translate",null),ye$2([be$2()],ve$2.prototype,"scale",null),ye$2([be$2()],ve$2.prototype,"rotate",null),ye$2([be$2()],ve$2.prototype,"fill",null),ye$2([be$2()],ve$2.prototype,"stroke",null),ye$2([be$2()],ve$2.prototype,"clip",null),ye$2([be$2()],ve$2.prototype,"fillRect",null),ye$2([be$2()],ve$2.prototype,"strokeRect",null),ye$2([be$2()],ve$2.prototype,"clearRect",null),ye$2([be$2()],ve$2.prototype,"beginPath",null),ye$2([be$2()],ve$2.prototype,"moveTo",null),ye$2([be$2()],ve$2.prototype,"lineTo",null),ye$2([be$2()],ve$2.prototype,"bezierCurveTo",null),ye$2([be$2()],ve$2.prototype,"quadraticCurveTo",null),ye$2([be$2()],ve$2.prototype,"closePath",null),ye$2([be$2()],ve$2.prototype,"arc",null),ye$2([be$2()],ve$2.prototype,"arcTo",null),ye$2([be$2()],ve$2.prototype,"ellipse",null),ye$2([be$2()],ve$2.prototype,"rect",null),ye$2([be$2()],ve$2.prototype,"roundRect",null),ye$2([be$2()],ve$2.prototype,"createConicGradient",null),ye$2([be$2()],ve$2.prototype,"createLinearGradient",null),ye$2([be$2()],ve$2.prototype,"createPattern",null),ye$2([be$2()],ve$2.prototype,"createRadialGradient",null),ye$2([be$2()],ve$2.prototype,"fillText",null),ye$2([be$2()],ve$2.prototype,"measureText",null),ye$2([be$2()],ve$2.prototype,"strokeText",null);const{copy:ke$2,multiplyParent:Ce$2,pixelScale:Oe$2}=q$1,{round:Te$2}=Math,Pe$2=new Vt$3,Se$2=new Vt$3,Le$2={width:1,height:1,pixelRatio:1},Re$2=["width","height","pixelRatio"];let Ee$2=class extends ve$2{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio||0}get pixelHeight(){return this.height*this.pixelRatio||0}get pixelSnap(){return this.config.pixelSnap}set pixelSnap($h){this.config.pixelSnap=$h}get allowBackgroundColor(){return this.view&&this.parentView}constructor($h,Lh){super(),this.size={},this.worldTransform={},$h||($h=Le$2),this.manager=Lh,this.innerId=g.create(g.CNAVAS);const{width:Sh,height:Eh,pixelRatio:Gh}=$h;this.autoLayout=!Sh||!Eh,this.size.pixelRatio=Gh||$t$2.devicePixelRatio,this.config=$h,this.init()}init(){}__createContext(){const{view:$h}=this,{contextSettings:Lh}=this.config;this.context=Lh?$h.getContext("2d",Lh):$h.getContext("2d"),this.__bindContext()}export($h,Lh){}toBlob($h,Lh){}toDataURL($h,Lh){}saveAs($h,Lh){}resize($h,Lh=!0){if(this.isSameSize($h))return;let Sh;this.context&&!this.unreal&&Lh&&this.width&&(Sh=this.getSameCanvas(),Sh.copyWorld(this));const Eh=this.size;_.copyAttrs(Eh,$h,Re$2),Re$2.forEach(Gh=>Eh[Gh]||(Eh[Gh]=1)),this.bounds=new Vt$3(0,0,this.width,this.height),this.updateViewSize(),this.updateClientBounds(),this.context&&(this.smooth=this.config.smooth,!this.unreal&&Sh&&(this.clearWorld(Sh.bounds),this.copyWorld(Sh),Sh.recycle()))}updateViewSize(){}updateClientBounds(){}getClientBounds($h){return $h&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout($h,Lh){}stopAutoLayout(){}setCursor($h){}setWorld($h,Lh){const{pixelRatio:Sh,pixelSnap:Eh}=this,Gh=this.worldTransform;Lh&&Ce$2($h,Lh,Gh),Oe$2($h,Sh,Gh),Eh&&!$h.ignorePixelSnap&&($h.half&&$h.half*Sh%2?(Gh.e=Te$2(Gh.e-.5)+.5,Gh.f=Te$2(Gh.f-.5)+.5):(Gh.e=Te$2(Gh.e),Gh.f=Te$2(Gh.f))),this.setTransform(Gh.a,Gh.b,Gh.c,Gh.d,Gh.e,Gh.f)}useWorldTransform($h){$h&&(this.worldTransform=$h);const Lh=this.worldTransform;Lh&&this.setTransform(Lh.a,Lh.b,Lh.c,Lh.d,Lh.e,Lh.f)}setStroke($h,Lh,Sh,Eh){Lh&&(this.strokeWidth=Lh),$h&&(this.strokeStyle=$h),Sh&&this.setStrokeOptions(Sh,Eh)}setStrokeOptions($h,Lh){let{strokeCap:Sh,strokeJoin:Eh,dashPattern:Gh,dashOffset:Ah,miterLimit:Ph}=$h;Lh&&(Lh.strokeCap&&(Sh=Lh.strokeCap),Lh.strokeJoin&&(Eh=Lh.strokeJoin),s(Lh.dashPattern)||(Gh=Lh.dashPattern),s(Lh.dashOffset)||(Ah=Lh.dashOffset),Lh.miterLimit&&(Ph=Lh.miterLimit)),this.strokeCap=Sh,this.strokeJoin=Eh,this.dashPattern=Gh,this.dashOffset=Ah,this.miterLimit=Ph}saveBlendMode($h){this.savedBlendMode=this.blendMode,this.blendMode=$h}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill($h,Lh){return!0}hitStroke($h,Lh){return!0}hitPixel($h,Lh,Sh=1){return!0}setWorldShadow($h,Lh,Sh,Eh){const{pixelRatio:Gh}=this;this.shadowOffsetX=$h*Gh,this.shadowOffsetY=Lh*Gh,this.shadowBlur=Sh*Gh,this.shadowColor=Eh||"black"}setWorldBlur($h){const{pixelRatio:Lh}=this;this.filter=`blur(${$h*Lh}px)`}copyWorld($h,Lh,Sh,Eh,Gh){Eh&&(this.blendMode=Eh),Lh?(this.setTempPixelBounds(Lh,Gh),Sh?(this.setTempPixelBounds2(Sh,Gh),Sh=Se$2):Sh=Pe$2,this.drawImage($h.view,Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height,Sh.x,Sh.y,Sh.width,Sh.height)):this.drawImage($h.view,0,0),Eh&&(this.blendMode="source-over")}copyWorldToInner($h,Lh,Sh,Eh,Gh){Lh.b||Lh.c?(this.save(),this.resetTransform(),this.copyWorld($h,Lh,zt$2.tempToOuterOf(Sh,Lh),Eh,Gh),this.restore()):(Eh&&(this.blendMode=Eh),this.setTempPixelBounds(Lh,Gh),this.drawImage($h.view,Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height,Sh.x,Sh.y,Sh.width,Sh.height),Eh&&(this.blendMode="source-over"))}copyWorldByReset($h,Lh,Sh,Eh,Gh,Ah){this.resetTransform(),this.copyWorld($h,Lh,Sh,Eh,Ah),Gh||this.useWorldTransform()}useGrayscaleAlpha($h){let Lh,Sh;this.setTempPixelBounds($h,!0,!0);const{context:Eh}=this,Gh=Eh.getImageData(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),{data:Ah}=Gh;for(let Ph=0,Nh=Ah.length;Ph<Nh;Ph+=4)Sh=.299*Ah[Ph]+.587*Ah[Ph+1]+.114*Ah[Ph+2],(Lh=Ah[Ph+3])&&(Ah[Ph+3]=Lh===255?Sh:Lh*(Sh/255));Eh.putImageData(Gh,Pe$2.x,Pe$2.y)}useMask($h,Lh,Sh){this.copyWorld($h,Lh,Sh,"destination-in")}useEraser($h,Lh,Sh){this.copyWorld($h,Lh,Sh,"destination-out")}fillWorld($h,Lh,Sh,Eh){Sh&&(this.blendMode=Sh),this.fillStyle=Lh,this.setTempPixelBounds($h,Eh),this.fillRect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),Sh&&(this.blendMode="source-over")}strokeWorld($h,Lh,Sh,Eh){Sh&&(this.blendMode=Sh),this.strokeStyle=Lh,this.setTempPixelBounds($h,Eh),this.strokeRect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),Sh&&(this.blendMode="source-over")}clipWorld($h,Lh=!0){this.beginPath(),this.setTempPixelBounds($h,Lh),this.rect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),this.clip()}clipUI($h){$h.windingRule?this.clip($h.windingRule):this.clip()}clearWorld($h,Lh=!0){this.setTempPixelBounds($h,Lh),this.clearRect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height)}clear(){const{pixelRatio:$h}=this;this.clearRect(0,0,this.width*$h+2,this.height*$h+2)}setTempPixelBounds($h,Lh,Sh){this.copyToPixelBounds(Pe$2,$h,Lh,Sh)}setTempPixelBounds2($h,Lh,Sh){this.copyToPixelBounds(Se$2,$h,Lh,Sh)}copyToPixelBounds($h,Lh,Sh,Eh){$h.set(Lh),Eh&&$h.intersect(this.bounds),$h.scale(this.pixelRatio),Sh&&$h.ceil()}isSameSize($h){return this.width===$h.width&&this.height===$h.height&&(!$h.pixelRatio||this.pixelRatio===$h.pixelRatio)}getSameCanvas($h,Lh){const{size:Sh,pixelSnap:Eh}=this,Gh=this.manager?this.manager.get(Sh):le$2.canvas(Object.assign({},Sh));return Gh.save(),$h&&(ke$2(Gh.worldTransform,this.worldTransform),Gh.useWorldTransform()),Lh&&(Gh.smooth=this.smooth),Gh.pixelSnap!==Eh&&(Gh.pixelSnap=Eh),Gh}recycle($h){this.recycled||(this.restore(),$h?this.clearWorld($h):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender($h){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}};const Ie$2={creator:{},parse($h,Lh){},convertToCanvasData($h,Lh){}},Me$2={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Ae$2=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Me$2),We$2={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},Ne$2={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},Ye$2=Object.assign(Object.assign({},Ne$2),Me$2),De$2=Ae$2,Xe$2={};for(let $h in De$2)Xe$2[De$2[$h]]=$h;const ze$2={};for(let $h in De$2)ze$2[De$2[$h]]=We$2[$h];const Fe$2={drawRoundRect($h,Lh,Sh,Eh,Gh,Ah){const Ph=I$1.fourNumber(Ah,Math.min(Eh/2,Gh/2)),Nh=Lh+Eh,Mh=Sh+Gh;Ph[0]?$h.moveTo(Lh+Ph[0],Sh):$h.moveTo(Lh,Sh),Ph[1]?$h.arcTo(Nh,Sh,Nh,Mh,Ph[1]):$h.lineTo(Nh,Sh),Ph[2]?$h.arcTo(Nh,Mh,Lh,Mh,Ph[2]):$h.lineTo(Nh,Mh),Ph[3]?$h.arcTo(Lh,Mh,Lh,Sh,Ph[3]):$h.lineTo(Lh,Mh),Ph[0]?$h.arcTo(Lh,Sh,Nh,Sh,Ph[0]):$h.lineTo(Lh,Sh)}},{sin:Ue$2,cos:je$2,hypot:Ve$2,atan2:He$2,ceil:Ge$2,abs:qe$2,PI:Qe$2,sqrt:Je$2,pow:Ze$2}=Math,{setPoint:$e$2,addPoint:Ke$2}=gt$2,{set:ts$1,toNumberPoints:es$1}=ot$2,{M:ss$1,L:rs$1,C:is$1,Q:ns$1,Z:os$1}=Ae$2,as$1={},hs={points($h,Lh,Sh,Eh){let Gh=es$1(Lh);if($h.push(ss$1,Gh[0],Gh[1]),Sh&&Gh.length>5){let Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh,Uh,Yh,Xh,jh,qh,Kh=Gh.length;const Zh=Sh===!0?.5:Sh;Eh&&(Gh=[Gh[Kh-2],Gh[Kh-1],...Gh,Gh[0],Gh[1],Gh[2],Gh[3]],Kh=Gh.length);for(let il=2;il<Kh-2;il+=2)Ah=Gh[il-2],Ph=Gh[il-1],Nh=Gh[il],Mh=Gh[il+1],Dh=Gh[il+2],Fh=Gh[il+3],Uh=Nh-Ah,Yh=Mh-Ph,Xh=Je$2(Ze$2(Uh,2)+Ze$2(Yh,2)),jh=Je$2(Ze$2(Dh-Nh,2)+Ze$2(Fh-Mh,2)),(Xh||jh)&&(qh=Xh+jh,Xh=Zh*Xh/qh,jh=Zh*jh/qh,Dh-=Ah,Fh-=Ph,Ih=Nh-Xh*Dh,Hh=Mh-Xh*Fh,il===2?Eh||$h.push(ns$1,Ih,Hh,Nh,Mh):(Uh||Yh)&&$h.push(is$1,Wh,zh,Ih,Hh,Nh,Mh),Wh=Nh+jh*Dh,zh=Mh+jh*Fh);Eh||$h.push(ns$1,Wh,zh,Gh[Kh-2],Gh[Kh-1])}else for(let Ah=2,Ph=Gh.length;Ah<Ph;Ah+=2)$h.push(rs$1,Gh[Ah],Gh[Ah+1]);Eh&&$h.push(os$1)},rect($h,Lh,Sh,Eh,Gh){Ie$2.creator.path=$h,Ie$2.creator.moveTo(Lh,Sh).lineTo(Lh+Eh,Sh).lineTo(Lh+Eh,Sh+Gh).lineTo(Lh,Sh+Gh).lineTo(Lh,Sh)},roundRect($h,Lh,Sh,Eh,Gh,Ah){Ie$2.creator.path=[],Fe$2.drawRoundRect(Ie$2.creator,Lh,Sh,Eh,Gh,Ah),$h.push(...Ie$2.convertToCanvasData(Ie$2.creator.path,!0))},arcTo($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh){const Ih=Eh-Lh,Hh=Gh-Sh,Wh=Ah-Eh,zh=Ph-Gh;let Uh=He$2(Hh,Ih),Yh=He$2(zh,Wh);const Xh=Ve$2(Ih,Hh),jh=Ve$2(Wh,zh);let qh=Yh-Uh;if(qh<0&&(qh+=W$1),Xh<1e-12||jh<1e-12||qh<1e-12||qe$2(qh-Qe$2)<1e-12)return $h&&$h.push(rs$1,Eh,Gh),Mh&&($e$2(Mh,Lh,Sh),Ke$2(Mh,Eh,Gh)),Fh&&ts$1(Fh,Lh,Sh),void(Dh&&ts$1(Dh,Eh,Gh));const Kh=Ih*zh-Wh*Hh<0,Zh=Kh?-1:1,il=Nh/je$2(qh/2),Jh=Eh+il*je$2(Uh+qh/2+N$1*Zh),Qh=Gh+il*Ue$2(Uh+qh/2+N$1*Zh);return Uh-=N$1*Zh,Yh-=N$1*Zh,cs($h,Jh,Qh,Nh,Nh,0,Uh/A,Yh/A,Kh,Mh,Dh,Fh)},arc:($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh)=>cs($h,Lh,Sh,Eh,Eh,0,Gh,Ah,Ph,Nh,Mh,Dh),ellipse($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih){const Hh=Ah*A,Wh=Ue$2(Hh),zh=je$2(Hh);let Uh=Ph*A,Yh=Nh*A;Uh>Qe$2&&(Uh-=W$1),Yh<0&&(Yh+=W$1);let Xh=Yh-Uh;Xh<0?Xh+=W$1:Xh>W$1&&(Xh-=W$1),Mh&&(Xh-=W$1);const jh=Ge$2(qe$2(Xh/N$1)),qh=Xh/jh,Kh=Ue$2(qh/4),Zh=8/3*Kh*Kh/Ue$2(qh/2);Yh=Uh+qh;let il,Jh,Qh,el,nl,Vh,sl,rl,ol=je$2(Uh),ll=Ue$2(Uh),ul=Qh=zh*Eh*ol-Wh*Gh*ll,cl=el=Wh*Eh*ol+zh*Gh*ll,dl=Lh+Qh,_l=Sh+el;$h&&$h.push($h.length?rs$1:ss$1,dl,_l),Dh&&$e$2(Dh,dl,_l),Ih&&ts$1(Ih,dl,_l);for(let pl=0;pl<jh;pl++)il=je$2(Yh),Jh=Ue$2(Yh),Qh=zh*Eh*il-Wh*Gh*Jh,el=Wh*Eh*il+zh*Gh*Jh,nl=Lh+ul-Zh*(zh*Eh*ll+Wh*Gh*ol),Vh=Sh+cl-Zh*(Wh*Eh*ll-zh*Gh*ol),sl=Lh+Qh+Zh*(zh*Eh*Jh+Wh*Gh*il),rl=Sh+el+Zh*(Wh*Eh*Jh-zh*Gh*il),$h&&$h.push(is$1,nl,Vh,sl,rl,Lh+Qh,Sh+el),Dh&&ds(Lh+ul,Sh+cl,nl,Vh,sl,rl,Lh+Qh,Sh+el,Dh,!0),ul=Qh,cl=el,ol=il,ll=Jh,Uh=Yh,Yh+=qh;Fh&&ts$1(Fh,Lh+Qh,Sh+el)},quadraticCurveTo($h,Lh,Sh,Eh,Gh,Ah,Ph){$h.push(is$1,(Lh+2*Eh)/3,(Sh+2*Gh)/3,(Ah+2*Eh)/3,(Ph+2*Gh)/3,Ah,Ph)},toTwoPointBoundsByQuadraticCurve($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh){ds($h,Lh,($h+2*Sh)/3,(Lh+2*Eh)/3,(Gh+2*Sh)/3,(Ah+2*Eh)/3,Gh,Ah,Ph,Nh)},toTwoPointBounds($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh){const Fh=[];let Ih,Hh,Wh,zh,Uh,Yh,Xh,jh,qh=$h,Kh=Sh,Zh=Gh,il=Ph;for(let Jh=0;Jh<2;++Jh)if(Jh==1&&(qh=Lh,Kh=Eh,Zh=Ah,il=Nh),Ih=-3*qh+9*Kh-9*Zh+3*il,Hh=6*qh-12*Kh+6*Zh,Wh=3*Kh-3*qh,Math.abs(Ih)<1e-12){if(Math.abs(Hh)<1e-12)continue;zh=-Wh/Hh,0<zh&&zh<1&&Fh.push(zh)}else Xh=Hh*Hh-4*Wh*Ih,jh=Math.sqrt(Xh),Xh<0||(Uh=(-Hh+jh)/(2*Ih),0<Uh&&Uh<1&&Fh.push(Uh),Yh=(-Hh-jh)/(2*Ih),0<Yh&&Yh<1&&Fh.push(Yh));Dh?Ke$2(Mh,$h,Lh):$e$2(Mh,$h,Lh),Ke$2(Mh,Ph,Nh);for(let Jh=0,Qh=Fh.length;Jh<Qh;Jh++)ls(Fh[Jh],$h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,as$1),Ke$2(Mh,as$1.x,as$1.y)},getPointAndSet($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh){const Fh=1-$h,Ih=Fh*Fh*Fh,Hh=3*Fh*Fh*$h,Wh=3*Fh*$h*$h,zh=$h*$h*$h;Dh.x=Ih*Lh+Hh*Eh+Wh*Ah+zh*Nh,Dh.y=Ih*Sh+Hh*Gh+Wh*Ph+zh*Mh},getPoint($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh){const Dh={};return ls($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh),Dh},getDerivative($h,Lh,Sh,Eh,Gh){const Ah=1-$h;return 3*Ah*Ah*(Sh-Lh)+6*Ah*$h*(Eh-Sh)+3*$h*$h*(Gh-Eh)}},{getPointAndSet:ls,toTwoPointBounds:ds,ellipse:cs}=hs,{sin:us,cos:_s,sqrt:ps,atan2:fs}=Math,{ellipse:gs}=hs,ys={ellipticalArc($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh){const Ih=(Mh-Lh)/2,Hh=(Dh-Sh)/2,Wh=Ah*A,zh=us(Wh),Uh=_s(Wh),Yh=-Uh*Ih-zh*Hh,Xh=-Uh*Hh+zh*Ih,jh=Eh*Eh,qh=Gh*Gh,Kh=Xh*Xh,Zh=Yh*Yh,il=jh*qh-jh*Kh-qh*Zh;let Jh=0;if(il<0){const ul=ps(1-il/(jh*qh));Eh*=ul,Gh*=ul}else Jh=(Ph===Nh?-1:1)*ps(il/(jh*Kh+qh*Zh));const Qh=Jh*Eh*Xh/Gh,el=-Jh*Gh*Yh/Eh,nl=fs((Xh-el)/Gh,(Yh-Qh)/Eh),Vh=fs((-Xh-el)/Gh,(-Yh-Qh)/Eh);let sl=Vh-nl;Nh===0&&sl>0?sl-=W$1:Nh===1&&sl<0&&(sl+=W$1);const rl=Lh+Ih+Uh*Qh-zh*el,ol=Sh+Hh+zh*Qh+Uh*el,ll=sl<0?1:0;Fh||$t$2.ellipseToCurve?gs($h,rl,ol,Eh,Gh,Ah,nl/A,Vh/A,ll):Eh!==Gh||Ah?$h.push(Ae$2.G,rl,ol,Eh,Gh,Ah,nl/A,Vh/A,ll):$h.push(Ae$2.O,rl,ol,Eh,nl/A,Vh/A,ll)}},ms={toCommand:$h=>[],toNode:$h=>[]},{M:xs,m:ws,L:bs,l:Bs,H:vs,h:ks,V:Cs,v:Os,C:Ts,c:Ps,S:Ss,s:Ls,Q:Rs,q:Es,T:Is,t:Ms,A:As,a:Ws,Z:Ns,z:Ys,N:Ds,D:Xs,X:zs,G:Fs,F:Us,O:js,P:Vs,U:Hs}=Ae$2,{rect:Gs,roundRect:qs,arcTo:Qs,arc:Js,ellipse:Zs,quadraticCurveTo:$s}=hs,{ellipticalArc:Ks}=ys,tr=ee$2.get("PathConvert"),er={},sr={current:{dot:0},stringify($h,Lh){let Sh,Eh,Gh,Ah=0,Ph=$h.length,Nh="";for(;Ah<Ph;){Eh=$h[Ah],Sh=ze$2[Eh],Nh+=Eh===Gh?" ":Xe$2[Eh];for(let Mh=1;Mh<Sh;Mh++)Nh+=I$1.float($h[Ah+Mh],Lh),Mh===Sh-1||(Nh+=" ");Gh=Eh,Ah+=Sh}return Nh},parse($h,Lh){let Sh,Eh,Gh,Ah="";const Ph=[],Nh=Lh?Ye$2:Ne$2;for(let Mh=0,Dh=$h.length;Mh<Dh;Mh++)Eh=$h[Mh],Qt$2[Eh]?(Eh==="."&&(rr.dot&&(ir(Ph,Ah),Ah=""),rr.dot++),Ah==="0"&&Eh!=="."&&(ir(Ph,Ah),Ah=""),Ah+=Eh):Ae$2[Eh]?(Ah&&(ir(Ph,Ah),Ah=""),rr.name=Ae$2[Eh],rr.length=We$2[Eh],rr.index=0,ir(Ph,rr.name),!Sh&&Nh[Eh]&&(Sh=!0)):Eh==="-"||Eh==="+"?Gh==="e"||Gh==="E"?Ah+=Eh:(Ah&&ir(Ph,Ah),Ah=Eh):Ah&&(ir(Ph,Ah),Ah=""),Gh=Eh;return Ah&&ir(Ph,Ah),Sh?sr.toCanvasData(Ph,Lh):Ph},toCanvasData($h,Lh){let Sh,Eh,Gh,Ah,Ph,Nh=0,Mh=0,Dh=0,Fh=0,Ih=0,Hh=$h.length;const Wh=[];for(;Ih<Hh;){switch(Gh=$h[Ih],Gh){case ws:$h[Ih+1]+=Nh,$h[Ih+2]+=Mh;case xs:Nh=$h[Ih+1],Mh=$h[Ih+2],Wh.push(xs,Nh,Mh),Ih+=3;break;case ks:$h[Ih+1]+=Nh;case vs:Nh=$h[Ih+1],Wh.push(bs,Nh,Mh),Ih+=2;break;case Os:$h[Ih+1]+=Mh;case Cs:Mh=$h[Ih+1],Wh.push(bs,Nh,Mh),Ih+=2;break;case Bs:$h[Ih+1]+=Nh,$h[Ih+2]+=Mh;case bs:Nh=$h[Ih+1],Mh=$h[Ih+2],Wh.push(bs,Nh,Mh),Ih+=3;break;case Ls:$h[Ih+1]+=Nh,$h[Ih+2]+=Mh,$h[Ih+3]+=Nh,$h[Ih+4]+=Mh,Gh=Ss;case Ss:Ph=Ah===Ts||Ah===Ss,Dh=Ph?2*Nh-Sh:$h[Ih+1],Fh=Ph?2*Mh-Eh:$h[Ih+2],Sh=$h[Ih+1],Eh=$h[Ih+2],Nh=$h[Ih+3],Mh=$h[Ih+4],Wh.push(Ts,Dh,Fh,Sh,Eh,Nh,Mh),Ih+=5;break;case Ps:$h[Ih+1]+=Nh,$h[Ih+2]+=Mh,$h[Ih+3]+=Nh,$h[Ih+4]+=Mh,$h[Ih+5]+=Nh,$h[Ih+6]+=Mh,Gh=Ts;case Ts:Sh=$h[Ih+3],Eh=$h[Ih+4],Nh=$h[Ih+5],Mh=$h[Ih+6],Wh.push(Ts,$h[Ih+1],$h[Ih+2],Sh,Eh,Nh,Mh),Ih+=7;break;case Ms:$h[Ih+1]+=Nh,$h[Ih+2]+=Mh,Gh=Is;case Is:Ph=Ah===Rs||Ah===Is,Sh=Ph?2*Nh-Sh:$h[Ih+1],Eh=Ph?2*Mh-Eh:$h[Ih+2],Lh?$s(Wh,Nh,Mh,Sh,Eh,$h[Ih+1],$h[Ih+2]):Wh.push(Rs,Sh,Eh,$h[Ih+1],$h[Ih+2]),Nh=$h[Ih+1],Mh=$h[Ih+2],Ih+=3;break;case Es:$h[Ih+1]+=Nh,$h[Ih+2]+=Mh,$h[Ih+3]+=Nh,$h[Ih+4]+=Mh,Gh=Rs;case Rs:Sh=$h[Ih+1],Eh=$h[Ih+2],Lh?$s(Wh,Nh,Mh,Sh,Eh,$h[Ih+3],$h[Ih+4]):Wh.push(Rs,Sh,Eh,$h[Ih+3],$h[Ih+4]),Nh=$h[Ih+3],Mh=$h[Ih+4],Ih+=5;break;case Ws:$h[Ih+6]+=Nh,$h[Ih+7]+=Mh;case As:Ks(Wh,Nh,Mh,$h[Ih+1],$h[Ih+2],$h[Ih+3],$h[Ih+4],$h[Ih+5],$h[Ih+6],$h[Ih+7],Lh),Nh=$h[Ih+6],Mh=$h[Ih+7],Ih+=8;break;case Ys:case Ns:Wh.push(Ns),Ih++;break;case Ds:Nh=$h[Ih+1],Mh=$h[Ih+2],Lh?Gs(Wh,Nh,Mh,$h[Ih+3],$h[Ih+4]):nr(Wh,$h,Ih,5),Ih+=5;break;case Xs:Nh=$h[Ih+1],Mh=$h[Ih+2],Lh?qs(Wh,Nh,Mh,$h[Ih+3],$h[Ih+4],[$h[Ih+5],$h[Ih+6],$h[Ih+7],$h[Ih+8]]):nr(Wh,$h,Ih,9),Ih+=9;break;case zs:Nh=$h[Ih+1],Mh=$h[Ih+2],Lh?qs(Wh,Nh,Mh,$h[Ih+3],$h[Ih+4],$h[Ih+5]):nr(Wh,$h,Ih,6),Ih+=6;break;case Fs:Zs(Lh?Wh:nr(Wh,$h,Ih,9),$h[Ih+1],$h[Ih+2],$h[Ih+3],$h[Ih+4],$h[Ih+5],$h[Ih+6],$h[Ih+7],$h[Ih+8],null,er),Nh=er.x,Mh=er.y,Ih+=9;break;case Us:Lh?Zs(Wh,$h[Ih+1],$h[Ih+2],$h[Ih+3],$h[Ih+4],0,0,360,!1):nr(Wh,$h,Ih,5),Nh=$h[Ih+1]+$h[Ih+3],Mh=$h[Ih+2],Ih+=5;break;case js:Js(Lh?Wh:nr(Wh,$h,Ih,7),$h[Ih+1],$h[Ih+2],$h[Ih+3],$h[Ih+4],$h[Ih+5],$h[Ih+6],null,er),Nh=er.x,Mh=er.y,Ih+=7;break;case Vs:Lh?Js(Wh,$h[Ih+1],$h[Ih+2],$h[Ih+3],0,360,!1):nr(Wh,$h,Ih,4),Nh=$h[Ih+1]+$h[Ih+3],Mh=$h[Ih+2],Ih+=4;break;case Hs:Qs(Lh?Wh:nr(Wh,$h,Ih,6),Nh,Mh,$h[Ih+1],$h[Ih+2],$h[Ih+3],$h[Ih+4],$h[Ih+5],null,er),Nh=er.x,Mh=er.y,Ih+=6;break;default:return tr.error(`command: ${Gh} [index:${Ih}]`,$h),Wh}Ah=Gh}return Wh},objectToCanvasData($h){if($h[0].name.length>1)return ms.toCommand($h);{const Lh=[];return $h.forEach(Sh=>{switch(Sh.name){case"M":Lh.push(xs,Sh.x,Sh.y);break;case"L":Lh.push(bs,Sh.x,Sh.y);break;case"C":Lh.push(Ts,Sh.x1,Sh.y1,Sh.x2,Sh.y2,Sh.x,Sh.y);break;case"Q":Lh.push(Rs,Sh.x1,Sh.y1,Sh.x,Sh.y);break;case"Z":Lh.push(Ns)}}),Lh}},copyData($h,Lh,Sh,Eh){for(let Gh=Sh,Ah=Sh+Eh;Gh<Ah;Gh++)$h.push(Lh[Gh])},pushData($h,Lh){rr.index===rr.length&&(rr.index=1,$h.push(rr.name)),$h.push(Number(Lh)),rr.index++,rr.dot=0}},{current:rr,pushData:ir,copyData:nr}=sr,{M:or,L:ar,C:hr,Q:lr,Z:dr,N:cr,D:ur,X:_r,G:pr,F:fr,O:gr,P:yr,U:mr}=Ae$2,{getMinDistanceFrom:xr,getRadianFrom:wr}=ot$2,{tan:br,min:Br,abs:vr}=Math,kr={},Cr={beginPath($h){$h.length=0},moveTo($h,Lh,Sh){$h.push(or,Lh,Sh)},lineTo($h,Lh,Sh){$h.push(ar,Lh,Sh)},bezierCurveTo($h,Lh,Sh,Eh,Gh,Ah,Ph){$h.push(hr,Lh,Sh,Eh,Gh,Ah,Ph)},quadraticCurveTo($h,Lh,Sh,Eh,Gh){$h.push(lr,Lh,Sh,Eh,Gh)},closePath($h){$h.push(dr)},rect($h,Lh,Sh,Eh,Gh){$h.push(cr,Lh,Sh,Eh,Gh)},roundRect($h,Lh,Sh,Eh,Gh,Ah){if(o(Ah))$h.push(_r,Lh,Sh,Eh,Gh,Ah);else{const Ph=I$1.fourNumber(Ah);Ph?$h.push(ur,Lh,Sh,Eh,Gh,...Ph):$h.push(cr,Lh,Sh,Eh,Gh)}},ellipse($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh){if(Eh===Gh)return Tr($h,Lh,Sh,Eh,Ph,Nh,Mh);r(Ah)?$h.push(fr,Lh,Sh,Eh,Gh):(r(Ph)&&(Ph=0),r(Nh)&&(Nh=360),$h.push(pr,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh?1:0))},arc($h,Lh,Sh,Eh,Gh,Ah,Ph){r(Gh)?$h.push(yr,Lh,Sh,Eh):(r(Gh)&&(Gh=0),r(Ah)&&(Ah=360),$h.push(gr,Lh,Sh,Eh,Gh,Ah,Ph?1:0))},arcTo($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh){if(!s(Ph)){const Dh=xr(Ph,Nh,Lh,Sh,Eh,Gh)/(Mh?1:2);Ah=Br(Ah,Br(Dh,Dh*vr(br(wr(Ph,Nh,Lh,Sh,Eh,Gh)/2))))}$h.push(mr,Lh,Sh,Eh,Gh,Ah)},drawEllipse($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh){hs.ellipse(null,Lh,Sh,Eh,Gh,r(Ah)?0:Ah,r(Ph)?0:Ph,r(Nh)?360:Nh,Mh,null,null,kr),$h.push(or,kr.x,kr.y),Or($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh)},drawArc($h,Lh,Sh,Eh,Gh,Ah,Ph){hs.arc(null,Lh,Sh,Eh,r(Gh)?0:Gh,r(Ah)?360:Ah,Ph,null,null,kr),$h.push(or,kr.x,kr.y),Tr($h,Lh,Sh,Eh,Gh,Ah,Ph)},drawPoints($h,Lh,Sh,Eh){hs.points($h,Lh,Sh,Eh)}},{ellipse:Or,arc:Tr}=Cr,{moveTo:Pr,lineTo:Sr,quadraticCurveTo:Lr,bezierCurveTo:Rr,closePath:Er,beginPath:Ir,rect:Mr,roundRect:Ar,ellipse:Wr,arc:Nr,arcTo:Yr,drawEllipse:Dr,drawArc:Xr,drawPoints:zr}=Cr;class Fr{set path(Lh){this.__path=Lh}get path(){return this.__path}constructor(Lh){this.set(Lh)}set(Lh){return this.__path=Lh?i(Lh)?Ie$2.parse(Lh):Lh:[],this}beginPath(){return Ir(this.__path),this.paint(),this}moveTo(Lh,Sh){return Pr(this.__path,Lh,Sh),this.paint(),this}lineTo(Lh,Sh){return Sr(this.__path,Lh,Sh),this.paint(),this}bezierCurveTo(Lh,Sh,Eh,Gh,Ah,Ph){return Rr(this.__path,Lh,Sh,Eh,Gh,Ah,Ph),this.paint(),this}quadraticCurveTo(Lh,Sh,Eh,Gh){return Lr(this.__path,Lh,Sh,Eh,Gh),this.paint(),this}closePath(){return Er(this.__path),this.paint(),this}rect(Lh,Sh,Eh,Gh){return Mr(this.__path,Lh,Sh,Eh,Gh),this.paint(),this}roundRect(Lh,Sh,Eh,Gh,Ah){return Ar(this.__path,Lh,Sh,Eh,Gh,Ah),this.paint(),this}ellipse(Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh){return Wr(this.__path,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh),this.paint(),this}arc(Lh,Sh,Eh,Gh,Ah,Ph){return Nr(this.__path,Lh,Sh,Eh,Gh,Ah,Ph),this.paint(),this}arcTo(Lh,Sh,Eh,Gh,Ah){return Yr(this.__path,Lh,Sh,Eh,Gh,Ah),this.paint(),this}drawEllipse(Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh){return Dr(this.__path,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh),this.paint(),this}drawArc(Lh,Sh,Eh,Gh,Ah,Ph){return Xr(this.__path,Lh,Sh,Eh,Gh,Ah,Ph),this.paint(),this}drawPoints(Lh,Sh,Eh){return zr(this.__path,Lh,Sh,Eh),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:Ur,L:jr,C:Vr,Q:Hr,Z:Gr,N:qr,D:Qr,X:Jr,G:Zr,F:$r,O:Kr,P:ti$2,U:ei$2}=Ae$2,si$2=ee$2.get("PathDrawer"),ri$2={drawPathByData($h,Lh){if(!Lh)return;let Sh,Eh=0,Gh=Lh.length;for(;Eh<Gh;)switch(Sh=Lh[Eh],Sh){case Ur:$h.moveTo(Lh[Eh+1],Lh[Eh+2]),Eh+=3;break;case jr:$h.lineTo(Lh[Eh+1],Lh[Eh+2]),Eh+=3;break;case Vr:$h.bezierCurveTo(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],Lh[Eh+4],Lh[Eh+5],Lh[Eh+6]),Eh+=7;break;case Hr:$h.quadraticCurveTo(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],Lh[Eh+4]),Eh+=5;break;case Gr:$h.closePath(),Eh+=1;break;case qr:$h.rect(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],Lh[Eh+4]),Eh+=5;break;case Qr:$h.roundRect(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],Lh[Eh+4],[Lh[Eh+5],Lh[Eh+6],Lh[Eh+7],Lh[Eh+8]]),Eh+=9;break;case Jr:$h.roundRect(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],Lh[Eh+4],Lh[Eh+5]),Eh+=6;break;case Zr:$h.ellipse(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],Lh[Eh+4],Lh[Eh+5]*A,Lh[Eh+6]*A,Lh[Eh+7]*A,Lh[Eh+8]),Eh+=9;break;case $r:$h.ellipse(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],Lh[Eh+4],0,0,W$1,!1),Eh+=5;break;case Kr:$h.arc(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],Lh[Eh+4]*A,Lh[Eh+5]*A,Lh[Eh+6]),Eh+=7;break;case ti$2:$h.arc(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],0,W$1,!1),Eh+=4;break;case ei$2:$h.arcTo(Lh[Eh+1],Lh[Eh+2],Lh[Eh+3],Lh[Eh+4],Lh[Eh+5]),Eh+=6;break;default:return void si$2.error(`command: ${Sh} [index:${Eh}]`,Lh)}}},{M:ii$2,L:ni$2,C:oi$2,Q:ai$2,Z:hi$2,N:li$2,D:di$2,X:ci$1,G:ui$1,F:_i$2,O:pi$1,P:fi$1,U:gi$1}=Ae$2,{toTwoPointBounds:yi$1,toTwoPointBoundsByQuadraticCurve:mi$1,arcTo:xi$1,arc:wi$1,ellipse:bi$1}=hs,{addPointBounds:Bi$1,copy:vi$1,addPoint:ki$1,setPoint:Ci$1,addBounds:Oi$1,toBounds:Ti$1}=gt$2,Pi$1=ee$2.get("PathBounds");let Si$1,Li$1,Ri$1;const Ei$1={},Ii$1={},Mi$1={},Ai$1={toBounds($h,Lh){Ai$1.toTwoPointBounds($h,Ii$1),Ti$1(Ii$1,Lh)},toTwoPointBounds($h,Lh){if(!$h||!$h.length)return Ci$1(Lh,0,0);let Sh,Eh,Gh,Ah,Ph,Nh=0,Mh=0,Dh=0;const Fh=$h.length;for(;Nh<Fh;)switch(Ph=$h[Nh],Nh===0&&(Ph===hi$2||Ph===oi$2||Ph===ai$2?Ci$1(Lh,Mh,Dh):Ci$1(Lh,$h[Nh+1],$h[Nh+2])),Ph){case ii$2:case ni$2:Mh=$h[Nh+1],Dh=$h[Nh+2],ki$1(Lh,Mh,Dh),Nh+=3;break;case oi$2:Gh=$h[Nh+5],Ah=$h[Nh+6],yi$1(Mh,Dh,$h[Nh+1],$h[Nh+2],$h[Nh+3],$h[Nh+4],Gh,Ah,Ei$1),Bi$1(Lh,Ei$1),Mh=Gh,Dh=Ah,Nh+=7;break;case ai$2:Sh=$h[Nh+1],Eh=$h[Nh+2],Gh=$h[Nh+3],Ah=$h[Nh+4],mi$1(Mh,Dh,Sh,Eh,Gh,Ah,Ei$1),Bi$1(Lh,Ei$1),Mh=Gh,Dh=Ah,Nh+=5;break;case hi$2:Nh+=1;break;case li$2:Mh=$h[Nh+1],Dh=$h[Nh+2],Oi$1(Lh,Mh,Dh,$h[Nh+3],$h[Nh+4]),Nh+=5;break;case di$2:case ci$1:Mh=$h[Nh+1],Dh=$h[Nh+2],Oi$1(Lh,Mh,Dh,$h[Nh+3],$h[Nh+4]),Nh+=Ph===di$2?9:6;break;case ui$1:bi$1(null,$h[Nh+1],$h[Nh+2],$h[Nh+3],$h[Nh+4],$h[Nh+5],$h[Nh+6],$h[Nh+7],$h[Nh+8],Ei$1,Mi$1),Nh===0?vi$1(Lh,Ei$1):Bi$1(Lh,Ei$1),Mh=Mi$1.x,Dh=Mi$1.y,Nh+=9;break;case _i$2:Mh=$h[Nh+1],Dh=$h[Nh+2],Li$1=$h[Nh+3],Ri$1=$h[Nh+4],Oi$1(Lh,Mh-Li$1,Dh-Ri$1,2*Li$1,2*Ri$1),Mh+=Li$1,Nh+=5;break;case pi$1:wi$1(null,$h[Nh+1],$h[Nh+2],$h[Nh+3],$h[Nh+4],$h[Nh+5],$h[Nh+6],Ei$1,Mi$1),Nh===0?vi$1(Lh,Ei$1):Bi$1(Lh,Ei$1),Mh=Mi$1.x,Dh=Mi$1.y,Nh+=7;break;case fi$1:Mh=$h[Nh+1],Dh=$h[Nh+2],Si$1=$h[Nh+3],Oi$1(Lh,Mh-Si$1,Dh-Si$1,2*Si$1,2*Si$1),Mh+=Si$1,Nh+=4;break;case gi$1:xi$1(null,Mh,Dh,$h[Nh+1],$h[Nh+2],$h[Nh+3],$h[Nh+4],$h[Nh+5],Ei$1,Mi$1),Nh===0?vi$1(Lh,Ei$1):Bi$1(Lh,Ei$1),Mh=Mi$1.x,Dh=Mi$1.y,Nh+=6;break;default:return void Pi$1.error(`command: ${Ph} [index:${Nh}]`,$h)}}},{M:Wi$1,L:Ni$1,Z:Yi$1}=Ae$2,{getCenterX:Di$1,getCenterY:Xi$1}=ot$2,{arcTo:zi$1}=Cr,Fi$1={smooth($h,Lh,Sh){let Eh,Gh,Ah,Ph=0,Nh=0,Mh=0,Dh=0,Fh=0,Ih=0,Hh=0,Wh=0,zh=0;l(Lh)&&(Lh=Lh[0]||0);const Uh=$h.length,Yh=Uh===9,Xh=[];for(;Ph<Uh;){switch(Eh=$h[Ph],Eh){case Wi$1:Dh=Wh=$h[Ph+1],Fh=zh=$h[Ph+2],Ph+=3,$h[Ph]===Ni$1?(Ih=$h[Ph+1],Hh=$h[Ph+2],Yh?Xh.push(Wi$1,Dh,Fh):Xh.push(Wi$1,Di$1(Dh,Ih),Xi$1(Fh,Hh))):Xh.push(Wi$1,Dh,Fh);break;case Ni$1:switch(Nh=$h[Ph+1],Mh=$h[Ph+2],Ph+=3,$h[Ph]){case Ni$1:zi$1(Xh,Nh,Mh,$h[Ph+1],$h[Ph+2],Lh,Wh,zh,Yh);break;case Yi$1:zi$1(Xh,Nh,Mh,Dh,Fh,Lh,Wh,zh,Yh);break;default:Xh.push(Ni$1,Nh,Mh)}Wh=Nh,zh=Mh;break;case Yi$1:Gh!==Yi$1&&(zi$1(Xh,Dh,Fh,Ih,Hh,Lh,Wh,zh,Yh),Xh.push(Yi$1)),Ph+=1;break;default:Ah=ze$2[Eh];for(let jh=0;jh<Ah;jh++)Xh.push($h[Ph+jh]);Ph+=Ah}Gh=Eh}return Eh!==Yi$1&&(Xh[1]=Dh,Xh[2]=Fh),Xh}};function Ui$1($h){return new Fr($h)}const ji$1=Ui$1();Ie$2.creator=Ui$1(),Ie$2.parse=sr.parse,Ie$2.convertToCanvasData=sr.toCanvasData;const{drawRoundRect:Vi$1}=Fe$2;function Hi$1($h){(function(Lh){Lh&&!Lh.roundRect&&(Lh.roundRect=function(Sh,Eh,Gh,Ah,Ph){Vi$1(this,Sh,Eh,Gh,Ah,Ph)})})($h)}const Gi$1={alphaPixelTypes:["png","webp","svg"],upperCaseTypeMap:{},mimeType:($h,Lh="image")=>!$h||$h.startsWith(Lh)?$h:($h==="jpg"&&($h="jpeg"),Lh+"/"+$h),fileType($h){const Lh=$h.split(".");return Lh[Lh.length-1]},isOpaqueImage($h){const Lh=qi$1.fileType($h);return["jpg","jpeg"].some(Sh=>Sh===Lh)},getExportOptions($h){switch(typeof $h){case"object":return $h;case"number":return{quality:$h};case"boolean":return{blob:$h};default:return{}}}},qi$1=Gi$1;qi$1.mineType=qi$1.mimeType,qi$1.alphaPixelTypes.forEach($h=>qi$1.upperCaseTypeMap[$h]=$h.toUpperCase());const Qi$1=ee$2.get("TaskProcessor");let Ji$1=class{constructor($h){this.parallel=!0,this.time=1,this.id=g.create(g.TASK),this.task=$h}run(){return me$2(this,void 0,void 0,function*(){try{if(this.isComplete||this.runing)return;if(this.runing=!0,this.canUse&&!this.canUse())return this.cancel();this.task&&(yield this.task())}catch($h){Qi$1.error($h)}})}complete(){this.isComplete=!0,this.parent=this.task=this.canUse=null}cancel(){this.isCancel=!0,this.complete()}},Zi$1=class{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:$h}=this;let Lh=0,Sh=0;for(let Eh=0;Eh<$h;Eh++)Eh<=this.finishedIndex?(Sh+=this.list[Eh].time,Eh===this.finishedIndex&&(Lh=Sh)):Lh+=this.list[Eh].time;return this.isComplete?1:Sh/Lh}constructor($h){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,$h&&_.assign(this.config,$h),this.empty()}add($h,Lh,Sh){let Eh,Gh,Ah,Ph;const Nh=new Ji$1($h);return Nh.parent=this,o(Lh)?Ph=Lh:Lh&&(Gh=Lh.parallel,Eh=Lh.start,Ah=Lh.time,Ph=Lh.delay,Sh||(Sh=Lh.canUse)),Ah&&(Nh.time=Ah),Gh===!1&&(Nh.parallel=!1),Sh&&(Nh.canUse=Sh),s(Ph)?this.push(Nh,Eh):(this.delayNumber++,setTimeout(()=>{this.delayNumber&&(this.delayNumber--,this.push(Nh,Eh))},Ph)),this.isComplete=!1,Nh}push($h,Lh){this.list.push($h),Lh===!1||this.timer||(this.timer=setTimeout(()=>this.start()))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach($h=>{$h.isComplete||$h.run()}),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const $h=this.list[this.index];$h?$h.run().then(()=>{this.onTask($h),this.index++,$h.isCancel?this.runTask():this.nextTask()}).catch(Lh=>{this.onError(Lh)}):this.timer=setTimeout(()=>this.nextTask())}runParallelTasks(){this.parallelList.forEach($h=>this.runParallelTask($h))}runParallelTask($h){$h.run().then(()=>{this.onTask($h),this.fillParallelTask()}).catch(Lh=>{this.onParallelError(Lh)})}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout(()=>this.run())}setParallelList(){let $h;const{config:Lh,list:Sh,index:Eh}=this;this.parallelList=[],this.parallelSuccessNumber=0;let Gh=Eh+Lh.parallel;if(Gh>Sh.length&&(Gh=Sh.length),Lh.parallel>1)for(let Ah=Eh;Ah<Gh&&($h=Sh[Ah],$h.parallel);Ah++)this.parallelList.push($h)}fillParallelTask(){let $h;const Lh=this.parallelList;this.parallelSuccessNumber++,Lh.pop();const Sh=Lh.length,Eh=this.finishedIndex+Sh;if(Lh.length){if(!this.running)return;Eh<this.total&&($h=this.list[Eh],$h&&$h.parallel&&(Lh.push($h),this.runParallelTask($h)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask($h){$h.complete(),this.config.onTask&&this.config.onTask()}onParallelError($h){this.parallelList.forEach(Lh=>{Lh.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError($h)}onError($h){this.pause(),this.config.onError&&this.config.onError($h)}destroy(){this.stop()}};const $i$1=ee$2.get("Resource"),Ki$1={tasker:new Zi$1,queue:new Zi$1({parallel:1}),map:{},get isComplete(){return tn.tasker.isComplete},set($h,Lh){tn.map[$h]&&$i$1.repeat($h),tn.map[$h]=Lh},get:$h=>tn.map[$h],remove($h){const Lh=tn.map[$h];Lh&&(Lh.destroy&&Lh.destroy(),delete tn.map[$h])},loadImage($h,Lh){return new Promise((Sh,Eh)=>{const Gh=this.setImage($h,$h,Lh);Gh.load(()=>Sh(Gh),Ah=>Eh(Ah))})},setImage($h,Lh,Sh){let Eh;return i(Lh)?Eh={url:Lh}:Lh.url||(Eh={url:$h,view:Lh}),Eh&&(Sh&&(Eh.format=Sh),Lh=le$2.image(Eh)),tn.set($h,Lh),Lh},loadFilm($h,Lh){},loadVideo($h,Lh){},destroy(){tn.map={}}},tn=Ki$1,en={maxRecycled:10,recycledList:[],patternTasker:Ki$1.queue,get($h,Lh){let Sh=Ki$1.get($h.url);return Sh||Ki$1.set($h.url,Sh=Lh==="film"?le$2.film($h):le$2.image($h)),Sh.use++,Sh},recycle($h){$h.use--,setTimeout(()=>{$h.use||($t$2.image.isLarge($h)?$h.url&&Ki$1.remove($h.url):($h.clearLevels(),sn.recycledList.push($h)))})},recyclePaint($h){sn.recycle($h.image)},clearRecycled($h){const Lh=sn.recycledList;(Lh.length>sn.maxRecycled||$h)&&(Lh.forEach(Sh=>(!Sh.use||$h)&&Sh.url&&Ki$1.remove(Sh.url)),Lh.length=0)},clearLevels(){},hasAlphaPixel:$h=>Gi$1.alphaPixelTypes.some(Lh=>sn.isFormat(Lh,$h)),isFormat($h,Lh){if(Lh.format)return Lh.format===$h;const{url:Sh}=Lh;if(Sh.startsWith("data:")){if(Sh.startsWith("data:"+Gi$1.mimeType($h)))return!0}else if(Sh.includes("."+$h)||Sh.includes("."+Gi$1.upperCaseTypeMap[$h])||$h==="png"&&!Sh.includes("."))return!0;return!1},destroy(){this.clearRecycled(!0)}},sn=en,{IMAGE:rn,create:nn}=g;class on{get tag(){return"Image"}get url(){return this.config.url}get crossOrigin(){const{crossOrigin:Lh}=this.config;return s(Lh)?$t$2.image.crossOrigin:Lh}get completed(){return this.ready||!!this.error}constructor(Lh){if(this.use=0,this.waitComplete=[],this.innerId=nn(rn),this.config=Lh||(Lh={url:""}),Lh.view){const{view:Sh}=Lh;this.setView(Sh.config?Sh.view:Sh)}en.isFormat("svg",Lh)&&(this.isSVG=!0),en.hasAlphaPixel(Lh)&&(this.hasAlphaPixel=!0)}load(Lh,Sh,Eh){return this.loading||(this.loading=!0,Ki$1.tasker.add(()=>me$2(this,void 0,void 0,function*(){return yield $t$2.origin["load"+this.tag](this.getLoadUrl(Eh),this.crossOrigin,this).then(Gh=>{Eh&&this.setThumbView(Gh),this.setView(Gh)}).catch(Gh=>{this.error=Gh,this.onComplete(!1)})}))),this.waitComplete.push(Lh,Sh),this.waitComplete.length-2}unload(Lh,Sh){const Eh=this.waitComplete;if(Sh){const Gh=Eh[Lh+1];Gh&&Gh({type:"stop"})}Eh[Lh]=Eh[Lh+1]=void 0}setView(Lh){this.ready=!0,this.width||(this.width=Lh.width,this.height=Lh.height,this.view=Lh),this.onComplete(!0)}onComplete(Lh){let Sh;this.waitComplete.forEach((Eh,Gh)=>{Sh=Gh%2,Eh&&(Lh?Sh||Eh(this):Sh&&Eh(this.error))}),this.waitComplete.length=0,this.loading=!1}getFull(Lh){return this.view}getCanvas(Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh){if(Lh||(Lh=this.width),Sh||(Sh=this.height),this.cache){let{params:Fh,data:Ih}=this.cache;for(let Hh in Fh)if(Fh[Hh]!==arguments[Hh]){Ih=null;break}if(Ih)return Ih}const Dh=$t$2.image.resize(this.view,Lh,Sh,Ah,Ph,void 0,Nh,Eh,Gh,Mh);return this.cache=this.use>1?{data:Dh,params:arguments}:null,Dh}getPattern(Lh,Sh,Eh,Gh){const Ah=$t$2.canvas.createPattern(Lh,Sh);return $t$2.image.setPatternTransform(Ah,Eh,Gh),Ah}render(Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh){Lh.drawImage(this.view,Sh,Eh,Gh,Ah)}getLoadUrl(Lh){return this.url}setThumbView(Lh){}getThumbSize(Lh){}getMinLevel(){}getLevelData(Lh,Sh,Eh){}clearLevels(Lh){}destroy(){this.clearLevels();const{view:Lh}=this;Lh&&Lh.close&&Lh.close(),this.config={url:""},this.cache=this.view=null,this.waitComplete.length=0}}class an extends on{get tag(){return"Film"}}class hn extends on{get tag(){return"Video"}}function ln($h,Lh,Sh,Eh){Eh||(Sh.configurable=Sh.enumerable=!0),Object.defineProperty($h,Lh,Sh)}function dn($h,Lh){return Object.getOwnPropertyDescriptor($h,Lh)}function cn($h,Lh){const Sh="_"+$h;return{get(){const Eh=this[Sh];return Eh==null?Lh:Eh},set(Eh){this[Sh]=Eh}}}function un($h,Lh){return(Sh,Eh)=>pn(Sh,Eh,$h,Lh&&Lh(Eh))}function _n($h){return $h}function pn($h,Lh,Sh,Eh){ln($h,Lh,Object.assign({get(){return this.__getAttr(Lh)},set(Gh){this.__setAttr(Lh,Gh)}},Eh||{})),Un($h,Lh,Sh)}function fn($h){return un($h)}function gn($h,Lh){return un($h,Sh=>({set(Eh){this.__setAttr(Sh,Eh,Lh)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}}))}function yn($h,Lh){return un($h,Sh=>({set(Eh){this.__setAttr(Sh,Eh,Lh)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__scrollWorld||(this.__scrollWorld={}))}}))}function mn($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh)&&(this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal(),vn(this))}}))}function xn($h,Lh){return un($h,Sh=>({set(Eh){this.__setAttr(Sh,Eh,Lh)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}}))}function wn($h,Lh){return un($h,Sh=>({set(Eh){this.__setAttr(Sh,Eh,Lh)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}}))}function bn($h,Lh){return un($h,Sh=>({set(Eh){this.__setAttr(Sh,Eh,Lh)&&vn(this)}}))}function Bn($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh)&&(vn(this),this.__.__removeNaturalSize())}}))}function vn($h){$h.__layout.boxChanged||$h.__layout.boxChange(),$h.__hasAutoLayout&&($h.__layout.matrixChanged||$h.__layout.matrixChange())}function kn($h){return un($h,Lh=>({set(Sh){const Eh=this.__;Eh.__pathInputed!==2&&(Eh.__pathInputed=Sh?1:0),Sh||(Eh.__pathForRender=void 0),this.__setAttr(Lh,Sh),vn(this)}}))}const Cn=bn;function On($h,Lh){return un($h,Sh=>({set(Eh){this.__setAttr(Sh,Eh)&&(Tn(this),Lh&&(this.__.__useStroke=!0))}}))}function Tn($h){$h.__layout.strokeChanged||$h.__layout.strokeChange(),$h.__.__useArrow&&vn($h)}const Pn=On;function Sn($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Ln($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}}))}function Rn($h){return un($h,Lh=>({set(Sh){if(this.__setAttr(Lh,Sh)){const Eh=this.__;_.stintSet(Eh,"__useDim",Eh.dim||Eh.bright||Eh.dimskip),this.__layout.surfaceChange()}}}))}function En($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh)&&(this.__layout.opacityChanged||this.__layout.opacityChange()),this.mask&&Mn(this)}}))}function In($h){return un($h,Lh=>({set(Sh){const Eh=this.visible;if(Eh===!0&&Sh===0){if(this.animationOut)return this.__runAnimation("out",()=>An(this,Lh,Sh,Eh))}else Eh===0&&Sh===!0&&this.animation&&this.__runAnimation("in");An(this,Lh,Sh,Eh),this.mask&&Mn(this)}}))}function Mn($h){const{parent:Lh}=$h;if(Lh){const{__hasMask:Sh}=Lh;Lh.__updateMask(),Sh!==Lh.__hasMask&&Lh.forceUpdate()}}function An($h,Lh,Sh,Eh){$h.__setAttr(Lh,Sh)&&($h.__layout.opacityChanged||$h.__layout.opacityChange(),Eh!==0&&Sh!==0||vn($h))}function Wn($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh)&&(this.__layout.surfaceChange(),this.waitParent(()=>{this.parent.__layout.childrenSortChange()}))}}))}function Nn($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent(()=>{this.parent.__updateMask(Sh)}))}}))}function Yn($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh)&&this.waitParent(()=>{this.parent.__updateEraser(Sh)})}}))}function Dn($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh)&&(this.__layout.hitCanvasChanged=!0,ee$2.showBounds==="hit"&&this.__layout.surfaceChange(),this.leafer&&this.leafer.updateCursor())}}))}function Xn($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh),this.leafer&&this.leafer.updateCursor()}}))}function zn($h){return(Lh,Sh)=>{ln(Lh,"__DataProcessor",{get:()=>$h})}}function Fn($h){return(Lh,Sh)=>{ln(Lh,"__LayoutProcessor",{get:()=>$h})}}function Un($h,Lh,Sh){const Eh=$h.__DataProcessor.prototype,Gh="_"+Lh,Ah=(function(Fh){return"set"+Fh.charAt(0).toUpperCase()+Fh.slice(1)})(Lh),Ph=cn(Lh,Sh);if(s(Sh))Ph.get=function(){return this[Gh]};else if(typeof Sh=="function")Ph.get=function(){const Fh=this[Gh];return Fh==null?Sh(this.__leaf):Fh};else if(d(Sh)){const Fh=u(Sh);Ph.get=function(){const Ih=this[Gh];return Ih==null?this[Gh]=Fh?{}:_.clone(Sh):Ih}}const Nh=$h.isBranchLeaf;Lh==="width"?Ph.get=function(){const Fh=this[Gh];if(Fh==null){const Ih=this,Hh=Ih.__naturalWidth,Wh=Ih.__leaf;return!Sh||Wh.pathInputed?Wh.boxBounds.width:Hh?Ih._height&&Ih.__useNaturalRatio?Ih._height*Hh/Ih.__naturalHeight:Hh:Nh&&Wh.children.length?Wh.boxBounds.width:Sh}return Fh}:Lh==="height"&&(Ph.get=function(){const Fh=this[Gh];if(Fh==null){const Ih=this,Hh=Ih.__naturalHeight,Wh=Ih.__leaf;return!Sh||Wh.pathInputed?Wh.boxBounds.height:Hh?Ih._width&&Ih.__useNaturalRatio?Ih._width*Hh/Ih.__naturalWidth:Hh:Nh&&Wh.children.length?Wh.boxBounds.height:Sh}return Fh});let Mh,Dh=Eh;for(;!Mh&&Dh;)Mh=dn(Dh,Lh),Dh=Dh.__proto__;Mh&&Mh.set&&(Ph.set=Mh.set),Eh[Ah]&&(Ph.set=Eh[Ah],delete Eh[Ah]),ln(Eh,Lh,Ph)}const jn=new ee$2("rewrite"),Vn=[],Hn=["destroy","constructor"];function Gn($h){return(Lh,Sh)=>{Vn.push({name:Lh.constructor.name+"."+Sh,run:()=>{Lh[Sh]=$h}})}}function qn(){return $h=>{Qn()}}function Qn($h){Vn.length&&(Vn.forEach(Lh=>{$h&&jn.error(Lh.name,"\u9700\u5728Class\u4E0A\u88C5\u9970@rewriteAble()"),Lh.run()}),Vn.length=0)}function Jn($h,Lh){return Sh=>{var Eh;($h.prototype?(Eh=$h.prototype,Object.getOwnPropertyNames(Eh)):Object.keys($h)).forEach(Gh=>{Hn.includes(Gh)||Lh&&Lh.includes(Gh)||($h.prototype?dn($h.prototype,Gh).writable&&(Sh.prototype[Gh]=$h.prototype[Gh]):Sh.prototype[Gh]=$h[Gh])})}}function Zn(){return $h=>{ce$2.register($h)}}function $n(){return $h=>{pe$2.register($h)}}setTimeout(()=>Qn(!0));const{copy:Kn,toInnerPoint:to,toOuterPoint:eo,scaleOfOuter:so,rotateOfOuter:ro,skewOfOuter:io,multiplyParent:no,divideParent:oo,getLayout:ao}=q$1,ho={},{round:lo}=Math,co={updateAllMatrix($h,Lh,Sh){if(Lh&&$h.__hasAutoLayout&&$h.__layout.matrixChanged&&(Sh=!0),po($h,Lh,Sh),$h.isBranch){const{children:Eh}=$h;for(let Gh=0,Ah=Eh.length;Gh<Ah;Gh++)_o(Eh[Gh],Lh,Sh)}},updateMatrix($h,Lh,Sh){const Eh=$h.__layout;Lh?Sh&&(Eh.waitAutoLayout=!0,$h.__hasAutoLayout&&(Eh.matrixChanged=!1)):Eh.waitAutoLayout&&(Eh.waitAutoLayout=!1),Eh.matrixChanged&&$h.__updateLocalMatrix(),Eh.waitAutoLayout||$h.__updateWorldMatrix()},updateBounds($h){const Lh=$h.__layout;Lh.boundsChanged&&$h.__updateLocalBounds(),Lh.waitAutoLayout||$h.__updateWorldBounds()},updateAllWorldOpacity($h){if($h.__updateWorldOpacity(),$h.isBranch){const{children:Lh}=$h;for(let Sh=0,Eh=Lh.length;Sh<Eh;Sh++)fo(Lh[Sh])}},updateChange($h){const Lh=$h.__layout;Lh.stateStyleChanged&&$h.updateState(),Lh.opacityChanged&&fo($h),$h.__updateChange()},updateAllChange($h){if(yo($h),$h.isBranch){const{children:Lh}=$h;for(let Sh=0,Eh=Lh.length;Sh<Eh;Sh++)go(Lh[Sh])}},worldHittable($h){for(;$h;){if(!$h.__.hittable)return!1;$h=$h.parent}return!0},draggable:$h=>($h.draggable||$h.editable)&&$h.hitSelf&&!$h.locked,copyCanvasByWorld($h,Lh,Sh,Eh,Gh,Ah){Eh||(Eh=$h.__nowWorld),$h.__worldFlipped||$t$2.fullImageShadow?Lh.copyWorldByReset(Sh,Eh,$h.__nowWorld,Gh,Ah):Lh.copyWorldToInner(Sh,Eh,$h.__layout.renderBounds,Gh)},moveWorld($h,Lh,Sh=0,Eh,Gh){const Ah=d(Lh)?Object.assign({},Lh):{x:Lh,y:Sh};Eh?eo($h.localTransform,Ah,Ah,!0):$h.parent&&to($h.parent.scrollWorldTransform,Ah,Ah,!0),uo.moveLocal($h,Ah.x,Ah.y,Gh)},moveLocal($h,Lh,Sh=0,Eh){d(Lh)&&(Sh=Lh.y,Lh=Lh.x),Lh+=$h.x,Sh+=$h.y,$h.leafer&&$h.leafer.config.pointSnap&&(Lh=lo(Lh),Sh=lo(Sh)),Eh?$h.animate({x:Lh,y:Sh},Eh):($h.x=Lh,$h.y=Sh)},zoomOfWorld($h,Lh,Sh,Eh,Gh,Ah){uo.zoomOfLocal($h,mo($h,Lh),Sh,Eh,Gh,Ah)},zoomOfLocal($h,Lh,Sh,Eh=Sh,Gh,Ah){const Ph=$h.__localMatrix;if(o(Eh)||(Eh&&(Ah=Eh),Eh=Sh),Kn(ho,Ph),so(ho,Lh,Sh,Eh),uo.hasHighPosition($h))uo.setTransform($h,ho,Gh,Ah);else{const Nh=$h.x+ho.e-Ph.e,Mh=$h.y+ho.f-Ph.f;Ah&&!Gh?$h.animate({x:Nh,y:Mh,scaleX:$h.scaleX*Sh,scaleY:$h.scaleY*Eh},Ah):($h.x=Nh,$h.y=Mh,$h.scaleResize(Sh,Eh,Gh!==!0))}},rotateOfWorld($h,Lh,Sh,Eh){uo.rotateOfLocal($h,mo($h,Lh),Sh,Eh)},rotateOfLocal($h,Lh,Sh,Eh){const Gh=$h.__localMatrix;Kn(ho,Gh),ro(ho,Lh,Sh),uo.hasHighPosition($h)?uo.setTransform($h,ho,!1,Eh):$h.set({x:$h.x+ho.e-Gh.e,y:$h.y+ho.f-Gh.f,rotation:I$1.formatRotation($h.rotation+Sh)},Eh)},skewOfWorld($h,Lh,Sh,Eh,Gh,Ah){uo.skewOfLocal($h,mo($h,Lh),Sh,Eh,Gh,Ah)},skewOfLocal($h,Lh,Sh,Eh=0,Gh,Ah){Kn(ho,$h.__localMatrix),io(ho,Lh,Sh,Eh),uo.setTransform($h,ho,Gh,Ah)},transformWorld($h,Lh,Sh,Eh){Kn(ho,$h.worldTransform),no(ho,Lh),$h.parent&&oo(ho,$h.parent.scrollWorldTransform),uo.setTransform($h,ho,Sh,Eh)},transform($h,Lh,Sh,Eh){Kn(ho,$h.localTransform),no(ho,Lh),uo.setTransform($h,ho,Sh,Eh)},setTransform($h,Lh,Sh,Eh){const Gh=$h.__,Ah=Gh.origin&&uo.getInnerOrigin($h,Gh.origin),Ph=ao(Lh,Ah,Gh.around&&uo.getInnerOrigin($h,Gh.around));if(uo.hasOffset($h)&&(Ph.x-=Gh.offsetX,Ph.y-=Gh.offsetY),Sh){const Nh=Ph.scaleX/$h.scaleX,Mh=Ph.scaleY/$h.scaleY;if(delete Ph.scaleX,delete Ph.scaleY,Ah){zt$2.scale($h.boxBounds,Math.abs(Nh),Math.abs(Mh));const Dh=uo.getInnerOrigin($h,Gh.origin);ot$2.move(Ph,Ah.x-Dh.x,Ah.y-Dh.y)}$h.set(Ph),$h.scaleResize(Nh,Mh,!1)}else $h.set(Ph,Eh)},getFlipTransform($h,Lh){const Sh={a:1,b:0,c:0,d:1,e:0,f:0},Eh=Lh==="x"?1:-1;return so(Sh,uo.getLocalOrigin($h,"center"),-1*Eh,1*Eh),Sh},getLocalOrigin:($h,Lh)=>ot$2.tempToOuterOf(uo.getInnerOrigin($h,Lh),$h.localTransform),getInnerOrigin($h,Lh){const Sh={};return bt$3.toPoint(Lh,$h.boxBounds,Sh),Sh},getRelativeWorld:($h,Lh,Sh)=>(Kn(ho,$h.worldTransform),oo(ho,Lh.scrollWorldTransform),Sh?ho:Object.assign({},ho)),drop($h,Lh,Sh,Eh){$h.setTransform(uo.getRelativeWorld($h,Lh,!0),Eh),Lh.add($h,Sh)},hasHighPosition:$h=>$h.origin||$h.around||uo.hasOffset($h),hasOffset:$h=>$h.offsetX||$h.offsetY,hasParent($h,Lh){if(!Lh)return!1;for(;$h;){if(Lh===$h)return!0;$h=$h.parent}},animateMove($h,Lh,Sh=.3){if(Lh.x||Lh.y)if(Math.abs(Lh.x)<1&&Math.abs(Lh.y)<1)$h.move(Lh);else{const Eh=Lh.x*Sh,Gh=Lh.y*Sh;Lh.x-=Eh,Lh.y-=Gh,$h.move(Eh,Gh),$t$2.requestRender(()=>uo.animateMove($h,Lh,Sh))}}},uo=co,{updateAllMatrix:_o,updateMatrix:po,updateAllWorldOpacity:fo,updateAllChange:go,updateChange:yo}=uo;function mo($h,Lh){return $h.updateLayout(),$h.parent?ot$2.tempToInnerOf(Lh,$h.parent.scrollWorldTransform):Lh}const xo={worldBounds:$h=>$h.__world,localBoxBounds:$h=>$h.__.eraser||$h.__.visible===0?null:$h.__local||$h.__layout,localStrokeBounds:$h=>$h.__.eraser||$h.__.visible===0?null:$h.__layout.localStrokeBounds,localRenderBounds:$h=>$h.__.eraser||$h.__.visible===0?null:$h.__layout.localRenderBounds,maskLocalBoxBounds:($h,Lh)=>bo($h,Lh)&&$h.__localBoxBounds,maskLocalStrokeBounds:($h,Lh)=>bo($h,Lh)&&$h.__layout.localStrokeBounds,maskLocalRenderBounds:($h,Lh)=>bo($h,Lh)&&$h.__layout.localRenderBounds,excludeRenderBounds:($h,Lh)=>!(!Lh.bounds||Lh.bounds.hit($h.__world,Lh.matrix))||!(!Lh.hideBounds||!Lh.hideBounds.includes($h.__world,Lh.matrix))};let wo;function bo($h,Lh){return Lh||(wo=0),$h.__.mask&&(wo=1),wo<0?null:(wo&&(wo=-1),!0)}const{updateBounds:Bo}=co,vo={sort:($h,Lh)=>$h.__.zIndex===Lh.__.zIndex?$h.__tempNumber-Lh.__tempNumber:$h.__.zIndex-Lh.__.zIndex,pushAllChildBranch($h,Lh){if($h.__tempNumber=1,$h.__.__childBranchNumber){const{children:Sh}=$h;for(let Eh=0,Gh=Sh.length;Eh<Gh;Eh++)($h=Sh[Eh]).isBranch&&($h.__tempNumber=1,Lh.add($h),ko($h,Lh))}},pushAllParent($h,Lh){const{keys:Sh}=Lh;if(Sh)for(;$h.parent&&s(Sh[$h.parent.innerId]);)Lh.add($h.parent),$h=$h.parent;else for(;$h.parent;)Lh.add($h.parent),$h=$h.parent},pushAllBranchStack($h,Lh){let Sh=Lh.length;const{children:Eh}=$h;for(let Gh=0,Ah=Eh.length;Gh<Ah;Gh++)Eh[Gh].isBranch&&Lh.push(Eh[Gh]);for(let Gh=Sh,Ah=Lh.length;Gh<Ah;Gh++)Co(Lh[Gh],Lh)},updateBounds($h,Lh){const Sh=[$h];Co($h,Sh),Oo(Sh,Lh)},updateBoundsByBranchStack($h,Lh){let Sh,Eh;for(let Gh=$h.length-1;Gh>-1;Gh--){Sh=$h[Gh],Eh=Sh.children;for(let Ah=0,Ph=Eh.length;Ah<Ph;Ah++)Bo(Eh[Ah]);Lh&&Lh===Sh||Bo(Sh)}},move($h,Lh,Sh){let Eh;const{children:Gh}=$h;for(let Ah=0,Ph=Gh.length;Ah<Ph;Ah++)Eh=($h=Gh[Ah]).__world,Eh.e+=Lh,Eh.f+=Sh,Eh.x+=Lh,Eh.y+=Sh,$h.isBranch&&To($h,Lh,Sh)},scale($h,Lh,Sh,Eh,Gh,Ah,Ph){let Nh;const{children:Mh}=$h,Dh=Eh-1,Fh=Gh-1;for(let Ih=0,Hh=Mh.length;Ih<Hh;Ih++)Nh=($h=Mh[Ih]).__world,Nh.a*=Eh,Nh.d*=Gh,(Nh.b||Nh.c)&&(Nh.b*=Eh,Nh.c*=Gh),Nh.e===Nh.x&&Nh.f===Nh.y?(Nh.x=Nh.e+=(Nh.e-Ah)*Dh+Lh,Nh.y=Nh.f+=(Nh.f-Ph)*Fh+Sh):(Nh.e+=(Nh.e-Ah)*Dh+Lh,Nh.f+=(Nh.f-Ph)*Fh+Sh,Nh.x+=(Nh.x-Ah)*Dh+Lh,Nh.y+=(Nh.y-Ph)*Fh+Sh),Nh.width*=Eh,Nh.height*=Gh,Nh.scaleX*=Eh,Nh.scaleY*=Gh,$h.isBranch&&Po($h,Lh,Sh,Eh,Gh,Ah,Ph)}},{pushAllChildBranch:ko,pushAllBranchStack:Co,updateBoundsByBranchStack:Oo,move:To,scale:Po}=vo,So={run($h){if($h&&$h.length){const Lh=$h.length;for(let Sh=0;Sh<Lh;Sh++)$h[Sh]();$h.length===Lh?$h.length=0:$h.splice(0,Lh)}}},{getRelativeWorld:Lo,updateBounds:Ro}=co,{toOuterOf:Eo,getPoints:Io,copy:Mo}=zt$2,Ao="_localContentBounds",Wo="_worldContentBounds",No="_worldBoxBounds",Yo="_worldStrokeBounds";class Do{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(Lh){this._contentBounds=Lh}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}set renderBounds(Lh){this._renderBounds=Lh}get localContentBounds(){return Eo(this.contentBounds,this.leaf.__localMatrix,this[Ao]||(this[Ao]={})),this[Ao]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return Eo(this.contentBounds,this.leaf.__world,this[Wo]||(this[Wo]={})),this[Wo]}get worldBoxBounds(){return Eo(this.boxBounds,this.leaf.__world,this[No]||(this[No]={})),this[No]}get worldStrokeBounds(){return Eo(this.strokeBounds,this.leaf.__world,this[Yo]||(this[Yo]={})),this[Yo]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(Lh){this.leaf=Lh,this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),Lh.__world&&(this.boxBounds={x:0,y:0,width:0,height:0},this.boxChange(),this.matrixChange())}createLocal(){const Lh=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=Lh),this._localRenderBounds||(this._localRenderBounds=Lh)}update(){const{leaf:Lh}=this,{leafer:Sh}=Lh;if(Lh.isApp)return Ro(Lh);if(Sh)Sh.ready?Sh.watcher.changed&&Sh.layouter.layout():Sh.start();else{let Eh=Lh;for(;Eh.parent&&!Eh.parent.leafer;)Eh=Eh.parent;const Gh=Eh;if(Gh.__fullLayouting)return;Gh.__fullLayouting=!0,$t$2.layout(Gh),delete Gh.__fullLayouting}}getTransform(Lh="world"){this.update();const{leaf:Sh}=this;switch(Lh){case"world":return Sh.__world;case"local":return Sh.__localMatrix;case"inner":return q$1.defaultMatrix;case"page":Lh=Sh.zoomLayer;default:return Lo(Sh,Lh)}}getBounds(Lh,Sh="world"){switch(this.update(),Sh){case"world":return this.getWorldBounds(Lh);case"local":return this.getLocalBounds(Lh);case"inner":return this.getInnerBounds(Lh);case"page":Sh=this.leaf.zoomLayer;default:return new Vt$3(this.getInnerBounds(Lh)).toOuterOf(this.getTransform(Sh))}}getInnerBounds(Lh="box"){switch(Lh){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(Lh="box"){switch(Lh){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(Lh="box"){switch(Lh){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(Lh,Sh="world",Eh){const{leaf:Gh}=this;let Ah,Ph,Nh,Mh=this.getInnerBounds(Lh);switch(Sh){case"world":Ah=Gh.getWorldPoint(Mh),Ph=Gh.__world;break;case"local":const{scaleX:Dh,scaleY:Fh,rotation:Ih,skewX:Hh,skewY:Wh}=Gh.__;Nh={scaleX:Dh,scaleY:Fh,rotation:Ih,skewX:Hh,skewY:Wh},Ah=Gh.getLocalPointByInner(Mh);break;case"inner":Ah=Mh,Ph=q$1.defaultMatrix;break;case"page":Sh=Gh.zoomLayer;default:Ah=Gh.getWorldPoint(Mh,Sh),Ph=Lo(Gh,Sh,!0)}if(Nh||(Nh=q$1.getLayout(Ph)),Mo(Nh,Mh),ot$2.copy(Nh,Ah),Eh){const{scaleX:Dh,scaleY:Fh}=Nh,Ih=Math.abs(Dh),Hh=Math.abs(Fh);Ih===1&&Hh===1||(Nh.scaleX/=Ih,Nh.scaleY/=Hh,Nh.width*=Ih,Nh.height*=Hh)}return Nh}getLayoutPoints(Lh,Sh="world"){const{leaf:Eh}=this,Gh=Io(this.getInnerBounds(Lh));let Ah;switch(Sh){case"world":Ah=null;break;case"local":Ah=Eh.parent;break;case"inner":break;case"page":Sh=Eh.zoomLayer;default:Ah=Sh}return s(Ah)||Gh.forEach(Ph=>Eh.innerToWorld(Ph,null,!1,Ah)),Gh}shrinkContent(){const{x:Lh,y:Sh,width:Eh,height:Gh}=this.boxBounds;this._contentBounds={x:Lh,y:Sh,width:Eh,height:Gh}}spreadStroke(){const{x:Lh,y:Sh,width:Eh,height:Gh}=this.strokeBounds;this._strokeBounds={x:Lh,y:Sh,width:Eh,height:Gh},this._localStrokeBounds={x:Lh,y:Sh,width:Eh,height:Gh},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:Lh,y:Sh,width:Eh,height:Gh}=this.renderBounds;this._renderBounds={x:Lh,y:Sh,width:Eh,height:Gh},this._localRenderBounds={x:Lh,y:Sh,width:Eh,height:Gh}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const Lh=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,Lh&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=this.affectChildrenSort=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class Xo{constructor(Lh,Sh){this.bubbles=!1,this.type=Lh,Sh&&(this.target=Sh)}stopDefault(){this.isStopDefault=!0,this.origin&&$t$2.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&$t$2.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&$t$2.event.stop(this.origin)}}class zo extends Xo{constructor(Lh,Sh,Eh){super(Lh,Sh),this.parent=Eh,this.child=Sh}}zo.ADD="child.add",zo.REMOVE="child.remove",zo.CREATED="created",zo.MOUNTED="mounted",zo.UNMOUNTED="unmounted",zo.DESTROY="destroy";const Fo="property.scroll";class Uo extends Xo{constructor(Lh,Sh,Eh,Gh,Ah){super(Lh,Sh),this.attrName=Eh,this.oldValue=Gh,this.newValue=Ah}}Uo.CHANGE="property.change",Uo.LEAFER_CHANGE="property.leafer_change",Uo.SCROLL=Fo;const jo={scrollX:Fo,scrollY:Fo};class Vo extends Xo{constructor(Lh,Sh){super(Lh),Object.assign(this,Sh)}}Vo.LOAD="image.load",Vo.LOADED="image.loaded",Vo.ERROR="image.error";class Ho extends Xo{static checkHas(Lh,Sh,Eh){Eh==="on"?Sh===Jo?Lh.__hasWorldEvent=!0:Lh.__hasLocalEvent=!0:(Lh.__hasLocalEvent=Lh.hasEvent(Go)||Lh.hasEvent(qo)||Lh.hasEvent(Qo),Lh.__hasWorldEvent=Lh.hasEvent(Jo))}static emitLocal(Lh){if(Lh.leaferIsReady){const{resized:Sh}=Lh.__layout;Sh!=="local"&&(Lh.emit(Go,Lh),Sh==="inner"&&Lh.emit(qo,Lh)),Lh.emit(Qo,Lh)}}static emitWorld(Lh){Lh.leaferIsReady&&Lh.emit(Jo,this)}}Ho.RESIZE="bounds.resize",Ho.INNER="bounds.inner",Ho.LOCAL="bounds.local",Ho.WORLD="bounds.world";const{RESIZE:Go,INNER:qo,LOCAL:Qo,WORLD:Jo}=Ho,Zo={};[Go,qo,Qo,Jo].forEach($h=>Zo[$h]=1);class $o extends Xo{get bigger(){if(!this.old)return!0;const{width:Lh,height:Sh}=this.old;return this.width>=Lh&&this.height>=Sh}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(Lh,Sh){d(Lh)?(super($o.RESIZE),Object.assign(this,Lh)):super(Lh),this.old=Sh}static isResizing(Lh){return this.resizingKeys&&!s(this.resizingKeys[Lh.innerId])}}$o.RESIZE="resize";class Ko extends Xo{constructor(Lh,Sh){super(Lh),this.data=Sh}}Ko.REQUEST="watch.request",Ko.DATA="watch.data";class ta extends Xo{constructor(Lh,Sh,Eh){super(Lh),Sh&&(this.data=Sh,this.times=Eh)}}ta.REQUEST="layout.request",ta.START="layout.start",ta.BEFORE="layout.before",ta.LAYOUT="layout",ta.AFTER="layout.after",ta.AGAIN="layout.again",ta.END="layout.end";class ea extends Xo{constructor(Lh,Sh,Eh,Gh){super(Lh),Sh&&(this.times=Sh),Eh&&(this.renderBounds=Eh,this.renderOptions=Gh)}}ea.REQUEST="render.request",ea.CHILD_START="render.child_start",ea.CHILD_END="render.child_end",ea.START="render.start",ea.BEFORE="render.before",ea.RENDER="render",ea.AFTER="render.after",ea.AGAIN="render.again",ea.END="render.end",ea.NEXT="render.next";class sa extends Xo{}sa.START="leafer.start",sa.BEFORE_READY="leafer.before_ready",sa.READY="leafer.ready",sa.AFTER_READY="leafer.after_ready",sa.VIEW_READY="leafer.view_ready",sa.VIEW_COMPLETED="leafer.view_completed",sa.STOP="leafer.stop",sa.RESTART="leafer.restart",sa.END="leafer.end",sa.UPDATE_MODE="leafer.update_mode",sa.TRANSFORM="leafer.transform",sa.MOVE="leafer.move",sa.SCALE="leafer.scale",sa.ROTATE="leafer.rotate",sa.SKEW="leafer.skew";const{MOVE:ra,SCALE:ia,ROTATE:na,SKEW:oa}=sa,aa={x:ra,y:ra,scaleX:ia,scaleY:ia,rotation:na,skewX:oa,skewY:oa},ha={};class la{set event(Lh){this.on(Lh)}on(Lh,Sh,Eh){if(!Sh){let Fh;if(l(Lh))Lh.forEach(Ih=>this.on(Ih[0],Ih[1],Ih[2]));else for(let Ih in Lh)l(Fh=Lh[Ih])?this.on(Ih,Fh[0],Fh[1]):this.on(Ih,Fh);return}let Gh,Ah,Ph;Eh&&(Eh==="once"?Ah=!0:typeof Eh=="boolean"?Gh=Eh:(Gh=Eh.capture,Ah=Eh.once));const Nh=da(this,Gh,!0),Mh=i(Lh)?Lh.split(" "):Lh,Dh=Ah?{listener:Sh,once:Ah}:{listener:Sh};Mh.forEach(Fh=>{Fh&&(Ph=Nh[Fh],Ph?Ph.findIndex(Ih=>Ih.listener===Sh)===-1&&Ph.push(Dh):Nh[Fh]=[Dh],Zo[Fh]&&Ho.checkHas(this,Fh,"on"))})}off(Lh,Sh,Eh){if(Lh){const Gh=i(Lh)?Lh.split(" "):Lh;if(Sh){let Ah,Ph,Nh;Eh&&(Ah=typeof Eh=="boolean"?Eh:Eh!=="once"&&Eh.capture);const Mh=da(this,Ah);Gh.forEach(Dh=>{Dh&&(Ph=Mh[Dh],Ph&&(Nh=Ph.findIndex(Fh=>Fh.listener===Sh),Nh>-1&&Ph.splice(Nh,1),Ph.length||delete Mh[Dh],Zo[Dh]&&Ho.checkHas(this,Dh,"off")))})}else{const{__bubbleMap:Ah,__captureMap:Ph}=this;Gh.forEach(Nh=>{Ah&&delete Ah[Nh],Ph&&delete Ph[Nh]})}}else this.__bubbleMap=this.__captureMap=void 0}on_(Lh,Sh,Eh,Gh){return Sh?this.on(Lh,Eh?Sh=Sh.bind(Eh):Sh,Gh):l(Lh)&&Lh.forEach(Ah=>this.on(Ah[0],Ah[2]?Ah[1]=Ah[1].bind(Ah[2]):Ah[1],Ah[3])),{type:Lh,current:this,listener:Sh,options:Gh}}off_(Lh){if(!Lh)return;const Sh=l(Lh)?Lh:[Lh];Sh.forEach(Eh=>{Eh&&(Eh.listener?Eh.current.off(Eh.type,Eh.listener,Eh.options):l(Eh.type)&&Eh.type.forEach(Gh=>Eh.current.off(Gh[0],Gh[1],Gh[3])))}),Sh.length=0}once(Lh,Sh,Eh,Gh){if(!Sh)return l(Lh)&&Lh.forEach(Ah=>this.once(Ah[0],Ah[1],Ah[2],Ah[3]));d(Eh)?Sh=Sh.bind(Eh):Gh=Eh,this.on(Lh,Sh,{once:!0,capture:Gh})}emit(Lh,Sh,Eh){!Sh&&pe$2.has(Lh)&&(Sh=pe$2.get(Lh,{type:Lh,target:this,current:this}));const Gh=da(this,Eh)[Lh];if(Gh){let Ah;for(let Ph=0,Nh=Gh.length;Ph<Nh&&!((Ah=Gh[Ph])&&(Ah.listener(Sh),Ah.once&&(this.off(Lh,Ah.listener,Eh),Ph--,Nh--),Sh&&Sh.isStopNow));Ph++);}this.syncEventer&&this.syncEventer.emitEvent(Sh,Eh)}emitEvent(Lh,Sh){Lh.current=this,this.emit(Lh.type,Lh,Sh)}hasEvent(Lh,Sh){if(this.syncEventer&&this.syncEventer.hasEvent(Lh,Sh))return!0;const{__bubbleMap:Eh,__captureMap:Gh}=this,Ah=Eh&&Eh[Lh],Ph=Gh&&Gh[Lh];return!!(s(Sh)?Ah||Ph:Sh?Ph:Ah)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function da($h,Lh,Sh){if(Lh){const{__captureMap:Eh}=$h;return Eh||(Sh?$h.__captureMap={}:ha)}{const{__bubbleMap:Eh}=$h;return Eh||(Sh?$h.__bubbleMap={}:ha)}}const{on:ca,on_:ua,off:_a,off_:pa,once:fa,emit:ga,emitEvent:ya,hasEvent:ma,destroy:xa}=la.prototype,wa={on:ca,on_:ua,off:_a,off_:pa,once:fa,emit:ga,emitEvent:ya,hasEvent:ma,destroyEventer:xa},ba=ee$2.get("setAttr"),Ba={__setAttr($h,Lh,Sh){if(this.leaferIsCreated){const Eh=this.__.__getInput($h);if(!Sh||n(Lh)||s(Lh)||(ba.warn(this.innerName,$h,Lh),Lh=void 0),d(Lh)||Eh!==Lh){if(this.__realSetAttr($h,Lh),this.isLeafer){this.emitEvent(new Uo(Uo.LEAFER_CHANGE,this,$h,Eh,Lh));const Ah=aa[$h];Ah&&(this.emitEvent(new sa(Ah,this)),this.emitEvent(new sa(sa.TRANSFORM,this)))}this.emitPropertyEvent(Uo.CHANGE,$h,Eh,Lh);const Gh=jo[$h];return Gh&&this.emitPropertyEvent(Gh,$h,Eh,Lh),!0}return!1}return this.__realSetAttr($h,Lh),!0},emitPropertyEvent($h,Lh,Sh,Eh){const Gh=new Uo($h,this,Lh,Sh,Eh);this.isLeafer||this.hasEvent($h)&&this.emitEvent(Gh),this.leafer.emitEvent(Gh)},__realSetAttr($h,Lh){const Sh=this.__;Sh[$h]=Lh,this.__proxyData&&this.setProxyAttr($h,Lh),Sh.normalStyle&&(this.lockNormalStyle||s(Sh.normalStyle[$h])||(Sh.normalStyle[$h]=Lh))},__getAttr($h){return this.__proxyData?this.getProxyAttr($h):this.__.__get($h)}},{setLayout:va,multiplyParent:ka,translateInner:Ca,defaultWorld:Oa}=q$1,{toPoint:Ta,tempPoint:Pa}=bt$3,Sa={__updateWorldMatrix(){const{parent:$h,__layout:Lh,__world:Sh,__scrollWorld:Eh,__:Gh}=this;ka(this.__local||Lh,$h?$h.__scrollWorld||$h.__world:Oa,Sh,!!Lh.affectScaleOrRotation,Gh),Eh&&Ca(Object.assign(Eh,Sh),Gh.scrollX,Gh.scrollY)},__updateLocalMatrix(){if(this.__local){const $h=this.__layout,Lh=this.__local,Sh=this.__;$h.affectScaleOrRotation&&($h.scaleChanged&&($h.resized||($h.resized="scale"))||$h.rotationChanged)&&(va(Lh,Sh,null,null,$h.affectRotation),$h.scaleChanged=$h.rotationChanged=void 0),Lh.e=Sh.x+Sh.offsetX,Lh.f=Sh.y+Sh.offsetY,(Sh.around||Sh.origin)&&(Ta(Sh.around||Sh.origin,$h.boxBounds,Pa),Ca(Lh,-Pa.x,-Pa.y,!Sh.around))}this.__layout.matrixChanged=void 0}},{updateMatrix:La,updateAllMatrix:Ra}=co,{updateBounds:Ea}=vo,{toOuterOf:Ia,copyAndSpread:Ma,copy:Aa}=zt$2,{toBounds:Wa}=Ai$1,Na={__updateWorldBounds(){const{__layout:$h,__world:Lh}=this;Ia($h.renderBounds,Lh,Lh),$h.resized&&($h.resized==="inner"&&this.__onUpdateSize(),this.__hasLocalEvent&&Ho.emitLocal(this),$h.resized=void 0),this.__hasWorldEvent&&Ho.emitWorld(this)},__updateLocalBounds(){const $h=this.__layout;$h.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),$h.resized="inner"),$h.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),$h.localBoxChanged=void 0,$h.strokeSpread&&($h.strokeChanged=!0),$h.renderSpread&&($h.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),$h.boxChanged=void 0,$h.strokeChanged&&($h.strokeSpread=this.__updateStrokeSpread(),$h.strokeSpread?($h.strokeBounds===$h.boxBounds&&$h.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):$h.spreadStrokeCancel(),$h.strokeChanged=void 0,($h.renderSpread||$h.strokeSpread!==$h.strokeBoxSpread)&&($h.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),$h.resized="inner"),$h.renderChanged&&($h.renderSpread=this.__updateRenderSpread(),$h.renderSpread?($h.renderBounds!==$h.boxBounds&&$h.renderBounds!==$h.strokeBounds||$h.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):$h.spreadRenderCancel(),$h.renderChanged=void 0,this.parent&&this.parent.__layout.renderChange()),$h.resized||($h.resized="local"),$h.boundsChanged=void 0},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),Ia(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){Ia(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){Ia(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds($h,Lh){const Sh=this.__layout.boxBounds,Eh=this.__;Eh.__usePathBox?Wa(Eh.path,Sh):(Sh.x=0,Sh.y=0,Sh.width=Eh.width,Sh.height=Eh.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.__extraUpdate(),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),Ra(this),Ea(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(Ra(this),Ea(this,this))):La(this)},__updateNaturalSize(){const{__:$h,__layout:Lh}=this;$h.__naturalWidth=Lh.boxBounds.width,$h.__naturalHeight=Lh.boxBounds.height},__updateStrokeBounds($h){const Lh=this.__layout;Ma(Lh.strokeBounds,Lh.boxBounds,Lh.strokeBoxSpread)},__updateRenderBounds($h){const Lh=this.__layout,{renderSpread:Sh}=Lh;o(Sh)&&Sh<=0?Aa(Lh.renderBounds,Lh.strokeBounds):Ma(Lh.renderBounds,Lh.boxBounds,Sh)}},Ya={__render($h,Lh){if(Lh.shape)return this.__renderShape($h,Lh);if((!Lh.cellList||Lh.cellList.has(this))&&this.__worldOpacity){const Sh=this.__;if(Sh.bright&&!Lh.topRendering)return Lh.topList.add(this);if($h.setWorld(this.__nowWorld=this.__getNowWorld(Lh)),$h.opacity=Lh.dimOpacity&&!Sh.dimskip?Sh.opacity*Lh.dimOpacity:Sh.opacity,this.__.__single){if(Sh.eraser==="path")return this.__renderEraser($h,Lh);const Eh=$h.getSameCanvas(!0,!0);this.__draw(Eh,Lh,$h),co.copyCanvasByWorld(this,$h,Eh,this.__nowWorld,Sh.__blendMode,!0),Eh.recycle(this.__nowWorld)}else this.__draw($h,Lh);ee$2.showBounds&&ee$2.drawBounds(this,$h,Lh)}},__renderShape($h,Lh){this.__worldOpacity&&($h.setWorld(this.__nowWorld=this.__getNowWorld(Lh)),this.__drawShape($h,Lh))},__clip($h,Lh){this.__worldOpacity&&($h.setWorld(this.__nowWorld=this.__getNowWorld(Lh)),this.__drawRenderPath($h),$h.clipUI(this))},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:Da}=xo,{hasSize:Xa}=zt$2,za={__updateChange(){const{__layout:$h}=this;$h.childrenSortChanged&&(this.__updateSortChildren(),$h.childrenSortChanged=!1),this.__.__checkSingle()},__render($h,Lh){const Sh=this.__nowWorld=this.__getNowWorld(Lh);if(this.__worldOpacity&&Xa(Sh)){const Eh=this.__;if(Eh.__useDim)if(Eh.dim)Lh.dimOpacity=Eh.dim===!0?.2:Eh.dim;else{if(Eh.bright&&!Lh.topRendering)return Lh.topList.add(this);Eh.dimskip&&Lh.dimOpacity&&(Lh.dimOpacity=0)}if(Eh.__single&&!this.isBranchLeaf){if(Eh.eraser==="path")return this.__renderEraser($h,Lh);const Gh=$h.getSameCanvas(!1,!0);this.__renderBranch(Gh,Lh),$h.opacity=Lh.dimOpacity?Eh.opacity*Lh.dimOpacity:Eh.opacity,$h.copyWorldByReset(Gh,Sh,Sh,Eh.__blendMode,!0),Gh.recycle(Sh)}else this.__renderBranch($h,Lh)}},__renderBranch($h,Lh){if(this.__hasMask)this.__renderMask($h,Lh);else{let Sh;const{children:Eh}=this;for(let Gh=0,Ah=Eh.length;Gh<Ah;Gh++)Sh=Eh[Gh],Da(Sh,Lh)||(Sh.__.complex?Sh.__renderComplex($h,Lh):Sh.__render($h,Lh))}},__clip($h,Lh){if(this.__worldOpacity){const{children:Sh}=this;for(let Eh=0,Gh=Sh.length;Eh<Gh;Eh++)Da(Sh[Eh],Lh)||Sh[Eh].__clip($h,Lh)}}},Fa={},{LEAF:Ua,create:ja}=g,{stintSet:Va}=_,{toInnerPoint:Ha,toOuterPoint:Ga,multiplyParent:qa}=q$1,{toOuterOf:Qa}=zt$2,{copy:Ja,move:Za}=ot$2,{moveLocal:$a,zoomOfLocal:Ka,rotateOfLocal:th,skewOfLocal:eh,moveWorld:sh,zoomOfWorld:rh,rotateOfWorld:ih,skewOfWorld:nh,transform:oh,transformWorld:ah,setTransform:hh,getFlipTransform:lh,getLocalOrigin:dh,getRelativeWorld:ch,drop:uh}=co;let _h=class{get tag(){return this.__tag}set tag($h){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return f}get __LayoutProcessor(){return Do}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get scrollWorldTransform(){return this.updateLayout(),this.__scrollWorld||this.__world}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.updateLayout(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){return this.leaferIsCreated&&this.leafer.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event($h){this.on($h)}constructor($h){this.innerId=ja(Ua),this.reset($h),this.__bubbleMap&&this.__emitLifeEvent(zo.CREATED)}reset($h){this.leafer&&this.leafer.forceRender(this.__world),$h!==0&&(this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},$h!==null&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0})),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),$h&&($h.__&&($h=$h.toJSON()),$h.children?this.set($h):Object.assign(this,$h))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent($h,Lh){Lh&&($h=$h.bind(Lh)),this.parent?$h():this.on(zo.ADD,$h,"once")}waitLeafer($h,Lh){Lh&&($h=$h.bind(Lh)),this.leafer?$h():this.on(zo.MOUNTED,$h,"once")}nextRender($h,Lh,Sh){this.leafer?this.leafer.nextRender($h,Lh,Sh):this.waitLeafer(()=>this.leafer.nextRender($h,Lh,Sh))}removeNextRender($h){this.nextRender($h,null,"off")}__bindLeafer($h){if(this.isLeafer&&$h!==null&&($h=this),this.leafer&&!$h&&this.leafer.leafs--,this.leafer=$h,$h?($h.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(zo.MOUNTED)):this.__emitLifeEvent(zo.UNMOUNTED),this.isBranch){const{children:Lh}=this;for(let Sh=0,Eh=Lh.length;Sh<Eh;Sh++)Lh[Sh].__bindLeafer($h)}}set($h,Lh){}get($h){}setAttr($h,Lh){this[$h]=Lh}getAttr($h){return this[$h]}getComputedAttr($h){return this.__[$h]}toJSON($h){return $h&&this.__layout.update(),this.__.__getInputData(null,$h)}toString($h){return JSON.stringify(this.toJSON($h))}toSVG(){}__SVG($h){}toHTML(){}__setAttr($h,Lh){return!0}__getAttr($h){}setProxyAttr($h,Lh){}getProxyAttr($h){}find($h,Lh){}findTag($h){}findOne($h,Lh){}findId($h){}focus($h){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate($h){s($h)?$h="width":$h==="surface"&&($h="blendMode");const Lh=this.__.__getInput($h);this.__[$h]=s(Lh)?null:void 0,this[$h]=Lh}forceRender($h,Lh){this.forceUpdate("surface")}__extraUpdate(){this.leaferIsReady&&this.leafer.layouter.addExtra(this)}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds($h,Lh){}__updateContentBounds(){}__updateStrokeBounds($h){}__updateRenderBounds($h){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser($h){this.__hasEraser=!!$h||this.children.some(Lh=>Lh.__.eraser)}__renderEraser($h,Lh){$h.save(),this.__clip($h,Lh);const{renderBounds:Sh}=this.__layout;$h.clearRect(Sh.x,Sh.y,Sh.width,Sh.height),$h.restore()}__updateMask($h){this.__hasMask=this.children.some(Lh=>Lh.__.mask&&Lh.__.visible&&Lh.__.opacity)}__renderMask($h,Lh){}__getNowWorld($h){if($h.matrix){this.__cameraWorld||(this.__cameraWorld={});const Lh=this.__cameraWorld,Sh=this.__world;return qa(Sh,$h.matrix,Lh,void 0,Sh),Qa(this.__layout.renderBounds,Lh,Lh),Va(Lh,"half",Sh.half),Va(Lh,"ignorePixelSnap",Sh.ignorePixelSnap),Lh}return this.__world}getClampRenderScale(){let{scaleX:$h}=this.__nowWorld||this.__world;return $h<0&&($h=-$h),$h>1?$h:1}getRenderScaleData($h,Lh){let{scaleX:Sh,scaleY:Eh}=en.patternLocked?this.__world:this.__nowWorld;return $h&&(Sh<0&&(Sh=-Sh),Eh<0&&(Eh=-Eh)),(Lh===!0||Lh==="zoom-in"&&Sh>1&&Eh>1)&&(Sh=Eh=1),Fa.scaleX=Sh,Fa.scaleY=Eh,Fa}getTransform($h){return this.__layout.getTransform($h||"local")}getBounds($h,Lh){return this.__layout.getBounds($h,Lh)}getLayoutBounds($h,Lh,Sh){return this.__layout.getLayoutBounds($h,Lh,Sh)}getLayoutPoints($h,Lh){return this.__layout.getLayoutPoints($h,Lh)}getWorldBounds($h,Lh,Sh){const Eh=Lh?ch(this,Lh):this.worldTransform,Gh=Sh?$h:{};return Qa($h,Eh,Gh),Gh}worldToLocal($h,Lh,Sh,Eh){this.parent?this.parent.worldToInner($h,Lh,Sh,Eh):Lh&&Ja(Lh,$h)}localToWorld($h,Lh,Sh,Eh){this.parent?this.parent.innerToWorld($h,Lh,Sh,Eh):Lh&&Ja(Lh,$h)}worldToInner($h,Lh,Sh,Eh){Eh&&(Eh.innerToWorld($h,Lh,Sh),$h=Lh||$h),Ha(this.scrollWorldTransform,$h,Lh,Sh)}innerToWorld($h,Lh,Sh,Eh){Ga(this.scrollWorldTransform,$h,Lh,Sh),Eh&&Eh.worldToInner(Lh||$h,null,Sh)}getBoxPoint($h,Lh,Sh,Eh){return this.getBoxPointByInner(this.getInnerPoint($h,Lh,Sh,Eh),null,null,!0)}getBoxPointByInner($h,Lh,Sh,Eh){const Gh=Eh?$h:Object.assign({},$h),{x:Ah,y:Ph}=this.boxBounds;return Za(Gh,-Ah,-Ph),Gh}getInnerPoint($h,Lh,Sh,Eh){const Gh=Eh?$h:{};return this.worldToInner($h,Gh,Sh,Lh),Gh}getInnerPointByBox($h,Lh,Sh,Eh){const Gh=Eh?$h:Object.assign({},$h),{x:Ah,y:Ph}=this.boxBounds;return Za(Gh,Ah,Ph),Gh}getInnerPointByLocal($h,Lh,Sh,Eh){return this.getInnerPoint($h,this.parent,Sh,Eh)}getLocalPoint($h,Lh,Sh,Eh){const Gh=Eh?$h:{};return this.worldToLocal($h,Gh,Sh,Lh),Gh}getLocalPointByInner($h,Lh,Sh,Eh){return this.getWorldPoint($h,this.parent,Sh,Eh)}getPagePoint($h,Lh,Sh,Eh){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint($h,Lh,Sh,Eh)}getWorldPoint($h,Lh,Sh,Eh){const Gh=Eh?$h:{};return this.innerToWorld($h,Gh,Sh,Lh),Gh}getWorldPointByBox($h,Lh,Sh,Eh){return this.getWorldPoint(this.getInnerPointByBox($h,null,null,Eh),Lh,Sh,!0)}getWorldPointByLocal($h,Lh,Sh,Eh){const Gh=Eh?$h:{};return this.localToWorld($h,Gh,Sh,Lh),Gh}getWorldPointByPage($h,Lh,Sh,Eh){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint($h,Lh,Sh,Eh)}setTransform($h,Lh,Sh){hh(this,$h,Lh,Sh)}transform($h,Lh,Sh){oh(this,$h,Lh,Sh)}move($h,Lh,Sh){$a(this,$h,Lh,Sh)}moveInner($h,Lh,Sh){sh(this,$h,Lh,!0,Sh)}scaleOf($h,Lh,Sh,Eh,Gh){Ka(this,dh(this,$h),Lh,Sh,Eh,Gh)}rotateOf($h,Lh,Sh){th(this,dh(this,$h),Lh,Sh)}skewOf($h,Lh,Sh,Eh,Gh){eh(this,dh(this,$h),Lh,Sh,Eh,Gh)}transformWorld($h,Lh,Sh){ah(this,$h,Lh,Sh)}moveWorld($h,Lh,Sh){sh(this,$h,Lh,!1,Sh)}scaleOfWorld($h,Lh,Sh,Eh,Gh){rh(this,$h,Lh,Sh,Eh,Gh)}rotateOfWorld($h,Lh){ih(this,$h,Lh)}skewOfWorld($h,Lh,Sh,Eh,Gh){nh(this,$h,Lh,Sh,Eh,Gh)}flip($h,Lh){oh(this,lh(this,$h),!1,Lh)}scaleResize($h,Lh=$h,Sh){this.scaleX*=$h,this.scaleY*=Lh}__scaleResize($h,Lh){}resizeWidth($h){}resizeHeight($h){}hit($h,Lh){return!0}__hitWorld($h,Lh){return!0}__hit($h,Lh){return!0}__hitFill($h){return!0}__hitStroke($h,Lh){return!0}__hitPixel($h){return!0}__drawHitPath($h){}__updateHitCanvas(){}__render($h,Lh){}__renderComplex($h,Lh){}__drawFast($h,Lh){}__draw($h,Lh,Sh){}__clip($h,Lh){}__renderShape($h,Lh){}__drawShape($h,Lh){}__updateWorldOpacity(){}__updateChange(){}__drawPath($h){}__drawRenderPath($h){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return he$2.need("path")}getMotionPoint($h){return he$2.need("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation($h,Lh){}__updateSortChildren(){}add($h,Lh){}remove($h,Lh){this.parent&&this.parent.remove(this,Lh)}dropTo($h,Lh,Sh){uh(this,$h,Lh,Sh)}on($h,Lh,Sh){}off($h,Lh,Sh){}on_($h,Lh,Sh,Eh){}off_($h){}once($h,Lh,Sh,Eh){}emit($h,Lh,Sh){}emitEvent($h,Lh){}hasEvent($h,Lh){return!1}static changeAttr($h,Lh,Sh){Sh?this.addAttr($h,Lh,Sh):Un(this.prototype,$h,Lh)}static addAttr($h,Lh,Sh,Eh){Sh||(Sh=bn),Sh(Lh,Eh)(this.prototype,$h)}__emitLifeEvent($h){this.hasEvent($h)&&this.emitEvent(new zo($h,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(zo.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}};_h=ye$2([Jn(Ba),Jn(Sa),Jn(Na),Jn(wa),Jn(Ya)],_h);const{setListWithFn:ph}=zt$2,{sort:fh}=vo,{localBoxBounds:gh,localStrokeBounds:yh,localRenderBounds:mh,maskLocalBoxBounds:xh,maskLocalStrokeBounds:wh,maskLocalRenderBounds:bh}=xo,Bh=new ee$2("Branch");let vh=class extends _h{__updateStrokeSpread(){const{children:$h}=this;for(let Lh=0,Sh=$h.length;Lh<Sh;Lh++)if($h[Lh].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:$h}=this;for(let Lh=0,Sh=$h.length;Lh<Sh;Lh++)if($h[Lh].__layout.renderSpread)return 1;return 0}__updateBoxBounds($h,Lh){ph(Lh||this.__layout.boxBounds,this.children,this.__hasMask?xh:gh)}__updateStrokeBounds($h){ph($h||this.__layout.strokeBounds,this.children,this.__hasMask?wh:yh)}__updateRenderBounds($h){ph($h||this.__layout.renderBounds,this.children,this.__hasMask?bh:mh)}__updateSortChildren(){let $h;const{children:Lh}=this;if(Lh.length>1){for(let Sh=0,Eh=Lh.length;Sh<Eh;Sh++)Lh[Sh].__tempNumber=Sh,Lh[Sh].__.zIndex&&($h=!0);Lh.sort(fh),this.__layout.affectChildrenSort=$h}}add($h,Lh){if($h===this||$h.destroyed)return Bh.warn("add self or destroyed");const Sh=s(Lh);if(!$h.__){if(l($h))return $h.forEach(Gh=>{this.add(Gh,Lh),Sh||Lh++});if(!($h=ce$2.get($h.tag,$h)))return}$h.parent&&$h.parent.remove($h),$h.parent=this,Sh?this.children.push($h):this.children.splice(Lh,0,$h),$h.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1);const Eh=$h.__layout;Eh.boxChanged||Eh.boxChange(),Eh.matrixChanged||Eh.matrixChange(),$h.__bubbleMap&&$h.__emitLifeEvent(zo.ADD),this.leafer&&($h.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(zo.ADD,$h)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...$h){this.add($h)}remove($h,Lh){$h?$h.__?$h.animationOut?$h.__runAnimation("out",()=>this.__remove($h,Lh)):this.__remove($h,Lh):this.find($h).forEach(Sh=>this.remove(Sh,Lh)):s($h)&&super.remove(null,Lh)}removeAll($h){const{children:Lh}=this;Lh.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,Lh.forEach(Sh=>{this.__realRemoveChild(Sh),$h&&Sh.destroy()}))}clear(){this.removeAll(!0)}__remove($h,Lh){const Sh=this.children.indexOf($h);Sh>-1&&(this.children.splice(Sh,1),$h.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild($h),Lh&&$h.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild($h){$h.__emitLifeEvent(zo.REMOVE),$h.parent=null,this.leafer&&($h.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(zo.REMOVE,$h),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent($h,Lh){const Sh=new zo($h,Lh,this);this.hasEvent($h)&&!this.isLeafer&&this.emitEvent(Sh),this.leafer.emitEvent(Sh)}};vh=ye$2([Jn(za)],vh);class kh{get length(){return this.list.length}constructor(Lh){this.reset(),Lh&&(l(Lh)?this.addList(Lh):this.add(Lh))}has(Lh){return Lh&&!s(this.keys[Lh.innerId])}indexAt(Lh){return this.list[Lh]}indexOf(Lh){const Sh=this.keys[Lh.innerId];return s(Sh)?-1:Sh}add(Lh){const{list:Sh,keys:Eh}=this;s(Eh[Lh.innerId])&&(Sh.push(Lh),Eh[Lh.innerId]=Sh.length-1)}addAt(Lh,Sh=0){const{keys:Eh}=this;if(s(Eh[Lh.innerId])){const{list:Gh}=this;for(let Ah=Sh,Ph=Gh.length;Ah<Ph;Ah++)Eh[Gh[Ah].innerId]++;Sh===0?Gh.unshift(Lh):(Sh>Gh.length&&(Sh=Gh.length),Gh.splice(Sh,0,Lh)),Eh[Lh.innerId]=Sh}}addList(Lh){for(let Sh=0;Sh<Lh.length;Sh++)this.add(Lh[Sh])}remove(Lh){const{list:Sh}=this;let Eh;for(let Gh=0,Ah=Sh.length;Gh<Ah;Gh++)s(Eh)?Sh[Gh].innerId===Lh.innerId&&(Eh=Gh,delete this.keys[Lh.innerId]):this.keys[Sh[Gh].innerId]=Gh-1;s(Eh)||Sh.splice(Eh,1)}sort(Lh){const{list:Sh}=this;Lh?Sh.sort((Eh,Gh)=>Gh.__level-Eh.__level):Sh.sort((Eh,Gh)=>Eh.__level-Gh.__level)}forEach(Lh){this.list.forEach(Lh)}clone(){const Lh=new kh;return Lh.list=[...this.list],Lh.keys=Object.assign({},this.keys),Lh}update(){this.keys={};const{list:Lh,keys:Sh}=this;for(let Eh=0,Gh=Lh.length;Eh<Gh;Eh++)Sh[Lh[Eh].innerId]=Eh}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class Ch{get length(){return this._length}constructor(Lh){this._length=0,this.reset(),Lh&&(l(Lh)?this.addList(Lh):this.add(Lh))}has(Lh){return!s(this.keys[Lh.innerId])}without(Lh){return s(this.keys[Lh.innerId])}sort(Lh){const{levels:Sh}=this;Lh?Sh.sort((Eh,Gh)=>Gh-Eh):Sh.sort((Eh,Gh)=>Eh-Gh)}addList(Lh){Lh.forEach(Sh=>{this.add(Sh)})}add(Lh){const{keys:Sh,levelMap:Eh}=this;Sh[Lh.innerId]||(Sh[Lh.innerId]=1,Eh[Lh.__level]?Eh[Lh.__level].push(Lh):(Eh[Lh.__level]=[Lh],this.levels.push(Lh.__level)),this._length++)}forEach(Lh){let Sh;this.levels.forEach(Eh=>{Sh=this.levelMap[Eh];for(let Gh=0,Ah=Sh.length;Gh<Ah;Gh++)Lh(Sh[Gh])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const Oh="2.0.2";function St$2($h,Lh,Sh,Eh){var Gh,Ah=arguments.length,Ph=Ah<3?Lh:Eh===null?Eh=Object.getOwnPropertyDescriptor(Lh,Sh):Eh;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Ph=Reflect.decorate($h,Lh,Sh,Eh);else for(var Nh=$h.length-1;Nh>=0;Nh--)(Gh=$h[Nh])&&(Ph=(Ah<3?Gh(Ph):Ah>3?Gh(Lh,Sh,Ph):Gh(Lh,Sh))||Ph);return Ah>3&&Ph&&Object.defineProperty(Lh,Sh,Ph),Ph}function mt$2($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh),Sh&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Rt$2($h){return un($h,Lh=>({set(Sh){this.__setAttr(Lh,Sh),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function kt$2(){return($h,Lh)=>{const Sh="_"+Lh;ln($h,Lh,{set(Eh){this.isLeafer&&(this[Sh]=Eh)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[Sh]||this:this.leafer&&this.leafer.zoomLayer}})}}function Bt$2($h){return(Lh,Sh)=>{ln(Lh,Sh,cn(Sh,$h))}}const At$2={},Ct$2={hasTransparent:function($h){if(!$h||$h.length===7||$h.length===4)return!1;if($h==="transparent")return!0;const Lh=$h[0];if(Lh==="#")switch($h.length){case 5:return $h[4]!=="f"&&$h[4]!=="F";case 9:return $h[7]!=="f"&&$h[7]!=="F"||$h[8]!=="f"&&$h[8]!=="F"}else if((Lh==="r"||Lh==="h")&&$h[3]==="a"){const Sh=$h.lastIndexOf(",");if(Sh>-1)return parseFloat($h.slice(Sh+1))<1}return!1}},bt$2=qt$2,Pt$2={},Ft$2={},Wt$2={},Et$2={},Tt$2={},Dt$2={apply(){he$2.need("filter")}},It$2={},Lt$2={setStyleName:()=>he$2.need("state"),set:()=>he$2.need("state")},zt$1={list:{},register($h,Lh){zt$1.list[$h]=Lh},get:$h=>zt$1.list[$h]},{parse:Mt$2,objectToCanvasData:Ot$2}=sr,{stintSet:Nt$2}=_,{hasTransparent:Vt$2}=Ct$2,Ht$2={originPaint:{}},Yt$2=ee$2.get("UIData");let Ut$2=class extends f{get scale(){const{scaleX:$h,scaleY:Lh}=this;return $h!==Lh?{x:$h,y:Lh}:$h}get __strokeWidth(){return this.__getRealStrokeWidth()}get __maxStrokeWidth(){const $h=this;return $h.__hasMultiStrokeStyle?Math.max($h.__hasMultiStrokeStyle,$h.strokeWidth):$h.strokeWidth}get __hasMultiPaint(){const $h=this;return $h.fill&&this.__useStroke||$h.__isFills&&$h.fill.length>1||$h.__isStrokes&&$h.stroke.length>1||$h.__useEffect}get __clipAfterFill(){const $h=this;return $h.cornerRadius||$h.innerShadow||$h.__pathInputed}get __hasSurface(){return this.fill||this.stroke}get __autoWidth(){return this._width==null}get __autoHeight(){return this._height==null}get __autoSide(){return this._width==null||this._height==null}get __autoSize(){return this._width==null&&this._height==null}setVisible($h){this._visible=$h;const{leafer:Lh}=this.__leaf;Lh&&(Lh.watcher.hasVisible=!0)}setWidth($h){$h<0?(this._width=-$h,this.__leaf.scaleX*=-1,Yt$2.warn("width < 0, instead -scaleX ",this)):this._width=$h}setHeight($h){$h<0?(this._height=-$h,this.__leaf.scaleY*=-1,Yt$2.warn("height < 0, instead -scaleY",this)):this._height=$h}setFill($h){this.__naturalWidth&&this.__removeNaturalSize(),i($h)||!$h?(Nt$2(this,"__isTransparentFill",Vt$2($h)),this.__isFills&&this.__removePaint("fill",!0),this._fill=$h):d($h)&&this.__setPaint("fill",$h)}setStroke($h){i($h)||!$h?(Nt$2(this,"__isTransparentStroke",Vt$2($h)),this.__isStrokes&&this.__removePaint("stroke",!0),this._stroke=$h):d($h)&&this.__setPaint("stroke",$h)}setPath($h){const Lh=i($h);Lh||$h&&d($h[0])?(this.__setInput("path",$h),this._path=Lh?Mt$2($h):Ot$2($h)):(this.__input&&this.__removeInput("path"),this._path=$h)}setShadow($h){Xt$2(this,"shadow",$h)}setInnerShadow($h){Xt$2(this,"innerShadow",$h)}setFilter($h){Xt$2(this,"filter",$h)}__computePaint(){const{fill:$h,stroke:Lh}=this.__input;$h&&Ft$2.compute("fill",this.__leaf),Lh&&Ft$2.compute("stroke",this.__leaf),this.__needComputePaint=void 0}__getRealStrokeWidth($h){let{strokeWidth:Lh,strokeWidthFixed:Sh}=this;if($h&&($h.strokeWidth&&(Lh=$h.strokeWidth),s($h.strokeWidthFixed)||(Sh=$h.strokeWidthFixed)),Sh){const Eh=this.__leaf.getClampRenderScale();return Eh>1?Lh/Eh:Lh}return Lh}__setPaint($h,Lh){this.__setInput($h,Lh);const Sh=this.__leaf.__layout;Sh.boxChanged||Sh.boxChange(),l(Lh)&&!Lh.length?this.__removePaint($h):$h==="fill"?(this.__isFills=!0,this._fill||(this._fill=Ht$2)):(this.__isStrokes=!0,this._stroke||(this._stroke=Ht$2))}__removePaint($h,Lh){Lh&&this.__removeInput($h),Wt$2.recycleImage($h,this),$h==="fill"?(Nt$2(this,"__isAlphaPixelFill",void 0),this._fill=this.__isFills=void 0):(Nt$2(this,"__isAlphaPixelStroke",void 0),Nt$2(this,"__hasMultiStrokeStyle",void 0),this._stroke=this.__isStrokes=void 0)}};function Xt$2($h,Lh,Sh){$h.__setInput(Lh,Sh),l(Sh)?(Sh.some(Eh=>Eh.visible===!1)&&(Sh=Sh.filter(Eh=>Eh.visible!==!1)),Sh.length||(Sh=void 0)):Sh=Sh&&Sh.visible!==!1?[Sh]:void 0,$h["_"+Lh]=Sh}let jt$2=class extends Ut$2{},Jt$1=class extends jt$2{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return this.__single||this.__clipAfterFill}get __clipAfterFill(){const $h=this;return $h.overflow!=="show"&&$h.__leaf.children.length&&($h.__leaf.isOverflow||super.__clipAfterFill)}},qt$1=class extends jt$2{__getInputData($h,Lh){const Sh=super.__getInputData($h,Lh);return Re$2.forEach(Eh=>delete Sh[Eh]),Sh}},Gt$1=class extends Jt$1{},$t$1=class extends Ut$2{get __usePathBox(){return this.points||this.__pathInputed}},Kt$2=class extends Ut$2{get __boxStroke(){return!this.__pathInputed}},Qt$1=class extends Ut$2{get __boxStroke(){return!this.__pathInputed}},Zt$1=class extends $t$1{},te$1=class extends Ut$2{},ee$1=class extends Ut$2{get __pathInputed(){return 2}},ie$1=class extends jt$2{};const se$1={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};let oe$1=class extends Ut$2{get __useNaturalRatio(){return!1}setFontWeight($h){i($h)?(this.__setInput("fontWeight",$h),$h=se$1[$h]||400):this.__input&&this.__removeInput("fontWeight"),this._fontWeight=$h}setBoxStyle($h){let Lh=this.__leaf,Sh=Lh.__box;if($h){const{boxStyle:Eh}=this;if(Sh)for(let Ph in Eh)Sh[Ph]=void 0;else Sh=Lh.__box=ce$2.get("Rect",0);const Gh=Lh.__layout,Ah=Sh.__layout;Eh||(Sh.parent=Lh,Sh.__world=Lh.__world,Ah.boxBounds=Gh.boxBounds),Sh.set($h),Ah.strokeChanged&&Gh.strokeChange()}else Sh&&(Lh.__box=Sh.parent=null,Sh.destroy());this._boxStyle=$h}__getInputData($h,Lh){const Sh=super.__getInputData($h,Lh);return Sh.textEditing&&delete Sh.textEditing,Sh}},re$1=class extends Kt$2{get __urlType(){return"image"}setUrl($h){this.__setImageFill($h),this._url=$h}__setImageFill($h){this.fill=$h?{type:this.__urlType,mode:"stretch",url:$h}:void 0}__getData(){const $h=super.__getData();return $h.url&&delete $h.fill,$h}__getInputData($h,Lh){const Sh=super.__getInputData($h,Lh);return Sh.url&&delete Sh.fill,Sh}},ae$1=class extends Kt$2{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData($h,Lh){const Sh=super.__getInputData($h,Lh);return Sh.url=this.__leaf.canvas.toDataURL("image/png"),Sh}};const{max:ne$1,add:_e$1}=v,he$1={__updateStrokeSpread(){let $h=0,Lh=0;const Sh=this.__,{strokeAlign:Eh,__maxStrokeWidth:Gh}=Sh,Ah=this.__box;if((Sh.stroke||Sh.hitStroke==="all")&&Gh&&Eh!=="inside"&&(Lh=$h=Eh==="center"?Gh/2:Gh,!Sh.__boxStroke)){const Ph=Sh.__isLinePath?0:10*$h,Nh=Sh.strokeCap==="none"?0:Gh;$h+=Math.max(Ph,Nh)}return Sh.__useArrow&&($h+=5*Gh),Ah&&($h=ne$1($h,Ah.__layout.strokeSpread=Ah.__updateStrokeSpread()),Lh=Math.max(Lh,Ah.__layout.strokeBoxSpread)),this.__layout.strokeBoxSpread=Lh,$h},__updateRenderSpread(){let $h=0;const{shadow:Lh,innerShadow:Sh,blur:Eh,backgroundBlur:Gh,filter:Ah,renderSpread:Ph}=this.__,{strokeSpread:Nh}=this.__layout,Mh=this.__box;Lh&&($h=Tt$2.getShadowRenderSpread(this,Lh)),Eh&&($h=ne$1($h,Eh)),Ah&&($h=_e$1($h,Dt$2.getSpread(Ah))),Ph&&($h=_e$1($h,Ph)),Nh&&($h=_e$1($h,Nh));let Dh=$h;return Sh&&(Dh=ne$1(Dh,Tt$2.getInnerShadowSpread(this,Sh))),Gh&&(Dh=ne$1(Dh,Gh)),this.__layout.renderShapeSpread=Dh,Mh?ne$1(Mh.__updateRenderSpread(),$h):$h}},{stintSet:de$1}=_,le$1={__updateChange(){const $h=this.__;if($h.__useStroke){const Lh=$h.__useStroke=!(!$h.stroke||!$h.strokeWidth);de$1(this.__world,"half",Lh&&$h.strokeAlign==="center"&&$h.strokeWidth%2),de$1($h,"__fillAfterStroke",Lh&&$h.strokeAlign==="outside"&&$h.fill&&!$h.__isTransparentFill)}if($h.__useEffect){const{shadow:Lh,fill:Sh,stroke:Eh}=$h,Gh=$h.innerShadow||$h.blur||$h.backgroundBlur||$h.filter;de$1($h,"__isFastShadow",Lh&&!Gh&&Lh.length<2&&!Lh[0].spread&&!Tt$2.isTransformShadow(Lh[0])&&Sh&&!$h.__isTransparentFill&&!(l(Sh)&&Sh.length>1)&&(this.useFastShadow||!Eh||Eh&&$h.strokeAlign==="inside")),$h.__useEffect=!(!Lh&&!Gh)}$h.__checkSingle(),de$1($h,"__complex",$h.__isFills||$h.__isStrokes||$h.cornerRadius||$h.__useEffect)},__drawFast($h,Lh){pe$1(this,$h,Lh)},__draw($h,Lh,Sh){const Eh=this.__;if(Eh.__complex){Eh.__needComputePaint&&Eh.__computePaint();const{fill:Gh,stroke:Ah,__drawAfterFill:Ph,__fillAfterStroke:Nh,__isFastShadow:Mh}=Eh;if(this.__drawRenderPath($h),Eh.__useEffect&&!Mh){const Dh=Ft$2.shape(this,$h,Lh);this.__nowWorld=this.__getNowWorld(Lh);const{shadow:Fh,innerShadow:Ih,filter:Hh}=Eh;Fh&&Tt$2.shadow(this,$h,Dh),Nh&&(Eh.__isStrokes?Ft$2.strokes(Ah,this,$h,Lh):Ft$2.stroke(Ah,this,$h,Lh)),Gh&&(Eh.__isFills?Ft$2.fills(Gh,this,$h,Lh):Ft$2.fill(Gh,this,$h,Lh)),Ph&&this.__drawAfterFill($h,Lh),Ih&&Tt$2.innerShadow(this,$h,Dh),Ah&&!Nh&&(Eh.__isStrokes?Ft$2.strokes(Ah,this,$h,Lh):Ft$2.stroke(Ah,this,$h,Lh)),Hh&&Dt$2.apply(Hh,this,this.__nowWorld,$h,Sh,Dh),Dh.worldCanvas&&Dh.worldCanvas.recycle(),Dh.canvas.recycle()}else{if(Nh&&(Eh.__isStrokes?Ft$2.strokes(Ah,this,$h,Lh):Ft$2.stroke(Ah,this,$h,Lh)),Mh){const Dh=Eh.shadow[0],{scaleX:Fh,scaleY:Ih}=this.getRenderScaleData(!0,Dh.scaleFixed);$h.save(),$h.setWorldShadow(Dh.x*Fh,Dh.y*Ih,Dh.blur*Fh,Ct$2.string(Dh.color))}Gh&&(Eh.__isFills?Ft$2.fills(Gh,this,$h,Lh):Ft$2.fill(Gh,this,$h,Lh)),Mh&&$h.restore(),Ph&&this.__drawAfterFill($h,Lh),Ah&&!Nh&&(Eh.__isStrokes?Ft$2.strokes(Ah,this,$h,Lh):Ft$2.stroke(Ah,this,$h,Lh))}}else Eh.__pathForRender?pe$1(this,$h,Lh):this.__drawFast($h,Lh)},__drawShape($h,Lh){this.__drawRenderPath($h);const Sh=this.__,{fill:Eh,stroke:Gh}=Sh;Eh&&!Lh.ignoreFill&&(Sh.__isAlphaPixelFill?Ft$2.fills(Eh,this,$h,Lh):Ft$2.fill("#000000",this,$h,Lh)),Sh.__isCanvas&&this.__drawAfterFill($h,Lh),Gh&&!Lh.ignoreStroke&&(Sh.__isAlphaPixelStroke?Ft$2.strokes(Gh,this,$h,Lh):Ft$2.stroke("#000000",this,$h,Lh))},__drawAfterFill($h,Lh){this.__.__clipAfterFill?($h.save(),$h.clipUI(this),this.__drawContent($h,Lh),$h.restore()):this.__drawContent($h,Lh)}};function pe$1($h,Lh,Sh){const{fill:Eh,stroke:Gh,__drawAfterFill:Ah,__fillAfterStroke:Ph}=$h.__;$h.__drawRenderPath(Lh),Ph&&Ft$2.stroke(Gh,$h,Lh,Sh),Eh&&Ft$2.fill(Eh,$h,Lh,Sh),Ah&&$h.__drawAfterFill(Lh,Sh),Gh&&!Ph&&Ft$2.stroke(Gh,$h,Lh,Sh)}const ue$1={__drawFast($h,Lh){let{x:Sh,y:Eh,width:Gh,height:Ah}=this.__layout.boxBounds;const{fill:Ph,stroke:Nh,__drawAfterFill:Mh}=this.__;if(Ph&&($h.fillStyle=Ph,$h.fillRect(Sh,Eh,Gh,Ah)),Mh&&this.__drawAfterFill($h,Lh),Nh){const{strokeAlign:Dh,__strokeWidth:Fh}=this.__;if(!Fh)return;$h.setStroke(Nh,Fh,this.__);const Ih=Fh/2;switch(Dh){case"center":$h.strokeRect(0,0,Gh,Ah);break;case"inside":Gh-=Fh,Ah-=Fh,Gh<0||Ah<0?($h.save(),this.__clip($h,Lh),$h.strokeRect(Sh+Ih,Eh+Ih,Gh,Ah),$h.restore()):$h.strokeRect(Sh+Ih,Eh+Ih,Gh,Ah);break;case"outside":$h.strokeRect(Sh-Ih,Eh-Ih,Gh+Fh,Ah+Fh)}}}};var ce$1;let ge$1=ce$1=class extends _h{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale($h){I$1.assignScale(this,$h)}get scale(){return this.__.scale}get isAutoWidth(){const $h=this.__;return $h.__autoWidth||$h.autoWidth}get isAutoHeight(){const $h=this.__;return $h.__autoHeight||$h.autoHeight}get pen(){const{path:$h}=this.__;return ji$1.set(this.path=$h||[]),$h||this.__drawPathByBox(ji$1),ji$1}reset($h){}set($h,Lh){$h&&Object.assign(this,$h)}get($h){return i($h)?this.__.__getInput($h):this.__.__getInputData($h)}createProxyData(){}find($h,Lh){return he$2.need("find")}findTag($h){return this.find({tag:$h})}findOne($h,Lh){return he$2.need("find")}findId($h){return this.findOne({id:$h})}getPath($h,Lh){this.__layout.update();let Sh=Lh?this.__.__pathForRender:this.__.path;return Sh||(ji$1.set(Sh=[]),this.__drawPathByBox(ji$1,!Lh)),$h?sr.toCanvasData(Sh,!0):Sh}getPathString($h,Lh,Sh){return sr.stringify(this.getPath($h,Lh),Sh)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const $h=this.__;!$h.lazy||this.__inLazyBounds||It$2.running?$h.__computePaint():$h.__needComputePaint=!0}}__updateRenderPath(){const $h=this.__;$h.path?($h.__pathForRender=$h.cornerRadius?Fi$1.smooth($h.path,$h.cornerRadius,$h.cornerSmoothing):$h.path,$h.__useArrow&&Pt$2.addArrows(this)):$h.__pathForRender&&($h.__pathForRender=void 0)}__drawRenderPath($h){$h.beginPath(),this.__drawPathByData($h,this.__.__pathForRender)}__drawPath($h){$h.beginPath(),this.__drawPathByData($h,this.__.path,!0)}__drawPathByData($h,Lh,Sh){Lh?ri$2.drawPathByData($h,Lh):this.__drawPathByBox($h,Sh)}__drawPathByBox($h,Lh){const{x:Sh,y:Eh,width:Gh,height:Ah}=this.__layout.boxBounds;if(this.__.cornerRadius&&!Lh){const{cornerRadius:Ph}=this.__;$h.roundRect(Sh,Eh,Gh,Ah,o(Ph)?[Ph]:Ph)}else $h.rect(Sh,Eh,Gh,Ah);$h.closePath()}drawImagePlaceholder($h,Lh,Sh){Ft$2.fill(this.__.placeholderColor,this,Lh,Sh)}animate($h,Lh,Sh,Eh){return this.set($h),he$2.need("animate")}killAnimate($h,Lh){}export($h,Lh){return he$2.need("export")}syncExport($h,Lh){return he$2.need("export")}clone($h){const Lh=_.clone(this.toJSON());return $h&&Object.assign(Lh,$h),ce$1.one(Lh)}static one($h,Lh,Sh,Eh,Gh){return ce$2.get($h.tag||this.prototype.__tag,$h,Lh,Sh,Eh,Gh)}static registerUI(){Zn()(this)}static registerData($h){zn($h)(this.prototype)}static setEditConfig($h){}static setEditOuter($h){}static setEditInner($h){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}};St$2([zn(Ut$2)],ge$1.prototype,"__",void 0),St$2([kt$2()],ge$1.prototype,"zoomLayer",void 0),St$2([fn("")],ge$1.prototype,"id",void 0),St$2([fn("")],ge$1.prototype,"name",void 0),St$2([fn("")],ge$1.prototype,"className",void 0),St$2([Ln("pass-through")],ge$1.prototype,"blendMode",void 0),St$2([En(1)],ge$1.prototype,"opacity",void 0),St$2([In(!0)],ge$1.prototype,"visible",void 0),St$2([Ln(!1)],ge$1.prototype,"locked",void 0),St$2([Rn(!1)],ge$1.prototype,"dim",void 0),St$2([Rn(!1)],ge$1.prototype,"dimskip",void 0),St$2([Wn(0)],ge$1.prototype,"zIndex",void 0),St$2([Nn(!1)],ge$1.prototype,"mask",void 0),St$2([Yn(!1)],ge$1.prototype,"eraser",void 0),St$2([gn(0,!0)],ge$1.prototype,"x",void 0),St$2([gn(0,!0)],ge$1.prototype,"y",void 0),St$2([bn(100,!0)],ge$1.prototype,"width",void 0),St$2([bn(100,!0)],ge$1.prototype,"height",void 0),St$2([xn(1,!0)],ge$1.prototype,"scaleX",void 0),St$2([xn(1,!0)],ge$1.prototype,"scaleY",void 0),St$2([wn(0,!0)],ge$1.prototype,"rotation",void 0),St$2([wn(0,!0)],ge$1.prototype,"skewX",void 0),St$2([wn(0,!0)],ge$1.prototype,"skewY",void 0),St$2([gn(0,!0)],ge$1.prototype,"offsetX",void 0),St$2([gn(0,!0)],ge$1.prototype,"offsetY",void 0),St$2([yn(0,!0)],ge$1.prototype,"scrollX",void 0),St$2([yn(0,!0)],ge$1.prototype,"scrollY",void 0),St$2([mn()],ge$1.prototype,"origin",void 0),St$2([mn()],ge$1.prototype,"around",void 0),St$2([fn(!1)],ge$1.prototype,"lazy",void 0),St$2([Bn(1)],ge$1.prototype,"pixelRatio",void 0),St$2([Sn(0)],ge$1.prototype,"renderSpread",void 0),St$2([kn()],ge$1.prototype,"path",void 0),St$2([Cn()],ge$1.prototype,"windingRule",void 0),St$2([Cn(!0)],ge$1.prototype,"closed",void 0),St$2([bn(0)],ge$1.prototype,"padding",void 0),St$2([bn(!1)],ge$1.prototype,"lockRatio",void 0),St$2([bn()],ge$1.prototype,"widthRange",void 0),St$2([bn()],ge$1.prototype,"heightRange",void 0),St$2([fn(!1)],ge$1.prototype,"draggable",void 0),St$2([fn()],ge$1.prototype,"dragBounds",void 0),St$2([fn("auto")],ge$1.prototype,"dragBoundsType",void 0),St$2([fn(!1)],ge$1.prototype,"editable",void 0),St$2([Dn(!0)],ge$1.prototype,"hittable",void 0),St$2([Dn("path")],ge$1.prototype,"hitFill",void 0),St$2([Pn("path")],ge$1.prototype,"hitStroke",void 0),St$2([Dn(!1)],ge$1.prototype,"hitBox",void 0),St$2([Dn(!0)],ge$1.prototype,"hitChildren",void 0),St$2([Dn(!0)],ge$1.prototype,"hitSelf",void 0),St$2([Dn()],ge$1.prototype,"hitRadius",void 0),St$2([Xn("")],ge$1.prototype,"cursor",void 0),St$2([Ln()],ge$1.prototype,"fill",void 0),St$2([Pn(void 0,!0)],ge$1.prototype,"stroke",void 0),St$2([Pn("inside")],ge$1.prototype,"strokeAlign",void 0),St$2([Pn(1,!0)],ge$1.prototype,"strokeWidth",void 0),St$2([Pn(!1)],ge$1.prototype,"strokeWidthFixed",void 0),St$2([Pn("none")],ge$1.prototype,"strokeCap",void 0),St$2([Pn("miter")],ge$1.prototype,"strokeJoin",void 0),St$2([Pn()],ge$1.prototype,"dashPattern",void 0),St$2([Pn(0)],ge$1.prototype,"dashOffset",void 0),St$2([Pn(10)],ge$1.prototype,"miterLimit",void 0),St$2([Cn(0)],ge$1.prototype,"cornerRadius",void 0),St$2([Cn()],ge$1.prototype,"cornerSmoothing",void 0),St$2([mt$2()],ge$1.prototype,"shadow",void 0),St$2([mt$2()],ge$1.prototype,"innerShadow",void 0),St$2([mt$2()],ge$1.prototype,"blur",void 0),St$2([mt$2()],ge$1.prototype,"backgroundBlur",void 0),St$2([mt$2()],ge$1.prototype,"grayscale",void 0),St$2([mt$2()],ge$1.prototype,"filter",void 0),St$2([Ln()],ge$1.prototype,"placeholderColor",void 0),St$2([fn(100)],ge$1.prototype,"placeholderDelay",void 0),St$2([fn({})],ge$1.prototype,"data",void 0),St$2([Gn(_h.prototype.reset)],ge$1.prototype,"reset",null),ge$1=ce$1=St$2([Jn(he$1),Jn(le$1),qn()],ge$1);let ye$1=class extends ge$1{get __tag(){return"Group"}get isBranch(){return!0}reset($h){this.__setBranch(),super.reset($h)}__setBranch(){this.children||(this.children=[])}set($h,Lh){if($h)if($h.children){const{children:Sh}=$h;delete $h.children,this.children?this.clear():this.__setBranch(),super.set($h,Lh),Sh.forEach(Eh=>this.add(Eh)),$h.children=Sh}else super.set($h,Lh)}toJSON($h){const Lh=super.toJSON($h);if(!this.childlessJSON){const Sh=Lh.children=[];this.children.forEach(Eh=>Eh.skipJSON||Sh.push(Eh.toJSON($h)))}return Lh}pick($h,Lh){}addAt($h,Lh){this.add($h,Lh)}addAfter($h,Lh){this.add($h,this.children.indexOf(Lh)+1)}addBefore($h,Lh){this.add($h,this.children.indexOf(Lh))}add($h,Lh){}addMany(...$h){}remove($h,Lh){}removeAll($h){}clear(){}};var ve$1;St$2([zn(jt$2)],ye$1.prototype,"__",void 0),St$2([bn(0)],ye$1.prototype,"width",void 0),St$2([bn(0)],ye$1.prototype,"height",void 0),ye$1=St$2([Jn(vh),Zn()],ye$1);const fe$1=ee$2.get("Leafer");let we$1=ve$1=class extends ye$1{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&Ki$1.isComplete}get layoutLocked(){return!this.layouter.running}get view(){return this.canvas&&this.canvas.view}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds(!0)||D()}constructor($h,Lh){super(Lh),this.config={start:!0,hittable:!0,smooth:!0,lazySpeard:100},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=$h,$h&&($h.view||$h.width)&&this.init($h),ve$1.list.add(this)}init($h,Lh){if(this.canvas)return;let Sh;const{config:Eh}=this;this.__setLeafer(this),Lh&&(this.parentApp=Lh,this.__bindApp(Lh),Sh=Lh.running),$h&&(this.parent=Lh,this.initType($h.type),this.parent=void 0,_.assign(Eh,$h));const Gh=this.canvas=le$2.canvas(Eh);this.__controllers.push(this.renderer=le$2.renderer(this,Gh,Eh),this.watcher=le$2.watcher(this,Eh),this.layouter=le$2.layouter(this,Eh)),this.isApp&&this.__setApp(),this.__checkAutoLayout(),Lh||(this.selector=le$2.selector(this),this.interaction=le$2.interaction(this,Gh,this.selector,Eh),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=le$2.hitCanvasManager()),this.canvasManager=new ge$2,Sh=Eh.start),this.hittable=Eh.hittable,this.fill=Eh.fill,this.canvasManager.add(Gh),this.__listenEvents(),Sh&&(this.__startTimer=setTimeout(this.start.bind(this))),So.run(this.__initWait),this.onInit()}onInit(){}initType($h){}set($h,Lh){this.waitInit(()=>{super.set($h,Lh)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(sa.RESTART):this.emitLeafer(sa.START),this.__controllers.forEach($h=>$h.start()),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach($h=>$h.stop()),this.running=!1,this.emitLeafer(sa.STOP))}unlockLayout($h=!0){this.layouter.start(),$h&&this.updateLayout()}lockLayout($h=!0){$h&&this.updateLayout(),this.layouter.stop()}resize($h){const Lh=_.copyAttrs({},$h,Re$2);Object.keys(Lh).forEach(Sh=>this[Sh]=Lh[Sh])}forceRender($h,Lh){const{renderer:Sh}=this;Sh&&(Sh.addBlock($h?new Vt$3($h):this.canvas.bounds),this.viewReady&&(Lh?Sh.render():Sh.update()))}requestRender($h=!1){this.renderer&&this.renderer.update($h)}updateCursor($h){const Lh=this.interaction;Lh&&($h?Lh.setCursor($h):Lh.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize($h){const{canvas:Lh}=this;if(!Lh||Lh.isSameSize($h))return;const Sh=_.copyAttrs({},this.canvas,Re$2);Lh.resize($h),this.updateLazyBounds(),this.__onResize(new $o($h,Sh))}__onResize($h){this.emitEvent($h),_.copyAttrs(this.__,$h,Re$2),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp($h){this.selector=$h.selector,this.interaction=$h.interaction,this.canvasManager=$h.canvasManager,this.hitCanvasManager=$h.hitCanvasManager}__setLeafer($h){this.leafer=$h,this.__level=1}__checkAutoLayout(){const{config:$h,parentApp:Lh}=this;Lh||($h.width&&$h.height||(this.autoLayout=new Gt$2($h)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr($h,Lh){return this.canvas&&(Re$2.includes($h)?this.__changeCanvasSize($h,Lh):$h==="fill"?this.__changeFill(Lh):$h==="hittable"?this.parent||(this.canvas.hittable=Lh):$h==="zIndex"?(this.canvas.zIndex=Lh,setTimeout(()=>this.parent&&this.parent.__updateSortChildren())):$h==="mode"&&this.emit(sa.UPDATE_MODE,{mode:Lh})),super.__setAttr($h,Lh)}__getAttr($h){return this.canvas&&Re$2.includes($h)?this.canvas[$h]:super.__getAttr($h)}__changeCanvasSize($h,Lh){const{config:Sh,canvas:Eh}=this,Gh=_.copyAttrs({},Eh,Re$2);Gh[$h]=Sh[$h]=Lh,Sh.width&&Sh.height?Eh.stopAutoLayout():this.__checkAutoLayout(),this.__doResize(Gh)}__changeFill($h){this.config.fill=$h,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=$h:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready=!0,this.emitLeafer(sa.BEFORE_READY),this.emitLeafer(sa.READY),this.emitLeafer(sa.AFTER_READY),So.run(this.__readyWait)}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(sa.VIEW_READY),So.run(this.__viewReadyWait))}__onLayoutEnd(){const{grow:$h,width:Lh,height:Sh}=this.config;if($h){let{width:Eh,height:Gh,pixelRatio:Ah}=this;const Ph=$h==="box"?this.worldBoxBounds:this.__world;Lh||(Eh=Math.max(1,Ph.x+Ph.width)),Sh||(Gh=Math.max(1,Ph.y+Ph.height)),this.__doResize({width:Eh,height:Gh,pixelRatio:Ah})}this.ready||this.__onReady()}__onNextRender(){if(this.viewReady){So.run(this.__nextRenderWait);const{imageReady:$h}=this;$h&&!this.viewCompleted&&this.__checkViewCompleted(),$h||(this.viewCompleted=!1,this.requestRender())}else this.requestRender()}__checkViewCompleted($h=!0){this.nextRender(()=>{this.imageReady&&($h&&this.emitLeafer(sa.VIEW_COMPLETED),So.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit($h,Lh){Lh&&($h=$h.bind(Lh)),this.__initWait||(this.__initWait=[]),this.canvas?$h():this.__initWait.push($h)}waitReady($h,Lh){Lh&&($h=$h.bind(Lh)),this.ready?$h():this.__readyWait.push($h)}waitViewReady($h,Lh){Lh&&($h=$h.bind(Lh)),this.viewReady?$h():this.__viewReadyWait.push($h)}waitViewCompleted($h,Lh){Lh&&($h=$h.bind(Lh)),this.__viewCompletedWait.push($h),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender($h,Lh,Sh){Lh&&($h=$h.bind(Lh));const Eh=this.__nextRenderWait;if(Sh){for(let Gh=0;Gh<Eh.length;Gh++)if(Eh[Gh]===$h){Eh.splice(Gh,1);break}}else Eh.push($h);this.requestRender()}zoom($h,Lh,Sh,Eh){return he$2.need("view")}getValidMove($h,Lh,Sh){return{x:$h,y:Lh}}getValidScale($h){return $h}getWorldPointByClient($h,Lh){return this.interaction&&this.interaction.getLocal($h,Lh)}getPagePointByClient($h,Lh){return this.getPagePoint(this.getWorldPointByClient($h,Lh))}getClientPointByWorld($h){const{x:Lh,y:Sh}=this.clientBounds;return{x:Lh+$h.x,y:Sh+$h.y}}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent($h){}emitLeafer($h){this.emitEvent(new sa($h,this))}__listenEvents(){const $h=ne$2.start("FirstCreate "+this.innerName);this.once([[sa.START,()=>ne$2.end($h)],[ta.START,this.updateLazyBounds,this],[ea.START,this.__onCreated,this],[ea.END,this.__onViewReady,this]]),this.__eventIds.push(this.on_([[Ko.DATA,this.__onWatchData,this],[ta.END,this.__onLayoutEnd,this],[ea.NEXT,this.__onNextRender,this]]))}__removeListenEvents(){this.off_(this.__eventIds)}destroy($h){const Lh=()=>{if(!this.destroyed){ve$1.list.remove(this);try{this.stop(),this.emitLeafer(sa.END),this.__removeListenEvents(),this.__controllers.forEach(Sh=>!(this.parent&&Sh===this.interaction)&&Sh.destroy()),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager&&this.canvasManager.destroy()),this.canvas&&this.canvas.destroy(),this.config.view=this.parentApp=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{en.clearRecycled()},100)}catch(Sh){fe$1.error(Sh)}}};$h?Lh():setTimeout(Lh)}};we$1.list=new kh,St$2([zn(qt$1)],we$1.prototype,"__",void 0),St$2([bn()],we$1.prototype,"pixelRatio",void 0),St$2([fn("normal")],we$1.prototype,"mode",void 0),we$1=ve$1=St$2([Zn()],we$1);let xe$1=class extends ge$1{get __tag(){return"Rect"}};St$2([zn(Kt$2)],xe$1.prototype,"__",void 0),xe$1=St$2([Jn(ue$1),qn(),Zn()],xe$1);const{add:Se$1,includes:me$1,scroll:Re$1}=zt$2,ke$1=xe$1.prototype,Be$1=ye$1.prototype;let Ae$1=class extends ye$1{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor($h){super($h),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds($h){if(this.children.length&&!this.pathInputed){const Lh=this.__;if(Lh.__autoSide){Lh.__hasSurface&&this.__extraUpdate(),super.__updateBoxBounds();const{boxBounds:Sh}=this.__layout;Lh.__autoSize||(Lh.__autoWidth?(Sh.width+=Sh.x,Sh.x=0,Sh.height=Lh.height,Sh.y=0):(Sh.height+=Sh.y,Sh.y=0,Sh.width=Lh.width,Sh.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let $h,Lh;if(this.children.length){const Sh=this.__,Eh=this.__layout,{renderBounds:Gh,boxBounds:Ah}=Eh,{overflow:Ph}=Sh,Nh=Eh.childrenRenderBounds||(Eh.childrenRenderBounds=D());super.__updateRenderBounds(Nh),(Lh=Ph&&Ph.includes("scroll"))&&(Se$1(Nh,Ah),Re$1(Nh,Sh)),this.__updateRectRenderBounds(),$h=!me$1(Ah,Nh),$h&&Ph==="show"&&Se$1(Gh,Nh)}else this.__updateRectRenderBounds();_.stintSet(this,"isOverflow",$h),this.__checkScroll(Lh)}__updateRectRenderBounds(){}__checkScroll($h){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect($h,Lh){}__renderGroup($h,Lh){}__render($h,Lh){this.__.__drawAfterFill?this.__renderRect($h,Lh):(this.__renderRect($h,Lh),this.children.length&&this.__renderGroup($h,Lh)),this.hasScroller&&this.scroller.__render($h,Lh)}__drawContent($h,Lh){this.__renderGroup($h,Lh),(this.__.__useStroke||this.__.__useEffect)&&($h.setWorld(this.__nowWorld),this.__drawRenderPath($h))}};St$2([zn(Jt$1)],Ae$1.prototype,"__",void 0),St$2([bn(100)],Ae$1.prototype,"width",void 0),St$2([bn(100)],Ae$1.prototype,"height",void 0),St$2([fn(!1)],Ae$1.prototype,"resizeChildren",void 0),St$2([Sn("show")],Ae$1.prototype,"overflow",void 0),St$2([Gn(ke$1.__updateStrokeSpread)],Ae$1.prototype,"__updateStrokeSpread",null),St$2([Gn(ke$1.__updateRenderSpread)],Ae$1.prototype,"__updateRectRenderSpread",null),St$2([Gn(ke$1.__updateBoxBounds)],Ae$1.prototype,"__updateRectBoxBounds",null),St$2([Gn(ke$1.__updateStrokeBounds)],Ae$1.prototype,"__updateStrokeBounds",null),St$2([Gn(ke$1.__updateRenderBounds)],Ae$1.prototype,"__updateRectRenderBounds",null),St$2([Gn(ke$1.__updateChange)],Ae$1.prototype,"__updateRectChange",null),St$2([Gn(ke$1.__render)],Ae$1.prototype,"__renderRect",null),St$2([Gn(Be$1.__render)],Ae$1.prototype,"__renderGroup",null),Ae$1=St$2([qn(),Zn()],Ae$1);let Ce$1=class extends Ae$1{get __tag(){return"Frame"}get isFrame(){return!0}};St$2([zn(Gt$1)],Ce$1.prototype,"__",void 0),St$2([Ln("#FFFFFF")],Ce$1.prototype,"fill",void 0),St$2([Sn("hide")],Ce$1.prototype,"overflow",void 0),Ce$1=St$2([Zn()],Ce$1);const{moveTo:be$1,closePath:Pe$1,ellipse:Fe$1}=Cr;let We$1=class extends ge$1{get __tag(){return"Ellipse"}__updatePath(){const{width:$h,height:Lh,innerRadius:Sh,startAngle:Eh,endAngle:Gh}=this.__,Ah=$h/2,Ph=Lh/2,Nh=this.__.path=[];let Mh;Sh?Eh||Gh?(Sh<1?Fe$1(Nh,Ah,Ph,Ah*Sh,Ph*Sh,0,Eh,Gh,!1):Mh=!0,Fe$1(Nh,Ah,Ph,Ah,Ph,0,Gh,Eh,!0)):(Sh<1&&(Fe$1(Nh,Ah,Ph,Ah*Sh,Ph*Sh),be$1(Nh,$h,Ph)),Fe$1(Nh,Ah,Ph,Ah,Ph,0,360,0,!0)):Eh||Gh?(be$1(Nh,Ah,Ph),Fe$1(Nh,Ah,Ph,Ah,Ph,0,Eh,Gh,!1)):Fe$1(Nh,Ah,Ph,Ah,Ph),Mh||Pe$1(Nh),$t$2.ellipseToCurve&&(this.__.path=this.getPath(!0))}};St$2([zn(Qt$1)],We$1.prototype,"__",void 0),St$2([Cn(0)],We$1.prototype,"innerRadius",void 0),St$2([Cn(0)],We$1.prototype,"startAngle",void 0),St$2([Cn(0)],We$1.prototype,"endAngle",void 0),We$1=St$2([Zn()],We$1);const{sin:Ee$1,cos:Te$1,PI:De$1}=Math,{moveTo:Ie$1,lineTo:Le$1,closePath:ze$1,drawPoints:Me$1}=Cr;let Oe$1=class extends ge$1{get __tag(){return"Polygon"}__updatePath(){const $h=this.__,Lh=$h.path=[];if($h.points)Me$1(Lh,$h.points,$h.curve,!0);else{const{width:Sh,height:Eh,sides:Gh}=$h,Ah=Sh/2,Ph=Eh/2;Ie$1(Lh,Ah,0);for(let Nh=1;Nh<Gh;Nh++)Le$1(Lh,Ah+Ah*Ee$1(2*Nh*De$1/Gh),Ph-Ph*Te$1(2*Nh*De$1/Gh));ze$1(Lh)}}};St$2([zn(Zt$1)],Oe$1.prototype,"__",void 0),St$2([Cn(3)],Oe$1.prototype,"sides",void 0),St$2([Cn()],Oe$1.prototype,"points",void 0),St$2([Cn(0)],Oe$1.prototype,"curve",void 0),Oe$1=St$2([qn(),Zn()],Oe$1);const{sin:Ne$1,cos:Ve$1,PI:He$1}=Math,{moveTo:Ye$1,lineTo:Ue$1,closePath:Xe$1}=Cr;let je$1=class extends ge$1{get __tag(){return"Star"}__updatePath(){const{width:$h,height:Lh,corners:Sh,innerRadius:Eh}=this.__,Gh=$h/2,Ah=Lh/2,Ph=this.__.path=[];Ye$1(Ph,Gh,0);for(let Nh=1;Nh<2*Sh;Nh++)Ue$1(Ph,Gh+(Nh%2==0?Gh:Gh*Eh)*Ne$1(Nh*He$1/Sh),Ah-(Nh%2==0?Ah:Ah*Eh)*Ve$1(Nh*He$1/Sh));Xe$1(Ph)}};St$2([zn(te$1)],je$1.prototype,"__",void 0),St$2([Cn(5)],je$1.prototype,"corners",void 0),St$2([Cn(.382)],je$1.prototype,"innerRadius",void 0),je$1=St$2([Zn()],je$1);const{moveTo:Je$1,lineTo:qe$1,drawPoints:Ge$1}=Cr,{rotate:$e$1,getAngle:Ke$1,getDistance:Qe$1,defaultPoint:Ze$1}=ot$2;let ti$1=class extends ge$1{get __tag(){return"Line"}get toPoint(){const{width:$h,rotation:Lh}=this.__,Sh=Y$1();return $h&&(Sh.x=$h),Lh&&$e$1(Sh,Lh),Sh}set toPoint($h){this.width=Qe$1(Ze$1,$h),this.rotation=Ke$1(Ze$1,$h),this.height&&(this.height=0)}__updatePath(){const $h=this.__,Lh=$h.path=[];$h.points?Ge$1(Lh,$h.points,$h.curve,$h.closed):(Je$1(Lh,0,0),qe$1(Lh,this.width,0))}};St$2([zn($t$1)],ti$1.prototype,"__",void 0),St$2([On("center")],ti$1.prototype,"strokeAlign",void 0),St$2([bn(0)],ti$1.prototype,"height",void 0),St$2([Cn()],ti$1.prototype,"points",void 0),St$2([Cn(0)],ti$1.prototype,"curve",void 0),St$2([Cn(!1)],ti$1.prototype,"closed",void 0),ti$1=St$2([Zn()],ti$1);let ei$1=class extends xe$1{get __tag(){return"Image"}get ready(){const{image:$h}=this;return $h&&$h.ready}get image(){const{fill:$h}=this.__;return l($h)&&$h[0].image}};St$2([zn(re$1)],ei$1.prototype,"__",void 0),St$2([bn("")],ei$1.prototype,"url",void 0),ei$1=St$2([Zn()],ei$1);const ii$1=ei$1;let si$1=class extends xe$1{get __tag(){return"Canvas"}get context(){return this.canvas.context}get ready(){return!this.url}constructor($h){super($h),this.canvas=le$2.canvas(this.__),$h&&$h.url&&this.drawImage($h.url)}drawImage($h){new on({url:$h}).load(Lh=>{this.context.drawImage(Lh.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new Vo(Vo.LOADED,{image:Lh}))})}draw($h,Lh,Sh,Eh){const Gh=new pt$2($h.worldTransform).invert(),Ah=new pt$2;Lh&&Ah.translate(Lh.x,Lh.y),Sh&&(o(Sh)?Ah.scale(Sh):Ah.scale(Sh.x,Sh.y)),Eh&&Ah.rotate(Eh),Gh.multiplyParent(Ah),$h.__render(this.canvas,{matrix:Gh.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent($h,Lh){const{width:Sh,height:Eh}=this.__,{view:Gh}=this.canvas;$h.drawImage(Gh,0,0,Gh.width,Gh.height,0,0,Sh,Eh)}__updateSize(){const{canvas:$h}=this;if($h){const{smooth:Lh,safeResize:Sh}=this.__;$h.resize(this.__,Sh),$h.smooth!==Lh&&($h.smooth=Lh)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null),super.destroy()}};St$2([zn(ae$1)],si$1.prototype,"__",void 0),St$2([Rt$2(100)],si$1.prototype,"width",void 0),St$2([Rt$2(100)],si$1.prototype,"height",void 0),St$2([Rt$2(1)],si$1.prototype,"pixelRatio",void 0),St$2([Rt$2(!0)],si$1.prototype,"smooth",void 0),St$2([fn(!1)],si$1.prototype,"safeResize",void 0),St$2([Rt$2()],si$1.prototype,"contextSettings",void 0),si$1=St$2([Zn()],si$1);const{copyAndSpread:oi$1,includes:ri$1,spread:ai$1,setList:ni$1}=zt$2,{stintSet:_i$1}=_;let hi$1=class extends ge$1{get __tag(){return"Text"}get textDrawData(){return this.updateLayout(),this.__.__textDrawData}__updateTextDrawData(){const $h=this.__,{lineHeight:Lh,letterSpacing:Sh,fontFamily:Eh,fontSize:Gh,fontWeight:Ah,italic:Ph,textCase:Nh,textOverflow:Mh,padding:Dh,width:Fh,height:Ih}=$h;$h.__lineHeight=bt$2.number(Lh,Gh),$h.__letterSpacing=bt$2.number(Sh,Gh),$h.__baseLine=$h.__lineHeight-($h.__lineHeight-.7*Gh)/2,$h.__font=`${Ph?"italic ":""}${Nh==="small-caps"?"small-caps ":""}${Ah!=="normal"?Ah+" ":""}${Gh||12}px ${Eh||"caption"}`,_i$1($h,"__padding",Dh&&I$1.fourNumber(Dh)),_i$1($h,"__clipText",Mh!=="show"&&!$h.__autoSize),_i$1($h,"__isCharMode",Fh||Ih||$h.__letterSpacing||Nh!=="none"),$h.__textDrawData=At$2.getDrawData(($h.__isPlacehold=$h.placeholder&&$h.text==="")?$h.placeholder:$h.text,this.__)}__updateBoxBounds(){const $h=this.__,Lh=this.__layout,{fontSize:Sh,italic:Eh,padding:Gh,__autoWidth:Ah,__autoHeight:Ph}=$h;this.__updateTextDrawData();const{bounds:Nh}=$h.__textDrawData,Mh=Lh.boxBounds;if(Lh.contentBounds=Nh,$h.__lineHeight<Sh&&ai$1(Nh,Sh/2),Ah||Ph){if(Mh.x=Ah?Nh.x:0,Mh.y=Ph?Nh.y:0,Mh.width=Ah?Nh.width:$h.width,Mh.height=Ph?Nh.height:$h.height,Gh){const[Dh,Fh,Ih,Hh]=$h.__padding;Ah&&(Mh.x-=Hh,Mh.width+=Fh+Hh),Ph&&(Mh.y-=Dh,Mh.height+=Ih+Dh)}this.__updateNaturalSize()}else super.__updateBoxBounds();Eh&&(Mh.width+=.16*Sh),_.stintSet(this,"isOverflow",!ri$1(Mh,Nh)),this.isOverflow?(ni$1($h.__textBoxBounds={},[Mh,Nh]),Lh.renderChanged=!0):$h.__textBoxBounds=Mh}__updateRenderSpread(){let $h=super.__updateRenderSpread();return $h||($h=this.isOverflow?1:0),$h}__updateRenderBounds(){const{renderBounds:$h,renderSpread:Lh}=this.__layout;oi$1($h,this.__.__textBoxBounds,Lh),this.__box&&(this.__box.__layout.renderBounds=$h)}__updateChange(){super.__updateChange();const $h=this.__box;$h&&($h.__onUpdateSize(),$h.__updateChange())}__drawRenderPath($h){$h.font=this.__.__font}__draw($h,Lh,Sh){const Eh=this.__box;Eh&&(Eh.__nowWorld=this.__nowWorld,Eh.__draw($h,Lh,Sh)),this.textEditing&&!Lh.exporting||super.__draw($h,Lh,Sh)}__drawShape($h,Lh){Lh.shape&&this.__box&&this.__box.__drawShape($h,Lh),super.__drawShape($h,Lh)}destroy(){this.boxStyle&&(this.boxStyle=null),super.destroy()}};St$2([zn(oe$1)],hi$1.prototype,"__",void 0),St$2([bn(0)],hi$1.prototype,"width",void 0),St$2([bn(0)],hi$1.prototype,"height",void 0),St$2([Ln()],hi$1.prototype,"boxStyle",void 0),St$2([fn(!1)],hi$1.prototype,"resizeFontSize",void 0),St$2([Ln("#000000")],hi$1.prototype,"fill",void 0),St$2([On("outside")],hi$1.prototype,"strokeAlign",void 0),St$2([Dn("all")],hi$1.prototype,"hitFill",void 0),St$2([bn("")],hi$1.prototype,"text",void 0),St$2([bn("")],hi$1.prototype,"placeholder",void 0),St$2([bn("caption")],hi$1.prototype,"fontFamily",void 0),St$2([bn(12)],hi$1.prototype,"fontSize",void 0),St$2([bn("normal")],hi$1.prototype,"fontWeight",void 0),St$2([bn(!1)],hi$1.prototype,"italic",void 0),St$2([bn("none")],hi$1.prototype,"textCase",void 0),St$2([bn("none")],hi$1.prototype,"textDecoration",void 0),St$2([bn(0)],hi$1.prototype,"letterSpacing",void 0),St$2([bn({type:"percent",value:1.5})],hi$1.prototype,"lineHeight",void 0),St$2([bn(0)],hi$1.prototype,"paraIndent",void 0),St$2([bn(0)],hi$1.prototype,"paraSpacing",void 0),St$2([bn("x")],hi$1.prototype,"writingMode",void 0),St$2([bn("left")],hi$1.prototype,"textAlign",void 0),St$2([bn("top")],hi$1.prototype,"verticalAlign",void 0),St$2([bn(!0)],hi$1.prototype,"autoSizeAlign",void 0),St$2([bn("normal")],hi$1.prototype,"textWrap",void 0),St$2([bn("show")],hi$1.prototype,"textOverflow",void 0),St$2([Ln(!1)],hi$1.prototype,"textEditing",void 0),hi$1=St$2([Zn()],hi$1);let di$1=class extends ge$1{get __tag(){return"Path"}};St$2([zn(ee$1)],di$1.prototype,"__",void 0),St$2([On("center")],di$1.prototype,"strokeAlign",void 0),di$1=St$2([Zn()],di$1);let li$1=class extends ye$1{get __tag(){return"Pen"}setStyle($h){const Lh=this.pathElement=new di$1($h);return this.pathStyle=$h,this.__path=Lh.path||(Lh.path=[]),this.add(Lh),this}beginPath(){return this}moveTo($h,Lh){return this}lineTo($h,Lh){return this}bezierCurveTo($h,Lh,Sh,Eh,Gh,Ah){return this}quadraticCurveTo($h,Lh,Sh,Eh){return this}closePath(){return this}rect($h,Lh,Sh,Eh){return this}roundRect($h,Lh,Sh,Eh,Gh){return this}ellipse($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh){return this}arc($h,Lh,Sh,Eh,Gh,Ah){return this}arcTo($h,Lh,Sh,Eh,Gh){return this}drawEllipse($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh){return this}drawArc($h,Lh,Sh,Eh,Gh,Ah){return this}drawPoints($h,Lh,Sh){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}};St$2([zn(ie$1)],li$1.prototype,"__",void 0),St$2([($h,Lh)=>{ln($h,Lh,{get(){return this.__path}})}],li$1.prototype,"path",void 0),li$1=St$2([Jn(Fr,["set","path","paint"]),Zn()],li$1);function I($h,Lh,Sh,Eh){var Gh,Ah=arguments.length,Ph=Ah<3?Lh:Eh===null?Eh=Object.getOwnPropertyDescriptor(Lh,Sh):Eh;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Ph=Reflect.decorate($h,Lh,Sh,Eh);else for(var Nh=$h.length-1;Nh>=0;Nh--)(Gh=$h[Nh])&&(Ph=(Ah<3?Gh(Ph):Ah>3?Gh(Lh,Sh,Ph):Gh(Lh,Sh))||Ph);return Ah>3&&Ph&&Object.defineProperty(Lh,Sh,Ph),Ph}let N=class extends we$1{get __tag(){return"App"}get isApp(){return!0}constructor($h,Lh){super($h,Lh)}init($h,Lh){if(super.init($h,Lh),$h){const{ground:Sh,tree:Eh,sky:Gh,editor:Ah}=$h;Sh&&(this.ground=this.addLeafer(Sh)),(Eh||Ah)&&(this.tree=this.addLeafer(Eh||{type:$h.type||"design"})),(Gh||Ah)&&(this.sky=this.addLeafer(Gh)),Ah&&le$2.editor(Ah,this)}}__setApp(){const{canvas:$h}=this,{realCanvas:Lh,view:Sh}=this.config;Lh||Sh===this.canvas.view||!$h.parentView?this.realCanvas=!0:$h.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable()}__updateLocalBounds(){this.forEach($h=>$h.updateLayout()),super.__updateLocalBounds()}start(){super.start(),this.forEach($h=>$h.start())}stop(){this.forEach($h=>$h.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.forEach($h=>$h.unlockLayout())}lockLayout(){super.lockLayout(),this.forEach($h=>$h.lockLayout())}forceRender($h,Lh){this.forEach(Sh=>Sh.forceRender($h,Lh))}addLeafer($h){const Lh=new we$1($h);return this.add(Lh),Lh}add($h,Lh){if(!$h.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout(()=>this.add($h,Lh),10);$h.init(this.__getChildConfig($h.userConfig),this)}super.add($h,Lh),s(Lh)||($h.canvas.childIndex=Lh),this.__listenChildEvents($h)}forEach($h){this.children.forEach($h)}__onCreated(){this.created=this.children.every($h=>$h.created)}__onReady(){this.children.every($h=>$h.ready)&&super.__onReady()}__onViewReady(){this.children.every($h=>$h.viewReady)&&super.__onViewReady()}__onChildRenderEnd($h){this.renderer.addBlock($h.renderBounds),this.viewReady&&this.renderer.update()}__render($h,Lh){$h.context&&this.forEach(Sh=>Lh.matrix?Sh.__render($h,Lh):$h.copyWorld(Sh.canvas,Lh.bounds))}__onResize($h){this.forEach(Lh=>Lh.resize($h)),super.__onResize($h)}updateLayout(){this.forEach($h=>$h.updateLayout())}__getChildConfig($h){const Lh=Object.assign({},this.config);return Lh.hittable=Lh.realCanvas=void 0,$h&&_.assign(Lh,$h),this.autoLayout&&_.copyAttrs(Lh,this,Re$2),Lh.view=this.realCanvas?void 0:this.view,Lh.fill=void 0,Lh}__listenChildEvents($h){$h.once([[ta.END,this.__onReady,this],[ea.START,this.__onCreated,this],[ea.END,this.__onViewReady,this]]),this.realCanvas&&this.__eventIds.push($h.on_(ea.END,this.__onChildRenderEnd,this))}};N=I([Zn()],N);const F={},W={isHoldSpaceKey:()=>W.isHold("Space"),isHold:$h=>F[$h],isHoldKeys:($h,Lh)=>Lh?$h(Lh):void 0,setDownCode($h){F[$h]||(F[$h]=!0)},setUpCode($h){F[$h]=!1}},K={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft($h){$h.buttons||($h.buttons=1)},left:$h=>$h.buttons===1,right:$h=>$h.buttons===2,middle:$h=>$h.buttons===4};class V extends Xo{get spaceKey(){return W.isHoldSpaceKey()}get left(){return K.left(this)}get right(){return K.right(this)}get middle(){return K.middle(this)}constructor(Lh){super(Lh.type),this.bubbles=!0,Object.assign(this,Lh)}isHoldKeys(Lh){return W.isHoldKeys(Lh,this)}getBoxPoint(Lh){return(Lh||this.current).getBoxPoint(this)}getInnerPoint(Lh){return(Lh||this.current).getInnerPoint(this)}getLocalPoint(Lh){return(Lh||this.current).getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(Lh){return this.getInnerPoint(Lh)}getLocal(Lh){return this.getLocalPoint(Lh)}getPage(){return this.getPagePoint()}static changeName(Lh,Sh){pe$2.changeName(Lh,Sh)}}const{min:U,max:j,abs:X}=Math,{float:Y,sign:z}=I$1,{minX:G,maxX:Z$1,minY:q,maxY:J$1}=zt$2,Q=new Vt$3,$=new Vt$3,tt$1={limitMove($h,Lh){const{dragBounds:Sh,dragBoundsType:Eh}=$h;Sh&&et$1.getValidMove($h.__localBoxBounds,et$1.getDragBounds($h),Eh,Lh,!0),et$1.axisMove($h,Lh)},limitScaleOf($h,Lh,Sh,Eh){const{dragBounds:Gh,dragBoundsType:Ah}=$h;Gh&&et$1.getValidScaleOf($h.__localBoxBounds,et$1.getDragBounds($h),Ah,$h.getLocalPointByInner($h.getInnerPointByBox(Lh)),Sh,Eh,!0)},axisMove($h,Lh){const{draggable:Sh}=$h;Sh==="x"&&(Lh.y=0),Sh==="y"&&(Lh.x=0)},getDragBounds($h){const{dragBounds:Lh}=$h;return Lh==="parent"?$h.parent.boxBounds:Lh},isInnerMode:($h,Lh,Sh,Eh)=>Sh==="inner"||Sh==="auto"&&$h[Eh]>Lh[Eh],getValidMove($h,Lh,Sh,Eh,Gh){const Ah=$h.x+Eh.x,Ph=$h.y+Eh.y,Nh=Ah+$h.width,Mh=Ph+$h.height,Dh=Lh.x+Lh.width,Fh=Lh.y+Lh.height;return Gh||(Eh=Object.assign({},Eh)),et$1.isInnerMode($h,Lh,Sh,"width")?Ah>Lh.x?Eh.x+=Lh.x-Ah:Nh<Dh&&(Eh.x+=Dh-Nh):Ah<Lh.x?Eh.x+=Lh.x-Ah:Nh>Dh&&(Eh.x+=Dh-Nh),et$1.isInnerMode($h,Lh,Sh,"height")?Ph>Lh.y?Eh.y+=Lh.y-Ph:Mh<Fh&&(Eh.y+=Fh-Mh):Ph<Lh.y?Eh.y+=Lh.y-Ph:Mh>Fh&&(Eh.y+=Fh-Mh),Eh.x=Y(Eh.x),Eh.y=Y(Eh.y),Eh},getValidScaleOf($h,Lh,Sh,Eh,Gh,Ah,Ph){Ph||(Gh=Object.assign({},Gh)),$.set(Lh),Q.set($h).scaleOf(Eh,Gh.x,Gh.y);const Nh=(Eh.x-$h.x)/$h.width,Mh=1-Nh,Dh=(Eh.y-$h.y)/$h.height,Fh=1-Dh;let Ih,Hh,Wh,zh,Uh=1,Yh=1;return et$1.isInnerMode($h,Lh,Sh,"width")?(Gh.x<0&&Q.scaleOf(Eh,Uh=1/Gh.x,1),Wh=Y(Q.minX-$.minX),zh=Y($.maxX-Q.maxX),Ih=Nh&&Wh>0?1+Wh/(Nh*Q.width):1,Hh=Mh&&zh>0?1+zh/(Mh*Q.width):1,Uh*=j(Ih,Hh)):(Gh.x<0&&((Y(G($h)-G(Lh))<=0||Y(Z$1(Lh)-Z$1($h))<=0)&&Q.scaleOf(Eh,Uh=1/Gh.x,1),Q.unsign()),Wh=Y($.minX-Q.minX),zh=Y(Q.maxX-$.maxX),Ih=Nh&&Wh>0?1-Wh/(Nh*Q.width):1,Hh=Mh&&zh>0?1-zh/(Mh*Q.width):1,Uh*=U(Ih,Hh)),et$1.isInnerMode($h,Lh,Sh,"height")?(Gh.y<0&&Q.scaleOf(Eh,1,Yh=1/Gh.y),Wh=Y(Q.minY-$.minY),zh=Y($.maxY-Q.maxY),Ih=Dh&&Wh>0?1+Wh/(Dh*Q.height):1,Hh=Fh&&zh>0?1+zh/(Fh*Q.height):1,Yh*=j(Ih,Hh),Ah&&(Ih=j(X(Uh),X(Yh)),Uh=z(Uh)*Ih,Yh=z(Yh)*Ih)):(Gh.y<0&&((Y(q($h)-q(Lh))<=0||Y(J$1(Lh)-J$1($h))<=0)&&Q.scaleOf(Eh,1,Yh=1/Gh.y),Q.unsign()),Wh=Y($.minY-Q.minY),zh=Y(Q.maxY-$.maxY),Ih=Dh&&Wh>0?1-Wh/(Dh*Q.height):1,Hh=Fh&&zh>0?1-zh/(Fh*Q.height):1,Yh*=U(Ih,Hh)),Gh.x*=n(Uh)?Uh:1,Gh.y*=n(Yh)?Yh:1,Gh}},et$1=tt$1;let it$1=class extends V{};it$1.POINTER="pointer",it$1.BEFORE_DOWN="pointer.before_down",it$1.BEFORE_MOVE="pointer.before_move",it$1.BEFORE_UP="pointer.before_up",it$1.DOWN="pointer.down",it$1.MOVE="pointer.move",it$1.UP="pointer.up",it$1.OVER="pointer.over",it$1.OUT="pointer.out",it$1.ENTER="pointer.enter",it$1.LEAVE="pointer.leave",it$1.TAP="tap",it$1.DOUBLE_TAP="double_tap",it$1.CLICK="click",it$1.DOUBLE_CLICK="double_click",it$1.LONG_PRESS="long_press",it$1.LONG_TAP="long_tap",it$1.MENU="pointer.menu",it$1.MENU_TAP="pointer.menu_tap",it$1=I([$n()],it$1);const st$1=it$1,at$1={};let nt$1=class extends it$1{static setList($h){this.list=$h instanceof kh?$h:new kh($h)}static setData($h){this.data=$h}static getValidMove($h,Lh,Sh,Eh=!0){const Gh=$h.getLocalPoint(Sh,null,!0);return ot$2.move(Gh,Lh.x-$h.x,Lh.y-$h.y),Eh&&this.limitMove($h,Gh),tt$1.axisMove($h,Gh),Gh}static limitMove($h,Lh){tt$1.limitMove($h,Lh)}getPageMove($h){return this.assignMove($h),this.current.getPagePoint(at$1,null,!0)}getInnerMove($h,Lh){return $h||($h=this.current),this.assignMove(Lh),$h.getInnerPoint(at$1,null,!0)}getLocalMove($h,Lh){return $h||($h=this.current),this.assignMove(Lh),$h.getLocalPoint(at$1,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal($h){return this.getInnerMove($h,!0)}getLocalTotal($h){return this.getLocalMove($h,!0)}getPageBounds(){const $h=this.getPageTotal(),Lh=this.getPagePoint(),Sh={};return zt$2.set(Sh,Lh.x-$h.x,Lh.y-$h.y,$h.x,$h.y),zt$2.unsign(Sh),Sh}assignMove($h){at$1.x=$h?this.totalX:this.moveX,at$1.y=$h?this.totalY:this.moveY}};nt$1.BEFORE_DRAG="drag.before_drag",nt$1.START="drag.start",nt$1.DRAG="drag",nt$1.END="drag.end",nt$1.OVER="drag.over",nt$1.OUT="drag.out",nt$1.ENTER="drag.enter",nt$1.LEAVE="drag.leave",nt$1=I([$n()],nt$1);const rt$1=nt$1;let ht$1=class extends it$1{static setList($h){nt$1.setList($h)}static setData($h){nt$1.setData($h)}};ht$1.DROP="drop",ht$1=I([$n()],ht$1);let ot$1=class extends nt$1{};ot$1.BEFORE_MOVE="move.before_move",ot$1.START="move.start",ot$1.MOVE="move",ot$1.DRAG_ANIMATE="move.drag_animate",ot$1.END="move.end",ot$1.PULL_DOWN="move.pull_down",ot$1.REACH_BOTTOM="move.reach_bottom",ot$1=I([$n()],ot$1);let dt$1=class extends V{};dt$1=I([$n()],dt$1);const gt$1=dt$1;let lt$1=class extends it$1{};lt$1.BEFORE_ROTATE="rotate.before_rotate",lt$1.START="rotate.start",lt$1.ROTATE="rotate",lt$1.END="rotate.end",lt$1=I([$n()],lt$1);let ct$1=class extends nt$1{};ct$1.SWIPE="swipe",ct$1.LEFT="swipe.left",ct$1.RIGHT="swipe.right",ct$1.UP="swipe.up",ct$1.DOWN="swipe.down",ct$1=I([$n()],ct$1);let ut$1=class extends it$1{};ut$1.BEFORE_ZOOM="zoom.before_zoom",ut$1.START="zoom.start",ut$1.ZOOM="zoom",ut$1.END="zoom.end",ut$1=I([$n()],ut$1);let pt$1=class extends V{};pt$1.BEFORE_DOWN="key.before_down",pt$1.BEFORE_UP="key.before_up",pt$1.DOWN="key.down",pt$1.HOLD="key.hold",pt$1.UP="key.up",pt$1=I([$n()],pt$1);const _t$1={getDragEventData:($h,Lh,Sh)=>Object.assign(Object.assign({},Sh),{x:Sh.x,y:Sh.y,moveX:Sh.x-Lh.x,moveY:Sh.y-Lh.y,totalX:Sh.x-$h.x,totalY:Sh.y-$h.y}),getDropEventData:($h,Lh,Sh)=>Object.assign(Object.assign({},$h),{list:Lh,data:Sh}),getSwipeDirection:$h=>$h<-45&&$h>-135?ct$1.UP:$h>45&&$h<135?ct$1.DOWN:$h<=45&&$h>=-45?ct$1.RIGHT:ct$1.LEFT,getSwipeEventData:($h,Lh,Sh)=>Object.assign(Object.assign({},Sh),{moveX:Lh.moveX,moveY:Lh.moveY,totalX:Sh.x-$h.x,totalY:Sh.y-$h.y,type:mt$1.getSwipeDirection(ot$2.getAngle($h,Sh))}),getBase($h){const Lh=$h.button===1?4:$h.button;return{altKey:$h.altKey,ctrlKey:$h.ctrlKey,shiftKey:$h.shiftKey,metaKey:$h.metaKey,time:Date.now(),buttons:s($h.buttons)?1:$h.buttons===0?Lh:$h.buttons,origin:$h}},pathHasEventType($h,Lh){const{list:Sh}=$h;for(let Eh=0,Gh=Sh.length;Eh<Gh;Eh++)if(Sh[Eh].hasEvent(Lh))return!0;return!1},filterPathByEventType($h,Lh){const Sh=new kh,{list:Eh}=$h;for(let Gh=0,Ah=Eh.length;Gh<Ah;Gh++)Eh[Gh].hasEvent(Lh)&&Sh.add(Eh[Gh]);return Sh},pathCanDrag:$h=>$h&&$h.list.some(Lh=>co.draggable(Lh)||!Lh.isLeafer&&Lh.hasEvent(nt$1.DRAG)),pathHasOutside:$h=>$h&&$h.list.some(Lh=>Lh.isOutside)},mt$1=_t$1,vt$1=new kh,{getDragEventData:ft$1,getDropEventData:yt$1,getSwipeEventData:Et$1}=_t$1;let Dt$1=class{constructor($h){this.dragDataList=[],this.interaction=$h}setDragData($h){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=ft$1($h,$h,$h),this.canAnimate=this.canDragOut=!0}getList($h,Lh){const{proxy:Sh}=this.interaction.selector,Eh=Sh&&Sh.list.length,Gh=nt$1.list||this.draggableList||vt$1;return this.dragging&&(Eh?$h?vt$1:new kh(Lh?[...Sh.list,...Sh.dragHoverExclude]:Sh.list):Gh)}checkDrag($h,Lh){const{interaction:Sh}=this;if(this.moving&&$h.buttons<1)return this.canAnimate=!1,void Sh.pointerCancel();!this.moving&&Lh&&(this.moving=Sh.canMove(this.downData)||Sh.isHoldRightKey||Sh.isMobileDragEmpty)&&(this.dragData.moveType="drag",Sh.emit(ot$1.START,this.dragData)),this.moving||this.dragStart($h,Lh),this.drag($h)}dragStart($h,Lh){this.dragging||(this.dragging=Lh&&K.left($h),this.dragging&&(this.interaction.emit(nt$1.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints($h){this.dragStartPoints={},$h.forEach(Lh=>this.dragStartPoints[Lh.innerId]={x:Lh.x,y:Lh.y})}getDraggableList($h){let Lh;for(let Sh=0,Eh=$h.length;Sh<Eh;Sh++)if(Lh=$h.list[Sh],co.draggable(Lh)){this.draggableList=new kh(Lh);break}}drag($h){const{interaction:Lh,dragData:Sh,downData:Eh}=this,{path:Gh,throughPath:Ah}=Eh;this.dragData=ft$1(Eh,Sh,$h),Ah&&(this.dragData.throughPath=Ah),this.dragData.path=Gh,this.dragDataList.push(this.dragData),this.moving?($h.moving=!0,this.dragData.moveType="drag",Lh.emit(ot$1.BEFORE_MOVE,this.dragData),Lh.emit(ot$1.MOVE,this.dragData)):this.dragging&&($h.dragging=!0,this.dragReal(),Lh.emit(nt$1.BEFORE_DRAG,this.dragData),Lh.emit(nt$1.DRAG,this.dragData))}dragReal($h){const{interaction:Lh}=this,{running:Sh}=Lh,Eh=this.realDraggableList;if(Eh.length&&Sh){const{totalX:Gh,totalY:Ah}=this.dragData,{dragLimitAnimate:Ph}=Lh.p,Nh=!Ph||!!$h;Eh.forEach(Mh=>{if(Mh.draggable){const Dh=i(Mh.draggable),Fh=nt$1.getValidMove(Mh,this.dragStartPoints[Mh.innerId],{x:Gh,y:Ah},Nh||Dh);Ph&&!Dh&&$h?co.animateMove(Mh,Fh,o(Ph)?Ph:.3):Mh.move(Fh)}})}}dragOverOrOut($h){const{interaction:Lh}=this,{dragOverPath:Sh}=this,{path:Eh}=$h;this.dragOverPath=Eh,Sh?Eh.indexAt(0)!==Sh.indexAt(0)&&(Lh.emit(nt$1.OUT,$h,Sh),Lh.emit(nt$1.OVER,$h,Eh)):Lh.emit(nt$1.OVER,$h,Eh)}dragEnterOrLeave($h){const{interaction:Lh}=this,{dragEnterPath:Sh}=this,{path:Eh}=$h;Lh.emit(nt$1.LEAVE,$h,Sh,Eh),Lh.emit(nt$1.ENTER,$h,Eh,Sh),this.dragEnterPath=Eh}dragEnd($h){(this.dragging||this.moving)&&(this.checkDragEndAnimate($h)||this.dragEndReal($h))}dragEndReal($h){const{interaction:Lh,downData:Sh,dragData:Eh}=this;$h||($h=Eh);const{path:Gh,throughPath:Ah}=Sh,Ph=ft$1(Sh,$h,$h);if(Ah&&(Ph.throughPath=Ah),Ph.path=Gh,this.moving&&(this.moving=!1,Ph.moveType="drag",Lh.emit(ot$1.END,Ph)),this.dragging){const Nh=this.getList();this.dragging=!1,Lh.p.dragLimitAnimate&&this.dragReal(!0),Lh.emit(nt$1.END,Ph),this.swipe($h,Sh,Eh,Ph),this.drop($h,Nh,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}swipe($h,Lh,Sh,Eh){const{interaction:Gh}=this;if(ot$2.getDistance(Lh,$h)>Gh.config.pointer.swipeDistance){const Ah=Et$1(Lh,Sh,Eh);this.interaction.emit(Ah.type,Ah)}}drop($h,Lh,Sh){const Eh=yt$1($h,Lh,nt$1.data);Eh.path=Sh,this.interaction.emit(ht$1.DROP,Eh),this.interaction.emit(nt$1.LEAVE,$h,Sh)}dragReset(){nt$1.list=nt$1.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null,this.dragDataList=[]}checkDragEndAnimate($h,Lh){return!1}animate($h,Lh){}stopAnimate(){}checkDragOut($h){}autoMoveOnDragOut($h){}autoMoveCancel(){}destroy(){this.dragReset()}};const Pt$1=ee$2.get("emit"),xt$1=["move","zoom","rotate","key"];function wt$1($h,Lh,Sh,Eh,Gh){if(xt$1.some(Ah=>Lh.startsWith(Ah))&&$h.__.hitChildren&&!Tt$1($h,Gh)){let Ah;for(let Ph=0,Nh=$h.children.length;Ph<Nh;Ph++)Ah=$h.children[Ph],!Sh.path.has(Ah)&&Ah.__.hittable&&Ot$1(Ah,Lh,Sh,Eh,Gh)}}function Ot$1($h,Lh,Sh,Eh,Gh){if($h.destroyed)return!1;if($h.__.hitSelf&&!Tt$1($h,Gh)&&(Lt$2.updateEventStyle&&!Eh&&Lt$2.updateEventStyle($h,Lh),$h.hasEvent(Lh,Eh))){Sh.phase=Eh?1:$h===Sh.target?2:3;const Ah=pe$2.get(Lh,Sh);if($h.emitEvent(Ah,Eh),Ah.isStop)return!0}return!1}function Tt$1($h,Lh){return Lh&&Lh.has($h)}const Lt$1={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8}},pointer:{type:"pointer",snap:!0,hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20},touch:{preventDefault:"auto"},multiTouch:{},move:{autoDistance:2},zoom:{},cursor:!0,keyEvent:!0},{pathHasEventType:Rt$1,pathCanDrag:Ct$1,pathHasOutside:bt$1}=_t$1;let Mt$1=class{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return this.m.drag===!0||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&K.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&K.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&W.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor($h,Lh,Sh,Eh){this.config=_.clone(Lt$1),this.tapCount=0,this.downKeyMap={},this.target=$h,this.canvas=Lh,this.selector=Sh,this.defaultPath=new kh($h),this.createTransformer(),this.dragger=new Dt$1(this),Eh&&(this.config=_.default(Eh,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive($h){}pointerDown($h,Lh){$h||($h=this.hoverData),$h&&(K.defaultLeft($h),this.updateDownData($h),this.checkPath($h,Lh),this.downTime=Date.now(),this.emit(it$1.BEFORE_DOWN,$h),$h.path.needUpdate&&this.updateDownData($h),this.emit(it$1.DOWN,$h),K.left($h)&&(this.tapWait(),this.longPressWait($h)),this.waitRightTap=K.right($h),this.dragger.setDragData($h),this.isHoldRightKey||this.updateCursor($h))}pointerMove($h){if($h||($h=this.hoverData),!$h)return;const{downData:Lh}=this;Lh&&K.defaultLeft($h),(this.canvas.bounds.hitPoint($h)||Lh)&&(this.pointerMoveReal($h),Lh&&this.dragger.checkDragOut($h))}pointerMoveReal($h){if(this.emit(it$1.BEFORE_MOVE,$h,this.defaultPath),this.downData){const Lh=ot$2.getDistance(this.downData,$h)>this.p.dragDistance;Lh&&(this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag($h,Lh)}this.dragger.moving||(this.updateHoverData($h),this.checkPath($h),this.emit(it$1.MOVE,$h),this.pointerHover($h),this.dragging&&(this.dragger.dragOverOrOut($h),this.dragger.dragEnterOrLeave($h))),this.updateCursor(this.downData||$h)}pointerUp($h){const{downData:Lh}=this;if($h||($h=Lh),!Lh)return;K.defaultLeft($h),$h.multiTouch=Lh.multiTouch,this.findPath($h);const Sh=Object.assign(Object.assign({},$h),{path:$h.path.clone()});$h.path.addList(Lh.path.list),this.checkPath($h),this.downData=null,this.emit(it$1.BEFORE_UP,$h),this.emit(it$1.UP,$h),this.touchLeave($h),$h.isCancel||(this.tap($h),this.menuTap($h)),this.dragger.dragEnd($h),this.updateCursor(Sh)}pointerCancel(){const $h=Object.assign({},this.dragger.dragData);$h.isCancel=!0,this.pointerUp($h)}menu($h){this.findPath($h),this.emit(it$1.MENU,$h),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap($h)}menuTap($h){this.waitRightTap&&this.waitMenuTap&&(this.emit(it$1.MENU_TAP,$h),this.waitRightTap=this.waitMenuTap=!1)}createTransformer(){}move($h){}zoom($h){}rotate($h){}transformEnd(){}wheel($h){}multiTouch($h,Lh){}keyDown($h){if(!this.config.keyEvent)return;this.emit(pt$1.BEFORE_DOWN,$h,this.defaultPath);const{code:Lh}=$h;this.downKeyMap[Lh]||(this.downKeyMap[Lh]=!0,W.setDownCode(Lh),this.emit(pt$1.HOLD,$h,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(pt$1.DOWN,$h,this.defaultPath)}keyUp($h){if(!this.config.keyEvent)return;this.emit(pt$1.BEFORE_UP,$h,this.defaultPath);const{code:Lh}=$h;this.downKeyMap[Lh]=!1,W.setUpCode(Lh),this.emit(pt$1.UP,$h,this.defaultPath),this.cursor==="grab"&&this.updateCursor()}pointerHover($h){!this.canHover||this.dragging&&!this.p.dragHover||($h.path||($h.path=new kh),this.pointerOverOrOut($h),this.pointerEnterOrLeave($h))}pointerOverOrOut($h){const{path:Lh}=$h,{overPath:Sh}=this;this.overPath=Lh,Sh?Lh.indexAt(0)!==Sh.indexAt(0)&&(this.emit(it$1.OUT,$h,Sh),this.emit(it$1.OVER,$h,Lh)):this.emit(it$1.OVER,$h,Lh)}pointerEnterOrLeave($h){let{path:Lh}=$h;this.downData&&!this.moveMode&&(Lh=Lh.clone(),this.downData.path.forEach(Eh=>Lh.add(Eh)));const{enterPath:Sh}=this;this.enterPath=Lh,this.emit(it$1.LEAVE,$h,Sh,Lh),this.emit(it$1.ENTER,$h,Lh,Sh)}touchLeave($h){$h.pointerType==="touch"&&this.enterPath&&(this.emit(it$1.LEAVE,$h),this.dragger.dragging&&this.emit(ht$1.LEAVE,$h))}tap($h){const{pointer:Lh}=this.config,Sh=this.longTap($h);if(!Lh.tapMore&&Sh||!this.waitTap)return;Lh.tapMore&&this.emitTap($h);const Eh=Date.now()-this.downTime,Gh=[it$1.DOUBLE_TAP,it$1.DOUBLE_CLICK].some(Ah=>Rt$1($h.path,Ah));Eh<Lh.tapTime+50&&Gh?(this.tapCount++,this.tapCount===2?(this.tapWaitCancel(),this.emitDoubleTap($h)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{Lh.tapMore||(this.tapWaitCancel(),this.emitTap($h))},Lh.tapTime))):Lh.tapMore||(this.tapWaitCancel(),this.emitTap($h))}findPath($h,Lh){const{hitRadius:Sh,through:Eh}=this.p,{bottomList:Gh,target:Ah}=this;$t$2.backgrounder||$h.origin||Ah&&Ah.updateLayout();const Ph=this.selector.getByPoint($h,Sh,Object.assign({bottomList:Gh,name:$h.type},Lh||{through:Eh}));return Ph.throughPath&&($h.throughPath=Ph.throughPath),$h.path=Ph.path,Ph.path}isRootPath($h){return $h&&$h.path.list[0].isLeafer}isTreePath($h){const Lh=this.target.app;return!(!Lh||!Lh.isApp)&&Lh.editor&&!$h.path.has(Lh.editor)&&$h.path.has(Lh.tree)&&!$h.target.syncEventer}checkPath($h,Lh){(Lh||this.moveMode&&!bt$1($h.path))&&($h.path=this.defaultPath)}canMove($h){return $h&&(this.moveMode||this.m.drag==="auto"&&!Ct$1($h.path))&&!bt$1($h.path)}isDrag($h){return this.dragger.getList().has($h)}isPress($h){return this.downData&&this.downData.path.has($h)}isHover($h){return this.enterPath&&this.enterPath.has($h)}isFocus($h){return this.focusData===$h}cancelHover(){const{hoverData:$h}=this;$h&&($h.path=this.defaultPath,this.pointerHover($h))}stopDragAnimate(){this.dragger.stopAnimate()}updateDownData($h,Lh,Sh){const{downData:Eh}=this;!$h&&Eh&&($h=Eh),$h&&(this.findPath($h,Lh),Sh&&Eh&&$h.path.addList(Eh.path.list),this.downData=$h)}updateHoverData($h){$h||($h=this.hoverData),$h&&(this.findPath($h,{exclude:this.dragger.getList(!1,!0),name:it$1.MOVE}),this.hoverData=$h)}updateCursor($h){if(!this.config.cursor||!this.canHover)return;if($h||(this.updateHoverData(),$h=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove($h))return this.setCursor(this.downData?"grabbing":"grab");if(!$h)return;let Lh,Sh;const{path:Eh}=$h;for(let Gh=0,Ah=Eh.length;Gh<Ah&&(Lh=Eh.list[Gh],Sh=Lh.syncEventer&&Lh.syncEventer.cursor||Lh.cursor,!Sh);Gh++);this.setCursor(Sh)}setCursor($h){this.cursor=$h}getLocal($h,Lh){const Sh=this.canvas.getClientBounds(Lh),Eh={x:$h.clientX-Sh.x,y:$h.clientY-Sh.y},{bounds:Gh}=this.canvas;return Eh.x*=Gh.width/Sh.width,Eh.y*=Gh.height/Sh.height,this.p.snap&&ot$2.round(Eh),Eh}emitTap($h){this.emit(it$1.TAP,$h),this.emit(it$1.CLICK,$h)}emitDoubleTap($h){this.emit(it$1.DOUBLE_TAP,$h),this.emit(it$1.DOUBLE_CLICK,$h)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){this.waitTap&&(clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0)}longPressWait($h){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(it$1.LONG_PRESS,$h)},this.p.longPressTime)}longTap($h){let Lh;return this.longPressed&&(this.emit(it$1.LONG_TAP,$h),(Rt$1($h.path,it$1.LONG_TAP)||Rt$1($h.path,it$1.LONG_PRESS))&&(Lh=!0)),this.longPressWaitCancel(),Lh}longPressWaitCancel(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressed=!1)}__onResize(){const{dragOut:$h}=this.m;this.shrinkCanvasBounds=new Vt$3(this.canvas.bounds),this.shrinkCanvasBounds.spread(-(o($h)?$h:2))}__listenEvents(){const{target:$h}=this;this.__eventIds=[$h.on_($o.RESIZE,this.__onResize,this)],$h.once(sa.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit($h,Lh,Sh,Eh){this.running&&(function(Gh,Ah,Ph,Nh){if(!Ph&&!Ah.path)return;let Mh;Ah.type=Gh,Ph?Ah=Object.assign(Object.assign({},Ah),{path:Ph}):Ph=Ah.path,Ah.target=Ph.indexAt(0);try{for(let Dh=Ph.length-1;Dh>-1;Dh--){if(Mh=Ph.list[Dh],Ot$1(Mh,Gh,Ah,!0,Nh))return;Mh.isApp&&wt$1(Mh,Gh,Ah,!0,Nh)}for(let Dh=0,Fh=Ph.length;Dh<Fh;Dh++)if(Mh=Ph.list[Dh],Mh.isApp&&wt$1(Mh,Gh,Ah,!1,Nh),Ot$1(Mh,Gh,Ah,!1,Nh))return}catch(Dh){Pt$1.error(Dh)}})($h,Lh,Sh,Eh)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer&&this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}},St$1=class{static set($h,Lh){this.custom[$h]=Lh}static get($h){return this.custom[$h]}};St$1.custom={};let At$1=class extends ge$2{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new kh,this.pixelList=new kh}getPixelType($h,Lh){return this.__autoClear(),this.pixelList.add($h),le$2.hitCanvas(Lh)}getPathType($h){return this.__autoClear(),this.pathList.add($h),le$2.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList($h){$h.length&&($h.forEach(Lh=>{Lh.__hitCanvas&&(Lh.__hitCanvas.destroy(),Lh.__hitCanvas=null)}),$h.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}};$t$2.getSelector=function($h){return $h.leafer?$h.leafer.selector:$t$2.selector||($t$2.selector=le$2.selector())};const{toInnerRadiusPointOf:Bt$1,copyRadiusPoint:kt$1}=ot$2,{hitRadiusPoint:Ht$1,hitPoint:It$1}=zt$2,Nt$1={},Ft$1={},Wt$1=_h.prototype;Wt$1.hit=function($h,Lh=0){this.updateLayout(),kt$1(Ft$1,$h,Lh);const Sh=this.__world;return!!(Lh?Ht$1(Sh,Ft$1):It$1(Sh,Ft$1))&&(this.isBranch?$t$2.getSelector(this).hitPoint(Object.assign({},Ft$1),Lh,{target:this}):this.__hitWorld(Ft$1))},Wt$1.__hitWorld=function($h,Lh){const Sh=this.__;if(!Sh.hitSelf)return!1;const Eh=this.__world,Gh=this.__layout,Ah=Eh.width<10&&Eh.height<10;if(Sh.hitRadius&&(kt$1(Nt$1,$h,Sh.hitRadius),$h=Nt$1),Bt$1($h,Eh,Nt$1),Sh.hitBox||Ah){if(zt$2.hitRadiusPoint(Gh.boxBounds,Nt$1))return!0;if(Ah)return!1}return!Gh.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),Gh.boundsChanged||(Gh.hitCanvasChanged=!1)),this.__hit(Nt$1,Lh)},Wt$1.__hitFill=function($h){const Lh=this.__hitCanvas;return Lh&&Lh.hitFill($h,this.__.windingRule)},Wt$1.__hitStroke=function($h,Lh){const Sh=this.__hitCanvas;return Sh&&Sh.hitStroke($h,Lh)},Wt$1.__hitPixel=function($h){const Lh=this.__hitCanvas;return Lh&&Lh.hitPixel($h,this.__layout.renderBounds,Lh.hitScale)},Wt$1.__drawHitPath=function($h){$h&&this.__drawRenderPath($h)};const Kt$1=new pt$2,Vt$1=ge$1.prototype;Vt$1.__updateHitCanvas=function(){this.__box&&this.__box.__updateHitCanvas();const{hitCanvasManager:$h}=this.leafer||this.parent&&this.parent.leafer||{};if(!$h)return;const Lh=this.__,Sh=(Lh.__isAlphaPixelFill||Lh.__isCanvas)&&Lh.hitFill==="pixel",Eh=Lh.__isAlphaPixelStroke&&Lh.hitStroke==="pixel",Gh=Sh||Eh;this.__hitCanvas||(this.__hitCanvas=Gh?$h.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):$h.getPathType(this));const Ah=this.__hitCanvas;if(Gh){const{renderBounds:Ph}=this.__layout,Nh=$t$2.image.hitCanvasSize,Mh=Ah.hitScale=Ht$3.set(0,0,Nh,Nh).getFitMatrix(Ph).a,{x:Dh,y:Fh,width:Ih,height:Hh}=Ht$3.set(Ph).scale(Mh);Ah.resize({width:Ih,height:Hh,pixelRatio:1}),Ah.clear(),en.patternLocked=!0,this.__renderShape(Ah,{matrix:Kt$1.setWith(this.__world).scaleWith(1/Mh).invertWith().translate(-Dh,-Fh),snapshot:!0,ignoreFill:!Sh,ignoreStroke:!Eh}),en.patternLocked=!1,Ah.resetTransform(),Lh.__isHitPixel=!0}else Lh.__isHitPixel&&(Lh.__isHitPixel=!1);this.__drawHitPath(Ah),Ah.setStrokeOptions(Lh)},Vt$1.__hit=function($h,Lh){if(this.__box&&this.__box.__hit($h))return!0;const Sh=this.__;if(Sh.__isHitPixel&&this.__hitPixel($h))return!0;const{hitFill:Eh}=Sh,Gh=(Sh.fill||Sh.__isCanvas)&&(Eh==="path"||Eh==="pixel"&&!(Sh.__isAlphaPixelFill||Sh.__isCanvas))||Eh==="all"||Lh;if(Gh&&this.__hitFill($h))return!0;const{hitStroke:Ah,__maxStrokeWidth:Ph}=Sh,Nh=Sh.stroke&&(Ah==="path"||Ah==="pixel"&&!Sh.__isAlphaPixelStroke)||Ah==="all";if(!Gh&&!Nh)return!1;const Mh=2*$h.radiusX;let Dh=Mh;if(Nh)switch(Sh.strokeAlign){case"inside":if(Dh+=2*Ph,!Gh&&this.__hitFill($h)&&this.__hitStroke($h,Dh))return!0;Dh=Mh;break;case"center":Dh+=Ph;break;case"outside":if(Dh+=2*Ph,!Gh){if(!this.__hitFill($h)&&this.__hitStroke($h,Dh))return!0;Dh=Mh}}return!!Dh&&this.__hitStroke($h,Dh)};const Ut$1=ge$1.prototype,jt$1=xe$1.prototype,Xt$1=Ae$1.prototype;jt$1.__updateHitCanvas=Xt$1.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&this.hitFill==="pixel"||this.hitStroke==="all"?Ut$1.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},jt$1.__hitFill=Xt$1.__hitFill=function($h){return this.__hitCanvas?Ut$1.__hitFill.call(this,$h):zt$2.hitRadiusPoint(this.__layout.boxBounds,$h)},hi$1.prototype.__drawHitPath=function($h){const{__lineHeight:Lh,fontSize:Sh,__baseLine:Eh,__letterSpacing:Gh,__textDrawData:Ah}=this.__;$h.beginPath(),Gh<0?this.__drawPathByBox($h):Ah.rows.forEach(Ph=>$h.rect(Ph.x,Ph.y-Eh,Ph.width,Lh<Sh?Sh:Lh))},ye$1.prototype.pick=function($h,Lh){return Lh||(Lh=e$1),this.updateLayout(),$t$2.getSelector(this).getByPoint($h,Lh.hitRadius||0,Object.assign(Object.assign({},Lh),{target:this}))};const Yt$1=Ee$2.prototype;Yt$1.hitFill=function($h,Lh){return Lh?this.context.isPointInPath($h.x,$h.y,Lh):this.context.isPointInPath($h.x,$h.y)},Yt$1.hitStroke=function($h,Lh){return this.strokeWidth=Lh,this.context.isPointInStroke($h.x,$h.y)},Yt$1.hitPixel=function($h,Lh,Sh=1){let{x:Eh,y:Gh,radiusX:Ah,radiusY:Ph}=$h;Lh&&(Eh-=Lh.x,Gh-=Lh.y),Ht$3.set(Eh-Ah,Gh-Ph,2*Ah,2*Ph).scale(Sh).ceil();const{data:Nh}=this.context.getImageData(Ht$3.x,Ht$3.y,Ht$3.width||1,Ht$3.height||1);for(let Mh=0,Dh=Nh.length;Mh<Dh;Mh+=4)if(Nh[Mh+3]>0)return!0;return Nh[3]>0};var Z;function J($h,Lh,Sh,Eh){return new(Sh||(Sh=Promise))(function(Gh,Ah){function Ph(Dh){try{Mh(Eh.next(Dh))}catch(Fh){Ah(Fh)}}function Nh(Dh){try{Mh(Eh.throw(Dh))}catch(Fh){Ah(Fh)}}function Mh(Dh){var Fh;Dh.done?Gh(Dh.value):(Fh=Dh.value,Fh instanceof Sh?Fh:new Sh(function(Ih){Ih(Fh)})).then(Ph,Nh)}Mh((Eh=Eh.apply($h,Lh||[])).next())})}(function($h){$h[$h.none=1]="none",$h[$h.free=2]="free",$h[$h.mirrorAngle=3]="mirrorAngle",$h[$h.mirror=4]="mirror"})(Z||(Z={})),typeof SuppressedError=="function"&&SuppressedError;const tt=ee$2.get("LeaferCanvas");class et extends Ee$2{set zIndex(Lh){const{style:Sh}=this.view;Sh.zIndex=Lh,this.setAbsolute(this.view)}set childIndex(Lh){const{view:Sh,parentView:Eh}=this;if(Sh&&Eh){const Gh=Eh.children[Lh];Gh?(this.setAbsolute(Gh),Eh.insertBefore(Sh,Gh)):Eh.appendChild(Gh)}}init(){const{config:Lh}=this,Sh=Lh.view||Lh.canvas;Sh?this.__createViewFrom(Sh):this.__createView();const{style:Eh}=this.view;if(Eh.display||(Eh.display="block"),this.parentView=this.view.parentElement,this.parentView){const Gh=this.parentView.style;Gh.webkitUserSelect=Gh.userSelect="none",this.view.classList.add("leafer-canvas-view")}$t$2.syncDomFont&&!this.parentView&&(Eh.display="none",document.body&&document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(Lh)}set backgroundColor(Lh){this.view.style.backgroundColor=Lh}get backgroundColor(){return this.view.style.backgroundColor}set hittable(Lh){this.view.style.pointerEvents=Lh?"auto":"none"}get hittable(){return this.view.style.pointerEvents!=="none"}__createView(){this.view=document.createElement("canvas")}__createViewFrom(Lh){let Sh=i(Lh)?document.getElementById(Lh):Lh;if(Sh)if(Sh instanceof HTMLCanvasElement)this.view=Sh;else{let Eh=Sh;if(Sh===window||Sh===document){const Ah=document.createElement("div"),{style:Ph}=Ah;Ph.position="absolute",Ph.top=Ph.bottom=Ph.left=Ph.right="0px",document.body.appendChild(Ah),Eh=Ah}this.__createView();const Gh=this.view;Eh.hasChildNodes()&&(this.setAbsolute(Gh),Eh.style.position||(Eh.style.position="relative")),Eh.appendChild(Gh)}else tt.error(`no id: ${Lh}`),this.__createView()}setAbsolute(Lh){const{style:Sh}=Lh;Sh.position="absolute",Sh.top=Sh.left="0px"}updateViewSize(){const{width:Lh,height:Sh,pixelRatio:Eh}=this,{style:Gh}=this.view;Gh.width=Lh+"px",Gh.height=Sh+"px",this.unreal||(this.view.width=Math.ceil(Lh*Eh),this.view.height=Math.ceil(Sh*Eh))}updateClientBounds(){this.view.parentElement&&(this.clientBounds=this.view.getBoundingClientRect())}startAutoLayout(Lh,Sh){if(this.resizeListener=Sh,Lh){if(this.autoBounds=Lh,this.resizeObserver)return;try{this.resizeObserver=new ResizeObserver(Gh=>{this.updateClientBounds();for(const Ah of Gh)this.checkAutoBounds(Ah.contentRect)});const Eh=this.parentView;Eh?(this.resizeObserver.observe(Eh),this.checkAutoBounds(Eh.getBoundingClientRect())):(this.checkAutoBounds(this.view),tt.warn("no parent"))}catch{this.imitateResizeObserver()}this.stopListenPixelRatio()}else this.listenPixelRatio(),this.unreal&&this.updateViewSize()}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),$t$2.requestRender(this.imitateResizeObserver.bind(this)))}listenPixelRatio(){this.windowListener||window.addEventListener("resize",this.windowListener=()=>{const Lh=$t$2.devicePixelRatio;if(!this.config.pixelRatio&&this.pixelRatio!==Lh){const{width:Sh,height:Eh}=this;this.emitResize({width:Sh,height:Eh,pixelRatio:Lh})}})}stopListenPixelRatio(){this.windowListener&&(window.removeEventListener("resize",this.windowListener),this.windowListener=null)}checkAutoBounds(Lh){const Sh=this.view,{x:Eh,y:Gh,width:Ah,height:Ph}=this.autoBounds.getBoundsFrom(Lh),Nh={width:Ah,height:Ph,pixelRatio:this.config.pixelRatio?this.pixelRatio:$t$2.devicePixelRatio};if(!this.isSameSize(Nh)){const{style:Mh}=Sh;Mh.marginLeft=Eh+"px",Mh.marginTop=Gh+"px",this.emitResize(Nh)}}stopAutoLayout(){this.autoLayout=!1,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeListener=this.resizeObserver=null}emitResize(Lh){const Sh={};_.copyAttrs(Sh,this,Re$2),this.resize(Lh),this.resizeListener&&!s(this.width)&&this.resizeListener(new $o(Lh,Sh))}unrealCanvas(){if(!this.unreal&&this.parentView){let Lh=this.view;Lh&&Lh.remove(),Lh=this.view=document.createElement("div"),this.parentView.appendChild(this.view),Lh.classList.add("leafer-app-view"),this.unreal=!0}}destroy(){const{view:Lh}=this;Lh&&(this.stopAutoLayout(),this.stopListenPixelRatio(),Lh.parentElement&&Lh.remove(),super.destroy())}}function it($h,Lh){$t$2.origin={createCanvas(Sh,Eh){const Gh=document.createElement("canvas");return Gh.width=Sh,Gh.height=Eh,Gh},canvasToDataURL:(Sh,Eh,Gh)=>{const Ah=Gi$1.mimeType(Eh),Ph=Sh.toDataURL(Ah,Gh);return Ah==="image/bmp"?Ph.replace("image/png;","image/bmp;"):Ph},canvasToBolb:(Sh,Eh,Gh)=>new Promise(Ah=>Sh.toBlob(Ah,Gi$1.mimeType(Eh),Gh)),canvasSaveAs:(Sh,Eh,Gh)=>{const Ah=Sh.toDataURL(Gi$1.mimeType(Gi$1.fileType(Eh)),Gh);return $t$2.origin.download(Ah,Eh)},download(Sh,Eh){return J(this,void 0,void 0,function*(){let Gh=document.createElement("a");Gh.href=Sh,Gh.download=Eh,document.body.appendChild(Gh),Gh.click(),document.body.removeChild(Gh)})},loadImage:(Sh,Eh,Gh)=>new Promise((Ah,Ph)=>{const Nh=new $t$2.origin.Image;Eh&&(Nh.setAttribute("crossOrigin",Eh),Nh.crossOrigin=Eh),Nh.onload=()=>{Ah(Nh)},Nh.onerror=Mh=>{Ph(Mh)},Nh.src=$t$2.image.getRealURL(Sh)}),loadContent(Sh){return J(this,arguments,void 0,function*(Eh,Gh="text"){const Ah=yield fetch(Eh);if(!Ah.ok)throw new Error(`${Ah.status}`);return yield Ah[Gh]()})},Image,PointerEvent,DragEvent},$t$2.event={stopDefault(Sh){Sh.preventDefault()},stopNow(Sh){Sh.stopImmediatePropagation()},stop(Sh){Sh.stopPropagation()}},$t$2.canvas=le$2.canvas(),$t$2.conicGradientSupport=!!$t$2.canvas.context.createConicGradient}Hi$1(CanvasRenderingContext2D.prototype),Hi$1(Path2D.prototype),Object.assign(le$2,{canvas:($h,Lh)=>new et($h,Lh),image:$h=>new on($h)}),$t$2.name="web",$t$2.isMobile="ontouchstart"in window,$t$2.requestRender=function($h){window.requestAnimationFrame($h)},ln($t$2,"devicePixelRatio",{get:()=>devicePixelRatio});const{userAgent:st}=navigator;st.indexOf("Firefox")>-1?($t$2.conicGradientRotate90=!0,$t$2.intWheelDeltaY=!0,$t$2.syncDomFont=!0):(/iPhone|iPad|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent))&&($t$2.fullImageShadow=!0),st.indexOf("Windows")>-1?($t$2.os="Windows",$t$2.intWheelDeltaY=!0):st.indexOf("Mac")>-1?$t$2.os="Mac":st.indexOf("Linux")>-1&&($t$2.os="Linux");class nt{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove&&this.config.usePartLayout){const Lh=new kh;return this.__updatedList.list.forEach(Sh=>{Sh.leafer&&Lh.add(Sh)}),Lh}return this.__updatedList}constructor(Lh,Sh){this.totalTimes=0,this.config={},this.__updatedList=new kh,this.target=Lh,Sh&&(this.config=_.default(Sh,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(ea.REQUEST)}__onAttrChange(Lh){this.config.usePartLayout&&this.__updatedList.add(Lh.target),this.update()}__onChildEvent(Lh){this.config.usePartLayout&&(Lh.type===zo.ADD?(this.hasAdd=!0,this.__pushChild(Lh.child)):(this.hasRemove=!0,this.__updatedList.add(Lh.parent))),this.update()}__pushChild(Lh){this.__updatedList.add(Lh),Lh.isBranch&&this.__loopChildren(Lh)}__loopChildren(Lh){const{children:Sh}=Lh;for(let Eh=0,Gh=Sh.length;Eh<Gh;Eh++)this.__pushChild(Sh[Eh])}__onRquestData(){this.target.emitEvent(new Ko(Ko.DATA,{updatedList:this.updatedList})),this.__updatedList=new kh,this.totalTimes++,this.changed=this.hasVisible=this.hasRemove=this.hasAdd=!1}__listenEvents(){this.__eventIds=[this.target.on_([[Uo.CHANGE,this.__onAttrChange,this],[[zo.ADD,zo.REMOVE],this.__onChildEvent,this],[Ko.REQUEST,this.__onRquestData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.__updatedList=null)}}const{updateAllMatrix:ot,updateBounds:rt,updateChange:at}=co,{pushAllChildBranch:ht,pushAllParent:lt}=vo,{worldBounds:ct}=xo;class dt{constructor(Lh){this.updatedBounds=new Vt$3,this.beforeBounds=new Vt$3,this.afterBounds=new Vt$3,l(Lh)&&(Lh=new kh(Lh)),this.updatedList=Lh}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,ct)}setAfter(){this.afterBounds.setListWithFn(this.updatedList.list,ct),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(Lh){this.updatedList.addList(Lh.updatedList.list),this.beforeBounds.add(Lh.beforeBounds),this.afterBounds.add(Lh.afterBounds),this.updatedBounds.add(Lh.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:ut,updateAllChange:ft}=co,pt=ee$2.get("Layouter");class gt{constructor(Lh,Sh){this.totalTimes=0,this.config={usePartLayout:!0},this.__levelList=new Ch,this.target=Lh,Sh&&(this.config=_.default(Sh,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(this.layouting||!this.running)return;const{target:Lh}=this;this.times=0;try{Lh.emit(ta.START),this.layoutOnce(),Lh.emitEvent(new ta(ta.END,this.layoutedBlocks,this.times))}catch(Sh){pt.error(Sh)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?pt.warn("layouting"):this.times>3?pt.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Ko.REQUEST),this.totalTimes>1&&this.config.usePartLayout?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var Lh;if(!(!((Lh=this.__updatedList)===null||Lh===void 0)&&Lh.length))return;const Sh=ne$2.start("PartLayout"),{target:Eh,__updatedList:Gh}=this,{BEFORE:Ah,LAYOUT:Ph,AFTER:Nh}=ta,Mh=this.getBlocks(Gh);Mh.forEach(Dh=>Dh.setBefore()),Eh.emitEvent(new ta(Ah,Mh,this.times)),this.extraBlock=null,Gh.sort(),(function(Dh,Fh){let Ih;Dh.list.forEach(Hh=>{Ih=Hh.__layout,Fh.without(Hh)&&!Ih.proxyZoom&&(Ih.matrixChanged?(ot(Hh,!0),Fh.add(Hh),Hh.isBranch&&ht(Hh,Fh),lt(Hh,Fh)):Ih.boundsChanged&&(Fh.add(Hh),Hh.isBranch&&(Hh.__tempNumber=0),lt(Hh,Fh)))})})(Gh,this.__levelList),(function(Dh){let Fh,Ih,Hh;Dh.sort(!0),Dh.levels.forEach(Wh=>{Fh=Dh.levelMap[Wh];for(let zh=0,Uh=Fh.length;zh<Uh;zh++){if(Ih=Fh[zh],Ih.isBranch&&Ih.__tempNumber){Hh=Ih.children;for(let Yh=0,Xh=Hh.length;Yh<Xh;Yh++)Hh[Yh].isBranch||rt(Hh[Yh])}rt(Ih)}})})(this.__levelList),(function(Dh){Dh.list.forEach(at)})(Gh),this.extraBlock&&Mh.push(this.extraBlock),Mh.forEach(Dh=>Dh.setAfter()),Eh.emitEvent(new ta(Ph,Mh,this.times)),Eh.emitEvent(new ta(Nh,Mh,this.times)),this.addBlocks(Mh),this.__levelList.reset(),this.__updatedList=null,ne$2.end(Sh)}fullLayout(){const Lh=ne$2.start("FullLayout"),{target:Sh}=this,{BEFORE:Eh,LAYOUT:Gh,AFTER:Ah}=ta,Ph=this.getBlocks(new kh(Sh));Sh.emitEvent(new ta(Eh,Ph,this.times)),gt.fullLayout(Sh),Ph.forEach(Nh=>{Nh.setAfter()}),Sh.emitEvent(new ta(Gh,Ph,this.times)),Sh.emitEvent(new ta(Ah,Ph,this.times)),this.addBlocks(Ph),ne$2.end(Lh)}static fullLayout(Lh){ut(Lh,!0),Lh.isBranch?vo.updateBounds(Lh):co.updateBounds(Lh),ft(Lh)}addExtra(Lh){if(!this.__updatedList.has(Lh)){const{updatedList:Sh,beforeBounds:Eh}=this.extraBlock||(this.extraBlock=new dt([]));Sh.length?Eh.add(Lh.__world):Eh.set(Lh.__world),Sh.add(Lh)}}createBlock(Lh){return new dt(Lh)}getBlocks(Lh){return[this.createBlock(Lh)]}addBlocks(Lh){this.layoutedBlocks?this.layoutedBlocks.push(...Lh):this.layoutedBlocks=Lh}__onReceiveWatchData(Lh){this.__updatedList=Lh.data.updatedList}__listenEvents(){this.__eventIds=[this.target.on_([[ta.REQUEST,this.layout,this],[ta.AGAIN,this.layoutAgain,this],[Ko.DATA,this.__onReceiveWatchData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const wt=ee$2.get("Renderer");class _t{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(Lh,Sh,Eh){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,ceilPartPixel:!0,maxFPS:120},this.frames=[],this.target=Lh,this.canvas=Sh,Eh&&(this.config=_.default(Eh,this.config)),this.__listenEvents()}start(){this.running=!0,this.update(!1)}stop(){this.running=!1}update(Lh=!0){this.changed||(this.changed=Lh),this.requestTime||this.__requestRender()}requestLayout(){this.target.emit(ta.REQUEST)}checkRender(){if(this.running){const{target:Lh}=this;Lh.isApp&&(Lh.emit(ea.CHILD_START,Lh),Lh.children.forEach(Sh=>{Sh.renderer.FPS=this.FPS,Sh.renderer.checkRender()}),Lh.emit(ea.CHILD_END,Lh)),this.changed&&this.canvas.view&&this.render(),this.target.emit(ea.NEXT)}}render(Lh){if(!this.running||!this.canvas.view)return this.update();const{target:Sh}=this;this.times=0,this.totalBounds=new Vt$3,wt.log(Sh.innerName,"--->");try{this.emitRender(ea.START),this.renderOnce(Lh),this.emitRender(ea.END,this.totalBounds),en.clearRecycled()}catch(Eh){this.rendering=!1,wt.error(Eh)}wt.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(Lh){if(this.rendering)return wt.warn("rendering");if(this.times>3)return wt.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new Vt$3,this.renderOptions={},Lh)this.emitRender(ea.BEFORE),Lh();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(ea.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(ea.RENDER,this.renderBounds,this.renderOptions),this.emitRender(ea.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:Lh,updateBlocks:Sh}=this;Sh&&(this.mergeBlocks(),Sh.forEach(Eh=>{Lh.bounds.hit(Eh)&&!Eh.isEmpty()&&this.clipRender(Eh)}))}clipRender(Lh){const Sh=ne$2.start("PartRender"),{canvas:Eh}=this,Gh=Lh.getIntersect(Eh.bounds),Ah=new Vt$3(Gh);Eh.save(),Gh.spread(_t.clipSpread).ceil();const{ceilPartPixel:Ph}=this.config;Eh.clipWorld(Gh,Ph),Eh.clearWorld(Gh,Ph),this.__render(Gh,Ah),Eh.restore(),ne$2.end(Sh)}fullRender(){const Lh=ne$2.start("FullRender"),{canvas:Sh}=this;Sh.save(),Sh.clear(),this.__render(Sh.bounds),Sh.restore(),ne$2.end(Lh)}__render(Lh,Sh){const{canvas:Eh,target:Gh}=this,Ah=Lh.includes(Gh.__world),Ph=Ah?{includes:Ah}:{bounds:Lh,includes:Ah};this.needFill&&Eh.fillWorld(Lh,this.config.fill),ee$2.showRepaint&&ee$2.drawRepaint(Eh,Lh),this.config.useCellRender&&(Ph.cellList=this.getCellList()),$t$2.render(Gh,Eh,Ph),this.renderBounds=Sh=Sh||Lh,this.renderOptions=Ph,this.totalBounds.isEmpty()?this.totalBounds=Sh:this.totalBounds.add(Sh),Eh.updateRender(Sh)}getCellList(){}addBlock(Lh,Sh){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(Lh)}mergeBlocks(){const{updateBlocks:Lh}=this;if(Lh){const Sh=new Vt$3;Sh.setList(Lh),Lh.length=0,Lh.push(Sh)}}__requestRender(){const Lh=this.target;if(this.requestTime||!Lh)return;if(Lh.parentApp)return Lh.parentApp.requestRender(!1);this.requestTime=this.frameTime||Date.now();const Sh=()=>{const Eh=1e3/((this.frameTime=Date.now())-this.requestTime),{maxFPS:Gh}=this.config;if(Gh&&Eh>Gh)return $t$2.requestRender(Sh);const{frames:Ah}=this;Ah.length>30&&Ah.shift(),Ah.push(Eh),this.FPS=Math.round(Ah.reduce((Ph,Nh)=>Ph+Nh,0)/Ah.length),this.requestTime=0,this.checkRender()};$t$2.requestRender(Sh)}__onResize(Lh){if(!this.canvas.unreal){if(Lh.bigger||!Lh.samePixelRatio){const{width:Sh,height:Eh}=Lh.old;if(!new Vt$3(0,0,Sh,Eh).includes(this.target.__world)||this.needFill||!Lh.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new Vt$3(0,0,1,1)),this.update()}}__onLayoutEnd(Lh){Lh.data&&Lh.data.map(Sh=>{let Eh;const{updatedList:Gh}=Sh;Gh&&Gh.list.some(Ah=>(Eh=!Ah.__world.width||!Ah.__world.height,Eh&&(Ah.isLeafer||wt.tip(Ah.innerName,": empty"),Eh=!Ah.isBranch||Ah.isBranchLeaf),Eh)),this.addBlock(Eh?this.canvas.bounds:Sh.updatedBounds,Gh)})}emitRender(Lh,Sh,Eh){this.target.emitEvent(new ea(Lh,this.times,Sh,Eh))}__listenEvents(){this.__eventIds=[this.target.on_([[ea.REQUEST,this.update,this],[ta.END,this.__onLayoutEnd,this],[ea.AGAIN,this.renderAgain,this],[$o.RESIZE,this.__onResize,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.config={},this.target=this.canvas=null)}}_t.clipSpread=10;const mt={},{copyRadiusPoint:vt}=ot$2,{hitRadiusPoint:yt}=zt$2;class xt{constructor(Lh,Sh){this.target=Lh,this.selector=Sh}getByPoint(Lh,Sh,Eh){Sh||(Sh=0),Eh||(Eh={});const Gh=Eh.through||!1,Ah=Eh.ignoreHittable||!1,Ph=Eh.target||this.target;this.exclude=Eh.exclude||null,this.point={x:Lh.x,y:Lh.y,radiusX:Sh,radiusY:Sh},this.findList=new kh(Eh.findList),Eh.findList||this.hitBranch(Ph.isBranchLeaf?{children:[Ph]}:Ph);const{list:Nh}=this.findList,Mh=this.getBestMatchLeaf(Nh,Eh.bottomList,Ah,!!Eh.findList),Dh=Ah?this.getPath(Mh):this.getHitablePath(Mh);return this.clear(),Gh?{path:Dh,target:Mh,throughPath:Nh.length?this.getThroughPath(Nh):Dh}:{path:Dh,target:Mh}}hitPoint(Lh,Sh,Eh){return!!this.getByPoint(Lh,Sh,Eh).target}getBestMatchLeaf(Lh,Sh,Eh,Gh){const Ah=this.findList=new kh;if(Lh.length){let Ph;const{x:Nh,y:Mh}=this.point,Dh={x:Nh,y:Mh,radiusX:0,radiusY:0};for(let Fh=0,Ih=Lh.length;Fh<Ih;Fh++)if(Ph=Lh[Fh],(Eh||co.worldHittable(Ph))&&(this.hitChild(Ph,Dh),Ah.length)){if(Ph.isBranchLeaf&&Lh.some(Hh=>Hh!==Ph&&co.hasParent(Hh,Ph))){Ah.reset();break}return Ah.list[0]}}if(Sh){for(let Ph=0,Nh=Sh.length;Ph<Nh;Ph++)if(this.hitChild(Sh[Ph].target,this.point,Sh[Ph].proxy),Ah.length)return Ah.list[0]}return Gh?null:Eh?Lh[0]:Lh.find(Ph=>co.worldHittable(Ph))}getPath(Lh){const Sh=new kh,Eh=[],{target:Gh}=this;for(;Lh&&(Lh.syncEventer&&Eh.push(Lh.syncEventer),Sh.add(Lh),(Lh=Lh.parent)!==Gh););return Eh.length&&Eh.forEach(Ah=>{for(;Ah&&(Ah.__.hittable&&Sh.add(Ah),(Ah=Ah.parent)!==Gh););}),Gh&&Sh.add(Gh),Sh}getHitablePath(Lh){const Sh=this.getPath(Lh&&Lh.hittable?Lh:null);let Eh,Gh=new kh;for(let Ah=Sh.list.length-1;Ah>-1&&(Eh=Sh.list[Ah],Eh.__.hittable)&&(Gh.addAt(Eh,0),Eh.__.hitChildren&&(!Eh.isLeafer||Eh.mode!=="draw"));Ah--);return Gh}getThroughPath(Lh){const Sh=new kh,Eh=[];for(let Nh=Lh.length-1;Nh>-1;Nh--)Eh.push(this.getPath(Lh[Nh]));let Gh,Ah,Ph;for(let Nh=0,Mh=Eh.length;Nh<Mh;Nh++){Gh=Eh[Nh],Ah=Eh[Nh+1];for(let Dh=0,Fh=Gh.length;Dh<Fh&&(Ph=Gh.list[Dh],!Ah||!Ah.has(Ph));Dh++)Sh.add(Ph)}return Sh}hitBranch(Lh){this.eachFind(Lh.children,Lh.__onlyHitMask)}eachFind(Lh,Sh){let Eh,Gh,Ah;const{point:Ph}=this;for(let Nh=Lh.length-1;Nh>-1;Nh--)if(Eh=Lh[Nh],Ah=Eh.__,Ah.visible&&(!Sh||Ah.mask))if(Gh=yt(Eh.__world,Ah.hitRadius?vt(mt,Ph,Ah.hitRadius):Ph),Eh.isBranch){if(Gh||Eh.__ignoreHitWorld){if(Eh.isBranchLeaf&&Ah.__clipAfterFill&&!Eh.__hitWorld(Ph,!0))continue;Eh.topChildren&&this.eachFind(Eh.topChildren,!1),this.eachFind(Eh.children,Eh.__onlyHitMask),Eh.isBranchLeaf&&this.hitChild(Eh,Ph)}}else Gh&&this.hitChild(Eh,Ph)}hitChild(Lh,Sh,Eh){if((!this.exclude||!this.exclude.has(Lh))&&Lh.__hitWorld(Sh)){const{parent:Gh}=Lh;if(Gh&&Gh.__hasMask&&!Lh.__.mask){let Ah,Ph=[];const{children:Nh}=Gh;for(let Mh=0,Dh=Nh.length;Mh<Dh;Mh++)if(Ah=Nh[Mh],Ah.__.mask&&Ph.push(Ah),Ah===Lh){if(Ph&&!Ph.every(Fh=>Fh.__hitWorld(Sh)))return;break}}this.findList.add(Eh||Lh)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}class bt{constructor(Lh,Sh){this.config={},Sh&&(this.config=_.default(Sh,this.config)),this.picker=new xt(this.target=Lh,this),this.finder=le$2.finder&&le$2.finder()}getByPoint(Lh,Sh,Eh){const{target:Gh,picker:Ah}=this;return $t$2.backgrounder&&Gh&&Gh.updateLayout(),Ah.getByPoint(Lh,Sh,Eh)}hitPoint(Lh,Sh,Eh){return this.picker.hitPoint(Lh,Sh,Eh)}getBy(Lh,Sh,Eh,Gh){return this.finder?this.finder.getBy(Lh,Sh,Eh,Gh):he$2.need("find")}destroy(){this.picker.destroy(),this.finder&&this.finder.destroy()}}Object.assign(le$2,{watcher:($h,Lh)=>new nt($h,Lh),layouter:($h,Lh)=>new gt($h,Lh),renderer:($h,Lh,Sh)=>new _t($h,Lh,Sh),selector:($h,Lh)=>new bt($h,Lh)}),$t$2.layout=gt.fullLayout,$t$2.render=function($h,Lh,Sh){const Eh=Object.assign(Object.assign({},Sh),{topRendering:!0});Sh.topList=new kh,$h.__render(Lh,Sh),Sh.topList.length&&Sh.topList.forEach(Gh=>Gh.__render(Lh,Eh))};const St={convert($h,Lh){const Sh=_t$1.getBase($h),{x:Eh,y:Gh}=Lh,Ah=Object.assign(Object.assign({},Sh),{x:Eh,y:Gh,width:$h.width,height:$h.height,pointerType:$h.pointerType,pressure:$h.pressure});return Ah.pointerType==="pen"&&(Ah.tangentialPressure=$h.tangentialPressure,Ah.tiltX=$h.tiltX,Ah.tiltY=$h.tiltY,Ah.twist=$h.twist),Ah},convertMouse($h,Lh){const Sh=_t$1.getBase($h),{x:Eh,y:Gh}=Lh;return Object.assign(Object.assign({},Sh),{x:Eh,y:Gh,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch($h,Lh){const Sh=St.getTouch($h),Eh=_t$1.getBase($h),{x:Gh,y:Ah}=Lh;return Object.assign(Object.assign({},Eh),{x:Gh,y:Ah,width:1,height:1,pointerType:"touch",multiTouch:$h.touches.length>1,pressure:Sh.force})},getTouch:$h=>$h.targetTouches[0]||$h.changedTouches[0]},Lt={convert($h){const Lh=_t$1.getBase($h);return Object.assign(Object.assign({},Lh),{code:$h.code,key:$h.key})}},{pathCanDrag:kt}=_t$1;class Tt extends Mt$1{get notPointer(){const{p:Lh}=this;return Lh.type!=="pointer"||Lh.touch||this.useMultiTouch}get notTouch(){const{p:Lh}=this;return Lh.type==="mouse"||this.usePointer}get notMouse(){return this.usePointer||this.useTouch}__listenEvents(){super.__listenEvents();const Lh=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,pointerleave:this.onPointerLeave,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:Sh,windowEvents:Eh}=this;for(let Gh in Sh)Sh[Gh]=Sh[Gh].bind(this),Lh.addEventListener(Gh,Sh[Gh]);for(let Gh in Eh)Eh[Gh]=Eh[Gh].bind(this),window.addEventListener(Gh,Eh[Gh])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:Lh,windowEvents:Sh}=this;for(let Eh in Lh)this.view.removeEventListener(Eh,Lh[Eh]),this.viewEvents={};for(let Eh in Sh)window.removeEventListener(Eh,Sh[Eh]),this.windowEvents={}}getTouches(Lh){const Sh=[];for(let Eh=0,Gh=Lh.length;Eh<Gh;Eh++)Sh.push(Lh[Eh]);return Sh}preventDefaultPointer(Lh){const{pointer:Sh}=this.config;Sh.preventDefault&&Lh.preventDefault()}preventDefaultWheel(Lh){const{wheel:Sh}=this.config;Sh.preventDefault&&Lh.preventDefault()}preventWindowPointer(Lh){return!this.downData&&Lh.target!==this.view}onKeyDown(Lh){this.keyDown(Lt.convert(Lh))}onKeyUp(Lh){this.keyUp(Lt.convert(Lh))}onContextMenu(Lh){this.config.pointer.preventDefaultMenu&&Lh.preventDefault(),this.menu(St.convert(Lh,this.getLocal(Lh)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(Lh){this.preventDefaultPointer(Lh),this.notPointer||(this.usePointer||(this.usePointer=!0),this.pointerDown(St.convert(Lh,this.getLocal(Lh))))}onPointerMove(Lh,Sh){if(this.notPointer||this.preventWindowPointer(Lh))return;this.usePointer||(this.usePointer=!0);const Eh=St.convert(Lh,this.getLocal(Lh,!0));Sh?this.pointerHover(Eh):this.pointerMove(Eh)}onPointerLeave(Lh){this.onPointerMove(Lh,!0)}onPointerUp(Lh){this.downData&&this.preventDefaultPointer(Lh),this.notPointer||this.preventWindowPointer(Lh)||this.pointerUp(St.convert(Lh,this.getLocal(Lh)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(Lh){this.preventDefaultPointer(Lh),this.notMouse||this.pointerDown(St.convertMouse(Lh,this.getLocal(Lh)))}onMouseMove(Lh){this.notMouse||this.preventWindowPointer(Lh)||this.pointerMove(St.convertMouse(Lh,this.getLocal(Lh,!0)))}onMouseUp(Lh){this.downData&&this.preventDefaultPointer(Lh),this.notMouse||this.preventWindowPointer(Lh)||this.pointerUp(St.convertMouse(Lh,this.getLocal(Lh)))}onMouseCancel(){this.notMouse||this.pointerCancel()}onTouchStart(Lh){const Sh=St.getTouch(Lh),Eh=this.getLocal(Sh,!0),{preventDefault:Gh}=this.config.touch;(Gh===!0||Gh==="auto"&&kt(this.findPath(Eh)))&&Lh.preventDefault(),this.multiTouchStart(Lh),this.notTouch||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(St.convertTouch(Lh,Eh)))}onTouchMove(Lh){if(this.multiTouchMove(Lh),this.notTouch||this.preventWindowPointer(Lh))return;const Sh=St.getTouch(Lh);this.pointerMove(St.convertTouch(Lh,this.getLocal(Sh)))}onTouchEnd(Lh){if(this.multiTouchEnd(),this.notTouch||this.preventWindowPointer(Lh))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const Sh=St.getTouch(Lh);this.pointerUp(St.convertTouch(Lh,this.getLocal(Sh)))}onTouchCancel(){this.notTouch||this.pointerCancel()}multiTouchStart(Lh){this.useMultiTouch=Lh.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(Lh.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(Lh){if(this.useMultiTouch&&Lh.touches.length>1){const Sh=this.getTouches(Lh.touches),Eh=this.getKeepTouchList(this.touches,Sh);Eh.length>1&&(this.multiTouch(_t$1.getBase(Lh),Eh),this.touches=Sh)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(Lh,Sh){let Eh;const Gh=[];return Lh.forEach(Ah=>{Eh=Sh.find(Ph=>Ph.identifier===Ah.identifier),Eh&&Gh.push({from:this.getLocal(Ah),to:this.getLocal(Eh)})}),Gh}getLocalTouchs(Lh){return Lh.map(Sh=>this.getLocal(Sh))}onWheel(Lh){this.preventDefaultWheel(Lh),this.wheel(Object.assign(Object.assign(Object.assign({},_t$1.getBase(Lh)),this.getLocal(Lh)),{deltaX:Lh.deltaX,deltaY:Lh.deltaY}))}onGesturestart(Lh){this.useMultiTouch||(this.preventDefaultWheel(Lh),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(Lh){if(this.useMultiTouch)return;this.preventDefaultWheel(Lh);const Sh=_t$1.getBase(Lh);Object.assign(Sh,this.getLocal(Lh));const Eh=Lh.scale/this.lastGestureScale,Gh=(Lh.rotation-this.lastGestureRotation)/Math.PI*180*(I$1.within(this.config.wheel.rotateSpeed,0,1)/4+.1);this.zoom(Object.assign(Object.assign({},Sh),{scale:Eh*Eh})),this.rotate(Object.assign(Object.assign({},Sh),{rotation:Gh})),this.lastGestureScale=Lh.scale,this.lastGestureRotation=Lh.rotation}onGestureend(Lh){this.useMultiTouch||(this.preventDefaultWheel(Lh),this.transformEnd())}setCursor(Lh){super.setCursor(Lh);const Sh=[];this.eachCursor(Lh,Sh),d(Sh[Sh.length-1])&&Sh.push("default"),this.canvas.view.style.cursor=Sh.map(Eh=>d(Eh)?`url(${Eh.url}) ${Eh.x||0} ${Eh.y||0}`:Eh).join(",")}eachCursor(Lh,Sh,Eh=0){if(Eh++,l(Lh))Lh.forEach(Gh=>this.eachCursor(Gh,Sh,Eh));else{const Gh=i(Lh)&&St$1.get(Lh);Gh&&Eh<2?this.eachCursor(Gh,Sh,Eh):Sh.push(Lh)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function Bt($h,Lh,Sh){$h.__.__font?Ft$2.fillText($h,Lh,Sh):$h.__.windingRule?Lh.fill($h.__.windingRule):Lh.fill()}function Et($h,Lh,Sh,Eh,Gh){const Ah=Sh.__;d($h)?Ft$2.drawStrokesStyle($h,Lh,!1,Sh,Eh,Gh):(Eh.setStroke($h,Ah.__strokeWidth*Lh,Ah),Eh.stroke()),Ah.__useArrow&&Ft$2.strokeArrow($h,Sh,Eh,Gh)}function Pt($h,Lh,Sh,Eh,Gh){const Ah=Sh.__;d($h)?Ft$2.drawStrokesStyle($h,Lh,!0,Sh,Eh,Gh):(Eh.setStroke($h,Ah.__strokeWidth*Lh,Ah),Ft$2.drawTextStroke(Sh,Eh,Gh))}function Rt($h,Lh,Sh,Eh,Gh){const Ah=Eh.getSameCanvas(!0,!0);Ah.font=Sh.__.__font,Pt($h,2,Sh,Ah,Gh),Ah.blendMode=Lh==="outside"?"destination-out":"destination-in",Ft$2.fillText(Sh,Ah,Gh),Ah.blendMode="normal",co.copyCanvasByWorld(Sh,Eh,Ah),Ah.recycle(Sh.__nowWorld)}const{getSpread:Mt,copyAndSpread:Ct,toOuterOf:At,getOuterOf:Ot,getByMove:Dt,move:Wt,getIntersectData:It}=zt$2,Ft={};let zt;const{stintSet:jt}=_,{hasTransparent:Ut}=Ct$2;function Gt($h,Lh,Sh){if(!d(Lh)||Lh.visible===!1||Lh.opacity===0)return;let Eh;const{boxBounds:Gh}=Sh.__layout,{type:Ah}=Lh;switch(Ah){case"image":case"film":case"video":if(!Lh.url)return;Eh=Wt$2.image(Sh,$h,Lh,Gh,!zt||!zt[Lh.url]),Ah!=="image"&&Wt$2[Ah](Eh);break;case"linear":Eh=Et$2.linearGradient(Lh,Gh);break;case"radial":Eh=Et$2.radialGradient(Lh,Gh);break;case"angular":Eh=Et$2.conicGradient(Lh,Gh);break;case"solid":const{color:Ph,opacity:Nh}=Lh;Eh={type:Ah,style:Ct$2.string(Ph,Nh)};break;default:s(Lh.r)||(Eh={type:"solid",style:Ct$2.string(Lh)})}if(Eh&&(Eh.originPaint=Lh,i(Eh.style)&&Ut(Eh.style)&&(Eh.isTransparent=!0),Lh.style)){if(Lh.style.strokeWidth===0)return;Eh.strokeStyle=Lh.style}return Eh}const Yt={compute:function($h,Lh){const Sh=Lh.__,Eh=[];let Gh,Ah,Ph,Nh=Sh.__input[$h];l(Nh)||(Nh=[Nh]),zt=Wt$2.recycleImage($h,Sh);for(let Mh,Dh=0,Fh=Nh.length;Dh<Fh;Dh++)(Mh=Gt($h,Nh[Dh],Lh))&&(Eh.push(Mh),Mh.strokeStyle&&(Ph||(Ph=1),Mh.strokeStyle.strokeWidth&&(Ph=Math.max(Ph,Mh.strokeStyle.strokeWidth))));Sh["_"+$h]=Eh.length?Eh:void 0,Eh.length?(Eh.every(Mh=>Mh.isTransparent)&&(Eh.some(Mh=>Mh.image)&&(Gh=!0),Ah=!0),$h==="fill"?(jt(Sh,"__isAlphaPixelFill",Gh),jt(Sh,"__isTransparentFill",Ah)):(jt(Sh,"__isAlphaPixelStroke",Gh),jt(Sh,"__isTransparentStroke",Ah),jt(Sh,"__hasMultiStrokeStyle",Ph))):Sh.__removePaint($h,!1)},fill:function($h,Lh,Sh,Eh){Sh.fillStyle=$h,Bt(Lh,Sh,Eh)},fills:function($h,Lh,Sh,Eh){let Gh,Ah,Ph;for(let Nh=0,Mh=$h.length;Nh<Mh;Nh++){if(Gh=$h[Nh],Ah=Gh.originPaint,Gh.image){if(Ph?Ph++:Ph=1,Wt$2.checkImage(Gh,!Lh.__.__font,Lh,Sh,Eh))continue;if(!Gh.style){Ph===1&&Gh.image.isPlacehold&&Lh.drawImagePlaceholder(Gh,Sh,Eh);continue}}if(Sh.fillStyle=Gh.style,Gh.transform||Ah.scaleFixed){if(Sh.save(),Gh.transform&&Sh.transform(Gh.transform),Ah.scaleFixed){const{scaleX:Dh,scaleY:Fh}=Lh.getRenderScaleData(!0);(Ah.scaleFixed===!0||Ah.scaleFixed==="zoom-in"&&Dh>1&&Fh>1)&&Sh.scale(1/Dh,1/Fh)}Ah.blendMode&&(Sh.blendMode=Ah.blendMode),Bt(Lh,Sh,Eh),Sh.restore()}else Ah.blendMode?(Sh.saveBlendMode(Ah.blendMode),Bt(Lh,Sh,Eh),Sh.restoreBlendMode()):Bt(Lh,Sh,Eh)}},fillPathOrText:Bt,fillText:function($h,Lh,Sh){const Eh=$h.__,{rows:Gh,decorationY:Ah}=Eh.__textDrawData;let Ph;Eh.__isPlacehold&&Eh.placeholderColor&&(Lh.fillStyle=Eh.placeholderColor);for(let Nh=0,Mh=Gh.length;Nh<Mh;Nh++)Ph=Gh[Nh],Ph.text?Lh.fillText(Ph.text,Ph.x,Ph.y):Ph.data&&Ph.data.forEach(Dh=>{Lh.fillText(Dh.char,Dh.x,Ph.y)});if(Ah){const{decorationColor:Nh,decorationHeight:Mh}=Eh.__textDrawData;Nh&&(Lh.fillStyle=Nh),Gh.forEach(Dh=>Ah.forEach(Fh=>Lh.fillRect(Dh.x,Dh.y+Fh,Dh.width,Mh)))}},stroke:function($h,Lh,Sh,Eh){const Gh=Lh.__;if(Gh.__strokeWidth)if(Gh.__font)Ft$2.strokeText($h,Lh,Sh,Eh);else switch(Gh.strokeAlign){case"center":Et($h,1,Lh,Sh,Eh);break;case"inside":(function(Ah,Ph,Nh,Mh){Nh.save(),Nh.clipUI(Ph),Et(Ah,2,Ph,Nh,Mh),Nh.restore()})($h,Lh,Sh,Eh);break;case"outside":(function(Ah,Ph,Nh,Mh){const Dh=Ph.__;if(Dh.__fillAfterStroke)Et(Ah,2,Ph,Nh,Mh);else{const{renderBounds:Fh}=Ph.__layout,Ih=Nh.getSameCanvas(!0,!0);Ph.__drawRenderPath(Ih),Et(Ah,2,Ph,Ih,Mh),Ih.clipUI(Dh),Ih.clearWorld(Fh),co.copyCanvasByWorld(Ph,Nh,Ih),Ih.recycle(Ph.__nowWorld)}})($h,Lh,Sh,Eh)}},strokes:function($h,Lh,Sh,Eh){Ft$2.stroke($h,Lh,Sh,Eh)},strokeText:function($h,Lh,Sh,Eh){switch(Lh.__.strokeAlign){case"center":Pt($h,1,Lh,Sh,Eh);break;case"inside":Rt($h,"inside",Lh,Sh,Eh);break;case"outside":Lh.__.__fillAfterStroke?Pt($h,2,Lh,Sh,Eh):Rt($h,"outside",Lh,Sh,Eh)}},drawTextStroke:function($h,Lh,Sh){let Eh,Gh=$h.__.__textDrawData;const{rows:Ah,decorationY:Ph}=Gh;for(let Nh=0,Mh=Ah.length;Nh<Mh;Nh++)Eh=Ah[Nh],Eh.text?Lh.strokeText(Eh.text,Eh.x,Eh.y):Eh.data&&Eh.data.forEach(Dh=>{Lh.strokeText(Dh.char,Dh.x,Eh.y)});if(Ph){const{decorationHeight:Nh}=Gh;Ah.forEach(Mh=>Ph.forEach(Dh=>Lh.strokeRect(Mh.x,Mh.y+Dh,Mh.width,Nh)))}},drawStrokesStyle:function($h,Lh,Sh,Eh,Gh,Ah){let Ph;const Nh=Eh.__,{__hasMultiStrokeStyle:Mh}=Nh;Mh||Gh.setStroke(void 0,Nh.__strokeWidth*Lh,Nh);for(let Dh=0,Fh=$h.length;Dh<Fh;Dh++)if(Ph=$h[Dh],(!Ph.image||!Wt$2.checkImage(Ph,!1,Eh,Gh,Ah))&&Ph.style){if(Mh){const{strokeStyle:Ih}=Ph;Ih?Gh.setStroke(Ph.style,Nh.__getRealStrokeWidth(Ih)*Lh,Nh,Ih):Gh.setStroke(Ph.style,Nh.__strokeWidth*Lh,Nh)}else Gh.strokeStyle=Ph.style;Ph.originPaint.blendMode?(Gh.saveBlendMode(Ph.originPaint.blendMode),Sh?Ft$2.drawTextStroke(Eh,Gh,Ah):Gh.stroke(),Gh.restoreBlendMode()):Sh?Ft$2.drawTextStroke(Eh,Gh,Ah):Gh.stroke()}},shape:function($h,Lh,Sh){const Eh=Lh.getSameCanvas(),Gh=Lh.bounds,Ah=$h.__nowWorld,Ph=$h.__layout,Nh=$h.__nowWorldShapeBounds||($h.__nowWorldShapeBounds={});let Mh,Dh,Fh,Ih,Hh,Wh;At(Ph.strokeSpread?(Ct(Ft,Ph.boxBounds,Ph.strokeSpread),Ft):Ph.boxBounds,Ah,Nh);let{scaleX:zh,scaleY:Uh}=$h.getRenderScaleData(!0);if(Gh.includes(Nh))Wh=Eh,Mh=Hh=Nh,Dh=Ah;else{let Yh;if($t$2.fullImageShadow)Yh=Nh;else{const Kh=Ph.renderShapeSpread?Mt(Gh,v.swapAndScale(Ph.renderShapeSpread,zh,Uh)):Gh;Yh=It(Kh,Nh)}Ih=Gh.getFitMatrix(Yh);let{a:Xh,d:jh}=Ih;Ih.a<1&&(Wh=Lh.getSameCanvas(),$h.__renderShape(Wh,Sh),zh*=Xh,Uh*=jh),Hh=Ot(Nh,Ih),Mh=Dt(Hh,-Ih.e,-Ih.f),Dh=Ot(Ah,Ih),Wt(Dh,-Ih.e,-Ih.f);const qh=Sh.matrix;qh?(Fh=new pt$2(Ih),Fh.multiply(qh),Xh*=qh.scaleX,jh*=qh.scaleY):Fh=Ih,Fh.withScale(Xh,jh),Sh=Object.assign(Object.assign({},Sh),{matrix:Fh})}return $h.__renderShape(Eh,Sh),{canvas:Eh,matrix:Fh,fitMatrix:Ih,bounds:Mh,renderBounds:Dh,worldCanvas:Wh,shapeBounds:Hh,scaleX:zh,scaleY:Uh}}};let Xt,Vt=new Vt$3;const{isSame:Nt}=zt$2;function Ht($h,Lh,Sh,Eh,Gh,Ah){const Ph=$h.__;if(Lh==="fill"&&!Ph.__naturalWidth&&(Ph.__naturalWidth=Eh.width/Ph.pixelRatio,Ph.__naturalHeight=Eh.height/Ph.pixelRatio,Ph.__autoSide))return $h.forceUpdate("width"),$h.__proxyData&&($h.setProxyAttr("width",Ph.width),$h.setProxyAttr("height",Ph.height)),!1;if(!Gh.data){Wt$2.createData(Gh,Eh,Sh,Ah);const{transform:Nh}=Gh.data,{opacity:Mh,blendMode:Dh}=Sh,Fh=Nh&&!Nh.onlyScale||Ph.path||Ph.cornerRadius;(Fh||Mh&&Mh<1||Dh)&&(Gh.complex=!Fh||2)}return!0}function qt($h,Lh){$t($h,Vo.LOAD,Lh)}function Kt($h,Lh){$t($h,Vo.LOADED,Lh)}function Qt($h,Lh,Sh){Lh.error=Sh,$h.forceUpdate("surface"),$t($h,Vo.ERROR,Lh)}function $t($h,Lh,Sh){$h.hasEvent(Lh)&&$h.emitEvent(new Vo(Lh,Sh))}function Zt($h,Lh){const{leafer:Sh}=$h;Sh&&Sh.viewReady&&(Sh.renderer.ignore=Lh)}const{get:Jt,translate:te}=q$1,ee=new Vt$3,ie={},se={};function ne($h,Lh,Sh,Eh){const Gh=i($h)||Eh?(Eh?Sh-Eh*Lh:Sh%Lh)/((Eh||Math.floor(Sh/Lh))-1):$h;return $h==="auto"&&Gh<0?0:Gh}let oe={},re=X$1();const{get:ae,set:he,rotateOfOuter:le,translate:ce,scaleOfOuter:de,multiplyParent:ue,scale:fe,rotate:pe,skew:ge}=q$1;function we($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh){Ph&&pe($h,Ph),Nh&&ge($h,Nh.x,Nh.y),Gh&&fe($h,Gh,Ah),ce($h,Lh.x+Sh,Lh.y+Eh)}const{get:_e,scale:me,copy:ve}=q$1,{getFloorScale:ye}=I$1,{abs:xe}=Math,be={image:function($h,Lh,Sh,Eh,Gh){let Ah,Ph;const Nh=en.get(Sh,Sh.type);return Xt&&Sh===Xt.paint&&Nt(Eh,Xt.boxBounds)?Ah=Xt.leafPaint:(Ah={type:Sh.type,image:Nh},Nh.hasAlphaPixel&&(Ah.isTransparent=!0),Xt=Nh.use>1?{leafPaint:Ah,paint:Sh,boxBounds:Vt.set(Eh)}:null),(Gh||Nh.loading)&&(Ph={image:Nh,attrName:Lh,attrValue:Sh}),Nh.ready?(Ht($h,Lh,Sh,Nh,Ah,Eh),Gh&&(qt($h,Ph),Kt($h,Ph))):Nh.error?Gh&&Qt($h,Ph,Nh.error):(Gh&&(Zt($h,!0),qt($h,Ph)),Ah.loadId=Nh.load(()=>{Zt($h,!1),$h.destroyed||(Ht($h,Lh,Sh,Nh,Ah,Eh)&&(Nh.hasAlphaPixel&&($h.__layout.hitCanvasChanged=!0),$h.forceUpdate("surface")),Kt($h,Ph)),Ah.loadId=void 0},Mh=>{Zt($h,!1),Qt($h,Ph,Mh),Ah.loadId=void 0},Sh.lod&&Nh.getThumbSize(Sh.lod)),$h.placeholderColor&&($h.placeholderDelay?setTimeout(()=>{Nh.ready||(Nh.isPlacehold=!0,$h.forceUpdate("surface"))},$h.placeholderDelay):Nh.isPlacehold=!0)),Ah},checkImage:function($h,Lh,Sh,Eh,Gh){const{scaleX:Ah,scaleY:Ph}=Wt$2.getImageRenderScaleData($h,Sh,Eh,Gh),Nh=$h.film?$h.nowIndex:Ah+"-"+Ph,{image:Mh,data:Dh,originPaint:Fh}=$h,{exporting:Ih,snapshot:Hh}=Gh;return!(!Dh||$h.patternId===Nh&&!Ih||Hh)&&(Lh&&(Dh.repeat?Lh=!1:Fh.changeful||$h.film||$t$2.name==="miniapp"&&$o.isResizing(Sh)||Ih||(Lh=$t$2.image.isLarge(Mh,Ah,Ph)||Mh.width*Ah>8096||Mh.height*Ph>8096)),Lh?(Sh.__.__isFastShadow&&(Eh.fillStyle=$h.style||"#000",Eh.fill()),Wt$2.drawImage($h,Ah,Ph,Sh,Eh,Gh),!0):(!$h.style||Fh.sync||Ih?Wt$2.createPattern($h,Sh,Eh,Gh):Wt$2.createPatternTask($h,Sh,Eh,Gh),!1))},drawImage:function($h,Lh,Sh,Eh,Gh,Ah){const{data:Ph,image:Nh,complex:Mh}=$h;let{width:Dh,height:Fh}=Nh;if(Mh){const{blendMode:Ih,opacity:Hh}=$h.originPaint,{transform:Wh}=Ph;Gh.save(),Mh===2&&Gh.clipUI(Eh),Ih&&(Gh.blendMode=Ih),Hh&&(Gh.opacity*=Hh),Wh&&Gh.transform(Wh),Nh.render(Gh,0,0,Dh,Fh,Eh,$h,Lh,Sh),Gh.restore()}else Ph.scaleX&&(Dh*=Ph.scaleX,Fh*=Ph.scaleY),Nh.render(Gh,0,0,Dh,Fh,Eh,$h,Lh,Sh)},getImageRenderScaleData:function($h,Lh,Sh,Eh){const Gh=Lh.getRenderScaleData(!0,$h.originPaint.scaleFixed),{data:Ah}=$h;if(Sh){const{pixelRatio:Ph}=Sh;Gh.scaleX*=Ph,Gh.scaleY*=Ph}return Ah&&Ah.scaleX&&(Gh.scaleX*=Math.abs(Ah.scaleX),Gh.scaleY*=Math.abs(Ah.scaleY)),Gh},recycleImage:function($h,Lh){const Sh=Lh["_"+$h];if(l(Sh)){let Eh,Gh,Ah,Ph,Nh;for(let Mh=0,Dh=Sh.length;Mh<Dh;Mh++)Eh=Sh[Mh],Gh=Eh.image,Nh=Gh&&Gh.url,Nh&&(Ah||(Ah={}),Ah[Nh]=!0,en.recyclePaint(Eh),Gh.loading&&(Ph||(Ph=Lh.__input&&Lh.__input[$h]||[],l(Ph)||(Ph=[Ph])),Gh.unload(Sh[Mh].loadId,!Ph.some(Fh=>Fh.url===Nh))));return Ah}return null},createPatternTask:function($h,Lh,Sh,Eh){$h.patternTask||($h.patternTask=en.patternTasker.add(()=>J(this,void 0,void 0,function*(){Wt$2.createPattern($h,Lh,Sh,Eh),Lh.forceUpdate("surface")}),0,()=>($h.patternTask=null,Sh.bounds.hit(Lh.__nowWorld))))},createPattern:function($h,Lh,Sh,Eh){let{scaleX:Gh,scaleY:Ah}=Wt$2.getImageRenderScaleData($h,Lh,Sh,Eh),Ph=$h.film?$h.nowIndex:Gh+"-"+Ah;if($h.patternId!==Ph&&!Lh.destroyed&&(!$t$2.image.isLarge($h.image,Gh,Ah)||$h.data.repeat)){const{image:Nh,data:Mh}=$h,{opacity:Dh,filters:Fh}=$h.originPaint,{transform:Ih,gap:Hh}=Mh,Wh=Wt$2.getPatternFixScale($h,Gh,Ah);let zh,Uh,Yh,{width:Xh,height:jh}=Nh;Wh&&(Gh*=Wh,Ah*=Wh),Xh*=Gh,jh*=Ah,Hh&&(Uh=Hh.x*Gh/xe(Mh.scaleX||1),Yh=Hh.y*Ah/xe(Mh.scaleY||1)),(Ih||Gh!==1||Ah!==1)&&(Gh*=ye(Xh+(Uh||0)),Ah*=ye(jh+(Yh||0)),zh=_e(),Ih&&ve(zh,Ih),me(zh,1/Gh,1/Ah));const qh=Nh.getCanvas(Xh,jh,Dh,Fh,Uh,Yh,Lh.leafer&&Lh.leafer.config.smooth,Mh.interlace),Kh=Nh.getPattern(qh,Mh.repeat||$t$2.origin.noRepeat||"no-repeat",zh,$h);$h.style=Kh,$h.patternId=Ph}},getPatternFixScale:function($h,Lh,Sh){const{image:Eh}=$h;let Gh,Ah=$t$2.image.maxPatternSize,Ph=Eh.width*Eh.height;return Eh.isSVG?Lh>1&&(Gh=Math.ceil(Lh)/Lh):Ah>Ph&&(Ah=Ph),(Ph*=Lh*Sh)>Ah&&(Gh=Math.sqrt(Ah/Ph)),Gh},createData:function($h,Lh,Sh,Eh){$h.data=Wt$2.getPatternData(Sh,Eh,Lh)},getPatternData:function($h,Lh,Sh){$h.padding&&(Lh=ee.set(Lh).shrink($h.padding)),$h.mode==="strench"&&($h.mode="stretch");const{width:Eh,height:Gh}=Sh,{mode:Ah,align:Ph,offset:Nh,scale:Mh,size:Dh,rotation:Fh,skew:Ih,clipSize:Hh,repeat:Wh,gap:zh,interlace:Uh}=$h,Yh=Lh.width===Eh&&Lh.height===Gh,Xh={mode:Ah},jh=Ph!=="center"&&(Fh||0)%180==90;let qh,Kh;switch(zt$2.set(se,0,0,jh?Gh:Eh,jh?Eh:Gh),Ah&&Ah!=="cover"&&Ah!=="fit"?((Mh||Dh)&&(I$1.getScaleData(Mh,Dh,Sh,ie),qh=ie.scaleX,Kh=ie.scaleY),(Ph||zh||Wh)&&(qh&&zt$2.scale(se,qh,Kh,!0),Ph&&kt$3.toPoint(Ph,se,Lh,se,!0,!0))):Yh&&!Fh||(qh=Kh=zt$2.getFitScale(Lh,se,Ah!=="fit"),zt$2.put(Lh,Sh,Ph,qh,!1,se),zt$2.scale(se,qh,Kh,!0)),Nh&&ot$2.move(se,Nh),Ah){case"stretch":Yh?qh&&(qh=Kh=void 0):(qh=Lh.width/Eh,Kh=Lh.height/Gh,Wt$2.stretchMode(Xh,Lh,qh,Kh));break;case"normal":case"clip":if(se.x||se.y||qh||Hh||Fh||Ih){let il,Jh;Hh&&(il=Lh.width/Hh.width,Jh=Lh.height/Hh.height),Wt$2.clipMode(Xh,Lh,se.x,se.y,qh,Kh,Fh,Ih,il,Jh),il&&(qh=qh?qh*il:il,Kh=Kh?Kh*Jh:Jh)}break;case"repeat":(!Yh||qh||Fh||Ih)&&Wt$2.repeatMode(Xh,Lh,Eh,Gh,se.x,se.y,qh,Kh,Fh,Ih,Ph,$h.freeTransform),Wh||(Xh.repeat="repeat");const Zh=d(Wh);(zh||Zh)&&(Xh.gap=(function(il,Jh,Qh,el,nl){let Vh,sl;return d(il)?(Vh=il.x,sl=il.y):Vh=sl=il,{x:ne(Vh,Qh,nl.width,Jh&&Jh.x),y:ne(sl,el,nl.height,Jh&&Jh.y)}})(zh,Zh&&Wh,se.width,se.height,Lh));break;default:qh&&Wt$2.fillOrFitMode(Xh,Lh,se.x,se.y,qh,Kh,Fh)}return Xh.transform||(Lh.x||Lh.y)&&te(Xh.transform=Jt(),Lh.x,Lh.y),qh&&(Xh.scaleX=qh,Xh.scaleY=Kh),Wh&&(Xh.repeat=i(Wh)?Wh==="x"?"repeat-x":"repeat-y":"repeat"),Uh&&(Xh.interlace=o(Uh)||Uh.type==="percent"?{type:"x",offset:Uh}:Uh),Xh},stretchMode:function($h,Lh,Sh,Eh){const Gh=ae(),{x:Ah,y:Ph}=Lh;Ah||Ph?ce(Gh,Ah,Ph):Sh>0&&Eh>0&&(Gh.onlyScale=!0),fe(Gh,Sh,Eh),$h.transform=Gh},fillOrFitMode:function($h,Lh,Sh,Eh,Gh,Ah,Ph){const Nh=ae();ce(Nh,Lh.x+Sh,Lh.y+Eh),fe(Nh,Gh,Ah),Ph&&le(Nh,{x:Lh.x+Lh.width/2,y:Lh.y+Lh.height/2},Ph),$h.transform=Nh},clipMode:function($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh){const Fh=ae();we(Fh,Lh,Sh,Eh,Gh,Ah,Ph,Nh),Mh&&(Ph||Nh?(he(re),de(re,Lh,Mh,Dh),ue(Fh,re)):de(Fh,Lh,Mh,Dh)),$h.transform=Fh},repeatMode:function($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih){const Hh=ae();if(Ih)we(Hh,Lh,Gh,Ah,Ph,Nh,Mh,Dh);else{if(Mh)if(Fh==="center")le(Hh,{x:Sh/2,y:Eh/2},Mh);else switch(pe(Hh,Mh),Mh){case 90:ce(Hh,Eh,0);break;case 180:ce(Hh,Sh,Eh);break;case 270:ce(Hh,0,Sh)}oe.x=Lh.x+Gh,oe.y=Lh.y+Ah,ce(Hh,oe.x,oe.y),Ph&&de(Hh,oe,Ph,Nh)}$h.transform=Hh}},{toPoint:Se}=bt$3,{hasTransparent:Le}=Ct$2,ke={},Te={};function Be($h,Lh,Sh,Eh){if(Sh){let Gh,Ah,Ph,Nh;for(let Mh=0,Dh=Sh.length;Mh<Dh;Mh++)Gh=Sh[Mh],i(Gh)?(Ph=Mh/(Dh-1),Ah=Ct$2.string(Gh,Eh)):(Ph=Gh.offset,Ah=Ct$2.string(Gh.color,Eh)),Lh.addColorStop(Ph,Ah),!Nh&&Le(Ah)&&(Nh=!0);Nh&&($h.isTransparent=!0)}}const{getAngle:Ee,getDistance:Pe}=ot$2,{get:Re,rotateOfOuter:Me,scaleOfOuter:Ce}=q$1,{toPoint:Ae}=bt$3,Oe={},De={};function We($h,Lh,Sh,Eh,Gh){let Ah;const{width:Ph,height:Nh}=$h;if(Ph!==Nh||Eh){const Mh=Ee(Lh,Sh);Ah=Re(),Gh?(Ce(Ah,Lh,Ph/Nh*(Eh||1),1),Me(Ah,Lh,Mh+90)):(Ce(Ah,Lh,1,Ph/Nh*(Eh||1)),Me(Ah,Lh,Mh))}return Ah}const{getDistance:Ie}=ot$2,{toPoint:Fe}=bt$3,ze={},je={},Ue={linearGradient:function($h,Lh){let{from:Sh,to:Eh,type:Gh,opacity:Ah}=$h;Se(Sh||"top",Lh,ke),Se(Eh||"bottom",Lh,Te);const Ph=$t$2.canvas.createLinearGradient(ke.x,ke.y,Te.x,Te.y),Nh={type:Gh,style:Ph};return Be(Nh,Ph,$h.stops,Ah),Nh},radialGradient:function($h,Lh){let{from:Sh,to:Eh,type:Gh,opacity:Ah,stretch:Ph}=$h;Ae(Sh||"center",Lh,Oe),Ae(Eh||"bottom",Lh,De);const Nh=$t$2.canvas.createRadialGradient(Oe.x,Oe.y,0,Oe.x,Oe.y,Pe(Oe,De)),Mh={type:Gh,style:Nh};Be(Mh,Nh,$h.stops,Ah);const Dh=We(Lh,Oe,De,Ph,!0);return Dh&&(Mh.transform=Dh),Mh},conicGradient:function($h,Lh){let{from:Sh,to:Eh,type:Gh,opacity:Ah,stretch:Ph}=$h;Fe(Sh||"center",Lh,ze),Fe(Eh||"bottom",Lh,je);const Nh=$t$2.conicGradientSupport?$t$2.canvas.createConicGradient(0,ze.x,ze.y):$t$2.canvas.createRadialGradient(ze.x,ze.y,0,ze.x,ze.y,Ie(ze,je)),Mh={type:Gh,style:Nh};Be(Mh,Nh,$h.stops,Ah);const Dh=We(Lh,ze,je,Ph||1,$t$2.conicGradientRotate90);return Dh&&(Mh.transform=Dh),Mh},getTransform:We},{copy:Ge,move:Ye,toOffsetOutBounds:Xe}=zt$2,{max:Ve,abs:Ne}=Math,He={},qe=new pt$2,Ke={};function Qe($h,Lh){let Sh,Eh,Gh,Ah,Ph=0,Nh=0,Mh=0,Dh=0;return Lh.forEach(Fh=>{Sh=Fh.x||0,Eh=Fh.y||0,Ah=1.5*(Fh.blur||0),Gh=Ne(Fh.spread||0),Ph=Ve(Ph,Gh+Ah-Eh),Nh=Ve(Nh,Gh+Ah+Sh),Mh=Ve(Mh,Gh+Ah+Eh),Dh=Ve(Dh,Gh+Ah-Sh)}),Ph===Nh&&Nh===Mh&&Mh===Dh?Ph:[Ph,Nh,Mh,Dh]}function $e($h,Lh,Sh){const{shapeBounds:Eh}=Sh;let Gh,Ah;$t$2.fullImageShadow?(Ge(He,$h.bounds),Ye(He,Lh.x-Eh.x,Lh.y-Eh.y),Gh=$h.bounds,Ah=He):(Gh=Eh,Ah=Lh),$h.copyWorld(Sh.canvas,Gh,Ah)}const{toOffsetOutBounds:Ze}=zt$2,Je={},ti=Qe,ei={shadow:function($h,Lh,Sh){let Eh,Gh;const{__nowWorld:Ah}=$h,{shadow:Ph}=$h.__,{worldCanvas:Nh,bounds:Mh,renderBounds:Dh,shapeBounds:Fh,scaleX:Ih,scaleY:Hh}=Sh,Wh=Lh.getSameCanvas(),zh=Ph.length-1;Xe(Mh,Ke,Dh),Ph.forEach((Uh,Yh)=>{let Xh=1;if(Uh.scaleFixed){const jh=Math.abs(Ah.scaleX);jh>1&&(Xh=1/jh)}Wh.setWorldShadow(Ke.offsetX+(Uh.x||0)*Ih*Xh,Ke.offsetY+(Uh.y||0)*Hh*Xh,(Uh.blur||0)*Ih*Xh,Ct$2.string(Uh.color)),Gh=Tt$2.getShadowTransform($h,Wh,Sh,Uh,Ke,Xh),Gh&&Wh.setTransform(Gh),$e(Wh,Ke,Sh),Gh&&Wh.resetTransform(),Eh=Dh,Uh.box&&(Wh.restore(),Wh.save(),Nh&&(Wh.copyWorld(Wh,Dh,Ah,"copy"),Eh=Ah),Nh?Wh.copyWorld(Nh,Ah,Ah,"destination-out"):Wh.copyWorld(Sh.canvas,Fh,Mh,"destination-out")),co.copyCanvasByWorld($h,Lh,Wh,Eh,Uh.blendMode),zh&&Yh<zh&&Wh.clearWorld(Eh)}),Wh.recycle(Eh)},innerShadow:function($h,Lh,Sh){let Eh,Gh;const{__nowWorld:Ah}=$h,{innerShadow:Ph}=$h.__,{worldCanvas:Nh,bounds:Mh,renderBounds:Dh,shapeBounds:Fh,scaleX:Ih,scaleY:Hh}=Sh,Wh=Lh.getSameCanvas(),zh=Ph.length-1;Ze(Mh,Je,Dh),Ph.forEach((Uh,Yh)=>{let Xh=1;if(Uh.scaleFixed){const jh=Math.abs(Ah.scaleX);jh>1&&(Xh=1/jh)}Wh.save(),Wh.setWorldShadow(Je.offsetX+(Uh.x||0)*Ih*Xh,Je.offsetY+(Uh.y||0)*Hh*Xh,(Uh.blur||0)*Ih*Xh),Gh=Tt$2.getShadowTransform($h,Wh,Sh,Uh,Je,Xh,!0),Gh&&Wh.setTransform(Gh),$e(Wh,Je,Sh),Wh.restore(),Nh?(Wh.copyWorld(Wh,Dh,Ah,"copy"),Wh.copyWorld(Nh,Ah,Ah,"source-out"),Eh=Ah):(Wh.copyWorld(Sh.canvas,Fh,Mh,"source-out"),Eh=Dh),Wh.fillWorld(Eh,Ct$2.string(Uh.color),"source-in"),co.copyCanvasByWorld($h,Lh,Wh,Eh,Uh.blendMode),zh&&Yh<zh&&Wh.clearWorld(Eh)}),Wh.recycle(Eh)},blur:function($h,Lh,Sh){const{blur:Eh}=$h.__;Sh.setWorldBlur(Eh*$h.__nowWorld.a),Sh.copyWorldToInner(Lh,$h.__nowWorld,$h.__layout.renderBounds),Sh.filter="none"},backgroundBlur:function($h,Lh,Sh){},getShadowRenderSpread:Qe,getShadowTransform:function($h,Lh,Sh,Eh,Gh,Ah,Ph){if(Eh.spread){const Nh=2*Eh.spread*Ah*(Ph?-1:1),{width:Mh,height:Dh}=$h.__layout.strokeBounds;return qe.set().scaleOfOuter({x:(Gh.x+Gh.width/2)*Lh.pixelRatio,y:(Gh.y+Gh.height/2)*Lh.pixelRatio},1+Nh/Mh,1+Nh/Dh),qe}},isTransformShadow($h){},getInnerShadowSpread:ti},{excludeRenderBounds:ii}=xo;let si;function ni($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh){switch(Lh){case"grayscale":si||(si=!0,Gh.useGrayscaleAlpha($h.__nowWorld));case"alpha":(function(Mh,Dh,Fh,Ih,Hh,Wh){const zh=Mh.__nowWorld;Fh.resetTransform(),Fh.opacity=1,Fh.useMask(Ih,zh),Wh&&Ih.recycle(zh),ri(Mh,Dh,Fh,1,Hh,Wh)})($h,Sh,Eh,Gh,Ph,Nh);break;case"opacity-path":ri($h,Sh,Eh,Ah,Ph,Nh);break;case"path":Nh&&Sh.restore()}}function oi($h){return $h.getSameCanvas(!1,!0)}function ri($h,Lh,Sh,Eh,Gh,Ah){const Ph=$h.__nowWorld;Lh.resetTransform(),Lh.opacity=Eh,Lh.copyWorld(Sh,Ph,void 0,Gh),Ah?Sh.recycle(Ph):Sh.clearWorld(Ph)}ye$1.prototype.__renderMask=function($h,Lh){let Sh,Eh,Gh,Ah,Ph,Nh;const{children:Mh}=this;for(let Dh=0,Fh=Mh.length;Dh<Fh;Dh++){if(Sh=Mh[Dh],Nh=Sh.__.mask,Nh){Ph&&(ni(this,Ph,$h,Gh,Eh,Ah,void 0,!0),Eh=Gh=null),Nh!=="clipping"&&Nh!=="clipping-path"||ii(Sh,Lh)||Sh.__render($h,Lh),Ah=Sh.__.opacity,si=!1,Nh==="path"||Nh==="clipping-path"?(Ah<1?(Ph="opacity-path",Gh||(Gh=oi($h))):(Ph="path",$h.save()),Sh.__clip(Gh||$h,Lh)):(Ph=Nh==="grayscale"?"grayscale":"alpha",Eh||(Eh=oi($h)),Gh||(Gh=oi($h)),Sh.__render(Eh,Lh));continue}const Ih=Ah===1&&Sh.__.__blendMode;Ih&&ni(this,Ph,$h,Gh,Eh,Ah,void 0,!1),ii(Sh,Lh)||Sh.__render(Gh||$h,Lh),Ih&&ni(this,Ph,$h,Gh,Eh,Ah,Ih,!1)}ni(this,Ph,$h,Gh,Eh,Ah,void 0,!0)};const ai=`>)]}%!?,.:;'"\u300B\uFF09\u300D\u3009\u300F\u3017\u3011\u3015\uFF5D\u2510\uFF1E\u2019\u201D\uFF01\uFF1F\uFF0C\u3001\u3002\uFF1A\uFF1B\u2030`,hi=ai+"_#~&*+\\=|\u226E\u226F\u2248\u2260\uFF1D\u2026",li=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map(([$h,Lh])=>`[\\u${$h.toString(16)}-\\u${Lh.toString(16)}]`).join("|"));function ci($h){const Lh={};return $h.split("").forEach(Sh=>Lh[Sh]=!0),Lh}const di=ci("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),ui=ci(`{[(<'"\u300A\uFF08\u300C\u3008\u300E\u3016\u3010\u3014\uFF5B\u250C\uFF1C\u2018\u201C\uFF1D\xA5\uFFE5\uFF04\u20AC\xA3\uFFE1\xA2\uFFE0`),fi=ci(ai),pi=ci(hi),gi=ci("- \u2014\uFF0F\uFF5E\uFF5C\u2506\xB7");var wi;(function($h){$h[$h.Letter=0]="Letter",$h[$h.Single=1]="Single",$h[$h.Before=2]="Before",$h[$h.After=3]="After",$h[$h.Symbol=4]="Symbol",$h[$h.Break=5]="Break"})(wi||(wi={}));const{Letter:_i,Single:mi,Before:vi,After:yi,Symbol:xi,Break:bi}=wi;function Si($h){return di[$h]?_i:gi[$h]?bi:ui[$h]?vi:fi[$h]?yi:pi[$h]?xi:li.test($h)?mi:_i}const Li={trimRight($h){const{words:Lh}=$h;let Sh,Eh=0,Gh=Lh.length;for(let Ah=Gh-1;Ah>-1&&(Sh=Lh[Ah].data[0],Sh.char===" ");Ah--)Eh++,$h.width-=Sh.width;Eh&&Lh.splice(Gh-Eh,Eh)}};function ki($h,Lh,Sh){switch(Lh){case"title":return Sh?$h.toUpperCase():$h;case"upper":return $h.toUpperCase();case"lower":return $h.toLowerCase();default:return $h}}const{trimRight:Ti}=Li,{Letter:Bi,Single:Ei,Before:Pi,After:Ri,Symbol:Mi,Break:Ci}=wi;let Ai,Oi,Di,Wi,Ii,Fi,zi,ji,Ui,Gi,Yi,Xi,Vi,Ni,Hi,qi,Ki,Qi=[];function $i($h,Lh){Ui&&!ji&&(ji=Ui),Ai.data.push({char:$h,width:Lh}),Di+=Lh}function Zi(){Wi+=Di,Ai.width=Di,Oi.words.push(Ai),Ai={data:[]},Di=0}function Ji(){Ni&&(Hi.paraNumber++,Oi.paraStart=!0,Ni=!1),Ui&&(Oi.startCharSize=ji,Oi.endCharSize=Ui,ji=0),Oi.width=Wi,qi.width?Ti(Oi):Ki&&ts(),Qi.push(Oi),Oi={words:[]},Wi=0}function ts(){Wi>(Hi.maxWidth||0)&&(Hi.maxWidth=Wi)}const{top:es,right:is,bottom:ss,left:ns}=mt$3;function os($h,Lh,Sh){const{bounds:Eh,rows:Gh}=$h;Eh[Lh]+=Sh;for(let Ah=0;Ah<Gh.length;Ah++)Gh[Ah][Lh]+=Sh}const rs={getDrawData:function($h,Lh){i($h)||($h=String($h));let Sh=0,Eh=0,Gh=Lh.__getInput("width")||0,Ah=Lh.__getInput("height")||0;const{__padding:Ph}=Lh;Ph&&(Gh?(Sh=Ph[ns],Gh-=Ph[is]+Ph[ns],!Gh&&(Gh=.01)):Lh.autoSizeAlign||(Sh=Ph[ns]),Ah?(Eh=Ph[es],Ah-=Ph[es]+Ph[ss],!Ah&&(Ah=.01)):Lh.autoSizeAlign||(Eh=Ph[es]));const Nh={bounds:{x:Sh,y:Eh,width:Gh,height:Ah},rows:[],paraNumber:0,font:$t$2.canvas.font=Lh.__font};return(function(Mh,Dh,Fh){Hi=Mh,Qi=Mh.rows,qi=Mh.bounds,Ki=!qi.width&&!Fh.autoSizeAlign;const{__letterSpacing:Ih,paraIndent:Hh,textCase:Wh}=Fh,{canvas:zh}=$t$2,{width:Uh}=qi;if(Fh.__isCharMode){const Yh=Fh.textWrap!=="none",Xh=Fh.textWrap==="break";Ni=!0,Yi=null,ji=zi=Ui=Di=Wi=0,Ai={data:[]},Oi={words:[]},Ih&&(Dh=[...Dh]);for(let jh=0,qh=Dh.length;jh<qh;jh++)Fi=Dh[jh],Fi===`
`?(Di&&Zi(),Oi.paraEnd=!0,Ji(),Ni=!0):(Gi=Si(Fi),Gi===Bi&&Wh!=="none"&&(Fi=ki(Fi,Wh,!Di)),zi=zh.measureText(Fi).width,Ih&&(Ih<0&&(Ui=zi),zi+=Ih),Xi=Gi===Ei&&(Yi===Ei||Yi===Bi)||Yi===Ei&&Gi!==Ri,Vi=!(Gi!==Pi&&Gi!==Ei||Yi!==Mi&&Yi!==Ri),Ii=Ni&&Hh?Uh-Hh:Uh,Yh&&Uh&&Wi+Di+zi>Ii&&(Xh?(Di&&Zi(),Wi&&Ji()):(Vi||(Vi=Gi===Bi&&Yi==Ri),(Xi||Vi||Gi===Ci||Gi===Pi||Gi===Ei||Di+zi>Ii)&&Di&&Zi(),Wi&&Ji())),Fi===" "&&Ni!==!0&&Wi+Di===0||(Gi===Ci?(Fi===" "&&Di&&Zi(),$i(Fi,zi),Zi()):((Xi||Vi)&&Di&&Zi(),$i(Fi,zi))),Yi=Gi);Di&&Zi(),Wi&&Ji(),Qi.length>0&&(Qi[Qi.length-1].paraEnd=!0)}else Dh.split(`
`).forEach(Yh=>{Hi.paraNumber++,Wi=zh.measureText(Yh).width,Qi.push({x:Hh||0,text:Yh,width:Wi,paraStart:!0}),Ki&&ts()})})(Nh,$h,Lh),Ph&&(function(Mh,Dh,Fh,Ih,Hh){if(!Ih&&Fh.autoSizeAlign)switch(Fh.textAlign){case"left":os(Dh,"x",Mh[ns]);break;case"right":os(Dh,"x",-Mh[is])}if(!Hh&&Fh.autoSizeAlign)switch(Fh.verticalAlign){case"top":os(Dh,"y",Mh[es]);break;case"bottom":os(Dh,"y",-Mh[ss])}})(Ph,Nh,Lh,Gh,Ah),(function(Mh,Dh){const{rows:Fh,bounds:Ih}=Mh,Hh=Fh.length,{__lineHeight:Wh,__baseLine:zh,__letterSpacing:Uh,__clipText:Yh,textAlign:Xh,verticalAlign:jh,paraSpacing:qh,autoSizeAlign:Kh}=Dh;let{x:Zh,y:il,width:Jh,height:Qh}=Ih,el=Wh*Hh+(qh?qh*(Mh.paraNumber-1):0),nl=zh;if(Yh&&el>Qh)el=Math.max(Dh.__autoHeight?el:Qh,Wh),Hh>1&&(Mh.overflow=Hh);else if(Qh||Kh)switch(jh){case"middle":il+=(Qh-el)/2;break;case"bottom":il+=Qh-el}nl+=il;let Vh,sl,rl,ol=Jh||Kh?Jh:Mh.maxWidth;for(let ll=0,ul=Hh;ll<ul;ll++){if(Vh=Fh[ll],Vh.x=Zh,Vh.width<Jh||Vh.width>Jh&&!Yh)switch(Xh){case"center":Vh.x+=(ol-Vh.width)/2;break;case"right":Vh.x+=ol-Vh.width}Vh.paraStart&&qh&&ll>0&&(nl+=qh),Vh.y=nl,nl+=Wh,Mh.overflow>ll&&nl>el&&(Vh.isOverflow=!0,Mh.overflow=ll+1),sl=Vh.x,rl=Vh.width,Uh<0&&(Vh.width<0?(rl=-Vh.width+Dh.fontSize+Uh,sl-=rl,rl+=Dh.fontSize):rl-=Uh),sl<Ih.x&&(Ih.x=sl),rl>Ih.width&&(Ih.width=rl),Yh&&Jh&&Jh<rl&&(Vh.isOverflow=!0,Mh.overflow||(Mh.overflow=Fh.length))}Ih.y=il,Ih.height=el})(Nh,Lh),Lh.__isCharMode&&(function(Mh,Dh,Fh){const{rows:Ih}=Mh,{textAlign:Hh,paraIndent:Wh,__letterSpacing:zh}=Dh,Uh=Fh&&Hh.includes("both"),Yh=Uh||Fh&&Hh.includes("justify"),Xh=Yh&&Hh.includes("letter");let jh,qh,Kh,Zh,il,Jh,Qh,el,nl,Vh;Ih.forEach(sl=>{sl.words&&(il=Wh&&sl.paraStart?Wh:0,el=sl.words.length,Yh&&(Vh=!sl.paraEnd||Uh,qh=Fh-sl.width-il,Xh?Zh=qh/(sl.words.reduce((rl,ol)=>rl+ol.data.length,0)-1):Kh=el>1?qh/(el-1):0),Jh=zh||sl.isOverflow||Xh?0:Kh?1:2,sl.isOverflow&&!zh&&(sl.textMode=!0),Jh===2?(sl.x+=il,(function(rl){rl.text="",rl.words.forEach(ol=>{ol.data.forEach(ll=>{rl.text+=ll.char})})})(sl)):(sl.x+=il,jh=sl.x,sl.data=[],sl.words.forEach((rl,ol)=>{Jh===1?(Qh={char:"",x:jh},jh=(function(ll,ul,cl){return ll.forEach(dl=>{cl.char+=dl.char,ul+=dl.width}),ul})(rl.data,jh,Qh),(sl.isOverflow||Qh.char!==" ")&&sl.data.push(Qh)):jh=(function(ll,ul,cl,dl,_l){return ll.forEach(pl=>{(dl||pl.char!==" ")&&(pl.x=ul,cl.push(pl)),ul+=pl.width,_l&&(ul+=_l)}),ul})(rl.data,jh,sl.data,sl.isOverflow,Vh&&Zh),Vh&&(nl=ol===el-1,Kh?nl||(jh+=Kh,sl.width+=Kh):Zh&&(sl.width+=Zh*(rl.data.length-(nl?1:0))))})),sl.words=null)})})(Nh,Lh,Gh),Nh.overflow&&(function(Mh,Dh,Fh,Ih){const{rows:Hh,overflow:Wh}=Mh;let{textOverflow:zh}=Dh;if(Wh&&Hh.splice(Wh),Ih&&zh&&zh!=="show"){let Uh,Yh;zh==="hide"?zh="":zh==="ellipsis"&&(zh="...");const Xh=zh?$t$2.canvas.measureText(zh).width:0,jh=Fh+Ih-Xh;(Dh.textWrap==="none"?Hh:[Hh[Wh-1]]).forEach(qh=>{if(qh.isOverflow&&qh.data){let Kh=qh.data.length-1;for(let Zh=Kh;Zh>-1&&(Uh=qh.data[Zh],Yh=Uh.x+Uh.width,!(Zh===Kh&&Yh<jh));Zh--){if(Yh<jh&&Uh.char!==" "||!Zh){qh.data.splice(Zh+1),qh.width-=Uh.width;break}qh.width-=Uh.width}qh.width+=Xh,qh.data.push({char:zh,x:Yh}),qh.textMode&&(function(Zh){Zh.text="",Zh.data.forEach(il=>{Zh.text+=il.char}),Zh.data=null})(qh)}})}})(Nh,Lh,Sh,Gh),Lh.textDecoration!=="none"&&(function(Mh,Dh){let Fh,Ih=0;const{fontSize:Hh,textDecoration:Wh}=Dh;switch(Mh.decorationHeight=Hh/11,d(Wh)?(Fh=Wh.type,Wh.color&&(Mh.decorationColor=Ct$2.string(Wh.color)),Wh.offset&&(Ih=Math.min(.3*Hh,Math.max(Wh.offset,.15*-Hh)))):Fh=Wh,Fh){case"under":Mh.decorationY=[.15*Hh+Ih];break;case"delete":Mh.decorationY=[.35*-Hh];break;case"under-delete":Mh.decorationY=[.15*Hh+Ih,.35*-Hh]}})(Nh,Lh),Nh}},as={string:function($h,Lh){if(!$h)return"#000";const Sh=o(Lh)&&Lh<1;if(i($h)){if(!Sh||!Ct$2.object)return $h;$h=Ct$2.object($h)}let Eh=s($h.a)?1:$h.a;Sh&&(Eh*=Lh);const Gh=$h.r+","+$h.g+","+$h.b;return Eh===1?"rgb("+Gh+")":"rgba("+Gh+","+Eh+")"}};Object.assign(At$2,rs),Object.assign(Ct$2,as),Object.assign(Ft$2,Yt),Object.assign(Wt$2,be),Object.assign(Et$2,Ue),Object.assign(Tt$2,ei),Object.assign(le$2,{interaction:($h,Lh,Sh,Eh)=>new Tt($h,Lh,Sh,Eh),hitCanvas:($h,Lh)=>new et($h,Lh),hitCanvasManager:()=>new At$1}),it();const LeaferUIRuntime=Object.freeze(Object.defineProperty({__proto__:null,AlignHelper:kt$3,get Answer(){return t},get App(){return N},AroundHelper:bt$3,AutoBounds:Gt$2,BezierHelper:hs,Bounds:Vt$3,BoundsEvent:Ho,BoundsHelper:zt$2,get Box(){return Ae$1},BoxData:Jt$1,get Branch(){return vh},BranchHelper:vo,BranchRender:za,get Canvas(){return si$1},CanvasData:ae$1,CanvasManager:ge$2,ChildEvent:zo,ColorConvert:Ct$2,Creator:le$2,Cursor:St$1,DataHelper:_,Debug:ee$2,get Direction4(){return mt$3},get Direction9(){return xt$2},DragBoundsHelper:tt$1,get DragEvent(){return nt$1},Dragger:Dt$1,get DropEvent(){return ht$1},Effect:Tt$2,get Ellipse(){return We$1},EllipseData:Qt$1,EllipseHelper:ys,Event:Xo,EventCreator:pe$2,Eventer:la,Export:It$2,FileHelper:Gi$1,Filter:Dt$2,FourNumberHelper:v,get Frame(){return Ce$1},FrameData:Gt$1,get Group(){return ye$1},GroupData:jt$2,HitCanvasManager:At$1,get Image(){return ei$1},ImageData:re$1,ImageEvent:Vo,ImageManager:en,IncrementId:g,Interaction:Tt,InteractionBase:Mt$1,InteractionHelper:_t$1,get KeyEvent(){return pt$1},Keyboard:W,LayoutEvent:ta,Layouter:gt,get Leaf(){return _h},LeafBounds:Na,LeafBoundsHelper:xo,LeafData:f,LeafDataProxy:Ba,LeafEventer:wa,LeafHelper:co,LeafLayout:Do,LeafLevelList:Ch,LeafList:kh,LeafMatrix:Sa,LeafRender:Ya,get Leafer(){return we$1},LeaferCanvas:et,LeaferCanvasBase:Ee$2,LeaferData:qt$1,LeaferEvent:sa,LeaferFilm:an,LeaferImage:on,LeaferVideo:hn,get Line(){return ti$1},LineData:$t$1,MathHelper:I$1,Matrix:pt$2,MatrixHelper:q$1,get MoveEvent(){return ot$1},MyDragEvent:rt$1,MyImage:ii$1,MyPointerEvent:st$1,MyTouchEvent:gt$1,NeedConvertToCanvasCommandMap:Ne$2,OneRadian:A,PI2:W$1,PI_2:N$1,Paint:Ft$2,PaintGradient:Et$2,PaintImage:Wt$2,get Path(){return di$1},PathArrow:Pt$2,PathBounds:Ai$1,PathCommandDataHelper:Cr,PathCommandMap:Ae$2,PathCommandNodeHelper:ms,PathConvert:sr,PathCorner:Fi$1,PathCreator:Fr,PathData:ee$1,PathDrawer:ri$2,PathHelper:Ie$2,get PathNodeHandleType(){return Z},PathNumberCommandLengthMap:ze$2,PathNumberCommandMap:Xe$2,get Pen(){return li$1},PenData:ie$1,Picker:xt,Platform:$t$2,Plugin:he$2,Point:ut$2,PointHelper:ot$2,PointerButton:K,get PointerEvent(){return it$1},get Polygon(){return Oe$1},PolygonData:Zt$1,PropertyEvent:Uo,get Rect(){return xe$1},RectData:Kt$2,RectHelper:Fe$2,RectRender:ue$1,RenderEvent:ea,Renderer:_t,ResizeEvent:$o,Resource:Ki$1,get RotateEvent(){return lt$1},Run:ne$2,Selector:bt,get Star(){return je$1},StarData:te$1,State:Lt$2,StringNumberMap:Qt$2,get SwipeEvent(){return ct$1},TaskItem:Ji$1,TaskProcessor:Zi$1,get Text(){return hi$1},TextConvert:At$2,TextData:oe$1,get TouchEvent(){return dt$1},Transition:zt$1,TwoPointBoundsHelper:gt$2,get UI(){return ge$1},UIBounds:he$1,UICreator:ce$2,UIData:Ut$2,UIEvent:V,UIRender:le$1,UnitConvert:bt$2,UnitConvertHelper:qt$2,WaitHelper:So,WatchEvent:Ko,Watcher:nt,get ZoomEvent(){return ut$1},affectRenderBoundsType:Sn,affectStrokeBoundsType:On,attr:_n,autoLayoutType:mn,boundsType:bn,canvasPatch:Hi$1,canvasSizeAttrs:Re$2,createAttr:Bt$2,createDescriptor:cn,cursorType:Xn,dataProcessor:zn,dataType:fn,decorateLeafAttr:un,defineDataProcessor:Un,defineKey:ln,defineLeafAttr:pn,dimType:Rn,doBoundsType:vn,doStrokeType:Tn,effectType:mt$2,emptyData:e$1,eraserType:Yn,extraPropertyEventMap:jo,getBoundsData:D,getDescriptor:dn,getMatrixData:X$1,getPointData:Y$1,hitType:Dn,isArray:l,isData:c,isEmptyData:u,isFinite:n,isNull:r,isNumber:o,isObject:d,isString:i,isUndefined:s,layoutProcessor:Fn,leaferTransformAttrMap:aa,maskType:Nn,naturalBoundsType:Bn,opacityType:En,path:Ui$1,pathInputType:kn,pathType:Cn,pen:ji$1,positionType:gn,registerUI:Zn,registerUIEvent:$n,resizeType:Rt$2,rewrite:Gn,rewriteAble:qn,rotationType:wn,scaleType:xn,scrollType:yn,sortType:Wn,strokeType:Pn,surfaceType:Ln,tempBounds:Ht$3,tempMatrix:ft$2,tempPoint:_t$2,tryToNumber:h,useCanvas:it,useModule:Jn,version:Oh,visibleType:In,zoomLayerType:kt$2},Symbol.toStringTag,{value:"Module"}));class LLink{constructor(Lh,Sh,Eh,Gh,Ah,Ph){this.id=Lh,this.type=Sh,this.origin_id=Eh,this.origin_slot=Gh,this.target_id=Ah,this.target_slot=Ph,this._data=null,this._pos=new Float32Array(2)}configure(Lh){Lh.constructor===Array?(this.id=Lh[0],this.origin_id=Lh[1],this.origin_slot=Lh[2],this.target_id=Lh[3],this.target_slot=Lh[4],this.type=Lh[5]):(this.id=Lh.id,this.type=Lh.type,this.origin_id=Lh.origin_id,this.origin_slot=Lh.origin_slot,this.target_id=Lh.target_id,this.target_slot=Lh.target_slot)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}}function initializeGraphState($h){$h.last_node_id=0,$h.last_link_id=0,$h._version=-1,$h._nodes=[],$h._nodes_by_id={},$h._nodes_in_order=[],$h._nodes_executable=null,$h._groups=[],$h.links={},$h.iteration=0,$h.config={},$h.vars={},$h.extra={},$h.globaltime=0,$h.runningtime=0,$h.fixedtime=0,$h.fixedtime_lapse=.01,$h.elapsed_time=.01,$h.last_update_time=0,$h.starttime=0,$h.catch_errors=!0,$h.history={actionHistory:[],actionHistoryVersions:[],actionHistoryPtr:0},$h.nodes_executing=[],$h.nodes_actioning=[],$h.node_ancestorsCalculated=[],$h.nodes_executedAction=[],$h._configuring=!1,$h.inputs={},$h.outputs={}}function mergeOptions($h,Lh){return Object.assign({},$h,Lh)}let LiteGraph$o=null;function setLifecycleMethodsLiteGraph($h){LiteGraph$o=$h}const lifecycleMethods={getSupportedTypes(){var $h;return($h=this.supported_types)!=null?$h:this.constructor.supported_types},clear(){var $h;this.stop(),this.status=this.constructor.STATUS_STOPPED,($h=this._nodes)==null||$h.forEach(Lh=>{var Sh;(Sh=Lh.onRemoved)==null||Sh.call(Lh)}),initializeGraphState(this),this.configApplyDefaults(),this.change(),this.sendActionToCanvas("clear")},configApply($h){this.config=mergeOptions(this.config,$h)},configApplyDefaults(){var $h=LiteGraph$o.graphDefaultConfig;this.configApply($h)}};let LiteGraph$n=null;function setCanvasBindingMethodsLiteGraph($h){LiteGraph$n=$h}const canvasBindingMethods={attachCanvas($h){var Lh;if(!$h instanceof LiteGraph$n.LGraphCanvas)throw new Error("attachCanvas expects a LiteGraph.LGraphCanvas instance");$h.graph&&$h.graph!=this&&$h.graph.detachCanvas($h),$h.graph=this,(Lh=this.list_of_graphcanvas)!=null||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push($h)},detachCanvas($h){if(this.list_of_graphcanvas){var Lh=this.list_of_graphcanvas.indexOf($h);Lh!=-1&&($h.graph=null,this.list_of_graphcanvas.splice(Lh,1))}},sendActionToCanvas($h,Lh){if(this.list_of_graphcanvas)for(const Sh of this.list_of_graphcanvas)Sh[$h]&&Lh&&Sh[$h](...Lh)},change(){var $h,Lh;($h=LiteGraph$n.log)==null||$h.call(LiteGraph$n,"Graph visually changed"),this.sendActionToCanvas("setDirty",[!0,!0]),(Lh=this.on_change)==null||Lh.call(this,this)},setDirtyCanvas($h,Lh){this.sendActionToCanvas("setDirty",[$h,Lh])},isLive(){if(!this.list_of_graphcanvas)return!1;for(var $h=0;$h<this.list_of_graphcanvas.length;++$h){var Lh=this.list_of_graphcanvas[$h];if(Lh.live_mode)return!0}return!1}};let LiteGraph$m=null;function setRuntimeLoopMethodsLiteGraph($h){LiteGraph$m=$h}const runtimeLoopMethods={start($h=0){var Lh;if(this.status===this.constructor.STATUS_RUNNING)return;this.status=this.constructor.STATUS_RUNNING,(Lh=this.onPlayEvent)==null||Lh.call(this),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph$m.getTime(),this.last_update_time=this.starttime;const Sh=()=>{var Eh,Gh;this.execution_timer_id===-1&&(window.requestAnimationFrame(Sh),(Eh=this.onBeforeStep)==null||Eh.call(this),this.runStep(1,!this.catch_errors),(Gh=this.onAfterStep)==null||Gh.call(this))};$h===0&&typeof window=="object"&&window.requestAnimationFrame?(this.execution_timer_id=-1,Sh()):this.execution_timer_id=setInterval(()=>{var Eh,Gh;(Eh=this.onBeforeStep)==null||Eh.call(this),this.runStep(1,!this.catch_errors),(Gh=this.onAfterStep)==null||Gh.call(this)},$h)},stop(){var $h;this.status!=this.constructor.STATUS_STOPPED&&(this.status=this.constructor.STATUS_STOPPED,($h=this.onStopEvent)==null||$h.call(this),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},runStep($h=1,Lh,Sh){var Eh,Gh,Ah,Ph,Nh,Mh,Dh=LiteGraph$m.getTime();this.globaltime=.001*(Dh-this.starttime);var Fh=(Eh=this._nodes_executable)!=null?Eh:this._nodes;if(Fh){if(Sh||(Sh=Fh.length),Lh){for(let Wh=0;Wh<$h;Wh++)Fh.forEach(zh=>{var Uh,Yh;LiteGraph$m.use_deferred_actions&&(Uh=zh._waiting_actions)!=null&&Uh.length&&zh.executePendingActions(),zh.mode===LiteGraph$m.ALWAYS&&((Yh=zh.doExecute)==null||Yh.call(zh))}),this.fixedtime+=this.fixedtime_lapse,(Gh=this.onExecuteStep)==null||Gh.call(this);(Ah=this.onAfterExecute)==null||Ah.call(this)}else try{for(let Wh=0;Wh<$h;Wh++)Fh.forEach(zh=>{var Uh,Yh;LiteGraph$m.use_deferred_actions&&(Uh=zh._waiting_actions)!=null&&Uh.length&&zh.executePendingActions(),zh.mode===LiteGraph$m.ALWAYS&&((Yh=zh.doExecute)==null||Yh.call(zh))}),this.fixedtime+=this.fixedtime_lapse,(Ph=this.onExecuteStep)==null||Ph.call(this);(Nh=this.onAfterExecute)==null||Nh.call(this),this.errors_in_execution=!1}catch(Wh){if(this.errors_in_execution=!0,LiteGraph$m.throw_errors)throw Wh;(Mh=LiteGraph$m.log)==null||Mh.call(LiteGraph$m,`Error during execution: ${Wh}`),this.stop()}var Ih=LiteGraph$m.getTime(),Hh=Ih-Dh;Hh==0&&(Hh=1),this.execution_time=.001*Hh,this.globaltime+=.001*Hh,this.iteration+=1,this.elapsed_time=(Ih-this.last_update_time)*.001,this.last_update_time=Ih,this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[]}},getTime(){return this.globaltime},getFixedTime(){return this.fixedtime},getElapsedTime(){return this.elapsed_time},clearTriggeredSlots(){for(var $h in this.links){var Lh=this.links[$h];Lh&&Lh._last_time&&(Lh._last_time=0)}}};let LiteGraph$l=null;function setExecutionOrderMethodsLiteGraph($h){LiteGraph$l=$h}const executionOrderMethods={updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var $h=0;$h<this._nodes_in_order.length;++$h)this._nodes_in_order[$h].onExecute&&this._nodes_executable.push(this._nodes_in_order[$h])},computeExecutionOrder($h,Lh){var Sh,Eh=[],Gh=[],Ah={},Ph={},Nh={};for(let Wh=0,zh=this._nodes.length;Wh<zh;++Wh){let Uh=this._nodes[Wh];if(!($h&&!Uh.onExecute)){Ah[Uh.id]=Uh;var Mh=0;if(Uh.inputs)for(var Dh=0,Fh=Uh.inputs.length;Dh<Fh;Dh++)Uh.inputs[Dh]&&Uh.inputs[Dh].link!=null&&(Mh+=1);Mh==0?(Gh.push(Uh),Lh&&(Uh._level=1)):(Lh&&(Uh._level=0),Nh[Uh.id]=Mh)}}for(;Gh.length!=0;){var Ih=Gh.shift();if(Eh.push(Ih),delete Ah[Ih.id],!!Ih.outputs)for(let Wh=0;Wh<Ih.outputs.length;Wh++){let zh=Ih.outputs[Wh];if(!(zh==null||zh.links==null||zh.links.length==0))for(let Uh=0;Uh<zh.links.length;Uh++){let Yh=zh.links[Uh],Xh=this.links[Yh];if(!Xh||Ph[Xh.id])continue;let jh=this.getNodeById(Xh.target_id);if(jh==null){Ph[Xh.id]=!0;continue}Lh&&(!jh._level||jh._level<=Ih._level)&&(jh._level=Ih._level+1),Ph[Xh.id]=!0,Nh[jh.id]-=1,Nh[jh.id]==0&&Gh.push(jh)}}}for(let Wh in Ah)Eh.push(Ah[Wh]);Eh.length!=this._nodes.length&&LiteGraph$l.debug&&((Sh=LiteGraph$l.warn)==null||Sh.call(LiteGraph$l,"something went wrong, nodes missing"));var Hh=Eh.length;for(let Wh=0;Wh<Hh;++Wh)Eh[Wh].order=Wh;Eh=Eh.sort((Wh,zh)=>{let Uh=Wh.constructor.priority||Wh.priority||0,Yh=zh.constructor.priority||zh.priority||0;return Uh==Yh?Wh.order-zh.order:Uh-Yh});for(let Wh=0;Wh<Hh;++Wh)Eh[Wh].order=Wh;return Eh},getAncestors($h,Lh={}){for(var Sh={modesSkip:[],modesOnly:[],typesSkip:[],typesOnly:[]},Eh=Object.assign(Sh,Lh),Gh=[],Ah=[],Ph=[$h],Nh={};Ph.length;){var Mh=Ph.shift();if(Mh&&!Nh[Mh.id]){if(Nh[Mh.id]=!0,Mh.id!=$h.id){if(Eh.modesSkip&&Eh.modesSkip.length&&Eh.modesSkip.indexOf(Mh.mode)!=-1||Eh.modesOnly&&Eh.modesOnly.length&&Eh.modesOnly.indexOf(Mh.mode)==-1)continue;Ah.indexOf(Mh.id)==-1&&(Gh.push(Mh),Ah.push(Mh.id))}if(Mh.inputs)for(var Dh=0;Dh<Mh.inputs.length;++Dh){var Fh=Mh.getInputNode(Dh);if(Fh){var Ih=Mh.inputs[Dh].type;Eh.typesSkip&&Eh.typesSkip.length&&Eh.typesSkip.indexOf(Ih)!=-1||Eh.typesOnly&&Eh.typesOnly.length&&Eh.typesOnly.indexOf(Fh.mode)==-1||Ah.indexOf(Fh.id)==-1&&(Nh[Fh.id]||Ph.push(Fh))}}}}return Gh.sort((Hh,Wh)=>Hh.order-Wh.order),Gh},arrange($h=100,Lh){var Sh;const Eh=this.computeExecutionOrder(!1,!0),Gh=[];for(let Ph=0;Ph<Eh.length;++Ph){const Nh=Eh[Ph],Mh=Nh._level||1;(Sh=Gh[Mh])!=null||(Gh[Mh]=[]),Gh[Mh].push(Nh)}let Ah=$h;for(let Ph=0;Ph<Gh.length;++Ph){const Nh=Gh[Ph];if(!Nh)continue;let Mh=100,Dh=$h+LiteGraph$l.NODE_TITLE_HEIGHT;for(let Fh=0;Fh<Nh.length;++Fh){const Ih=Nh[Fh];Ih.pos[0]=Lh==LiteGraph$l.VERTICAL_LAYOUT?Dh:Ah,Ih.pos[1]=Lh==LiteGraph$l.VERTICAL_LAYOUT?Ah:Dh;const Hh=Lh==LiteGraph$l.VERTICAL_LAYOUT?1:0;Ih.size[Hh]>Mh&&(Mh=Ih.size[Hh]);const Wh=Lh==LiteGraph$l.VERTICAL_LAYOUT?0:1;Dh+=Ih.size[Wh]+$h+LiteGraph$l.NODE_TITLE_HEIGHT}Ah+=Mh+$h}this.setDirtyCanvas(!0,!0)}};let LiteGraph$k=null;function setNodeMutationMethodsLiteGraph($h){LiteGraph$k=$h}const nodeMutationMethods={add($h,Lh,Sh={}){var Eh,Gh,Ah,Ph={doProcessChange:!0,doCalcSize:!0},Nh=Object.assign(Ph,Sh);if($h){if($h.constructor===LiteGraph$k.LGraphGroup){this._groups.push($h),this.setDirtyCanvas(!0),this.change(),$h.graph=this,this.onGraphChanged({action:"groupAdd",doSave:Nh.doProcessChange});return}if($h.id!=-1&&this._nodes_by_id[$h.id]!=null&&((Eh=LiteGraph$k.warn)==null||Eh.call(LiteGraph$k,"LiteGraph: there is already a node with this ID, changing it"),LiteGraph$k.use_uuids?$h.id=LiteGraph$k.uuidv4():$h.id=++this.last_node_id),this._nodes.length>=LiteGraph$k.MAX_NUMBER_OF_NODES)throw new Error("LiteGraph: max number of nodes in a graph reached");return LiteGraph$k.use_uuids?($h.id==null||$h.id==-1)&&($h.id=LiteGraph$k.uuidv4()):$h.id==null||$h.id==-1?$h.id=++this.last_node_id:this.last_node_id<$h.id&&(this.last_node_id=$h.id),$h.graph=this,this.onGraphChanged({action:"nodeAdd",doSave:Nh.doProcessChange}),this._nodes.push($h),this._nodes_by_id[$h.id]=$h,(Gh=$h.onAdded)==null||Gh.call($h,this),this.config.align_to_grid&&$h.alignToGrid(),Lh||this.updateExecutionOrder(),(Ah=this.onNodeAdded)==null||Ah.call(this,$h),Nh.doCalcSize&&$h.setSize($h.computeSize()),this.setDirtyCanvas(!0),this.change(),$h}},remove($h){var Lh,Sh;if($h.constructor===LiteGraph$k.LGraphGroup){var Eh=this._groups.indexOf($h);Eh!=-1&&this._groups.splice(Eh,1),$h.graph=null,this.onGraphChanged({action:"groupRemove"}),this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[$h.id]!=null&&!$h.ignore_remove){if($h.inputs)for(let Ah=0;Ah<$h.inputs.length;Ah++)$h.inputs[Ah].link!=null&&$h.disconnectInput(Ah,{doProcessChange:!1});if($h.outputs)for(let Ah=0;Ah<$h.outputs.length;Ah++){let Ph=$h.outputs[Ah];Ph.links!=null&&Ph.links.length&&$h.disconnectOutput(Ah,!1,{doProcessChange:!1})}if((Lh=$h.onRemoved)==null||Lh.call($h),$h.graph=null,this.onGraphChanged({action:"nodeRemove"}),this.list_of_graphcanvas)for(let Ah=0;Ah<this.list_of_graphcanvas.length;++Ah){let Ph=this.list_of_graphcanvas[Ah];Ph.selected_nodes[$h.id]&&delete Ph.selected_nodes[$h.id],Ph.node_dragged==$h&&(Ph.node_dragged=null)}var Gh=this._nodes.indexOf($h);Gh!=-1&&this._nodes.splice(Gh,1),delete this._nodes_by_id[$h.id],(Sh=this.onNodeRemoved)==null||Sh.call(this,$h),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},removeLink($h){var Lh=this.links[$h];if(Lh){var Sh=this.getNodeById(Lh.target_id);Sh&&(this.beforeChange(),Sh.disconnectInput(Lh.target_slot),this.afterChange())}},checkNodeTypes(){for(var $h,Lh=0;Lh<this._nodes.length;Lh++){var Sh=this._nodes[Lh],Eh=LiteGraph$k.registered_node_types[Sh.type];if(Sh.constructor!=Eh){LiteGraph$k.debug&&(($h=LiteGraph$k.log)==null||$h.call(LiteGraph$k,`node being replaced by newer version: ${Sh.type}`));var Gh=LiteGraph$k.createNode(Sh.type);this._nodes[Lh]=Gh,Gh.configure(Sh.serialize()),Gh.graph=this,this._nodes_by_id[Gh.id]=Gh,Sh.inputs&&(Gh.inputs=Sh.inputs.concat()),Sh.outputs&&(Gh.outputs=Sh.outputs.concat())}}this.updateExecutionOrder()}},nodeQueryMethods={getNodeById($h){return $h==null?null:this._nodes_by_id[$h]},findNodesByClass($h,Lh=[]){return Lh=this._nodes.filter(Sh=>Sh.constructor===$h),Lh},findNodesByType($h,Lh=[]){const Sh=$h.toLowerCase();return Lh=this._nodes.filter(Eh=>Eh.type.toLowerCase()===Sh),Lh},findNodeByTitle($h){var Lh;return(Lh=this._nodes.find(Sh=>Sh.title===$h))!=null?Lh:null},findNodesByTitle($h){return this._nodes.filter(Lh=>Lh.title===$h)},getNodeOnPos($h,Lh,Sh=this._nodes,Eh=0){var Gh;return(Gh=Sh.reverse().find(Ah=>Ah.isPointInside($h,Lh,Eh)))!=null?Gh:null},getGroupOnPos($h,Lh){var Sh;return(Sh=this._groups.find(Eh=>Eh.isPointInside($h,Lh,2,!0)))!=null?Sh:null}};let LiteGraph$j=null;function setGraphPortsMethodsLiteGraph($h){LiteGraph$j=$h}const graphPortsMethods={addInput($h,Lh,Sh){var Eh,Gh,Ah=this.inputs[$h];Ah||(this.beforeChange(),this.inputs[$h]={name:$h,type:Lh,value:Sh},this.onGraphChanged({action:"addInput"}),this.afterChange(),(Eh=this.onInputAdded)==null||Eh.call(this,$h,Lh),(Gh=this.onInputsOutputsChange)==null||Gh.call(this))},setInputData($h,Lh){var Sh=this.inputs[$h];Sh&&(Sh.value=Lh)},getInputData($h){var Lh=this.inputs[$h];return Lh?Lh.value:null},renameInput($h,Lh){var Sh,Eh,Gh;if(Lh!=$h){if(!this.inputs[$h])return!1;if(this.inputs[Lh])return(Sh=LiteGraph$j.error)==null||Sh.call(LiteGraph$j,"there is already one input with that name"),!1;this.inputs[Lh]=this.inputs[$h],delete this.inputs[$h],this.onGraphChanged({action:"renameInput"}),(Eh=this.onInputRenamed)==null||Eh.call(this,$h,Lh),(Gh=this.onInputsOutputsChange)==null||Gh.call(this)}},changeInputType($h,Lh){var Sh;if(!this.inputs[$h])return!1;this.inputs[$h].type&&String(this.inputs[$h].type).toLowerCase()==String(Lh).toLowerCase()||(this.inputs[$h].type=Lh,this.onGraphChanged({action:"changeInputType"}),(Sh=this.onInputTypeChanged)==null||Sh.call(this,$h,Lh))},removeInput($h){var Lh,Sh;return this.inputs[$h]?(delete this.inputs[$h],this.onGraphChanged({action:"graphRemoveInput"}),(Lh=this.onInputRemoved)==null||Lh.call(this,$h),(Sh=this.onInputsOutputsChange)==null||Sh.call(this),!0):!1},addOutput($h,Lh,Sh){var Eh,Gh;this.outputs[$h]={name:$h,type:Lh,value:Sh},this.onGraphChanged({action:"addOutput"}),(Eh=this.onOutputAdded)==null||Eh.call(this,$h,Lh),(Gh=this.onInputsOutputsChange)==null||Gh.call(this)},setOutputData($h,Lh){var Sh=this.outputs[$h];Sh&&(Sh.value=Lh)},getOutputData($h){var Lh=this.outputs[$h];return Lh?Lh.value:null},renameOutput($h,Lh){var Sh,Eh,Gh;if(!this.outputs[$h])return!1;if(this.outputs[Lh])return(Sh=LiteGraph$j.error)==null||Sh.call(LiteGraph$j,"there is already one output with that name"),!1;this.outputs[Lh]=this.outputs[$h],delete this.outputs[$h],this._version++,(Eh=this.onOutputRenamed)==null||Eh.call(this,$h,Lh),(Gh=this.onInputsOutputsChange)==null||Gh.call(this)},changeOutputType($h,Lh){var Sh;if(!this.outputs[$h])return!1;this.outputs[$h].type&&String(this.outputs[$h].type).toLowerCase()==String(Lh).toLowerCase()||(this.outputs[$h].type=Lh,this.onGraphChanged({action:"changeOutputType"}),(Sh=this.onOutputTypeChanged)==null||Sh.call(this,$h,Lh))},removeOutput($h){var Lh,Sh;return this.outputs[$h]?(delete this.outputs[$h],this.onGraphChanged({action:"removeOutput"}),(Lh=this.onOutputRemoved)==null||Lh.call(this,$h),(Sh=this.onInputsOutputsChange)==null||Sh.call(this),!0):!1},triggerInput($h,Lh){for(var Sh=this.findNodesByTitle($h),Eh=0;Eh<Sh.length;++Eh)Sh[Eh].onTrigger(Lh)},setCallback($h,Lh){for(var Sh=this.findNodesByTitle($h),Eh=0;Eh<Sh.length;++Eh)Sh[Eh].setTrigger(Lh)}};let LiteGraph$i=null;function setGraphEventsMethodsLiteGraph($h){LiteGraph$i=$h}const graphEventsMethods={sendEventToAllNodes($h,Lh,Sh=LiteGraph$i.ALWAYS){var Eh=this._nodes_in_order?this._nodes_in_order:this._nodes;if(Eh)for(let Gh=0,Ah=Eh.length;Gh<Ah;++Gh){const Ph=Eh[Gh];if(Ph.constructor===LiteGraph$i.Subgraph&&$h!=="onExecute"){Ph.mode==Sh&&Ph.sendEventToAllNodes($h,Lh,Sh);continue}!Ph[$h]||Ph.mode!==Sh||(Lh===void 0?Ph[$h]():Array.isArray(Lh)?Ph[$h].apply(Ph,Lh):Ph[$h](Lh))}},onAction($h,Lh,Sh){this._input_nodes=this.findNodesByClass(LiteGraph$i.GraphInput,this._input_nodes);for(var Eh=0;Eh<this._input_nodes.length;++Eh){var Gh=this._input_nodes[Eh];if(Gh.properties.name==$h){Gh.actionDo($h,Lh,Sh);break}}},trigger($h,Lh){var Sh;(Sh=this.onTrigger)==null||Sh.call(this,$h,Lh)},beforeChange($h){var Lh;(Lh=this.onBeforeChange)==null||Lh.call(this,this,$h),this.sendActionToCanvas("onBeforeChange",this)},afterChange($h){var Lh;(Lh=this.onAfterChange)==null||Lh.call(this,this,$h),this.sendActionToCanvas("onAfterChange",this)},connectionChange($h){var Lh;this.updateExecutionOrder(),(Lh=this.onConnectionChange)==null||Lh.call(this,$h),this.onGraphChanged({action:"connectionChange",doSave:!1}),this.sendActionToCanvas("onConnectionChange")}};let LiteGraph$h=null;function setSerializationLoadMethodsLiteGraph($h){LiteGraph$h=$h}const serializationLoadMethods={serialize(){var $h,Lh;const Sh=this._nodes.map(Fh=>Fh.serialize());var Eh=[];for(var Gh in this.links){var Ah=this.links[Gh];if(!Ah.serialize){($h=LiteGraph$h.warn)==null||$h.call(LiteGraph$h,"weird LLink bug, link info is not a LLink but a regular object");var Ph=new LiteGraph$h.LLink;for(var Nh in Ah)Ph[Nh]=Ah[Nh];this.links[Gh]=Ph,Ah=Ph}Eh.push(Ah.serialize())}const Mh=this._groups.map(Fh=>Fh.serialize());var Dh={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:Sh,links:Eh,groups:Mh,config:this.config,extra:this.extra,version:LiteGraph$h.VERSION};return(Lh=this.onSerialize)==null||Lh.call(this,Dh),Dh},configure($h,Lh){var Sh,Eh,Gh,Ah,Ph;if($h){Lh||this.clear();var Nh=$h.nodes;if($h.links&&$h.links.constructor===Array){for(var Mh=[],Dh=0;Dh<$h.links.length;++Dh){var Fh=$h.links[Dh];if(!Fh){(Sh=LiteGraph$h.warn)==null||Sh.call(LiteGraph$h,"serialized graph link data contains errors, skipping.");continue}var Ih=new LiteGraph$h.LLink;Ih.configure(Fh),Mh[Ih.id]=Ih}$h.links=Mh}for(let Uh in $h)["nodes","groups"].includes(Uh)||(this[Uh]=$h[Uh]);var Hh=!1;this._configuring=!0;try{if(this._nodes=[],Nh){for(let Uh=0,Yh=Nh.length;Uh<Yh;++Uh){var Wh=Nh[Uh],zh=LiteGraph$h.createNode(Wh.type,Wh.title);zh||((Eh=LiteGraph$h.log)==null||Eh.call(LiteGraph$h,`Node not found or has errors: ${Wh.type}`),zh=new LiteGraph$h.LGraphNode,zh.last_serialization=Wh,zh.has_errors=!0,Hh=!0),zh.id=Wh.id,this.add(zh,!0,{doProcessChange:!1})}Nh.forEach(Uh=>{const Yh=this.getNodeById(Uh.id);Yh==null||Yh.configure(Uh)})}this._groups.length=0,$h.groups&&$h.groups.forEach(Uh=>{const Yh=new LiteGraph$h.LGraphGroup;Yh.configure(Uh),this.add(Yh,!0,{doProcessChange:!1})})}finally{this._configuring=!1}return this.updateExecutionOrder(),this.extra=(Gh=$h.extra)!=null?Gh:{},(Ah=this.onConfigure)==null||Ah.call(this,$h),$h._version?(Ph=LiteGraph$h.debug)==null||Ph.call(LiteGraph$h,"skip onGraphChanged when configure passing version too!"):this.onGraphChanged({action:"graphConfigure",doSave:!1}),this.setDirtyCanvas(!0,!0),Hh}},load($h,Lh){var Sh=this;if($h.constructor===File||$h.constructor===Blob){var Eh=new FileReader;Eh.addEventListener("load",Ah=>{var Ph=JSON.parse(Ah.target.result);Sh.configure(Ph),Lh==null||Lh()}),Eh.readAsText($h);return}var Gh=new XMLHttpRequest;Gh.open("GET",$h,!0),Gh.send(null),Gh.onload=Ah=>{var Ph;if(Gh.status!==200){(Ph=LiteGraph$h.error)==null||Ph.call(LiteGraph$h,"Error loading graph:",Gh.status,Gh.response);return}var Nh=JSON.parse(Gh.response);Sh.configure(Nh),Lh==null||Lh()},Gh.onerror=Ah=>{var Ph;(Ph=LiteGraph$h.error)==null||Ph.call(LiteGraph$h,"Error loading graph:",Ah)}}};let LiteGraph$g=null;function setHistoryMethodsLiteGraph($h){LiteGraph$g=$h}const historyMethods={onGraphSaved($h={}){var Lh={};Object.assign(Lh,$h),this.savedVersion=this._version},onGraphLoaded($h={}){var Lh={};Object.assign(Lh,$h),this.savedVersion=this._version},onGraphChanged($h={}){var Lh,Sh,Eh,Gh,Ah,Ph,Nh={action:"",doSave:!0,doSaveGraph:!0},Mh=Object.assign(Nh,$h);if(!(this._configuring&&Mh.action!=="graphConfigure")&&(this._version++,Mh.action?(Lh=LiteGraph$g.debug)==null||Lh.call(LiteGraph$g,"Graph change",Mh.action):(Sh=LiteGraph$g.debug)==null||Sh.call(LiteGraph$g,"Graph change, no action",Mh),Mh.doSave&&LiteGraph$g.actionHistory_enabled)){(Eh=LiteGraph$g.debug)==null||Eh.call(LiteGraph$g,"onGraphChanged SAVE :: "+Mh.action);var Dh={actionName:Mh.action};Mh.doSaveGraph&&(Dh=Object.assign(Dh,{graphSave:this.serialize()}));for(var Fh=this.history;Fh.actionHistoryPtr<Fh.actionHistoryVersions.length-1;)(Gh=LiteGraph$g.debug)==null||Gh.call(LiteGraph$g,"popping: gone back? "+(Fh.actionHistoryPtr+" < "+(Fh.actionHistoryVersions.length-1))),Fh.actionHistoryVersions.pop();if(Fh.actionHistoryVersions.length>=LiteGraph$g.actionHistoryMaxSave){var Ih=Fh.actionHistoryVersions.shift();(Ah=LiteGraph$g.debug)==null||Ah.call(LiteGraph$g,"maximum saves reached: "+Fh.actionHistoryVersions.length+", remove older: "+Ih),Fh.actionHistory[Ih]=!1}Fh.actionHistoryPtr=Fh.actionHistoryVersions.length,Fh.actionHistoryVersions.push(Fh.actionHistoryPtr),Fh.actionHistory[Fh.actionHistoryPtr]=Dh,(Ph=LiteGraph$g.debug)==null||Ph.call(LiteGraph$g,"history saved: "+Fh.actionHistoryPtr,Dh.actionName)}},actionHistoryBack($h={}){var Lh,Sh,Eh,Gh,Ah,Ph={};Object.assign(Ph,$h);var Nh=this.history;return Nh.actionHistoryPtr!=null&&Nh.actionHistoryPtr>=0?(Nh.actionHistoryPtr--,(Lh=LiteGraph$g.debug)==null||Lh.call(LiteGraph$g,"history step back: "+Nh.actionHistoryPtr),this.actionHistoryLoad({iVersion:Nh.actionHistoryPtr})?((Eh=LiteGraph$g.debug)==null||Eh.call(LiteGraph$g,"history loaded back: "+Nh.actionHistoryPtr),(Gh=LiteGraph$g.debug)==null||Gh.call(LiteGraph$g,this.history),!0):((Sh=LiteGraph$g.warn)==null||Sh.call(LiteGraph$g,"historyLoad failed, restore pointer? "+Nh.actionHistoryPtr),Nh.actionHistoryPtr++,!1)):((Ah=LiteGraph$g.debug)==null||Ah.call(LiteGraph$g,"history is already at older state"),!1)},actionHistoryForward($h={}){var Lh,Sh,Eh,Gh,Ah={};Object.assign(Ah,$h);var Ph=this.history;return Ph.actionHistoryPtr<Ph.actionHistoryVersions.length?(Ph.actionHistoryPtr++,(Lh=LiteGraph$g.debug)==null||Lh.call(LiteGraph$g,"history step forward: "+Ph.actionHistoryPtr),this.actionHistoryLoad({iVersion:Ph.actionHistoryPtr})?((Eh=LiteGraph$g.debug)==null||Eh.call(LiteGraph$g,"history loaded forward: "+Ph.actionHistoryPtr),!0):((Sh=LiteGraph$g.warn)==null||Sh.call(LiteGraph$g,"historyLoad failed, restore pointer? "+Ph.actionHistoryPtr),Ph.actionHistoryPtr--,!1)):((Gh=LiteGraph$g.debug)==null||Gh.call(LiteGraph$g,"history is already at newer state"),!1)},actionHistoryLoad($h={}){var Lh,Sh={iVersion:!1,backStep:!1},Eh=Object.assign(Sh,$h),Gh=this.history;if(Gh.actionHistory[Eh.iVersion]&&Gh.actionHistory[Eh.iVersion].graphSave){var Ah=JSON.stringify(this.history);return this.configure(Gh.actionHistory[Eh.iVersion].graphSave),this.history=JSON.parse(Ah),(Lh=LiteGraph$g.debug)==null||Lh.call(LiteGraph$g,"history loaded: "+Eh.iVersion,Gh.actionHistory[Eh.iVersion].actionName),!0}else return!1}};function installLGraphDelegates($h,Lh){$h.__delegates_installed||(setLifecycleMethodsLiteGraph(Lh),setCanvasBindingMethodsLiteGraph(Lh),setRuntimeLoopMethodsLiteGraph(Lh),setExecutionOrderMethodsLiteGraph(Lh),setNodeMutationMethodsLiteGraph(Lh),setGraphPortsMethodsLiteGraph(Lh),setGraphEventsMethodsLiteGraph(Lh),setSerializationLoadMethodsLiteGraph(Lh),setHistoryMethodsLiteGraph(Lh),[lifecycleMethods,canvasBindingMethods,runtimeLoopMethods,executionOrderMethods,nodeMutationMethods,nodeQueryMethods,graphPortsMethods,graphEventsMethods,serializationLoadMethods,historyMethods].forEach(Sh=>{Object.entries(Sh).forEach(([Eh,Gh])=>{Object.defineProperty($h.prototype,Eh,{value:Gh,writable:!0,configurable:!0})})}),Object.defineProperty($h,"__delegates_installed",{value:!0,writable:!1,configurable:!1}))}class LGraph{constructor(Lh){var Sh;(Sh=LiteGraph.log)==null||Sh.call(LiteGraph,"Graph created"),this.list_of_graphcanvas=null,this.clear(),Lh&&this.configure(Lh)}}Kl(LGraph,"supported_types",["number","string","boolean"]),Kl(LGraph,"STATUS_STOPPED",1),Kl(LGraph,"STATUS_RUNNING",2);function setupLGraphDelegates($h=LiteGraph){installLGraphDelegates(LGraph,$h)}let LiteGraph$f=null;function setLifecycleSerializationMethodsLiteGraph($h){LiteGraph$f=$h}const lifecycleSerializationMethods={configure($h){var Lh,Sh,Eh,Gh,Ah;Object.entries($h).forEach(([Ph,Nh])=>{var Mh;if(Ph==="properties"){for(var Dh in Nh)this.properties[Dh]=Nh[Dh],(Mh=this.onPropertyChanged)==null||Mh.call(this,Dh,Nh[Dh]);return}Nh!==null&&(typeof Nh=="object"?this[Ph]&&this[Ph].configure?this[Ph].configure(Nh):this[Ph]=LiteGraph$f.cloneObject(Nh,this[Ph]):this[Ph]=Nh)}),$h.title||(this.title=this.constructor.title),(Lh=this.inputs)==null||Lh.forEach((Ph,Nh)=>{var Mh,Dh;if(!Ph.link)return;const Fh=this.graph?this.graph.links[Ph.link]:null;(Mh=this.onConnectionsChange)==null||Mh.call(this,LiteGraph$f.INPUT,Nh,!0,Fh,Ph),(Dh=this.onInputAdded)==null||Dh.call(this,Ph)}),(Sh=this.outputs)==null||Sh.forEach((Ph,Nh)=>{var Mh;Ph.links&&(Ph.links.forEach(()=>{var Dh;const Fh=this.graph;(Dh=this.onConnectionsChange)==null||Dh.call(this,LiteGraph$f.OUTPUT,Nh,!0,Fh,Ph)}),(Mh=this.onOutputAdded)==null||Mh.call(this,Ph))}),this.widgets&&(this.widgets.forEach(Ph=>{Ph&&Ph.options&&Ph.options.property&&this.properties[Ph.options.property]!==void 0&&(Ph.value=JSON.parse(JSON.stringify(this.properties[Ph.options.property])))}),(Eh=$h.widgets_values)==null||Eh.forEach((Ph,Nh)=>{this.widgets[Nh]&&(this.widgets[Nh].value=Ph)})),(Gh=this.onConfigure)==null||Gh.call(this,$h),(Ah=this.graph)==null||Ah.onGraphChanged({action:"nodeConfigure",doSave:!1})},serialize(){var $h,Lh,Sh,Eh={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph$f.cloneObject(this.flags),order:this.order,mode:this.mode};return this.constructor===LiteGraph$f.LGraphNode&&this.last_serialization?this.last_serialization:(this.inputs&&(Eh.inputs=LiteGraph$f.cloneObject(this.inputs)),this.outputs&&(this.outputs.forEach(Gh=>{delete Gh._data}),Eh.outputs=LiteGraph$f.cloneObject(this.outputs)),this.title&&this.title!=this.constructor.title&&(Eh.title=this.title),this.properties&&(Eh.properties=LiteGraph$f.cloneObject(this.properties)),this.widgets&&this.serialize_widgets&&(Eh.widgets_values=this.widgets.map(Gh=>{var Ah;return(Ah=Gh==null?void 0:Gh.value)!=null?Ah:null})),($h=Eh.type)!=null||(Eh.type=this.constructor.type),this.color&&(Eh.color=this.color),this.bgcolor&&(Eh.bgcolor=this.bgcolor),this.boxcolor&&(Eh.boxcolor=this.boxcolor),this.shape&&(Eh.shape=this.shape),(Lh=this.onSerialize)!=null&&Lh.call(this,Eh)&&((Sh=LiteGraph$f.warn)==null||Sh.call(LiteGraph$f,"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter")),Eh)},clone(){var $h,Lh,Sh=LiteGraph$f.createNode(this.type);if(!Sh)return null;var Eh=LiteGraph$f.cloneObject(this.serialize());return($h=Eh.inputs)==null||$h.forEach(Gh=>{Gh.link=null}),(Lh=Eh.outputs)==null||Lh.forEach(Gh=>{Gh.links&&(Gh.links.length=0)}),delete Eh.id,LiteGraph$f.use_uuids&&(Eh.id=LiteGraph$f.uuidv4()),Sh.configure(Eh),Sh},toString(){return JSON.stringify(this.serialize())},getTitle(){var $h;return($h=this.title)!=null?$h:this.constructor.title}};let LiteGraph$e=null;function setPropertiesWidgetsMethodsLiteGraph($h){LiteGraph$e=$h}const propertiesWidgetsMethods={setProperty($h,Lh){var Sh,Eh;if(this.properties||(this.properties={}),Lh===this.properties[$h])return;const Gh=this.properties[$h];this.properties[$h]=Lh,((Sh=this.onPropertyChanged)==null?void 0:Sh.call(this,$h,Lh,Gh))===!1&&(this.properties[$h]=Gh);const Ah=(Eh=this.widgets)==null?void 0:Eh.find(Ph=>{var Nh;return Ph&&((Nh=Ph.options)==null?void 0:Nh.property)===$h});Ah&&(Ah.value=Lh)},addProperty($h,Lh,Sh,Eh){var Gh,Ah;const Ph={name:$h,type:Sh,default_value:Lh,...Eh};return this.properties_info=(Gh=this.properties_info)!=null?Gh:[],this.properties_info.push(Ph),this.properties=(Ah=this.properties)!=null?Ah:{},this.properties[$h]=Lh,Ph},getPropertyInfo($h){var Lh=null;if(this.properties_info){for(var Sh=0;Sh<this.properties_info.length;++Sh)if(this.properties_info[Sh].name==$h){Lh=this.properties_info[Sh];break}}return this.constructor[`@${$h}`]&&(Lh=this.constructor[`@${$h}`]),this.constructor.widgets_info&&this.constructor.widgets_info[$h]&&(Lh=this.constructor.widgets_info[$h]),!Lh&&this.onGetPropertyInfo&&(Lh=this.onGetPropertyInfo($h)),Lh||(Lh={}),Lh.type||(Lh.type=typeof this.properties[$h]),Lh.widget=="combo"&&(Lh.type="enum"),Lh},addWidget($h,Lh,Sh,Eh,Gh){var Ah,Ph,Nh;(Ah=this.widgets)!=null||(this.widgets=[]),!Gh&&Eh&&Eh.constructor===Object&&(Gh=Eh,Eh=null),Gh&&Gh.constructor===String&&(Gh={property:Gh}),Eh&&Eh.constructor===String&&(Gh!=null||(Gh={}),Gh.property=Eh,Eh=null),Eh&&Eh.constructor!==Function&&((Ph=LiteGraph$e.warn)==null||Ph.call(LiteGraph$e,"addWidget: callback must be a function"),Eh=null);var Mh={type:$h.toLowerCase(),name:Lh,value:Sh,callback:Eh,options:Gh||{}};if(Mh.options.y!==void 0&&(Mh.y=Mh.options.y),!Eh&&!Mh.options.callback&&!Mh.options.property&&((Nh=LiteGraph$e.warn)==null||Nh.call(LiteGraph$e,"LiteGraph addWidget(...) without a callback or property assigned")),$h=="combo"&&!Mh.options.values)throw Error("LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }");return this.widgets.push(Mh),this.setSize(this.computeSize()),Mh},addCustomWidget($h){var Lh;return(Lh=this.widgets)!=null||(this.widgets=[]),this.widgets.push($h),$h}},ioDataMethods={setOutputData($h,Lh){var Sh;if(this.outputs){if(($h==null?void 0:$h.constructor)===String)$h=this.findOutputSlot($h);else if($h==-1||$h>=this.outputs.length)return;var Eh=this.outputs[$h];Eh&&(Eh._data=Lh,(Sh=this.outputs[$h].links)==null||Sh.forEach(Gh=>{const Ah=this.graph.links[Gh];Ah&&(Ah.data=Lh)}))}},setOutputDataType($h,Lh){var Sh,Eh;if(this.outputs&&!($h==-1||$h>=this.outputs.length)){var Gh=this.outputs[$h];Gh&&(Gh.type=Lh,(Eh=(Sh=this.outputs[$h])==null?void 0:Sh.links)==null||Eh.forEach(Ah=>{this.graph.links[Ah]&&(this.graph.links[Ah].type=Lh)}))}},getInputData($h,Lh,Sh){var Eh;if(this.inputs&&!($h>=this.inputs.length||this.inputs[$h].link==null)){var Gh=this.inputs[$h].link,Ah=this.graph.links[Gh];if(!Ah)return null;if(!Lh)return Ah.data;var Ph=this.graph.getNodeById(Ah.origin_id);if(!Ph)return Ah.data;if(Sh){var Nh=this.id+"_getInputData_forced_"+Math.floor(Math.random()*9999),Mh={action:Nh,options:{action_call:Nh}};this.refreshAncestors(Mh)}return Ph.updateOutputData?Ph.updateOutputData(Ah.origin_slot):(Eh=Ph.doExecute)==null||Eh.call(Ph),Ah.data}},getInputDataType($h){if(!this.inputs||$h>=this.inputs.length||this.inputs[$h].link==null)return null;var Lh=this.inputs[$h].link,Sh=this.graph.links[Lh];if(!Sh)return null;var Eh=this.graph.getNodeById(Sh.origin_id);if(!Eh)return Sh.type;var Gh=Eh.outputs[Sh.origin_slot];return Gh?Gh.type:null},getInputDataByName($h,Lh){var Sh=this.findInputSlot($h);return Sh==-1?null:this.getInputData(Sh,Lh)},isInputConnected($h){return this.inputs?$h<this.inputs.length&&this.inputs[$h].link!=null:!1},getInputInfo($h){return this.inputs&&$h<this.inputs.length?this.inputs[$h]:null},getInputLink($h){if(!this.inputs)return null;if($h<this.inputs.length){var Lh=this.inputs[$h];return this.graph.links[Lh.link]}return null},getInputNode($h){if(!this.inputs||$h>=this.inputs.length)return null;var Lh=this.inputs[$h];if(!Lh||Lh.link===null)return null;var Sh=this.graph.links[Lh.link];return Sh?this.graph.getNodeById(Sh.origin_id):null},getInputOrProperty($h){if(this.inputs)for(var Lh=0,Sh=this.inputs.length;Lh<Sh;++Lh){var Eh=this.inputs[Lh];if($h==Eh.name&&Eh.link!=null){var Gh=this.graph.links[Eh.link];if(Gh)return Gh.data}}return this.properties?this.properties[$h]:null},getOutputData($h){if(!this.outputs||$h>=this.outputs.length)return null;var Lh=this.outputs[$h];return Lh._data},getOutputInfo($h){return this.outputs&&$h<this.outputs.length?this.outputs[$h]:null},isOutputConnected($h){return this.outputs?$h<this.outputs.length&&this.outputs[$h].links&&this.outputs[$h].links.length:!1},isAnyOutputConnected(){return this.outputs?this.outputs.some($h=>$h.links&&$h.links.length):!1},getOutputNodes($h){if(!this.outputs||$h>=this.outputs.length)return null;const Lh=this.outputs[$h];return!Lh.links||Lh.links.length===0?null:Lh.links.map(Sh=>this.graph.links[Sh]).filter(Sh=>Sh).map(Sh=>this.graph.getNodeById(Sh.target_id)).filter(Sh=>Sh)}};let LiteGraph$d=null;function setExecutionActionsMethodsLiteGraph($h){LiteGraph$d=$h}const executionActionsMethods={addOnTriggerInput(){var $h=this.findInputSlot("onTrigger");return $h==-1?(this.addInput("onTrigger",LiteGraph$d.EVENT,{removable:!0,nameLocked:!0}),this.findInputSlot("onTrigger")):$h},addOnExecutedOutput(){var $h=this.findOutputSlot("onExecuted");return $h==-1?(this.addOutput("onExecuted",LiteGraph$d.ACTION,{removable:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")):$h},onAfterExecuteNode($h,Lh){var Sh,Eh=this.findOutputSlot("onExecuted");Eh!=-1&&((Sh=LiteGraph$d.debug)==null||Sh.call(LiteGraph$d,this.id+":"+this.order+" triggering slot onAfterExecute",$h,Lh),this.triggerSlot(Eh,$h,null,Lh))},changeMode($h){switch($h){case LiteGraph$d.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph$d.ON_EVENT:break;case LiteGraph$d.NEVER:break;case LiteGraph$d.ALWAYS:break;case LiteGraph$d.ON_REQUEST:break;default:return!1}return this.mode=$h,!0},executePendingActions(){!this._waiting_actions||!this._waiting_actions.length||(this._waiting_actions.forEach($h=>{this.onAction($h[0],$h[1],$h[2],$h[3],$h[4])}),this._waiting_actions.length=0)},doExecute($h,Lh={}){var Sh,Eh,Gh,Ah,Ph;if(this.onExecute){if((Sh=Lh.action_call)!=null||(Lh.action_call=`${this.id}_exec_${Math.floor(Math.random()*9999)}`),this.graph.nodes_executing&&this.graph.nodes_executing[this.id]){(Eh=LiteGraph$d.debug)==null||Eh.call(LiteGraph$d,"NODE already executing! Prevent! "+this.id+":"+this.order);return}if(LiteGraph$d.ensureNodeSingleExecution&&this.exec_version&&this.exec_version>=this.graph.iteration&&this.exec_version!==void 0){(Gh=LiteGraph$d.debug)==null||Gh.call(LiteGraph$d,"!! NODE already EXECUTED THIS STEP !! "+this.exec_version);return}if(LiteGraph$d.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&Lh&&Lh.action_call&&this.graph.nodes_executedAction[this.id]==Lh.action_call){(Ah=LiteGraph$d.debug)==null||Ah.call(LiteGraph$d,"!! NODE already ACTION THIS STEP !! "+Lh.action_call);return}this.graph.nodes_executing[this.id]=!0,this.onExecute($h,Lh),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,Lh&&Lh.action_call&&(this.action_call=Lh.action_call,this.graph.nodes_executedAction[this.id]=Lh.action_call)}this.execute_triggered=2,(Ph=this.onAfterExecuteNode)==null||Ph.call(this,$h,Lh)},execute($h,Lh={}){return this.doExecute($h,Lh)},actionDo($h,Lh,Sh={},Eh){var Gh,Ah,Ph,Nh;if(this.onAction){if((Gh=Sh.action_call)!=null||(Sh.action_call=`${this.id}_${$h||"action"}_${Math.floor(Math.random()*9999)}`),LiteGraph$d.ensureNodeSingleAction&&this.graph.nodes_actioning&&this.graph.nodes_actioning[this.id]==Sh.action_call)return;if((Ah=LiteGraph$d.debug)==null||Ah.call(LiteGraph$d,"CheckActioned ? "+this.id+":"+this.order+" :: "+this.action_call),LiteGraph$d.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&Sh&&Sh.action_call&&this.graph.nodes_executedAction[this.id]==Sh.action_call){(Ph=LiteGraph$d.debug)==null||Ph.call(LiteGraph$d,"!! NODE already ACTION THIS STEP !! "+Sh.action_call),\u00E7;return}this.graph.nodes_actioning[this.id]=$h||"actioning",this.onAction($h,Lh,Sh,Eh),this.graph.nodes_actioning[this.id]=!1,Sh&&Sh.action_call&&(this.action_call=Sh.action_call,this.graph.nodes_executedAction[this.id]=Sh.action_call)}this.action_triggered=2,(Nh=this.onAfterExecuteNode)==null||Nh.call(this,Lh,Sh)},trigger($h,Lh,Sh){!this.outputs||this.outputs.length===0||(this.graph&&(this.graph._last_trigger_time=LiteGraph$d.getTime()),this.outputs.forEach((Eh,Gh)=>{Eh&&Eh.type===LiteGraph$d.EVENT&&(!$h||Eh.name===$h)&&this.triggerSlot(Gh,Lh,null,Sh)}))},triggerSlot($h,Lh,Sh,Eh={}){var Gh,Ah,Ph,Nh;if(this.outputs){if($h==null){(Gh=LiteGraph$d.error)==null||Gh.call(LiteGraph$d,"triggerSlot","slot must be a number");return}$h.constructor!==Number&&((Ah=LiteGraph$d.warn)==null||Ah.call(LiteGraph$d,"triggerSlot","slot must be a number, use node.trigger('name') if you want to use a string"));var Mh=this.outputs[$h];if(Mh){var Dh=Mh.links;if(!(!Dh||!Dh.length)&&!(this.graph&&this.graph.ancestorsCall)){this.graph&&(this.graph._last_trigger_time=LiteGraph$d.getTime());for(var Fh=0;Fh<Dh.length;++Fh){var Ih=Dh[Fh];if(!(Sh!=null&&Sh!=Ih)){var Hh=this.graph.links[Dh[Fh]];if(Hh){Hh._last_time=LiteGraph$d.getTime();var Wh=this.graph.getNodeById(Hh.target_id);if(Wh){if(Wh.mode===LiteGraph$d.ON_TRIGGER)Eh.action_call||(Eh.action_call=`${this.id}_trigg_${Math.floor(Math.random()*9999)}`),LiteGraph$d.refreshAncestorsOnTriggers&&Wh.refreshAncestors({action:"trigger",param:Lh,options:Eh}),Wh.onExecute&&Wh.doExecute(Lh,Eh);else if(Wh.onAction){Eh.action_call||(Eh.action_call=`${this.id}_act_${Math.floor(Math.random()*9999)}`);let zh=Wh.inputs[Hh.target_slot];(Ph=LiteGraph$d.debug)==null||Ph.call(LiteGraph$d,"triggerSlot","will call onACTION: "+this.id+":"+this.order+" :: "+zh.name),LiteGraph$d.refreshAncestorsOnActions&&Wh.refreshAncestors({action:zh.name,param:Lh,options:Eh}),LiteGraph$d.use_deferred_actions&&Wh.onExecute?((Nh=Wh._waiting_actions)!=null||(Wh._waiting_actions=[]),Wh._waiting_actions.push([zh.name,Lh,Eh,Hh.target_slot])):Wh.actionDo(zh.name,Lh,Eh,Hh.target_slot)}}}}}}}}},clearTriggeredSlot($h,Lh){!this.outputs||!this.outputs[$h]||!this.outputs[$h].links||this.outputs[$h].links.forEach(Sh=>{if(Lh!==null&&Lh!==Sh)return;const Eh=this.graph.links[Sh];Eh&&(Eh._last_time=0)})}};let LiteGraph$c=null;function setSlotsMutationMethodsLiteGraph($h){LiteGraph$c=$h}const slotsMutationMethods={setSize($h){var Lh;this.size=$h,(Lh=this.onResize)==null||Lh.call(this,this.size)},addInput($h,Lh,Sh){return this.addSlot($h,Lh,Sh,!0)},addOutput($h,Lh,Sh){return this.addSlot($h,Lh,Sh,!1)},addSlot($h,Lh,Sh,Eh){var Gh,Ah,Ph,Nh;const Mh=Eh?{name:$h,type:Lh,link:null,...Sh}:{name:$h,type:Lh,links:null,...Sh};return Eh?(this.inputs=(Gh=this.inputs)!=null?Gh:[],this.inputs.push(Mh),(Ah=this.onInputAdded)==null||Ah.call(this,Mh),LiteGraph$c.registerNodeAndSlotType(this,Lh)):(this.outputs=(Ph=this.outputs)!=null?Ph:[],this.outputs.push(Mh),(Nh=this.onOutputAdded)==null||Nh.call(this,Mh),LiteGraph$c.auto_load_slot_types&&LiteGraph$c.registerNodeAndSlotType(this,Lh,!0)),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),Mh},addInputs($h){this.addSlots($h,!0)},addOutputs($h){this.addSlots($h,!1)},addSlots($h,Lh){var Sh;typeof $h=="string"&&($h=[$h]),$h.forEach(Eh=>{var Gh,Ah,Ph,Nh,Mh,Dh;const Fh=Lh?{name:Eh[0],type:Eh[1],link:null,...(Gh=Eh[2])!=null?Gh:{}}:{name:Eh[0],type:Eh[1],links:null,...(Ah=Eh[2])!=null?Ah:{}};Lh?(this.inputs=(Ph=this.inputs)!=null?Ph:[],this.inputs.push(Fh),(Nh=this.onInputAdded)==null||Nh.call(this,Fh),LiteGraph$c.registerNodeAndSlotType(this,Eh[1])):(this.outputs=(Mh=this.outputs)!=null?Mh:[],this.outputs.push(Fh),(Dh=this.onOutputAdded)==null||Dh.call(this,Fh),LiteGraph$c.auto_load_slot_types&&LiteGraph$c.registerNodeAndSlotType(this,Eh[1],!0))}),this.setSize(this.computeSize()),(Sh=this.setDirtyCanvas)==null||Sh.call(this,!0,!0)},removeInput($h){var Lh;this.disconnectInput($h);const Sh=this.inputs.splice($h,1)[0];this.inputs.slice($h).filter(Eh=>!!Eh).forEach(Eh=>{const Gh=this.graph.links[Eh.link];Gh!=null&&Gh.target_slot&&Gh.target_slot--}),this.setSize(this.computeSize()),(Lh=this.onInputRemoved)==null||Lh.call(this,$h,Sh),this.setDirtyCanvas(!0,!0)},removeOutput($h){var Lh;this.disconnectOutput($h),this.outputs=this.outputs.filter((Sh,Eh)=>Eh!==$h),this.outputs.slice($h).forEach(Sh=>{!Sh||!Sh.links||Sh.links.forEach(Eh=>{const Gh=this.graph.links[Eh];Gh&&(Gh.origin_slot-=1)})}),this.setSize(this.computeSize()),(Lh=this.onOutputRemoved)==null||Lh.call(this,$h),this.setDirtyCanvas(!0,!0)},addConnection($h,Lh,Sh,Eh){var Gh={name:$h,type:Lh,pos:Sh,direction:Eh,links:null};return this.connections.push(Gh),Gh}};let LiteGraph$b=null;function setSlotsQueryMethodsLiteGraph($h){LiteGraph$b=$h}const slotsQueryMethods={findInputSlot($h,Lh){if(!this.inputs)return-1;for(var Sh=0,Eh=this.inputs.length;Sh<Eh;++Sh)if($h==this.inputs[Sh].name)return Lh?this.inputs[Sh]:Sh;return-1},findOutputSlot($h,Lh=!1){if(!this.outputs)return-1;for(var Sh=0,Eh=this.outputs.length;Sh<Eh;++Sh)if($h==this.outputs[Sh].name)return Lh?this.outputs[Sh]:Sh;return-1},findInputSlotFree($h={}){var Lh={returnObj:!1,typesNotAccepted:[]},Sh=Object.assign(Lh,$h);if(!this.inputs)return-1;for(var Eh=0,Gh=this.inputs.length;Eh<Gh;++Eh)if(!(this.inputs[Eh].link&&this.inputs[Eh].link!=null)&&!(Sh.typesNotAccepted&&Sh.typesNotAccepted.includes&&Sh.typesNotAccepted.includes(this.inputs[Eh].type)))return Sh.returnObj?this.inputs[Eh]:Eh;return-1},findOutputSlotFree($h={}){var Lh={returnObj:!1,typesNotAccepted:[]},Sh=Object.assign(Lh,$h);if(!this.outputs)return-1;for(let Eh=0,Gh=this.outputs.length;Eh<Gh;++Eh)if(!(this.outputs[Eh].links&&this.outputs[Eh].links!=null)&&!(Sh.typesNotAccepted&&Sh.typesNotAccepted.includes&&Sh.typesNotAccepted.includes(this.outputs[Eh].type)))return Sh.returnObj?this.outputs[Eh]:Eh;return-1},findInputSlotByType($h,Lh,Sh,Eh){return this.findSlotByType(!0,$h,Lh,Sh,Eh)},findOutputSlotByType($h,Lh,Sh,Eh){return this.findSlotByType(!1,$h,Lh,Sh,Eh)},findSlotByType($h=!1,Lh,Sh=!1,Eh=!1,Gh=!1){var Ah=$h?this.inputs:this.outputs;if(!Ah)return-1;(Lh==""||Lh=="*")&&(Lh=0);for(let Ph=0,Nh=Ah.length;Ph<Nh;++Ph){let Mh=(Lh+"").toLowerCase().split(","),Dh=Ah[Ph].type=="0"||Ah[Ph].type=="*"?"0":Ah[Ph].type;Dh=(Dh+"").toLowerCase().split(",");for(let Fh=0;Fh<Mh.length;Fh++)for(let Ih=0;Ih<Dh.length;Ih++)if(Mh[Fh]=="_event_"&&(Mh[Fh]=LiteGraph$b.EVENT),Dh[Fh]=="_event_"&&(Dh[Fh]=LiteGraph$b.EVENT),Mh[Fh]=="*"&&(Mh[Fh]=0),Dh[Fh]=="*"&&(Dh[Fh]=0),Mh[Fh]==Dh[Ih]){if(Eh&&Ah[Ph].links&&Ah[Ph].links!==null)continue;return Sh?Ah[Ph]:Ph}}if(Eh&&!Gh)for(let Ph=0,Nh=Ah.length;Ph<Nh;++Ph){let Mh=(Lh+"").toLowerCase().split(","),Dh=Ah[Ph].type=="0"||Ah[Ph].type=="*"?"0":Ah[Ph].type;Dh=(Dh+"").toLowerCase().split(",");for(let Fh=0;Fh<Mh.length;Fh++)for(let Ih=0;Ih<Dh.length;Ih++)if(Mh[Fh]=="*"&&(Mh[Fh]=0),Dh[Fh]=="*"&&(Dh[Fh]=0),Mh[Fh]==Dh[Ih])return Sh?Ah[Ph]:Ph}return-1},getSlotInPosition($h,Lh){var Sh=new Float32Array(2);if(this.inputs)for(let Eh=0,Gh=this.inputs.length;Eh<Gh;++Eh){let Ah=this.inputs[Eh];if(this.getConnectionPos(!0,Eh,Sh),LiteGraph$b.isInsideRectangle($h,Lh,Sh[0]-10,Sh[1]-5,20,10))return{input:Ah,slot:Eh,link_pos:Sh}}if(this.outputs)for(let Eh=0,Gh=this.outputs.length;Eh<Gh;++Eh){let Ah=this.outputs[Eh];if(this.getConnectionPos(!1,Eh,Sh),LiteGraph$b.isInsideRectangle($h,Lh,Sh[0]-10,Sh[1]-5,20,10))return{output:Ah,slot:Eh,link_pos:Sh}}return null}};let LiteGraph$a=null;function setConnectionsMethodsLiteGraph($h){LiteGraph$a=$h}const connectionsMethods={connectByType($h,Lh,Sh="*",Eh={}){var Gh,Ah,Ph,Nh,Mh,Dh={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},Fh=Object.assign(Dh,Eh);Lh&&Lh.constructor===Number&&(Lh=this.graph.getNodeById(Lh));var Ih=Lh.findInputSlotByType(Sh,!1,!0);return Ih>=0&&Ih!==null?((Gh=LiteGraph$a.debug)==null||Gh.call(LiteGraph$a,"CONNbyTYPE type "+Sh+" for "+Ih),this.connect($h,Lh,Ih)):Fh.createEventInCase&&Sh==LiteGraph$a.EVENT?((Ah=LiteGraph$a.debug)==null||Ah.call(LiteGraph$a,"connect WILL CREATE THE onTrigger "+Sh+" to "+Lh),this.connect($h,Lh,-1)):Fh.generalTypeInCase&&(Ih=Lh.findInputSlotByType(0,!1,!0,!0),(Ph=LiteGraph$a.debug)==null||Ph.call(LiteGraph$a,"connect TO a general type (*, 0), if not found the specific type ",Sh," to ",Lh,"RES_SLOT:",Ih),Ih>=0)?this.connect($h,Lh,Ih):Fh.firstFreeIfOutputGeneralInCase&&(Sh==0||Sh=="*"||Sh=="")&&(Ih=Lh.findInputSlotFree({typesNotAccepted:[LiteGraph$a.EVENT]}),(Nh=LiteGraph$a.debug)==null||Nh.call(LiteGraph$a,"connect TO TheFirstFREE ",Sh," to ",Lh,"RES_SLOT:",Ih),Ih>=0)?this.connect($h,Lh,Ih):((Mh=LiteGraph$a.debug)==null||Mh.call(LiteGraph$a,"no way to connect type: ",Sh," to targetNODE ",Lh),null)},connectByTypeOutput($h,Lh,Sh="*",Eh={}){var Gh,Ah,Ph,Nh={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},Mh=Object.assign(Nh,Eh);Lh&&Lh.constructor===Number&&(Lh=this.graph.getNodeById(Lh));var Dh=Lh.findOutputSlotByType(Sh,!1,!0);return Dh>=0&&Dh!==null?((Gh=LiteGraph$a.debug)==null||Gh.call(LiteGraph$a,"CONNbyTYPE OUT! type "+Sh+" for "+Dh),Lh.connect(Dh,this,$h)):Mh.generalTypeInCase&&(Dh=Lh.findOutputSlotByType(0,!1,!0,!0),Dh>=0)?Lh.connect(Dh,this,$h):Mh.createEventInCase&&Sh==LiteGraph$a.EVENT&&LiteGraph$a.do_add_triggers_slots?(Dh=Lh.addOnExecutedOutput(),Lh.connect(Dh,this,$h)):Mh.firstFreeIfInputGeneralInCase&&(Sh==0||Sh=="*"||Sh==""||Sh=="undefined")&&(Dh=Lh.findOutputSlotFree({typesNotAccepted:[LiteGraph$a.EVENT]}),Dh>=0)?Lh.connect(Dh,this,$h):((Ah=LiteGraph$a.debug)==null||Ah.call(LiteGraph$a,"no way to connect byOUT type: ",Sh," to sourceNODE ",Lh),(Ph=LiteGraph$a.log)==null||Ph.call(LiteGraph$a,"type OUT! "+Sh+" not found or not free?"),null)},connect($h,Lh,Sh=0){var Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh,Uh,Yh;if(!this.graph)return(Eh=LiteGraph$a.log)==null||Eh.call(LiteGraph$a,"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if($h.constructor===String){if($h=this.findOutputSlot($h),$h==-1)return(Gh=LiteGraph$a.log)==null||Gh.call(LiteGraph$a,`Connect: Error, no slot of name ${$h}`),null}else if(!this.outputs||$h>=this.outputs.length)return(Ah=LiteGraph$a.log)==null||Ah.call(LiteGraph$a,"Connect: Error, slot number not found"),null;if(Lh&&Lh.constructor===Number&&(Lh=this.graph.getNodeById(Lh)),!Lh)throw new Error("target node is null");if(Lh==this)return null;if(Sh.constructor===String){if(Sh=Lh.findInputSlot(Sh),Sh==-1)return(Ph=LiteGraph$a.log)==null||Ph.call(LiteGraph$a,`Connect: Error, no slot of name ${Sh}`),null}else if(Sh===LiteGraph$a.EVENT)if(LiteGraph$a.do_add_triggers_slots)Lh.changeMode(LiteGraph$a.ON_TRIGGER),Sh=Lh.findInputSlot("onTrigger");else return null;else if(!Lh.inputs||Sh>=Lh.inputs.length)return(Nh=LiteGraph$a.log)==null||Nh.call(LiteGraph$a,"Connect: Error, slot number not found"),null;var Xh=!1,jh=Lh.inputs[Sh],qh=null,Kh=this.outputs[$h];if(!this.outputs[$h])return(Mh=LiteGraph$a.log)==null||Mh.call(LiteGraph$a,"Invalid slot passed: ",$h,this.outputs),null;if(Lh.onBeforeConnectInput&&(Sh=Lh.onBeforeConnectInput(Lh)),((Dh=this.onConnectOutput)==null?void 0:Dh.call(this,$h,jh.type,jh,Lh,Sh))===!1)return null;if(Sh===!1||Sh===null||!LiteGraph$a.isValidConnection(Kh.type,jh.type))return this.setDirtyCanvas(!1,!0),Xh&&this.graph.connectionChange(this,qh),null;if((Fh=LiteGraph$a.debug)==null||Fh.call(LiteGraph$a,"DBG targetSlot",Sh),((Ih=Lh.onConnectInput)==null?void 0:Ih.call(Lh,Sh,Kh.type,Kh,this,$h))===!1||((Hh=this.onConnectOutput)==null?void 0:Hh.call(this,$h,jh.type,jh,Lh,Sh))===!1)return null;Lh.inputs[Sh]&&Lh.inputs[Sh].link!=null&&(this.graph.beforeChange(),Lh.disconnectInput(Sh,{doProcessChange:!1}),Xh=!0),(Wh=Kh.links)!=null&&Wh.length&&Kh.type===LiteGraph$a.EVENT&&(LiteGraph$a.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput($h,!1,{doProcessChange:!1}),Xh=!0));var Zh;return LiteGraph$a.use_uuids?Zh=LiteGraph$a.uuidv4():Zh=++this.graph.last_link_id,qh=new LiteGraph$a.LLink(Zh,jh.type||Kh.type,this.id,$h,Lh.id,Sh),this.graph.links[qh.id]=qh,Kh.links==null&&(Kh.links=[]),Kh.links.push(qh.id),!Lh.inputs||typeof Lh.inputs[Sh]=="undefined"?((zh=LiteGraph$a.warn)==null||zh.call(LiteGraph$a,"connect aborted: target slot does not exist on target node",Lh,Sh),Kh.links.pop(),delete this.graph.links[qh.id],null):(Lh.inputs[Sh].link=qh.id,(Uh=this.onConnectionsChange)==null||Uh.call(this,LiteGraph$a.OUTPUT,$h,!0,qh,Kh),(Yh=Lh.onConnectionsChange)==null||Yh.call(Lh,LiteGraph$a.INPUT,Sh,!0,qh,jh),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,Lh,Sh,this,$h),this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,$h,Lh,Sh)),this.graph.onGraphChanged({action:"connect"}),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,qh),qh)},disconnectOutput($h,Lh,Sh={}){var Eh,Gh,Ah,Ph,Nh,Mh,Dh={doProcessChange:!0},Fh=Object.assign(Dh,Sh);if($h.constructor===String){if($h=this.findOutputSlot($h),$h==-1)return(Eh=LiteGraph$a.log)==null||Eh.call(LiteGraph$a,`Connect: Error, no slot of name ${$h}`),!1}else if(!this.outputs||$h>=this.outputs.length)return(Gh=LiteGraph$a.log)==null||Gh.call(LiteGraph$a,"Connect: Error, slot number not found"),!1;var Ih=this.outputs[$h];if(!Ih||!Ih.links||Ih.links.length==0)return!1;if(Lh){if(Lh.constructor===Number&&(Lh=this.graph.getNodeById(Lh)),!Lh)throw new Error("Target Node not found");for(let Wh=0,zh=Ih.links.length;Wh<zh;Wh++){let Uh=Ih.links[Wh],Yh=this.graph.links[Uh];if(Yh.target_id==Lh.id){Ih.links.splice(Wh,1);var Hh=Lh.inputs[Yh.target_slot];Hh.link=null,delete this.graph.links[Uh],(Ah=this.graph)==null||Ah.onGraphChanged({action:"disconnectOutput",doSave:Fh.doProcessChange}),(Ph=Lh.onConnectionsChange)==null||Ph.call(Lh,LiteGraph$a.INPUT,Yh.target_slot,!1,Yh,Hh),(Nh=this.onConnectionsChange)==null||Nh.call(this,LiteGraph$a.OUTPUT,$h,!1,Yh,Ih),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,$h),this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,$h),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,Lh,Yh.target_slot));break}}}else{for(let Wh=0,zh=Ih.links.length;Wh<zh;Wh++){let Uh=Ih.links[Wh],Yh=this.graph.links[Uh];Yh&&(Lh=this.graph.getNodeById(Yh.target_id),Hh=null,(Mh=this.graph)==null||Mh.onGraphChanged({action:"disconnectOutput",doSave:Fh.doProcessChange}),Lh&&(Hh=Lh.inputs[Yh.target_slot],Hh.link=null,Lh.onConnectionsChange&&Lh.onConnectionsChange(LiteGraph$a.INPUT,Yh.target_slot,!1,Yh,Hh),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,Lh,Yh.target_slot)),delete this.graph.links[Uh],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$a.OUTPUT,$h,!1,Yh,Ih),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,$h),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,Lh,Yh.target_slot)))}Ih.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},disconnectInput($h,Lh={}){var Sh,Eh,Gh,Ah={doProcessChange:!0},Ph=Object.assign(Ah,Lh);if($h.constructor===String){if($h=this.findInputSlot($h),$h==-1)return(Sh=LiteGraph$a.log)==null||Sh.call(LiteGraph$a,`Connect: Error, no slot of name ${$h}`),!1}else if(!this.inputs||$h>=this.inputs.length)return(Eh=LiteGraph$a.log)==null||Eh.call(LiteGraph$a,"Connect: Error, slot number not found"),!1;var Nh=this.inputs[$h];if(!Nh)return!1;var Mh=this.inputs[$h].link;if(Mh!=null){this.inputs[$h].link=null;var Dh=this.graph.links[Mh];if(Dh){var Fh=this.graph.getNodeById(Dh.origin_id);if(!Fh)return!1;var Ih=Fh.outputs[Dh.origin_slot];if(!Ih||!Ih.links||Ih.links.length==0)return!1;for(var Hh=0,Wh=Ih.links.length;Hh<Wh;Hh++)if(Ih.links[Hh]==Mh){Ih.links.splice(Hh,1);break}delete this.graph.links[Mh],(Gh=this.graph)==null||Gh.onGraphChanged({action:"disconnectInput",doSave:Ph.doProcessChange}),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$a.INPUT,$h,!1,Dh,Nh),Fh.onConnectionsChange&&Fh.onConnectionsChange(LiteGraph$a.OUTPUT,Hh,!1,Dh,Ih),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,Fh,Hh),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,this,$h))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0}};let LiteGraph$9=null;function setGeometryHitMethodsLiteGraph($h){LiteGraph$9=$h}const geometryHitMethods={computeSize($h){if(this.constructor.size)return this.constructor.size.concat();var Lh=$h||new Float32Array([0,0]),Sh=LiteGraph$9.NODE_TEXT_SIZE;const Eh=Ih=>Ih?Sh*Ih.length*.6:0;var Gh=Eh(this.title),Ah=0,Ph=0;this.inputs&&(Ah=this.inputs.reduce((Ih,Hh)=>{const Wh=Hh.label||Hh.name||"",zh=Eh(Wh);return Math.max(Ih,zh)},0)),this.outputs&&(Ph=this.outputs.reduce((Ih,Hh)=>{const Wh=Hh.label||Hh.name||"",zh=Eh(Wh);return Math.max(Ih,zh)},0)),Lh[0]=Math.max(Ah+Ph+10,Gh),Lh[0]=Math.max(Lh[0],LiteGraph$9.NODE_WIDTH),this.widgets&&this.widgets.length&&(Lh[0]=Math.max(Lh[0],LiteGraph$9.NODE_WIDTH*1.5));const Nh=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1,1)*LiteGraph$9.NODE_SLOT_HEIGHT;Lh[1]=Nh+(this.constructor.slot_start_y||0);let Mh=0;if(this.widgets&&this.widgets.length){for(var Dh=0,Fh=this.widgets.length;Dh<Fh;++Dh)this.widgets[Dh].computeSize?Mh+=this.widgets[Dh].computeSize(Lh[0])[1]+4:Mh+=LiteGraph$9.NODE_WIDGET_HEIGHT+4;Mh+=8}return this.widgets_up?Lh[1]=Math.max(Lh[1],Mh):this.widgets_start_y!=null?Lh[1]=Math.max(Lh[1],Mh+this.widgets_start_y):Lh[1]+=Mh,this.constructor.min_height&&Lh[1]<this.constructor.min_height&&(Lh[1]=this.constructor.min_height),Lh[1]+=6,Lh},getBounding($h=new Float32Array(4),Lh){const Sh=this.pos,Eh=this.flags.collapsed,Gh=this.size;let Ah=0,Ph=1,Nh=0,Mh=0;return Lh&&(Ah=4,Ph=6+Ah,Nh=4,Mh=5+Nh),$h[0]=Sh[0]-Ah,$h[1]=Sh[1]-LiteGraph$9.NODE_TITLE_HEIGHT-Nh,$h[2]=Eh?(this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH)+Ph:Gh[0]+Ph,$h[3]=Eh?LiteGraph$9.NODE_TITLE_HEIGHT+Mh:Gh[1]+LiteGraph$9.NODE_TITLE_HEIGHT+Mh,this.onBounding&&this.onBounding($h),$h},isPointInside($h,Lh,Sh=0,Eh){var Gh=this.graph&&this.graph.isLive()?0:LiteGraph$9.NODE_TITLE_HEIGHT;if(Eh&&(Gh=0),this.flags&&this.flags.collapsed){if(LiteGraph$9.isInsideRectangle($h,Lh,this.pos[0]-Sh,this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT-Sh,(this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH)+2*Sh,LiteGraph$9.NODE_TITLE_HEIGHT+2*Sh))return!0}else if(this.pos[0]-4-Sh<$h&&this.pos[0]+this.size[0]+4+Sh>$h&&this.pos[1]-Gh-Sh<Lh&&this.pos[1]+this.size[1]+Sh>Lh)return!0;return!1},getConnectionPos($h,Lh,Sh=new Float32Array(2)){var Eh=0;$h&&this.inputs&&(Eh=this.inputs.length),!$h&&this.outputs&&(Eh=this.outputs.length);var Gh=LiteGraph$9.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var Ah=this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH;return this.horizontal?(Sh[0]=this.pos[0]+Ah*.5,$h?Sh[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT:Sh[1]=this.pos[1]):($h?Sh[0]=this.pos[0]:Sh[0]=this.pos[0]+Ah,Sh[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT*.5),Sh}return $h&&Lh==-1?(Sh[0]=this.pos[0]+LiteGraph$9.NODE_TITLE_HEIGHT*.5,Sh[1]=this.pos[1]+LiteGraph$9.NODE_TITLE_HEIGHT*.5,Sh):$h&&Eh>Lh&&this.inputs[Lh].pos?(Sh[0]=this.pos[0]+this.inputs[Lh].pos[0],Sh[1]=this.pos[1]+this.inputs[Lh].pos[1],Sh):!$h&&Eh>Lh&&this.outputs[Lh].pos?(Sh[0]=this.pos[0]+this.outputs[Lh].pos[0],Sh[1]=this.pos[1]+this.outputs[Lh].pos[1],Sh):this.horizontal?(Sh[0]=this.pos[0]+(Lh+.5)*(this.size[0]/Eh),$h?Sh[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT:Sh[1]=this.pos[1]+this.size[1],Sh):($h?Sh[0]=this.pos[0]+Gh:Sh[0]=this.pos[0]+this.size[0]+1-Gh,Sh[1]=this.pos[1]+(Lh+.7)*LiteGraph$9.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),Sh)},localToScreen($h,Lh,Sh){return[($h+this.pos[0])*Sh.scale+Sh.offset[0],(Lh+this.pos[1])*Sh.scale+Sh.offset[1]]}};let LiteGraph$8=null;function setCanvasIntegrationMethodsLiteGraph($h){LiteGraph$8=$h}const canvasIntegrationMethods={trace($h){var Lh,Sh,Eh,Gh;this.console||(this.console=[]),(Sh=(Lh=this.console).push)==null||Sh.call(Lh,$h),this.console.length>this.constructor.MAX_CONSOLE&&((Gh=(Eh=this.console).shift)==null||Gh.call(Eh)),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,$h)},setDirtyCanvas($h,Lh){this.graph&&this.graph.sendActionToCanvas("setDirty",[$h,Lh])},loadImage($h){var Lh=new Image;Lh.src=LiteGraph$8.node_images_path+$h,Lh.ready=!1;var Sh=this;return Lh.onload=function(){this.ready=!0,Sh.setDirtyCanvas(!0)},Lh},captureInput($h){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var Lh=this.graph.list_of_graphcanvas,Sh=0;Sh<Lh.length;++Sh){var Eh=Lh[Sh];!$h&&Eh.node_capturing_input!=this||(Eh.node_capturing_input=$h?this:null)}},collapse($h){this.graph.onGraphChanged({action:"collapse"}),!(this.constructor.collapsable===!1&&!$h)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},pin($h){this.graph.onGraphChanged({action:"pin"}),$h===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=$h}};let LiteGraph$7=null;function setAncestorRefreshMethodsLiteGraph($h){LiteGraph$7=$h}const ancestorRefreshMethods={refreshAncestors($h={}){var Lh={action:"",param:null,options:null,passParam:!0},Sh=Object.assign(Lh,$h);if(this.inputs&&!(LiteGraph$7.preventAncestorRecalculation&&this.graph.node_ancestorsCalculated&&this.graph.node_ancestorsCalculated[this.id])){(!Sh.action||Sh.action=="")&&(Sh.action=this.id+"_ancestors"),(!Sh.param||Sh.param=="")&&(Sh.param=this.id+"_ancestors"),Sh.options||(Sh.options={}),Sh.options=Object.assign({action_call:Sh.action},Sh.options),this.graph.ancestorsCall=!0;var Eh={modesSkip:[LiteGraph$7.NEVER,LiteGraph$7.ON_EVENT,LiteGraph$7.ON_TRIGGER],modesOnly:[LiteGraph$7.ALWAYS,LiteGraph$7.ON_REQUEST],typesSkip:[LiteGraph$7.ACTION],typesOnly:[]},Gh=this.graph.getAncestors(this,Eh);for(iN in Gh)Gh[iN].doExecute(Sh.param,Sh.options),this.graph.node_ancestorsCalculated[Gh[iN].id]=!0;return this.graph.ancestorsCall=!1,this.graph.node_ancestorsCalculated[this.id]=!0,!0}}};let LiteGraph$6=null;function setMiscMethodsLiteGraph($h){LiteGraph$6=$h}const miscMethods={alignToGrid(){this.pos[0]=LiteGraph$6.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph$6.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph$6.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph$6.CANVAS_GRID_SIZE)}};function installLGraphNodeDelegates($h,Lh){setLifecycleSerializationMethodsLiteGraph(Lh),setPropertiesWidgetsMethodsLiteGraph(Lh),setExecutionActionsMethodsLiteGraph(Lh),setSlotsMutationMethodsLiteGraph(Lh),setSlotsQueryMethodsLiteGraph(Lh),setConnectionsMethodsLiteGraph(Lh),setGeometryHitMethodsLiteGraph(Lh),setCanvasIntegrationMethodsLiteGraph(Lh),setAncestorRefreshMethodsLiteGraph(Lh),setMiscMethodsLiteGraph(Lh),[lifecycleSerializationMethods,propertiesWidgetsMethods,ioDataMethods,executionActionsMethods,slotsMutationMethods,slotsQueryMethods,connectionsMethods,geometryHitMethods,canvasIntegrationMethods,ancestorRefreshMethods,miscMethods].forEach(Sh=>{Object.entries(Sh).forEach(([Eh,Gh])=>{Object.defineProperty($h.prototype,Eh,{value:Gh,writable:!0,configurable:!0})})})}class LGraphNode{constructor(Lh="Unnamed"){this.title=Lh,this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}}set pos(Lh){var Sh;!Lh||Lh.length<2||((Sh=this._pos)!=null||(this._pos=new Float32Array(10,10)),this._pos[0]=Lh[0],this._pos[1]=Lh[1])}get pos(){return this._pos}}function setupLGraphNodeDelegates($h=LiteGraph){installLGraphNodeDelegates(LGraphNode,$h)}class LGraphGroup{constructor(Lh="Group"){Kl(this,"isPointInside",LiteGraph.LGraphNode.prototype.isPointInside),Kl(this,"setDirtyCanvas",LiteGraph.LGraphNode.prototype.setDirtyCanvas);var Sh,Eh;this.title=Lh,this.font_size=24,this.color=(Eh=(Sh=LiteGraph.LGraphCanvas.node_colors.pale_blue)==null?void 0:Sh.groupcolor)!=null?Eh:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null}set pos(Lh){!Lh||Lh.length<2||(this._pos[0]=Lh[0],this._pos[1]=Lh[1])}get pos(){return this._pos}set size(Lh){!Lh||Lh.length<2||(this._size[0]=Math.max(140,Lh[0]),this._size[1]=Math.max(80,Lh[1]))}get size(){return this._size}configure(Lh){this.title=Lh.title,this._bounding.set(Lh.bounding),this.color=Lh.color,Lh.font_size&&(this.font_size=Lh.font_size)}serialize(){var Lh=this._bounding;return{title:this.title,bounding:Lh.map(Sh=>Math.round(Sh)),color:this.color,font_size:this.font_size}}move(Lh,Sh,Eh){var Gh,Ah;isNaN(Lh)&&((Gh=console.error)==null||Gh.call(console,"LGraphGroup.move() deltax NaN")),isNaN(Sh)&&((Ah=console.error)==null||Ah.call(console,"LGraphGroup.move() deltay NaN")),this._pos[0]+=Lh,this._pos[1]+=Sh,!Eh&&this._nodes.forEach(Ph=>{Ph.pos[0]+=Lh,Ph.pos[1]+=Sh})}recomputeInsideNodes(){this._nodes.length=0;var Lh=this.graph._nodes,Sh=new Float32Array(4);this._nodes=Lh.filter(Eh=>(Eh.getBounding(Sh),LiteGraph.overlapBounding(this._bounding,Sh)))}}function applyRenderContextCompatAliases($h){if(!$h||typeof $h!="object")return $h;const Lh="imageSmoothingEnabled"in $h,Sh="mozImageSmoothingEnabled"in $h;return Lh&&!Sh&&Object.defineProperty($h,"mozImageSmoothingEnabled",{enumerable:!1,configurable:!0,get(){return $h.imageSmoothingEnabled},set(Eh){$h.imageSmoothingEnabled=Eh}}),$h}class Canvas2DSurface{constructor(Lh,Sh=null){this.canvas=Lh,this._context=Sh}getContextCompat(){var Lh;return!this._context&&(Lh=this.canvas)!=null&&Lh.getContext&&(this._context=this.canvas.getContext("2d")),applyRenderContextCompatAliases(this._context)}resize(Lh,Sh){this.canvas&&(this.canvas.width=Lh,this.canvas.height=Sh)}}class LeaferSurface{constructor(Lh){var Sh;this.leaferCanvas=Lh,this.canvas=(Sh=Lh==null?void 0:Lh.view)!=null?Sh:null}getContextCompat(){var Lh,Sh;const Eh=(Sh=(Lh=this.leaferCanvas)==null?void 0:Lh.context)!=null?Sh:null;return applyRenderContextCompatAliases(Eh)}resize(Lh,Sh){var Eh,Gh;if(this.leaferCanvas){if(typeof this.leaferCanvas.resize=="function"){const Ah={width:Lh,height:Sh};typeof this.leaferCanvas.pixelRatio=="number"&&(Ah.pixelRatio=this.leaferCanvas.pixelRatio),this.leaferCanvas.resize(Ah)}else this.canvas&&(this.canvas.width=Lh,this.canvas.height=Sh);this.canvas=(Gh=(Eh=this.leaferCanvas)==null?void 0:Eh.view)!=null?Gh:this.canvas}}}class Canvas2DRendererAdapter{constructor(){this.ownerDocument=null,this.frontSurface=null,this.backSurface=null}init({canvas:Lh,ownerDocument:Sh}){var Eh,Gh;this.ownerDocument=(Eh=Sh!=null?Sh:Lh==null?void 0:Lh.ownerDocument)!=null?Eh:null,this.frontSurface=new Canvas2DSurface(Lh);const Ah=(Gh=this.ownerDocument)!=null&&Gh.createElement?this.ownerDocument.createElement("canvas"):document.createElement("canvas");return Ah.width=Lh.width,Ah.height=Lh.height,this.backSurface=new Canvas2DSurface(Ah),this.getFrontCtx(),this.getBackCtx(),this}destroy(){this.frontSurface=null,this.backSurface=null}resize(Lh,Sh){var Eh,Gh;(Eh=this.frontSurface)==null||Eh.resize(Lh,Sh),(Gh=this.backSurface)==null||Gh.resize(Lh,Sh)}beginFrame(Lh){}endFrame(Lh){}getFrontCtx(){var Lh,Sh;return(Sh=(Lh=this.frontSurface)==null?void 0:Lh.getContextCompat())!=null?Sh:null}getBackCtx(){var Lh,Sh;return(Sh=(Lh=this.backSurface)==null?void 0:Lh.getContextCompat())!=null?Sh:null}getFrontSurface(){return this.frontSurface}getBackSurface(){return this.backSurface}blitBackToFront(Lh=this.getFrontCtx()){var Sh,Eh;const Gh=(Sh=this.frontSurface)==null?void 0:Sh.canvas,Ah=(Eh=this.backSurface)==null?void 0:Eh.canvas;!Lh||!Gh||!Ah||Ah===Gh||Lh.drawImage(Ah,0,0)}adoptExternalContexts({frontCanvas:Lh,backCanvas:Sh,frontContext:Eh,backContext:Gh}){this.frontSurface=new Canvas2DSurface(Lh,Eh),this.backSurface=new Canvas2DSurface(Sh,Gh),this.getFrontCtx(),this.getBackCtx()}}function resolveLeaferRuntime($h){var Lh,Sh;return(Sh=(Lh=$h==null?void 0:$h.leaferRuntime)!=null?Lh:globalThis.LeaferUI)!=null?Sh:null}function ensureLeaferCanvasRuntime($h){const Lh=$h==null?void 0:$h.LeaferCanvas;if(typeof Lh!="function")throw new Error("LeaferUI runtime is not available. Provide options.leaferRuntime or set globalThis.LeaferUI.");return Lh}function createCanvasElement($h,Lh){if($h!=null&&$h.createElement)return $h.createElement("canvas");if(typeof document!="undefined"&&document.createElement)return document.createElement("canvas");if(Lh)return Lh;throw new Error("Unable to create canvas element for Leafer surface.")}function createLeaferCanvas($h,Lh,Sh,Eh,Gh){return new $h({view:Lh,width:Sh,height:Eh,hittable:Gh})}class LeaferUIRendererAdapter{constructor(Lh={}){this.options={mode:"hybrid-back",nodeRenderMode:"legacy-ctx",nodeRenderLogs:!1,enableLogs:!0,logPrefix:"[LiteGraph][LeaferAdapter]",...Lh},this.ownerDocument=null,this.mode=this.options.mode||"hybrid-back",this.frontSurface=null,this.backSurface=null,this._frontLeaferCanvas=null,this._backLeaferCanvas=null}getLeaferRuntime(){return resolveLeaferRuntime(this.options)}_log(Lh,Sh,Eh){var Gh,Ah;if(!((Gh=this.options)!=null&&Gh.enableLogs))return;const Ph=(console==null?void 0:console[Lh])||(console==null?void 0:console.log);if(!Ph)return;const Nh=((Ah=this.options)==null?void 0:Ah.logPrefix)||"[LiteGraph][LeaferAdapter]";if(Eh!==void 0){Ph(`${Nh} ${Sh}`,Eh);return}Ph(`${Nh} ${Sh}`)}init({canvas:Lh,ownerDocument:Sh}){var Eh,Gh,Ah,Ph;const Nh=(Eh=this.options)!=null&&Eh.leaferRuntime?"options.leaferRuntime":"globalThis.LeaferUI";this._log("info","init start",{mode:this.options.mode||"hybrid-back",runtimeSource:Nh}),this.destroy(),this.ownerDocument=(Gh=Sh!=null?Sh:Lh==null?void 0:Lh.ownerDocument)!=null?Gh:null,this.mode=this.options.mode||"hybrid-back";const Mh=this.getLeaferRuntime(),Dh=ensureLeaferCanvasRuntime(Mh),Fh=Lh.width,Ih=Lh.height;this.mode==="full-leafer"?(this._frontLeaferCanvas=createLeaferCanvas(Dh,Lh,Fh,Ih,!0),this.frontSurface=new LeaferSurface(this._frontLeaferCanvas),this._log("info","front surface created with LeaferCanvas",{width:Fh,height:Ih})):(this.frontSurface=new Canvas2DSurface(Lh),this._log("info","front surface created with Canvas2D (hybrid mode)",{width:Fh,height:Ih}));const Hh=createCanvasElement(this.ownerDocument,Lh);return Hh.width=Fh,Hh.height=Ih,this._backLeaferCanvas=createLeaferCanvas(Dh,Hh,Fh,Ih,!1),this.backSurface=new LeaferSurface(this._backLeaferCanvas),this._log("info","back surface created with LeaferCanvas",{width:Fh,height:Ih}),this.getFrontCtx(),this.getBackCtx(),this._log("info","init complete",{mode:this.mode,frontCanvasShared:((Ah=this.frontSurface)==null?void 0:Ah.canvas)===Lh,backCanvasShared:((Ph=this.backSurface)==null?void 0:Ph.canvas)===Lh}),this}destroy(){var Lh,Sh,Eh,Gh;const Ah=!!this._frontLeaferCanvas,Ph=!!this._backLeaferCanvas;(Sh=(Lh=this._frontLeaferCanvas)==null?void 0:Lh.destroy)==null||Sh.call(Lh),(Gh=(Eh=this._backLeaferCanvas)==null?void 0:Eh.destroy)==null||Gh.call(Eh),this._frontLeaferCanvas=null,this._backLeaferCanvas=null,this.frontSurface=null,this.backSurface=null,(Ah||Ph)&&this._log("info","destroy complete",{destroyedFrontLeafer:Ah,destroyedBackLeafer:Ph})}resize(Lh,Sh){var Eh,Gh;(Eh=this.frontSurface)==null||Eh.resize(Lh,Sh),(Gh=this.backSurface)==null||Gh.resize(Lh,Sh),this._log("info","resize",{width:Lh,height:Sh,mode:this.mode})}beginFrame(Lh){}endFrame(Lh){}isLayerNative(Lh){return Lh==="front"?this.mode==="full-leafer":!0}syncLayer(Lh){}getFrontCtx(){var Lh,Sh,Eh;return applyRenderContextCompatAliases((Eh=(Sh=(Lh=this.frontSurface)==null?void 0:Lh.getContextCompat)==null?void 0:Sh.call(Lh))!=null?Eh:null)}getBackCtx(){var Lh,Sh,Eh;return applyRenderContextCompatAliases((Eh=(Sh=(Lh=this.backSurface)==null?void 0:Lh.getContextCompat)==null?void 0:Sh.call(Lh))!=null?Eh:null)}getFrontSurface(){return this.frontSurface}getBackSurface(){return this.backSurface}blitBackToFront(Lh=this.getFrontCtx()){var Sh,Eh;const Gh=(Sh=this.frontSurface)==null?void 0:Sh.canvas,Ah=(Eh=this.backSurface)==null?void 0:Eh.canvas;!Lh||!Gh||!Ah||Ah===Gh||typeof Lh.drawImage=="function"&&Lh.drawImage(Ah,0,0)}adoptExternalContexts({frontCanvas:Lh,backCanvas:Sh,frontContext:Eh,backContext:Gh}){this._log("warn","adopting external contexts (legacy/webgl interoperability path)"),this.destroy(),this.mode="external",this.frontSurface=new Canvas2DSurface(Lh,Eh),this.backSurface=new Canvas2DSurface(Sh,Gh),this.getFrontCtx(),this.getBackCtx(),this._log("info","external contexts adopted",{sharedCanvas:Lh===Sh})}}function createLegacyModeRuntime($h="legacy-default"){return{form:"legacy",strategy:"legacy",capabilities:{frontNative:!1,backNative:!1,forceLegacyNodeCtx:!0,useCompatBridge:!1},fallbackPolicy:{nodeLevelLegacyFallback:!0,markNodeErrorOnFailure:!0},source:$h}}function createLeaferModeRuntime($h="full-leafer",Lh="leafer-default"){return{form:"leafer",strategy:$h,capabilities:{frontNative:$h==="full-leafer",backNative:!0,forceLegacyNodeCtx:$h==="hybrid-back",useCompatBridge:!1},fallbackPolicy:{nodeLevelLegacyFallback:!0,markNodeErrorOnFailure:!0},source:Lh}}function createHybridModeRuntime($h="hybrid-default"){return createLeaferModeRuntime("hybrid-back",$h)}function createDecoupledCompatModeRuntime($h="decoupled-compat-default"){return{form:"leafer",strategy:"decoupled-compat",capabilities:{frontNative:!0,backNative:!0,forceLegacyNodeCtx:!1,useCompatBridge:!0},fallbackPolicy:{nodeLevelLegacyFallback:!0,markNodeErrorOnFailure:!0},source:$h}}function normalizeRenderForm($h){return $h==="legacy"||$h==="leafer"?$h:null}function normalizeRenderStrategy($h){return $h==="legacy"||$h==="hybrid-back"||$h==="full-leafer"||$h==="decoupled-compat"?$h:null}function resolveFromLegacyFields($h){var Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih;const Hh=((Eh=(Sh=(Lh=$h==null?void 0:$h.options)==null?void 0:Lh.rendererAdapter)==null?void 0:Sh.options)==null?void 0:Eh.mode)||((Ah=(Gh=$h==null?void 0:$h.rendererAdapter)==null?void 0:Gh.options)==null?void 0:Ah.mode)||null;if(Hh==="hybrid-back")return{form:"leafer",strategy:"hybrid-back",source:"legacy:adapter-mode"};if(Hh==="full-leafer")return{form:"leafer",strategy:"full-leafer",source:"legacy:adapter-mode"};const Wh=(Mh=(Nh=(Ph=$h==null?void 0:$h.options)==null?void 0:Ph.renderStyleEngine)!=null?Nh:$h==null?void 0:$h.renderStyleEngine)!=null?Mh:"legacy",zh=(Ih=(Fh=(Dh=$h==null?void 0:$h.options)==null?void 0:Dh.renderStyleProfile)!=null?Fh:$h==null?void 0:$h.renderStyleProfile)!=null?Ih:"legacy";return Wh==="leafer-components"||String(zh).startsWith("leafer-")?{form:"leafer",strategy:"full-leafer",source:"legacy:style"}:{form:"legacy",strategy:"legacy",source:"legacy:default"}}function resolveRenderMode($h){var Lh,Sh,Eh,Gh;const Ah=normalizeRenderForm((Sh=(Lh=$h==null?void 0:$h.options)==null?void 0:Lh.renderForm)!=null?Sh:$h==null?void 0:$h.renderForm),Ph=normalizeRenderStrategy((Gh=(Eh=$h==null?void 0:$h.options)==null?void 0:Eh.renderStrategy)!=null?Gh:$h==null?void 0:$h.renderStrategy);let Nh,Mh,Dh="new-fields";if(Ah||Ph)Nh=Ah!=null?Ah:Ph==="legacy"?"legacy":"leafer",Mh=Ph!=null?Ph:Nh==="legacy"?"legacy":"full-leafer";else{const Fh=resolveFromLegacyFields($h);Nh=Fh.form,Mh=Fh.strategy,Dh=Fh.source}return Nh==="legacy"||Mh==="legacy"?createLegacyModeRuntime(Dh):Mh==="hybrid-back"?createHybridModeRuntime(Dh):Mh==="decoupled-compat"?createDecoupledCompatModeRuntime(Dh):createLeaferModeRuntime("full-leafer",Dh)}function resolveRendererAdapter($h,Lh){var Sh,Eh,Gh,Ah;const Ph=()=>{var Fh;const Ih=(Lh==null?void 0:Lh.strategy)==="hybrid-back"?"hybrid-back":"full-leafer",Hh=(Lh==null?void 0:Lh.strategy)==="decoupled-compat"?"uiapi-components":(Fh=Lh==null?void 0:Lh.capabilities)!=null&&Fh.forceLegacyNodeCtx?"legacy-ctx":"uiapi-parity";return{mode:Ih,nodeRenderMode:Hh}},Nh=((Sh=$h==null?void 0:$h.options)==null?void 0:Sh.renderForm)!=null||((Eh=$h==null?void 0:$h.options)==null?void 0:Eh.renderStrategy)!=null,Mh=(Ah=(Gh=$h.options)==null?void 0:Gh.rendererAdapter)!=null?Ah:$h.rendererAdapter;if(Nh&&(Lh==null?void 0:Lh.form)==="legacy")return new Canvas2DRendererAdapter;if(!Mh){if((Lh==null?void 0:Lh.form)==="leafer"){const{mode:Fh,nodeRenderMode:Ih}=Ph();return new LeaferUIRendererAdapter({mode:Fh,nodeRenderMode:Ih})}return new Canvas2DRendererAdapter}const Dh=typeof Mh=="function"?new Mh:Mh;if(Nh&&(Lh==null?void 0:Lh.form)==="leafer"&&Dh instanceof Canvas2DRendererAdapter){const{mode:Fh,nodeRenderMode:Ih}=Ph();return new LeaferUIRendererAdapter({mode:Fh,nodeRenderMode:Ih})}return Dh}function clear(){var $h;this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.low_quality_rendering_counter=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),($h=this.onClear)==null||$h.call(this)}function setGraph($h,Lh){var Sh;if(this.graph!=$h){if(Lh||this.clear(),!$h){(Sh=this.graph)==null||Sh.detachCanvas(this);return}$h.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}}function getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}function openSubgraph($h){if(!$h)throw new Error("graph cannot be null");if(this.graph==$h)throw new Error("graph cannot be the same");this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),$h.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)}function closeSubgraph(){if(!(!this._graph_stack||this._graph_stack.length==0)){var $h=this.graph._subgraph_node,Lh=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},Lh.attachCanvas(this),this.setDirty(!0,!0),$h&&(this.centerOnNode($h),this.selectNodes([$h])),this.ds.offset=[0,0],this.ds.scale=1}}function getCurrentGraph(){return this.graph}function setCanvas($h,Lh){var Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh,Uh,Yh,Xh,jh,qh,Kh,Zh,il,Jh,Qh,el,nl,Vh,sl,rl,ol,ll;if(this._renderModeRuntime=resolveRenderMode(this),this.renderForm=this._renderModeRuntime.form,this.renderStrategy=this._renderModeRuntime.strategy,this.renderStyleProfile=((Sh=this.options)==null?void 0:Sh.renderStyleProfile)||this.renderStyleProfile||"legacy",this.renderStyleEngine=((Eh=this.options)==null?void 0:Eh.renderStyleEngine)||this.renderStyleEngine||(this.renderStyleProfile==="legacy"?"legacy":"leafer-components"),$h&&$h.constructor===String&&($h=document.getElementById($h),!$h))throw new Error("Error creating LiteGraph canvas: Canvas not found");if($h!==this.canvas){if(!$h&&this.canvas&&(Lh||this.unbindEvents()),this.rendererAdapter&&this.canvas&&$h!==this.canvas&&((Ah=(Gh=this.rendererAdapter).destroy)==null||Ah.call(Gh)),this.canvas=$h,!$h){this.ctx=null,this.bgctx=null,this.bgcanvas=null,this.frontSurface=null,this.backSurface=null,this.ds.element=null;return}if($h.className+=" lgraphcanvas",$h.data=this,$h.tabindex="1",$h.getContext==null)throw $h.localName!="canvas"?new Error("Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+$h.localName):new Error("This browser doesn't support Canvas");this.rendererAdapter=resolveRendererAdapter(this,this._renderModeRuntime);try{(Nh=(Ph=this.rendererAdapter).init)==null||Nh.call(Ph,{canvas:$h,ownerDocument:$h.ownerDocument})}catch(cl){(Mh=LiteGraph.warn)==null||Mh.call(LiteGraph,"[RenderMode] Renderer adapter init failed. Falling back to Canvas2D.",cl),this.rendererAdapter=new Canvas2DRendererAdapter,(Fh=(Dh=this.rendererAdapter).init)==null||Fh.call(Dh,{canvas:$h,ownerDocument:$h.ownerDocument}),this._renderModeRuntime=createLegacyModeRuntime("adapter-init-fallback"),this.renderForm=this._renderModeRuntime.form,this.renderStrategy=this._renderModeRuntime.strategy}this.frontSurface=(Wh=(Hh=(Ih=this.rendererAdapter).getFrontSurface)==null?void 0:Hh.call(Ih))!=null?Wh:null,this.backSurface=(Yh=(Uh=(zh=this.rendererAdapter).getBackSurface)==null?void 0:Uh.call(zh))!=null?Yh:null,this.canvas=((Xh=this.frontSurface)==null?void 0:Xh.canvas)||$h,this.bgcanvas=((jh=this.backSurface)==null?void 0:jh.canvas)||this.canvas,this.ds.element=this.canvas;var ul=this.ctx=(Qh=(Jh=(Kh=(qh=this.rendererAdapter).getFrontCtx)==null?void 0:Kh.call(qh))!=null?Jh:(il=(Zh=this.frontSurface)==null?void 0:Zh.getContextCompat)==null?void 0:il.call(Zh))!=null?Qh:null;this.bgctx=(ol=(rl=(nl=(el=this.rendererAdapter).getBackCtx)==null?void 0:nl.call(el))!=null?rl:(sl=(Vh=this.backSurface)==null?void 0:Vh.getContextCompat)==null?void 0:sl.call(Vh))!=null?ol:ul,ul==null&&($h.webgl_enabled||(ll=LiteGraph.info)==null||ll.call(LiteGraph,"This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),Lh||this.bindEvents()}}function _doNothing($h){return $h.preventDefault(),!1}function _doReturnTrue($h){return $h.preventDefault(),!0}function bindEvents(){var $h;if(this._events_binded){($h=LiteGraph.warn)==null||$h.call(LiteGraph,"LGraphCanvas: events already binded");return}this._events_binded=!0;var Lh=this.canvas,Sh=this.getCanvasWindow(),Eh=Sh.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),Lh.addEventListener("pointerdown",this._mousedown_callback,!0),Lh.addEventListener("pointermove",this._mousemove_callback),Lh.addEventListener("pointerup",this._mouseup_callback,!0),Lh.addEventListener("contextmenu",this._doNothing),Lh.addEventListener("wheel",this.processMouseWheel),Lh.addEventListener("keydown",this.processKey),Eh.addEventListener("keyup",this.processKey),Lh.addEventListener("dragover",this._doNothing,!1),Lh.addEventListener("dragend",this._doNothing,!1),Lh.addEventListener("drop",this.processDrop),Lh.addEventListener("dragenter",this._doReturnTrue,!1)}function unbindEvents(){var $h;if(!this._events_binded){($h=LiteGraph.warn)==null||$h.call(LiteGraph,"LGraphCanvas: no events binded");return}this._events_binded=!1;var Lh=this.canvas,Sh=this.getCanvasWindow(),Eh=Sh.document;Lh.removeEventListener("pointerdown",this._mousedown_callback),Lh.removeEventListener("pointermove",this._mousemove_callback),Lh.removeEventListener("pointerup",this._mouseup_callback),Lh.removeEventListener("contextmenu",this._doNothing),Lh.removeEventListener("wheel",this.processMouseWheel),Lh.removeEventListener("keydown",this.processKey),Eh.removeEventListener("keyup",this.processKey),Lh.removeEventListener("dragover",this._doNothing,!1),Lh.removeEventListener("dragend",this._doNothing,!1),Lh.removeEventListener("drop",this.processDrop),Lh.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null}function enableWebGL(){var $h,Lh;if(typeof GL=="undefined")throw new Error("litegl.js must be included to use a WebGL canvas");if(typeof enableWebGLCanvas=="undefined")throw new Error("webglCanvas.js must be included to use this feature");this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.frontSurface={canvas:this.canvas,getContextCompat:()=>this.ctx,resize:(Sh,Eh)=>{this.canvas.width=Sh,this.canvas.height=Eh}},this.backSurface=this.frontSurface,(Lh=($h=this.rendererAdapter)==null?void 0:$h.adoptExternalContexts)==null||Lh.call($h,{frontCanvas:this.canvas,backCanvas:this.canvas,frontContext:this.ctx,backContext:this.bgctx}),this.canvas.webgl_enabled=!0}function setDirty($h,Lh){$h&&(this.dirty_canvas=!0),Lh&&(this.dirty_bgcanvas=!0)}function getCanvasWindow(){var $h;if(!this.canvas)return window;var Lh=this.canvas.ownerDocument;return($h=Lh.defaultView)!=null?$h:Lh.parentWindow}function startRendering(){if(this.is_rendering)return;this.is_rendering=!0,$h.call(this);function $h(){this.pause_rendering||this.draw();var Lh=this.getCanvasWindow();this.is_rendering&&Lh.requestAnimationFrame($h.bind(this))}}function stopRendering(){this.is_rendering=!1}function resize($h,Lh){var Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh,Uh,Yh,Xh,jh,qh,Kh,Zh,il,Jh;if(!$h&&!Lh){var Qh=this.canvas.parentNode;$h=Qh.offsetWidth,Lh=Qh.offsetHeight}const el=((Sh=this.frontSurface)==null?void 0:Sh.canvas)||this.canvas;el.width==$h&&el.height==Lh||((Eh=this.rendererAdapter)!=null&&Eh.resize?(this.rendererAdapter.resize($h,Lh),this.frontSurface=(Ph=(Ah=(Gh=this.rendererAdapter).getFrontSurface)==null?void 0:Ah.call(Gh))!=null?Ph:this.frontSurface,this.backSurface=(Dh=(Mh=(Nh=this.rendererAdapter).getBackSurface)==null?void 0:Mh.call(Nh))!=null?Dh:this.backSurface,this.canvas=((Fh=this.frontSurface)==null?void 0:Fh.canvas)||this.canvas,this.bgcanvas=((Ih=this.backSurface)==null?void 0:Ih.canvas)||this.bgcanvas,this.ctx=(Xh=(Yh=(Wh=(Hh=this.rendererAdapter).getFrontCtx)==null?void 0:Wh.call(Hh))!=null?Yh:(Uh=(zh=this.frontSurface)==null?void 0:zh.getContextCompat)==null?void 0:Uh.call(zh))!=null?Xh:this.ctx,this.bgctx=(Jh=(il=(qh=(jh=this.rendererAdapter).getBackCtx)==null?void 0:qh.call(jh))!=null?il:(Zh=(Kh=this.backSurface)==null?void 0:Kh.getContextCompat)==null?void 0:Zh.call(Kh))!=null?Jh:this.bgctx,this.ds.element=this.canvas):(this.canvas.width=$h,this.canvas.height=Lh,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),this.setDirty(!0,!0))}function switchLiveMode($h){if(!$h){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var Lh=this,Sh=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var Eh=setInterval(function(){Lh.editor_alpha*=Sh,Lh.dirty_canvas=!0,Lh.dirty_bgcanvas=!0,Sh<1&&Lh.editor_alpha<.01&&(clearInterval(Eh),Sh<1&&(Lh.live_mode=!0)),Sh>1&&Lh.editor_alpha>.99&&(clearInterval(Eh),Lh.editor_alpha=1)},1)}function centerOnNode($h){this.ds.offset[0]=-$h.pos[0]-$h.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-$h.pos[1]-$h.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)}function adjustMouseEvent($h){var Lh=0,Sh=0;if(this.canvas){var Eh=this.canvas.getBoundingClientRect();Lh=$h.clientX-Eh.left,Sh=$h.clientY-Eh.top}else Lh=$h.clientX,Sh=$h.clientY;this.last_mouse_position[0]=Lh,this.last_mouse_position[1]=Sh,$h.canvasX=Lh/this.ds.scale-this.ds.offset[0],$h.canvasY=Sh/this.ds.scale-this.ds.offset[1]}function setZoom($h,Lh){this.ds.changeScale($h,Lh),this.dirty_canvas=!0,this.dirty_bgcanvas=!0}function convertOffsetToCanvas($h,Lh){return this.ds.convertOffsetToCanvas($h,Lh)}function convertCanvasToOffset($h,Lh){return this.ds.convertCanvasToOffset($h,Lh)}function convertEventToCanvasOffset($h){var Lh=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([$h.clientX-Lh.left,$h.clientY-Lh.top])}const temp=new Float32Array(4),temp_vec2=new Float32Array(2),tmp_area=new Float32Array(4),margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);function isOverNodeBox($h,Lh,Sh){var Eh=LiteGraph.NODE_TITLE_HEIGHT;return!!LiteGraph.isInsideRectangle(Lh,Sh,$h.pos[0]+2,$h.pos[1]+2-Eh,Eh-4,Eh-4)}function isOverNodeInput($h,Lh,Sh,Eh){if($h.inputs)for(let Ph=0,Nh=$h.inputs.length;Ph<Nh;++Ph){var Gh=$h.getConnectionPos(!0,Ph),Ah=!1;if($h.horizontal?Ah=LiteGraph.isInsideRectangle(Lh,Sh,Gh[0]-5,Gh[1]-10,10,20):Ah=LiteGraph.isInsideRectangle(Lh,Sh,Gh[0]-10,Gh[1]-5,40,10),Ah)return Eh&&(Eh[0]=Gh[0],Eh[1]=Gh[1]),Ph}return-1}function isOverNodeOutput($h,Lh,Sh,Eh){if($h.outputs)for(let Ph=0,Nh=$h.outputs.length;Ph<Nh;++Ph){var Gh=$h.getConnectionPos(!1,Ph),Ah=!1;if($h.horizontal?Ah=LiteGraph.isInsideRectangle(Lh,Sh,Gh[0]-5,Gh[1]-10,10,20):Ah=LiteGraph.isInsideRectangle(Lh,Sh,Gh[0]-10,Gh[1]-5,40,10),Ah)return Eh&&(Eh[0]=Gh[0],Eh[1]=Gh[1]),Ph}return-1}function bringToFront($h){var Lh=this.graph._nodes.indexOf($h);Lh!=-1&&(this.graph._nodes.splice(Lh,1),this.graph._nodes.push($h))}function sendToBack($h){var Lh=this.graph._nodes.indexOf($h);Lh!=-1&&(this.graph._nodes.splice(Lh,1),this.graph._nodes.unshift($h))}function computeVisibleNodes($h,Lh){var Sh=Lh||[];Sh.length=0,$h=$h||this.graph._nodes;for(var Eh=0,Gh=$h.length;Eh<Gh;++Eh){var Ah=$h[Eh];this.live_mode&&!Ah.onDrawBackground&&!Ah.onDrawForeground||LiteGraph.overlapBounding(this.visible_area,Ah.getBounding(temp,!0))&&Sh.push(Ah)}return Sh}class CoreController{constructor(Lh){this.host=Lh}clear(...Lh){return clear.apply(this.host,Lh)}setGraph(...Lh){return setGraph.apply(this.host,Lh)}getTopGraph(...Lh){return getTopGraph.apply(this.host,Lh)}openSubgraph(...Lh){return openSubgraph.apply(this.host,Lh)}closeSubgraph(...Lh){return closeSubgraph.apply(this.host,Lh)}getCurrentGraph(...Lh){return getCurrentGraph.apply(this.host,Lh)}setCanvas(...Lh){return setCanvas.apply(this.host,Lh)}_doNothing(...Lh){return _doNothing.apply(this.host,Lh)}_doReturnTrue(...Lh){return _doReturnTrue.apply(this.host,Lh)}bindEvents(...Lh){return bindEvents.apply(this.host,Lh)}unbindEvents(...Lh){return unbindEvents.apply(this.host,Lh)}enableWebGL(...Lh){return enableWebGL.apply(this.host,Lh)}setDirty(...Lh){return setDirty.apply(this.host,Lh)}getCanvasWindow(...Lh){return getCanvasWindow.apply(this.host,Lh)}startRendering(...Lh){return startRendering.apply(this.host,Lh)}stopRendering(...Lh){return stopRendering.apply(this.host,Lh)}resize(...Lh){return resize.apply(this.host,Lh)}switchLiveMode(...Lh){return switchLiveMode.apply(this.host,Lh)}centerOnNode(...Lh){return centerOnNode.apply(this.host,Lh)}adjustMouseEvent(...Lh){return adjustMouseEvent.apply(this.host,Lh)}setZoom(...Lh){return setZoom.apply(this.host,Lh)}convertOffsetToCanvas(...Lh){return convertOffsetToCanvas.apply(this.host,Lh)}convertCanvasToOffset(...Lh){return convertCanvasToOffset.apply(this.host,Lh)}convertEventToCanvasOffset(...Lh){return convertEventToCanvasOffset.apply(this.host,Lh)}isOverNodeBox(...Lh){return isOverNodeBox.apply(this.host,Lh)}isOverNodeInput(...Lh){return isOverNodeInput.apply(this.host,Lh)}isOverNodeOutput(...Lh){return isOverNodeOutput.apply(this.host,Lh)}bringToFront(...Lh){return bringToFront.apply(this.host,Lh)}sendToBack(...Lh){return sendToBack.apply(this.host,Lh)}computeVisibleNodes(...Lh){return computeVisibleNodes.apply(this.host,Lh)}}function processUserInputDown($h){var Lh,Sh;if(this.pointer_is_down&&$h.isPrimary!==void 0&&!$h.isPrimary?this.userInput_isNotPrimary=!0:this.userInput_isNotPrimary=!1,this.userInput_type=$h.pointerType?$h.pointerType:!1,this.userInput_id=$h.pointerId?$h.pointerId:!1,$h.pointerType)switch($h.pointerType){case"mouse":break;case"pen":break;case"touch":break;default:(Lh=LiteGraph.log)==null||Lh.call(LiteGraph,"pointerType unknown "+ev.pointerType)}return $h.button!==void 0&&(this.userInput_button=$h.button,$h.button),$h.buttons!==void 0&&(this.userInput_button_s=$h.buttons),this.userInput_touches=$h.changedTouches!==void 0&&$h.changedTouches.length!==void 0?$h.changedTouches:!1,this.userInput_touches&&this.userInput_touches.length&&((Sh=LiteGraph.debug)==null||Sh.call(LiteGraph,"check multiTouches",$h.changedTouches)),this.processMouseDown($h)}function processMouseDown($h){var Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent($h);var Fh=this.getCanvasWindow();LGraphCanvas.active_canvas=this;var Ih=$h.clientX,Hh=$h.clientY;(Lh=LiteGraph.log)==null||Lh.call(LiteGraph,"pointerevents: processMouseDown pointerId:"+$h.pointerId+" which:"+$h.which+" isPrimary:"+$h.isPrimary+" :: x y "+Ih+" "+Hh,"previousClick",this.last_mouseclick,"diffTimeClick",this.last_mouseclick?LiteGraph.getTime()-this.last_mouseclick:"notlast"),this.ds.viewport=this.viewport;var Wh=!this.viewport||this.viewport&&Ih>=this.viewport[0]&&Ih<this.viewport[0]+this.viewport[2]&&Hh>=this.viewport[1]&&Hh<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(this.canvas.removeEventListener("pointermove",this._mousemove_callback),Fh.document.addEventListener("pointermove",this._mousemove_callback,!0),Fh.document.addEventListener("pointerup",this._mouseup_callback,!0)),!!Wh){var zh=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes,5),Uh=!1,Yh=LiteGraph.getTime(),Xh=$h.isPrimary===void 0||$h.isPrimary,jh=Yh-this.last_mouseclick<300&&Xh;if(this.mouse[0]=$h.clientX,this.mouse[1]=$h.clientY,this.graph_mouse[0]=$h.canvasX,this.graph_mouse[1]=$h.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&Xh?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.ContextMenu.closeAll(Fh),!((Sh=this.onMouse)!=null&&Sh.call(this,$h))){if($h.which==1&&!this.userInput_isNotPrimary){if($h.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=$h.canvasX,this.dragging_rectangle[1]=$h.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,Uh=!0),LiteGraph.alt_drag_do_clone_nodes&&$h.altKey&&zh&&this.allow_interaction&&!Uh&&!this.read_only){let al=zh,fl=zh.clone();if(fl){if(fl.pos[0]+=5,fl.pos[1]+=5,this.graph.add(fl,!1,{doCalcSize:!1}),zh=fl,LiteGraph.alt_shift_drag_connect_clone_with_input&&$h.shiftKey&&al.inputs&&al.inputs.length)for(var qh=0;qh<al.inputs.length;++qh){var Kh=al.inputs[qh];if(!(!Kh||Kh.link==null)){var Zh=this.graph.links[Kh.link];if(Zh&&Zh.type!==LiteGraph.EVENT){var il;Zh.origin_id&&(il=this.graph.getNodeById(Zh.origin_id));var Jh=zh;il&&Jh&&il.connect(Zh.origin_slot,Jh,Zh.target_slot)}}}Uh=!0,nl||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=zh),this.selected_nodes[zh.id]||this.processNodeSelected(zh,$h))}}var Qh=!1;if(zh&&(this.allow_interaction||zh.flags.allow_interaction)&&!Uh&&!this.read_only){if(!this.live_mode&&!zh.flags.pinned&&this.bringToFront(zh),this.allow_interaction&&!this.connecting_node&&!zh.flags.collapsed&&!this.live_mode)if(!Uh&&zh.resizable!==!1&&LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,zh.pos[0]+zh.size[0]-5,zh.pos[1]+zh.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=zh,this.canvas.style.cursor="se-resize",Uh=!0;else{if(zh.outputs)for(let al=0,fl=zh.outputs.length;al<fl;++al){let vl=zh.outputs[al],gl=zh.getConnectionPos(!1,al);if(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,gl[0]-15,gl[1]-10,30,20)){this.connecting_node=zh,this.connecting_output=vl,this.connecting_output.slot_index=al,this.connecting_pos=zh.getConnectionPos(!1,al),this.connecting_slot=al,LiteGraph.shift_click_do_break_link_from&&$h.shiftKey&&zh.disconnectOutput(al),jh?(Eh=zh.onOutputDblClick)==null||Eh.call(zh,al,$h):(Gh=zh.onOutputClick)==null||Gh.call(zh,al,$h),Uh=!0;break}}if(zh.inputs)for(let al=0,fl=zh.inputs.length;al<fl;++al){let vl=zh.inputs[al],gl=zh.getConnectionPos(!0,al);if(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,gl[0]-15,gl[1]-10,30,20)){if(jh?(Ah=zh.onInputDblClick)==null||Ah.call(zh,al,$h):(Ph=zh.onInputClick)==null||Ph.call(zh,al,$h),vl.link!==null){var el=this.graph.links[vl.link];LiteGraph.click_do_break_link_to&&(zh.disconnectInput(al),this.dirty_bgcanvas=!0,Uh=!0),$h.shiftKey&&(LiteGraph.click_do_break_link_to||zh.disconnectInput(al),this.connecting_node=this.graph._nodes_by_id[el.origin_id],this.connecting_slot=el.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,Uh=!0)}Uh||(this.connecting_node=zh,this.connecting_input=vl,this.connecting_input.slot_index=al,this.connecting_pos=zh.getConnectionPos(!0,al),this.connecting_slot=al,this.dirty_bgcanvas=!0,Uh=!0)}}}if(!Uh){var nl=!1,Vh=[$h.canvasX-zh.pos[0],$h.canvasY-zh.pos[1]],sl=this.processNodeWidgets(zh,this.graph_mouse,$h);sl&&(nl=!0,this.node_widget=[zh,sl]),this.allow_interaction&&jh&&this.selected_nodes[zh.id]&&((Nh=zh.onDblClick)==null||Nh.call(zh,$h,Vh,this),this.processNodeDblClicked(zh),nl=!0),zh.onMouseDown&&zh.onMouseDown($h,Vh,this)?nl=!0:(zh.subgraph&&!zh.skip_subgraph_button&&!zh.flags.collapsed&&Vh[0]>zh.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&Vh[1]<0&&setTimeout(()=>{this.openSubgraph(zh.subgraph)},10),this.live_mode&&(Qh=!0,nl=!0)),nl?zh.is_selected||this.processNodeSelected(zh,$h):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=zh),this.processNodeSelected(zh,$h)),this.dirty_canvas=!0}}else if(!Uh){if(!this.read_only)for(let al=0;al<this.visible_links.length;++al){var rl=this.visible_links[al],ol=rl._pos;if(!(!ol||$h.canvasX<ol[0]-4||$h.canvasX>ol[0]+4||$h.canvasY<ol[1]-4||$h.canvasY>ol[1]+4)){this.showLinkMenu(rl,$h),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos($h.canvasX,$h.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){$h.ctrlKey&&(this.dragging_rectangle=null);var ll=LiteGraph.distance([$h.canvasX,$h.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);ll*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}jh&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox($h),$h.preventDefault(),$h.stopPropagation()),(Mh=LiteGraph.debug)==null||Mh.call(LiteGraph,"DEBUG canvas click is_double_click,this.allow_searchbox",jh,this.allow_searchbox),Qh=!0}!Uh&&Qh&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if($h.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(zh&&this.allow_interaction&&!Uh&&!this.read_only&&!this.connecting_node&&!zh.flags.collapsed&&!this.live_mode){var ul=!1,cl=!1,dl=!1;if(zh.outputs)for(let al=0,fl=zh.outputs.length;al<fl;++al){var _l=zh.outputs[al];let vl=zh.getConnectionPos(!1,al);if(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,vl[0]-15,vl[1]-10,30,20)){ul=_l,cl=al,dl=!0;break}}if(zh.inputs)for(let al=0,fl=zh.inputs.length;al<fl;++al){var Kh=zh.inputs[al];let gl=zh.getConnectionPos(!0,al);if(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,gl[0]-15,gl[1]-10,30,20)){ul=Kh,cl=al,dl=!1;break}}if(ul&&cl!==!1){var pl=.5-(cl+1)/(dl?zh.outputs.length:zh.inputs.length),yl=zh.getBounding(),hl=[dl?yl[0]+yl[2]:yl[0],$h.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:dl?zh:null,slotFrom:dl?cl:null,nodeTo:dl?null:zh,slotTo:dl?null:cl,position:hl,nodeType:"AUTO",posAdd:[dl?30:-30,-pl*130],posSizeFix:[dl?0:-1,0]})}}}else!Uh&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else($h.which==3||LiteGraph.two_fingers_opens_menu&&this.userInput_isNotPrimary)&&this.allow_interaction&&!Uh&&!this.read_only&&(zh&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[zh.id]||$h.shiftKey||$h.ctrlKey||$h.metaKey)?this.selected_nodes[zh.id]||this.selectNodes([zh],!0):this.selectNodes([zh])),this.processContextMenu(zh,$h));return this.last_mouse[0]=$h.clientX,this.last_mouse[1]=$h.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!Fh.document.activeElement||Fh.document.activeElement.nodeName.toLowerCase()!="input"&&Fh.document.activeElement.nodeName.toLowerCase()!="textarea")&&$h.preventDefault(),$h.stopPropagation(),(Dh=this.onMouseDown)==null||Dh.call(this,$h),!1}}}}function processMouseMove($h){var Lh,Sh;if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent($h);var Eh=[$h.clientX,$h.clientY];this.mouse[0]=Eh[0],this.mouse[1]=Eh[1];var Gh=[Eh[0]-this.last_mouse[0],Eh[1]-this.last_mouse[1]];if(this.last_mouse=Eh,this.graph_mouse[0]=$h.canvasX,this.graph_mouse[1]=$h.canvasY,this.block_click)return $h.preventDefault(),!1;$h.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,$h,this.node_widget[1]),this.dirty_canvas=!0);var Ah=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=$h.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=$h.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[$h.canvasX-this.selected_group.pos[0],$h.canvasY-this.selected_group.pos[1]];else{var Ph=Gh[0]/this.ds.scale,Nh=Gh[1]/this.ds.scale;this.selected_group.move(Ph,Nh,$h.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=Gh[0]/this.ds.scale,this.ds.offset[1]+=Gh[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||Ah&&Ah.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(let Wh=0,zh=this.graph._nodes.length;Wh<zh;++Wh)this.graph._nodes[Wh].mouseOver&&Ah!=this.graph._nodes[Wh]&&(this.graph._nodes[Wh].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave($h),this.node_over=null,this.dirty_canvas=!0);if(Ah){if(Ah.redraw_on_mouse&&(this.dirty_canvas=!0),Ah.mouseOver||(Ah.mouseOver=!0,this.node_over=Ah,this.dirty_canvas=!0,(Lh=Ah.onMouseEnter)==null||Lh.call(Ah,$h)),(Sh=Ah.onMouseMove)==null||Sh.call(Ah,$h,[$h.canvasX-Ah.pos[0],$h.canvasY-Ah.pos[1]],this),this.connecting_node){let Wh;if(this.connecting_output){if(Wh=this._highlight_input||[0,0],!this.isOverNodeBox(Ah,$h.canvasX,$h.canvasY)){let zh=this.isOverNodeInput(Ah,$h.canvasX,$h.canvasY,Wh);if(zh!=-1&&Ah.inputs[zh]){let Uh=Ah.inputs[zh].type;LiteGraph.isValidConnection(this.connecting_output.type,Uh)&&(this._highlight_input=Wh,this._highlight_input_slot=Ah.inputs[zh])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input&&(Wh=this._highlight_output||[0,0],this.isOverNodeBox(Ah,$h.canvasX,$h.canvasY))){let zh=this.isOverNodeOutput(Ah,$h.canvasX,$h.canvasY,Wh);if(zh!=-1&&Ah.outputs[zh]){let Uh=Ah.outputs[zh].type;LiteGraph.isValidConnection(this.connecting_input.type,Uh)&&(this._highlight_output=Wh)}else this._highlight_output=null}}this.canvas&&(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,Ah.pos[0]+Ah.size[0]-5,Ah.pos[1]+Ah.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var Mh=null;for(let Wh=0;Wh<this.visible_links.length;++Wh){var Dh=this.visible_links[Wh],Fh=Dh._pos;if(!(!Fh||$h.canvasX<Fh[0]-4||$h.canvasX>Fh[0]+4||$h.canvasY<Fh[1]-4||$h.canvasY>Fh[1]+4)){Mh=Dh;break}}Mh!=this.over_link_center&&(this.over_link_center=Mh,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=Ah&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove($h,[$h.canvasX-this.node_capturing_input.pos[0],$h.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(let Wh in this.selected_nodes){let zh=this.selected_nodes[Wh];zh.pos[0]+=Gh[0]/this.ds.scale,zh.pos[1]+=Gh[1]/this.ds.scale,zh.is_selected||this.processNodeSelected(zh,$h)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var Ih=[$h.canvasX-this.resizing_node.pos[0],$h.canvasY-this.resizing_node.pos[1]],Hh=this.resizing_node.computeSize();Ih[0]=Math.max(Hh[0],Ih[0]),Ih[1]=Math.max(Hh[1],Ih[1]),this.resizing_node.setSize(Ih),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return $h.preventDefault(),!1}}function processMouseUp($h){var Lh,Sh=$h.isPrimary===void 0||$h.isPrimary;if(!Sh)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var Eh=this.getCanvasWindow(),Gh=Eh.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(Gh.removeEventListener("pointermove",this._mousemove_callback,!0),this.canvas.addEventListener("pointermove",this._mousemove_callback,!0),Gh.removeEventListener("pointerup",this._mouseup_callback,!0)),this.adjustMouseEvent($h);var Ah=LiteGraph.getTime();if($h.click_time=Ah-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),$h.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,$h),this.node_widget=null,this.selected_group){var Ph=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),Nh=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(Ph,Nh,$h.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var Mh=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var Dh=this.graph._nodes,Fh=new Float32Array(4),Ih=Math.abs(this.dragging_rectangle[2]),Hh=Math.abs(this.dragging_rectangle[3]),Wh=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-Ih:this.dragging_rectangle[0],zh=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-Hh:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=Wh,this.dragging_rectangle[1]=zh,this.dragging_rectangle[2]=Ih,this.dragging_rectangle[3]=Hh,!Mh||Ih>10&&Hh>10){var Uh=[];for(let qh=0;qh<Dh.length;++qh){var Yh=Dh[qh];Yh.getBounding(Fh),LiteGraph.overlapBounding(this.dragging_rectangle,Fh)&&Uh.push(Yh)}Uh.length&&this.selectNodes(Uh,$h.shiftKey)}else this.selectNodes([Mh],$h.shiftKey||$h.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var Xh=this.connecting_output||this.connecting_input,jh=Xh.type;if(Mh=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes),Mh){let qh;this.connecting_output?(qh=this.isOverNodeInput(Mh,$h.canvasX,$h.canvasY),qh!=-1?this.connecting_node.connect(this.connecting_slot,Mh,qh):this.connecting_node.connectByType(this.connecting_slot,Mh,jh)):this.connecting_input&&(qh=this.isOverNodeOutput(Mh,$h.canvasX,$h.canvasY),qh!=-1?Mh.connect(qh,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,Mh,jh))}else LiteGraph.release_link_on_empty_shows_menu&&($h.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox($h,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox($h,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:$h}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:$h}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null):this.node_dragged?(Mh=this.node_dragged,Mh&&$h.click_time<300&&LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,Mh.pos[0],Mh.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&Mh.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),(Lh=this.onNodeMoved)==null||Lh.call(this,this.node_dragged),this.graph.onGraphChanged({action:"nodeDrag",doSave:!0}),this.graph.afterChange(this.node_dragged),this.node_dragged=null):(Mh=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes),!Mh&&$h.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp($h,[$h.canvasX-this.node_over.pos[0],$h.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp($h,[$h.canvasX-this.node_capturing_input.pos[0],$h.canvasY-this.node_capturing_input.pos[1]]))}else $h.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):$h.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return Sh&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),$h.stopPropagation(),$h.preventDefault(),!1}}function processMouseWheel($h){if(!(!this.graph||!this.allow_dragcanvas)){var Lh=$h.wheelDeltaY!=null?$h.wheelDeltaY:$h.detail*-60;this.adjustMouseEvent($h);var Sh=$h.clientX,Eh=$h.clientY,Gh=!this.viewport||this.viewport&&Sh>=this.viewport[0]&&Sh<this.viewport[0]+this.viewport[2]&&Eh>=this.viewport[1]&&Eh<this.viewport[1]+this.viewport[3];if(Gh){var Ah=this.ds.scale;return Ah*=Math.pow(1.1,Lh*.01),this.ds.changeScale(Ah,[$h.clientX,$h.clientY]),this.graph.change(),$h.preventDefault(),!1}}}function blockClick(){this.block_click=!0,this.last_mouseclick=0}function processKey($h){var Lh,Sh,Eh,Gh,Ah;if(this.graph){var Ph=!1;if($h.target.localName!="input"){if($h.type=="keydown"){if($h.keyCode==32&&(this.dragging_canvas=!0,Ph=!0),$h.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),Ph=!0),$h.keyCode==65&&$h.ctrlKey&&(this.selectNodes(),Ph=!0),$h.keyCode===67&&($h.metaKey||$h.ctrlKey)&&!$h.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),Ph=!0),$h.keyCode===86&&($h.metaKey||$h.ctrlKey)&&this.pasteFromClipboard($h.shiftKey),($h.keyCode==46||LiteGraph.backspace_delete&&$h.keyCode==8)&&$h.target.localName!="input"&&$h.target.localName!="textarea"&&(this.deleteSelectedNodes(),Ph=!0),LiteGraph.actionHistory_enabled&&($h.keyCode==89&&$h.ctrlKey||$h.keyCode==90&&$h.ctrlKey&&$h.shiftKey?this.graph.actionHistoryForward():$h.keyCode==90&&$h.ctrlKey&&this.graph.actionHistoryBack()),(Lh=LiteGraph.debug)==null||Lh.call(LiteGraph,"Canvas keydown "+$h.keyCode),this.selected_nodes)for(let Nh in this.selected_nodes)(Eh=(Sh=this.selected_nodes[Nh]).onKeyDown)==null||Eh.call(Sh,$h)}else if($h.type=="keyup"&&($h.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(let Nh in this.selected_nodes)(Ah=(Gh=this.selected_nodes[Nh]).onKeyUp)==null||Ah.call(Gh,$h);if(this.graph.change(),Ph)return $h.preventDefault(),$h.stopImmediatePropagation(),!1}}}function processDrop($h){$h.preventDefault(),this.adjustMouseEvent($h);var Lh=$h.clientX,Sh=$h.clientY,Eh=!this.viewport||this.viewport&&Lh>=this.viewport[0]&&Lh<this.viewport[0]+this.viewport[2]&&Sh>=this.viewport[1]&&Sh<this.viewport[1]+this.viewport[3];if(Eh){Lh=$h.localX,Sh=$h.localY;var Eh=!this.viewport||this.viewport&&Lh>=this.viewport[0]&&Lh<this.viewport[0]+this.viewport[2]&&Sh>=this.viewport[1]&&Sh<this.viewport[1]+this.viewport[3];if(Eh){var Gh=[$h.canvasX,$h.canvasY],Ah=this.graph?this.graph.getNodeOnPos(Gh[0],Gh[1]):null;if(!Ah){var Ph=null;this.onDropItem&&(Ph=this.onDropItem(event)),Ph||this.checkDropItem($h);return}if(Ah.onDropFile||Ah.onDropData){var Nh=$h.dataTransfer.files;if(Nh&&Nh.length)for(let Wh=0;Wh<Nh.length;Wh++){var Mh=$h.dataTransfer.files[0],Dh=Mh.name;if(Ah.onDropFile&&Ah.onDropFile(Mh),Ah.onDropData){var Fh=new FileReader;Fh.onload=function(zh){var Uh=zh.target.result;Ah.onDropData(Uh,Dh,Mh)};var Ih=Mh.type.split("/")[0];Ih=="text"||Ih==""?Fh.readAsText(Mh):Ih=="image"?Fh.readAsDataURL(Mh):Fh.readAsArrayBuffer(Mh)}}}return Ah.onDropItem&&Ah.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}}}function checkDropItem($h){var Lh;if($h.dataTransfer.files.length){var Sh=$h.dataTransfer.files[0],Eh=LGraphCanvas.getFileExtension(Sh.name).toLowerCase(),Gh=LiteGraph.node_types_by_file_extension[Eh];if(Gh){this.graph.beforeChange();var Ah=LiteGraph.createNode(Gh.type);Ah.pos=[$h.canvasX,$h.canvasY],this.graph.add(Ah,!1,{doProcessChange:!1}),(Lh=Ah.onDropFile)==null||Lh.call(Ah,Sh),this.graph.onGraphChanged({action:"fileDrop",doSave:!0}),this.graph.afterChange()}}}class EventsController{constructor(Lh){this.host=Lh}processUserInputDown(...Lh){return processUserInputDown.apply(this.host,Lh)}processMouseDown(...Lh){return processMouseDown.apply(this.host,Lh)}processMouseMove(...Lh){return processMouseMove.apply(this.host,Lh)}processMouseUp(...Lh){return processMouseUp.apply(this.host,Lh)}processMouseWheel(...Lh){return processMouseWheel.apply(this.host,Lh)}blockClick(...Lh){return blockClick.apply(this.host,Lh)}processKey(...Lh){return processKey.apply(this.host,Lh)}processDrop(...Lh){return processDrop.apply(this.host,Lh)}checkDropItem(...Lh){return checkDropItem.apply(this.host,Lh)}}function nowMs$1(){return typeof performance!="undefined"&&typeof performance.now=="function"?performance.now():Date.now()}function getLayerFlags($h){var Lh;return($h==null?void 0:$h.leaferLayerFlags)||((Lh=$h==null?void 0:$h.options)==null?void 0:Lh.leaferLayerFlags)||{}}function isFullLeaferMode($h){const Lh=$h==null?void 0:$h._renderModeRuntime;return!(!Lh||Lh.form!=="leafer"||Lh.strategy!=="full-leafer")}function shouldUseLeaferLayer($h,Lh){var Sh,Eh,Gh,Ah;return!isFullLeaferMode($h)||getLayerFlags($h)[Lh]===!1?!1:Lh==="back"||Lh==="link"?((Eh=(Sh=$h==null?void 0:$h.rendererAdapter)==null?void 0:Sh.isLayerNative)==null?void 0:Eh.call(Sh,"back"))===!0:Lh==="overlay"||Lh==="panel"?((Ah=(Gh=$h==null?void 0:$h.rendererAdapter)==null?void 0:Gh.isLayerNative)==null?void 0:Ah.call(Gh,"front"))===!0:!0}function getLayerStats($h){return $h._leaferLayerStats||($h._leaferLayerStats={back:{calls:0,fallbackCalls:0,totalMs:0,errors:0},link:{calls:0,fallbackCalls:0,totalMs:0,errors:0},overlay:{calls:0,fallbackCalls:0,totalMs:0,errors:0},panel:{calls:0,fallbackCalls:0,totalMs:0,errors:0}}),$h._leaferLayerStats}function runLeaferLayerWithFallback($h){var Lh;const{host:Sh,layer:Eh,drawLeafer:Gh,drawFallback:Ah,errorMessage:Ph}=$h,Nh=getLayerStats(Sh)[Eh],Mh=nowMs$1();if(Nh.calls+=1,!shouldUseLeaferLayer(Sh,Eh)||typeof Gh!="function"){Nh.fallbackCalls+=1;const Dh=Ah();return Nh.totalMs+=nowMs$1()-Mh,Dh}try{const Dh=Gh();return Nh.totalMs+=nowMs$1()-Mh,Dh}catch(Dh){Nh.errors+=1,Nh.fallbackCalls+=1,(Lh=console.warn)==null||Lh.call(console,Ph,Dh);const Fh=Ah();return Nh.totalMs+=nowMs$1()-Mh,Fh}}function drawFrontOverlayWithLeaferLayer($h,Lh){runLeaferLayerWithFallback({host:$h,layer:"overlay",drawLeafer:Lh,drawFallback:Lh,errorMessage:"[LeaferOverlayLayer] render failed, fallback to legacy overlay."})}function draw($h,Lh){var Sh;const Eh=((Sh=this.frontSurface)==null?void 0:Sh.canvas)||this.canvas;if(!(!Eh||Eh.width==0||Eh.height==0)){var Gh=LiteGraph.getTime();this.render_time=(Gh-this.last_draw_time)*.001,this.last_draw_time=Gh,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||Lh||this.always_render_background||this.graph&&this.graph._last_trigger_time&&Gh-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas();var Ah=this.dirty_canvas||$h;if(Ah&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1,this.ds.scale<.7){if(Ah){var Ph=this.low_quality_rendering_threshold;const Nh=45;this.fps<Nh?(this.low_quality_rendering_counter+=Nh/this.fps,this.low_quality_rendering_counter=Math.min(this.low_quality_rendering_counter,2*Ph)):(this.low_quality_rendering_counter-=this.fps/Nh*.01,this.low_quality_rendering_counter=Math.max(this.low_quality_rendering_counter,0))}}else this.low_quality_rendering_counter=0}}function drawFrontCanvas(){var $h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh,Uh,Yh,Xh,jh,qh,Kh,Zh,il;this.dirty_canvas=!1;const Jh=($h=this.rendererAdapter)!=null?$h:null,Qh=(Lh=this._renderModeRuntime)!=null?Lh:null,el=(Gh=(Sh=Qh==null?void 0:Qh.capabilities)==null?void 0:Sh.frontNative)!=null?Gh:((Eh=Jh==null?void 0:Jh.isLayerNative)==null?void 0:Eh.call(Jh,"front"))===!0,nl=(Nh=(Ah=Qh==null?void 0:Qh.capabilities)==null?void 0:Ah.backNative)!=null?Nh:((Ph=Jh==null?void 0:Jh.isLayerNative)==null?void 0:Ph.call(Jh,"back"))===!0;this.ctx||(this.ctx=(Hh=(Ih=(Mh=Jh==null?void 0:Jh.getFrontCtx)==null?void 0:Mh.call(Jh))!=null?Ih:(Fh=(Dh=this.frontSurface)==null?void 0:Dh.getContextCompat)==null?void 0:Fh.call(Dh))!=null?Hh:null);var Vh=this.ctx;if(!Vh)return;(Wh=Jh==null?void 0:Jh.beginFrame)==null||Wh.call(Jh,"front");var sl=((zh=this.frontSurface)==null?void 0:zh.canvas)||this.canvas;Vh.start2D&&!this.viewport&&(Vh.start2D(),Vh.restore(),Vh.setTransform(1,0,0,1,0,0));var rl=this.viewport||this.dirty_area;rl&&(Vh.save(),Vh.beginPath(),Vh.rect(rl[0],rl[1],rl[2],rl[3]),Vh.clip()),this.clear_background&&(rl?Vh.clearRect(rl[0],rl[1],rl[2],rl[3]):Vh.clearRect(0,0,sl.width,sl.height));const ol=((Uh=this.backSurface)==null?void 0:Uh.canvas)||this.bgcanvas;if(ol==sl?this.drawBackCanvas():ol&&((el||nl)&&Jh!=null&&Jh.blitBackToFront?Jh.blitBackToFront(Vh):Vh.drawImage(ol,0,0)),(Yh=this.onRender)==null||Yh.call(this,sl,Vh),this.show_info&&this.renderInfo(Vh,rl?rl[0]:0,rl?rl[1]:0),this.graph){Vh.save(),this.ds.toCanvasContext(Vh);var ll=this.computeVisibleNodes(null,this.visible_nodes);const ul=(!Qh||Qh.form==="leafer"&&Qh.strategy!=="legacy")&&((Xh=this.beginNodeFrameLeafer)==null?void 0:Xh.call(this,Vh,ll))===!0;for(let cl=0;cl<ll.length;++cl){let dl=ll[cl];ul?this.drawNode(dl,Vh):(Vh.save(),Vh.translate(dl.pos[0],dl.pos[1]),this.drawNode(dl,Vh),Vh.restore())}ul&&(Vh.save(),Vh.setTransform(1,0,0,1,0,0),(jh=this.endNodeFrameLeafer)==null||jh.call(this,Vh,ll),Vh.restore()),drawFrontOverlayWithLeaferLayer(this,()=>{var cl,dl;if(this.render_execution_order&&this.drawExecutionOrder(Vh),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(Vh)),this.connecting_pos!=null){Vh.lineWidth=this.connections_width;var _l=null,pl=this.connecting_output||this.connecting_input,yl=pl.type,hl=pl.dir;hl==null&&(this.connecting_output?hl=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:hl=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var al=pl.shape;switch(yl){case LiteGraph.EVENT:case LiteGraph.ACTION:_l=LiteGraph.EVENT_LINK_COLOR;break;default:_l=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(Vh,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,_l,hl,LiteGraph.CENTER),Vh.beginPath(),yl===LiteGraph.EVENT||yl===LiteGraph.ACTION||al===LiteGraph.BOX_SHAPE?(Vh.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),Vh.fill(),Vh.beginPath(),Vh.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):al===LiteGraph.ARROW_SHAPE?(Vh.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),Vh.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),Vh.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),Vh.closePath()):(Vh.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),Vh.fill(),Vh.beginPath(),Vh.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),Vh.fill(),Vh.fillStyle="#ffcc00",this._highlight_input){Vh.beginPath();var fl=this._highlight_input_slot.shape;fl===LiteGraph.ARROW_SHAPE?(Vh.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),Vh.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),Vh.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),Vh.closePath()):Vh.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),Vh.fill()}this._highlight_output&&(Vh.beginPath(),fl===LiteGraph.ARROW_SHAPE?(Vh.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),Vh.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),Vh.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),Vh.closePath()):Vh.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),Vh.fill())}this.dragging_rectangle&&(Vh.strokeStyle="#FFF",Vh.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(Vh,this.over_link_center):(cl=this.onDrawLinkTooltip)==null||cl.call(this,Vh,null),(dl=this.onDrawForeground)==null||dl.call(this,Vh,this.visible_rect)}),Vh.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(Vh),(qh=this.onDrawOverlay)==null||qh.call(this,Vh),rl&&Vh.restore(),(Kh=Vh.finish2D)==null||Kh.call(Vh),(Zh=Jh==null?void 0:Jh.syncLayer)==null||Zh.call(Jh,"front"),(il=Jh==null?void 0:Jh.endFrame)==null||il.call(Jh,"front")}function lowQualityRenderingRequired($h){return this.ds.scale<$h?this.low_quality_rendering_counter>this.low_quality_rendering_threshold:!1}const CLASSIC_TOKENS=Object.freeze({radius:8,borderWidth:1,titleFontSize:14,bodyFontSize:12,smallFontSize:12,titleTextColor:"#AAAAAA",titleBg:"#333333",bodyBg:"#353535",bodyBorder:"#555555",slotInputColor:"#778",slotOutputColor:"#778",slotLabelColor:"#AAAAAA",tooltipBg:"#454545",tooltipBorder:"#222222",tooltipText:"#CECECE",widgetBg:"#222222",widgetBorder:"#666666",widgetText:"#DDDDDD",widgetSecondaryText:"#999999",widgetAccent:"#678",widgetAccentAlt:"#89A",widgetDanger:"#AA6666",widgetWarning:"#AA9",widgetSuccess:"#66AA88"}),PRAGMATIC_SLATE_TOKENS=Object.freeze({radius:6,borderWidth:1,titleFontSize:14,bodyFontSize:12,smallFontSize:11,titleTextColor:"#F1F5F9",titleBg:"#334155",bodyBg:"#1E293B",bodyBorder:"#334155",slotInputColor:"#22D3EE",slotOutputColor:"#38BDF8",slotLabelColor:"#D1D9E6",tooltipBg:"#0F172A",tooltipBorder:"#334155",tooltipText:"#E2E8F0",widgetBg:"#0F172A",widgetBorder:"#334155",widgetText:"#E2E8F0",widgetSecondaryText:"#94A3B8",widgetAccent:"#38BDF8",widgetAccentAlt:"#22D3EE",widgetDanger:"#FB7185",widgetWarning:"#F59E0B",widgetSuccess:"#34D399"});function createBodyShape($h,Lh,Sh,Eh,Gh,Ah=0){const{LiteGraph:Ph,shape:Nh,width:Mh,height:Dh,titleHeightScaled:Fh,renderTitle:Ih,showCollapsed:Hh,host:Wh,scale:zh}=Lh,Uh=Ih?-Fh:0,Yh=Hh?Fh:Ih?Dh+Fh:Dh,Xh=((Wh==null?void 0:Wh.round_radius)||Lh.tokens.radius)*zh,jh=-Ah,qh=Uh-Ah,Kh=Math.max(1,Mh+Ah*2),Zh=Math.max(1,Yh+Ah*2);return Nh===Ph.CIRCLE_SHAPE&&!Hh?$h("Ellipse",{x:jh,y:0-Ah,width:Math.max(1,Mh+Ah*2),height:Math.max(1,Dh+Ah*2),fill:Sh,stroke:Eh,strokeWidth:Gh,hittable:!1}):Nh===Ph.CARD_SHAPE&&!Hh?$h("Rect",{x:jh,y:qh,width:Kh,height:Zh,fill:Sh,stroke:Eh,strokeWidth:Gh,cornerRadius:[Xh,Xh,2*zh,2*zh],hittable:!1}):Nh===Ph.BOX_SHAPE||Lh.lowQuality?$h("Rect",{x:jh,y:qh,width:Kh,height:Zh,fill:Sh,stroke:Eh,strokeWidth:Gh,cornerRadius:0,hittable:!1}):$h("Rect",{x:jh,y:qh,width:Kh,height:Zh,fill:Sh,stroke:Eh,strokeWidth:Gh,cornerRadius:Hh?[Xh]:[Xh,Xh,Xh,Xh],hittable:!1})}function renderNodeShell($h){const{view:Lh,createUi:Sh,addChildren:Eh,clearChildren:Gh,LiteGraph:Ah,node:Ph,host:Nh,nodeColor:Mh,bgColor:Dh,selected:Fh,renderTitle:Ih,showCollapsed:Hh,scale:Wh,tokens:zh}=$h;Gh(Lh.bodyGroup);const Uh=Ph!=null&&Ph.has_errors?"#FF0000":Dh||zh.bodyBg,Yh=Mh||zh.bodyBorder,Xh=createBodyShape(Sh,$h,Uh,Yh,Math.max(1,((Nh==null?void 0:Nh.connections_width)||zh.borderWidth)*.33*Wh),0);if(Eh(Lh.bodyGroup,Xh),!Hh&&Ih){const jh=Sh("Rect",{x:0,y:-1*Wh,width:Math.max(1,$h.width),height:Math.max(1,2*Wh),fill:"rgba(0,0,0,0.2)",hittable:!1});Eh(Lh.bodyGroup,jh)}if(Fh){const jh=createBodyShape(Sh,$h,"transparent",Ah.NODE_BOX_OUTLINE_COLOR||"#FFFFFF",Math.max(1,Wh),6*Wh);Eh(Lh.bodyGroup,jh)}}function scaledFontSize($h,Lh){const Sh=Number.isFinite($h)?$h:12,Eh=Number.isFinite(Lh)?Math.max(.05,Lh):1;return Math.max(1,Sh*Eh)}function canvasBaselineToTextTop($h,Lh){return $h-Lh*.78}function widgetTextTop($h,Lh,Sh){return canvasBaselineToTextTop($h+Lh*.7,Sh)}function snapPixel($h){return Math.round($h*2)/2}function createLeaferText($h,{x:Lh,y:Sh,width:Eh,height:Gh,text:Ah,fill:Ph,fontSize:Nh,textAlign:Mh="left",verticalAlign:Dh="middle",textWrap:Fh="none",autoSizeAlign:Ih=!1,padding:Hh,lineHeight:Wh,fontFamily:zh="Arial",hittable:Uh=!1}){const Yh={x:snapPixel(Lh),y:snapPixel(Sh),text:Ah,fill:Ph,fontSize:Nh,textAlign:Mh,verticalAlign:Dh,textWrap:Fh,autoSizeAlign:Ih,fontFamily:zh,hittable:Uh};return Eh!=null&&(Yh.width=Math.max(1,Eh)),Gh!=null&&(Yh.height=Math.max(1,Gh)),Hh!=null&&(Yh.padding=Hh),Wh!=null&&(Yh.lineHeight=Wh),$h("Text",Yh)}function getTitleModeColor($h,Lh){var Sh;let Eh=!1;return Lh.node_box_coloured_by_mode&&(Sh=Lh.NODE_MODES_COLORS)!=null&&Sh[$h==null?void 0:$h.mode]&&(Eh=Lh.NODE_MODES_COLORS[$h.mode]),Lh.node_box_coloured_when_on&&(Eh=$h!=null&&$h.action_triggered?"#FFF":$h!=null&&$h.execute_triggered?"#AAA":Eh),Eh}function createTitleBox($h,Lh,Sh,Eh=null){const{titleHeightScaled:Gh,shape:Ah,LiteGraph:Ph,lowQuality:Nh,scale:Mh}=Lh,Dh=Math.max(8*Mh,10*Mh),Fh=Gh*.5-Dh*.5,Ih=-Gh*.5-Dh*.5;return Ah===Ph.ROUND_SHAPE||Ah===Ph.CIRCLE_SHAPE||Ah===Ph.CARD_SHAPE?$h("Ellipse",{x:Fh,y:Ih,width:Dh,height:Dh,fill:Sh,stroke:Eh||"transparent",strokeWidth:Nh?Math.max(1,Mh):0,hittable:!1}):$h("Rect",{x:Fh,y:Ih,width:Dh,height:Dh,fill:Sh,stroke:Eh||"transparent",strokeWidth:Nh?Math.max(1,Mh):0,cornerRadius:0,hittable:!1})}function renderNodeTitle($h){var Lh,Sh,Eh;const{view:Gh,createUi:Ah,addChildren:Ph,clearChildren:Nh,LiteGraph:Mh,width:Dh,titleHeightScaled:Fh,scale:Ih,host:Hh,title:Wh,nodeColor:zh,node:Uh,tokens:Yh,shape:Xh,titleMode:jh,renderTitle:qh,showCollapsed:Kh,lowQuality:Zh,selected:il}=$h;Nh(Gh.titleGroup);const Jh=jh===Mh.TRANSPARENT_TITLE;if(!qh&&!Jh)return;if(!Jh&&((Lh=Uh==null?void 0:Uh.constructor)!=null&&Lh.title_color||Hh!=null&&Hh.render_title_colored)){const nl=Ah("Rect",{x:0,y:-Fh,width:Dh,height:Fh,fill:((Sh=Uh==null?void 0:Uh.constructor)==null?void 0:Sh.title_color)||zh||Yh.titleBg,cornerRadius:Kh?[((Hh==null?void 0:Hh.round_radius)||Yh.radius)*Ih]:[((Hh==null?void 0:Hh.round_radius)||Yh.radius)*Ih,((Hh==null?void 0:Hh.round_radius)||Yh.radius)*Ih,0,0],hittable:!1});Ph(Gh.titleGroup,nl)}const Qh=(Uh==null?void 0:Uh.boxcolor)||getTitleModeColor(Uh,Mh)||Mh.NODE_DEFAULT_BOXCOLOR,el=createTitleBox(Ah,$h,Qh,Zh?"black":null);if(Ph(Gh.titleGroup,el),!Zh){const nl=Kh?String(Wh||"").substring(0,20):String(Wh||""),Vh=scaledFontSize(Yh.titleFontSize,Ih),sl=Ah("Text",{x:snapPixel(Fh),y:snapPixel(-Fh),width:Math.max(1,Dh-Fh-6*Ih),height:Math.max(1,Fh),text:nl,fill:il?Mh.NODE_SELECTED_TITLE_COLOR||"#FFF":((Eh=Uh==null?void 0:Uh.constructor)==null?void 0:Eh.title_text_color)||(Hh==null?void 0:Hh.node_title_color)||Yh.titleTextColor,fontSize:Vh,fontFamily:"Arial",textAlign:"left",verticalAlign:"middle",textWrap:"none",hittable:!1});Ph(Gh.titleGroup,sl)}}const SLOT_LABEL_X_OFFSET=10,SLOT_LABEL_CENTER_OFFSET=0,SLOT_LABEL_INPUT_VERTICAL_OFFSET=-10,SLOT_LABEL_OUTPUT_VERTICAL_OFFSET=-8;function estimateLabelWidth($h,Lh,Sh){const Eh=String($h!=null?$h:"").length*Lh*.62;return Math.max(18*Sh,Math.min(220*Sh,Eh+8*Sh))}function resolveSlotLabelPlacement($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh){const Dh=Sh?Mh.DOWN:Mh.UP,Fh=Ah||(Lh==null?void 0:Lh.dir)===Dh,Ih=Math.max(Nh*1.25,12*Ph);if(Fh){const Uh=Math.max(40*Ph,estimateLabelWidth($h,Nh,Ph)),Yh=Gh+(Sh?SLOT_LABEL_OUTPUT_VERTICAL_OFFSET:SLOT_LABEL_INPUT_VERTICAL_OFFSET)*Ph-Ih*.5;return{x:snapPixel(Eh-Uh*.5),y:snapPixel(Yh),width:Uh,height:Ih,textAlign:"center"}}const Hh=estimateLabelWidth($h,Nh,Ph),Wh=Sh?Eh-SLOT_LABEL_X_OFFSET*Ph-Hh:Eh+SLOT_LABEL_X_OFFSET*Ph,zh=Gh+SLOT_LABEL_CENTER_OFFSET*Ph-Ih*.5;return{x:snapPixel(Wh),y:snapPixel(zh),width:Hh,height:Ih,textAlign:Sh?"right":"left"}}function resolveSlotShape($h,Lh,Sh){return Lh==="array"?Sh.GRID_SHAPE:($h==null?void 0:$h.name)==="onTrigger"||($h==null?void 0:$h.name)==="onExecuted"?Sh.ARROW_SHAPE:Lh===Sh.EVENT||Lh===Sh.ACTION?Sh.BOX_SHAPE:($h==null?void 0:$h.shape)||Sh.CIRCLE_SHAPE}function createGridShape($h,Lh,Sh,Eh,Gh){const Ah=$h("Group",{hittable:!1}),Ph=3*Eh,Nh=Math.max(1,2*Eh);for(let Mh=-1;Mh<=1;Mh+=1)for(let Dh=-1;Dh<=1;Dh+=1)Ah.add($h("Rect",{x:Lh+Dh*Ph,y:Sh+Mh*Ph,width:Nh,height:Nh,fill:Gh,hittable:!1}));return Ah}function createInputArrowShape($h,Lh,Sh,Eh,Gh,Ah){return Eh?$h("Polygon",{points:[Lh+8*Gh,Sh,Lh-4*Gh,Sh+6*Gh,Lh-4*Gh,Sh-6*Gh],fill:Ah,hittable:!1}):$h("Polygon",{points:[Lh+8*Gh,Sh,Lh-4*Gh,Sh+6*Gh,Lh-4*Gh,Sh-6*Gh],fill:Ah,hittable:!1})}function createOutputArrowShape($h,Lh,Sh,Eh,Gh,Ah){return Eh?$h("Polygon",{points:[Lh-8*Gh,Sh,Lh+4*Gh,Sh+6*Gh,Lh+4*Gh,Sh-6*Gh],fill:Ah,hittable:!1}):$h("Polygon",{points:[Lh-8*Gh,Sh,Lh+4*Gh,Sh+6*Gh,Lh+4*Gh,Sh-6*Gh],fill:Ah,hittable:!1})}function createBoxShape($h,Lh,Sh,Eh,Gh,Ah){return $h("Rect",{x:Lh+(Eh?-5:-6)*Gh,y:Sh+(Eh?-8:-5)*Gh,width:(Eh?10:14)*Gh,height:(Eh?14:10)*Gh,fill:Ah,hittable:!1})}function createCircleShape($h,Lh,Sh,Eh,Gh,Ah){const Ph=4*Eh;return $h("Ellipse",{x:Lh-Ph,y:Sh-Ph,width:Ph*2,height:Ph*2,fill:Gh,hittable:!1})}function createSlotGraphic($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh){return Lh===Dh.BOX_SHAPE?createBoxShape($h,Sh,Eh,Gh,Ah,Ph):Lh===Dh.ARROW_SHAPE?Mh?createOutputArrowShape($h,Sh,Eh,Gh,Ah,Ph):createInputArrowShape($h,Sh,Eh,Gh,Ah,Ph):Lh===Dh.GRID_SHAPE?createGridShape($h,Sh,Eh,Ah,Ph):createCircleShape($h,Sh,Eh,Ah,Ph,Nh)}function renderCollapsedSlotIndicators($h){var Lh;const{view:Sh,createUi:Eh,addChildren:Gh,node:Ah,host:Ph,LiteGraph:Nh,tokens:Mh,shape:Dh,width:Fh,titleHeightScaled:Ih,scale:Hh}=$h;if(!(Ph!=null&&Ph.render_collapsed_slots))return;let Wh=null,zh=null;if(Array.isArray(Ah==null?void 0:Ah.inputs)&&(Wh=Ah.inputs.find(Xh=>(Xh==null?void 0:Xh.link)!=null)||null),Array.isArray(Ah==null?void 0:Ah.outputs))for(let Xh=0;Xh<Ah.outputs.length;Xh+=1)Array.isArray((Lh=Ah.outputs[Xh])==null?void 0:Lh.links)&&Ah.outputs[Xh].links.length&&(zh=Ah.outputs[Xh]);const Uh=Mh.slotInputColor||"#686",Yh=!!(Ah!=null&&Ah.horizontal);if(Wh){let Xh=0,jh=-Ih*.5;Yh&&(Xh=Fh*.5,jh=-Ih);const qh=Wh==null?void 0:Wh.type,Kh=resolveSlotShape(Wh,qh,Nh),Zh=createSlotGraphic(Eh,Kh,Xh,jh,Yh,Hh,Uh,!1,!1,Nh);Gh(Sh.slotsGroup,Zh)}if(zh){let Xh=Fh,jh=-Ih*.5;Yh&&(Xh=Fh*.5,jh=0);const qh=zh==null?void 0:zh.type,Kh=resolveSlotShape(zh,qh,Nh),Zh=createSlotGraphic(Eh,Kh,Xh,jh,Yh,Hh,Uh,!1,!0,Nh);Gh(Sh.slotsGroup,Zh)}}function renderNodeSlots($h){var Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh;const{view:Uh,createUi:Yh,addChildren:Xh,clearChildren:jh,node:qh,host:Kh,scale:Zh,showCollapsed:il,renderText:Jh,lowQuality:Qh,LiteGraph:el,tokens:nl}=$h;if(jh(Uh.slotsGroup),il){renderCollapsedSlotIndicators($h);return}const Vh=new Float32Array(2),sl=!!(qh!=null&&qh.horizontal);if(Array.isArray(qh==null?void 0:qh.inputs))for(let rl=0;rl<qh.inputs.length;rl+=1){const ol=qh.inputs[rl],ll=ol==null?void 0:ol.type,ul=String(ll!=null?ll:""),cl=resolveSlotShape(ol,ll,el),dl=((Lh=qh.getConnectionPos)==null?void 0:Lh.call(qh,!0,rl,Vh))||[qh.pos[0],qh.pos[1]],_l=(dl[0]-qh.pos[0])*Zh,pl=(dl[1]-qh.pos[1])*Zh,yl=Kh!=null&&Kh.connecting_output?el.isValidConnection(ol==null?void 0:ol.type,(Sh=Kh.connecting_output)==null?void 0:Sh.type):!0,hl=(ol==null?void 0:ol.link)!=null?(ol==null?void 0:ol.color_on)||((Eh=Kh==null?void 0:Kh.default_connection_color_byType)==null?void 0:Eh[ul])||((Gh=Kh==null?void 0:Kh.default_connection_color)==null?void 0:Gh.input_on)||nl.slotInputColor:(ol==null?void 0:ol.color_off)||((Ah=Kh==null?void 0:Kh.default_connection_color_byTypeOff)==null?void 0:Ah[ul])||((Ph=Kh==null?void 0:Kh.default_connection_color_byType)==null?void 0:Ph[ul])||((Nh=Kh==null?void 0:Kh.default_connection_color)==null?void 0:Nh.input_off)||nl.slotInputColor,al=createSlotGraphic(Yh,cl,_l,pl,sl,Zh,hl,Qh,!1,el);if(yl||(al.opacity=.4),Xh(Uh.slotsGroup,al),Jh&&(ol==null?void 0:ol.name)!=="onTrigger"&&(ol==null?void 0:ol.name)!=="onExecuted"){const fl=(ol==null?void 0:ol.label)!=null?ol.label:ol==null?void 0:ol.name;if(fl){const vl=scaledFontSize(nl.smallFontSize,Zh),gl=resolveSlotLabelPlacement(fl,ol,!1,_l,pl,sl,Zh,vl,el);Xh(Uh.slotsGroup,createLeaferText(Yh,{x:gl.x,y:gl.y,width:gl.width,height:gl.height,text:String(fl),fill:nl.slotLabelColor||el.NODE_TEXT_COLOR,fontSize:vl,textAlign:gl.textAlign,verticalAlign:"middle",textWrap:"none"}))}}}if(Array.isArray(qh==null?void 0:qh.outputs))for(let rl=0;rl<qh.outputs.length;rl+=1){const ol=qh.outputs[rl],ll=ol==null?void 0:ol.type,ul=String(ll!=null?ll:""),cl=resolveSlotShape(ol,ll,el),dl=((Mh=qh.getConnectionPos)==null?void 0:Mh.call(qh,!1,rl,Vh))||[qh.pos[0]+qh.size[0],qh.pos[1]],_l=(dl[0]-qh.pos[0])*Zh,pl=(dl[1]-qh.pos[1])*Zh,yl=Kh!=null&&Kh.connecting_input?el.isValidConnection(ll,(Dh=Kh.connecting_input)==null?void 0:Dh.type):!0,hl=Array.isArray(ol==null?void 0:ol.links)&&ol.links.length?(ol==null?void 0:ol.color_on)||((Fh=Kh==null?void 0:Kh.default_connection_color_byType)==null?void 0:Fh[ul])||((Ih=Kh==null?void 0:Kh.default_connection_color)==null?void 0:Ih.output_on)||nl.slotOutputColor:(ol==null?void 0:ol.color_off)||((Hh=Kh==null?void 0:Kh.default_connection_color_byTypeOff)==null?void 0:Hh[ul])||((Wh=Kh==null?void 0:Kh.default_connection_color_byType)==null?void 0:Wh[ul])||((zh=Kh==null?void 0:Kh.default_connection_color)==null?void 0:zh.output_off)||nl.slotOutputColor,al=createSlotGraphic(Yh,cl,_l,pl,sl,Zh,hl,Qh,!0,el);if(yl||(al.opacity=.4),Xh(Uh.slotsGroup,al),Jh&&(ol==null?void 0:ol.name)!=="onTrigger"&&(ol==null?void 0:ol.name)!=="onExecuted"){const fl=(ol==null?void 0:ol.label)!=null?ol.label:ol==null?void 0:ol.name;if(fl){const vl=scaledFontSize(nl.smallFontSize,Zh),gl=resolveSlotLabelPlacement(fl,ol,!0,_l,pl,sl,Zh,vl,el);Xh(Uh.slotsGroup,createLeaferText(Yh,{x:gl.x,y:gl.y,width:gl.width,height:gl.height,text:String(fl),fill:nl.slotLabelColor||el.NODE_TEXT_COLOR,fontSize:vl,textAlign:gl.textAlign,verticalAlign:"middle",textWrap:"none"}))}}}}function renderNodeTooltip($h){const{view:Lh,createUi:Sh,addChildren:Eh,clearChildren:Gh,host:Ah,width:Ph,scale:Nh,titleHeightScaled:Mh,tooltip:Dh,node:Fh,LiteGraph:Ih,tokens:Hh}=$h;if(Gh(Lh.tooltipGroup),!(Ih.show_node_tooltip&&(Fh!=null&&Fh.mouseOver)&&(Fh!=null&&Fh.is_selected)&&(!(Ah!=null&&Ah.selected_nodes)||Object.keys(Ah.selected_nodes).length<=1)&&Dh!==""))return;const Wh=Math.max(160*Nh,Math.min(Ph*1.2,320*Nh)),zh=26*Nh,Uh=Sh("Rect",{x:(Ph-Wh)*.5,y:-(Mh+zh+8*Nh),width:Wh,height:zh,fill:Hh.tooltipBg,stroke:Hh.tooltipBorder,strokeWidth:Math.max(1,Nh),cornerRadius:Math.max(3,4*Nh),hittable:!1}),Yh=scaledFontSize(Hh.bodyFontSize,Nh),Xh=Sh("Text",{x:snapPixel(Ph*.5),y:snapPixel(widgetTextTop(Uh.y,zh,Yh)),text:Dh.slice(0,120),fill:Hh.tooltipText,fontSize:Yh,textAlign:"center",textWrap:"none",hittable:!1}),jh=Sh("Polygon",{points:[Ph*.5-10*Nh,-Mh-8*Nh,Ph*.5+10*Nh,-Mh-8*Nh,Ph*.5,-Mh+2*Nh],fill:Hh.tooltipBg,stroke:Hh.tooltipBorder,strokeWidth:Math.max(1,Nh),hittable:!1});Eh(Lh.tooltipGroup,Uh,jh,Xh)}function renderWidgetButton($h){const{createUi:Lh,addChildren:Sh,view:Eh,widget:Gh,host:Ah,y:Ph,scale:Nh,width:Mh,tokens:Dh,showText:Fh}=$h,Ih=$h.widgetHeight,Hh=Ph*Nh,Wh=Ih*Nh,zh=(Gh.width||Mh)*Nh,Uh=15*Nh,Yh=Gh.label||Gh.name||"button",Xh=Lh("Rect",{x:Uh,y:Hh,width:Math.max(1,zh-Uh*2),height:Wh,fill:Gh.clicked?Dh.widgetAccent:Dh.widgetBg,stroke:Dh.widgetBorder,strokeWidth:Math.max(1,Nh),cornerRadius:Math.max(2,3*Nh),opacity:Gh.disabled?.5:1,hittable:!1});if(Sh(Eh.widgetsGroup,Xh),Fh){const jh=scaledFontSize(Dh.bodyFontSize,Nh),qh=createLeaferText(Lh,{x:0,y:Hh,width:zh,height:Wh,text:String(Yh),fill:Dh.widgetText,fontSize:jh,textAlign:"center",verticalAlign:"middle"});Sh(Eh.widgetsGroup,qh)}return Gh.clicked&&(Gh.clicked=!1,Ah&&(Ah.dirty_canvas=!0)),{nextY:Ph+Ih+4}}function renderWidgetToggle($h){var Lh,Sh;const{createUi:Eh,addChildren:Gh,view:Ah,widget:Ph,y:Nh,scale:Mh,width:Dh,tokens:Fh,showText:Ih}=$h,Hh=$h.widgetHeight,Wh=Nh*Mh,zh=Hh*Mh,Uh=(Ph.width||Dh)*Mh,Yh=15*Mh,Xh=Ph.label||Ph.name||"toggle",jh=Ph.value?((Lh=Ph.options)==null?void 0:Lh.on)||"true":((Sh=Ph.options)==null?void 0:Sh.off)||"false",qh=Eh("Rect",{x:Yh,y:Wh,width:Math.max(1,Uh-Yh*2),height:zh,fill:Fh.widgetBg,stroke:Fh.widgetBorder,strokeWidth:Math.max(1,Mh),cornerRadius:Math.max(2,Hh*.5*Mh),opacity:Ph.disabled?.5:1,hittable:!1}),Kh=Eh("Ellipse",{x:Uh-Yh*2-zh*.72,y:Wh+(zh*.5-zh*.36),width:zh*.72,height:zh*.72,fill:Ph.value?Fh.widgetAccentAlt:Fh.widgetBorder,hittable:!1});if(Gh(Ah.widgetsGroup,qh,Kh),Ih){const Zh=scaledFontSize(Fh.smallFontSize,Mh),il=createLeaferText(Eh,{x:Yh*2,y:Wh,width:Math.max(1,Uh*.48),height:zh,text:String(Xh),fill:Fh.widgetSecondaryText,fontSize:Zh,textAlign:"left",verticalAlign:"middle"}),Jh=createLeaferText(Eh,{x:Yh*2,y:Wh,width:Math.max(1,Uh-Yh*2-6*Mh),height:zh,text:String(jh),fill:Ph.value?Fh.widgetText:Fh.widgetSecondaryText,fontSize:Zh,textAlign:"right",verticalAlign:"middle"});Gh(Ah.widgetsGroup,il,Jh)}return{nextY:Nh+Hh+4}}function renderWidgetSlider($h){var Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh;const{createUi:Ih,addChildren:Hh,view:Wh,widget:zh,y:Uh,scale:Yh,width:Xh,tokens:jh,showText:qh,active:Kh}=$h,Zh=$h.widgetHeight,il=Uh*Yh,Jh=Zh*Yh,Qh=(zh.width||Xh)*Yh,el=15*Yh,nl=Number((Sh=(Lh=zh.options)==null?void 0:Lh.min)!=null?Sh:0),Vh=Number((Gh=(Eh=zh.options)==null?void 0:Eh.max)!=null?Gh:1)-nl||1,sl=Math.max(0,Math.min(1,(Number((Ah=zh.value)!=null?Ah:nl)-nl)/Vh)),rl=Math.max(1,Qh-el*2);zh.label||zh.name;const ol=Number((Nh=(Ph=zh.options)==null?void 0:Ph.precision)!=null?Nh:3),ll=Number((Mh=zh.value)!=null?Mh:0).toFixed(ol),ul=Ih("Rect",{x:el,y:il,width:rl,height:Jh,fill:jh.widgetBg,stroke:jh.widgetBorder,strokeWidth:Math.max(1,Yh),cornerRadius:Math.max(2,3*Yh),opacity:zh.disabled?.5:1,hittable:!1}),cl=Ih("Rect",{x:el,y:il,width:rl*sl,height:Jh,fill:((Dh=zh.options)==null?void 0:Dh.slider_color)||(Kh?"#89A":jh.widgetAccent||"#678"),cornerRadius:Math.max(2,3*Yh),opacity:zh.disabled?.5:1,hittable:!1});if(Hh(Wh.widgetsGroup,ul,cl),qh){const dl=scaledFontSize(jh.bodyFontSize,Yh),_l=createLeaferText(Ih,{x:0,y:il,width:Qh,height:Jh,text:zh.label||`${zh.name||"slider"}  ${ll}`,fill:jh.widgetText,fontSize:dl,textAlign:"center",verticalAlign:"middle"});Hh(Wh.widgetsGroup,_l)}if(zh.marker!=null){const dl=Math.max(0,Math.min(1,(Number(zh.marker)-nl)/Vh)),_l=Ih("Rect",{x:el+rl*dl,y:il,width:Math.max(1,2*Yh),height:Jh,fill:((Fh=zh.options)==null?void 0:Fh.marker_color)||jh.widgetWarning,hittable:!1});Hh(Wh.widgetsGroup,_l)}return{nextY:Uh+Zh+4}}function renderWidgetNumber($h){var Lh,Sh,Eh;const{createUi:Gh,addChildren:Ah,view:Ph,widget:Nh,y:Mh,scale:Dh,width:Fh,tokens:Ih,showText:Hh}=$h,Wh=$h.widgetHeight,zh=Mh*Dh,Uh=Wh*Dh,Yh=(Nh.width||Fh)*Dh,Xh=15*Dh,jh=Nh.label||Nh.name||"number",qh=Number((Sh=(Lh=Nh.options)==null?void 0:Lh.precision)!=null?Sh:3),Kh=Number((Eh=Nh.value)!=null?Eh:0).toFixed(qh),Zh=Gh("Rect",{x:Xh,y:zh,width:Math.max(1,Yh-Xh*2),height:Uh,fill:Ih.widgetBg,stroke:Ih.widgetBorder,strokeWidth:Math.max(1,Dh),cornerRadius:Math.max(2,Wh*.5*Dh),opacity:Nh.disabled?.5:1,hittable:!1});if(Ah(Ph.widgetsGroup,Zh),Hh){const il=scaledFontSize(Ih.smallFontSize,Dh),Jh=Xh*2+5*Dh,Qh=Yh-Xh*2-20*Dh,el=Xh,nl=Math.max(1,Qh-el),Vh=Math.max(1,Qh-Jh-4*Dh),sl=Nh.disabled?null:Gh("Polygon",{points:[Xh+16*Dh,zh+5*Dh,Xh+6*Dh,zh+Uh*.5,Xh+16*Dh,zh+Uh-5*Dh],fill:Ih.widgetText,hittable:!1}),rl=Nh.disabled?null:Gh("Polygon",{points:[Yh-Xh-16*Dh,zh+5*Dh,Yh-Xh-6*Dh,zh+Uh*.5,Yh-Xh-16*Dh,zh+Uh-5*Dh],fill:Ih.widgetText,hittable:!1}),ol=Gh("Text",{x:snapPixel(Jh),y:snapPixel(zh),width:Vh,height:Uh,text:String(jh),fill:Ih.widgetSecondaryText,fontSize:il,fontFamily:"Arial",verticalAlign:"middle",autoSizeAlign:!1,hittable:!1}),ll=createLeaferText(Gh,{x:el,y:zh,width:nl,height:Uh,text:Kh,fill:Ih.widgetText,fontSize:il,textAlign:"right",verticalAlign:"middle"});Ah(Ph.widgetsGroup,sl,rl,ol,ll)}return{nextY:Mh+Wh+4}}function resolveComboValue($h,Lh){var Sh;let Eh=$h.value,Gh=(Sh=$h.options)==null?void 0:Sh.values;if(typeof Gh=="function"&&(Gh=Gh($h,Lh)),Gh&&Gh.constructor!==Array){const Ah=Gh[String(Eh!=null?Eh:"")];Ah!=null&&(Eh=Ah)}return String(Eh!=null?Eh:"")}function renderWidgetCombo($h){const{createUi:Lh,addChildren:Sh,view:Eh,widget:Gh,node:Ah,y:Ph,scale:Nh,width:Mh,tokens:Dh,showText:Fh}=$h,Ih=$h.widgetHeight,Hh=Ph*Nh,Wh=Ih*Nh,zh=(Gh.width||Mh)*Nh,Uh=15*Nh,Yh=Gh.label||Gh.name||"combo",Xh=Lh("Rect",{x:Uh,y:Hh,width:Math.max(1,zh-Uh*2),height:Wh,fill:Dh.widgetBg,stroke:Dh.widgetBorder,strokeWidth:Math.max(1,Nh),cornerRadius:Math.max(2,Ih*.5*Nh),opacity:Gh.disabled?.5:1,hittable:!1});if(Sh(Eh.widgetsGroup,Xh),Fh){const jh=scaledFontSize(Dh.smallFontSize,Nh),qh=Uh*2+5*Nh,Kh=zh-Uh*2-20*Nh,Zh=Uh,il=Math.max(1,Kh-Zh),Jh=Math.max(1,Kh-qh-4*Nh),Qh=Gh.disabled?null:Lh("Polygon",{points:[Uh+16*Nh,Hh+5*Nh,Uh+6*Nh,Hh+Wh*.5,Uh+16*Nh,Hh+Wh-5*Nh],fill:Dh.widgetText,hittable:!1}),el=Gh.disabled?null:Lh("Polygon",{points:[zh-Uh-16*Nh,Hh+5*Nh,zh-Uh-6*Nh,Hh+Wh*.5,zh-Uh-16*Nh,Hh+Wh-5*Nh],fill:Dh.widgetText,hittable:!1}),nl=Lh("Text",{x:snapPixel(qh),y:snapPixel(Hh),width:Jh,height:Wh,text:String(Yh),fill:Dh.widgetSecondaryText,fontSize:jh,fontFamily:"Arial",verticalAlign:"middle",autoSizeAlign:!1,hittable:!1}),Vh=createLeaferText(Lh,{x:Zh,y:Hh,width:il,height:Wh,text:resolveComboValue(Gh,Ah),fill:Dh.widgetText,fontSize:jh,textAlign:"right",verticalAlign:"middle"});Sh(Eh.widgetsGroup,Qh,el,nl,Vh)}return{nextY:Ph+Ih+4}}function renderWidgetText($h){var Lh;const{createUi:Sh,addChildren:Eh,view:Gh,widget:Ah,y:Ph,scale:Nh,width:Mh,tokens:Dh,showText:Fh}=$h,Ih=$h.widgetHeight,Hh=Ph*Nh,Wh=Ih*Nh,zh=(Ah.width||Mh)*Nh,Uh=15*Nh,Yh=Ah.label||Ah.name||"text",Xh=String((Lh=Ah.value)!=null?Lh:""),jh=Xh.length>30?Xh.slice(0,30):Xh,qh=Sh("Rect",{x:Uh,y:Hh,width:Math.max(1,zh-Uh*2),height:Wh,fill:Dh.widgetBg,stroke:Dh.widgetBorder,strokeWidth:Math.max(1,Nh),cornerRadius:Math.max(2,Ih*.5*Nh),opacity:Ah.disabled?.5:1,hittable:!1});if(Eh(Gh.widgetsGroup,qh),Fh){const Kh=scaledFontSize(Dh.smallFontSize,Nh),Zh=createLeaferText(Sh,{x:Uh*2,y:Hh,width:Math.max(1,zh*.45),height:Wh,text:String(Yh),fill:Dh.widgetSecondaryText,fontSize:Kh,textAlign:"left",verticalAlign:"middle"}),il=createLeaferText(Sh,{x:Uh*2,y:Hh,width:Math.max(1,zh-Uh*4),height:Wh,text:jh,fill:Dh.widgetText,fontSize:Kh,textAlign:"right",verticalAlign:"middle",textWrap:"none"});Eh(Gh.widgetsGroup,Zh,il)}return{nextY:Ph+Ih+4}}function renderWidgetCustom($h){const{widget:Lh,y:Sh,width:Eh}=$h,Gh=Lh.computeSize?Lh.computeSize(Eh)[1]:$h.widgetHeight,Ah=Lh.width||Eh;return typeof Lh.draw=="function"?{nextY:Sh+Gh+4,legacyDraw(Ph,Nh){Lh.draw(Ph,Nh,Ah,Sh,Gh)}}:{nextY:Sh+Gh+4}}const REQUIRED_NODE_COMPONENT_KEYS=Object.freeze(["node-shell","node-title","node-slots","node-tooltip"]),NODE_COMPONENTS=Object.freeze({"node-shell":renderNodeShell,"node-title":renderNodeTitle,"node-slots":renderNodeSlots,"node-tooltip":renderNodeTooltip}),WIDGET_COMPONENTS=Object.freeze({button:renderWidgetButton,toggle:renderWidgetToggle,slider:renderWidgetSlider,number:renderWidgetNumber,combo:renderWidgetCombo,text:renderWidgetText,string:renderWidgetText,custom:renderWidgetCustom});function getNodeComponent($h){return NODE_COMPONENTS[$h]||null}function hasRequiredNodeComponents(){return REQUIRED_NODE_COMPONENT_KEYS.every($h=>typeof NODE_COMPONENTS[$h]=="function")}function getWidgetComponent($h){if(!$h)return null;if(typeof $h.draw=="function")return WIDGET_COMPONENTS.custom||null;const Lh=String($h.type||"").toLowerCase();return WIDGET_COMPONENTS[Lh]||null}function getRenderStyleTokens($h){return $h==="leafer-classic-v1"||$h==="legacy"?CLASSIC_TOKENS:PRAGMATIC_SLATE_TOKENS}function ensureRoundRectCompat$1($h){if(!(!$h||typeof $h.roundRect=="function")){if(typeof $h.rect=="function"){$h.roundRect=function(Lh,Sh,Eh,Gh){this.rect(Lh,Sh,Eh,Gh)};return}$h.roundRect=function(){}}}function runNodeLegacyCallbacks($h){var Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh,Uh;const Yh=$h.canvasLayer,Xh=Yh==null?void 0:Yh.context;if(!Xh||!Array.isArray($h.callbacks)||$h.callbacks.length===0)return[];ensureRoundRectCompat$1(Xh);const jh=(Eh=(Sh=Yh==null?void 0:Yh.width)!=null?Sh:(Lh=Xh.canvas)==null?void 0:Lh.width)!=null?Eh:0,qh=(Ph=(Ah=Yh==null?void 0:Yh.height)!=null?Ah:(Gh=Xh.canvas)==null?void 0:Gh.height)!=null?Ph:0;(Nh=Xh.save)==null||Nh.call(Xh),(Mh=Xh.setTransform)==null||Mh.call(Xh,1,0,0,1,0,0),(Dh=Xh.clearRect)==null||Dh.call(Xh,0,0,jh,qh);const Kh=Number.isFinite($h.translateX)?Number($h.translateX):0,Zh=Number.isFinite($h.translateY)?Number($h.translateY):$h.titleHeight;(Fh=Xh.scale)==null||Fh.call(Xh,$h.scale,$h.scale),(Ih=Xh.translate)==null||Ih.call(Xh,Kh,Zh);const il=[];for(const Jh of $h.callbacks)typeof(Jh==null?void 0:Jh.fn)=="function"&&il.push(Jh.fn.apply((Hh=Jh.scope)!=null?Hh:null,(Wh=Jh.args)!=null?Wh:[]));return(zh=Xh.restore)==null||zh.call(Xh),(Uh=Yh==null?void 0:Yh.paint)==null||Uh.call(Yh),il}function runWidgetLegacyDraws($h){var Lh,Sh,Eh,Gh,Ah,Ph;const Nh=$h.canvasLayer,Mh=Nh==null?void 0:Nh.context;if(!Mh||!((Lh=$h.drawFns)!=null&&Lh.length))return;ensureRoundRectCompat$1(Mh),(Sh=Mh.save)==null||Sh.call(Mh);const Dh=Number.isFinite($h.translateX)?Number($h.translateX):0,Fh=Number.isFinite($h.translateY)?Number($h.translateY):$h.titleHeight;(Eh=Mh.scale)==null||Eh.call(Mh,$h.scale,$h.scale),(Gh=Mh.translate)==null||Gh.call(Mh,Dh,Fh);for(const Ih of $h.drawFns)Ih(Mh,$h.node);(Ah=Mh.restore)==null||Ah.call(Mh),(Ph=Nh==null?void 0:Nh.paint)==null||Ph.call(Nh)}function runNodeLegacyFallback($h){var Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh;const Wh=$h.ctx;if(!Wh||typeof $h.drawLegacyWithCtx!="function")return;ensureRoundRectCompat$1(Wh);const zh=((Sh=(Lh=$h.host)==null?void 0:Lh.ds)==null?void 0:Sh.scale)||1,Uh=((Gh=(Eh=$h.host)==null?void 0:Eh.ds)==null?void 0:Gh.offset)||[0,0],Yh=((Ph=(Ah=$h.node)==null?void 0:Ah.pos)==null?void 0:Ph[0])||0,Xh=((Mh=(Nh=$h.node)==null?void 0:Nh.pos)==null?void 0:Mh[1])||0;(Dh=Wh.save)==null||Dh.call(Wh),(Fh=Wh.scale)==null||Fh.call(Wh,zh,zh),(Ih=Wh.translate)==null||Ih.call(Wh,Yh+Uh[0],Xh+Uh[1]),$h.drawLegacyWithCtx(Wh),(Hh=Wh.restore)==null||Hh.call(Wh)}function createCompatGroup($h="Group"){return{__tag:$h,children:[],add(...Lh){this.children.push(...Lh.filter(Boolean))},clear(){this.children.length=0},remove(Lh){const Sh=this.children.indexOf(Lh);Sh>=0&&this.children.splice(Sh,1)},set(Lh){Object.assign(this,Lh)}}}const clearChildren=$h=>{if($h){if(typeof $h.clear=="function"){$h.clear();return}if(typeof $h.removeAll=="function"){$h.removeAll();return}Array.isArray($h.children)&&($h.children.length=0)}},addChildren=($h,...Lh)=>{if(!(!$h||!Lh.length)){if(typeof $h.add=="function"){for(const Sh of Lh)Sh&&$h.add(Sh);return}Array.isArray($h.children)&&$h.children.push(...Lh.filter(Boolean))}};function removeChild($h,Lh){if(!(!$h||!Lh)){if(typeof $h.remove=="function"){$h.remove(Lh);return}if(Array.isArray($h.children)){const Sh=$h.children.indexOf(Lh);Sh>=0&&$h.children.splice(Sh,1)}}}function reorderChildren($h,Lh){if(!(!$h||!(Lh!=null&&Lh.length))){for(const Sh of Lh)Sh&&removeChild($h,Sh);addChildren($h,...Lh)}}const setUiData=($h,Lh)=>{if(!(!$h||!Lh)){if(typeof $h.set=="function"){$h.set(Lh);return}Object.assign($h,Lh)}};function nowMs(){return typeof performance!="undefined"&&typeof performance.now=="function"?performance.now():Date.now()}function sanitizeText($h){return $h==null?"":String($h)}function getTitleText($h){var Lh,Sh,Eh,Gh;try{return sanitizeText((Eh=(Sh=(Lh=$h.getTitle)==null?void 0:Lh.call($h))!=null?Sh:$h.title)!=null?Eh:"")}catch{return sanitizeText((Gh=$h.title)!=null?Gh:"")}}function getNodeTooltipText($h){var Lh,Sh;let Eh=(Lh=$h==null?void 0:$h.properties)==null?void 0:Lh.tooltip;return(!Eh||Eh==="")&&LiteGraph.show_node_tooltip_use_descr_property&&(Eh=(Sh=$h==null?void 0:$h.constructor)==null?void 0:Sh.desc),sanitizeText(Eh).trim()}function hashWidgets($h=[],Lh=-1){return $h.length?`${$h.map(Sh=>{var Eh,Gh,Ah,Ph,Nh,Mh;return[(Eh=Sh==null?void 0:Sh.name)!=null?Eh:"",(Gh=Sh==null?void 0:Sh.type)!=null?Gh:"",(Ah=Sh==null?void 0:Sh.value)!=null?Ah:"",Sh!=null&&Sh.disabled?1:0,Sh!=null&&Sh.clicked?1:0,(Ph=Sh==null?void 0:Sh.marker)!=null?Ph:"",(Nh=Sh==null?void 0:Sh.label)!=null?Nh:"",(Mh=Sh==null?void 0:Sh.y)!=null?Mh:""].join(":")}).join("|")}|active:${Lh}`:`widgets:none:active:${Lh}`}function hashNodeSlots($h){const Lh=(Sh=[])=>Sh.map(Eh=>{var Gh,Ah,Ph,Nh,Mh,Dh;return[(Gh=Eh==null?void 0:Eh.name)!=null?Gh:"",(Ah=Eh==null?void 0:Eh.label)!=null?Ah:"",(Ph=Eh==null?void 0:Eh.type)!=null?Ph:"",(Nh=Eh==null?void 0:Eh.shape)!=null?Nh:"",(Mh=Eh==null?void 0:Eh.dir)!=null?Mh:"",(Dh=Eh==null?void 0:Eh.link)!=null?Dh:"",Array.isArray(Eh==null?void 0:Eh.links)?Eh.links.length:""].join(":")}).join("|");return`${Lh($h==null?void 0:$h.inputs)}||${Lh($h==null?void 0:$h.outputs)}`}function collectLegacyWidgetDraws($h=[],Lh,Sh,Eh=2){const Gh=[];let Ah=Eh;for(const Ph of $h){const Nh=Ph.computeSize?Ph.computeSize(Lh)[1]:Sh,Mh=Ph.y!=null?Ph.y:Ah;if(Ph.last_y=Mh,typeof Ph.draw=="function"){const Dh=Ph.width||Lh;Gh.push((Fh,Ih)=>{Ph.draw(Fh,Ih,Dh,Mh,Nh)})}Ah=Mh+Nh+4}return Gh}function computeNodeWidgetsStartY($h,Lh){var Sh,Eh,Gh;let Ah=0;const Ph=Number(((Sh=$h==null?void 0:$h.pos)==null?void 0:Sh[1])||0),Nh=new Float32Array(2);if(Array.isArray($h==null?void 0:$h.inputs))for(let Mh=0;Mh<$h.inputs.length;Mh+=1){const Dh=((Eh=$h.getConnectionPos)==null?void 0:Eh.call($h,!0,Mh,Nh))||[0,Ph],Fh=Number(Dh[1]||0)-Ph+Lh.NODE_SLOT_HEIGHT*.5;Ah<Fh&&(Ah=Fh)}if(Array.isArray($h==null?void 0:$h.outputs))for(let Mh=0;Mh<$h.outputs.length;Mh+=1){const Dh=((Gh=$h.getConnectionPos)==null?void 0:Gh.call($h,!1,Mh,Nh))||[0,Ph],Fh=Number(Dh[1]||0)-Ph+Lh.NODE_SLOT_HEIGHT*.5;Ah<Fh&&(Ah=Fh)}return($h!=null&&$h.horizontal||$h!=null&&$h.widgets_up)&&(Ah=2),($h==null?void 0:$h.widgets_start_y)!=null&&(Ah=$h.widgets_start_y),Ah}function getFallbackCanvas($h,Lh,Sh){var Eh,Gh;const Ah=(Gh=(Eh=$h==null?void 0:$h.createElement)==null?void 0:Eh.call($h,"canvas"))!=null?Gh:typeof document!="undefined"?document.createElement("canvas"):null;return Ah?(Ah.width=Lh,Ah.height=Sh,Ah):null}class LeaferNodeUiLayer{constructor(){this.runtime=null,this.ownerDocument=null,this.enableLogs=!1,this._bridgeCanvas=null,this._leafer=null,this._rootGroup=null,this._nodeViews=new Map,this._visibleNodeKeys=new Set,this._active=!1,this._nodeRenderMode="uiapi-parity",this._renderStyleProfile="legacy",this._parityContext=null,this._legacyFallbackQueue=[],this._frameDirty=!1,this._frameMetrics={renderToCalls:0,forceRenderCalls:0,lastRenderMs:0}}_log(Lh,Sh){if(this.enableLogs){if(Sh!==void 0){console.info("[LiteGraph][LeaferNodeUI]",Lh,Sh);return}console.info("[LiteGraph][LeaferNodeUI]",Lh)}}_createUi(Lh,Sh={}){var Eh;const Gh=(Eh=this.runtime)==null?void 0:Eh[Lh];if(typeof Gh=="function")return new Gh(Sh);const Ah=createCompatGroup(Lh);return Object.assign(Ah,Sh),Ah}_createLeaferSurface(Lh,Sh){var Eh,Gh;const Ah=getFallbackCanvas(this.ownerDocument,Lh,Sh);if(!Ah)throw new Error("Failed to create Leafer node bridge canvas.");const Ph=((Eh=this.runtime)==null?void 0:Eh.Leafer)||((Gh=this.runtime)==null?void 0:Gh.App);if(typeof Ph!="function")throw new Error("Leafer runtime missing Leafer/App constructor for node UI mode.");const Nh=new Ph({view:Ah,width:Lh,height:Sh,hittable:!1}),Mh=this._createUi("Group",{x:0,y:0,hittable:!1});addChildren(Nh,Mh),this._bridgeCanvas=Ah,this._leafer=Nh,this._rootGroup=Mh}init({runtime:Lh,ownerDocument:Sh,width:Eh,height:Gh,enableLogs:Ah=!1}){return this.destroy(),this.runtime=Lh,this.ownerDocument=Sh!=null?Sh:null,this.enableLogs=!!Ah,this._createLeaferSurface(Eh,Gh),this._log("init",{width:Eh,height:Gh}),this}destroy(){var Lh,Sh;this._active=!1,this._visibleNodeKeys.clear(),this._nodeViews.clear(),this._parityContext=null,this._legacyFallbackQueue.length=0,this._rootGroup=null,(Sh=(Lh=this._leafer)==null?void 0:Lh.destroy)==null||Sh.call(Lh),this._leafer=null,this._bridgeCanvas=null}resize(Lh,Sh){var Eh;if(this._bridgeCanvas){if(this._bridgeCanvas.width=Lh,this._bridgeCanvas.height=Sh,typeof((Eh=this._leafer)==null?void 0:Eh.resize)=="function")try{this._leafer.resize({width:Lh,height:Sh})}catch{this._leafer.resize(Lh,Sh)}this._log("resize",{width:Lh,height:Sh})}}beginFrame({nodeRenderMode:Lh="uiapi-parity",renderStyleProfile:Sh="legacy"}={}){var Eh,Gh,Ah,Ph;this._nodeRenderMode=Lh,this._renderStyleProfile=Sh||"legacy",this._active=!0,this._visibleNodeKeys.clear(),this._legacyFallbackQueue.length=0,this._frameDirty=!1,(Lh==="uiapi-parity"||Lh==="uiapi-components")&&this._bridgeCanvas&&(this._parityContext||(this._parityContext=this._bridgeCanvas.getContext("2d")),this._parityContext&&Lh==="uiapi-parity"&&((Gh=(Eh=this._parityContext).setTransform)==null||Gh.call(Eh,1,0,0,1,0,0),(Ph=(Ah=this._parityContext).clearRect)==null||Ph.call(Ah,0,0,this._bridgeCanvas.width,this._bridgeCanvas.height)))}endFrame(){if(this._active){if(this._nodeRenderMode==="uiapi-parity"){this._active=!1;return}for(const[Lh,Sh]of this._nodeViews.entries())this._visibleNodeKeys.has(Lh)||(removeChild(this._rootGroup,Sh.group),this._nodeViews.delete(Lh));this._active=!1}}renderTo(Lh){var Sh,Eh;if(!this._bridgeCanvas||!Lh||typeof Lh.drawImage!="function")return;const Gh=nowMs();this._frameMetrics.renderToCalls+=1,this._nodeRenderMode!=="uiapi-parity"&&(this._frameDirty||this._legacyFallbackQueue.length>0)&&(this._frameMetrics.forceRenderCalls+=1,(Eh=(Sh=this._leafer)==null?void 0:Sh.forceRender)==null||Eh.call(Sh,void 0,!0)),this.flushLegacyFallbackQueue(),Lh.drawImage(this._bridgeCanvas,0,0),this._frameMetrics.lastRenderMs=nowMs()-Gh}queueLegacyNodeFallback(Lh,Sh,Eh){return!Lh||!Sh||typeof Eh!="function"?!1:(this._legacyFallbackQueue.push({node:Lh,host:Sh,drawLegacyWithCtx:Eh}),!0)}flushLegacyFallbackQueue(){if(!this._legacyFallbackQueue.length)return;!this._parityContext&&this._bridgeCanvas&&(this._parityContext=this._bridgeCanvas.getContext("2d"));const Lh=this._parityContext;if(!Lh){this._legacyFallbackQueue.length=0;return}for(const Sh of this._legacyFallbackQueue)try{runNodeLegacyFallback({ctx:Lh,node:Sh.node,host:Sh.host,drawLegacyWithCtx:Sh.drawLegacyWithCtx}),Sh.node&&Sh.node._render_error_internal&&(delete Sh.node._render_error,delete Sh.node._render_error_internal,Sh.node.has_errors&&(Sh.node.has_errors=!1))}catch(Eh){const Gh=Eh instanceof Error?Eh.message:String(Eh||"unknown render error");Sh.node&&(Sh.node.has_errors=!0,Sh.node._render_error=Gh,Sh.node._render_error_internal=!0)}this._legacyFallbackQueue.length=0}drawLegacyNode(Lh,Sh,Eh){var Gh,Ah;if(this._nodeRenderMode!=="uiapi-parity"||typeof Eh!="function")return;const Ph=this._parityContext||((Ah=(Gh=this._bridgeCanvas)==null?void 0:Gh.getContext)==null?void 0:Ah.call(Gh,"2d"));!Ph||!Lh||!Sh||(this._parityContext=Ph,runNodeLegacyFallback({ctx:Ph,node:Lh,host:Sh,drawLegacyWithCtx:Eh}))}_getNodeKey(Lh){var Sh;return(Sh=Lh==null?void 0:Lh.id)!=null?Sh:Lh}_createCallbackCanvas(Lh,Sh,Eh,Gh){return this._createUi("Canvas",{x:Eh,y:Gh,width:Lh,height:Sh,hittable:!1})}_ensureCallbackLayer(Lh,Sh,Eh,Gh,Ah,Ph,Nh){const Mh=Sh==="bg"?"callbackBgCanvas":"callbackFgCanvas";return Eh?(Lh[Mh]?setUiData(Lh[Mh],{x:Ph,y:Nh,width:Gh,height:Ah}):Lh[Mh]=this._createCallbackCanvas(Gh,Ah,Ph,Nh),Lh[Mh]):(Lh[Mh]&&removeChild(Lh.group,Lh[Mh]),Lh[Mh]=null,null)}_runCallbackLayer(Lh,Sh,Eh,Gh,Ah,Ph,Nh){return!Lh||typeof Sh!="function"?void 0:runNodeLegacyCallbacks({canvasLayer:Lh,scale:Ah,titleHeight:Nh,translateX:Ph,translateY:Nh,callbacks:[{fn:Sh,scope:Eh,args:Gh}]})[0]}_computeCallbackExtents(Lh,Sh,Eh){const Gh=Math.max(1,Number((Sh==null?void 0:Sh[0])||1)),Ah=Math.max(1,Number((Sh==null?void 0:Sh[1])||1));let Ph=0,Nh=-Eh,Mh=Gh,Dh=Ah;if(typeof(Lh==null?void 0:Lh.onBounding)=="function"){const Ih=[0,0,Gh,Ah];try{Lh.onBounding(Ih);const Hh=Number(Ih[0]),Wh=Number(Ih[1]),zh=Number(Ih[2]),Uh=Number(Ih[3]);Number.isFinite(Hh)&&Number.isFinite(Wh)&&Number.isFinite(zh)&&Number.isFinite(Uh)&&(Ph=Math.min(Ph,Hh),Nh=Math.min(Nh,Wh),Mh=Math.max(Mh,Hh+zh),Dh=Math.max(Dh,Wh+Uh))}catch{}}const Fh=2;return Ph-=Fh,Nh-=Fh,Mh+=Fh,Dh+=Fh,Mh<=Ph&&(Mh=Ph+1),Dh<=Nh&&(Dh=Nh+1),{minX:Ph,minY:Nh,maxX:Mh,maxY:Dh}}_computeHashes(Lh,Sh){var Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh,Uh,Yh,Xh,jh,qh,Kh,Zh,il,Jh;const Qh=(Lh==null?void 0:Lh.size)||[0,0],el=getTitleText(Lh),nl=getNodeTooltipText(Lh),Vh=!!((Eh=Sh==null?void 0:Sh.lowQualityRenderingRequired)!=null&&Eh.call(Sh,.5)),sl=!((Gh=Sh==null?void 0:Sh.lowQualityRenderingRequired)!=null&&Gh.call(Sh,.6)),rl=((Ah=Sh==null?void 0:Sh.node_widget)==null?void 0:Ah[0])===Lh?(Ph=Sh==null?void 0:Sh.node_widget)==null?void 0:Ph[1]:null,ol=rl&&Array.isArray(Lh==null?void 0:Lh.widgets)?Lh.widgets.indexOf(rl):-1;return{styleHash:[(Lh==null?void 0:Lh.color)||((Nh=Lh==null?void 0:Lh.constructor)==null?void 0:Nh.color)||LiteGraph.NODE_DEFAULT_COLOR,(Lh==null?void 0:Lh.bgcolor)||((Mh=Lh==null?void 0:Lh.constructor)==null?void 0:Mh.bgcolor)||LiteGraph.NODE_DEFAULT_BGCOLOR,(Lh==null?void 0:Lh.boxcolor)||"",(Dh=Lh==null?void 0:Lh.mode)!=null?Dh:"",(Fh=Lh==null?void 0:Lh.execute_triggered)!=null?Fh:0,(Ih=Lh==null?void 0:Lh.action_triggered)!=null?Ih:0,Lh!=null&&Lh.is_selected?1:0,Lh!=null&&Lh.mouseOver?1:0,Vh?1:0,sl?1:0,(Wh=(Hh=Sh==null?void 0:Sh.connecting_output)==null?void 0:Hh.type)!=null?Wh:"",(Uh=(zh=Sh==null?void 0:Sh.connecting_input)==null?void 0:zh.type)!=null?Uh:""].join("|"),layoutHash:[((Yh=Lh==null?void 0:Lh.pos)==null?void 0:Yh[0])||0,((Xh=Lh==null?void 0:Lh.pos)==null?void 0:Xh[1])||0,Qh[0],Qh[1],((jh=Sh==null?void 0:Sh.ds)==null?void 0:jh.scale)||1,((Kh=(qh=Sh==null?void 0:Sh.ds)==null?void 0:qh.offset)==null?void 0:Kh[0])||0,((il=(Zh=Sh==null?void 0:Sh.ds)==null?void 0:Zh.offset)==null?void 0:il[1])||0,(Jh=Lh==null?void 0:Lh.flags)!=null&&Jh.collapsed?1:0,Lh!=null&&Lh.horizontal?1:0,el,(Sh==null?void 0:Sh.renderStyleProfile)||"legacy"].join("|"),slotHash:hashNodeSlots(Lh),widgetHash:hashWidgets((Lh==null?void 0:Lh.widgets)||[],ol),tooltipHash:`${nl}|${Lh!=null&&Lh.mouseOver?1:0}|${Lh!=null&&Lh.is_selected?1:0}`,title:el,tooltip:nl}}_getOrCreateView(Lh){let Sh=this._nodeViews.get(Lh);if(Sh)return Sh;const Eh=this._createUi("Group",{x:0,y:0,hittable:!1}),Gh=this._createUi("Group",{hittable:!1}),Ah=this._createUi("Group",{hittable:!1}),Ph=this._createUi("Group",{hittable:!1}),Nh=this._createUi("Group",{hittable:!1}),Mh=this._createUi("Group",{hittable:!1});return addChildren(Eh,Gh,Ah,Ph,Nh,Mh),addChildren(this._rootGroup,Eh),Sh={group:Eh,bodyGroup:Gh,titleGroup:Ah,slotsGroup:Ph,widgetsGroup:Nh,tooltipGroup:Mh,callbackBgCanvas:null,callbackFgCanvas:null,styleHash:"",layoutHash:"",widgetHash:"",tooltipHash:"",slotHash:"",hasLegacyWidgetDraw:!1,legacyWidgetDrawFns:[]},this._nodeViews.set(Lh,Sh),Sh}_syncViewStackOrder(Lh){!this._rootGroup||!(Lh!=null&&Lh.group)||(removeChild(this._rootGroup,Lh.group),addChildren(this._rootGroup,Lh.group))}_syncNodeLayerOrder(Lh){Lh!=null&&Lh.group&&reorderChildren(Lh.group,[Lh.bodyGroup,Lh.titleGroup,Lh.callbackBgCanvas,Lh.slotsGroup,Lh.widgetsGroup,Lh.tooltipGroup,Lh.callbackFgCanvas])}_isComponentMode(Lh){return this._nodeRenderMode!=="uiapi-components"||!hasRequiredNodeComponents()||(Lh==null?void 0:Lh.renderStyleEngine)!=="leafer-components"?!1:(Lh==null?void 0:Lh.renderStyleProfile)==="leafer-pragmatic-v1"||(Lh==null?void 0:Lh.renderStyleProfile)==="leafer-classic-v1"}_updateNodeVisuals(Lh,Sh,Eh,Gh){var Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh,Uh,Yh,Xh,jh,qh,Kh,Zh,il,Jh,Qh,el,nl,Vh,sl,rl,ol,ll,ul,cl,dl,_l,pl,yl;const hl=((Ah=Sh==null?void 0:Sh.ds)==null?void 0:Ah.scale)||1,al=((Ph=Sh==null?void 0:Sh.ds)==null?void 0:Ph.offset)||[0,0],fl=LiteGraph.NODE_TITLE_HEIGHT,vl=(Lh==null?void 0:Lh.size)||[0,0],gl=(Lh==null?void 0:Lh._shape)||((Nh=Lh==null?void 0:Lh.constructor)==null?void 0:Nh.shape)||LiteGraph.ROUND_SHAPE,kl=(Mh=Lh==null?void 0:Lh.constructor)==null?void 0:Mh.title_mode,fd=!!((Dh=Sh==null?void 0:Sh.lowQualityRenderingRequired)!=null&&Dh.call(Sh,.5)),id=!((Fh=Sh==null?void 0:Sh.lowQualityRenderingRequired)!=null&&Fh.call(Sh,.6));let nd=!(kl===LiteGraph.TRANSPARENT_TITLE||kl===LiteGraph.NO_TITLE);kl===LiteGraph.AUTOHIDE_TITLE&&(nd=!!(Lh!=null&&Lh.mouseOver));const xl=!!((Ih=Lh==null?void 0:Lh.flags)!=null&&Ih.collapsed);if(xl){const zl=(Gh.title||"").length*(LiteGraph.NODE_TEXT_SIZE||14)*.6;Lh._collapsed_width=Math.min(vl[0],zl+LiteGraph.NODE_TITLE_HEIGHT*2)}const Hl=xl?Math.max(1,(Lh==null?void 0:Lh._collapsed_width)||vl[0]):Math.max(1,vl[0]),Nl=Math.max(1,Hl*hl),sd=Math.max(1,vl[1]*hl),Ml=fl*hl,vd=(((Hh=Lh==null?void 0:Lh.pos)==null?void 0:Hh[0])+al[0])*hl,yd=(((Wh=Lh==null?void 0:Lh.pos)==null?void 0:Wh[1])+al[1])*hl,Yl=computeNodeWidgetsStartY(Lh,LiteGraph),Il=Gh.styleHash!==Eh.styleHash,Fl=Gh.layoutHash!==Eh.layoutHash,od=Gh.slotHash!==Eh.slotHash,Xl=Gh.widgetHash!==Eh.widgetHash,Vl=Gh.tooltipHash!==Eh.tooltipHash;setUiData(Eh.group,{x:vd,y:yd});let Dl=null,wl=null,El=null;if(this._isComponentMode(Sh)){if(wl={shell:getNodeComponent("node-shell"),title:getNodeComponent("node-title"),slots:getNodeComponent("node-slots"),tooltip:getNodeComponent("node-tooltip")},!wl.shell||!wl.title||!wl.slots||!wl.tooltip)return!1;const zl=(Lh==null?void 0:Lh.color)||((zh=Lh==null?void 0:Lh.constructor)==null?void 0:zh.color)||LiteGraph.NODE_DEFAULT_COLOR,Ol=(Lh==null?void 0:Lh.bgcolor)||((Uh=Lh==null?void 0:Lh.constructor)==null?void 0:Uh.bgcolor)||LiteGraph.NODE_DEFAULT_BGCOLOR,Cl=getRenderStyleTokens((Sh==null?void 0:Sh.renderStyleProfile)||this._renderStyleProfile);El={view:Eh,node:Lh,host:Sh,LiteGraph,createUi:this._createUi.bind(this),addChildren,clearChildren,setUiData,width:Nl,height:sd,titleHeightScaled:Ml,scale:hl,showCollapsed:xl,renderTitle:nd,shape:gl,titleMode:kl,lowQuality:fd,renderText:id,selected:!!(Lh!=null&&Lh.is_selected),mouseOver:!!(Lh!=null&&Lh.mouseOver),title:Gh.title,tooltip:Gh.tooltip,nodeColor:zl,bgColor:Ol,tokens:Cl},(Il||Fl||od)&&(wl.shell(El),wl.title(El),wl.slots(El));const Gl=((Yh=Sh==null?void 0:Sh.node_widget)==null?void 0:Yh[0])===Lh;if((Xl||Fl||Il||xl||Gl)&&(clearChildren(Eh.widgetsGroup),Dl=[],!xl)){const $l=(Lh==null?void 0:Lh.widgets)||[],Ll=LiteGraph.NODE_WIDGET_HEIGHT;let Pl=Yl;for(const ml of $l){const bl=ml.y!=null?ml.y:Pl;ml.last_y=bl;const Tl=getWidgetComponent(ml);if(!Tl)return!1;const Rl=Tl({view:Eh,node:Lh,host:Sh,widget:ml,y:bl,width:Hl,scale:hl,widgetHeight:Ll,tokens:Cl,showText:id,active:((Xh=Sh==null?void 0:Sh.node_widget)==null?void 0:Xh[0])===Lh&&((jh=Sh==null?void 0:Sh.node_widget)==null?void 0:jh[1])===ml,createUi:this._createUi.bind(this),addChildren})||{nextY:bl+Ll+4};typeof Rl.legacyDraw=="function"&&Dl.push(Rl.legacyDraw),Pl=(qh=Rl.nextY)!=null?qh:bl+Ll+4}}!xl&&Dl==null&&Eh.hasLegacyWidgetDraw&&(Dl=collectLegacyWidgetDraws((Lh==null?void 0:Lh.widgets)||[],Hl,LiteGraph.NODE_WIDGET_HEIGHT,Yl)),Vl&&wl.tooltip(El)}else{if(Il||Fl){clearChildren(Eh.bodyGroup),clearChildren(Eh.titleGroup),clearChildren(Eh.slotsGroup);const Ol=(Lh==null?void 0:Lh.color)||((Kh=Lh==null?void 0:Lh.constructor)==null?void 0:Kh.color)||LiteGraph.NODE_DEFAULT_COLOR,Cl=(Lh==null?void 0:Lh.bgcolor)||((Zh=Lh==null?void 0:Lh.constructor)==null?void 0:Zh.bgcolor)||LiteGraph.NODE_DEFAULT_BGCOLOR,Gl=this._createUi("Rect",{x:0,y:0,width:Nl,height:sd,fill:Cl,stroke:Ol,strokeWidth:Math.max(1,hl),cornerRadius:((Sh==null?void 0:Sh.round_radius)||8)*hl,hittable:!1});if(addChildren(Eh.bodyGroup,Gl),!xl){const ml=this._createUi("Rect",{x:0,y:-Ml,width:Nl,height:Ml,fill:Ol,cornerRadius:[(Sh==null?void 0:Sh.round_radius)||8,(Sh==null?void 0:Sh.round_radius)||8,0,0].map(Tl=>Tl*hl),hittable:!1}),bl=this._createUi("Text",{x:snapPixel(Ml),y:snapPixel(canvasBaselineToTextTop(LiteGraph.NODE_TITLE_TEXT_Y*hl-Ml,scaledFontSize(14,hl))),text:Gh.title,fill:Lh!=null&&Lh.is_selected?LiteGraph.NODE_SELECTED_TITLE_COLOR:((il=Lh==null?void 0:Lh.constructor)==null?void 0:il.title_text_color)||(Sh==null?void 0:Sh.node_title_color)||LiteGraph.NODE_TEXT_COLOR,fontSize:scaledFontSize(14,hl),hittable:!1});addChildren(Eh.titleGroup,ml,bl)}const $l=Math.max(3,4*hl),Ll=$l*2,Pl=new Float32Array(2);if(!xl&&Array.isArray(Lh==null?void 0:Lh.inputs))for(let ml=0;ml<Lh.inputs.length;ml+=1){const bl=((Jh=Lh.getConnectionPos)==null?void 0:Jh.call(Lh,!0,ml,Pl))||[Lh.pos[0],Lh.pos[1]],Tl=(bl[0]-Lh.pos[0])*hl,Rl=(bl[1]-Lh.pos[1])*hl,Jl=this._createUi("Ellipse",{x:Tl-$l,y:Rl-$l,width:Ll,height:Ll,fill:((Qh=Lh.inputs[ml])==null?void 0:Qh.color_on)||((el=Sh==null?void 0:Sh.default_connection_color)==null?void 0:el.input_off)||"#666",hittable:!1});addChildren(Eh.slotsGroup,Jl)}if(!xl&&Array.isArray(Lh==null?void 0:Lh.outputs))for(let ml=0;ml<Lh.outputs.length;ml+=1){const bl=((nl=Lh.getConnectionPos)==null?void 0:nl.call(Lh,!1,ml,Pl))||[Lh.pos[0]+Lh.size[0],Lh.pos[1]],Tl=(bl[0]-Lh.pos[0])*hl,Rl=(bl[1]-Lh.pos[1])*hl,Jl=this._createUi("Ellipse",{x:Tl-$l,y:Rl-$l,width:Ll,height:Ll,fill:((Vh=Lh.outputs[ml])==null?void 0:Vh.color_on)||((sl=Sh==null?void 0:Sh.default_connection_color)==null?void 0:sl.output_off)||"#666",hittable:!1});addChildren(Eh.slotsGroup,Jl)}}const zl=((rl=Sh==null?void 0:Sh.node_widget)==null?void 0:rl[0])===Lh;if(Xl||Fl||Il||zl){clearChildren(Eh.widgetsGroup);const Ol=(Lh==null?void 0:Lh.widgets)||[],Cl=LiteGraph.NODE_WIDGET_HEIGHT;let Gl=Yl;for(const $l of Ol){const Ll=$l.y!=null?$l.y:Gl;$l.last_y=Ll;const Pl=Ll*hl,ml=Cl*hl,bl=this._createUi("Rect",{x:12*hl,y:Pl,width:Math.max(1,Nl-24*hl),height:ml,fill:LiteGraph.WIDGET_BGCOLOR||"#2A2A2A",stroke:LiteGraph.WIDGET_OUTLINE_COLOR||"#555",strokeWidth:Math.max(1,hl),cornerRadius:Math.max(2,4*hl),hittable:!1}),Tl=this._createUi("Text",{x:snapPixel(18*hl),y:snapPixel(widgetTextTop(Pl,ml,scaledFontSize(12,hl))),text:`${$l.label||$l.name||"widget"}: ${(ol=$l.value)!=null?ol:""}`,fontSize:scaledFontSize(12,hl),fill:LiteGraph.WIDGET_TEXT_COLOR||LiteGraph.NODE_TEXT_COLOR,hittable:!1});addChildren(Eh.widgetsGroup,bl,Tl),Gl=Ll+Cl+4}}if(Vl&&(clearChildren(Eh.tooltipGroup),LiteGraph.show_node_tooltip&&!!(Lh!=null&&Lh.mouseOver)&&!!(Lh!=null&&Lh.is_selected)&&Gh.tooltip!=="")){const Ol=Math.max(160*hl,Math.min(Nl*1.2,320*hl)),Cl=26*hl,Gl=this._createUi("Rect",{x:(Nl-Ol)*.5,y:-(Ml+Cl+8*hl),width:Ol,height:Cl,fill:"#454",stroke:"#222",strokeWidth:Math.max(1,hl),cornerRadius:Math.max(3,4*hl),hittable:!1}),$l=this._createUi("Text",{x:snapPixel(Nl*.5),y:snapPixel(widgetTextTop(Gl.y,Cl,scaledFontSize(12,hl))),text:Gh.tooltip.slice(0,120),fill:"#CEC",fontSize:scaledFontSize(12,hl),textAlign:"center",hittable:!1});addChildren(Eh.tooltipGroup,Gl,$l)}}const rd=typeof(Lh==null?void 0:Lh.onDrawBackground)=="function",md=typeof(Lh==null?void 0:Lh.onDrawForeground)=="function"||typeof(Lh==null?void 0:Lh.onDrawTitle)=="function"||typeof(Lh==null?void 0:Lh.onDrawCollapsed)=="function",ql=(ll=Dl!=null?Dl:Eh.legacyWidgetDrawFns)!=null?ll:[],Ql=!xl&&ql.length>0;Eh.hasLegacyWidgetDraw=Ql,Eh.legacyWidgetDrawFns=ql;const ad=md||Ql;(Il||Fl||od||Xl||Vl||rd||ad)&&(this._frameDirty=!0);const $d=[Math.max(Hl,vl[0]||0),vl[1]||0],Al=this._computeCallbackExtents(Lh,$d,fl),hd=Math.max(1,Math.ceil((Al.maxX-Al.minX)*hl)),ld=Math.max(1,Math.ceil((Al.maxY-Al.minY)*hl)),dd=Al.minX*hl,cd=Al.minY*hl,Wl=-Al.minX,Bl=-Al.minY,Zl=this._ensureCallbackLayer(Eh,"bg",rd,hd,ld,dd,cd),Sl=this._ensureCallbackLayer(Eh,"fg",ad,hd,ld,dd,cd);this._syncNodeLayerOrder(Eh);const ud=xl?this._runCallbackLayer(Sl,Lh==null?void 0:Lh.onDrawCollapsed,Lh,[Sl==null?void 0:Sl.context,Sh],hl,Wl,Bl)===!0:!1,wd=Gh.slotHash,bd=[(Lh==null?void 0:Lh.boxcolor)||"",(ul=Lh==null?void 0:Lh.execute_triggered)!=null?ul:0,(cl=Lh==null?void 0:Lh.action_triggered)!=null?cl:0,(dl=Lh==null?void 0:Lh.mode)!=null?dl:""].join("|");this._runCallbackLayer(Zl,Lh==null?void 0:Lh.onDrawBackground,Lh,[Zl==null?void 0:Zl.context,Sh,Sh==null?void 0:Sh.canvas,Sh==null?void 0:Sh.graph_mouse],hl,Wl,Bl);const pd=hashNodeSlots(Lh);return pd!==wd&&(Gh.slotHash=pd,El&&wl!=null&&wl.slots&&wl.slots(El)),[(Lh==null?void 0:Lh.boxcolor)||"",(_l=Lh==null?void 0:Lh.execute_triggered)!=null?_l:0,(pl=Lh==null?void 0:Lh.action_triggered)!=null?pl:0,(yl=Lh==null?void 0:Lh.mode)!=null?yl:""].join("|")!==bd&&(El&&wl!=null&&wl.title&&wl.title(El),Gh.styleHash=this._computeHashes(Lh,Sh).styleHash),ud||(this._runCallbackLayer(Sl,Lh==null?void 0:Lh.onDrawTitle,Lh,[Sl==null?void 0:Sl.context],hl,Wl,Bl),this._runCallbackLayer(Sl,Lh==null?void 0:Lh.onDrawForeground,Lh,[Sl==null?void 0:Sl.context,Sh,Sh==null?void 0:Sh.canvas],hl,Wl,Bl)),Ql&&runWidgetLegacyDraws({canvasLayer:Sl,drawFns:ql,node:Lh,scale:hl,titleHeight:Bl,translateX:Wl,translateY:Bl}),ud&&(clearChildren(Eh.bodyGroup),clearChildren(Eh.titleGroup),clearChildren(Eh.slotsGroup),clearChildren(Eh.widgetsGroup),clearChildren(Eh.tooltipGroup),Eh.hasLegacyWidgetDraw=!1,Eh.legacyWidgetDrawFns=[]),Eh.styleHash=Gh.styleHash,Eh.layoutHash=Gh.layoutHash,Eh.slotHash=Gh.slotHash,Eh.widgetHash=Gh.widgetHash,Eh.tooltipHash=Gh.tooltipHash,!0}upsertNode(Lh,Sh){if(!this._rootGroup||!Lh||!Sh)return!1;const Eh=this._getNodeKey(Lh);this._visibleNodeKeys.add(Eh);const Gh=this._getOrCreateView(Eh);this._syncViewStackOrder(Gh);const Ah=this._computeHashes(Lh,Sh);return this._updateNodeVisuals(Lh,Sh,Gh,Ah)!==!1}}function shouldUseNodeLevelLegacyFallback($h){var Lh,Sh;return((Sh=(Lh=$h==null?void 0:$h._renderModeRuntime)==null?void 0:Lh.fallbackPolicy)==null?void 0:Sh.nodeLevelLegacyFallback)!==!1}function shouldMarkNodeErrorOnFallbackFailure($h){var Lh,Sh;return((Sh=(Lh=$h==null?void 0:$h._renderModeRuntime)==null?void 0:Lh.fallbackPolicy)==null?void 0:Sh.markNodeErrorOnFailure)!==!1}function markNodeRenderError($h,Lh){if(!$h)return;const Sh=Lh instanceof Error?Lh.message:String(Lh||"unknown render error");$h.has_errors=!0,$h._render_error=Sh,$h._render_error_internal=!0}function clearNodeRenderError($h){!$h||!$h._render_error_internal||(delete $h._render_error,delete $h._render_error_internal,$h.has_errors&&($h.has_errors=!1))}const titleGradientCacheByContext=new WeakMap;function ensureRoundRectCompat($h){if(!$h||typeof $h.roundRect=="function")return;const Lh=typeof $h.rect=="function"?function(Sh,Eh,Gh,Ah){this.rect(Sh,Eh,Gh,Ah)}:function(){};try{$h.roundRect=Lh}catch{}}function getTitleGradientCache($h){let Lh=titleGradientCacheByContext.get($h);return Lh||(Lh=new Map,titleGradientCacheByContext.set($h,Lh)),Lh}function getTitleGradientForContext($h,Lh){const Sh=Lh||LiteGraph.NODE_DEFAULT_COLOR;if(!$h||typeof $h.createLinearGradient!="function")return Sh;const Eh=getTitleGradientCache($h);let Gh=Eh.get(Sh);if(!Gh){Gh=$h.createLinearGradient(0,0,400,0);try{Gh.addColorStop(0,Sh)}catch{Gh.addColorStop(0,LiteGraph.NODE_DEFAULT_COLOR)}Gh.addColorStop(1,"#000"),Eh.set(Sh,Gh)}return Gh}function shouldUseLeaferNodeUiMode($h){var Lh,Sh,Eh,Gh;const Ah=(Lh=$h==null?void 0:$h._renderModeRuntime)!=null?Lh:null;if((Ah==null?void 0:Ah.form)==="legacy")return!1;const Ph=$h==null?void 0:$h.rendererAdapter,Nh=(Sh=Ph==null?void 0:Ph.options)==null?void 0:Sh.nodeRenderMode;if(!Ph||Nh!=="uiapi-parity"&&Nh!=="uiapi-components")return!1;if(Nh==="uiapi-components"){const Mh=$h==null?void 0:$h.renderStyleProfile,Dh=Mh==="leafer-pragmatic-v1"||Mh==="leafer-classic-v1";if(($h==null?void 0:$h.renderStyleEngine)!=="leafer-components"||!Dh)return!1}return((Eh=Ph.isLayerNative)==null?void 0:Eh.call(Ph,"front"))!==!0&&((Gh=Ah==null?void 0:Ah.capabilities)==null?void 0:Gh.useCompatBridge)!==!0||typeof Ph.getLeaferRuntime!="function"?!1:!!Ph.getLeaferRuntime()}function isLeaferNodeUiParityMode($h){var Lh,Sh;return((Sh=(Lh=$h==null?void 0:$h.rendererAdapter)==null?void 0:Lh.options)==null?void 0:Sh.nodeRenderMode)==="uiapi-parity"}function isLeaferNodeUiComponentsMode($h){var Lh,Sh;return((Sh=(Lh=$h==null?void 0:$h.rendererAdapter)==null?void 0:Lh.options)==null?void 0:Sh.nodeRenderMode)==="uiapi-components"}function warnLeaferNodeUiFallback($h,Lh,Sh){var Eh;$h!=null&&$h._leaferNodeUiWarned||($h._leaferNodeUiWarned=!0,(Eh=LiteGraph.warn)==null||Eh.call(LiteGraph,`[LeaferNodeUI] ${Lh}`,Sh))}function decayTriggerCounters($h){($h==null?void 0:$h.execute_triggered)>0&&($h.execute_triggered-=1),($h==null?void 0:$h.action_triggered)>0&&($h.action_triggered-=1)}function ensureLeaferNodeUiLayer($h,Lh){var Sh,Eh,Gh,Ah,Ph,Nh,Mh;const Dh=$h==null?void 0:$h.rendererAdapter,Fh=(Sh=Dh==null?void 0:Dh.getLeaferRuntime)==null?void 0:Sh.call(Dh);if(!Fh)return warnLeaferNodeUiFallback($h,"runtime unavailable, fallback to legacy Canvas2D node rendering."),null;const Ih=((Eh=$h==null?void 0:$h.frontSurface)==null?void 0:Eh.canvas)||($h==null?void 0:$h.canvas)||(Lh==null?void 0:Lh.canvas);if(!Ih)return warnLeaferNodeUiFallback($h,"front canvas unavailable, fallback to legacy Canvas2D node rendering."),null;try{$h._leaferNodeUiLayer||($h._leaferNodeUiLayer=new LeaferNodeUiLayer),$h._leaferNodeUiLayer.runtime?(((Ah=$h._leaferNodeUiLayer._bridgeCanvas)==null?void 0:Ah.width)!==Ih.width||((Ph=$h._leaferNodeUiLayer._bridgeCanvas)==null?void 0:Ph.height)!==Ih.height)&&$h._leaferNodeUiLayer.resize(Ih.width,Ih.height):$h._leaferNodeUiLayer.init({runtime:Fh,ownerDocument:Ih.ownerDocument,width:Ih.width,height:Ih.height,enableLogs:!!((Gh=Dh==null?void 0:Dh.options)!=null&&Gh.nodeRenderLogs)})}catch(Hh){return warnLeaferNodeUiFallback($h,"initialization failed, fallback to legacy Canvas2D node rendering.",Hh),(Mh=(Nh=$h._leaferNodeUiLayer)==null?void 0:Nh.destroy)==null||Mh.call(Nh),$h._leaferNodeUiLayer=null,null}return $h._leaferNodeUiLayer}function beginNodeFrameLeafer($h,Lh){var Sh,Eh,Gh;const Ah=(Sh=this==null?void 0:this._renderModeRuntime)!=null?Sh:null;if(Ah!=null&&Ah.strategy&&Ah.strategy!=="full-leafer"&&Ah.strategy!=="decoupled-compat")return this._leaferNodeUiFrameActive=!1,!1;if(!shouldUseLeaferNodeUiMode(this))return this._leaferNodeUiFrameActive=!1,!1;const Ph=ensureLeaferNodeUiLayer(this,$h);if(!Ph)return this._leaferNodeUiFrameActive=!1,!1;const Nh=((Gh=(Eh=this==null?void 0:this.rendererAdapter)==null?void 0:Eh.options)==null?void 0:Gh.nodeRenderMode)||"uiapi-parity";return Ph.beginFrame({nodeRenderMode:Nh,renderStyleProfile:(this==null?void 0:this.renderStyleProfile)||"legacy"}),this._leaferNodeUiFrameActive=!0,!0}function endNodeFrameLeafer($h,Lh){!this._leaferNodeUiFrameActive||!this._leaferNodeUiLayer||(this._leaferNodeUiLayer.endFrame(),this._leaferNodeUiLayer.renderTo($h),this._leaferNodeUiFrameActive=!1)}function drawNode($h,Lh){var Sh,Eh,Gh;if(ensureRoundRectCompat(Lh),shouldUseLeaferNodeUiMode(this)&&this._leaferNodeUiFrameActive&&this._leaferNodeUiLayer){if(isLeaferNodeUiParityMode(this)){const Jh=this._leaferNodeUiFrameActive;this.current_node=$h,this._leaferNodeUiFrameActive=!1;try{this._leaferNodeUiLayer.drawLegacyNode($h,this,Qh=>{drawNode.call(this,$h,Qh)})}finally{this._leaferNodeUiFrameActive=Jh}decayTriggerCounters($h);return}if(isLeaferNodeUiComponentsMode(this)){if(this.current_node=$h,this._leaferNodeUiLayer.upsertNode($h,this)!==!1)clearNodeRenderError($h);else{let Jh=!1;if(shouldUseNodeLevelLegacyFallback(this))try{Jh=this._leaferNodeUiLayer.queueLegacyNodeFallback($h,this,Qh=>{const el=this._leaferNodeUiFrameActive;this._leaferNodeUiFrameActive=!1;try{drawNode.call(this,$h,Qh)}finally{this._leaferNodeUiFrameActive=el}})===!0}catch(Qh){shouldMarkNodeErrorOnFallbackFailure(this)&&markNodeRenderError($h,Qh)}Jh?clearNodeRenderError($h):!($h!=null&&$h._render_error)&&shouldMarkNodeErrorOnFallbackFailure(this)&&markNodeRenderError($h,"node-level legacy fallback failed")}decayTriggerCounters($h);return}this.current_node=$h,this._leaferNodeUiLayer.upsertNode($h,this),decayTriggerCounters($h);return}this.current_node=$h;var Ah=$h.color||$h.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,Ph=$h.bgcolor||$h.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR,Nh=this.ds.scale<.6;if(this.live_mode){$h.flags.collapsed||(Lh.shadowColor="transparent",(Sh=$h.onDrawForeground)==null||Sh.call($h,Lh,this,this.canvas));return}var Mh=this.editor_alpha;if(Lh.globalAlpha=Mh,this.render_shadows&&!Nh?(Lh.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,Lh.shadowOffsetX=2*this.ds.scale,Lh.shadowOffsetY=2*this.ds.scale,Lh.shadowBlur=3*this.ds.scale):Lh.shadowColor="transparent",!($h.flags.collapsed&&(Eh=$h.onDrawCollapsed)!=null&&Eh.call($h,Lh,this))){var Dh=$h._shape||LiteGraph.BOX_SHAPE,Fh=temp_vec2;temp_vec2.set($h.size);var Ih=$h.horizontal;if($h.flags.collapsed){Lh.font=this.inner_text_font;var Hh=$h.getTitle?$h.getTitle():$h.title;Hh!=null&&($h._collapsed_width=Math.min($h.size[0],Lh.measureText(Hh).width+LiteGraph.NODE_TITLE_HEIGHT*2),Fh[0]=$h._collapsed_width,Fh[1]=0)}($h.clip_area||this.clip_all_nodes)&&(Lh.save(),Lh.beginPath(),Dh==LiteGraph.BOX_SHAPE?Lh.rect(0,0,Fh[0],Fh[1]):Dh==LiteGraph.ROUND_SHAPE?Lh.roundRect(0,0,Fh[0],Fh[1],[10]):Dh==LiteGraph.CIRCLE_SHAPE&&Lh.arc(Fh[0]*.5,Fh[1]*.5,Fh[0]*.5,0,Math.PI*2),Lh.clip()),$h.has_errors&&(Ph="red"),this.drawNodeShape($h,Lh,Fh,Ah,Ph,$h.is_selected,$h.mouseOver),Lh.shadowColor="transparent",(Gh=$h.onDrawForeground)==null||Gh.call($h,Lh,this,this.canvas),LiteGraph.show_node_tooltip&&$h.mouseOver&&$h.is_selected&&(!this.selected_nodes||Object.keys(this.selected_nodes).length<=1)&&this.drawNodeTooltip(Lh,$h),Lh.textAlign=Ih?"center":"left",Lh.font=this.inner_text_font;var Wh=!this.lowQualityRenderingRequired(.6),zh=this.connecting_output,Uh=this.connecting_input;Lh.lineWidth=1;var Yh=0,Xh=new Float32Array(2),jh;if($h.flags.collapsed){if(this.render_collapsed_slots){var qh=null,Kh=null;if($h.inputs)for(let Jh=0;Jh<$h.inputs.length;Jh++){var Zh=$h.inputs[Jh];if(Zh.link!=null){qh=Zh;break}}if($h.outputs)for(let Jh=0;Jh<$h.outputs.length;Jh++){var Zh=$h.outputs[Jh];!Zh.links||!Zh.links.length||(Kh=Zh)}if(qh){let Jh=0,Qh=LiteGraph.NODE_TITLE_HEIGHT*-.5;Ih&&(Jh=$h._collapsed_width*.5,Qh=-LiteGraph.NODE_TITLE_HEIGHT),Lh.fillStyle="#686",Lh.beginPath(),Zh.type===LiteGraph.EVENT||Zh.type===LiteGraph.ACTION||Zh.shape===LiteGraph.BOX_SHAPE?Lh.rect(Jh-7+.5,Qh-4,14,8):Zh.shape===LiteGraph.ARROW_SHAPE?(Lh.moveTo(Jh+8,Qh),Lh.lineTo(Jh+-4,Qh-4),Lh.lineTo(Jh+-4,Qh+4),Lh.closePath()):Lh.arc(Jh,Qh,4,0,Math.PI*2),Lh.fill()}if(Kh){let Jh=$h._collapsed_width,Qh=LiteGraph.NODE_TITLE_HEIGHT*-.5;Ih&&(Jh=$h._collapsed_width*.5,Qh=0),Lh.fillStyle="#686",Lh.strokeStyle="black",Lh.beginPath(),Zh.type===LiteGraph.EVENT||Zh.type===LiteGraph.ACTION||Zh.shape===LiteGraph.BOX_SHAPE?Lh.rect(Jh-7+.5,Qh-4,14,8):Zh.shape===LiteGraph.ARROW_SHAPE?(Lh.moveTo(Jh+6,Qh),Lh.lineTo(Jh-6,Qh-4),Lh.lineTo(Jh-6,Qh+4),Lh.closePath()):Lh.arc(Jh,Qh,4,0,Math.PI*2),Lh.fill()}}}else{if($h.inputs)for(let Jh=0;Jh<$h.inputs.length;Jh++){let Qh=$h.inputs[Jh],el=Qh.type,nl=Qh.shape;Lh.globalAlpha=Mh,this.connecting_output&&!LiteGraph.isValidConnection(Qh.type,zh.type)&&(Lh.globalAlpha=.4*Mh),Lh.fillStyle=Qh.link!=null?Qh.color_on||this.default_connection_color_byType[el]||this.default_connection_color.input_on:Qh.color_off||this.default_connection_color_byTypeOff[el]||this.default_connection_color_byType[el]||this.default_connection_color.input_off;let Vh=$h.getConnectionPos(!0,Jh,Xh);if(Vh[0]-=$h.pos[0],Vh[1]-=$h.pos[1],Yh<Vh[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(Yh=Vh[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),Lh.beginPath(),el=="array"?nl=LiteGraph.GRID_SHAPE:Qh.name=="onTrigger"||Qh.name=="onExecuted"?nl=LiteGraph.ARROW_SHAPE:(el===LiteGraph.EVENT||el===LiteGraph.ACTION)&&(nl=LiteGraph.BOX_SHAPE),jh=!0,nl===LiteGraph.BOX_SHAPE?Ih?Lh.rect(Vh[0]-5+.5,Vh[1]-8+.5,10,14):Lh.rect(Vh[0]-6+.5,Vh[1]-5+.5,14,10):nl===LiteGraph.ARROW_SHAPE?(Lh.moveTo(Vh[0]+8,Vh[1]+.5),Lh.lineTo(Vh[0]-4,Vh[1]+6+.5),Lh.lineTo(Vh[0]-4,Vh[1]-6+.5),Lh.closePath()):nl===LiteGraph.GRID_SHAPE?(Lh.rect(Vh[0]-4,Vh[1]-4,2,2),Lh.rect(Vh[0]-1,Vh[1]-4,2,2),Lh.rect(Vh[0]+2,Vh[1]-4,2,2),Lh.rect(Vh[0]-4,Vh[1]-1,2,2),Lh.rect(Vh[0]-1,Vh[1]-1,2,2),Lh.rect(Vh[0]+2,Vh[1]-1,2,2),Lh.rect(Vh[0]-4,Vh[1]+2,2,2),Lh.rect(Vh[0]-1,Vh[1]+2,2,2),Lh.rect(Vh[0]+2,Vh[1]+2,2,2),jh=!1):Nh?Lh.rect(Vh[0]-4,Vh[1]-4,8,8):Lh.arc(Vh[0],Vh[1],4,0,Math.PI*2),Lh.fill(),Wh&&!(Qh.name=="onTrigger"||Qh.name=="onExecuted")){let sl=Qh.label!=null?Qh.label:Qh.name;sl&&(Lh.fillStyle=LiteGraph.NODE_TEXT_COLOR,Ih||Qh.dir==LiteGraph.UP?Lh.fillText(sl,Vh[0],Vh[1]-10):Lh.fillText(sl,Vh[0]+10,Vh[1]+5))}}if(Lh.textAlign=Ih?"center":"right",Lh.strokeStyle="black",$h.outputs)for(let Jh=0;Jh<$h.outputs.length;Jh++){let Qh=$h.outputs[Jh],el=Qh.type,nl=Qh.shape;this.connecting_input&&!LiteGraph.isValidConnection(el,Uh.type)&&(Lh.globalAlpha=.4*Mh);let Vh=$h.getConnectionPos(!1,Jh,Xh);if(Vh[0]-=$h.pos[0],Vh[1]-=$h.pos[1],Yh<Vh[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(Yh=Vh[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),Lh.fillStyle=Qh.links&&Qh.links.length?Qh.color_on||this.default_connection_color_byType[el]||this.default_connection_color.output_on:Qh.color_off||this.default_connection_color_byTypeOff[el]||this.default_connection_color_byType[el]||this.default_connection_color.output_off,Lh.beginPath(),el=="array"?nl=LiteGraph.GRID_SHAPE:Qh.name=="onTrigger"||Qh.name=="onExecuted"?nl=LiteGraph.ARROW_SHAPE:(el===LiteGraph.EVENT||el===LiteGraph.ACTION)&&(nl=LiteGraph.BOX_SHAPE),jh=!0,nl===LiteGraph.BOX_SHAPE?Ih?Lh.rect(Vh[0]-5+.5,Vh[1]-8+.5,10,14):Lh.rect(Vh[0]-6+.5,Vh[1]-5+.5,14,10):nl===LiteGraph.ARROW_SHAPE?(Lh.moveTo(Vh[0]+8,Vh[1]+.5),Lh.lineTo(Vh[0]-4,Vh[1]+6+.5),Lh.lineTo(Vh[0]-4,Vh[1]-6+.5),Lh.closePath()):nl===LiteGraph.GRID_SHAPE?(Lh.rect(Vh[0]-4,Vh[1]-4,2,2),Lh.rect(Vh[0]-1,Vh[1]-4,2,2),Lh.rect(Vh[0]+2,Vh[1]-4,2,2),Lh.rect(Vh[0]-4,Vh[1]-1,2,2),Lh.rect(Vh[0]-1,Vh[1]-1,2,2),Lh.rect(Vh[0]+2,Vh[1]-1,2,2),Lh.rect(Vh[0]-4,Vh[1]+2,2,2),Lh.rect(Vh[0]-1,Vh[1]+2,2,2),Lh.rect(Vh[0]+2,Vh[1]+2,2,2),jh=!1):Nh?Lh.rect(Vh[0]-4,Vh[1]-4,8,8):Lh.arc(Vh[0],Vh[1],4,0,Math.PI*2),Lh.fill(),!Nh&&jh&&Lh.stroke(),Wh&&!(Qh.name=="onTrigger"||Qh.name=="onExecuted")){let sl=Qh.label!=null?Qh.label:Qh.name;sl&&(Lh.fillStyle=LiteGraph.NODE_TEXT_COLOR,Ih||Qh.dir==LiteGraph.DOWN?Lh.fillText(sl,Vh[0],Vh[1]-8):Lh.fillText(sl,Vh[0]-10,Vh[1]+5))}}if(Lh.textAlign="left",Lh.globalAlpha=1,$h.widgets){var il=Yh;(Ih||$h.widgets_up)&&(il=2),$h.widgets_start_y!=null&&(il=$h.widgets_start_y),this.drawNodeWidgets($h,il,Lh,this.node_widget&&this.node_widget[0]==$h?this.node_widget[1]:null)}}($h.clip_area||this.clip_all_nodes)&&Lh.restore(),Lh.globalAlpha=1}}function drawNodeTooltip($h,Lh){var Sh;if(!Lh||!$h){(Sh=LiteGraph.warn)==null||Sh.call(LiteGraph,"drawNodeTooltip: invalid node or ctx",Lh,$h);return}ensureRoundRectCompat($h);var Eh=Lh.properties.tooltip!=null?Lh.properties.tooltip:"";if((!Eh||Eh=="")&&LiteGraph.show_node_tooltip_use_descr_property&&Lh.constructor.desc&&(Eh=Lh.constructor.desc),Eh=(Eh+"").trim(),!(!Eh||Eh=="")){var Gh=[0,-LiteGraph.NODE_TITLE_HEIGHT],Ah=Lh.flags.collapsed?[LiteGraph.NODE_COLLAPSED_WIDTH,LiteGraph.NODE_TITLE_HEIGHT]:Lh.size;$h.font="14px Courier New",$h.measureText(Eh);var Ph=Math.max(Lh.size[0],160)+20,Nh=Lh.ttip_oTMultiRet?Lh.ttip_oTMultiRet.height+15:21;$h.globalAlpha=.7*this.editor_alpha,$h.shadowColor=Lh.ttip_oTMultiRet?"black":"transparent",$h.shadowOffsetX=2,$h.shadowOffsetY=2,$h.shadowBlur=3,$h.fillStyle=Lh.ttip_oTMultiRet?"#454":"transparent",$h.beginPath(),$h.roundRect(Gh[0]-Ph*.5+Ah[0]/2,Gh[1]-15-Nh,Ph,Nh,[3]),$h.moveTo(Gh[0]-10+Ah[0]/2,Gh[1]-15),$h.lineTo(Gh[0]+10+Ah[0]/2,Gh[1]-15),$h.lineTo(Gh[0]+Ah[0]/2,Gh[1]-5),$h.fill(),$h.shadowColor="transparent",$h.textAlign="center",$h.fillStyle=Lh.ttip_oTMultiRet?"#CEC":"transparent",$h.globalAlpha=this.editor_alpha;var Mh=LiteGraph.canvasFillTextMultiline($h,Eh,Gh[0]+Ah[0]/2,Gh[1]-Nh,Ph,14);Lh.ttip_oTMultiRet=Mh,$h.closePath()}}function drawNodeShape($h,Lh,Sh,Eh,Gh,Ah,Ph){var Nh;ensureRoundRectCompat(Lh),Lh.strokeStyle=Eh,Lh.fillStyle=Gh;var Mh=LiteGraph.NODE_TITLE_HEIGHT,Dh=this.lowQualityRenderingRequired(.5),Fh=$h._shape||$h.constructor.shape||LiteGraph.ROUND_SHAPE,Ih=$h.constructor.title_mode,Hh=!0;Ih==LiteGraph.TRANSPARENT_TITLE||Ih==LiteGraph.NO_TITLE?Hh=!1:Ih==LiteGraph.AUTOHIDE_TITLE&&Ph&&(Hh=!0);var Wh=tmp_area;Wh[0]=0,Wh[1]=Hh?-Mh:0,Wh[2]=Sh[0]+1,Wh[3]=Hh?Sh[1]+Mh:Sh[1];var zh=Lh.globalAlpha;if(Lh.beginPath(),Fh==LiteGraph.BOX_SHAPE||Dh?Lh.fillRect(Wh[0],Wh[1],Wh[2],Wh[3]):Fh==LiteGraph.ROUND_SHAPE||Fh==LiteGraph.CARD_SHAPE?Lh.roundRect(Wh[0],Wh[1],Wh[2],Wh[3],Fh==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):Fh==LiteGraph.CIRCLE_SHAPE&&Lh.arc(Sh[0]*.5,Sh[1]*.5,Sh[0]*.5,0,Math.PI*2),Lh.fill(),!$h.flags.collapsed&&Hh&&(Lh.shadowColor="transparent",Lh.fillStyle="rgba(0,0,0,0.2)",Lh.fillRect(0,-1,Wh[2],2)),Lh.shadowColor="transparent",(Nh=$h.onDrawBackground)==null||Nh.call($h,Lh,this,this.canvas,this.graph_mouse),Hh||Ih==LiteGraph.TRANSPARENT_TITLE){if($h.onDrawTitleBar)$h.onDrawTitleBar(Lh,Mh,Sh,this.ds.scale,Eh);else if(Ih!=LiteGraph.TRANSPARENT_TITLE&&($h.constructor.title_color||this.render_title_colored)){var Uh=$h.constructor.title_color||Eh;$h.flags.collapsed&&(Lh.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients?Lh.fillStyle=getTitleGradientForContext(Lh,Uh):Lh.fillStyle=Uh,Lh.beginPath(),Fh==LiteGraph.BOX_SHAPE||Dh?Lh.rect(0,-Mh,Sh[0]+1,Mh):(Fh==LiteGraph.ROUND_SHAPE||Fh==LiteGraph.CARD_SHAPE)&&Lh.roundRect(0,-Mh,Sh[0]+1,Mh,$h.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),Lh.fill(),Lh.shadowColor="transparent"}let Zh=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[$h.mode]&&(Zh=LiteGraph.NODE_MODES_COLORS[$h.mode]),LiteGraph.node_box_coloured_when_on&&(Zh=$h.action_triggered?"#FFF":$h.execute_triggered?"#AAA":Zh);var Yh=10;if($h.onDrawTitleBox?$h.onDrawTitleBox(Lh,Mh,Sh,this.ds.scale):Fh==LiteGraph.ROUND_SHAPE||Fh==LiteGraph.CIRCLE_SHAPE||Fh==LiteGraph.CARD_SHAPE?(Dh&&(Lh.fillStyle="black",Lh.beginPath(),Lh.arc(Mh*.5,Mh*-.5,Yh*.5+1,0,Math.PI*2),Lh.fill()),Lh.fillStyle=$h.boxcolor||Zh||LiteGraph.NODE_DEFAULT_BOXCOLOR,Dh?Lh.fillRect(Mh*.5-Yh*.5,Mh*-.5-Yh*.5,Yh,Yh):(Lh.beginPath(),Lh.arc(Mh*.5,Mh*-.5,Yh*.5,0,Math.PI*2),Lh.fill())):(Dh&&(Lh.fillStyle="black",Lh.fillRect((Mh-Yh)*.5-1,(Mh+Yh)*-.5-1,Yh+2,Yh+2)),Lh.fillStyle=$h.boxcolor||Zh||LiteGraph.NODE_DEFAULT_BOXCOLOR,Lh.fillRect((Mh-Yh)*.5,(Mh+Yh)*-.5,Yh,Yh)),Lh.globalAlpha=zh,$h.onDrawTitleText&&$h.onDrawTitleText(Lh,Mh,Sh,this.ds.scale,this.title_text_font,Ah),!Dh){Lh.font=this.title_text_font;var Xh=String($h.getTitle());Xh&&(Ah?Lh.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:Lh.fillStyle=$h.constructor.title_text_color||this.node_title_color,$h.flags.collapsed?(Lh.textAlign="left",Lh.fillText(Xh.substring(0,20),Mh,LiteGraph.NODE_TITLE_TEXT_Y-Mh),Lh.textAlign="left"):(Lh.textAlign="left",Lh.fillText(Xh,Mh,LiteGraph.NODE_TITLE_TEXT_Y-Mh)))}if(!$h.flags.collapsed&&$h.subgraph&&!$h.skip_subgraph_button){var jh=LiteGraph.NODE_TITLE_HEIGHT,qh=$h.size[0]-jh,Kh=LiteGraph.isInsideRectangle(this.graph_mouse[0]-$h.pos[0],this.graph_mouse[1]-$h.pos[1],qh+2,-jh+2,jh-4,jh-4);Lh.fillStyle=Kh?"#888":"#555",Fh==LiteGraph.BOX_SHAPE||Dh?Lh.fillRect(qh+2,-jh+2,jh-4,jh-4):(Lh.beginPath(),Lh.roundRect(qh+2,-jh+2,jh-4,jh-4,[4]),Lh.fill()),Lh.fillStyle="#333",Lh.beginPath(),Lh.moveTo(qh+jh*.2,-jh*.6),Lh.lineTo(qh+jh*.8,-jh*.6),Lh.lineTo(qh+jh*.5,-jh*.3),Lh.fill()}$h.onDrawTitle&&$h.onDrawTitle(Lh)}Ah&&($h.onBounding&&$h.onBounding(Wh),Ih==LiteGraph.TRANSPARENT_TITLE&&(Wh[1]-=Mh,Wh[3]+=Mh),Lh.lineWidth=1,Lh.globalAlpha=.8,Lh.beginPath(),Fh==LiteGraph.BOX_SHAPE?Lh.rect(-6+Wh[0],-6+Wh[1],12+Wh[2],12+Wh[3]):Fh==LiteGraph.ROUND_SHAPE||Fh==LiteGraph.CARD_SHAPE&&$h.flags.collapsed?Lh.roundRect(-6+Wh[0],-6+Wh[1],12+Wh[2],12+Wh[3],[this.round_radius*2]):Fh==LiteGraph.CARD_SHAPE?Lh.roundRect(-6+Wh[0],-6+Wh[1],12+Wh[2],12+Wh[3],[this.round_radius*2,2,this.round_radius*2,2]):Fh==LiteGraph.CIRCLE_SHAPE&&Lh.arc(Sh[0]*.5,Sh[1]*.5,Sh[0]*.5+6,0,Math.PI*2),Lh.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,Lh.stroke(),Lh.strokeStyle=Eh,Lh.globalAlpha=1),$h.execute_triggered>0&&$h.execute_triggered--,$h.action_triggered>0&&$h.action_triggered--}function drawExecutionOrder($h){$h.shadowColor="transparent",$h.globalAlpha=.25,$h.textAlign="center",$h.strokeStyle="white",$h.globalAlpha=.75;var Lh=this.visible_nodes;for(let Eh=0;Eh<Lh.length;++Eh){var Sh=Lh[Eh];$h.fillStyle="black",$h.fillRect(Sh.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,Sh.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),Sh.order==0&&$h.strokeRect(Sh.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,Sh.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),$h.fillStyle="#FFF",$h.fillText(Sh.order,Sh.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,Sh.pos[1]-6)}$h.globalAlpha=1}function drawNodeWidgets($h,Lh,Sh,Eh){if(!$h.widgets||!$h.widgets.length)return 0;ensureRoundRectCompat(Sh);var Gh=$h.size[0],Ah=$h.widgets;Lh+=2;var Ph=LiteGraph.NODE_WIDGET_HEIGHT,Nh=!this.lowQualityRenderingRequired(.5);Sh.save(),Sh.globalAlpha=this.editor_alpha;var Mh=LiteGraph.WIDGET_OUTLINE_COLOR,Dh=LiteGraph.WIDGET_BGCOLOR,Fh=LiteGraph.WIDGET_TEXT_COLOR,Ih=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,Hh=15;for(let Zh=0;Zh<Ah.length;++Zh){var Wh=Ah[Zh],zh=Lh;Wh.y&&(zh=Wh.y),Wh.last_y=zh,Sh.strokeStyle=Mh,Sh.fillStyle="#222",Sh.textAlign="left",Wh.disabled&&(Sh.globalAlpha*=.5);var Uh=Wh.width||Gh;switch(Wh.type){case"button":Wh.clicked&&(Sh.fillStyle="#AAA",Wh.clicked=!1,this.dirty_canvas=!0),Sh.fillRect(Hh,zh,Uh-Hh*2,Ph),Nh&&!Wh.disabled&&Sh.strokeRect(Hh,zh,Uh-Hh*2,Ph),Nh&&(Sh.textAlign="center",Sh.fillStyle=Fh,Sh.fillText(Wh.label||Wh.name,Uh*.5,zh+Ph*.7));break;case"toggle":if(Sh.textAlign="left",Sh.strokeStyle=Mh,Sh.fillStyle=Dh,Sh.beginPath(),Nh?Sh.roundRect(Hh,zh,Uh-Hh*2,Ph,[Ph*.5]):Sh.rect(Hh,zh,Uh-Hh*2,Ph),Sh.fill(),Nh&&!Wh.disabled&&Sh.stroke(),Sh.fillStyle=Wh.value?"#89A":"#333",Sh.beginPath(),Sh.arc(Uh-Hh*2,zh+Ph*.5,Ph*.36,0,Math.PI*2),Sh.fill(),Nh){Sh.fillStyle=Ih;const il=Wh.label||Wh.name;il!=null&&Sh.fillText(il,Hh*2,zh+Ph*.7),Sh.fillStyle=Wh.value?Fh:Ih,Sh.textAlign="right",Sh.fillText(Wh.value?Wh.options.on||"true":Wh.options.off||"false",Uh-40,zh+Ph*.7)}break;case"slider":Sh.fillStyle=Dh,Sh.fillRect(Hh,zh,Uh-Hh*2,Ph);var Yh=Wh.options.max-Wh.options.min,Xh=(Wh.value-Wh.options.min)/Yh;if(Xh<0&&(Xh=0),Xh>1&&(Xh=1),Sh.fillStyle=Wh.options.hasOwnProperty("slider_color")?Wh.options.slider_color:Eh==Wh?"#89A":"#678",Sh.fillRect(Hh,zh,Xh*(Uh-Hh*2),Ph),Nh&&!Wh.disabled&&Sh.strokeRect(Hh,zh,Uh-Hh*2,Ph),Wh.marker){var jh=(Wh.marker-Wh.options.min)/Yh;jh<0&&(jh=0),jh>1&&(jh=1),Sh.fillStyle=Wh.options.hasOwnProperty("marker_color")?Wh.options.marker_color:"#AA9",Sh.fillRect(Hh+jh*(Uh-Hh*2),zh,2,Ph)}Nh&&(Sh.textAlign="center",Sh.fillStyle=Fh,Sh.fillText(Wh.label||Wh.name+"  "+Number(Wh.value).toFixed(Wh.options.precision!=null?Wh.options.precision:3),Uh*.5,zh+Ph*.7));break;case"number":case"combo":if(Sh.textAlign="left",Sh.strokeStyle=Mh,Sh.fillStyle=Dh,Sh.beginPath(),Nh?Sh.roundRect(Hh,zh,Uh-Hh*2,Ph,[Ph*.5]):Sh.rect(Hh,zh,Uh-Hh*2,Ph),Sh.fill(),Nh)if(Wh.disabled||Sh.stroke(),Sh.fillStyle=Fh,Wh.disabled||(Sh.beginPath(),Sh.moveTo(Hh+16,zh+5),Sh.lineTo(Hh+6,zh+Ph*.5),Sh.lineTo(Hh+16,zh+Ph-5),Sh.fill(),Sh.beginPath(),Sh.moveTo(Uh-Hh-16,zh+5),Sh.lineTo(Uh-Hh-6,zh+Ph*.5),Sh.lineTo(Uh-Hh-16,zh+Ph-5),Sh.fill()),Sh.fillStyle=Ih,Sh.fillText(Wh.label||Wh.name,Hh*2+5,zh+Ph*.7),Sh.fillStyle=Fh,Sh.textAlign="right",Wh.type=="number")Sh.fillText(Number(Wh.value).toFixed(Wh.options.precision!==void 0?Wh.options.precision:3),Uh-Hh*2-20,zh+Ph*.7);else{var qh=Wh.value;if(Wh.options.values){var Kh=Wh.options.values;Kh.constructor===Function&&(Kh=Kh()),Kh&&Kh.constructor!==Array&&(qh=Kh[Wh.value])}Sh.fillText(qh,Uh-Hh*2-20,zh+Ph*.7)}break;case"string":case"text":if(Sh.textAlign="left",Sh.strokeStyle=Mh,Sh.fillStyle=Dh,Sh.beginPath(),Nh?Sh.roundRect(Hh,zh,Uh-Hh*2,Ph,[Ph*.5]):Sh.rect(Hh,zh,Uh-Hh*2,Ph),Sh.fill(),Nh){Wh.disabled||Sh.stroke(),Sh.save(),Sh.beginPath(),Sh.rect(Hh,zh,Uh-Hh*2,Ph),Sh.clip(),Sh.fillStyle=Ih;const il=Wh.label||Wh.name;il!=null&&Sh.fillText(il,Hh*2,zh+Ph*.7),Sh.fillStyle=Fh,Sh.textAlign="right",Sh.fillText(String(Wh.value).substr(0,30),Uh-Hh*2,zh+Ph*.7),Sh.restore()}break;default:Wh.draw&&Wh.draw(Sh,$h,Uh,zh,Ph);break}Lh+=(Wh.computeSize?Wh.computeSize(Uh)[1]:Ph)+4,Sh.globalAlpha=this.editor_alpha}Sh.restore(),Sh.textAlign="left"}function processNodeWidgets(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow();for(let i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type==="pointerdown"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var nvalue=LiteGraph.clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value,old_value)},20),this.dirty_canvas=!0;break;case"number":case"combo":case"enum":if(event.type=="pointermove"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type=="pointerdown"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));let $h=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=$h*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if($h){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+$h:index=values_list.indexOf(w.value)+$h,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let Lh=function(Sh){return values!=values_list&&(Sh=text_values.indexOf(Sh)),this.value=Sh,inner_value_change(this,Sh,old_value),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:Lh.bind(w)},ref_window)}}else if(event.type=="pointerup"&&w.type=="number"){let delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,function(v){var tl;if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch($h){(tl=LiteGraph.warn)==null||tl.call(LiteGraph,$h)}this.value=Number(v),inner_value_change(this,this.value,old_value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value,old_value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type=="pointerdown"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20),this.dirty_canvas=!0);break;case"string":case"text":event.type=="pointerdown"&&this.prompt("Value",w.value,function($h){inner_value_change(this,$h)}.bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return w}}}function inner_value_change($h,Lh,Sh){var Eh;(Eh=LiteGraph.debug)==null||Eh.call(LiteGraph,"inner_value_change for processNodeWidgets",$h,Lh),Sh!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,Sh,w),node.graph.onGraphChanged({action:"widgetChanged",doSave:!0})),$h.type=="number"&&(Lh=Number(Lh)),$h.value=Lh,$h.options&&$h.options.property&&node.properties[$h.options.property]!==void 0&&node.setProperty($h.options.property,Lh),$h.callback&&$h.callback($h.value,that,node,pos,event)}return null}function adjustNodesSize(){var $h=this.graph._nodes;for(let Lh=0;Lh<$h.length;++Lh)$h[Lh].size=$h[Lh].computeSize();this.setDirty(!0,!0)}function drawConnectionsWithLeaferLayer($h,Lh){runLeaferLayerWithFallback({host:$h,layer:"link",drawLeafer:Lh,drawFallback:Lh,errorMessage:"[LeaferLinkLayer] drawConnections failed, fallback to legacy links."})}function renderLinkWithLeaferLayer($h,Lh){runLeaferLayerWithFallback({host:$h,layer:"link",drawLeafer:Lh,drawFallback:Lh,errorMessage:"[LeaferLinkLayer] renderLink failed, fallback to legacy path."})}function drawLinkTooltipWithLeaferLayer($h,Lh){runLeaferLayerWithFallback({host:$h,layer:"link",drawLeafer:Lh,drawFallback:Lh,errorMessage:"[LeaferLinkLayer] drawLinkTooltip failed, fallback to legacy tooltip."})}function drawLinkTooltipLegacy($h,Lh){var Sh,Eh=Lh._pos;if($h.fillStyle="black",$h.beginPath(),$h.arc(Eh[0],Eh[1],3,0,Math.PI*2),$h.fill(),Lh.data!=null&&!((Sh=this.onDrawLinkTooltip)!=null&&Sh.call(this,$h,Lh,this))){var Gh=Lh.data,Ah=null;if(Gh.constructor===Number?Ah=Gh.toFixed(2):Gh.constructor===String?Ah='"'+Gh+'"':Gh.constructor===Boolean?Ah=String(Gh):Gh.toToolTip?Ah=Gh.toToolTip():Ah="["+Gh.constructor.name+"]",Ah!=null){Ah=Ah.substr(0,30),$h.font="14px Courier New";var Ph=$h.measureText(Ah),Nh=Ph.width+20,Mh=24;$h.shadowColor="black",$h.shadowOffsetX=2,$h.shadowOffsetY=2,$h.shadowBlur=3,$h.fillStyle="#454",$h.beginPath(),$h.roundRect(Eh[0]-Nh*.5,Eh[1]-15-Mh,Nh,Mh,[3]),$h.moveTo(Eh[0]-10,Eh[1]-15),$h.lineTo(Eh[0]+10,Eh[1]-15),$h.lineTo(Eh[0],Eh[1]-5),$h.fill(),$h.shadowColor="transparent",$h.textAlign="center",$h.fillStyle="#CEC",$h.fillText(Ah,Eh[0],Eh[1]-15-Mh*.3)}}}function drawLinkTooltip($h,Lh){return drawLinkTooltipWithLeaferLayer(this,()=>drawLinkTooltipLegacy.call(this,$h,Lh))}function drawConnectionsLegacy($h){var Lh=LiteGraph.getTime(),Sh=this.visible_area;margin_area[0]=Sh[0]-20,margin_area[1]=Sh[1]-20,margin_area[2]=Sh[2]+40,margin_area[3]=Sh[3]+40,$h.lineWidth=this.connections_width,$h.fillStyle="#AAA",$h.strokeStyle="#AAA",$h.globalAlpha=this.editor_alpha;for(var Eh=this.graph._nodes,Gh=0,Ah=Eh.length;Gh<Ah;++Gh){var Ph=Eh[Gh];if(!(!Ph.inputs||!Ph.inputs.length))for(let Kh=0;Kh<Ph.inputs.length;++Kh){var Nh=Ph.inputs[Kh];if(!(!Nh||Nh.link==null)){var Mh=Nh.link,Dh=this.graph.links[Mh];if(Dh){var Fh=this.graph.getNodeById(Dh.origin_id);if(Fh!=null){var Ih=Dh.origin_slot,Hh=null;Ih==-1?Hh=[Fh.pos[0]+10,Fh.pos[1]+10]:Hh=Fh.getConnectionPos(!1,Ih,tempA);var Wh=Ph.getConnectionPos(!0,Kh,tempB);if(link_bounding[0]=Hh[0],link_bounding[1]=Hh[1],link_bounding[2]=Wh[0]-Hh[0],link_bounding[3]=Wh[1]-Hh[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!LiteGraph.overlapBounding(link_bounding,margin_area)){var zh=Fh.outputs[Ih],Uh=Ph.inputs[Kh];if(!(!zh||!Uh)){var Yh=zh.dir||(Fh.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),Xh=Uh.dir||(Ph.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink($h,Hh,Wh,Dh,!1,0,null,Yh,Xh),Dh&&Dh._last_time&&Lh-Dh._last_time<1e3){var jh=2-(Lh-Dh._last_time)*.002,qh=$h.globalAlpha;$h.globalAlpha=qh*jh,this.renderLink($h,Hh,Wh,Dh,!0,jh,"white",Yh,Xh),$h.globalAlpha=qh}}}}}}}}$h.globalAlpha=1}function drawConnections($h){return drawConnectionsWithLeaferLayer(this,()=>drawConnectionsLegacy.call(this,$h))}function renderLinkLegacy($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh){Eh&&this.visible_links.push(Eh),!Ph&&Eh&&(Ph=Eh.color||LGraphCanvas.link_type_colors[Eh.type]),Ph||(Ph=this.default_link_color),Eh!=null&&this.highlighted_links[Eh.id]&&(Ph="#FFF"),Nh=Nh||LiteGraph.RIGHT,Mh=Mh||LiteGraph.LEFT;var Fh=LiteGraph.distance(Lh,Sh);this.render_connections_border&&this.ds.scale>.6&&($h.lineWidth=this.connections_width+4),$h.lineJoin="round",Dh=Dh||1,Dh>1&&($h.lineWidth=.5),$h.beginPath();for(let el=0;el<Dh;el+=1){var Ih=(el-(Dh-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){$h.moveTo(Lh[0],Lh[1]+Ih);let nl=0,Vh=0,sl=0,rl=0;switch(Nh){case LiteGraph.LEFT:nl=Fh*-.25;break;case LiteGraph.RIGHT:nl=Fh*.25;break;case LiteGraph.UP:Vh=Fh*-.25;break;case LiteGraph.DOWN:Vh=Fh*.25;break}switch(Mh){case LiteGraph.LEFT:sl=Fh*-.25;break;case LiteGraph.RIGHT:sl=Fh*.25;break;case LiteGraph.UP:rl=Fh*-.25;break;case LiteGraph.DOWN:rl=Fh*.25;break}$h.bezierCurveTo(Lh[0]+nl,Lh[1]+Vh+Ih,Sh[0]+sl,Sh[1]+rl+Ih,Sh[0],Sh[1]+Ih)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){$h.moveTo(Lh[0],Lh[1]+Ih);let nl=0,Vh=0,sl=0,rl=0;switch(Nh){case LiteGraph.LEFT:nl=-1;break;case LiteGraph.RIGHT:nl=1;break;case LiteGraph.UP:Vh=-1;break;case LiteGraph.DOWN:Vh=1;break}switch(Mh){case LiteGraph.LEFT:sl=-1;break;case LiteGraph.RIGHT:sl=1;break;case LiteGraph.UP:rl=-1;break;case LiteGraph.DOWN:rl=1;break}var Hh=15;$h.lineTo(Lh[0]+nl*Hh,Lh[1]+Vh*Hh+Ih),$h.lineTo(Sh[0]+sl*Hh,Sh[1]+rl*Hh+Ih),$h.lineTo(Sh[0],Sh[1]+Ih)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){$h.moveTo(Lh[0],Lh[1]);var Wh=Lh[0],zh=Lh[1],Uh=Sh[0],Yh=Sh[1];Nh==LiteGraph.RIGHT?Wh+=10:zh+=10,Mh==LiteGraph.LEFT?Uh-=10:Yh-=10,$h.lineTo(Wh,zh),$h.lineTo((Wh+Uh)*.5,zh),$h.lineTo((Wh+Uh)*.5,Yh),$h.lineTo(Uh,Yh),$h.lineTo(Sh[0],Sh[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!Gh&&($h.strokeStyle="rgba(0,0,0,0.5)",$h.stroke()),$h.lineWidth=this.connections_width,$h.fillStyle=$h.strokeStyle=Ph,$h.stroke();var Xh=this.computeConnectionPoint(Lh,Sh,.5,Nh,Mh);if(Eh&&Eh._pos&&(Eh._pos[0]=Xh[0],Eh._pos[1]=Xh[1]),this.ds.scale>=.6&&this.highquality_render&&Mh!=LiteGraph.CENTER){if(this.render_connection_arrows){var jh=this.computeConnectionPoint(Lh,Sh,.25,Nh,Mh),qh=this.computeConnectionPoint(Lh,Sh,.26,Nh,Mh),Kh=this.computeConnectionPoint(Lh,Sh,.75,Nh,Mh),Zh=this.computeConnectionPoint(Lh,Sh,.76,Nh,Mh),il=0,Jh=0;this.render_curved_connections?(il=-Math.atan2(qh[0]-jh[0],qh[1]-jh[1]),Jh=-Math.atan2(Zh[0]-Kh[0],Zh[1]-Kh[1])):Jh=il=Sh[1]>Lh[1]?0:Math.PI,$h.save(),$h.translate(jh[0],jh[1]),$h.rotate(il),$h.beginPath(),$h.moveTo(-5,-3),$h.lineTo(0,7),$h.lineTo(5,-3),$h.fill(),$h.restore(),$h.save(),$h.translate(Kh[0],Kh[1]),$h.rotate(Jh),$h.beginPath(),$h.moveTo(-5,-3),$h.lineTo(0,7),$h.lineTo(5,-3),$h.fill(),$h.restore()}$h.beginPath(),$h.arc(Xh[0],Xh[1],5,0,Math.PI*2),$h.fill()}if(Ah){$h.fillStyle=Ph;for(let el=0;el<5;++el){var Qh=(LiteGraph.getTime()*.001+el*.2)%1;Xh=this.computeConnectionPoint(Lh,Sh,Qh,Nh,Mh),$h.beginPath(),$h.arc(Xh[0],Xh[1],5,0,2*Math.PI),$h.fill()}}}function renderLink($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh){return renderLinkWithLeaferLayer(this,()=>renderLinkLegacy.call(this,$h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh))}function computeConnectionPoint($h,Lh,Sh,Eh,Gh){Eh=Eh||LiteGraph.RIGHT,Gh=Gh||LiteGraph.LEFT;var Ah=LiteGraph.distance($h,Lh),Ph=$h,Nh=[$h[0],$h[1]],Mh=[Lh[0],Lh[1]],Dh=Lh;switch(Eh){case LiteGraph.LEFT:Nh[0]+=Ah*-.25;break;case LiteGraph.RIGHT:Nh[0]+=Ah*.25;break;case LiteGraph.UP:Nh[1]+=Ah*-.25;break;case LiteGraph.DOWN:Nh[1]+=Ah*.25;break}switch(Gh){case LiteGraph.LEFT:Mh[0]+=Ah*-.25;break;case LiteGraph.RIGHT:Mh[0]+=Ah*.25;break;case LiteGraph.UP:Mh[1]+=Ah*-.25;break;case LiteGraph.DOWN:Mh[1]+=Ah*.25;break}var Fh=(1-Sh)*(1-Sh)*(1-Sh),Ih=3*((1-Sh)*(1-Sh))*Sh,Hh=3*(1-Sh)*(Sh*Sh),Wh=Sh*Sh*Sh,zh=Fh*Ph[0]+Ih*Nh[0]+Hh*Mh[0]+Wh*Dh[0],Uh=Fh*Ph[1]+Ih*Nh[1]+Hh*Mh[1]+Wh*Dh[1];return[zh,Uh]}function drawBackCanvasWithLeaferLayer($h,Lh){runLeaferLayerWithFallback({host:$h,layer:"back",drawLeafer:Lh,drawFallback:Lh,errorMessage:"[LeaferBackLayer] render failed, fallback to legacy back layer."})}function drawSubgraphPanelWithLeaferLayer($h,Lh){runLeaferLayerWithFallback({host:$h,layer:"panel",drawLeafer:Lh,drawFallback:Lh,errorMessage:"[LeaferPanelLayer] drawSubgraphPanel failed, fallback to legacy panel."})}function renderInfoWithLeaferLayer($h,Lh){runLeaferLayerWithFallback({host:$h,layer:"panel",drawLeafer:Lh,drawFallback:Lh,errorMessage:"[LeaferPanelLayer] renderInfo failed, fallback to legacy info panel."})}function drawSubgraphPanelLegacy($h){var Lh,Sh=this.graph;if(Sh){var Eh=Sh._subgraph_node;if(!Eh){(Lh=LiteGraph.warn)==null||Lh.call(LiteGraph,"subgraph without subnode");return}this.drawSubgraphPanelLeft(Sh,Eh,$h),this.drawSubgraphPanelRight(Sh,Eh,$h)}}function drawSubgraphPanel($h){return drawSubgraphPanelWithLeaferLayer(this,()=>drawSubgraphPanelLegacy.call(this,$h))}function drawSubgraphPanelLeft($h,Lh,Sh){var Eh,Gh=Lh.inputs?Lh.inputs.length:0,Ah=200,Ph=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(Sh.fillStyle="#111",Sh.globalAlpha=.8,Sh.beginPath(),Sh.roundRect(10,10,Ah,(Gh+1)*Ph+50,[8]),Sh.fill(),Sh.globalAlpha=1,Sh.fillStyle="#888",Sh.font="14px Arial",Sh.textAlign="left",Sh.fillText("Graph Inputs",20,34),this.drawButton(Ah-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var Nh=50;if(Sh.font="14px Arial",Lh.inputs)for(var Mh=0;Mh<Lh.inputs.length;++Mh){var Dh=Lh.inputs[Mh];if(!Dh.not_subgraph_input){if(this.drawButton(20,Nh+2,Ah-20,Ph-2)){var Fh=Lh.constructor.input_node_type||"graph/input";this.graph.beforeChange();var Ih=LiteGraph.createNode(Fh);Ih?($h.add(Ih,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([Ih]),this.node_dragged=Ih,this.dragging_canvas=!1,Ih.setProperty("name",Dh.name),Ih.setProperty("type",Dh.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(Eh=LiteGraph.error)==null||Eh.call(LiteGraph,"graph input node not found:",Fh)}Sh.fillStyle="#9C9",Sh.beginPath(),Sh.arc(Ah-16,Nh+Ph*.5,5,0,2*Math.PI),Sh.fill(),Sh.fillStyle="#AAA",Sh.fillText(Dh.name,30,Nh+Ph*.75),Sh.fillStyle="#777",Sh.fillText(Dh.type,130,Nh+Ph*.75),Nh+=Ph}}this.drawButton(20,Nh+2,Ah-20,Ph-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(Lh)}function drawSubgraphPanelRight($h,Lh,Sh){var Eh,Gh,Ah=Lh.outputs?Lh.outputs.length:0,Ph=(((Eh=this.backSurface)==null?void 0:Eh.canvas)||this.bgcanvas).width,Nh=200,Mh=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);Sh.fillStyle="#111",Sh.globalAlpha=.8,Sh.beginPath(),Sh.roundRect(Ph-Nh-10,10,Nh,(Ah+1)*Mh+50,[8]),Sh.fill(),Sh.globalAlpha=1,Sh.fillStyle="#888",Sh.font="14px Arial",Sh.textAlign="left";const Dh="Graph Outputs";var Fh=Sh.measureText(Dh).width;if(Sh.fillText(Dh,Ph-Fh-20,34),this.drawButton(Ph-Nh,20,20,20,"X","#151515")){this.closeSubgraph();return}var Ih=50;if(Sh.font="14px Arial",Lh.outputs)for(var Hh=0;Hh<Lh.outputs.length;++Hh){var Wh=Lh.outputs[Hh];if(!Wh.not_subgraph_input){if(this.drawButton(Ph-Nh,Ih+2,Nh-20,Mh-2)){var zh=Lh.constructor.output_node_type||"graph/output";this.graph.beforeChange();var Uh=LiteGraph.createNode(zh);Uh?($h.add(Uh,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([Uh]),this.node_dragged=Uh,this.dragging_canvas=!1,Uh.setProperty("name",Wh.name),Uh.setProperty("type",Wh.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(Gh=LiteGraph.error)==null||Gh.call(LiteGraph,"graph input node not found:",zh)}Sh.fillStyle="#9C9",Sh.beginPath(),Sh.arc(Ph-Nh+16,Ih+Mh*.5,5,0,2*Math.PI),Sh.fill(),Sh.fillStyle="#AAA",Sh.fillText(Wh.name,Ph-Nh+30,Ih+Mh*.75),Sh.fillStyle="#777",Sh.fillText(Wh.type,Ph-Nh+130,Ih+Mh*.75),Ih+=Mh}}this.drawButton(Ph-Nh,Ih+2,Nh-20,Mh-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(Lh)}function drawButton($h,Lh,Sh,Eh,Gh,Ah,Ph,Nh){var Mh=this.ctx;Ah=Ah||LiteGraph.NODE_DEFAULT_COLOR,Ph=Ph||"#555",Nh=Nh||LiteGraph.NODE_TEXT_COLOR;var Dh=this.ds.convertOffsetToCanvas(this.graph_mouse),Fh=LiteGraph.isInsideRectangle(Dh[0],Dh[1],$h,Lh,Sh,Eh);if(Dh=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,Dh){var Ih=this.canvas.getBoundingClientRect();Dh[0]-=Ih.left,Dh[1]-=Ih.top}var Hh=Dh&&LiteGraph.isInsideRectangle(Dh[0],Dh[1],$h,Lh,Sh,Eh);Mh.fillStyle=Fh?Ph:Ah,Hh&&(Mh.fillStyle="#AAA"),Mh.beginPath(),Mh.roundRect($h,Lh,Sh,Eh,[4]),Mh.fill(),Gh!=null&&Gh.constructor==String&&(Mh.fillStyle=Nh,Mh.textAlign="center",Mh.font=(Eh*.65|0)+"px Arial",Mh.fillText(Gh,$h+Sh*.5,Lh+Eh*.75),Mh.textAlign="left");var Wh=Hh&&!this.block_click;return Hh&&this.blockClick(),Wh}function isAreaClicked($h,Lh,Sh,Eh,Gh){var Ah=this.last_click_position,Ph=Ah&&LiteGraph.isInsideRectangle(Ah[0],Ah[1],$h,Lh,Sh,Eh),Nh=Ph&&!this.block_click;return Ph&&Gh&&this.blockClick(),Nh}function renderInfoLegacy($h,Lh,Sh){Lh=Lh||10,Sh=Sh||this.canvas.height-80,$h.save(),$h.translate(Lh,Sh),$h.font="10px Arial",$h.fillStyle="#888",$h.textAlign="left",this.graph?($h.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),$h.fillText("I: "+this.graph.iteration,5,26),$h.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),$h.fillText("V: "+this.graph._version,5,52),$h.fillText("FPS:"+this.fps.toFixed(2),5,65)):$h.fillText("No graph selected",5,13),$h.restore()}function renderInfo($h,Lh,Sh){return renderInfoWithLeaferLayer(this,()=>renderInfoLegacy.call(this,$h,Lh,Sh))}function drawBackCanvasLegacy(){var $h,Lh,Sh,Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh,Uh=(($h=this.backSurface)==null?void 0:$h.canvas)||this.bgcanvas;this.bgctx||(this.bgctx=(Ph=(Ah=(Sh=(Lh=this.rendererAdapter)==null?void 0:Lh.getBackCtx)==null?void 0:Sh.call(Lh))!=null?Ah:(Gh=(Eh=this.backSurface)==null?void 0:Eh.getContextCompat)==null?void 0:Gh.call(Eh))!=null?Ph:null);var Yh=this.bgctx;if(Yh){(Mh=(Nh=this.rendererAdapter)==null?void 0:Nh.beginFrame)==null||Mh.call(Nh,"back"),(Dh=Yh.start)==null||Dh.call(Yh);var Xh=this.viewport||[0,0,Yh.canvas.width,Yh.canvas.height];if(this.clear_background&&Yh.clearRect(Xh[0],Xh[1],Xh[2],Xh[3]),this._graph_stack&&this._graph_stack.length){Yh.save();var jh=this.graph._subgraph_node;Yh.strokeStyle=jh.bgcolor,Yh.lineWidth=10,Yh.strokeRect(1,1,Uh.width-2,Uh.height-2),Yh.lineWidth=1,Yh.font="40px Arial",Yh.textAlign="center",Yh.fillStyle=jh.bgcolor||"#AAA";let il="";this._graph_stack.slice(1).forEach((Jh,Qh)=>{il+=`${Jh._subgraph_node.getTitle()} ${Qh<this._graph_stack.length-2?">> ":""}`}),Yh.fillText(il+jh.getTitle(),Uh.width*.5,40),Yh.restore()}var qh=!1;if(this.onRenderBackground&&(qh=this.onRenderBackground(Uh,Yh)),this.viewport||(Yh.restore(),Yh.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(Yh.save(),this.ds.toCanvasContext(Yh),this.ds.scale<1.5&&!qh&&this.clear_background_color&&(Yh.fillStyle=this.clear_background_color,Yh.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!qh){if(this.zoom_modify_alpha?Yh.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:Yh.globalAlpha=this.editor_alpha,Yh.imageSmoothingEnabled=Yh.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var Kh=this;this._bg_img.onload=function(){Kh.draw(!0,!0)}}var Zh=null;this._pattern==null&&this._bg_img.width>0?(Zh=Yh.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=Zh):Zh=this._pattern,Zh&&(Yh.fillStyle=Zh,Yh.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),Yh.fillStyle="transparent"),Yh.globalAlpha=1,Yh.imageSmoothingEnabled=Yh.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(Uh,Yh),(Fh=this.onDrawBackground)==null||Fh.call(this,Yh,this.visible_area),this.onBackgroundRender&&((Ih=LiteGraph.error)==null||Ih.call(LiteGraph,"WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(Yh.strokeStyle="#235",Yh.strokeRect(0,0,Uh.width,Uh.height)),this.render_connections_shadows?(Yh.shadowColor="#000",Yh.shadowOffsetX=0,Yh.shadowOffsetY=0,Yh.shadowBlur=6):Yh.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(Yh),Yh.shadowColor="rgba(0,0,0,0)",Yh.restore()}(Hh=Yh.finish)==null||Hh.call(Yh),(zh=(Wh=this.rendererAdapter)==null?void 0:Wh.endFrame)==null||zh.call(Wh,"back"),this.dirty_bgcanvas=!1,this.dirty_canvas=!0}}function drawBackCanvas(){return drawBackCanvasWithLeaferLayer(this,()=>drawBackCanvasLegacy.call(this))}function drawGroups($h,Lh){if(this.graph){var Sh=this.graph._groups;Lh.save(),Lh.globalAlpha=.5*this.editor_alpha;for(let Nh=0;Nh<Sh.length;++Nh){var Eh=Sh[Nh];if(LiteGraph.overlapBounding(this.visible_area,Eh._bounding)){Lh.fillStyle=Eh.color||"#335",Lh.strokeStyle=Eh.color||"#335";var Gh=Eh._pos,Ah=Eh._size;Lh.globalAlpha=.25*this.editor_alpha,Lh.beginPath(),Lh.rect(Gh[0]+.5,Gh[1]+.5,Ah[0],Ah[1]),Lh.fill(),Lh.globalAlpha=this.editor_alpha,Lh.stroke(),Lh.beginPath(),Lh.moveTo(Gh[0]+Ah[0],Gh[1]+Ah[1]),Lh.lineTo(Gh[0]+Ah[0]-10,Gh[1]+Ah[1]),Lh.lineTo(Gh[0]+Ah[0],Gh[1]+Ah[1]-10),Lh.fill();var Ph=Eh.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;Lh.font=Ph+"px Arial",Lh.textAlign="left",Lh.fillText(Eh.title,Gh[0]+4,Gh[1]+Ph)}}Lh.restore()}}class RenderController{constructor(Lh){this.host=Lh}draw(...Lh){return draw.apply(this.host,Lh)}drawFrontCanvas(...Lh){return drawFrontCanvas.apply(this.host,Lh)}lowQualityRenderingRequired(...Lh){return lowQualityRenderingRequired.apply(this.host,Lh)}beginNodeFrameLeafer(...Lh){return beginNodeFrameLeafer.apply(this.host,Lh)}endNodeFrameLeafer(...Lh){return endNodeFrameLeafer.apply(this.host,Lh)}drawNode(...Lh){return drawNode.apply(this.host,Lh)}drawNodeTooltip(...Lh){return drawNodeTooltip.apply(this.host,Lh)}drawNodeShape(...Lh){return drawNodeShape.apply(this.host,Lh)}drawExecutionOrder(...Lh){return drawExecutionOrder.apply(this.host,Lh)}drawNodeWidgets(...Lh){return drawNodeWidgets.apply(this.host,Lh)}processNodeWidgets(...Lh){return processNodeWidgets.apply(this.host,Lh)}adjustNodesSize(...Lh){return adjustNodesSize.apply(this.host,Lh)}drawConnections(...Lh){return drawConnections.apply(this.host,Lh)}renderLink(...Lh){return renderLink.apply(this.host,Lh)}computeConnectionPoint(...Lh){return computeConnectionPoint.apply(this.host,Lh)}drawLinkTooltip(...Lh){return drawLinkTooltip.apply(this.host,Lh)}drawBackCanvas(...Lh){return drawBackCanvas.apply(this.host,Lh)}drawSubgraphPanel(...Lh){return drawSubgraphPanel.apply(this.host,Lh)}drawSubgraphPanelLeft(...Lh){return drawSubgraphPanelLeft.apply(this.host,Lh)}drawSubgraphPanelRight(...Lh){return drawSubgraphPanelRight.apply(this.host,Lh)}drawButton(...Lh){return drawButton.apply(this.host,Lh)}isAreaClicked(...Lh){return isAreaClicked.apply(this.host,Lh)}renderInfo(...Lh){return renderInfo.apply(this.host,Lh)}drawGroups(...Lh){return drawGroups.apply(this.host,Lh)}}function copyToClipboard(){var $h,Lh={nodes:[],links:[]},Sh=0,Eh=[];for(let Dh in this.selected_nodes){let Fh=this.selected_nodes[Dh];Fh.clonable!==!1&&(Fh._relative_id=Sh,Eh.push(Fh),Sh+=1)}for(let Dh=0;Dh<Eh.length;++Dh){let Fh=Eh[Dh];if(Fh.clonable!==!1){var Gh=Fh.clone();if(!Gh){($h=LiteGraph.warn)==null||$h.call(LiteGraph,"node type not found: "+Fh.type);continue}if(Lh.nodes.push(Gh.serialize()),Fh.inputs&&Fh.inputs.length)for(var Ah=0;Ah<Fh.inputs.length;++Ah){var Ph=Fh.inputs[Ah];if(!(!Ph||Ph.link==null)){var Nh=this.graph.links[Ph.link];if(Nh){var Mh=this.graph.getNodeById(Nh.origin_id);Mh&&Lh.links.push([Mh._relative_id,Nh.origin_slot,Fh._relative_id,Nh.target_slot,Mh.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(Lh))}function pasteFromClipboard($h=!1){var Lh;if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&$h)){var Sh=localStorage.getItem("litegrapheditor_clipboard");if(Sh){this.graph.beforeChange();var Eh=JSON.parse(Sh),Gh=!1,Ah=!1;for(let zh=0;zh<Eh.nodes.length;++zh)Gh?(Gh[0]>Eh.nodes[zh].pos[0]&&(Gh[0]=Eh.nodes[zh].pos[0],Ah[0]=zh),Gh[1]>Eh.nodes[zh].pos[1]&&(Gh[1]=Eh.nodes[zh].pos[1],Ah[1]=zh)):(Gh=[Eh.nodes[zh].pos[0],Eh.nodes[zh].pos[1]],Ah=[zh,zh]);var Ph=[];for(let zh=0;zh<Eh.nodes.length;++zh){var Nh=Eh.nodes[zh],Mh=LiteGraph.createNode(Nh.type);Mh&&(Mh.configure(Nh),Mh.pos[0]+=this.graph_mouse[0]-Gh[0],Mh.pos[1]+=this.graph_mouse[1]-Gh[1],this.graph.add(Mh,{doProcessChange:!1}),Ph.push(Mh))}for(let zh=0;zh<Eh.links.length;++zh){var Dh=Eh.links[zh],Fh=void 0,Ih=Dh[0];if(Ih!=null)Fh=Ph[Ih];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&$h){var Hh=Dh[4];Hh&&(Fh=this.graph.getNodeById(Hh))}var Wh=Ph[Dh[2]];Fh&&Wh?Fh.connect(Dh[1],Wh,Dh[3]):(Lh=LiteGraph.warn)==null||Lh.call(LiteGraph,"Warning, nodes missing on pasting")}this.selectNodes(Ph),this.graph.onGraphChanged({action:"paste",doSave:!0}),this.graph.afterChange()}}}function processNodeDblClicked($h){var Lh;this.onShowNodePanel?this.onShowNodePanel($h):this.showShowNodePanel($h),(Lh=this.onNodeDblClicked)==null||Lh.call(this,$h),this.setDirty(!0)}function processNodeSelected($h,Lh){var Sh;this.selectNode($h,Lh&&(Lh.shiftKey||Lh.ctrlKey||this.multi_select)),(Sh=this.onNodeSelected)==null||Sh.call(this,$h)}function selectNode($h,Lh){$h==null?this.deselectAllNodes():this.selectNodes([$h],Lh)}function selectNodes($h,Lh){var Sh;Lh||this.deselectAllNodes(),$h=$h||this.graph._nodes,typeof $h=="string"&&($h=[$h]),Object.values($h).forEach(Eh=>{var Gh,Ah,Ph;if(Eh.is_selected){this.deselectNode(Eh);return}Eh.is_selected=!0,this.selected_nodes[Eh.id]=Eh,(Gh=Eh.onSelected)==null||Gh.call(Eh),(Ah=Eh.inputs)==null||Ah.forEach(Nh=>{this.highlighted_links[Nh.link]=!0}),(Ph=Eh.outputs)==null||Ph.forEach(Nh=>{var Mh;(Mh=Nh.links)==null||Mh.forEach(Dh=>{this.highlighted_links[Dh]=!0})})}),(Sh=this.onSelectionChange)==null||Sh.call(this,this.selected_nodes),this.setDirty(!0)}function deselectNode($h){var Lh,Sh,Eh,Gh;$h.is_selected&&((Lh=$h.onDeselected)==null||Lh.call($h),$h.is_selected=!1,(Sh=this.onNodeDeselected)==null||Sh.call(this,$h),(Eh=$h.inputs)==null||Eh.forEach(Ah=>{var Ph;(Ph=this.highlighted_links)==null||delete Ph[Ah.link]}),(Gh=$h.outputs)==null||Gh.forEach(Ah=>{var Ph;(Ph=Ah.links)==null||Ph.forEach(Nh=>{var Mh;return(Mh=this.highlighted_links)==null?!0:delete Mh[Nh]})}))}function deselectAllNodes(){var $h,Lh;this.graph&&(($h=this.graph._nodes)==null||$h.forEach(Sh=>{var Eh,Gh;Sh.is_selected&&((Eh=Sh.onDeselected)==null||Eh.call(Sh),Sh.is_selected=!1,(Gh=this.onNodeDeselected)==null||Gh.call(this,Sh))}),this.selected_nodes={},this.current_node=null,this.highlighted_links={},(Lh=this.onSelectionChange)==null||Lh.call(this,this.selected_nodes),this.setDirty(!0))}function deleteSelectedNodes(){this.graph.beforeChange();for(let Ah in this.selected_nodes){var $h=this.selected_nodes[Ah];if(!$h.block_delete){if($h.inputs&&$h.inputs.length&&$h.outputs&&$h.outputs.length&&LiteGraph.isValidConnection($h.inputs[0].type,$h.outputs[0].type)&&$h.inputs[0].link&&$h.outputs[0].links&&$h.outputs[0].links.length){var Lh=$h.graph.links[$h.inputs[0].link],Sh=$h.graph.links[$h.outputs[0].links[0]],Eh=$h.getInputNode(0),Gh=$h.getOutputNodes(0)[0];Eh&&Gh&&Eh.connect(Lh.origin_slot,Gh,Sh.target_slot)}this.graph.remove($h),this.onNodeDeselected&&this.onNodeDeselected($h)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()}function onNodeSelectionChange(){}function boundaryNodesForSelection(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))}class SelectionController{constructor(Lh){this.host=Lh}copyToClipboard(...Lh){return copyToClipboard.apply(this.host,Lh)}pasteFromClipboard(...Lh){return pasteFromClipboard.apply(this.host,Lh)}processNodeDblClicked(...Lh){return processNodeDblClicked.apply(this.host,Lh)}processNodeSelected(...Lh){return processNodeSelected.apply(this.host,Lh)}selectNode(...Lh){return selectNode.apply(this.host,Lh)}selectNodes(...Lh){return selectNodes.apply(this.host,Lh)}deselectNode(...Lh){return deselectNode.apply(this.host,Lh)}deselectAllNodes(...Lh){return deselectAllNodes.apply(this.host,Lh)}deleteSelectedNodes(...Lh){return deleteSelectedNodes.apply(this.host,Lh)}onNodeSelectionChange(...Lh){return onNodeSelectionChange.apply(this.host,Lh)}boundaryNodesForSelection(...Lh){return boundaryNodesForSelection.apply(this.host,Lh)}}function showLinkMenu($h,Lh){var Sh=this,Eh=Sh.graph.getNodeById($h.origin_id),Gh=Sh.graph.getNodeById($h.target_id),Ah=!1;Eh&&Eh.outputs&&Eh.outputs[$h.origin_slot]&&(Ah=Eh.outputs[$h.origin_slot].type);var Ph=!1;Gh&&Gh.outputs&&Gh.outputs[$h.target_slot]&&(Ph=Gh.inputs[$h.target_slot].type);var Nh=["Add Node",null,"Delete"],Mh=new LiteGraph.ContextMenu(Nh,{event:Lh,title:$h.data!=null?$h.data.constructor.name:null,callback:Dh});function Dh(Fh,Ih,Hh){switch(Fh){case"Add Node":LGraphCanvas.onMenuAdd(null,null,Hh,Mh,function(Wh){var zh;(zh=LiteGraph.debug)==null||zh.call(LiteGraph,"node autoconnect"),!(!Wh.inputs||!Wh.inputs.length||!Wh.outputs||!Wh.outputs.length)&&Eh.connectByType($h.origin_slot,Wh,Ah)&&(Wh.connectByType($h.target_slot,Gh,Ph),Wh.pos[0]-=Wh.size[0]*.5)});break;case"Delete":Sh.graph.removeLink($h.id);break}}return!1}function createDefaultNodeForSlot($h={}){var Lh,Sh,Eh,Gh,Ah,Ph=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},$h),Nh=this,Mh=Ph.nodeFrom&&Ph.slotFrom!==null,Dh=!Mh&&Ph.nodeTo&&Ph.slotTo!==null;if(!Mh&&!Dh)return(Lh=LiteGraph.warn)==null||Lh.call(LiteGraph,"No data passed to createDefaultNodeForSlot "+Ph.nodeFrom+" "+Ph.slotFrom+" "+Ph.nodeTo+" "+Ph.slotTo),!1;if(!Ph.nodeType)return(Sh=LiteGraph.warn)==null||Sh.call(LiteGraph,"No type to createDefaultNodeForSlot"),!1;var Fh=Mh?Ph.nodeFrom:Ph.nodeTo,Ih=Mh?Ph.slotFrom:Ph.slotTo,Hh=!1;switch(typeof Ih){case"string":Hh=Mh?Fh.findOutputSlot(Ih,!1):Fh.findInputSlot(Ih,!1),Ih=Mh?Fh.outputs[Ih]:Fh.inputs[Ih];break;case"object":Hh=Mh?Fh.findOutputSlot(Ih.name):Fh.findInputSlot(Ih.name);break;case"number":Hh=Ih,Ih=Mh?Fh.outputs[Ih]:Fh.inputs[Ih];break;default:return(Eh=LiteGraph.warn)==null||Eh.call(LiteGraph,"Cant get slot information "+Ih),!1}(Ih===!1||Hh===!1)&&((Gh=LiteGraph.warn)==null||Gh.call(LiteGraph,"createDefaultNodeForSlot bad slotX "+Ih+" "+Hh));var Wh=Ih.type==LiteGraph.EVENT?"_event_":Ih.type,zh=Mh?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(zh&&zh[Wh]){Ih.link;var Uh=!1;if(typeof zh[Wh]=="object"){for(var Yh in zh[Wh])if(Ph.nodeType==zh[Wh][Yh]||Ph.nodeType=="AUTO"){Uh=zh[Wh][Yh];break}}else(Ph.nodeType==zh[Wh]||Ph.nodeType=="AUTO")&&(Uh=zh[Wh]);if(Uh){var Xh=!1;typeof Uh=="object"&&Uh.node&&(Xh=Uh,Uh=Uh.node);var jh=LiteGraph.createNode(Uh);if(jh){if(Xh){if(Xh.properties)for(const[qh,Kh]of Object.entries(Xh.properties))jh.addProperty(qh,Kh);Xh.inputs&&(jh.inputs=[],Object.values(Xh.inputs).forEach(qh=>{jh.addOutput(qh[0],qh[1])})),Xh.outputs&&(jh.outputs=[],Object.values(Xh.outputs).forEach(qh=>{jh.addOutput(qh[0],qh[1])})),Xh.title&&(jh.title=Xh.title),Xh.json&&jh.configure(Xh.json)}return Nh.graph.add(jh),jh.pos=[Ph.position[0]+Ph.posAdd[0]+(Ph.posSizeFix[0]?Ph.posSizeFix[0]*jh.size[0]:0),Ph.position[1]+Ph.posAdd[1]+(Ph.posSizeFix[1]?Ph.posSizeFix[1]*jh.size[1]:0)],Mh?Ph.nodeFrom.connectByType(Hh,jh,Wh):Ph.nodeTo.connectByTypeOutput(Hh,jh,Wh),!0}else(Ah=LiteGraph.warn)==null||Ah.call(LiteGraph,"failed creating "+Uh)}}return!1}function showConnectionMenu($h={}){var Lh,Sh,Eh=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},$h),Gh=this,Ah=Eh.nodeFrom&&Eh.slotFrom,Ph=!Ah&&Eh.nodeTo&&Eh.slotTo;if(!Ah&&!Ph)return(Lh=LiteGraph.warn)==null||Lh.call(LiteGraph,"No data passed to showConnectionMenu"),!1;var Nh=Ah?Eh.nodeFrom:Eh.nodeTo,Mh=Ah?Eh.slotFrom:Eh.slotTo,Dh=!1;switch(typeof Mh){case"string":Dh=Ah?Nh.findOutputSlot(Mh,!1):Nh.findInputSlot(Mh,!1),Mh=Ah?Nh.outputs[Mh]:Nh.inputs[Mh];break;case"object":Dh=Ah?Nh.findOutputSlot(Mh.name):Nh.findInputSlot(Mh.name);break;case"number":Dh=Mh,Mh=Ah?Nh.outputs[Mh]:Nh.inputs[Mh];break;default:return(Sh=LiteGraph.warn)==null||Sh.call(LiteGraph,"Cant get slot information "+Mh),!1}var Fh=["Add Node",null];Gh.allow_searchbox&&(Fh.push("Search"),Fh.push(null));const Ih=Mh.type===LiteGraph.EVENT?"_event_":Mh.type,Hh=Ah?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(Hh&&Hh[Ih]){const zh=Hh[Ih];Array.isArray(zh)||typeof zh=="object"?Object.values(zh).forEach(Uh=>{Fh.push(Uh)}):Fh.push(zh)}var Wh=new LiteGraph.ContextMenu(Fh,{event:Eh.e,title:(Mh&&Mh.name!=""?Mh.name+(Ih?" | ":""):"")+(Mh&&Ih?Ih:""),callback:(zh,Uh,Yh)=>{const Xh={"Add Node":()=>{LGraphCanvas.onMenuAdd(null,null,Yh,Wh,jh=>{Ah?Eh.nodeFrom.connectByType(Dh,jh,Ih):Eh.nodeTo.connectByTypeOutput(Dh,jh,Ih)})},Search:()=>{Ah?Gh.showSearchBox(Yh,{node_from:Eh.nodeFrom,slot_from:Mh,type_filter_in:Ih}):Gh.showSearchBox(Yh,{node_to:Eh.nodeTo,slot_from:Mh,type_filter_out:Ih})},default:()=>{Gh.createDefaultNodeForSlot(Object.assign(Eh,{position:[Eh.e.canvasX,Eh.e.canvasY],nodeType:zh}))}};(Xh[zh]||Xh.default)()}});return!1}function getCanvasMenuOptions(){var $h=null;if(this.getMenuOptions?$h=this.getMenuOptions():($h=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],LiteGraph.showCanvasOptions&&$h.push({content:"Options",callback:this.showShowGraphOptionsPanel}),Object.keys(this.selected_nodes).length>1&&$h.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&$h.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var Lh=this.getExtraMenuOptions(this,$h);Lh&&($h=$h.concat(Lh))}return $h}function getNodeMenuOptions($h){var Lh=null;if($h.getMenuOptions?Lh=$h.getMenuOptions(this):(Lh=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],$h.resizable!==!1&&Lh.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),Lh.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),$h.onGetInputs){var Sh=$h.onGetInputs();Sh&&Sh.length&&(Lh[0].disabled=!1)}if($h.onGetOutputs){var Eh=$h.onGetOutputs();Eh&&Eh.length&&(Lh[1].disabled=!1)}if(LiteGraph.do_add_triggers_slots&&(Lh[1].disabled=!1),$h.getExtraMenuOptions){var Gh=$h.getExtraMenuOptions(this,Lh);Gh&&(Gh.push(null),Lh=Gh.concat(Lh))}return $h.clonable!==!1&&Lh.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&Lh.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),Lh.push(null,{content:"Remove",disabled:!($h.removable!==!1&&!$h.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),$h.graph&&$h.graph.onGetNodeMenuOptions&&$h.graph.onGetNodeMenuOptions(Lh,$h),Lh}function getGroupMenuOptions(){var $h=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return $h}function processContextMenu($h,Lh){var Sh,Eh,Gh,Ah=this,Ph=LGraphCanvas.active_canvas,Nh=Ph.getCanvasWindow(),Mh=null,Dh={event:Lh,callback:zh,extra:$h};$h&&(Dh.title=$h.type);var Fh=null;if($h&&(Fh=$h.getSlotInPosition(Lh.canvasX,Lh.canvasY),LGraphCanvas.active_node=$h),Fh){if(Mh=[],$h.getSlotMenuOptions)Mh=$h.getSlotMenuOptions(Fh);else{((Eh=(Sh=Fh==null?void 0:Fh.output)==null?void 0:Sh.links)!=null&&Eh.length||(Gh=Fh.input)!=null&&Gh.link)&&Mh.push({content:"Disconnect Links",slot:Fh});var Ih=Fh.input||Fh.output;Ih.removable&&LiteGraph.canRemoveSlots&&Mh.push(Ih.locked?"Cannot remove":{content:"Remove Slot",slot:Fh}),!Ih.nameLocked&&LiteGraph.canRenameSlots&&Mh.push({content:"Rename Slot",slot:Fh})}var Hh=Fh.input||Fh.output;Dh.title=Hh.type||"*",Hh.type==LiteGraph.ACTION?Dh.title="Action":Hh.type==LiteGraph.EVENT&&(Dh.title="Event")}else if($h)Mh=this.getNodeMenuOptions($h);else{Mh=this.getCanvasMenuOptions();var Wh=this.graph.getGroupOnPos(Lh.canvasX,Lh.canvasY);Wh&&Mh.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:Wh,options:this.getGroupMenuOptions(Wh)}})}if(!Mh)return;new LiteGraph.ContextMenu(Mh,Dh,Nh);function zh(Uh,Yh){if(!Uh)return;let Xh;if(Uh.content=="Remove Slot"){Xh=Uh.slot,$h.graph.beforeChange(),Xh.input?$h.removeInput(Xh.slot):Xh.output&&$h.removeOutput(Xh.slot),$h.graph.afterChange();return}else if(Uh.content=="Disconnect Links"){Xh=Uh.slot,$h.graph.beforeChange(),Xh.output?$h.disconnectOutput(Xh.slot):Xh.input&&$h.disconnectInput(Xh.slot),$h.graph.afterChange();return}else if(Uh.content=="Rename Slot"){Xh=Uh.slot;var jh=Xh.input?$h.getInputInfo(Xh.slot):$h.getOutputInfo(Xh.slot),qh=Ah.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",Yh),Kh=qh.querySelector("input");Kh&&jh&&(Kh.value=jh.label||"");var Zh=function(){$h.graph.beforeChange(),Kh.value&&(jh&&(jh.label=Kh.value),Ah.setDirty(!0)),qh.close(),$h.graph.afterChange()};qh.querySelector("button").addEventListener("click",Zh),Kh.addEventListener("keydown",function(il){if(qh.is_modified=!0,il.keyCode==27)qh.close();else if(il.keyCode==13)Zh();else if(il.keyCode!=13&&il.target.localName!="textarea")return;il.preventDefault(),il.stopPropagation()}),Kh.focus()}}}function prompt($h="",Lh,Sh,Eh,Gh){var Ah,Ph=document.createElement("div");Ph.is_modified=!1,Ph.className="graphdialog rounded",Gh?Ph.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":Ph.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",Ph.close=()=>{var jh;this.prompt_box=null,(jh=Ph.parentNode)==null||jh.removeChild(Ph)};var Nh=LGraphCanvas.active_canvas,Mh=Nh.canvas;Mh.parentNode.appendChild(Ph),this.ds.scale>1&&(Ph.style.transform=`scale(${this.ds.scale})`);var Dh=null,Fh=0;Ph.addEventListener("pointerleave",jh=>{Fh>0||LiteGraph.dialog_close_on_mouse_leave&&!Ph.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(Dh=setTimeout(Ph.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),Ph.addEventListener("pointerenter",jh=>{LiteGraph.dialog_close_on_mouse_leave&&Dh&&clearTimeout(Dh)});const Ih=Ph.querySelectorAll("select");Ih&&(Fh=0,Ih.forEach(jh=>{jh.addEventListener("pointerdown",qh=>{Fh++}),jh.addEventListener("focus",qh=>{Fh++}),jh.addEventListener("blur",qh=>{Fh=Math.max(0,Fh-1)}),jh.addEventListener("change",qh=>{Fh=0})})),(Ah=this.prompt_box)==null||Ah.close(),this.prompt_box=Ph;var Hh=Ph.querySelector(".name");Hh.innerText=$h;var Wh=Ph.querySelector(".value");Wh.value=Lh;const zh=Wh;zh.addEventListener("keydown",jh=>{var qh;switch(Ph.is_modified=!0,jh.key){case"Escape":Ph.close();break;case"Enter":jh.target.localName!=="textarea"&&typeof Sh=="function"&&(Sh(zh.value),this.setDirty(!0)),(qh=LiteGraph.debug)==null||qh.call(LiteGraph,"prompt v2 ENTER",zh.value,jh.target.localName,Sh),Ph.close();break;default:return}jh.preventDefault(),jh.stopPropagation()}),Ph.querySelector("button").addEventListener("click",jh=>{var qh;typeof Sh=="function"&&(Sh(zh.value),this.setDirty(!0)),(qh=LiteGraph.debug)==null||qh.call(LiteGraph,"prompt v2 OK",zh.value,Sh),Ph.close()});var Uh=Mh.getBoundingClientRect(),Yh=-20,Xh=-20;return Uh&&(Yh-=Uh.left,Xh-=Uh.top),Eh?(Ph.style.left=Eh.clientX+Yh+"px",Ph.style.top=Eh.clientY+Xh+"px"):(Ph.style.left=Mh.width*.5+Yh+"px",Ph.style.top=Mh.height*.5+Xh+"px"),setTimeout(function(){zh.focus()},10),Ph}function showSearchBox($h,Lh){var Sh={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled&&(Object.keys(LiteGraph.registered_slot_in_types||{}).length>0||Object.keys(LiteGraph.registered_slot_out_types||{}).length>0),type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};Lh=Object.assign(Sh,Lh||{});var Eh=this,Gh=LGraphCanvas.active_canvas,Ah=Gh.canvas,Ph=Ah.ownerDocument||document,Nh=document.createElement("div");if(Nh.className="litegraph litesearchbox graphdialog rounded",Nh.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",Lh.do_type_filter&&(Nh.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",Nh.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),Lh.show_close_button&&(Nh.innerHTML+="<button class='close_searchbox close'>X</button>"),Nh.innerHTML+="<div class='helper'></div>",Ph.fullscreenElement?Ph.fullscreenElement.appendChild(Nh):(Ph.body.appendChild(Nh),Ph.body.style.overflow="hidden"),Lh.do_type_filter)var Mh=Nh.querySelector(".slot_in_type_filter"),Dh=Nh.querySelector(".slot_out_type_filter");if(Nh.close=function(){Eh.search_box=null,this.blur(),Ah.focus(),Ph.body.style.overflow="",setTimeout(function(){Eh.canvas.focus()},20),Nh.parentNode&&Nh.parentNode.removeChild(Nh)},this.ds.scale>1&&(Nh.style.transform=`scale(${this.ds.scale})`),Lh.hide_on_mouse_leave){var Fh=0,Ih=null;if(Nh.addEventListener("pointerenter",function(Qh){Ih&&(clearTimeout(Ih),Ih=null)}),Nh.addEventListener("pointerleave",function(Qh){Fh>0||(Ih=setTimeout(function(){Nh.close()},500))}),Lh.do_type_filter){const Qh=function(el){el&&(el.addEventListener("pointerdown",function(nl){Fh++}),el.addEventListener("focus",function(nl){Fh++}),el.addEventListener("blur",function(nl){Fh=Math.max(0,Fh-1)}),el.addEventListener("change",function(nl){Fh=0}))};Qh(Mh),Qh(Dh)}}Eh.search_box&&Eh.search_box.close(),Eh.search_box=Nh;var Hh=Nh.querySelector(".helper"),Wh=null,zh=null,Uh=null,Yh=Nh.querySelector("input");if(Yh&&(Yh.addEventListener("blur",function(Qh){Eh.search_box&&this.focus()}),Yh.addEventListener("keydown",function(Qh){if(Qh.key==="ArrowUp")il(!1);else if(Qh.key==="ArrowDown")il(!0);else if(Qh.key==="Escape")Nh.close();else if(Qh.key==="Enter")Jh(),Uh?Zh(Uh.innerHTML):Wh?Zh(Wh):Nh.close();else{zh&&clearInterval(zh),zh=setTimeout(Jh,250);return}return Qh.preventDefault(),Qh.stopPropagation(),Qh.stopImmediatePropagation(),!0})),Lh.do_type_filter){if(Mh){let Qh=LiteGraph.slot_types_in,el=Qh.length;(Lh.type_filter_in==LiteGraph.EVENT||Lh.type_filter_in==LiteGraph.ACTION)&&(Lh.type_filter_in="_event_");for(let nl=0;nl<el;nl++){let Vh=document.createElement("option");Vh.value=Qh[nl],Vh.innerHTML=Qh[nl],Mh.appendChild(Vh),Lh.type_filter_in!==!1&&(Lh.type_filter_in+"").toLowerCase()==(Qh[nl]+"").toLowerCase()&&(Vh.selected=!0)}Mh.addEventListener("change",function(){Jh()})}if(Dh){let Qh=LiteGraph.slot_types_out,el=Qh.length;(Lh.type_filter_out==LiteGraph.EVENT||Lh.type_filter_out==LiteGraph.ACTION)&&(Lh.type_filter_out="_event_");for(let nl=0;nl<el;nl++){let Vh=document.createElement("option");Vh.value=Qh[nl],Vh.innerHTML=Qh[nl],Dh.appendChild(Vh),Lh.type_filter_out!==!1&&(Lh.type_filter_out+"").toLowerCase()==(Qh[nl]+"").toLowerCase()&&(Vh.selected=!0)}Dh.addEventListener("change",function(){Jh()})}}if(Lh.show_close_button){var Xh=Nh.querySelector(".close");Xh.addEventListener("click",Nh.close)}var jh=Ah.getBoundingClientRect(),qh=($h?$h.clientX:jh.left+jh.width*.5)-80,Kh=($h?$h.clientY:jh.top+jh.height*.5)-20;jh.width-qh<470&&(qh=jh.width-470),jh.height-Kh<220&&(Kh=jh.height-220),qh<jh.left+20&&(qh=jh.left+20),Kh<jh.top+20&&(Kh=jh.top+20),Nh.style.left=qh+"px",Nh.style.top=Kh+"px",Yh.focus(),Lh.show_all_on_open&&Jh();function Zh(Qh){if(Qh)if(Eh.onSearchBoxSelection)Eh.onSearchBoxSelection(Qh,$h,Gh);else{var el=LiteGraph.searchbox_extras[Qh.toLowerCase()];el&&(Qh=el.type),Gh.graph.beforeChange();var nl=LiteGraph.createNode(Qh);if(nl&&(nl.pos=Gh.convertEventToCanvasOffset($h),Gh.graph.add(nl,!1,{doProcessChange:!1})),el&&el.data){if(el.data.properties)for(let sl in el.data.properties)nl.addProperty(sl,el.data.properties[sl]);if(el.data.inputs){nl.inputs=[];for(let sl in el.data.inputs)nl.addOutput(el.data.inputs[sl][0],el.data.inputs[sl][1])}if(el.data.outputs){nl.outputs=[];for(let sl in el.data.outputs)nl.addOutput(el.data.outputs[sl][0],el.data.outputs[sl][1])}el.data.title&&(nl.title=el.data.title),el.data.json&&nl.configure(el.data.json)}let Vh;if(Lh.node_from){switch(Vh=!1,typeof Lh.slot_from){case"string":Vh=Lh.node_from.findOutputSlot(Lh.slot_from);break;case"object":Lh.slot_from.name?Vh=Lh.node_from.findOutputSlot(Lh.slot_from.name):Vh=-1,Vh==-1&&typeof Lh.slot_from.slot_index!="undefined"&&(Vh=Lh.slot_from.slot_index);break;case"number":Vh=Lh.slot_from;break;default:Vh=0}typeof Lh.node_from.outputs[Vh]!="undefined"&&Vh!==!1&&Vh>-1&&Lh.node_from.connectByType(Vh,nl,Lh.node_from.outputs[Vh].type)}if(Lh.node_to){switch(Vh=!1,typeof Lh.slot_from){case"string":Vh=Lh.node_to.findInputSlot(Lh.slot_from);break;case"object":Lh.slot_from.name?Vh=Lh.node_to.findInputSlot(Lh.slot_from.name):Vh=-1,Vh==-1&&typeof Lh.slot_from.slot_index!="undefined"&&(Vh=Lh.slot_from.slot_index);break;case"number":Vh=Lh.slot_from;break;default:Vh=0}typeof Lh.node_to.inputs[Vh]!="undefined"&&Vh!==!1&&Vh>-1&&Lh.node_to.connectByTypeOutput(Vh,nl,Lh.node_to.inputs[Vh].type)}Gh.graph.afterChange()}Nh.close()}function il(Qh){var el=Uh;Uh&&Uh.classList.remove("selected"),Uh?(Uh=Qh?Uh.nextSibling:Uh.previousSibling,Uh||(Uh=el)):Uh=Qh?Hh.childNodes[0]:Hh.childNodes[Hh.childNodes.length],Uh&&(Uh.classList.add("selected"),Uh.scrollIntoView({block:"end",behavior:"smooth"}))}function Jh(){zh=null;var Qh=Yh.value;if(Wh=null,Hh.innerHTML="",!Qh&&!Lh.show_all_if_empty)return;if(Eh.onSearchBox){var el=Eh.onSearchBox(Hh,Qh,Gh);if(el)for(let cl=0;cl<el.length;++cl)ul(el[cl])}else{let cl=function(pl,yl={}){var hl={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},al=Object.assign(hl,yl),fl=LiteGraph.registered_node_types[pl];if(Vh&&fl.filter!=Vh||(!Lh.show_all_if_empty||Qh)&&pl.toLowerCase().indexOf(Qh)===-1)return!1;if(Lh.do_type_filter&&!al.skipFilter){var vl=pl;let kl;var gl=dl.value;if(al.inTypeOverride!==!1&&(gl=al.inTypeOverride),dl&&gl&&LiteGraph.registered_slot_in_types[gl]&&LiteGraph.registered_slot_in_types[gl].nodes&&(kl=LiteGraph.registered_slot_in_types[gl].nodes.includes(vl),kl===!1)||(gl=_l.value,al.outTypeOverride!==!1&&(gl=al.outTypeOverride),_l&&gl&&LiteGraph.registered_slot_out_types[gl]&&LiteGraph.registered_slot_out_types[gl].nodes&&(kl=LiteGraph.registered_slot_out_types[gl].nodes.includes(vl),kl===!1)))return!1}return!0};var nl=0;Qh=Qh.toLowerCase();var Vh=Gh.filter||Gh.graph.filter;let dl,_l;Lh.do_type_filter&&Eh.search_box?(dl=Eh.search_box.querySelector(".slot_in_type_filter"),_l=Eh.search_box.querySelector(".slot_out_type_filter")):(dl=!1,_l=!1);for(let pl in LiteGraph.searchbox_extras){var sl=LiteGraph.searchbox_extras[pl];if(!((!Lh.show_all_if_empty||Qh)&&sl.desc.toLowerCase().indexOf(Qh)===-1)){var rl=LiteGraph.registered_node_types[sl.type];if(!(rl&&rl.filter!=Vh)&&cl(sl.type)&&(ul(sl.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&nl++>LGraphCanvas.search_limit))break}}var ol=null;if(Array.prototype.filter)ol=Object.keys(LiteGraph.registered_node_types).filter(cl);else{ol=[];for(let pl in LiteGraph.registered_node_types)cl(pl)&&ol.push(pl)}for(let pl=0;pl<ol.length&&(ul(ol[pl]),!(LGraphCanvas.search_limit!==-1&&nl++>LGraphCanvas.search_limit));pl++);if(Lh.show_general_after_typefiltered&&(dl.value||_l.value)){var ll=[];for(let pl in LiteGraph.registered_node_types)cl(pl,{inTypeOverride:dl&&dl.value?"*":!1,outTypeOverride:_l&&_l.value?"*":!1})&&ll.push(pl);for(let pl=0;pl<ll.length&&(ul(ll[pl],"generic_type"),!(LGraphCanvas.search_limit!==-1&&nl++>LGraphCanvas.search_limit));pl++);}if((dl.value||_l.value)&&Hh.childNodes.length==0&&Lh.show_general_if_none_on_typefilter){var ll=[];for(let yl in LiteGraph.registered_node_types)cl(yl,{skipFilter:!0})&&ll.push(yl);for(let yl=0;yl<ll.length&&(ul(ll[yl],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&nl++>LGraphCanvas.search_limit));yl++);}}function ul(cl,dl){var _l=document.createElement("div");Wh||(Wh=cl),_l.innerText=cl,_l.dataset.type=encodeURIComponent(cl),_l.className="litegraph lite-search-item",dl&&(_l.className+=" "+dl),_l.addEventListener("click",function(pl){Zh(decodeURIComponent(this.dataset.type))}),Hh.appendChild(_l)}}return Nh}function showEditPropertyValue($h,Lh,Sh){var Eh,Gh,Ah,Ph,Nh;if(!$h||$h.properties[Lh]===void 0)return;Sh=Sh||{};var Mh=$h.getPropertyInfo(Lh),Dh=Mh.type;let Fh;if(Dh=="string"||Dh=="number"||Dh=="array"||Dh=="object")Fh="<input autofocus type='text' class='value'/>";else if((Dh=="enum"||Dh=="combo")&&Mh.values){(Eh=LiteGraph.debug)==null||Eh.call(LiteGraph,"CREATING showEditPropertyValue ENUM COMBO",Wh,Dh,Hh),Fh="<select autofocus type='text' class='value'>";for(let Xh in Mh.values){var Ih=Xh;Mh.values.constructor===Array&&(Ih=Mh.values[Xh]),Fh+="<option value='"+Ih+"' "+(Ih==$h.properties[Lh]?"selected":"")+">"+Mh.values[Xh]+"</option>"}Fh+="</select>"}else if(Dh=="boolean"||Dh=="toggle")Fh="<input autofocus type='checkbox' class='value' "+($h.properties[Lh]?"checked":"")+"/>";else{(Gh=LiteGraph.warn)==null||Gh.call(LiteGraph,"unknown type: "+Dh);return}var Hh=this.createDialog("<span class='name'>"+(Mh.label?Mh.label:Lh)+"</span>"+Fh+"<button>OK</button>",Sh),Wh=!1;(Dh=="enum"||Dh=="combo")&&Mh.values?((Ah=LiteGraph.debug)==null||Ah.call(LiteGraph,"showEditPropertyValue ENUM COMBO",Wh,Dh,Hh),Wh=Hh.querySelector("select"),Wh.addEventListener("change",function(Xh){var jh;Hh.modified(),(jh=LiteGraph.debug)==null||jh.call(LiteGraph,"Enum change",Wh,Mh,Xh.target),Yh(Xh.target.value)})):Dh=="boolean"||Dh=="toggle"?((Ph=LiteGraph.debug)==null||Ph.call(LiteGraph,"showEditPropertyValue TOGGLE",Wh,Dh,Hh),Wh=Hh.querySelector("input"),Wh&&Wh.addEventListener("click",function(Xh){Hh.modified(),Yh(!!Wh.checked)})):(Wh=Hh.querySelector("input"),(Nh=LiteGraph.debug)==null||Nh.call(LiteGraph,"showEditPropertyValue",Wh,Dh,Hh),Wh&&(Wh.addEventListener("blur",function(Xh){this.focus()}),Ih=$h.properties[Lh]!==void 0?$h.properties[Lh]:"",Dh!=="string"&&(Ih=JSON.stringify(Ih)),Wh.value=Ih,Wh.addEventListener("keydown",function(Xh){if(Xh.keyCode==27)Hh.close();else if(Xh.keyCode==13)Uh();else if(Xh.keyCode!=13){Hh.modified();return}Xh.preventDefault(),Xh.stopPropagation()}))),Wh&&Wh.focus();var zh=Hh.querySelector("button");zh.addEventListener("click",Uh);function Uh(){Yh(Wh.value)}function Yh(Xh){var jh;Mh&&Mh.values&&Mh.values.constructor===Object&&Mh.values[Xh]!=null&&(Xh=Mh.values[Xh]),typeof $h.properties[Lh]=="number"&&(Xh=Number(Xh)),(Dh=="array"||Dh=="object")&&(Xh=JSON.parse(Xh)),$h.properties[Lh]=Xh,(jh=$h.graph)==null||jh.onGraphChanged({action:"propertyChanged",doSave:!0}),$h.onPropertyChanged&&$h.onPropertyChanged(Lh,Xh),Sh.onclose&&Sh.onclose(),Hh.close(),$h.setDirtyCanvas(!0,!0)}return Hh}function createDialog($h,Lh){var Sh={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};Lh=Object.assign(Sh,Lh||{});var Eh=document.createElement("div");Eh.className="graphdialog",Eh.innerHTML=$h,Eh.is_modified=!1;var Gh=this.canvas.getBoundingClientRect(),Ah=-20,Ph=-20;if(Gh&&(Ah-=Gh.left,Ph-=Gh.top),Lh.position?(Ah+=Lh.position[0],Ph+=Lh.position[1]):Lh.event?(Ah+=Lh.event.clientX,Ph+=Lh.event.clientY):(Ah+=this.canvas.width*.5,Ph+=this.canvas.height*.5),Eh.style.left=Ah+"px",Eh.style.top=Ph+"px",this.canvas.parentNode.appendChild(Eh),Lh.checkForInput){var Nh=[],Mh=!1;Nh=Eh.querySelectorAll("input"),Nh&&Nh.forEach(function(Hh){Hh.addEventListener("keydown",function(Wh){if(Eh.modified(),Wh.keyCode==27)Eh.close();else if(Wh.keyCode!=13)return;Wh.preventDefault(),Wh.stopPropagation()}),Mh||Hh.focus()})}Eh.modified=function(){Eh.is_modified=!0},Eh.close=function(){Eh.parentNode&&Eh.parentNode.removeChild(Eh)};var Dh=null,Fh=0;Eh.addEventListener("pointerleave",function(Hh){Fh>0||(Lh.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!Eh.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(Dh=setTimeout(Eh.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),Eh.addEventListener("pointerenter",function(Hh){(Lh.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&Dh&&clearTimeout(Dh)});var Ih=Eh.querySelectorAll("select");return Ih&&Ih.forEach(function(Hh){Hh.addEventListener("pointerdown",function(Wh){Fh++}),Hh.addEventListener("focus",function(Wh){Fh++}),Hh.addEventListener("blur",function(Wh){Fh=Math.max(0,Fh-1)}),Hh.addEventListener("change",function(Wh){Fh=0})}),Eh}function createPanel($h,Lh){Lh=Lh||{};var Sh=Lh.window||window,Eh=document.createElement("div");if(Eh.className="litegraph dialog",Eh.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",Eh.header=Eh.querySelector(".dialog-header"),Lh.width&&(Eh.style.width=Lh.width+(Lh.width.constructor===Number?"px":"")),Lh.height&&(Eh.style.height=Lh.height+(Lh.height.constructor===Number?"px":"")),Lh.closable){var Gh=document.createElement("span");Gh.innerHTML="&#10005;",Gh.classList.add("close"),Gh.addEventListener("click",function(){Eh.close()}),Eh.header.appendChild(Gh)}return Eh.title_element=Eh.querySelector(".dialog-title"),Eh.title_element.innerText=$h,Eh.content=Eh.querySelector(".dialog-content"),Eh.alt_content=Eh.querySelector(".dialog-alt-content"),Eh.footer=Eh.querySelector(".dialog-footer"),Eh.close=function(){Eh.onClose&&typeof Eh.onClose=="function"&&Eh.onClose(),Eh.parentNode&&Eh.parentNode.removeChild(Eh)},Eh.toggleAltContent=function(Ah){let Ph,Nh;typeof Ah!="undefined"?(Ph=Ah?"block":"none",Nh=Ah?"none":"block"):(Ph=Eh.alt_content.style.display!="block"?"block":"none",Nh=Eh.alt_content.style.display!="block"?"none":"block"),Eh.alt_content.style.display=Ph,Eh.content.style.display=Nh},Eh.toggleFooterVisibility=function(Ah){let Ph;typeof Ah!="undefined"?Ph=Ah?"block":"none":Ph=Eh.footer.style.display!="block"?"block":"none",Eh.footer.style.display=Ph},Eh.clear=function(){this.content.innerHTML=""},Eh.addHTML=function(Ah,Ph,Nh){var Mh=document.createElement("div");return Ph&&(Mh.className=Ph),Mh.innerHTML=Ah,Nh?Eh.footer.appendChild(Mh):Eh.content.appendChild(Mh),Mh},Eh.addButton=function(Ah,Ph,Nh){var Mh=document.createElement("button");return Mh.innerText=Ah,Mh.options=Nh,Mh.classList.add("btn"),Mh.addEventListener("click",Ph),Eh.footer.appendChild(Mh),Mh},Eh.addSeparator=function(){var Ah=document.createElement("div");Ah.className="separator",Eh.content.appendChild(Ah)},Eh.addWidget=function(Ah,Ph,Nh,Mh,Dh){var Fh,Ih;Mh=Mh||{};var Hh=String(Nh);Ah=Ah.toLowerCase(),Ah=="number"&&(Hh=Nh.toFixed(3));var Wh=document.createElement("div");Wh.className="property",Wh.innerHTML="<span class='property_name'></span><span class='property_value'></span>",Wh.querySelector(".property_name").innerText=Mh.label||Ph;var zh=Wh.querySelector(".property_value");zh.innerText=Hh,Wh.dataset.property=Ph,Wh.dataset.type=Mh.type||Ah,Wh.options=Mh,Wh.value=Nh,(Fh=LiteGraph.debug)==null||Fh.call(LiteGraph,"addWidget",Ah,Nh,zh,Mh),Ah=="code"?Wh.addEventListener("click",function(Yh){Eh.inner_showCodePad(this.dataset.property)}):Ah=="boolean"?(Wh.classList.add("boolean"),Nh&&Wh.classList.add("bool-on"),Wh.addEventListener("click",function(){var Yh=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",Uh(Yh,this.value)})):Ah=="string"||Ah=="number"?(zh.setAttribute("contenteditable",!0),zh.addEventListener("keydown",function(Yh){Yh.code=="Enter"&&(Ah!="string"||!Yh.shiftKey)&&(Yh.preventDefault(),this.blur())}),zh.addEventListener("blur",function(){var Yh=this.innerText,Xh=this.parentNode.dataset.property,jh=this.parentNode.dataset.type;jh=="number"&&(Yh=Number(Yh)),Uh(Xh,Yh)})):(Ah=="enum"||Ah=="combo")&&(Hh=LGraphCanvas.getPropertyPrintableValue(Nh,Mh.values),zh.innerText=Hh,(Ih=LiteGraph.debug)==null||Ih.call(LiteGraph,"addWidget ENUM COMBO",Ah,Hh,zh,Mh),zh.addEventListener("click",function(Yh){var Xh=Mh.values||[],jh=this.parentNode.dataset.property,qh=this;new LiteGraph.ContextMenu(Xh,{event:Yh,className:"dark",callback:Kh},Sh);function Kh(Zh){return qh.innerText=Zh,Uh(jh,Zh),!1}})),Eh.content.appendChild(Wh);function Uh(Yh,Xh){var jh;(jh=LiteGraph.debug)==null||jh.call(LiteGraph,"widgetInnerChange",Yh,Xh,Mh),Mh.callback&&Mh.callback(Yh,Xh,Mh),Dh&&Dh(Yh,Xh,Mh)}return Wh},Eh.onOpen&&typeof Eh.onOpen=="function"&&Eh.onOpen(),Eh}function closePanels(){var $h=document.querySelector("#node-panel");$h&&$h.close(),$h=document.querySelector("#option-panel"),$h&&$h.close()}function showShowGraphOptionsPanel($h,Lh){var Sh,Eh,Gh,Ah;let Ph;if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!((Eh=(Sh=Lh==null?void 0:Lh.event)==null?void 0:Sh.target)!=null&&Eh.lgraphcanvas)){(Gh=LiteGraph.warn)==null||Gh.call(LiteGraph,"References not found to add optionPanel",$h,Lh),LiteGraph.debug&&((Ah=LiteGraph.debug)==null||Ah.call(LiteGraph,"!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas",Lh,Lh.event,Lh.event.target,Lh.event.target.lgraphcanvas));return}Ph=Lh.event.target.lgraphcanvas}else Ph=this;Ph.closePanels();var Nh=Ph.getCanvasWindow();panel=Ph.createPanel("Options",{closable:!0,window:Nh,onOpen:function(){Ph.OPTIONPANEL_IS_OPEN=!0},onClose:function(){Ph.OPTIONPANEL_IS_OPEN=!1,Ph.options_panel=null}}),Ph.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function Mh(){panel.content.innerHTML="";const Dh=(Wh,zh,Uh)=>{Uh&&Uh.key&&(Wh=Uh.key),Uh.values&&(zh=Object.values(Uh.values).indexOf(zh)),Ph[Wh]=zh};var Fh=LiteGraph.availableCanvasOptions;Fh.sort();for(var Ih in Fh){var Hh=Fh[Ih];panel.addWidget("boolean",Hh,Ph[Hh],{key:Hh,on:"True",off:"False"},Dh)}panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[Ph.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},Dh),panel.addSeparator(),panel.footer.innerHTML=""}Mh(),Ph.canvas.parentNode.appendChild(panel)}function showShowNodePanel($h){this.SELECTED_NODE=$h,this.closePanels();var Lh=this.getCanvasWindow(),Sh=this,Eh=this.createPanel($h.title||"",{closable:!0,window:Lh,onOpen:function(){Sh.NODEPANEL_IS_OPEN=!0},onClose:function(){Sh.NODEPANEL_IS_OPEN=!1,Sh.node_panel=null}});Sh.node_panel=Eh,Eh.id="node-panel",Eh.node=$h,Eh.classList.add("settings");function Gh(){Eh.content.innerHTML="",Eh.addHTML("<span class='node_type'>"+$h.type+"</span><span class='node_desc'>"+($h.constructor.desc||"")+"</span><span class='separator'></span>"),Eh.addHTML("<h3>Properties</h3>");const Ah=(Fh,Ih)=>{var Hh,Wh;switch(Sh.graph.beforeChange($h),Fh){case"Title":$h.title=Ih;break;case"Mode":var zh=Object.values(LiteGraph.NODE_MODES).indexOf(Ih);zh>=0&&LiteGraph.NODE_MODES[zh]?$h.changeMode(zh):(Hh=LiteGraph.warn)==null||Hh.call(LiteGraph,"unexpected mode: "+Ih);break;case"Color":LGraphCanvas.node_colors[Ih]?($h.color=LGraphCanvas.node_colors[Ih].color,$h.bgcolor=LGraphCanvas.node_colors[Ih].bgcolor):(Wh=LiteGraph.warn)==null||Wh.call(LiteGraph,"unexpected color: "+Ih);break;default:$h.setProperty(Fh,Ih);break}Sh.graph.afterChange(),Sh.dirty_canvas=!0};Eh.addWidget("string","Title",$h.title,{},Ah),Eh.addWidget("combo","Mode",LiteGraph.NODE_MODES[$h.mode],{values:LiteGraph.NODE_MODES},Ah);var Ph="";$h.color!==void 0&&(Ph=Object.keys(LGraphCanvas.node_colors).filter(function(Fh){return LGraphCanvas.node_colors[Fh].color==$h.color})),Eh.addWidget("combo","Color",Ph,{values:Object.keys(LGraphCanvas.node_colors)},Ah);for(var Nh in $h.properties){var Mh=$h.properties[Nh],Dh=$h.getPropertyInfo(Nh);$h.onAddPropertyToPanel&&$h.onAddPropertyToPanel(Nh,Eh,Mh,Dh,Ah)||Eh.addWidget(Dh.widget||Dh.type,Nh,Mh,Dh,Ah)}Eh.addSeparator(),$h.onShowCustomPanelInfo&&$h.onShowCustomPanelInfo(Eh),Eh.footer.innerHTML="",Eh.addButton("Delete",function(){$h.block_delete||($h.graph.remove($h),Eh.close())}).classList.add("delete")}Eh.inner_showCodePad=function(Ah){Eh.classList.remove("settings"),Eh.classList.add("centered"),Eh.alt_content.innerHTML="<textarea class='code'></textarea>";var Ph=Eh.alt_content.querySelector("textarea"),Nh=()=>{Eh.toggleAltContent(!1),Eh.toggleFooterVisibility(!0),Ph.parentNode.removeChild(Ph),Eh.classList.add("settings"),Eh.classList.remove("centered"),Gh()};Ph.value=$h.properties[Ah],Ph.addEventListener("keydown",function(Fh){Fh.code=="Enter"&&Fh.ctrlKey&&($h.setProperty(Ah,Ph.value),Nh())}),Eh.toggleAltContent(!0),Eh.toggleFooterVisibility(!1),Ph.style.height="calc(100% - 40px)";var Mh=Eh.addButton("Assign",function(){$h.setProperty(Ah,Ph.value),Nh()});Eh.alt_content.appendChild(Mh);var Dh=Eh.addButton("Close",Nh);Dh.style.float="right",Eh.alt_content.appendChild(Dh)},Gh(),this.canvas.parentNode.appendChild(Eh)}function showSubgraphPropertiesDialog($h){var Lh;(Lh=LiteGraph.log)==null||Lh.call(LiteGraph,"showing subgraph properties dialog");var Sh=this.canvas.parentNode.querySelector(".subgraph_dialog");Sh&&Sh.close();var Eh=this.createPanel("Subgraph Inputs",{closable:!0,width:500});Eh.node=$h,Eh.classList.add("subgraph_dialog");function Gh(){if(Eh.clear(),$h.inputs)for(let Fh=0;Fh<$h.inputs.length;++Fh){var Nh=$h.inputs[Fh];if(!Nh.not_subgraph_input){var Mh="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",Dh=Eh.addHTML(Mh,"subgraph_property");Dh.dataset.name=Nh.name,Dh.dataset.slot=Fh,Dh.querySelector(".name").innerText=Nh.name,Dh.querySelector(".type").innerText=Nh.type,Dh.querySelector("button").addEventListener("click",function(Ih){$h.removeInput(Number(this.parentNode.dataset.slot)),Gh()})}}}var Ah=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",Ph=Eh.addHTML(Ah,"subgraph_property extra",!0);return Ph.querySelector("button").addEventListener("click",function(Nh){var Mh=this.parentNode,Dh=Mh.querySelector(".name").value,Fh=Mh.querySelector(".type").value;!Dh||$h.findInputSlot(Dh)!=-1||($h.addInput(Dh,Fh),Mh.querySelector(".name").value="",Mh.querySelector(".type").value="",Gh())}),Gh(),this.canvas.parentNode.appendChild(Eh),Eh}function showSubgraphPropertiesDialogRight($h){var Lh=this.canvas.parentNode.querySelector(".subgraph_dialog");Lh&&Lh.close();var Sh=this.createPanel("Subgraph Outputs",{closable:!0,width:500});Sh.node=$h,Sh.classList.add("subgraph_dialog");function Eh(){if(Sh.clear(),$h.outputs)for(let Fh=0;Fh<$h.outputs.length;++Fh){var Nh=$h.outputs[Fh];if(!Nh.not_subgraph_output){var Mh="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",Dh=Sh.addHTML(Mh,"subgraph_property");Dh.dataset.name=Nh.name,Dh.dataset.slot=Fh,Dh.querySelector(".name").innerText=Nh.name,Dh.querySelector(".type").innerText=Nh.type,Dh.querySelector("button").addEventListener("click",function(Ih){$h.removeOutput(Number(this.parentNode.dataset.slot)),Eh()})}}}var Gh=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",Ah=Sh.addHTML(Gh,"subgraph_property extra",!0);Ah.querySelector(".name").addEventListener("keydown",function(Nh){e.keyCode==13&&Ph.apply(this)}),Ah.querySelector("button").addEventListener("click",function(Nh){Ph.apply(this)});function Ph(){var Nh=this.parentNode,Mh=Nh.querySelector(".name").value,Dh=Nh.querySelector(".type").value;!Mh||$h.findOutputSlot(Mh)!=-1||($h.addOutput(Mh,Dh),Nh.querySelector(".name").value="",Nh.querySelector(".type").value="",Eh())}return Eh(),this.canvas.parentNode.appendChild(Sh),Sh}function checkPanels(){if(this.canvas){var $h=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(let Sh=0;Sh<$h.length;++Sh){var Lh=$h[Sh];Lh.node&&(!Lh.node.graph||Lh.graph!=this.graph)&&Lh.close()}}}class UiController{constructor(Lh){this.host=Lh}showLinkMenu(...Lh){return showLinkMenu.apply(this.host,Lh)}createDefaultNodeForSlot(...Lh){return createDefaultNodeForSlot.apply(this.host,Lh)}showConnectionMenu(...Lh){return showConnectionMenu.apply(this.host,Lh)}getCanvasMenuOptions(...Lh){return getCanvasMenuOptions.apply(this.host,Lh)}getNodeMenuOptions(...Lh){return getNodeMenuOptions.apply(this.host,Lh)}getGroupMenuOptions(...Lh){return getGroupMenuOptions.apply(this.host,Lh)}processContextMenu(...Lh){return processContextMenu.apply(this.host,Lh)}prompt(...Lh){return prompt.apply(this.host,Lh)}showSearchBox(...Lh){return showSearchBox.apply(this.host,Lh)}showEditPropertyValue(...Lh){return showEditPropertyValue.apply(this.host,Lh)}createDialog(...Lh){return createDialog.apply(this.host,Lh)}createPanel(...Lh){return createPanel.apply(this.host,Lh)}closePanels(...Lh){return closePanels.apply(this.host,Lh)}showShowGraphOptionsPanel(...Lh){return showShowGraphOptionsPanel.apply(this.host,Lh)}showShowNodePanel(...Lh){return showShowNodePanel.apply(this.host,Lh)}showSubgraphPropertiesDialog(...Lh){return showSubgraphPropertiesDialog.apply(this.host,Lh)}showSubgraphPropertiesDialogRight(...Lh){return showSubgraphPropertiesDialogRight.apply(this.host,Lh)}checkPanels(...Lh){return checkPanels.apply(this.host,Lh)}}function createLGraphCanvasControllers($h){return{core:new CoreController($h),events:new EventsController($h),render:new RenderController($h),selection:new SelectionController($h),ui:new UiController($h)}}const delegateMap={clear:"core",setGraph:"core",getTopGraph:"core",openSubgraph:"core",closeSubgraph:"core",getCurrentGraph:"core",setCanvas:"core",_doNothing:"core",_doReturnTrue:"core",bindEvents:"core",unbindEvents:"core",enableWebGL:"core",setDirty:"core",getCanvasWindow:"core",startRendering:"core",stopRendering:"core",blockClick:"events",processUserInputDown:"events",processMouseDown:"events",processMouseMove:"events",processMouseUp:"events",processMouseWheel:"events",isOverNodeBox:"core",isOverNodeInput:"core",isOverNodeOutput:"core",processKey:"events",copyToClipboard:"selection",pasteFromClipboard:"selection",processDrop:"events",checkDropItem:"events",processNodeDblClicked:"selection",processNodeSelected:"selection",selectNode:"selection",selectNodes:"selection",deselectNode:"selection",deselectAllNodes:"selection",deleteSelectedNodes:"selection",centerOnNode:"core",adjustMouseEvent:"core",setZoom:"core",convertOffsetToCanvas:"core",convertCanvasToOffset:"core",convertEventToCanvasOffset:"core",bringToFront:"core",sendToBack:"core",computeVisibleNodes:"core",draw:"render",drawFrontCanvas:"render",beginNodeFrameLeafer:"render",endNodeFrameLeafer:"render",drawSubgraphPanel:"render",drawSubgraphPanelLeft:"render",drawSubgraphPanelRight:"render",drawButton:"render",isAreaClicked:"render",renderInfo:"render",drawBackCanvas:"render",drawNode:"render",drawNodeTooltip:"render",drawLinkTooltip:"render",drawNodeShape:"render",drawConnections:"render",renderLink:"render",computeConnectionPoint:"render",drawExecutionOrder:"render",drawNodeWidgets:"render",processNodeWidgets:"render",drawGroups:"render",adjustNodesSize:"render",resize:"core",switchLiveMode:"core",onNodeSelectionChange:"selection",boundaryNodesForSelection:"selection",showLinkMenu:"ui",createDefaultNodeForSlot:"ui",showConnectionMenu:"ui",prompt:"ui",showSearchBox:"ui",showEditPropertyValue:"ui",createDialog:"ui",createPanel:"ui",closePanels:"ui",showShowGraphOptionsPanel:"ui",showShowNodePanel:"ui",showSubgraphPropertiesDialog:"ui",showSubgraphPropertiesDialogRight:"ui",checkPanels:"ui",getCanvasMenuOptions:"ui",getNodeMenuOptions:"ui",getGroupMenuOptions:"ui",processContextMenu:"ui",lowQualityRenderingRequired:"render"};function ensureControllers($h){return $h.controllers||($h.controllers=createLGraphCanvasControllers($h)),$h.controllers}function installLGraphCanvasDelegates($h){for(const[Lh,Sh]of Object.entries(delegateMap))Object.defineProperty($h.prototype,Lh,{value:function(...Eh){return ensureControllers(this)[Sh][Lh](...Eh)},writable:!0,configurable:!0})}function getFileExtension($h){const Lh=new URL($h).pathname,Sh=Lh.lastIndexOf(".");return Sh===-1?"":Lh.slice(Sh+1).toLowerCase()}function onGroupAdd($h,Lh,Sh){var Eh=LGraphCanvas.active_canvas,Gh=new LiteGraph.LGraphGroup;Gh.pos=Eh.convertEventToCanvasOffset(Sh),Eh.graph.add(Gh)}function getBoundaryNodes($h){let Lh=null,Sh=null,Eh=null,Gh=null;for(const Ah in $h){const Ph=$h[Ah],[Nh,Mh]=Ph.pos,[Dh,Fh]=Ph.size;(Lh===null||Mh<Lh.pos[1])&&(Lh=Ph),(Sh===null||Nh+Dh>Sh.pos[0]+Sh.size[0])&&(Sh=Ph),(Eh===null||Mh+Fh>Eh.pos[1]+Eh.size[1])&&(Eh=Ph),(Gh===null||Nh<Gh.pos[0])&&(Gh=Ph)}return{top:Lh,right:Sh,bottom:Eh,left:Gh}}function alignNodes($h,Lh,Sh){if(!$h)return;const Eh=LGraphCanvas.active_canvas;let Gh=[];Sh===void 0?Gh=LGraphCanvas.getBoundaryNodes($h):Gh={top:Sh,right:Sh,bottom:Sh,left:Sh};for(const[Ah,Ph]of Object.entries(Eh.selected_nodes))switch(Lh){case"right":Ph.pos[0]=Gh.right.pos[0]+Gh.right.size[0]-Ph.size[0];break;case"left":Ph.pos[0]=Gh.left.pos[0];break;case"top":Ph.pos[1]=Gh.top.pos[1];break;case"bottom":Ph.pos[1]=Gh.bottom.pos[1]+Gh.bottom.size[1]-Ph.size[1];break}Eh.dirty_canvas=!0,Eh.dirty_bgcanvas=!0}function onNodeAlign($h,Lh,Sh,Eh,Gh){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:Sh,callback:Ah,parentMenu:Eh});function Ah(Ph){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,Ph.toLowerCase(),Gh)}}function onGroupAlign($h,Lh,Sh,Eh){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:Sh,callback:Gh,parentMenu:Eh});function Gh(Ah){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,Ah.toLowerCase())}}function onMenuAdd($h,Lh,Sh,Eh,Gh){var Ah=LGraphCanvas.active_canvas,Ph=Ah.getCanvasWindow(),Nh=Ah.graph;if(!Nh)return;function Mh(Dh,Fh){var Ih=LiteGraph.getNodeTypesCategories(Ah.filter||Nh.filter).filter(function(zh){return zh.startsWith(Dh)}),Hh=[];Ih.map(function(zh){if(zh){var Uh=new RegExp("^("+Dh+")"),Yh=zh.replace(Uh,"").split("/")[0],Xh=Dh===""?Yh+"/":Dh+Yh+"/",jh=Yh;jh.indexOf("::")!=-1&&(jh=jh.split("::")[1]);var qh=Hh.findIndex(function(Kh){return Kh.value===Xh});qh===-1&&Hh.push({value:Xh,content:jh,has_submenu:!0,callback:function(Kh,Zh,il,Jh){Mh(Kh.value,Jh)}})}});var Wh=LiteGraph.getNodeTypesInCategory(Dh.slice(0,-1),Ah.filter||Nh.filter);Wh.map(function(zh){if(!zh.skip_list){var Uh={value:zh.type,content:zh.title,has_submenu:!1,callback:function(Yh,Xh,jh,qh){var Kh=qh.getFirstEvent();Ah.graph.beforeChange();var Zh=LiteGraph.createNode(Yh.value);Zh&&(Zh.pos=Ah.convertEventToCanvasOffset(Kh),Ah.graph.add(Zh)),Gh&&Gh(Zh),Ah.graph.afterChange()}};Hh.push(Uh)}}),new LiteGraph.ContextMenu(Hh,{event:Sh,parentMenu:Fh},Ph)}return Mh("",Eh),!1}function onMenuCollapseAll(){}function onMenuNodeEdit(){}function showMenuNodeOptionalInputs($h,Lh,Sh,Eh,Gh){var Ah;if(!Gh)return;var Ph=this,Nh=LGraphCanvas.active_canvas,Mh=Nh.getCanvasWindow();Lh=Gh.optional_inputs,Gh.onGetInputs&&(Lh=Gh.onGetInputs());var Dh=[];if(Lh)for(let Uh=0;Uh<Lh.length;Uh++){var Fh=Lh[Uh];if(!Fh){Dh.push(null);continue}var Ih=Fh[0];Fh[2]||(Fh[2]={}),Fh[2].label&&(Ih=Fh[2].label),Fh[2].removable=!0;var Hh={content:Ih,value:Fh};Fh[1]==LiteGraph.ACTION&&(Hh.className="event"),Dh.push(Hh)}if(Gh.onMenuNodeInputs){var Wh=Gh.onMenuNodeInputs(Dh);Wh&&(Dh=Wh)}if(LiteGraph.do_add_triggers_slots&&Gh.findInputSlot("onTrigger")==-1&&Dh.push({content:"On Trigger",value:["onTrigger",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),!Dh.length){LiteGraph.debug&&((Ah=LiteGraph.log)==null||Ah.call(LiteGraph,"no input entries"));return}new LiteGraph.ContextMenu(Dh,{event:Sh,callback:zh,parentMenu:Eh,node:Gh},Mh);function zh(Uh,Yh,Xh){var jh;if(Gh&&(Uh.callback&&Uh.callback.call(Ph,Gh,Uh,Yh,Xh),Uh.value)){Gh.graph.beforeChange();const qh=Uh.value[2]?Object.assign({},Uh.value[2]):{};Gh.addInput(Uh.value[0],Uh.value[1],qh),(jh=Gh.onNodeInputAdd)==null||jh.call(Gh,Uh.value),Gh.setDirtyCanvas(!0,!0),Gh.graph.afterChange()}}return!1}function showMenuNodeOptionalOutputs($h,Lh,Sh,Eh,Gh){if(!Gh)return;var Ah=this,Ph=LGraphCanvas.active_canvas,Nh=Ph.getCanvasWindow();Lh=Gh.optional_outputs,Gh.onGetOutputs&&(Lh=Gh.onGetOutputs());var Mh=[];if(Lh)for(let zh=0;zh<Lh.length;zh++){var Dh=Lh[zh];if(!Dh){Mh.push(null);continue}if(!(Gh.flags&&Gh.flags.skip_repeated_outputs&&Gh.findOutputSlot(Dh[0])!=-1)){var Fh=Dh[0];Dh[2]||(Dh[2]={}),Dh[2].label&&(Fh=Dh[2].label),Dh[2].removable=!0;var Ih={content:Fh,value:Dh};Dh[1]==LiteGraph.EVENT&&(Ih.className="event"),Mh.push(Ih)}}if(this.onMenuNodeOutputs&&(Mh=this.onMenuNodeOutputs(Mh)),LiteGraph.do_add_triggers_slots&&Gh.findOutputSlot("onExecuted")==-1&&Mh.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),Gh.onMenuNodeOutputs){var Hh=Gh.onMenuNodeOutputs(Mh);Hh&&(Mh=Hh)}if(!Mh.length)return;new LiteGraph.ContextMenu(Mh,{event:Sh,callback:Wh,parentMenu:Eh,node:Gh},Nh);function Wh(zh,Uh,Yh){var Xh;if(Gh&&(zh.callback&&zh.callback.call(Ah,Gh,zh,Uh,Yh),!!zh.value)){var jh=zh.value[1];if(jh&&(jh.constructor===Object||jh.constructor===Array)){var qh=[];for(let Kh in jh)qh.push({content:Kh,value:jh[Kh]});return new LiteGraph.ContextMenu(qh,{event:Uh,callback:Wh,parentMenu:Eh,node:Gh}),!1}else{Gh.graph.beforeChange();const Kh=zh.value[2]?Object.assign({},zh.value[2]):{};Gh.addOutput(zh.value[0],zh.value[1],Kh),(Xh=Gh.onNodeOutputAdd)==null||Xh.call(Gh,zh.value),Gh.setDirtyCanvas(!0,!0),Gh.graph.afterChange()}}}return!1}function onShowMenuNodeProperties($h,Lh,Sh,Eh,Gh){if(!Gh||!Gh.properties)return;var Ah=LGraphCanvas.active_canvas,Ph=Ah.getCanvasWindow(),Nh=[];for(let Fh in Gh.properties){$h=Gh.properties[Fh]!==void 0?Gh.properties[Fh]:" ",typeof $h=="object"&&($h=JSON.stringify($h));var Mh=Gh.getPropertyInfo(Fh);(Mh.type=="enum"||Mh.type=="combo")&&($h=LGraphCanvas.getPropertyPrintableValue($h,Mh.values)),$h=LGraphCanvas.decodeHTML($h),Nh.push({content:"<span class='property_name'>"+(Mh.label?Mh.label:Fh)+"</span><span class='property_value'>"+$h+"</span>",value:Fh})}if(!Nh.length)return;new LiteGraph.ContextMenu(Nh,{event:Sh,callback:Dh,parentMenu:Eh,allow_html:!0,node:Gh},Ph);function Dh(Fh){if(Gh){var Ih=this.getBoundingClientRect();Ah.showEditPropertyValue(Gh,Fh.value,{position:[Ih.left,Ih.top]})}}return!1}function decodeHTML($h){var Lh=document.createElement("div");return Lh.innerText=$h,Lh.innerHTML}function onMenuResizeNode($h,Lh,Sh,Eh,Gh){if(!Gh)return;const Ah=Nh=>{Nh.size=Nh.computeSize(),Nh.onResize&&Nh.onResize(Nh.size)};var Ph=LGraphCanvas.active_canvas;if(!Ph.selected_nodes||Object.keys(Ph.selected_nodes).length<=1)Ah(Gh);else for(let Nh in Ph.selected_nodes)Ah(Ph.selected_nodes[Nh]);Gh.setDirtyCanvas(!0,!0)}function onShowPropertyEditor($h,Lh,Sh,Eh,Gh){var Ah=$h.property||"title",Ph=Gh[Ah],Nh=document.createElement("div");Nh.is_modified=!1,Nh.className="graphdialog",Nh.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",Nh.close=()=>{var qh;(qh=Nh.parentNode)==null||qh.removeChild(Nh)};var Mh=Nh.querySelector(".name");Mh.innerText=Ah;var Dh=Nh.querySelector(".value");const Fh=()=>{Dh&&jh(Dh.value)};Dh&&(Dh.value=Ph,Dh.addEventListener("blur",function(qh){this.focus()}),Dh.addEventListener("keydown",function(qh){if(Nh.is_modified=!0,qh.keyCode==27)Nh.close();else if(qh.keyCode==13)Fh();else if(qh.keyCode!=13&&qh.target.localName!="textarea")return;qh.preventDefault(),qh.stopPropagation()}));var Ih=LGraphCanvas.active_canvas,Hh=Ih.canvas,Wh=Hh.getBoundingClientRect(),zh=-20,Uh=-20;Wh&&(zh-=Wh.left,Uh-=Wh.top),Sh?(Nh.style.left=Sh.clientX+zh+"px",Nh.style.top=Sh.clientY+Uh+"px"):(Nh.style.left=Hh.width*.5+zh+"px",Nh.style.top=Hh.height*.5+Uh+"px");var Yh=Nh.querySelector("button");Yh.addEventListener("click",Fh),Hh.parentNode.appendChild(Nh),Dh&&Dh.focus();let Xh=null;Nh.addEventListener("pointerleave",qh=>{LiteGraph.dialog_close_on_mouse_leave&&!Nh.is_modified&&(Xh=setTimeout(Nh.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),Nh.addEventListener("pointerenter",qh=>{LiteGraph.dialog_close_on_mouse_leave&&Xh&&clearTimeout(Xh)});const jh=qh=>{var Kh;switch($h.type){case"Number":qh=Number(qh);break;case"Boolean":qh=!!qh;break}Gh[Ah]=qh,(Kh=Nh.parentNode)==null||Kh.removeChild(Nh),Gh.setDirtyCanvas(!0,!0)}}function getPropertyPrintableValue($h,Lh){if(!Lh||Lh.constructor===Array)return String($h);if(Lh.constructor===Object){var Sh="";for(var Eh in Lh)if(Lh[Eh]==$h){Sh=Eh;break}return String($h)+" ("+Sh+")"}}function onMenuNodeCollapse($h,Lh,Sh,Eh,Gh){Gh.graph.beforeChange();var Ah=function(Nh){Nh.collapse()},Ph=LGraphCanvas.active_canvas;if(!Ph.selected_nodes||Object.keys(Ph.selected_nodes).length<=1)Ah(Gh);else for(let Nh in Ph.selected_nodes)Ah(Ph.selected_nodes[Nh]);Gh.graph.afterChange()}function onMenuNodePin($h,Lh,Sh,Eh,Gh){Gh.pin()}function onMenuNodeMode($h,Lh,Sh,Eh,Gh){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:Sh,callback:Ah,parentMenu:Eh,node:Gh});function Ah(Ph){if(!Gh)return;var Nh=Object.values(LiteGraph.NODE_MODES).indexOf(Ph);const Mh=Fh=>{var Ih;Nh>=0&&LiteGraph.NODE_MODES[Nh]?Fh.changeMode(Nh):((Ih=LiteGraph.warn)==null||Ih.call(LiteGraph,"unexpected mode: "+Ph),Fh.changeMode(LiteGraph.ALWAYS))};var Dh=LGraphCanvas.active_canvas;if(!Dh.selected_nodes||Object.keys(Dh.selected_nodes).length<=1)Mh(Gh);else for(let Fh in Dh.selected_nodes)Mh(Dh.selected_nodes[Fh])}return!1}function onMenuNodeColors($h,Lh,Sh,Eh,Gh){if(!Gh)throw new Error("no node for color");var Ah=[];Ah.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(let Nh in LGraphCanvas.node_colors){let Mh=LGraphCanvas.node_colors[Nh];$h={value:Nh,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+Mh.color+"; background-color:"+Mh.bgcolor+"'>"+Nh+"</span>"},Ah.push($h)}new LiteGraph.ContextMenu(Ah,{event:Sh,callback:Ph,parentMenu:Eh,node:Gh});function Ph(Nh){if(!Gh)return;let Mh=Nh.value?LGraphCanvas.node_colors[Nh.value]:null;const Dh=Ih=>{Mh?Ih.constructor===LiteGraph.LGraphGroup?Ih.color=Mh.groupcolor:(Ih.color=Mh.color,Ih.bgcolor=Mh.bgcolor):(delete Ih.color,delete Ih.bgcolor)};var Fh=LGraphCanvas.active_canvas;if(!Fh.selected_nodes||Object.keys(Fh.selected_nodes).length<=1)Dh(Gh);else for(let Ih in Fh.selected_nodes)Dh(Fh.selected_nodes[Ih]);Gh.setDirtyCanvas(!0,!0)}return!1}function onMenuNodeShapes($h,Lh,Sh,Eh,Gh){if(!Gh)throw new Error("no node passed");new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:Sh,callback:Ah,parentMenu:Eh,node:Gh});function Ah(Ph){if(!Gh)return;Gh.graph.beforeChange();const Nh=Dh=>{Dh.shape=Ph};var Mh=LGraphCanvas.active_canvas;if(!Mh.selected_nodes||Object.keys(Mh.selected_nodes).length<=1)Nh(Gh);else for(let Dh in Mh.selected_nodes)Nh(Mh.selected_nodes[Dh]);Gh.graph.afterChange(),Gh.setDirtyCanvas(!0)}return!1}function onMenuNodeRemove($h,Lh,Sh,Eh,Gh){if(!Gh)throw new Error("no node passed");var Ah=Gh.graph;Ah.beforeChange();const Ph=Mh=>{Mh.removable!==!1&&Ah.remove(Mh)};var Nh=LGraphCanvas.active_canvas;if(!Nh.selected_nodes||Object.keys(Nh.selected_nodes).length<=1)Ph(Gh);else for(let Mh in Nh.selected_nodes)Ph(Nh.selected_nodes[Mh]);Ah.afterChange(),Gh.setDirtyCanvas(!0,!0)}function onMenuNodeToSubgraph($h,Lh,Sh,Eh,Gh){var Ah=Gh.graph,Ph=LGraphCanvas.active_canvas;if(Ph){var Nh=Object.values(Ph.selected_nodes||{});Nh.length||(Nh=[Gh]);var Mh=LiteGraph.createNode("graph/subgraph");Mh.pos=Gh.pos.concat(),Ah.add(Mh),Mh.buildFromNodes(Nh),Ph.deselectAllNodes(),Gh.setDirtyCanvas(!0,!0)}}function onMenuNodeClone($h,Lh,Sh,Eh,Gh){Gh.graph.beforeChange();var Ah={};const Ph=Mh=>{if(Mh.clonable!==!1){var Dh=Mh.clone();Dh&&(Dh.pos=[Mh.pos[0]+5,Mh.pos[1]+5],Mh.graph.add(Dh),Ah[Dh.id]=Dh)}};var Nh=LGraphCanvas.active_canvas;if(!Nh.selected_nodes||Object.keys(Nh.selected_nodes).length<=1)Ph(Gh);else for(let Mh in Nh.selected_nodes)Ph(Nh.selected_nodes[Mh]);Object.keys(Ah).length&&Nh.selectNodes(Ah),Gh.graph.afterChange(),Gh.setDirtyCanvas(!0,!0)}const DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",link_type_colors={"-1":"#A86",number:"#AAA",node:"#DCA",string:"#77F",boolean:"#F77"},gradients={},search_limit=-1,node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};function applyLGraphCanvasStatics($h){Object.assign($h,{getFileExtension,onGroupAdd,getBoundaryNodes,alignNodes,onNodeAlign,onGroupAlign,onMenuAdd,onMenuCollapseAll,onMenuNodeEdit,showMenuNodeOptionalInputs,showMenuNodeOptionalOutputs,onShowMenuNodeProperties,decodeHTML,onMenuResizeNode,onShowPropertyEditor,getPropertyPrintableValue,onMenuNodeCollapse,onMenuNodePin,onMenuNodeMode,onMenuNodeColors,onMenuNodeShapes,onMenuNodeRemove,onMenuNodeToSubgraph,onMenuNodeClone}),$h.DEFAULT_BACKGROUND_IMAGE=DEFAULT_BACKGROUND_IMAGE,$h.link_type_colors=link_type_colors,$h.gradients=gradients,$h.search_limit=search_limit,$h.node_colors=node_colors}class LGraphCanvas{constructor(Lh,Sh,Eh){Eh!=null||(Eh={skip_render:!1,autoresize:!1,clip_all_nodes:!1,renderForm:void 0,renderStrategy:void 0,renderStyleProfile:"legacy",renderStyleEngine:"legacy",rendererAdapter:null}),this.options=Eh,this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,Lh&&Lh.constructor===String&&(Lh=document.querySelector(Lh)),this.ds=new LiteGraph.DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=`${LiteGraph.NODE_TEXT_SIZE}px Arial`,this.inner_text_font=`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.move_destination_link_without_shift=!1,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.free_resize=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.autoresize=Eh.autoresize,this.skip_render=Eh.skip_render,this.clip_all_nodes=Eh.clip_all_nodes,this.free_resize=Eh.free_resize,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=Eh.viewport||null,this.low_quality_rendering_threshold=5,this.controllers=createLGraphCanvasControllers(this),this.rendererAdapter=Eh.rendererAdapter||new Canvas2DRendererAdapter,this.renderForm=Eh.renderForm||null,this.renderStrategy=Eh.renderStrategy||null,this._renderModeRuntime=null,this.renderStyleProfile=Eh.renderStyleProfile||"legacy",this.renderStyleEngine=Eh.renderStyleEngine||(this.renderStyleProfile==="legacy"?"legacy":"leafer-components"),this.frontSurface=null,this.backSurface=null,this.processMouseWheel=this.processMouseWheel.bind(this),this.processKey=this.processKey.bind(this),this.processDrop=this.processDrop.bind(this),Sh==null||Sh.attachCanvas(this),this.setCanvas(Lh,Eh.skip_events),this.clear(),!this.skip_render&&!Eh.skip_render&&this.startRendering()}}installLGraphCanvasDelegates(LGraphCanvas),applyLGraphCanvasStatics(LGraphCanvas);class DragAndScale{constructor(Lh,Sh){Kl(this,"onMouseDown",Eh=>{if(!this.enabled)return;const Gh=this.element.getBoundingClientRect();var Ah=Eh.clientX-Gh.left,Ph=Eh.clientY-Gh.top;Eh.canvasx=Ah,Eh.canvasy=Ph,Eh.dragging=this.dragging;var Nh=!this.viewport||this.viewport&&Ah>=this.viewport[0]&&Ah<this.viewport[0]+this.viewport[2]&&Ph>=this.viewport[1]&&Ph<this.viewport[1]+this.viewport[3];Nh&&(this.dragging=!0,this.abortController=new AbortController,document.addEventListener("pointermove",this.onMouseMove,{signal:this.abortController.signal}),document.addEventListener("pointerup",this.onMouseUp,{signal:this.abortController.signal})),this.last_mouse[0]=Ah,this.last_mouse[1]=Ph}),Kl(this,"onMouseMove",Eh=>{if(!this.enabled)return;const Gh=this.element.getBoundingClientRect();var Ah=Eh.clientX-Gh.left,Ph=Eh.clientY-Gh.top;Eh.canvasx=Ah,Eh.canvasy=Ph,Eh.dragging=this.dragging;var Nh=Ah-this.last_mouse[0],Mh=Ph-this.last_mouse[1];this.dragging&&this.mouseDrag(Nh,Mh),this.last_mouse[0]=Ah,this.last_mouse[1]=Ph}),Kl(this,"onMouseUp",Eh=>{var Gh;this.dragging=!1,(Gh=this.abortController)==null||Gh.abort()}),Kl(this,"onWheel",Eh=>{Eh.wheel=-Eh.deltaY,Eh.delta=Eh.wheelDelta?Eh.wheelDelta/40:Eh.deltaY?-Eh.deltaY/3:0,this.changeDeltaScale(1+Eh.delta*.05)}),this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),Lh&&(this.element=Lh,Sh||this.bindEvents(Lh))}bindEvents(Lh){this.last_mouse=new Float32Array(2),Lh.addEventListener("pointerdown",this.onMouseDown),Lh.addEventListener("wheel",this.onWheel)}computeVisibleArea(Lh){if(!this.element){this.visible_area.set([0,0,0,0]);return}let Sh=this.element.width,Eh=this.element.height,Gh=-this.offset[0],Ah=-this.offset[1];if(Lh){Gh+=Lh[0]/this.scale,Ah+=Lh[1]/this.scale;const[Mh,Dh]=Lh.slice(2);Sh=Mh,Eh=Dh}const Ph=Gh+Sh/this.scale,Nh=Ah+Eh/this.scale;this.visible_area.set([Gh,Ah,Ph-Gh,Nh-Ah])}toCanvasContext(Lh){Lh.scale(this.scale,this.scale),Lh.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(Lh){return[(Lh[0]+this.offset[0])*this.scale,(Lh[1]+this.offset[1])*this.scale]}convertCanvasToOffset(Lh,Sh=[0,0]){return Sh[0]=Lh[0]/this.scale-this.offset[0],Sh[1]=Lh[1]/this.scale-this.offset[1],Sh}mouseDrag(Lh,Sh){var Eh;this.offset[0]+=Lh/this.scale,this.offset[1]+=Sh/this.scale,(Eh=this.onredraw)==null||Eh.call(this,this)}changeScale(Lh,Sh){var Eh;if(Lh=LiteGraph.clamp(Lh,this.min_scale,this.max_scale),Lh==this.scale||!this.element)return;const Gh=this.element.getBoundingClientRect();if(Gh){Sh=Sh||[Gh.width*.5,Gh.height*.5];var Ah=this.convertCanvasToOffset(Sh);this.scale=Lh,Math.abs(this.scale-1)<.01&&(this.scale=1);var Ph=this.convertCanvasToOffset(Sh),Nh=[Ph[0]-Ah[0],Ph[1]-Ah[1]];this.offset[0]+=Nh[0],this.offset[1]+=Nh[1],(Eh=this.onredraw)==null||Eh.call(this,this)}}changeDeltaScale(Lh,Sh){this.changeScale(this.scale*Lh,Sh)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}function normalizeContextMenuOptions($h={}){var Lh;return(Lh=$h.scroll_speed)!=null||($h.scroll_speed=.1),$h}function linkContextMenuToParent($h,Lh){var Sh;const Eh=$h.options.parentMenu;if(Eh){if(Eh.constructor!==$h.constructor){(Sh=Lh.error)==null||Sh.call(Lh,"parentMenu must be of class ContextMenu, ignoring it"),$h.options.parentMenu=null;return}$h.parentMenu=Eh,$h.parentMenu.lock=!0,$h.parentMenu.current_submenu=$h}}function validateContextMenuEventClass($h,Lh){var Sh;if(!$h.options.event)return;const Eh=$h.options.event.constructor.name;Eh!=="MouseEvent"&&Eh!=="CustomEvent"&&Eh!=="PointerEvent"&&((Sh=Lh.error)==null||Sh.call(Lh,`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${Eh})`),$h.options.event=null)}function createContextMenuRoot($h){const Lh=$h.root=document.createElement("div");return $h.options.className&&(Lh.className=$h.options.className),Lh.classList.add("litegraph","litecontextmenu","litemenubar-panel"),Lh.style.minWidth="80px",Lh.style.minHeight="10px",Lh}function setContextMenuTitle($h,Lh){var Sh;if(!Lh)return;(Sh=$h.titleElement)!=null||($h.titleElement=document.createElement("div"));const Eh=$h.titleElement;Eh.className="litemenu-title",Eh.innerHTML=Lh,$h.root.parentElement||$h.root.appendChild(Eh)}function addContextMenuItems($h,Lh){for(let Sh=0;Sh<Lh.length;Sh++){let Eh=Lh[Sh];typeof Eh!="string"&&(Eh=Eh&&Eh.content!==void 0?String(Eh.content):String(Eh));const Gh=Lh[Sh];$h.menu_elements.push($h.addItem(Eh,Gh,$h.options))}}function resolveContextMenuHost($h){var Lh,Sh,Eh;const Gh=(Sh=(Lh=$h.options.event)==null?void 0:Lh.target.ownerDocument)!=null?Sh:document,Ah=(Eh=Gh.fullscreenElement)!=null?Eh:Gh.body;return{doc:Gh,parent:Ah}}function appendContextMenuRoot($h,Lh){Lh.appendChild($h.root)}function bindContextMenuRootEvents($h){const Lh=$h.root;Lh.style.pointerEvents="none",setTimeout(()=>{Lh.style.pointerEvents="auto"},100),Lh.addEventListener("pointerup",Sh=>(Sh.preventDefault(),!0)),Lh.addEventListener("contextmenu",Sh=>(Sh.button!=2||Sh.preventDefault(),!1)),Lh.addEventListener("pointerdown",Sh=>{if(Sh.button==2)return $h.close(),Sh.preventDefault(),!0}),Lh.addEventListener("wheel",Sh=>{const Eh=parseInt(Lh.style.top);return Lh.style.top=(Eh+Sh.deltaY*$h.options.scroll_speed).toFixed()+"px",Sh.preventDefault(),!0}),Lh.addEventListener("pointerenter",Sh=>{Lh.closing_timer&&clearTimeout(Lh.closing_timer)})}function setupContextMenuFiltering($h,Lh,Sh,Eh){var Gh;if(!Lh){(Gh=Eh.warn)==null||Gh.call(Eh,"NO root document to add context menu and event",Lh,$h.options);return}Sh.f_textfilter&&(Lh.removeEventListener("keydown",Sh.f_textfilter,!1),Lh.removeEventListener("keydown",Sh.f_textfilter,!0),Sh.f_textfilter=!1),Sh.f_textfilter=function(Ah){var Ph,Nh,Mh,Dh,Fh,Ih,Hh;if($h.current_submenu){(Ph=Eh.debug)==null||Ph.call(Eh,"Prevent filtering on ParentMenu",$h);return}if($h.allOptions||($h.allOptions=$h.menu_elements,$h.selectedOption=!1),$h.currentOptions||($h.currentOptions=$h.allOptions),$h.filteringText||($h.filteringText=""),Ah.key){let Wh=!1;switch(Ah.key){case"Backspace":$h.filteringText.length&&($h.filteringText=$h.filteringText.substring(0,$h.filteringText.length-1),Wh=!0);break;case"Escape":Sh.f_textfilter&&(Lh.removeEventListener("keydown",Sh.f_textfilter,!1),Lh.removeEventListener("keydown",Sh.f_textfilter,!0),Sh.f_textfilter=!1),$h.close();break;case"ArrowDown":do $h.selectedOption=$h.selectedOption!==!1?Math.min(Math.max($h.selectedOption+1,0),$h.allOptions.length-1):0;while($h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&$h.selectedOption<$h.allOptions.length-1);$h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&($h.selectedOption=$h.currentOptions[$h.currentOptions.length-1].menu_index),Wh=!0;break;case"ArrowUp":do $h.selectedOption=$h.selectedOption!==!1?Math.min(Math.max($h.selectedOption-1,0),$h.allOptions.length-1):0;while($h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&$h.selectedOption>0);$h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&($h.currentOptions&&$h.currentOptions.length?$h.selectedOption=$h.currentOptions[0].menu_index:$h.selectedOption=!1),Wh=!0;break;case"ArrowLeft":break;case"ArrowRight":case"Enter":if($h.selectedOption!==!1)$h.allOptions[$h.selectedOption]?((Nh=Eh.debug)==null||Nh.call(Eh,"ContextElement simCLICK",$h.allOptions[$h.selectedOption]),$h.allOptions[$h.selectedOption].do_click&&$h.allOptions[$h.selectedOption].do_click($h.options.event,ignore_parent_menu)):((Mh=Eh.debug)==null||Mh.call(Eh,"ContextElement selection wrong",$h.selectedOption),$h.selectedOption=$h.selectedOption!==!1?Math.min(Math.max($h.selectedOption,0),$h.allOptions.length-1):0);else if($h.filteringText.length){for(const zh in $h.allOptions)if($h.allOptions[zh].style.display!=="none"&&!($h.allOptions[zh].classList+"").includes("separator")&&$h.allOptions[zh].textContent!=="Search"){(Dh=Eh.debug)==null||Dh.call(Eh,"ContextElement simCLICK",$h.allOptions[zh]),Sh.f_textfilter&&Lh&&(Lh.removeEventListener("keydown",Sh.f_textfilter,!1),Lh.removeEventListener("keydown",Sh.f_textfilter,!0),(Fh=Eh.debug)==null||Fh.call(Eh,"Cleaned ParentContextMenu listener",Lh,$h)),$h.allOptions[zh].do_click(Ah,!1);break}}Wh=!0;break;default:(Ih=Eh.debug)==null||Ih.call(Eh,"ContextMenu filter: keyEvent",Ah.key);break}!Wh&&Ah.key.length==1&&($h.filteringText+=Ah.key,$h.parentMenu)}if($h.filteringText&&$h.filteringText!==""){const Wh=[];$h.currentOptions=[];for(const zh in $h.allOptions){const Uh=$h.allOptions[zh].textContent,Yh=Uh.toLocaleLowerCase().includes($h.filteringText.toLocaleLowerCase()),Xh=Uh.toLocaleLowerCase().startsWith($h.filteringText.toLocaleLowerCase()),jh=Uh.split("/"),qh=jh.length>1&&jh[jh.length-1].toLocaleLowerCase().startsWith($h.filteringText.toLocaleLowerCase())||jh.length==1&&Xh,Kh=($h.allOptions[zh].classList+"").includes("separator")||Uh==="Search";$h.allOptions[zh].menu_index=zh,Yh&&!Kh?(Wh.push($h.allOptions[zh]),$h.allOptions[zh].style.display="block",$h.allOptions[zh].hidden=!1,$h.currentOptions.push($h.allOptions[zh]),$h.allOptions[zh].filtered_index=$h.currentOptions.length-1):($h.allOptions[zh].hidden=!0,$h.allOptions[zh].style.display="none",$h.allOptions[zh].filtered_index=!1),qh?$h.allOptions[zh].style.fontWeight="bold":Xh&&($h.allOptions[zh].style.fontStyle="italic")}$h.selectedOption=$h.selectedOption!==!1?Math.min(Math.max($h.selectedOption,0),$h.allOptions.length-1):0,$h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&$h.currentOptions.length&&($h.selectedOption=$h.currentOptions[0].menu_index)}else{$h.currentOptions=$h.allOptions;for(const Wh in $h.allOptions)$h.allOptions[Wh].style.display="block",$h.allOptions[Wh].style.fontStyle="inherit",$h.allOptions[Wh].style.fontWeight="inherit",$h.allOptions[Wh].hidden=!1,$h.allOptions[Wh].filtered_index=!1,$h.allOptions[Wh].menu_index=Wh}if($h.selectedOption!==!1){(Hh=Eh.debug)==null||Hh.call(Eh,"ContextMenu selection: ",$h.selectedOption);for(const Wh in $h.allOptions)$h.selectedOption+""==Wh+""?$h.allOptions[Wh].classList.add("selected"):$h.allOptions[Wh].classList.remove("selected")}document.body.getBoundingClientRect(),Sh.getBoundingClientRect(),Sh.style.top=$h.top_original+"px"},Lh.removeEventListener("keydown",Sh.f_textfilter,!0),Lh.addEventListener("keydown",Sh.f_textfilter,!0),$h._filterDoc=Lh}function calculateContextMenuBestPosition($h,Lh){var Sh;const Eh=$h.options,Gh=$h.root;let Ah=Eh.left||0,Ph=Eh.top||0;if($h.top_original=Ph,Eh.event){if(Ah=Eh.event.clientX-10,Ph=Eh.event.clientY-10,Eh.title&&(Ph-=20),$h.top_original=Ph,Eh.parentMenu){const Dh=Eh.parentMenu.root.getBoundingClientRect();Ah=Dh.left+Dh.width}const Nh=document.body.getBoundingClientRect(),Mh=Gh.getBoundingClientRect();Nh.height===0&&((Sh=Lh.error)==null||Sh.call(Lh,"document.body height is 0. That is dangerous, set html,body { height: 100%; }")),Nh.width&&Ah>Nh.width-Mh.width-10&&(Ah=Nh.width-Mh.width-10),Nh.height&&Ph>Nh.height-Mh.height-10&&(Ph=Nh.height-Mh.height-10)}Gh.style.left=`${Ah}px`,Gh.style.top=`${Ph}px`,Eh.scale&&(Gh.style.transform=`scale(${Eh.scale})`)}function createContextMenuItem($h,Lh,Sh,Eh={},Gh){var Ah;const Ph=document.createElement("div");Ph.className="litemenu-entry submenu";let Nh=!1;Sh===null?Ph.classList.add("separator"):(Ph.innerHTML=(Ah=Sh==null?void 0:Sh.title)!=null?Ah:Lh,Ph.value=Sh,Sh&&(Sh.disabled&&(Nh=!0,Ph.classList.add("disabled")),(Sh.submenu||Sh.has_submenu)&&Ph.classList.add("has_submenu")),typeof Sh=="function"?(Ph.dataset.value=Lh,Ph.onclick_callback=Sh):Ph.dataset.value=Sh,Sh.className&&(Ph.className+=" "+Sh.className)),$h.root.appendChild(Ph),Nh||Ph.addEventListener("click",Dh),!Nh&&Eh.autoopen&&Ph.addEventListener("pointerenter",Fh=>{const Ih=$h.value;!Ih||!Ih.has_submenu||Dh.call($h,Fh)});const Mh=$h;function Dh(Fh){var Ih,Hh,Wh,zh,Uh;const Yh=this.value;let Xh=!0;if((Ih=Gh.debug)==null||Ih.call(Gh,"ContextMenu handleMenuItemClick",Yh,Eh,Xh,this.current_submenu,this),(Hh=Mh.current_submenu)==null||Hh.close(Fh),Eh.callback&&((Wh=Gh.debug)==null||Wh.call(Gh,"ContextMenu handleMenuItemClick callback",this,Yh,Eh,Fh,Mh,Eh.node),Eh.callback.call(this,Yh,Eh,Fh,Mh,Eh.node)===!0&&(Xh=!1)),Yh&&(Yh.callback&&!Eh.ignore_item_callbacks&&Yh.disabled!==!0&&((zh=Gh.debug)==null||zh.call(Gh,"ContextMenu using value callback and !ignore_item_callbacks",this,Yh,Eh,Fh,Mh,Eh.node),Yh.callback.call(this,Yh,Eh,Fh,Mh,Eh.extra)===!0&&(Xh=!1)),Yh.submenu)){if((Uh=Gh.debug)==null||Uh.call(Gh,"ContextMenu SUBMENU",this,Yh,Yh.submenu.options,Fh,Mh,Eh),!Yh.submenu.options)throw new Error("ContextMenu submenu needs options");new Mh.constructor(Yh.submenu.options,{callback:Yh.submenu.callback,event:Fh,parentMenu:Mh,ignore_item_callbacks:Yh.submenu.ignore_item_callbacks,title:Yh.submenu.title,extra:Yh.submenu.extra,autoopen:Eh.autoopen}),Xh=!1}Xh&&!Mh.lock&&Mh.close()}return Ph}function closeContextMenuInstance($h,Lh,Sh,Eh){var Gh,Ah;if($h.root.f_textfilter){const Ph=$h._filterDoc||((Gh=Lh==null?void 0:Lh.target)==null?void 0:Gh.ownerDocument)||document;Ph.removeEventListener("keydown",$h.root.f_textfilter,!0),Ph.removeEventListener("keydown",$h.root.f_textfilter,!1),$h._filterDoc=null}$h.parentMenu&&!Sh&&($h.parentMenu.lock=!1,$h.parentMenu.current_submenu=null,Lh===void 0?$h.parentMenu.close():Lh&&!Eh.isCursorOverElement(Lh,$h.parentMenu.root)&&Eh.trigger($h.parentMenu.root,"pointerleave",Lh)),(Ah=$h.current_submenu)==null||Ah.close(Lh,!0),$h.root.closing_timer&&clearTimeout($h.root.closing_timer),$h.root.parentNode&&$h.root.parentNode.removeChild($h.root)}function closeAllContextMenus($h=window){const Lh=$h.document.querySelectorAll(".litecontextmenu");Lh.length&&Lh.forEach(Sh=>{var Eh;Sh.close?Sh.close():(Eh=Sh.parentNode)==null||Eh.removeChild(Sh)})}function triggerContextMenuEvent($h,Lh,Sh,Eh){const Gh=new CustomEvent(Lh,{bubbles:!0,cancelable:!0,detail:Sh});return Eh&&Object.defineProperty(Gh,"litegraphTarget",{value:Eh}),$h.dispatchEvent?$h.dispatchEvent(Gh):$h.__events&&$h.__events.dispatchEvent(Gh),Gh}function isCursorOverContextElement($h,Lh,Sh){return Sh.isInsideRectangle($h.clientX,$h.clientY,Lh.left,Lh.top,Lh.width,Lh.height)}var jl,wu,Lu,Cu,Su,Tu,Eu;const Rh=class gd{constructor(Lh,Sh={}){$u(this,jl),this.options=normalizeContextMenuOptions(Sh),this.menu_elements=[],Th(this,jl,Cu).call(this),Th(this,jl,Su).call(this),Th(this,jl,wu).call(this),Th(this,jl,Lu).call(this),this.setTitle(this.options.title),this.addItems(Lh),Th(this,jl,Tu).call(this),Th(this,jl,Eu).call(this)}setTitle(Lh){setContextMenuTitle(this,Lh)}addItems(Lh){addContextMenuItems(this,Lh)}addItem(Lh,Sh,Eh={}){return createContextMenuItem(this,Lh,Sh,Eh,LiteGraph)}close(Lh,Sh){closeContextMenuInstance(this,Lh,Sh,gd)}static trigger(Lh,Sh,Eh,Gh){return triggerContextMenuEvent(Lh,Sh,Eh,Gh)}getTopMenu(){var Lh,Sh;return(Sh=(Lh=this.options.parentMenu)==null?void 0:Lh.getTopMenu())!=null?Sh:this}getFirstEvent(){var Lh,Sh;return(Sh=(Lh=this.options.parentMenu)==null?void 0:Lh.getFirstEvent())!=null?Sh:this.options.event}static isCursorOverElement(Lh,Sh){return isCursorOverContextElement(Lh,Sh,LiteGraph)}};jl=new WeakSet,wu=function(){return createContextMenuRoot(this)},Lu=function(){bindContextMenuRootEvents(this)},Cu=function(){linkContextMenuToParent(this,LiteGraph)},Su=function(){validateContextMenuEventClass(this,LiteGraph)},Tu=function(){const{doc:$h,parent:Lh}=resolveContextMenuHost(this);LiteGraph.context_menu_filter_enabled&&!this.options.parentMenu&&setupContextMenuFiltering(this,$h,this.root,LiteGraph),appendContextMenuRoot(this,Lh)},Eu=function(){calculateContextMenuBestPosition(this,LiteGraph)},Kl(Rh,"closeAll",($h=window)=>closeAllContextMenus($h));let ContextMenu=Rh;const loggingMethods={logging_set_level($h){this.debug_level=Number($h)},logging($h){if($h>this.debug_level)return;function Lh(Eh){let Gh=[];for(let Ah=1;Ah<Eh.length;Ah++)typeof Eh[Ah]!="undefined"&&Gh.push(Eh[Ah]);return Gh}let Sh="debug";if($h>=0&&$h<=4&&(Sh=["error","warn","info","log","debug"][$h]),typeof console[Sh]!="function")throw console.warn("[LG-log] invalid console method",Sh,Lh(arguments)),new RangeError;console[Sh]("[LG]",...Lh(arguments))},error(){this.logging(0,...arguments)},warn(){this.logging(1,...arguments)},info(){this.logging(2,...arguments)},log(){this.logging(3,...arguments)},debug(){this.logging(4,...arguments)}};let LiteGraph$5=null;function setNodeRegistryMethodsLiteGraph($h){LiteGraph$5=$h}const nodeRegistryMethods={registerNodeType($h,Lh){var Sh,Eh,Gh,Ah,Ph,Nh,Mh;if(!Lh.prototype)throw new Error("Cannot register a simple object, it must be a class with a prototype");Lh.type=$h,(Sh=this.debug)==null||Sh.call(this,"registerNodeType","start",$h);const Dh=Lh.name,Fh=$h.lastIndexOf("/");Lh.category=$h.substring(0,Fh),Lh.title||(Lh.title=Dh);const Ih=Object.getOwnPropertyDescriptors(LiteGraph$5.LGraphNode.prototype);Object.keys(Ih).forEach(Uh=>{Lh.prototype.hasOwnProperty(Uh)||Object.defineProperty(Lh.prototype,Uh,Ih[Uh])});const Hh=this.registered_node_types[$h];if(Hh&&((Eh=this.debug)==null||Eh.call(this,"registerNodeType","replacing node type",$h,Hh)),!Object.prototype.hasOwnProperty.call(Lh.prototype,"shape")&&(Object.defineProperty(Lh.prototype,"shape",{set:function(Uh){switch(Uh){case"default":delete this._shape;break;case"box":this._shape=LiteGraph$5.BOX_SHAPE;break;case"round":this._shape=LiteGraph$5.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph$5.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph$5.CARD_SHAPE;break;default:this._shape=Uh}},get:function(){return this._shape},enumerable:!0,configurable:!0}),Lh.supported_extensions))for(let Uh in Lh.supported_extensions){const Yh=Lh.supported_extensions[Uh];Yh&&Yh.constructor===String&&(this.node_types_by_file_extension[Yh.toLowerCase()]=Lh)}if(this.registered_node_types[$h]=Lh,Lh.constructor.name&&(this.Nodes[Dh]=Lh),(Gh=LiteGraph$5.onNodeTypeRegistered)==null||Gh.call(LiteGraph$5,$h,Lh),Hh&&((Ah=LiteGraph$5.onNodeTypeReplaced)==null||Ah.call(LiteGraph$5,$h,Lh,Hh)),Lh.prototype.onPropertyChange&&LiteGraph$5.warn("LiteGraph node class "+$h+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),Lh.supported_extensions)for(var Wh=0;Wh<Lh.supported_extensions.length;Wh++){var zh=Lh.supported_extensions[Wh];zh&&zh.constructor===String&&(this.node_types_by_file_extension[zh.toLowerCase()]=Lh)}(Ph=this.debug)==null||Ph.call(this,"registerNodeType","type registered",$h),this.auto_load_slot_types&&((Nh=this.debug)==null||Nh.call(this,"registerNodeType","do auto_load_slot_types",$h)),new Lh((Mh=Lh.title)!=null?Mh:"tmpnode")},unregisterNodeType($h){const Lh=$h.constructor===String?this.registered_node_types[$h]:$h;if(!Lh)throw new Error("node type not found: "+$h);delete this.registered_node_types[Lh.type],Lh.constructor.name&&delete this.Nodes[Lh.constructor.name]},clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod($h,Lh){LiteGraph$5.LGraphNode.prototype[$h]=Lh;for(var Sh in this.registered_node_types){var Eh=this.registered_node_types[Sh];Eh.prototype[$h]&&(Eh.prototype["_"+$h]=Eh.prototype[$h]),Eh.prototype[$h]=Lh}},reloadNodes($h){var Lh,Sh,Eh,Gh=document.getElementsByTagName("script"),Ah=[];for(let Dh=0;Dh<Gh.length;Dh++)Ah.push(Gh[Dh]);var Ph=document.getElementsByTagName("head")[0];$h=document.location.href+$h;for(let Dh=0;Dh<Ah.length;Dh++){var Nh=Ah[Dh].src;if(!(!Nh||Nh.substr(0,$h.length)!=$h))try{(Lh=this.log)==null||Lh.call(this,"Reloading: "+Nh);var Mh=document.createElement("script");Mh.type="text/javascript",Mh.src=Nh,Ph.appendChild(Mh),Ph.removeChild(Ah[Dh])}catch(Fh){if(LiteGraph$5.throw_errors)throw Fh;(Sh=this.log)==null||Sh.call(this,"Error while reloading "+Nh)}}(Eh=this.log)==null||Eh.call(this,"Nodes reloaded")}};let LiteGraph$4=null;function setNodeFactoryMethodsLiteGraph($h){LiteGraph$4=$h}const nodeFactoryMethods={buildNodeClassFromObject($h,Lh){var Sh="";if(Lh.inputs)for(let Gh=0;Gh<Lh.inputs.length;++Gh){let Ah=Lh.inputs[Gh][0],Ph=Lh.inputs[Gh][1];Ph&&Ph.constructor===String&&(Ph='"'+Ph+'"'),Sh+="this.addInput('"+Ah+"',"+Ph+`);
`}if(Lh.outputs)for(let Gh=0;Gh<Lh.outputs.length;++Gh){let Ah=Lh.outputs[Gh][0],Ph=Lh.outputs[Gh][1];Ph&&Ph.constructor===String&&(Ph='"'+Ph+'"'),Sh+="this.addOutput('"+Ah+"',"+Ph+`);
`}if(Lh.properties)for(let Gh in Lh.properties){let Ah=Lh.properties[Gh];Ah&&Ah.constructor===String&&(Ah='"'+Ah+'"'),Sh+="this.addProperty('"+Gh+"',"+Ah+`);
`}Sh+="if(this.onCreate)this.onCreate()";var Eh=Function(Sh);for(let Gh in Lh)Gh!="inputs"&&Gh!="outputs"&&Gh!="properties"&&(Eh.prototype[Gh]=Lh[Gh]);return Eh.title=Lh.title||$h.split("/").pop(),Eh.desc=Lh.desc||"Generated from object",this.registerNodeType($h,Eh),Eh},wrapFunctionAsNode($h,Lh,Sh,Eh,Gh){const Ah=LiteGraph$4.getParameterNames(Lh),Ph=Ah.map((Fh,Ih)=>{const Hh=Sh!=null&&Sh[Ih]?`'${Sh[Ih]}'`:"0";return`this.addInput('${Fh}', ${Hh});`}).join(`
`),Nh=Eh?`'${Eh}'`:0,Mh=Gh?`this.properties = ${JSON.stringify(Gh)};`:"",Dh=new Function(`
            ${Ph}
            this.addOutput('out', ${Nh});
            ${Mh}
        `);return Dh.title=$h.split("/").pop(),Dh.desc=`Generated from ${Lh.name}`,Dh.prototype.onExecute=function(){const Fh=Ah.map((Hh,Wh)=>this.getInputData(Wh)),Ih=Lh.apply(this,Fh);this.setOutputData(0,Ih)},this.registerNodeType($h,Dh),Dh},createNode($h,Lh,Sh={}){var Eh,Gh,Ah,Ph,Nh,Mh,Dh,Fh,Ih,Hh,Wh,zh;const Uh=(Eh=this.registered_node_types[$h])!=null?Eh:null;if(!Uh)return(Gh=this.log)==null||Gh.call(this,`GraphNode type "${$h}" not registered.`),null;Lh=(Ah=Lh!=null?Lh:Uh.title)!=null?Ah:$h;let Yh=null;if(LiteGraph$4.catch_exceptions)try{Yh=new Uh(Lh)}catch(Xh){return(Ph=this.error)==null||Ph.call(this,Xh),null}else Yh=new Uh(Lh);return Yh.type=$h,(Nh=Yh.title)!=null||(Yh.title=Lh),(Mh=Yh.properties)!=null||(Yh.properties={}),(Dh=Yh.properties_info)!=null||(Yh.properties_info=[]),(Fh=Yh.flags)!=null||(Yh.flags={}),(Ih=Yh.size)!=null||(Yh.size=Yh.computeSize()),(Hh=Yh.pos)!=null||(Yh.pos=LiteGraph$4.DEFAULT_POSITION.concat()),(Wh=Yh.mode)!=null||(Yh.mode=LiteGraph$4.ALWAYS),Object.assign(Yh,Sh),(zh=Yh.onNodeCreated)==null||zh.call(Yh),Yh},getNodeType($h){return this.registered_node_types[$h]},getNodeTypesInCategory($h,Lh){const Sh=Object.values(this.registered_node_types).filter(Eh=>Eh.filter!==Lh?!1:$h===""?Eh.category===null:Eh.category===$h);return this.auto_sort_node_types&&Sh.sort((Eh,Gh)=>Eh.title.localeCompare(Gh.title)),Sh},getNodeTypesCategories($h){const Lh={"":1};Object.values(this.registered_node_types).forEach(Eh=>{Eh.category&&!Eh.skip_list&&Eh.filter===$h&&(Lh[Eh.category]=1)});const Sh=Object.keys(Lh);return this.auto_sort_node_types?Sh.sort():Sh}},slotTypesMethods={registerNodeAndSlotType($h,Lh,Sh=!1){const Eh=($h.constructor===String&&this.registered_node_types[$h]!=="anonymous"?this.registered_node_types[$h]:$h).constructor.type;let Gh=[];typeof Lh=="string"?Gh=Lh.split(","):Lh==this.EVENT||Lh==this.ACTION?Gh=["_event_"]:Gh=["*"];for(let Ah=0;Ah<Gh.length;++Ah){let Ph=Gh[Ah];Ph===""&&(Ph="*");const Nh=Sh?"registered_slot_out_types":"registered_slot_in_types";this[Nh][Ph]===void 0&&(this[Nh][Ph]={nodes:[]}),this[Nh][Ph].nodes.includes(Eh)||this[Nh][Ph].nodes.push(Eh),Sh?this.slot_types_out.includes(Ph.toLowerCase())||(this.slot_types_out.push(Ph.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(Ph.toLowerCase())||(this.slot_types_in.push(Ph.toLowerCase()),this.slot_types_in.sort())}},registerSearchboxExtra($h,Lh,Sh){this.searchbox_extras[Lh.toLowerCase()]={type:$h,desc:Lh,data:Sh}}};let LiteGraph$3=null;function setTypeCompatMethodsLiteGraph($h){LiteGraph$3=$h}const typeCompatMethods={isValidConnection($h,Lh){if(($h===""||$h==="*")&&($h=0),(Lh===""||Lh==="*")&&(Lh=0),!$h||!Lh||$h===Lh||$h===LiteGraph$3.EVENT&&Lh===LiteGraph$3.ACTION)return!0;if($h=String($h).toLowerCase(),Lh=String(Lh).toLowerCase(),!$h.includes(",")&&!Lh.includes(","))return $h===Lh;const Sh=$h.split(","),Eh=Lh.split(",");for(const Gh of Sh)for(const Ah of Eh)if(this.isValidConnection(Gh,Ah))return!0;return!1}};let LiteGraph$2=null;function setFileUtilsMethodsLiteGraph($h){LiteGraph$2=$h}const fileUtilsMethods={fetchFile($h,Lh,Sh,Eh){if(!$h)return null;if(Lh=Lh||"text",$h.constructor===String)return $h.substr(0,4)=="http"&&LiteGraph$2.proxy&&($h=LiteGraph$2.proxy+$h.substr($h.indexOf(":")+3)),fetch($h).then(Ah=>{if(!Ah.ok)throw new Error("File not found");if(Lh=="arraybuffer")return Ah.arrayBuffer();if(Lh=="text"||Lh=="string")return Ah.text();if(Lh=="json")return Ah.json();if(Lh=="blob")return Ah.blob()}).then(Ah=>{Sh&&Sh(Ah)}).catch(Ah=>{var Ph;(Ph=this.error)==null||Ph.call(this,"error fetching file:",$h),Eh&&Eh(Ah)});if($h.constructor===File||$h.constructor===Blob){var Gh=new FileReader;if(Gh.onload=Ah=>{var Ph=Ah.target.result;Lh=="json"&&(Ph=JSON.parse(Ph)),Sh&&Sh(Ph)},Lh=="arraybuffer")return Gh.readAsArrayBuffer($h);if(Lh=="text"||Lh=="json")return Gh.readAsText($h);if(Lh=="blob")return Gh.readAsBinaryString($h)}return null}},pointerEventsMethods={applyPointerDefaults(){typeof window=="undefined"||typeof window.matchMedia!="function"||window.matchMedia("(pointer: coarse)").matches&&(this.dialog_close_on_mouse_leave=!1,this.search_hide_on_mouse_leave=!1)},resolvePointerEventName($h){if(typeof $h!="string")return $h;const Lh=$h.toLowerCase(),Sh=this.pointerevents_method;return Sh==="mouse"?this.pointer_to_mouse_events[Lh]||Lh:Sh==="pointer"&&this.mouse_to_pointer_events[Lh]||Lh},pointerAddListener($h,Lh,Sh,Eh){if(!($h!=null&&$h.addEventListener)||typeof Sh!="function")return!1;const Gh=this.resolvePointerEventName(Lh);return $h.addEventListener(Gh,Sh,Eh),!0},pointerRemoveListener($h,Lh,Sh,Eh){if(!($h!=null&&$h.removeEventListener)||typeof Sh!="function")return!1;const Gh=this.resolvePointerEventName(Lh);return $h.removeEventListener(Gh,Sh,Eh),!0},set pointerevents_method($h){const Lh=typeof $h=="string"?$h.toLowerCase():"";if(Lh==="mouse"||Lh==="pointer"){this._pointerevents_method=Lh;return}this._pointerevents_method="pointer"},get pointerevents_method(){return this._pointerevents_method||"pointer"}},objectUtilsMethods={cloneObject($h,Lh){if($h==null)return null;const Sh=JSON.parse(JSON.stringify($h));if(!Lh)return Sh;for(const Eh in Sh)Object.prototype.hasOwnProperty.call(Sh,Eh)&&(Lh[Eh]=Sh[Eh]);return Lh},uuidv4(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,$h=>($h^Math.random()*16>>$h/4).toString(16))},compareObjects($h,Lh){const Sh=Object.keys($h);return Sh.length!==Object.keys(Lh).length?!1:Sh.every(Eh=>$h[Eh]===Lh[Eh])}},mathColorUtilsMethods={distance($h,Lh){const[Sh,Eh]=$h,[Gh,Ah]=Lh;return Math.sqrt((Gh-Sh)**2+(Ah-Eh)**2)},colorToString($h){return"rgba("+Math.round($h[0]*255).toFixed()+","+Math.round($h[1]*255).toFixed()+","+Math.round($h[2]*255).toFixed()+","+($h.length==4?$h[3].toFixed(2):"1.0")+")"},isInsideRectangle($h,Lh,Sh,Eh,Gh,Ah){return $h>Sh&&$h<Sh+Gh&&Lh>Eh&&Lh<Eh+Ah},growBounding($h,Lh,Sh){Lh<$h[0]?$h[0]=Lh:Lh>$h[2]&&($h[2]=Lh),Sh<$h[1]?$h[1]=Sh:Sh>$h[3]&&($h[3]=Sh)},isInsideBounding($h,Lh){return $h[0]>=Lh[0][0]&&$h[1]>=Lh[0][1]&&$h[0]<=Lh[1][0]&&$h[1]<=Lh[1][1]},overlapBounding($h,Lh){const Sh=$h[0]+$h[2],Eh=$h[1]+$h[3],Gh=Lh[0]+Lh[2],Ah=Lh[1]+Lh[3];return!($h[0]>Gh||$h[1]>Ah||Sh<Lh[0]||Eh<Lh[1])},hex2num($h){$h.charAt(0)=="#"&&($h=$h.slice(1)),$h=$h.toUpperCase();for(var Lh="0123456789ABCDEF",Sh=new Array(3),Eh=0,Gh,Ah,Ph=0;Ph<6;Ph+=2)Gh=Lh.indexOf($h.charAt(Ph)),Ah=Lh.indexOf($h.charAt(Ph+1)),Sh[Eh]=Gh*16+Ah,Eh++;return Sh},num2hex($h){for(var Lh="0123456789ABCDEF",Sh="#",Eh,Gh,Ah=0;Ah<3;Ah++)Eh=$h[Ah]/16,Gh=$h[Ah]%16,Sh+=Lh.charAt(Eh)+Lh.charAt(Gh);return Sh},clamp:($h,Lh,Sh)=>Lh>$h?Lh:Sh<$h?Sh:$h},canvasTextUtilsMethods={canvasFillTextMultiline($h,Lh,Sh,Eh,Gh,Ah){var Ph=(Lh+"").trim().split(" "),Nh="",Mh={lines:[],maxW:0,height:0};if(Ph.length>1)for(var Dh=0;Dh<Ph.length;Dh++){var Fh=Nh+Ph[Dh]+" ",Ih=$h.measureText(Fh),Hh=Ih.width;Hh>Gh&&Dh>0?($h.fillText(Nh,Sh,Eh+Ah*Mh.lines.length),Nh=Ph[Dh]+" ",Mh.max=Hh,Mh.lines.push(Nh)):Nh=Fh}else Nh=Ph[0];return $h.fillText(Nh,Sh,Eh+Ah*Mh.lines.length),Mh.lines.push(Nh),Mh.height=Ah*Mh.lines.length||Ah,Mh}},classUtilsMethods={extendClass:($h,Lh)=>{for(let Sh in Lh)$h.hasOwnProperty(Sh)||($h[Sh]=Lh[Sh]);if(Lh.prototype)for(let Sh in Lh.prototype)Lh.prototype.hasOwnProperty(Sh)&&($h.prototype.hasOwnProperty(Sh)||(Lh.prototype.__lookupGetter__(Sh)?$h.prototype.__defineGetter__(Sh,Lh.prototype.__lookupGetter__(Sh)):$h.prototype[Sh]=Lh.prototype[Sh],Lh.prototype.__lookupSetter__(Sh)&&$h.prototype.__defineSetter__(Sh,Lh.prototype.__lookupSetter__(Sh))))},getParameterNames:$h=>($h+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)};let LiteGraph$1=null;function setLegacyCompatMethodsLiteGraph($h){LiteGraph$1=$h}const legacyCompatMethods={closeAllContextMenus:()=>{LiteGraph$1.warn("LiteGraph.closeAllContextMenus is deprecated in favor of LiteGraph.ContextMenu.closeAll()"),LiteGraph$1.ContextMenu.closeAll()}};function installLiteGraphDelegates($h){const Lh=Object.getPrototypeOf($h);Lh.__litegraph_delegates_installed||(setNodeRegistryMethodsLiteGraph($h),setNodeFactoryMethodsLiteGraph($h),setTypeCompatMethodsLiteGraph($h),setFileUtilsMethodsLiteGraph($h),setLegacyCompatMethodsLiteGraph($h),[loggingMethods,nodeRegistryMethods,nodeFactoryMethods,slotTypesMethods,typeCompatMethods,fileUtilsMethods,pointerEventsMethods,objectUtilsMethods,mathColorUtilsMethods,canvasTextUtilsMethods,classUtilsMethods,legacyCompatMethods].forEach(Sh=>{const Eh=Object.getOwnPropertyDescriptors(Sh);delete Eh.__proto__,Object.entries(Eh).forEach(([Gh,Ah])=>{Object.defineProperty(Lh,Gh,{...Ah,configurable:!0})})}),Object.defineProperty(Lh,"__litegraph_delegates_installed",{value:!0,writable:!1,enumerable:!1,configurable:!1}))}function applyCoreDefaults($h){$h.VERSION="0.10.2",$h.CANVAS_GRID_SIZE=10,$h.NODE_TITLE_HEIGHT=30,$h.NODE_TITLE_TEXT_Y=20,$h.NODE_SLOT_HEIGHT=20,$h.NODE_WIDGET_HEIGHT=20,$h.NODE_WIDTH=140,$h.NODE_MIN_WIDTH=50,$h.NODE_COLLAPSED_RADIUS=10,$h.NODE_COLLAPSED_WIDTH=80,$h.NODE_TITLE_COLOR="#999",$h.NODE_SELECTED_TITLE_COLOR="#FFF",$h.NODE_TEXT_SIZE=14,$h.NODE_TEXT_COLOR="#AAA",$h.NODE_SUBTEXT_SIZE=12,$h.NODE_DEFAULT_COLOR="#333",$h.NODE_DEFAULT_BGCOLOR="#353535",$h.NODE_DEFAULT_BOXCOLOR="#666",$h.NODE_DEFAULT_SHAPE="box",$h.NODE_BOX_OUTLINE_COLOR="#FFF",$h.DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)",$h.DEFAULT_GROUP_FONT=24,$h.WIDGET_BGCOLOR="#222",$h.WIDGET_OUTLINE_COLOR="#666",$h.WIDGET_TEXT_COLOR="#DDD",$h.WIDGET_SECONDARY_TEXT_COLOR="#999",$h.LINK_COLOR="#9A9",$h.EVENT_LINK_COLOR="#A86",$h.CONNECTING_LINK_COLOR="#AFA",$h.MAX_NUMBER_OF_NODES=1e3,$h.DEFAULT_POSITION=[100,100],$h.VALID_SHAPES=["default","box","round","card"],$h.BOX_SHAPE=1,$h.ROUND_SHAPE=2,$h.CIRCLE_SHAPE=3,$h.CARD_SHAPE=4,$h.ARROW_SHAPE=5,$h.GRID_SHAPE=6,$h.INPUT=1,$h.OUTPUT=2,$h.EVENT=-1,$h.ACTION=-1,$h.NODE_MODES=["Always","On Event","Never","On Trigger","On Request"],$h.NODE_MODES_COLORS=["#666","#422","#333","#224","#626"],$h.ALWAYS=0,$h.ON_EVENT=1,$h.NEVER=2,$h.ON_TRIGGER=3,$h.ON_REQUEST=4,$h.UP=1,$h.DOWN=2,$h.LEFT=3,$h.RIGHT=4,$h.CENTER=5,$h.LINK_RENDER_MODES=["Straight","Linear","Spline"],$h.STRAIGHT_LINK=0,$h.LINEAR_LINK=1,$h.SPLINE_LINK=2,$h.NORMAL_TITLE=0,$h.NO_TITLE=1,$h.TRANSPARENT_TITLE=2,$h.AUTOHIDE_TITLE=3,$h.VERTICAL_LAYOUT="vertical",$h.proxy=null,$h.node_images_path="",$h.catch_exceptions=!0,$h.throw_errors=!0,$h.allow_scripts=!1,$h.use_deferred_actions=!0,$h.registered_node_types={},$h.node_types_by_file_extension={},$h.Nodes={},$h.Globals={}}function applyUiDefaults($h){$h.searchbox_extras={},$h.auto_sort_node_types=!1,$h.node_box_coloured_when_on=!1,$h.node_box_coloured_by_mode=!1,$h.dialog_close_on_mouse_leave=!0,$h.dialog_close_on_mouse_leave_delay=500,$h.search_hide_on_mouse_leave=!0,$h.search_filter_enabled=!1,$h.search_show_all_on_open=!0,$h.show_node_tooltip=!1,$h.show_node_tooltip_use_descr_property=!1,$h.showCanvasOptions=!1,$h.availableCanvasOptions=["allow_addOutSlot_onExecuted","free_resize","highquality_render","use_gradients","pause_rendering","clear_background","read_only","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","move_destination_link_without_shift","set_canvas_dirty_on_mouse_event","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip"]}function applyBehaviorDefaults($h){$h.shift_click_do_break_link_from=!1,$h.click_do_break_link_to=!1,$h.pointer_to_mouse_events=Object.freeze({pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mouseup",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"}),$h.mouse_to_pointer_events=Object.freeze({mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseenter:"pointerenter",mouseleave:"pointerleave"}),$h.applyPointerDefaults(),$h.alt_drag_do_clone_nodes=!1,$h.alt_shift_drag_connect_clone_with_input=!0,$h.do_add_triggers_slots=!1,$h.allow_multi_output_for_events=!0,$h.middle_click_slot_add_default_node=!1,$h.release_link_on_empty_shows_menu=!1,$h.two_fingers_opens_menu=!1,$h.backspace_delete=!0,$h.ctrl_shift_v_paste_connect_unselected_outputs=!1,$h.actionHistory_enabled=!1,$h.actionHistoryMaxSave=40,$h.refreshAncestorsOnTriggers=!1,$h.refreshAncestorsOnActions=!1,$h.ensureUniqueExecutionAndActionCall=!1,$h.use_uuids=!1,$h.context_menu_filter_enabled=!1,$h.actionHistoryMaxSave=40,$h.canRemoveSlots=!0,$h.canRemoveSlots_onlyOptional=!0,$h.canRenameSlots=!0,$h.canRenameSlots_onlyOptional=!0,$h.ensureNodeSingleExecution=!1,$h.ensureNodeSingleAction=!1,$h.preventAncestorRecalculation=!1,$h.ensureUniqueExecutionAndActionCall=!0,$h.allowMultiOutputForEvents=!1,$h.log_methods=["error","warn","info","log","debug"]}function applySlotsDefaults($h){$h.auto_load_slot_types=!1,$h.registered_slot_in_types={},$h.registered_slot_out_types={},$h.slot_types_in=[],$h.slot_types_out=[],$h.slot_types_default_in=[],$h.slot_types_default_out=[],$h.graphDefaultConfig={align_to_grid:!0,links_ontop:!1}}var LiteGraph=new class{constructor(){this.LLink=LLink,this.LGraph=LGraph,setupLGraphDelegates(this),this.LGraphNode=LGraphNode,setupLGraphNodeDelegates(this),this.LGraphGroup=LGraphGroup,this.LGraphCanvas=LGraphCanvas,this.Canvas2DRendererAdapter=Canvas2DRendererAdapter,this.LeaferUIRendererAdapter=LeaferUIRendererAdapter,this.DragAndScale=DragAndScale,this.ContextMenu=ContextMenu,installLiteGraphDelegates(this),applyCoreDefaults(this),applyUiDefaults(this),applyBehaviorDefaults(this),applySlotsDefaults(this),this.logging_set_level(2)}};typeof performance!="undefined"?LiteGraph.getTime=performance.now.bind(performance):typeof Date!="undefined"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process!="undefined"?LiteGraph.getTime=()=>{var $h=process.hrtime();return $h[0]*.001+$h[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()},typeof window!="undefined"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||($h=>{window.setTimeout($h,1e3/60)})),typeof globalThis!="undefined"&&!globalThis.LeaferUI&&(globalThis.LeaferUI=LeaferUIRuntime);export{ContextMenu,DragAndScale,LGraph,LGraphCanvas,LGraphGroup,LGraphNode,LLink,LiteGraph};
