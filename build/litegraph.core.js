var he=Object.defineProperty,te=n=>{throw TypeError(n)},ue=(n,t,o)=>t in n?he(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,B=(n,t,o)=>ue(n,typeof t!="symbol"?t+"":t,o),pe=(n,t,o)=>t.has(n)||te("Cannot "+o),ie=(n,t,o)=>t.has(n)?te("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,o),J=(n,t,o)=>(pe(n,t,"access private method"),o);class LLink{constructor(t,o,a,r,l,p){this.id=t,this.type=o,this.origin_id=a,this.origin_slot=r,this.target_id=l,this.target_slot=p,this._data=null,this._pos=new Float32Array(2)}configure(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}}const V=class ee{constructor(t){var o;(o=LiteGraph.log)==null||o.call(LiteGraph,"Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}getSupportedTypes(){var t;return(t=this.supported_types)!=null?t:ee.supported_types}clear(){var t;this.stop(),this.status=ee.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,(t=this._nodes)==null||t.forEach(o=>{var a;(a=o.onRemoved)==null||a.call(o)}),this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.configApplyDefaults(),this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.history={actionHistory:[],actionHistoryVersions:[],actionHistoryPtr:0},this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[],this._configuring=!1,this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")}configApply(t){this.config=Object.assign(this.config,t)}configApplyDefaults(){var t=LiteGraph.graphDefaultConfig;this.configApply(t)}attachCanvas(t){var o;if(!t instanceof LiteGraph.LGraphCanvas)throw new Error("attachCanvas expects a LiteGraph.LGraphCanvas instance");t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,(o=this.list_of_graphcanvas)!=null||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)}detachCanvas(t){if(this.list_of_graphcanvas){var o=this.list_of_graphcanvas.indexOf(t);o!=-1&&(t.graph=null,this.list_of_graphcanvas.splice(o,1))}}start(t=0){var o;if(this.status===ee.STATUS_RUNNING)return;this.status=ee.STATUS_RUNNING,(o=this.onPlayEvent)==null||o.call(this),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime;const a=()=>{var r,l;this.execution_timer_id===-1&&(window.requestAnimationFrame(a),(r=this.onBeforeStep)==null||r.call(this),this.runStep(1,!this.catch_errors),(l=this.onAfterStep)==null||l.call(this))};t===0&&typeof window=="object"&&window.requestAnimationFrame?(this.execution_timer_id=-1,a()):this.execution_timer_id=setInterval(()=>{var r,l;(r=this.onBeforeStep)==null||r.call(this),this.runStep(1,!this.catch_errors),(l=this.onAfterStep)==null||l.call(this)},t)}stop(){var t;this.status!=ee.STATUS_STOPPED&&(this.status=ee.STATUS_STOPPED,(t=this.onStopEvent)==null||t.call(this),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))}runStep(t=1,o,a){var r,l,p,h,c,u,d=LiteGraph.getTime();this.globaltime=.001*(d-this.starttime);var f=(r=this._nodes_executable)!=null?r:this._nodes;if(f){if(a||(a=f.length),o){for(let g=0;g<t;g++)f.forEach(m=>{var b,C;LiteGraph.use_deferred_actions&&(b=m._waiting_actions)!=null&&b.length&&m.executePendingActions(),m.mode===LiteGraph.ALWAYS&&((C=m.doExecute)==null||C.call(m))}),this.fixedtime+=this.fixedtime_lapse,(l=this.onExecuteStep)==null||l.call(this);(p=this.onAfterExecute)==null||p.call(this)}else try{for(let g=0;g<t;g++)f.forEach(m=>{var b,C;LiteGraph.use_deferred_actions&&(b=m._waiting_actions)!=null&&b.length&&m.executePendingActions(),m.mode===LiteGraph.ALWAYS&&((C=m.doExecute)==null||C.call(m))}),this.fixedtime+=this.fixedtime_lapse,(h=this.onExecuteStep)==null||h.call(this);(c=this.onAfterExecute)==null||c.call(this),this.errors_in_execution=!1}catch(g){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw g;(u=LiteGraph.log)==null||u.call(LiteGraph,`Error during execution: ${g}`),this.stop()}var L=LiteGraph.getTime(),_=L-d;_==0&&(_=1),this.execution_time=.001*_,this.globaltime+=.001*_,this.iteration+=1,this.elapsed_time=(L-this.last_update_time)*.001,this.last_update_time=L,this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[]}}updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])}computeExecutionOrder(t,o){var a,r=[],l=[],p={},h={},c={};for(let g=0,m=this._nodes.length;g<m;++g){let b=this._nodes[g];if(!(t&&!b.onExecute)){p[b.id]=b;var u=0;if(b.inputs)for(var d=0,f=b.inputs.length;d<f;d++)b.inputs[d]&&b.inputs[d].link!=null&&(u+=1);u==0?(l.push(b),o&&(b._level=1)):(o&&(b._level=0),c[b.id]=u)}}for(;l.length!=0;){var L=l.shift();if(r.push(L),delete p[L.id],!!L.outputs)for(let g=0;g<L.outputs.length;g++){let m=L.outputs[g];if(!(m==null||m.links==null||m.links.length==0))for(let b=0;b<m.links.length;b++){let C=m.links[b],T=this.links[C];if(!T||h[T.id])continue;let E=this.getNodeById(T.target_id);if(E==null){h[T.id]=!0;continue}o&&(!E._level||E._level<=L._level)&&(E._level=L._level+1),h[T.id]=!0,c[E.id]-=1,c[E.id]==0&&l.push(E)}}}for(let g in p)r.push(p[g]);r.length!=this._nodes.length&&LiteGraph.debug&&((a=LiteGraph.warn)==null||a.call(LiteGraph,"something went wrong, nodes missing"));var _=r.length;for(let g=0;g<_;++g)r[g].order=g;r=r.sort((g,m)=>{let b=g.constructor.priority||g.priority||0,C=m.constructor.priority||m.priority||0;return b==C?g.order-m.order:b-C});for(let g=0;g<_;++g)r[g].order=g;return r}getAncestors(t,o={}){for(var a={modesSkip:[],modesOnly:[],typesSkip:[],typesOnly:[]},r=Object.assign(a,o),l=[],p=[],h=[t],c={};h.length;){var u=h.shift();if(u&&!c[u.id]){if(c[u.id]=!0,u.id!=t.id){if(r.modesSkip&&r.modesSkip.length&&r.modesSkip.indexOf(u.mode)!=-1||r.modesOnly&&r.modesOnly.length&&r.modesOnly.indexOf(u.mode)==-1)continue;p.indexOf(u.id)==-1&&(l.push(u),p.push(u.id))}if(u.inputs)for(var d=0;d<u.inputs.length;++d){var f=u.getInputNode(d);if(f){var L=u.inputs[d].type;r.typesSkip&&r.typesSkip.length&&r.typesSkip.indexOf(L)!=-1||r.typesOnly&&r.typesOnly.length&&r.typesOnly.indexOf(f.mode)==-1||p.indexOf(f.id)==-1&&(c[f.id]||h.push(f))}}}}return l.sort((_,g)=>_.order-g.order),l}arrange(t=100,o){var a;const r=this.computeExecutionOrder(!1,!0),l=[];for(let h=0;h<r.length;++h){const c=r[h],u=c._level||1;(a=l[u])!=null||(l[u]=[]),l[u].push(c)}let p=t;for(let h=0;h<l.length;++h){const c=l[h];if(!c)continue;let u=100,d=t+LiteGraph.NODE_TITLE_HEIGHT;for(let f=0;f<c.length;++f){const L=c[f];L.pos[0]=o==LiteGraph.VERTICAL_LAYOUT?d:p,L.pos[1]=o==LiteGraph.VERTICAL_LAYOUT?p:d;const _=o==LiteGraph.VERTICAL_LAYOUT?1:0;L.size[_]>u&&(u=L.size[_]);const g=o==LiteGraph.VERTICAL_LAYOUT?0:1;d+=L.size[g]+t+LiteGraph.NODE_TITLE_HEIGHT}p+=u+t}this.setDirtyCanvas(!0,!0)}getTime(){return this.globaltime}getFixedTime(){return this.fixedtime}getElapsedTime(){return this.elapsed_time}sendEventToAllNodes(t,o,a=LiteGraph.ALWAYS){var r=this._nodes_in_order?this._nodes_in_order:this._nodes;if(r)for(let l=0,p=r.length;l<p;++l){const h=r[l];if(h.constructor===LiteGraph.Subgraph&&t!=="onExecute"){h.mode==a&&h.sendEventToAllNodes(t,o,a);continue}!h[t]||h.mode!==a||(o===void 0?h[t]():Array.isArray(o)?h[t].apply(h,o):h[t](o))}}sendActionToCanvas(t,o){if(this.list_of_graphcanvas)for(const a of this.list_of_graphcanvas)a[t]&&o&&a[t](...o)}add(t,o,a={}){var r,l,p,h={doProcessChange:!0,doCalcSize:!0},c=Object.assign(h,a);if(t){if(t.constructor===LiteGraph.LGraphGroup){this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,this.onGraphChanged({action:"groupAdd",doSave:c.doProcessChange});return}if(t.id!=-1&&this._nodes_by_id[t.id]!=null&&((r=LiteGraph.warn)==null||r.call(LiteGraph,"LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?t.id=LiteGraph.uuidv4():t.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw new Error("LiteGraph: max number of nodes in a graph reached");return LiteGraph.use_uuids?(t.id==null||t.id==-1)&&(t.id=LiteGraph.uuidv4()):t.id==null||t.id==-1?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this.onGraphChanged({action:"nodeAdd",doSave:c.doProcessChange}),this._nodes.push(t),this._nodes_by_id[t.id]=t,(l=t.onAdded)==null||l.call(t,this),this.config.align_to_grid&&t.alignToGrid(),o||this.updateExecutionOrder(),(p=this.onNodeAdded)==null||p.call(this,t),c.doCalcSize&&t.setSize(t.computeSize()),this.setDirtyCanvas(!0),this.change(),t}}remove(t){var o,a;if(t.constructor===LiteGraph.LGraphGroup){var r=this._groups.indexOf(t);r!=-1&&this._groups.splice(r,1),t.graph=null,this.onGraphChanged({action:"groupRemove"}),this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[t.id]!=null&&!t.ignore_remove){if(t.inputs)for(let p=0;p<t.inputs.length;p++)t.inputs[p].link!=null&&t.disconnectInput(p,{doProcessChange:!1});if(t.outputs)for(let p=0;p<t.outputs.length;p++){let h=t.outputs[p];h.links!=null&&h.links.length&&t.disconnectOutput(p,!1,{doProcessChange:!1})}if((o=t.onRemoved)==null||o.call(t),t.graph=null,this.onGraphChanged({action:"nodeRemove"}),this.list_of_graphcanvas)for(let p=0;p<this.list_of_graphcanvas.length;++p){let h=this.list_of_graphcanvas[p];h.selected_nodes[t.id]&&delete h.selected_nodes[t.id],h.node_dragged==t&&(h.node_dragged=null)}var l=this._nodes.indexOf(t);l!=-1&&this._nodes.splice(l,1),delete this._nodes_by_id[t.id],(a=this.onNodeRemoved)==null||a.call(this,t),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}}getNodeById(t){return t==null?null:this._nodes_by_id[t]}findNodesByClass(t,o=[]){return o=this._nodes.filter(a=>a.constructor===t),o}findNodesByType(t,o=[]){const a=t.toLowerCase();return o=this._nodes.filter(r=>r.type.toLowerCase()===a),o}findNodeByTitle(t){var o;return(o=this._nodes.find(a=>a.title===t))!=null?o:null}findNodesByTitle(t){return this._nodes.filter(o=>o.title===t)}getNodeOnPos(t,o,a=this._nodes,r=0){var l;return(l=a.reverse().find(p=>p.isPointInside(t,o,r)))!=null?l:null}getGroupOnPos(t,o){var a;return(a=this._groups.find(r=>r.isPointInside(t,o,2,!0)))!=null?a:null}checkNodeTypes(){for(var t,o=0;o<this._nodes.length;o++){var a=this._nodes[o],r=LiteGraph.registered_node_types[a.type];if(a.constructor!=r){LiteGraph.debug&&((t=LiteGraph.log)==null||t.call(LiteGraph,`node being replaced by newer version: ${a.type}`));var l=LiteGraph.createNode(a.type);this._nodes[o]=l,l.configure(a.serialize()),l.graph=this,this._nodes_by_id[l.id]=l,a.inputs&&(l.inputs=a.inputs.concat()),a.outputs&&(l.outputs=a.outputs.concat())}}this.updateExecutionOrder()}onAction(t,o,a){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var r=0;r<this._input_nodes.length;++r){var l=this._input_nodes[r];if(l.properties.name==t){l.actionDo(t,o,a);break}}}trigger(t,o){var a;(a=this.onTrigger)==null||a.call(this,t,o)}addInput(t,o,a){var r,l,p=this.inputs[t];p||(this.beforeChange(),this.inputs[t]={name:t,type:o,value:a},this.onGraphChanged({action:"addInput"}),this.afterChange(),(r=this.onInputAdded)==null||r.call(this,t,o),(l=this.onInputsOutputsChange)==null||l.call(this))}setInputData(t,o){var a=this.inputs[t];a&&(a.value=o)}getInputData(t){var o=this.inputs[t];return o?o.value:null}renameInput(t,o){var a,r,l;if(o!=t){if(!this.inputs[t])return!1;if(this.inputs[o])return(a=LiteGraph.error)==null||a.call(LiteGraph,"there is already one input with that name"),!1;this.inputs[o]=this.inputs[t],delete this.inputs[t],this.onGraphChanged({action:"renameInput"}),(r=this.onInputRenamed)==null||r.call(this,t,o),(l=this.onInputsOutputsChange)==null||l.call(this)}}changeInputType(t,o){var a;if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(o).toLowerCase()||(this.inputs[t].type=o,this.onGraphChanged({action:"changeInputType"}),(a=this.onInputTypeChanged)==null||a.call(this,t,o))}removeInput(t){var o,a;return this.inputs[t]?(delete this.inputs[t],this.onGraphChanged({action:"graphRemoveInput"}),(o=this.onInputRemoved)==null||o.call(this,t),(a=this.onInputsOutputsChange)==null||a.call(this),!0):!1}addOutput(t,o,a){var r,l;this.outputs[t]={name:t,type:o,value:a},this.onGraphChanged({action:"addOutput"}),(r=this.onOutputAdded)==null||r.call(this,t,o),(l=this.onInputsOutputsChange)==null||l.call(this)}setOutputData(t,o){var a=this.outputs[t];a&&(a.value=o)}getOutputData(t){var o=this.outputs[t];return o?o.value:null}renameOutput(t,o){var a,r,l;if(!this.outputs[t])return!1;if(this.outputs[o])return(a=LiteGraph.error)==null||a.call(LiteGraph,"there is already one output with that name"),!1;this.outputs[o]=this.outputs[t],delete this.outputs[t],this._version++,(r=this.onOutputRenamed)==null||r.call(this,t,o),(l=this.onInputsOutputsChange)==null||l.call(this)}changeOutputType(t,o){var a;if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(o).toLowerCase()||(this.outputs[t].type=o,this.onGraphChanged({action:"changeOutputType"}),(a=this.onOutputTypeChanged)==null||a.call(this,t,o))}removeOutput(t){var o,a;return this.outputs[t]?(delete this.outputs[t],this.onGraphChanged({action:"removeOutput"}),(o=this.onOutputRemoved)==null||o.call(this,t),(a=this.onInputsOutputsChange)==null||a.call(this),!0):!1}triggerInput(t,o){for(var a=this.findNodesByTitle(t),r=0;r<a.length;++r)a[r].onTrigger(o)}setCallback(t,o){for(var a=this.findNodesByTitle(t),r=0;r<a.length;++r)a[r].setTrigger(o)}beforeChange(t){var o;(o=this.onBeforeChange)==null||o.call(this,this,t),this.sendActionToCanvas("onBeforeChange",this)}afterChange(t){var o;(o=this.onAfterChange)==null||o.call(this,this,t),this.sendActionToCanvas("onAfterChange",this)}connectionChange(t){var o;this.updateExecutionOrder(),(o=this.onConnectionChange)==null||o.call(this,t),this.onGraphChanged({action:"connectionChange",doSave:!1}),this.sendActionToCanvas("onConnectionChange")}isLive(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){var o=this.list_of_graphcanvas[t];if(o.live_mode)return!0}return!1}clearTriggeredSlots(){for(var t in this.links){var o=this.links[t];o&&o._last_time&&(o._last_time=0)}}change(){var t,o;(t=LiteGraph.log)==null||t.call(LiteGraph,"Graph visually changed"),this.sendActionToCanvas("setDirty",[!0,!0]),(o=this.on_change)==null||o.call(this,this)}setDirtyCanvas(t,o){this.sendActionToCanvas("setDirty",[t,o])}removeLink(t){var o=this.links[t];if(o){var a=this.getNodeById(o.target_id);a&&(this.beforeChange(),a.disconnectInput(o.target_slot),this.afterChange())}}serialize(){var t,o;const a=this._nodes.map(f=>f.serialize());var r=[];for(var l in this.links){var p=this.links[l];if(!p.serialize){(t=LiteGraph.warn)==null||t.call(LiteGraph,"weird LLink bug, link info is not a LLink but a regular object");var h=new LiteGraph.LLink;for(var c in p)h[c]=p[c];this.links[l]=h,p=h}r.push(p.serialize())}const u=this._groups.map(f=>f.serialize());var d={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:a,links:r,groups:u,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return(o=this.onSerialize)==null||o.call(this,d),d}configure(t,o){var a,r,l,p,h;if(t){o||this.clear();var c=t.nodes;if(t.links&&t.links.constructor===Array){for(var u=[],d=0;d<t.links.length;++d){var f=t.links[d];if(!f){(a=LiteGraph.warn)==null||a.call(LiteGraph,"serialized graph link data contains errors, skipping.");continue}var L=new LiteGraph.LLink;L.configure(f),u[L.id]=L}t.links=u}for(let b in t)["nodes","groups"].includes(b)||(this[b]=t[b]);var _=!1;this._configuring=!0;try{if(this._nodes=[],c){for(let b=0,C=c.length;b<C;++b){var g=c[b],m=LiteGraph.createNode(g.type,g.title);m||((r=LiteGraph.log)==null||r.call(LiteGraph,`Node not found or has errors: ${g.type}`),m=new LiteGraph.LGraphNode,m.last_serialization=g,m.has_errors=!0,_=!0),m.id=g.id,this.add(m,!0,{doProcessChange:!1})}c.forEach(b=>{const C=this.getNodeById(b.id);C==null||C.configure(b)})}this._groups.length=0,t.groups&&t.groups.forEach(b=>{const C=new LiteGraph.LGraphGroup;C.configure(b),this.add(C,!0,{doProcessChange:!1})})}finally{this._configuring=!1}return this.updateExecutionOrder(),this.extra=(l=t.extra)!=null?l:{},(p=this.onConfigure)==null||p.call(this,t),t._version?(h=LiteGraph.debug)==null||h.call(LiteGraph,"skip onGraphChanged when configure passing version too!"):this.onGraphChanged({action:"graphConfigure",doSave:!1}),this.setDirtyCanvas(!0,!0),_}}load(t,o){var a=this;if(t.constructor===File||t.constructor===Blob){var r=new FileReader;r.addEventListener("load",p=>{var h=JSON.parse(p.target.result);a.configure(h),o==null||o()}),r.readAsText(t);return}var l=new XMLHttpRequest;l.open("GET",t,!0),l.send(null),l.onload=p=>{var h;if(l.status!==200){(h=LiteGraph.error)==null||h.call(LiteGraph,"Error loading graph:",l.status,l.response);return}var c=JSON.parse(l.response);a.configure(c),o==null||o()},l.onerror=p=>{var h;(h=LiteGraph.error)==null||h.call(LiteGraph,"Error loading graph:",p)}}onGraphSaved(t={}){var o={};Object.assign(o,t),this.savedVersion=this._version}onGraphLoaded(t={}){var o={};Object.assign(o,t),this.savedVersion=this._version}onGraphChanged(t={}){var o,a,r,l,p,h,c={action:"",doSave:!0,doSaveGraph:!0},u=Object.assign(c,t);if(!(this._configuring&&u.action!=="graphConfigure")&&(this._version++,u.action?(o=LiteGraph.debug)==null||o.call(LiteGraph,"Graph change",u.action):(a=LiteGraph.debug)==null||a.call(LiteGraph,"Graph change, no action",u),u.doSave&&LiteGraph.actionHistory_enabled)){(r=LiteGraph.debug)==null||r.call(LiteGraph,"onGraphChanged SAVE :: "+u.action);var d={actionName:u.action};u.doSaveGraph&&(d=Object.assign(d,{graphSave:this.serialize()}));for(var f=this.history;f.actionHistoryPtr<f.actionHistoryVersions.length-1;)(l=LiteGraph.debug)==null||l.call(LiteGraph,"popping: gone back? "+(f.actionHistoryPtr+" < "+(f.actionHistoryVersions.length-1))),f.actionHistoryVersions.pop();if(f.actionHistoryVersions.length>=LiteGraph.actionHistoryMaxSave){var L=f.actionHistoryVersions.shift();(p=LiteGraph.debug)==null||p.call(LiteGraph,"maximum saves reached: "+f.actionHistoryVersions.length+", remove older: "+L),f.actionHistory[L]=!1}f.actionHistoryPtr=f.actionHistoryVersions.length,f.actionHistoryVersions.push(f.actionHistoryPtr),f.actionHistory[f.actionHistoryPtr]=d,(h=LiteGraph.debug)==null||h.call(LiteGraph,"history saved: "+f.actionHistoryPtr,d.actionName)}}actionHistoryBack(t={}){var o,a,r,l,p,h={};Object.assign(h,t);var c=this.history;return c.actionHistoryPtr!=null&&c.actionHistoryPtr>=0?(c.actionHistoryPtr--,(o=LiteGraph.debug)==null||o.call(LiteGraph,"history step back: "+c.actionHistoryPtr),this.actionHistoryLoad({iVersion:c.actionHistoryPtr})?((r=LiteGraph.debug)==null||r.call(LiteGraph,"history loaded back: "+c.actionHistoryPtr),(l=LiteGraph.debug)==null||l.call(LiteGraph,this.history),!0):((a=LiteGraph.warn)==null||a.call(LiteGraph,"historyLoad failed, restore pointer? "+c.actionHistoryPtr),c.actionHistoryPtr++,!1)):((p=LiteGraph.debug)==null||p.call(LiteGraph,"history is already at older state"),!1)}actionHistoryForward(t={}){var o,a,r,l,p={};Object.assign(p,t);var h=this.history;return h.actionHistoryPtr<h.actionHistoryVersions.length?(h.actionHistoryPtr++,(o=LiteGraph.debug)==null||o.call(LiteGraph,"history step forward: "+h.actionHistoryPtr),this.actionHistoryLoad({iVersion:h.actionHistoryPtr})?((r=LiteGraph.debug)==null||r.call(LiteGraph,"history loaded forward: "+h.actionHistoryPtr),!0):((a=LiteGraph.warn)==null||a.call(LiteGraph,"historyLoad failed, restore pointer? "+h.actionHistoryPtr),h.actionHistoryPtr--,!1)):((l=LiteGraph.debug)==null||l.call(LiteGraph,"history is already at newer state"),!1)}actionHistoryLoad(t={}){var o,a={iVersion:!1,backStep:!1},r=Object.assign(a,t),l=this.history;if(l.actionHistory[r.iVersion]&&l.actionHistory[r.iVersion].graphSave){var p=JSON.stringify(this.history);return this.configure(l.actionHistory[r.iVersion].graphSave),this.history=JSON.parse(p),(o=LiteGraph.debug)==null||o.call(LiteGraph,"history loaded: "+r.iVersion,l.actionHistory[r.iVersion].actionName),!0}else return!1}};B(V,"supported_types",["number","string","boolean"]),B(V,"STATUS_STOPPED",1),B(V,"STATUS_RUNNING",2);let LGraph=V,LiteGraph$a=null;function setLifecycleSerializationMethodsLiteGraph(n){LiteGraph$a=n}const lifecycleSerializationMethods={configure(n){var t,o,a,r,l;Object.entries(n).forEach(([p,h])=>{var c;if(p==="properties"){for(var u in h)this.properties[u]=h[u],(c=this.onPropertyChanged)==null||c.call(this,u,h[u]);return}h!==null&&(typeof h=="object"?this[p]&&this[p].configure?this[p].configure(h):this[p]=LiteGraph$a.cloneObject(h,this[p]):this[p]=h)}),n.title||(this.title=this.constructor.title),(t=this.inputs)==null||t.forEach((p,h)=>{var c,u;if(!p.link)return;const d=this.graph?this.graph.links[p.link]:null;(c=this.onConnectionsChange)==null||c.call(this,LiteGraph$a.INPUT,h,!0,d,p),(u=this.onInputAdded)==null||u.call(this,p)}),(o=this.outputs)==null||o.forEach((p,h)=>{var c;p.links&&(p.links.forEach(()=>{var u;const d=this.graph;(u=this.onConnectionsChange)==null||u.call(this,LiteGraph$a.OUTPUT,h,!0,d,p)}),(c=this.onOutputAdded)==null||c.call(this,p))}),this.widgets&&(this.widgets.forEach(p=>{p&&p.options&&p.options.property&&this.properties[p.options.property]!==void 0&&(p.value=JSON.parse(JSON.stringify(this.properties[p.options.property])))}),(a=n.widgets_values)==null||a.forEach((p,h)=>{this.widgets[h]&&(this.widgets[h].value=p)})),(r=this.onConfigure)==null||r.call(this,n),(l=this.graph)==null||l.onGraphChanged({action:"nodeConfigure",doSave:!1})},serialize(){var n,t,o,a={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph$a.cloneObject(this.flags),order:this.order,mode:this.mode};return this.constructor===LiteGraph$a.LGraphNode&&this.last_serialization?this.last_serialization:(this.inputs&&(a.inputs=LiteGraph$a.cloneObject(this.inputs)),this.outputs&&(this.outputs.forEach(r=>{delete r._data}),a.outputs=LiteGraph$a.cloneObject(this.outputs)),this.title&&this.title!=this.constructor.title&&(a.title=this.title),this.properties&&(a.properties=LiteGraph$a.cloneObject(this.properties)),this.widgets&&this.serialize_widgets&&(a.widgets_values=this.widgets.map(r=>{var l;return(l=r==null?void 0:r.value)!=null?l:null})),(n=a.type)!=null||(a.type=this.constructor.type),this.color&&(a.color=this.color),this.bgcolor&&(a.bgcolor=this.bgcolor),this.boxcolor&&(a.boxcolor=this.boxcolor),this.shape&&(a.shape=this.shape),(t=this.onSerialize)!=null&&t.call(this,a)&&((o=LiteGraph$a.warn)==null||o.call(LiteGraph$a,"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter")),a)},clone(){var n,t,o=LiteGraph$a.createNode(this.type);if(!o)return null;var a=LiteGraph$a.cloneObject(this.serialize());return(n=a.inputs)==null||n.forEach(r=>{r.link=null}),(t=a.outputs)==null||t.forEach(r=>{r.links&&(r.links.length=0)}),delete a.id,LiteGraph$a.use_uuids&&(a.id=LiteGraph$a.uuidv4()),o.configure(a),o},toString(){return JSON.stringify(this.serialize())},getTitle(){var n;return(n=this.title)!=null?n:this.constructor.title}};let LiteGraph$9=null;function setPropertiesWidgetsMethodsLiteGraph(n){LiteGraph$9=n}const propertiesWidgetsMethods={setProperty(n,t){var o,a;if(this.properties||(this.properties={}),t===this.properties[n])return;const r=this.properties[n];this.properties[n]=t,((o=this.onPropertyChanged)==null?void 0:o.call(this,n,t,r))===!1&&(this.properties[n]=r);const l=(a=this.widgets)==null?void 0:a.find(p=>{var h;return p&&((h=p.options)==null?void 0:h.property)===n});l&&(l.value=t)},addProperty(n,t,o,a){var r,l;const p={name:n,type:o,default_value:t,...a};return this.properties_info=(r=this.properties_info)!=null?r:[],this.properties_info.push(p),this.properties=(l=this.properties)!=null?l:{},this.properties[n]=t,p},getPropertyInfo(n){var t=null;if(this.properties_info){for(var o=0;o<this.properties_info.length;++o)if(this.properties_info[o].name==n){t=this.properties_info[o];break}}return this.constructor[`@${n}`]&&(t=this.constructor[`@${n}`]),this.constructor.widgets_info&&this.constructor.widgets_info[n]&&(t=this.constructor.widgets_info[n]),!t&&this.onGetPropertyInfo&&(t=this.onGetPropertyInfo(n)),t||(t={}),t.type||(t.type=typeof this.properties[n]),t.widget=="combo"&&(t.type="enum"),t},addWidget(n,t,o,a,r){var l,p,h;(l=this.widgets)!=null||(this.widgets=[]),!r&&a&&a.constructor===Object&&(r=a,a=null),r&&r.constructor===String&&(r={property:r}),a&&a.constructor===String&&(r!=null||(r={}),r.property=a,a=null),a&&a.constructor!==Function&&((p=LiteGraph$9.warn)==null||p.call(LiteGraph$9,"addWidget: callback must be a function"),a=null);var c={type:n.toLowerCase(),name:t,value:o,callback:a,options:r||{}};if(c.options.y!==void 0&&(c.y=c.options.y),!a&&!c.options.callback&&!c.options.property&&((h=LiteGraph$9.warn)==null||h.call(LiteGraph$9,"LiteGraph addWidget(...) without a callback or property assigned")),n=="combo"&&!c.options.values)throw Error("LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }");return this.widgets.push(c),this.setSize(this.computeSize()),c},addCustomWidget(n){var t;return(t=this.widgets)!=null||(this.widgets=[]),this.widgets.push(n),n}},ioDataMethods={setOutputData(n,t){var o;if(this.outputs){if((n==null?void 0:n.constructor)===String)n=this.findOutputSlot(n);else if(n==-1||n>=this.outputs.length)return;var a=this.outputs[n];a&&(a._data=t,(o=this.outputs[n].links)==null||o.forEach(r=>{const l=this.graph.links[r];l&&(l.data=t)}))}},setOutputDataType(n,t){var o,a;if(this.outputs&&!(n==-1||n>=this.outputs.length)){var r=this.outputs[n];r&&(r.type=t,(a=(o=this.outputs[n])==null?void 0:o.links)==null||a.forEach(l=>{this.graph.links[l]&&(this.graph.links[l].type=t)}))}},getInputData(n,t,o){var a;if(this.inputs&&!(n>=this.inputs.length||this.inputs[n].link==null)){var r=this.inputs[n].link,l=this.graph.links[r];if(!l)return null;if(!t)return l.data;var p=this.graph.getNodeById(l.origin_id);if(!p)return l.data;if(o){var h=this.id+"_getInputData_forced_"+Math.floor(Math.random()*9999),c={action:h,options:{action_call:h}};this.refreshAncestors(c)}return p.updateOutputData?p.updateOutputData(l.origin_slot):(a=p.doExecute)==null||a.call(p),l.data}},getInputDataType(n){if(!this.inputs||n>=this.inputs.length||this.inputs[n].link==null)return null;var t=this.inputs[n].link,o=this.graph.links[t];if(!o)return null;var a=this.graph.getNodeById(o.origin_id);if(!a)return o.type;var r=a.outputs[o.origin_slot];return r?r.type:null},getInputDataByName(n,t){var o=this.findInputSlot(n);return o==-1?null:this.getInputData(o,t)},isInputConnected(n){return this.inputs?n<this.inputs.length&&this.inputs[n].link!=null:!1},getInputInfo(n){return this.inputs&&n<this.inputs.length?this.inputs[n]:null},getInputLink(n){if(!this.inputs)return null;if(n<this.inputs.length){var t=this.inputs[n];return this.graph.links[t.link]}return null},getInputNode(n){if(!this.inputs||n>=this.inputs.length)return null;var t=this.inputs[n];if(!t||t.link===null)return null;var o=this.graph.links[t.link];return o?this.graph.getNodeById(o.origin_id):null},getInputOrProperty(n){if(this.inputs)for(var t=0,o=this.inputs.length;t<o;++t){var a=this.inputs[t];if(n==a.name&&a.link!=null){var r=this.graph.links[a.link];if(r)return r.data}}return this.properties?this.properties[n]:null},getOutputData(n){if(!this.outputs||n>=this.outputs.length)return null;var t=this.outputs[n];return t._data},getOutputInfo(n){return this.outputs&&n<this.outputs.length?this.outputs[n]:null},isOutputConnected(n){return this.outputs?n<this.outputs.length&&this.outputs[n].links&&this.outputs[n].links.length:!1},isAnyOutputConnected(){return this.outputs?this.outputs.some(n=>n.links&&n.links.length):!1},getOutputNodes(n){if(!this.outputs||n>=this.outputs.length)return null;const t=this.outputs[n];return!t.links||t.links.length===0?null:t.links.map(o=>this.graph.links[o]).filter(o=>o).map(o=>this.graph.getNodeById(o.target_id)).filter(o=>o)}};let LiteGraph$8=null;function setExecutionActionsMethodsLiteGraph(n){LiteGraph$8=n}const executionActionsMethods={addOnTriggerInput(){var n=this.findInputSlot("onTrigger");return n==-1?(this.addInput("onTrigger",LiteGraph$8.EVENT,{removable:!0,nameLocked:!0}),this.findInputSlot("onTrigger")):n},addOnExecutedOutput(){var n=this.findOutputSlot("onExecuted");return n==-1?(this.addOutput("onExecuted",LiteGraph$8.ACTION,{removable:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")):n},onAfterExecuteNode(n,t){var o,a=this.findOutputSlot("onExecuted");a!=-1&&((o=LiteGraph$8.debug)==null||o.call(LiteGraph$8,this.id+":"+this.order+" triggering slot onAfterExecute",n,t),this.triggerSlot(a,n,null,t))},changeMode(n){switch(n){case LiteGraph$8.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph$8.ON_EVENT:break;case LiteGraph$8.NEVER:break;case LiteGraph$8.ALWAYS:break;case LiteGraph$8.ON_REQUEST:break;default:return!1}return this.mode=n,!0},executePendingActions(){!this._waiting_actions||!this._waiting_actions.length||(this._waiting_actions.forEach(n=>{this.onAction(n[0],n[1],n[2],n[3],n[4])}),this._waiting_actions.length=0)},doExecute(n,t={}){var o,a,r,l,p;if(this.onExecute){if((o=t.action_call)!=null||(t.action_call=`${this.id}_exec_${Math.floor(Math.random()*9999)}`),this.graph.nodes_executing&&this.graph.nodes_executing[this.id]){(a=LiteGraph$8.debug)==null||a.call(LiteGraph$8,"NODE already executing! Prevent! "+this.id+":"+this.order);return}if(LiteGraph$8.ensureNodeSingleExecution&&this.exec_version&&this.exec_version>=this.graph.iteration&&this.exec_version!==void 0){(r=LiteGraph$8.debug)==null||r.call(LiteGraph$8,"!! NODE already EXECUTED THIS STEP !! "+this.exec_version);return}if(LiteGraph$8.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&t&&t.action_call&&this.graph.nodes_executedAction[this.id]==t.action_call){(l=LiteGraph$8.debug)==null||l.call(LiteGraph$8,"!! NODE already ACTION THIS STEP !! "+t.action_call);return}this.graph.nodes_executing[this.id]=!0,this.onExecute(n,t),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,t&&t.action_call&&(this.action_call=t.action_call,this.graph.nodes_executedAction[this.id]=t.action_call)}this.execute_triggered=2,(p=this.onAfterExecuteNode)==null||p.call(this,n,t)},execute(n,t={}){return this.doExecute(n,t)},actionDo(n,t,o={},a){var r,l,p,h;if(this.onAction){if((r=o.action_call)!=null||(o.action_call=`${this.id}_${n||"action"}_${Math.floor(Math.random()*9999)}`),LiteGraph$8.ensureNodeSingleAction&&this.graph.nodes_actioning&&this.graph.nodes_actioning[this.id]==o.action_call)return;if((l=LiteGraph$8.debug)==null||l.call(LiteGraph$8,"CheckActioned ? "+this.id+":"+this.order+" :: "+this.action_call),LiteGraph$8.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&o&&o.action_call&&this.graph.nodes_executedAction[this.id]==o.action_call){(p=LiteGraph$8.debug)==null||p.call(LiteGraph$8,"!! NODE already ACTION THIS STEP !! "+o.action_call),\u00E7;return}this.graph.nodes_actioning[this.id]=n||"actioning",this.onAction(n,t,o,a),this.graph.nodes_actioning[this.id]=!1,o&&o.action_call&&(this.action_call=o.action_call,this.graph.nodes_executedAction[this.id]=o.action_call)}this.action_triggered=2,(h=this.onAfterExecuteNode)==null||h.call(this,t,o)},trigger(n,t,o){!this.outputs||this.outputs.length===0||(this.graph&&(this.graph._last_trigger_time=LiteGraph$8.getTime()),this.outputs.forEach((a,r)=>{a&&a.type===LiteGraph$8.EVENT&&(!n||a.name===n)&&this.triggerSlot(r,t,null,o)}))},triggerSlot(n,t,o,a={}){var r,l,p,h;if(this.outputs){if(n==null){(r=LiteGraph$8.error)==null||r.call(LiteGraph$8,"triggerSlot","slot must be a number");return}n.constructor!==Number&&((l=LiteGraph$8.warn)==null||l.call(LiteGraph$8,"triggerSlot","slot must be a number, use node.trigger('name') if you want to use a string"));var c=this.outputs[n];if(c){var u=c.links;if(!(!u||!u.length)&&!(this.graph&&this.graph.ancestorsCall)){this.graph&&(this.graph._last_trigger_time=LiteGraph$8.getTime());for(var d=0;d<u.length;++d){var f=u[d];if(!(o!=null&&o!=f)){var L=this.graph.links[u[d]];if(L){L._last_time=LiteGraph$8.getTime();var _=this.graph.getNodeById(L.target_id);if(_){if(_.mode===LiteGraph$8.ON_TRIGGER)a.action_call||(a.action_call=`${this.id}_trigg_${Math.floor(Math.random()*9999)}`),LiteGraph$8.refreshAncestorsOnTriggers&&_.refreshAncestors({action:"trigger",param:t,options:a}),_.onExecute&&_.doExecute(t,a);else if(_.onAction){a.action_call||(a.action_call=`${this.id}_act_${Math.floor(Math.random()*9999)}`);let g=_.inputs[L.target_slot];(p=LiteGraph$8.debug)==null||p.call(LiteGraph$8,"triggerSlot","will call onACTION: "+this.id+":"+this.order+" :: "+g.name),LiteGraph$8.refreshAncestorsOnActions&&_.refreshAncestors({action:g.name,param:t,options:a}),LiteGraph$8.use_deferred_actions&&_.onExecute?((h=_._waiting_actions)!=null||(_._waiting_actions=[]),_._waiting_actions.push([g.name,t,a,L.target_slot])):_.actionDo(g.name,t,a,L.target_slot)}}}}}}}}},clearTriggeredSlot(n,t){!this.outputs||!this.outputs[n]||!this.outputs[n].links||this.outputs[n].links.forEach(o=>{if(t!==null&&t!==o)return;const a=this.graph.links[o];a&&(a._last_time=0)})}};let LiteGraph$7=null;function setSlotsMutationMethodsLiteGraph(n){LiteGraph$7=n}const slotsMutationMethods={setSize(n){var t;this.size=n,(t=this.onResize)==null||t.call(this,this.size)},addInput(n,t,o){return this.addSlot(n,t,o,!0)},addOutput(n,t,o){return this.addSlot(n,t,o,!1)},addSlot(n,t,o,a){var r,l,p,h;const c=a?{name:n,type:t,link:null,...o}:{name:n,type:t,links:null,...o};return a?(this.inputs=(r=this.inputs)!=null?r:[],this.inputs.push(c),(l=this.onInputAdded)==null||l.call(this,c),LiteGraph$7.registerNodeAndSlotType(this,t)):(this.outputs=(p=this.outputs)!=null?p:[],this.outputs.push(c),(h=this.onOutputAdded)==null||h.call(this,c),LiteGraph$7.auto_load_slot_types&&LiteGraph$7.registerNodeAndSlotType(this,t,!0)),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),c},addInputs(n){this.addSlots(n,!0)},addOutputs(n){this.addSlots(n,!1)},addSlots(n,t){var o;typeof n=="string"&&(n=[n]),n.forEach(a=>{var r,l,p,h,c,u;const d=t?{name:a[0],type:a[1],link:null,...(r=a[2])!=null?r:{}}:{name:a[0],type:a[1],links:null,...(l=a[2])!=null?l:{}};t?(this.inputs=(p=this.inputs)!=null?p:[],this.inputs.push(d),(h=this.onInputAdded)==null||h.call(this,d),LiteGraph$7.registerNodeAndSlotType(this,a[1])):(this.outputs=(c=this.outputs)!=null?c:[],this.outputs.push(d),(u=this.onOutputAdded)==null||u.call(this,d),LiteGraph$7.auto_load_slot_types&&LiteGraph$7.registerNodeAndSlotType(this,a[1],!0))}),this.setSize(this.computeSize()),(o=this.setDirtyCanvas)==null||o.call(this,!0,!0)},removeInput(n){var t;this.disconnectInput(n);const o=this.inputs.splice(n,1)[0];this.inputs.slice(n).filter(a=>!!a).forEach(a=>{const r=this.graph.links[a.link];r!=null&&r.target_slot&&r.target_slot--}),this.setSize(this.computeSize()),(t=this.onInputRemoved)==null||t.call(this,n,o),this.setDirtyCanvas(!0,!0)},removeOutput(n){var t;this.disconnectOutput(n),this.outputs=this.outputs.filter((o,a)=>a!==n),this.outputs.slice(n).forEach(o=>{!o||!o.links||o.links.forEach(a=>{const r=this.graph.links[a];r&&(r.origin_slot-=1)})}),this.setSize(this.computeSize()),(t=this.onOutputRemoved)==null||t.call(this,n),this.setDirtyCanvas(!0,!0)},addConnection(n,t,o,a){var r={name:n,type:t,pos:o,direction:a,links:null};return this.connections.push(r),r}};let LiteGraph$6=null;function setSlotsQueryMethodsLiteGraph(n){LiteGraph$6=n}const slotsQueryMethods={findInputSlot(n,t){if(!this.inputs)return-1;for(var o=0,a=this.inputs.length;o<a;++o)if(n==this.inputs[o].name)return t?this.inputs[o]:o;return-1},findOutputSlot(n,t=!1){if(!this.outputs)return-1;for(var o=0,a=this.outputs.length;o<a;++o)if(n==this.outputs[o].name)return t?this.outputs[o]:o;return-1},findInputSlotFree(n={}){var t={returnObj:!1,typesNotAccepted:[]},o=Object.assign(t,n);if(!this.inputs)return-1;for(var a=0,r=this.inputs.length;a<r;++a)if(!(this.inputs[a].link&&this.inputs[a].link!=null)&&!(o.typesNotAccepted&&o.typesNotAccepted.includes&&o.typesNotAccepted.includes(this.inputs[a].type)))return o.returnObj?this.inputs[a]:a;return-1},findOutputSlotFree(n={}){var t={returnObj:!1,typesNotAccepted:[]},o=Object.assign(t,n);if(!this.outputs)return-1;for(let a=0,r=this.outputs.length;a<r;++a)if(!(this.outputs[a].links&&this.outputs[a].links!=null)&&!(o.typesNotAccepted&&o.typesNotAccepted.includes&&o.typesNotAccepted.includes(this.outputs[a].type)))return o.returnObj?this.outputs[a]:a;return-1},findInputSlotByType(n,t,o,a){return this.findSlotByType(!0,n,t,o,a)},findOutputSlotByType(n,t,o,a){return this.findSlotByType(!1,n,t,o,a)},findSlotByType(n=!1,t,o=!1,a=!1,r=!1){var l=n?this.inputs:this.outputs;if(!l)return-1;(t==""||t=="*")&&(t=0);for(let p=0,h=l.length;p<h;++p){let c=(t+"").toLowerCase().split(","),u=l[p].type=="0"||l[p].type=="*"?"0":l[p].type;u=(u+"").toLowerCase().split(",");for(let d=0;d<c.length;d++)for(let f=0;f<u.length;f++)if(c[d]=="_event_"&&(c[d]=LiteGraph$6.EVENT),u[d]=="_event_"&&(u[d]=LiteGraph$6.EVENT),c[d]=="*"&&(c[d]=0),u[d]=="*"&&(u[d]=0),c[d]==u[f]){if(a&&l[p].links&&l[p].links!==null)continue;return o?l[p]:p}}if(a&&!r)for(let p=0,h=l.length;p<h;++p){let c=(t+"").toLowerCase().split(","),u=l[p].type=="0"||l[p].type=="*"?"0":l[p].type;u=(u+"").toLowerCase().split(",");for(let d=0;d<c.length;d++)for(let f=0;f<u.length;f++)if(c[d]=="*"&&(c[d]=0),u[d]=="*"&&(u[d]=0),c[d]==u[f])return o?l[p]:p}return-1},getSlotInPosition(n,t){var o=new Float32Array(2);if(this.inputs)for(let a=0,r=this.inputs.length;a<r;++a){let l=this.inputs[a];if(this.getConnectionPos(!0,a,o),LiteGraph$6.isInsideRectangle(n,t,o[0]-10,o[1]-5,20,10))return{input:l,slot:a,link_pos:o}}if(this.outputs)for(let a=0,r=this.outputs.length;a<r;++a){let l=this.outputs[a];if(this.getConnectionPos(!1,a,o),LiteGraph$6.isInsideRectangle(n,t,o[0]-10,o[1]-5,20,10))return{output:l,slot:a,link_pos:o}}return null}};let LiteGraph$5=null;function setConnectionsMethodsLiteGraph(n){LiteGraph$5=n}const connectionsMethods={connectByType(n,t,o="*",a={}){var r,l,p,h,c,u={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},d=Object.assign(u,a);t&&t.constructor===Number&&(t=this.graph.getNodeById(t));var f=t.findInputSlotByType(o,!1,!0);return f>=0&&f!==null?((r=LiteGraph$5.debug)==null||r.call(LiteGraph$5,"CONNbyTYPE type "+o+" for "+f),this.connect(n,t,f)):d.createEventInCase&&o==LiteGraph$5.EVENT?((l=LiteGraph$5.debug)==null||l.call(LiteGraph$5,"connect WILL CREATE THE onTrigger "+o+" to "+t),this.connect(n,t,-1)):d.generalTypeInCase&&(f=t.findInputSlotByType(0,!1,!0,!0),(p=LiteGraph$5.debug)==null||p.call(LiteGraph$5,"connect TO a general type (*, 0), if not found the specific type ",o," to ",t,"RES_SLOT:",f),f>=0)?this.connect(n,t,f):d.firstFreeIfOutputGeneralInCase&&(o==0||o=="*"||o=="")&&(f=t.findInputSlotFree({typesNotAccepted:[LiteGraph$5.EVENT]}),(h=LiteGraph$5.debug)==null||h.call(LiteGraph$5,"connect TO TheFirstFREE ",o," to ",t,"RES_SLOT:",f),f>=0)?this.connect(n,t,f):((c=LiteGraph$5.debug)==null||c.call(LiteGraph$5,"no way to connect type: ",o," to targetNODE ",t),null)},connectByTypeOutput(n,t,o="*",a={}){var r,l,p,h={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},c=Object.assign(h,a);t&&t.constructor===Number&&(t=this.graph.getNodeById(t));var u=t.findOutputSlotByType(o,!1,!0);return u>=0&&u!==null?((r=LiteGraph$5.debug)==null||r.call(LiteGraph$5,"CONNbyTYPE OUT! type "+o+" for "+u),t.connect(u,this,n)):c.generalTypeInCase&&(u=t.findOutputSlotByType(0,!1,!0,!0),u>=0)?t.connect(u,this,n):c.createEventInCase&&o==LiteGraph$5.EVENT&&LiteGraph$5.do_add_triggers_slots?(u=t.addOnExecutedOutput(),t.connect(u,this,n)):c.firstFreeIfInputGeneralInCase&&(o==0||o=="*"||o==""||o=="undefined")&&(u=t.findOutputSlotFree({typesNotAccepted:[LiteGraph$5.EVENT]}),u>=0)?t.connect(u,this,n):((l=LiteGraph$5.debug)==null||l.call(LiteGraph$5,"no way to connect byOUT type: ",o," to sourceNODE ",t),(p=LiteGraph$5.log)==null||p.call(LiteGraph$5,"type OUT! "+o+" not found or not free?"),null)},connect(n,t,o=0){var a,r,l,p,h,c,u,d,f,L,_,g,m,b;if(!this.graph)return(a=LiteGraph$5.log)==null||a.call(LiteGraph$5,"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(n.constructor===String){if(n=this.findOutputSlot(n),n==-1)return(r=LiteGraph$5.log)==null||r.call(LiteGraph$5,`Connect: Error, no slot of name ${n}`),null}else if(!this.outputs||n>=this.outputs.length)return(l=LiteGraph$5.log)==null||l.call(LiteGraph$5,"Connect: Error, slot number not found"),null;if(t&&t.constructor===Number&&(t=this.graph.getNodeById(t)),!t)throw new Error("target node is null");if(t==this)return null;if(o.constructor===String){if(o=t.findInputSlot(o),o==-1)return(p=LiteGraph$5.log)==null||p.call(LiteGraph$5,`Connect: Error, no slot of name ${o}`),null}else if(o===LiteGraph$5.EVENT)if(LiteGraph$5.do_add_triggers_slots)t.changeMode(LiteGraph$5.ON_TRIGGER),o=t.findInputSlot("onTrigger");else return null;else if(!t.inputs||o>=t.inputs.length)return(h=LiteGraph$5.log)==null||h.call(LiteGraph$5,"Connect: Error, slot number not found"),null;var C=!1,T=t.inputs[o],E=null,N=this.outputs[n];if(!this.outputs[n])return(c=LiteGraph$5.log)==null||c.call(LiteGraph$5,"Invalid slot passed: ",n,this.outputs),null;if(t.onBeforeConnectInput&&(o=t.onBeforeConnectInput(t)),((u=this.onConnectOutput)==null?void 0:u.call(this,n,T.type,T,t,o))===!1)return null;if(o===!1||o===null||!LiteGraph$5.isValidConnection(N.type,T.type))return this.setDirtyCanvas(!1,!0),C&&this.graph.connectionChange(this,E),null;if((d=LiteGraph$5.debug)==null||d.call(LiteGraph$5,"DBG targetSlot",o),((f=t.onConnectInput)==null?void 0:f.call(t,o,N.type,N,this,n))===!1||((L=this.onConnectOutput)==null?void 0:L.call(this,n,T.type,T,t,o))===!1)return null;t.inputs[o]&&t.inputs[o].link!=null&&(this.graph.beforeChange(),t.disconnectInput(o,{doProcessChange:!1}),C=!0),(_=N.links)!=null&&_.length&&N.type===LiteGraph$5.EVENT&&(LiteGraph$5.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(n,!1,{doProcessChange:!1}),C=!0));var A;return LiteGraph$5.use_uuids?A=LiteGraph$5.uuidv4():A=++this.graph.last_link_id,E=new LiteGraph$5.LLink(A,T.type||N.type,this.id,n,t.id,o),this.graph.links[E.id]=E,N.links==null&&(N.links=[]),N.links.push(E.id),!t.inputs||typeof t.inputs[o]=="undefined"?((g=LiteGraph$5.warn)==null||g.call(LiteGraph$5,"connect aborted: target slot does not exist on target node",t,o),N.links.pop(),delete this.graph.links[E.id],null):(t.inputs[o].link=E.id,(m=this.onConnectionsChange)==null||m.call(this,LiteGraph$5.OUTPUT,n,!0,E,N),(b=t.onConnectionsChange)==null||b.call(t,LiteGraph$5.INPUT,o,!0,E,T),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,t,o,this,n),this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,this,n,t,o)),this.graph.onGraphChanged({action:"connect"}),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,E),E)},disconnectOutput(n,t,o={}){var a,r,l,p,h,c,u={doProcessChange:!0},d=Object.assign(u,o);if(n.constructor===String){if(n=this.findOutputSlot(n),n==-1)return(a=LiteGraph$5.log)==null||a.call(LiteGraph$5,`Connect: Error, no slot of name ${n}`),!1}else if(!this.outputs||n>=this.outputs.length)return(r=LiteGraph$5.log)==null||r.call(LiteGraph$5,"Connect: Error, slot number not found"),!1;var f=this.outputs[n];if(!f||!f.links||f.links.length==0)return!1;if(t){if(t.constructor===Number&&(t=this.graph.getNodeById(t)),!t)throw new Error("Target Node not found");for(let _=0,g=f.links.length;_<g;_++){let m=f.links[_],b=this.graph.links[m];if(b.target_id==t.id){f.links.splice(_,1);var L=t.inputs[b.target_slot];L.link=null,delete this.graph.links[m],(l=this.graph)==null||l.onGraphChanged({action:"disconnectOutput",doSave:d.doProcessChange}),(p=t.onConnectionsChange)==null||p.call(t,LiteGraph$5.INPUT,b.target_slot,!1,b,L),(h=this.onConnectionsChange)==null||h.call(this,LiteGraph$5.OUTPUT,n,!1,b,f),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,this,n),this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,this,n),this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,t,b.target_slot));break}}}else{for(let _=0,g=f.links.length;_<g;_++){let m=f.links[_],b=this.graph.links[m];b&&(t=this.graph.getNodeById(b.target_id),L=null,(c=this.graph)==null||c.onGraphChanged({action:"disconnectOutput",doSave:d.doProcessChange}),t&&(L=t.inputs[b.target_slot],L.link=null,t.onConnectionsChange&&t.onConnectionsChange(LiteGraph$5.INPUT,b.target_slot,!1,b,L),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,t,b.target_slot)),delete this.graph.links[m],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$5.OUTPUT,n,!1,b,f),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,this,n),this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,t,b.target_slot)))}f.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},disconnectInput(n,t={}){var o,a,r,l={doProcessChange:!0},p=Object.assign(l,t);if(n.constructor===String){if(n=this.findInputSlot(n),n==-1)return(o=LiteGraph$5.log)==null||o.call(LiteGraph$5,`Connect: Error, no slot of name ${n}`),!1}else if(!this.inputs||n>=this.inputs.length)return(a=LiteGraph$5.log)==null||a.call(LiteGraph$5,"Connect: Error, slot number not found"),!1;var h=this.inputs[n];if(!h)return!1;var c=this.inputs[n].link;if(c!=null){this.inputs[n].link=null;var u=this.graph.links[c];if(u){var d=this.graph.getNodeById(u.origin_id);if(!d)return!1;var f=d.outputs[u.origin_slot];if(!f||!f.links||f.links.length==0)return!1;for(var L=0,_=f.links.length;L<_;L++)if(f.links[L]==c){f.links.splice(L,1);break}delete this.graph.links[c],(r=this.graph)==null||r.onGraphChanged({action:"disconnectInput",doSave:p.doProcessChange}),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$5.INPUT,n,!1,u,h),d.onConnectionsChange&&d.onConnectionsChange(LiteGraph$5.OUTPUT,L,!1,u,f),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,d,L),this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,this,n))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0}};let LiteGraph$4=null;function setGeometryHitMethodsLiteGraph(n){LiteGraph$4=n}const geometryHitMethods={computeSize(n){if(this.constructor.size)return this.constructor.size.concat();var t=n||new Float32Array([0,0]),o=LiteGraph$4.NODE_TEXT_SIZE;const a=f=>f?o*f.length*.6:0;var r=a(this.title),l=0,p=0;this.inputs&&(l=this.inputs.reduce((f,L)=>{const _=L.label||L.name||"",g=a(_);return Math.max(f,g)},0)),this.outputs&&(p=this.outputs.reduce((f,L)=>{const _=L.label||L.name||"",g=a(_);return Math.max(f,g)},0)),t[0]=Math.max(l+p+10,r),t[0]=Math.max(t[0],LiteGraph$4.NODE_WIDTH),this.widgets&&this.widgets.length&&(t[0]=Math.max(t[0],LiteGraph$4.NODE_WIDTH*1.5));const h=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1,1)*LiteGraph$4.NODE_SLOT_HEIGHT;t[1]=h+(this.constructor.slot_start_y||0);let c=0;if(this.widgets&&this.widgets.length){for(var u=0,d=this.widgets.length;u<d;++u)this.widgets[u].computeSize?c+=this.widgets[u].computeSize(t[0])[1]+4:c+=LiteGraph$4.NODE_WIDGET_HEIGHT+4;c+=8}return this.widgets_up?t[1]=Math.max(t[1],c):this.widgets_start_y!=null?t[1]=Math.max(t[1],c+this.widgets_start_y):t[1]+=c,this.constructor.min_height&&t[1]<this.constructor.min_height&&(t[1]=this.constructor.min_height),t[1]+=6,t},getBounding(n=new Float32Array(4),t){const o=this.pos,a=this.flags.collapsed,r=this.size;let l=0,p=1,h=0,c=0;return t&&(l=4,p=6+l,h=4,c=5+h),n[0]=o[0]-l,n[1]=o[1]-LiteGraph$4.NODE_TITLE_HEIGHT-h,n[2]=a?(this._collapsed_width||LiteGraph$4.NODE_COLLAPSED_WIDTH)+p:r[0]+p,n[3]=a?LiteGraph$4.NODE_TITLE_HEIGHT+c:r[1]+LiteGraph$4.NODE_TITLE_HEIGHT+c,this.onBounding&&this.onBounding(n),n},isPointInside(n,t,o=0,a){var r=this.graph&&this.graph.isLive()?0:LiteGraph$4.NODE_TITLE_HEIGHT;if(a&&(r=0),this.flags&&this.flags.collapsed){if(LiteGraph$4.isInsideRectangle(n,t,this.pos[0]-o,this.pos[1]-LiteGraph$4.NODE_TITLE_HEIGHT-o,(this._collapsed_width||LiteGraph$4.NODE_COLLAPSED_WIDTH)+2*o,LiteGraph$4.NODE_TITLE_HEIGHT+2*o))return!0}else if(this.pos[0]-4-o<n&&this.pos[0]+this.size[0]+4+o>n&&this.pos[1]-r-o<t&&this.pos[1]+this.size[1]+o>t)return!0;return!1},getConnectionPos(n,t,o=new Float32Array(2)){var a=0;n&&this.inputs&&(a=this.inputs.length),!n&&this.outputs&&(a=this.outputs.length);var r=LiteGraph$4.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var l=this._collapsed_width||LiteGraph$4.NODE_COLLAPSED_WIDTH;return this.horizontal?(o[0]=this.pos[0]+l*.5,n?o[1]=this.pos[1]-LiteGraph$4.NODE_TITLE_HEIGHT:o[1]=this.pos[1]):(n?o[0]=this.pos[0]:o[0]=this.pos[0]+l,o[1]=this.pos[1]-LiteGraph$4.NODE_TITLE_HEIGHT*.5),o}return n&&t==-1?(o[0]=this.pos[0]+LiteGraph$4.NODE_TITLE_HEIGHT*.5,o[1]=this.pos[1]+LiteGraph$4.NODE_TITLE_HEIGHT*.5,o):n&&a>t&&this.inputs[t].pos?(o[0]=this.pos[0]+this.inputs[t].pos[0],o[1]=this.pos[1]+this.inputs[t].pos[1],o):!n&&a>t&&this.outputs[t].pos?(o[0]=this.pos[0]+this.outputs[t].pos[0],o[1]=this.pos[1]+this.outputs[t].pos[1],o):this.horizontal?(o[0]=this.pos[0]+(t+.5)*(this.size[0]/a),n?o[1]=this.pos[1]-LiteGraph$4.NODE_TITLE_HEIGHT:o[1]=this.pos[1]+this.size[1],o):(n?o[0]=this.pos[0]+r:o[0]=this.pos[0]+this.size[0]+1-r,o[1]=this.pos[1]+(t+.7)*LiteGraph$4.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),o)},localToScreen(n,t,o){return[(n+this.pos[0])*o.scale+o.offset[0],(t+this.pos[1])*o.scale+o.offset[1]]}};let LiteGraph$3=null;function setCanvasIntegrationMethodsLiteGraph(n){LiteGraph$3=n}const canvasIntegrationMethods={trace(n){var t,o,a,r;this.console||(this.console=[]),(o=(t=this.console).push)==null||o.call(t,n),this.console.length>this.constructor.MAX_CONSOLE&&((r=(a=this.console).shift)==null||r.call(a)),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,n)},setDirtyCanvas(n,t){this.graph&&this.graph.sendActionToCanvas("setDirty",[n,t])},loadImage(n){var t=new Image;t.src=LiteGraph$3.node_images_path+n,t.ready=!1;var o=this;return t.onload=function(){this.ready=!0,o.setDirtyCanvas(!0)},t},captureInput(n){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var t=this.graph.list_of_graphcanvas,o=0;o<t.length;++o){var a=t[o];!n&&a.node_capturing_input!=this||(a.node_capturing_input=n?this:null)}},collapse(n){this.graph.onGraphChanged({action:"collapse"}),!(this.constructor.collapsable===!1&&!n)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},pin(n){this.graph.onGraphChanged({action:"pin"}),n===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=n}};let LiteGraph$2=null;function setAncestorRefreshMethodsLiteGraph(n){LiteGraph$2=n}const ancestorRefreshMethods={refreshAncestors(n={}){var t={action:"",param:null,options:null,passParam:!0},o=Object.assign(t,n);if(this.inputs&&!(LiteGraph$2.preventAncestorRecalculation&&this.graph.node_ancestorsCalculated&&this.graph.node_ancestorsCalculated[this.id])){(!o.action||o.action=="")&&(o.action=this.id+"_ancestors"),(!o.param||o.param=="")&&(o.param=this.id+"_ancestors"),o.options||(o.options={}),o.options=Object.assign({action_call:o.action},o.options),this.graph.ancestorsCall=!0;var a={modesSkip:[LiteGraph$2.NEVER,LiteGraph$2.ON_EVENT,LiteGraph$2.ON_TRIGGER],modesOnly:[LiteGraph$2.ALWAYS,LiteGraph$2.ON_REQUEST],typesSkip:[LiteGraph$2.ACTION],typesOnly:[]},r=this.graph.getAncestors(this,a);for(iN in r)r[iN].doExecute(o.param,o.options),this.graph.node_ancestorsCalculated[r[iN].id]=!0;return this.graph.ancestorsCall=!1,this.graph.node_ancestorsCalculated[this.id]=!0,!0}}};let LiteGraph$1=null;function setMiscMethodsLiteGraph(n){LiteGraph$1=n}const miscMethods={alignToGrid(){this.pos[0]=LiteGraph$1.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph$1.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph$1.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph$1.CANVAS_GRID_SIZE)}};function installLGraphNodeDelegates(n,t){setLifecycleSerializationMethodsLiteGraph(t),setPropertiesWidgetsMethodsLiteGraph(t),setExecutionActionsMethodsLiteGraph(t),setSlotsMutationMethodsLiteGraph(t),setSlotsQueryMethodsLiteGraph(t),setConnectionsMethodsLiteGraph(t),setGeometryHitMethodsLiteGraph(t),setCanvasIntegrationMethodsLiteGraph(t),setAncestorRefreshMethodsLiteGraph(t),setMiscMethodsLiteGraph(t),[lifecycleSerializationMethods,propertiesWidgetsMethods,ioDataMethods,executionActionsMethods,slotsMutationMethods,slotsQueryMethods,connectionsMethods,geometryHitMethods,canvasIntegrationMethods,ancestorRefreshMethods,miscMethods].forEach(o=>{Object.entries(o).forEach(([a,r])=>{Object.defineProperty(n.prototype,a,{value:r,writable:!0,configurable:!0})})})}class LGraphNode{constructor(t="Unnamed"){this.title=t,this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}}set pos(t){var o;!t||t.length<2||((o=this._pos)!=null||(this._pos=new Float32Array(10,10)),this._pos[0]=t[0],this._pos[1]=t[1])}get pos(){return this._pos}}function setupLGraphNodeDelegates(n=LiteGraph){installLGraphNodeDelegates(LGraphNode,n)}class LGraphGroup{constructor(t="Group"){B(this,"isPointInside",LiteGraph.LGraphNode.prototype.isPointInside),B(this,"setDirtyCanvas",LiteGraph.LGraphNode.prototype.setDirtyCanvas);var o,a;this.title=t,this.font_size=24,this.color=(a=(o=LiteGraph.LGraphCanvas.node_colors.pale_blue)==null?void 0:o.groupcolor)!=null?a:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null}set pos(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])}get pos(){return this._pos}set size(t){!t||t.length<2||(this._size[0]=Math.max(140,t[0]),this._size[1]=Math.max(80,t[1]))}get size(){return this._size}configure(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,t.font_size&&(this.font_size=t.font_size)}serialize(){var t=this._bounding;return{title:this.title,bounding:t.map(o=>Math.round(o)),color:this.color,font_size:this.font_size}}move(t,o,a){var r,l;isNaN(t)&&((r=console.error)==null||r.call(console,"LGraphGroup.move() deltax NaN")),isNaN(o)&&((l=console.error)==null||l.call(console,"LGraphGroup.move() deltay NaN")),this._pos[0]+=t,this._pos[1]+=o,!a&&this._nodes.forEach(p=>{p.pos[0]+=t,p.pos[1]+=o})}recomputeInsideNodes(){this._nodes.length=0;var t=this.graph._nodes,o=new Float32Array(4);this._nodes=t.filter(a=>(a.getBounding(o),LiteGraph.overlapBounding(this._bounding,o)))}}function clear(){var n;this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.low_quality_rendering_counter=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),(n=this.onClear)==null||n.call(this)}function setGraph(n,t){var o;if(this.graph!=n){if(t||this.clear(),!n){(o=this.graph)==null||o.detachCanvas(this);return}n.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}}function getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}function openSubgraph(n){if(!n)throw new Error("graph cannot be null");if(this.graph==n)throw new Error("graph cannot be the same");this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),n.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)}function closeSubgraph(){if(!(!this._graph_stack||this._graph_stack.length==0)){var n=this.graph._subgraph_node,t=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},t.attachCanvas(this),this.setDirty(!0,!0),n&&(this.centerOnNode(n),this.selectNodes([n])),this.ds.offset=[0,0],this.ds.scale=1}}function getCurrentGraph(){return this.graph}function setCanvas(n,t){var o;if(n&&n.constructor===String&&(n=document.getElementById(n),!n))throw new Error("Error creating LiteGraph canvas: Canvas not found");if(n!==this.canvas&&(!n&&this.canvas&&(t||this.unbindEvents()),this.canvas=n,this.ds.element=n,!!n)){if(n.className+=" lgraphcanvas",n.data=this,n.tabindex="1",this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,n.getContext==null)throw n.localName!="canvas"?new Error("Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+n.localName):new Error("This browser doesn't support Canvas");var a=this.ctx=n.getContext("2d");a==null&&(n.webgl_enabled||(o=LiteGraph.info)==null||o.call(LiteGraph,"This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),t||this.bindEvents()}}function _doNothing(n){return n.preventDefault(),!1}function _doReturnTrue(n){return n.preventDefault(),!0}function bindEvents(){var n;if(this._events_binded){(n=LiteGraph.warn)==null||n.call(LiteGraph,"LGraphCanvas: events already binded");return}this._events_binded=!0;var t=this.canvas,o=this.getCanvasWindow(),a=o.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),t.addEventListener("pointerdown",this._mousedown_callback,!0),t.addEventListener("pointermove",this._mousemove_callback),t.addEventListener("pointerup",this._mouseup_callback,!0),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("wheel",this.processMouseWheel),t.addEventListener("keydown",this.processKey),a.addEventListener("keyup",this.processKey),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this.processDrop),t.addEventListener("dragenter",this._doReturnTrue,!1)}function unbindEvents(){var n;if(!this._events_binded){(n=LiteGraph.warn)==null||n.call(LiteGraph,"LGraphCanvas: no events binded");return}this._events_binded=!1;var t=this.canvas,o=this.getCanvasWindow(),a=o.document;t.removeEventListener("pointerdown",this._mousedown_callback),t.removeEventListener("pointermove",this._mousemove_callback),t.removeEventListener("pointerup",this._mouseup_callback),t.removeEventListener("contextmenu",this._doNothing),t.removeEventListener("wheel",this.processMouseWheel),t.removeEventListener("keydown",this.processKey),a.removeEventListener("keyup",this.processKey),t.removeEventListener("dragover",this._doNothing,!1),t.removeEventListener("dragend",this._doNothing,!1),t.removeEventListener("drop",this.processDrop),t.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null}function enableWebGL(){if(typeof GL=="undefined")throw new Error("litegl.js must be included to use a WebGL canvas");if(typeof enableWebGLCanvas=="undefined")throw new Error("webglCanvas.js must be included to use this feature");this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0}function setDirty(n,t){n&&(this.dirty_canvas=!0),t&&(this.dirty_bgcanvas=!0)}function getCanvasWindow(){var n;if(!this.canvas)return window;var t=this.canvas.ownerDocument;return(n=t.defaultView)!=null?n:t.parentWindow}function startRendering(){if(this.is_rendering)return;this.is_rendering=!0,n.call(this);function n(){this.pause_rendering||this.draw();var t=this.getCanvasWindow();this.is_rendering&&t.requestAnimationFrame(n.bind(this))}}function stopRendering(){this.is_rendering=!1}function resize(n,t){if(!n&&!t){var o=this.canvas.parentNode;n=o.offsetWidth,t=o.offsetHeight}this.canvas.width==n&&this.canvas.height==t||(this.canvas.width=n,this.canvas.height=t,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))}function switchLiveMode(n){if(!n){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var t=this,o=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var a=setInterval(function(){t.editor_alpha*=o,t.dirty_canvas=!0,t.dirty_bgcanvas=!0,o<1&&t.editor_alpha<.01&&(clearInterval(a),o<1&&(t.live_mode=!0)),o>1&&t.editor_alpha>.99&&(clearInterval(a),t.editor_alpha=1)},1)}function centerOnNode(n){this.ds.offset[0]=-n.pos[0]-n.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-n.pos[1]-n.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)}function adjustMouseEvent(n){var t=0,o=0;if(this.canvas){var a=this.canvas.getBoundingClientRect();t=n.clientX-a.left,o=n.clientY-a.top}else t=n.clientX,o=n.clientY;this.last_mouse_position[0]=t,this.last_mouse_position[1]=o,n.canvasX=t/this.ds.scale-this.ds.offset[0],n.canvasY=o/this.ds.scale-this.ds.offset[1]}function setZoom(n,t){this.ds.changeScale(n,t),this.dirty_canvas=!0,this.dirty_bgcanvas=!0}function convertOffsetToCanvas(n,t){return this.ds.convertOffsetToCanvas(n,t)}function convertCanvasToOffset(n,t){return this.ds.convertCanvasToOffset(n,t)}function convertEventToCanvasOffset(n){var t=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([n.clientX-t.left,n.clientY-t.top])}const temp=new Float32Array(4),temp_vec2=new Float32Array(2),tmp_area=new Float32Array(4),margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);function isOverNodeBox(n,t,o){var a=LiteGraph.NODE_TITLE_HEIGHT;return!!LiteGraph.isInsideRectangle(t,o,n.pos[0]+2,n.pos[1]+2-a,a-4,a-4)}function isOverNodeInput(n,t,o,a){if(n.inputs)for(let p=0,h=n.inputs.length;p<h;++p){var r=n.getConnectionPos(!0,p),l=!1;if(n.horizontal?l=LiteGraph.isInsideRectangle(t,o,r[0]-5,r[1]-10,10,20):l=LiteGraph.isInsideRectangle(t,o,r[0]-10,r[1]-5,40,10),l)return a&&(a[0]=r[0],a[1]=r[1]),p}return-1}function isOverNodeOutput(n,t,o,a){if(n.outputs)for(let p=0,h=n.outputs.length;p<h;++p){var r=n.getConnectionPos(!1,p),l=!1;if(n.horizontal?l=LiteGraph.isInsideRectangle(t,o,r[0]-5,r[1]-10,10,20):l=LiteGraph.isInsideRectangle(t,o,r[0]-10,r[1]-5,40,10),l)return a&&(a[0]=r[0],a[1]=r[1]),p}return-1}function bringToFront(n){var t=this.graph._nodes.indexOf(n);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.push(n))}function sendToBack(n){var t=this.graph._nodes.indexOf(n);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.unshift(n))}function computeVisibleNodes(n,t){var o=t||[];o.length=0,n=n||this.graph._nodes;for(var a=0,r=n.length;a<r;++a){var l=n[a];this.live_mode&&!l.onDrawBackground&&!l.onDrawForeground||LiteGraph.overlapBounding(this.visible_area,l.getBounding(temp,!0))&&o.push(l)}return o}class CoreController{constructor(t){this.host=t}clear(...t){return clear.apply(this.host,t)}setGraph(...t){return setGraph.apply(this.host,t)}getTopGraph(...t){return getTopGraph.apply(this.host,t)}openSubgraph(...t){return openSubgraph.apply(this.host,t)}closeSubgraph(...t){return closeSubgraph.apply(this.host,t)}getCurrentGraph(...t){return getCurrentGraph.apply(this.host,t)}setCanvas(...t){return setCanvas.apply(this.host,t)}_doNothing(...t){return _doNothing.apply(this.host,t)}_doReturnTrue(...t){return _doReturnTrue.apply(this.host,t)}bindEvents(...t){return bindEvents.apply(this.host,t)}unbindEvents(...t){return unbindEvents.apply(this.host,t)}enableWebGL(...t){return enableWebGL.apply(this.host,t)}setDirty(...t){return setDirty.apply(this.host,t)}getCanvasWindow(...t){return getCanvasWindow.apply(this.host,t)}startRendering(...t){return startRendering.apply(this.host,t)}stopRendering(...t){return stopRendering.apply(this.host,t)}resize(...t){return resize.apply(this.host,t)}switchLiveMode(...t){return switchLiveMode.apply(this.host,t)}centerOnNode(...t){return centerOnNode.apply(this.host,t)}adjustMouseEvent(...t){return adjustMouseEvent.apply(this.host,t)}setZoom(...t){return setZoom.apply(this.host,t)}convertOffsetToCanvas(...t){return convertOffsetToCanvas.apply(this.host,t)}convertCanvasToOffset(...t){return convertCanvasToOffset.apply(this.host,t)}convertEventToCanvasOffset(...t){return convertEventToCanvasOffset.apply(this.host,t)}isOverNodeBox(...t){return isOverNodeBox.apply(this.host,t)}isOverNodeInput(...t){return isOverNodeInput.apply(this.host,t)}isOverNodeOutput(...t){return isOverNodeOutput.apply(this.host,t)}bringToFront(...t){return bringToFront.apply(this.host,t)}sendToBack(...t){return sendToBack.apply(this.host,t)}computeVisibleNodes(...t){return computeVisibleNodes.apply(this.host,t)}}function processUserInputDown(n){var t,o;if(this.pointer_is_down&&n.isPrimary!==void 0&&!n.isPrimary?this.userInput_isNotPrimary=!0:this.userInput_isNotPrimary=!1,this.userInput_type=n.pointerType?n.pointerType:!1,this.userInput_id=n.pointerId?n.pointerId:!1,n.pointerType)switch(n.pointerType){case"mouse":break;case"pen":break;case"touch":break;default:(t=LiteGraph.log)==null||t.call(LiteGraph,"pointerType unknown "+ev.pointerType)}return n.button!==void 0&&(this.userInput_button=n.button,n.button),n.buttons!==void 0&&(this.userInput_button_s=n.buttons),this.userInput_touches=n.changedTouches!==void 0&&n.changedTouches.length!==void 0?n.changedTouches:!1,this.userInput_touches&&this.userInput_touches.length&&((o=LiteGraph.debug)==null||o.call(LiteGraph,"check multiTouches",n.changedTouches)),this.processMouseDown(n)}function processMouseDown(n){var t,o,a,r,l,p,h,c,u;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(n);var d=this.getCanvasWindow();LGraphCanvas.active_canvas=this;var f=n.clientX,L=n.clientY;(t=LiteGraph.log)==null||t.call(LiteGraph,"pointerevents: processMouseDown pointerId:"+n.pointerId+" which:"+n.which+" isPrimary:"+n.isPrimary+" :: x y "+f+" "+L,"previousClick",this.last_mouseclick,"diffTimeClick",this.last_mouseclick?LiteGraph.getTime()-this.last_mouseclick:"notlast"),this.ds.viewport=this.viewport;var _=!this.viewport||this.viewport&&f>=this.viewport[0]&&f<this.viewport[0]+this.viewport[2]&&L>=this.viewport[1]&&L<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(this.canvas.removeEventListener("pointermove",this._mousemove_callback),d.document.addEventListener("pointermove",this._mousemove_callback,!0),d.document.addEventListener("pointerup",this._mouseup_callback,!0)),!!_){var g=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes,5),m=!1,b=LiteGraph.getTime(),C=n.isPrimary===void 0||n.isPrimary,T=b-this.last_mouseclick<300&&C;if(this.mouse[0]=n.clientX,this.mouse[1]=n.clientY,this.graph_mouse[0]=n.canvasX,this.graph_mouse[1]=n.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&C?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.ContextMenu.closeAll(d),!((o=this.onMouse)!=null&&o.call(this,n))){if(n.which==1&&!this.userInput_isNotPrimary){if(n.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=n.canvasX,this.dragging_rectangle[1]=n.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,m=!0),LiteGraph.alt_drag_do_clone_nodes&&n.altKey&&g&&this.allow_interaction&&!m&&!this.read_only){let D=g,U=g.clone();if(U){if(U.pos[0]+=5,U.pos[1]+=5,this.graph.add(U,!1,{doCalcSize:!1}),g=U,LiteGraph.alt_shift_drag_connect_clone_with_input&&n.shiftKey&&D.inputs&&D.inputs.length)for(var E=0;E<D.inputs.length;++E){var N=D.inputs[E];if(!(!N||N.link==null)){var A=this.graph.links[N.link];if(A&&A.type!==LiteGraph.EVENT){var M;A.origin_id&&(M=this.graph.getNodeById(A.origin_id));var I=g;M&&I&&M.connect(A.origin_slot,I,A.target_slot)}}}m=!0,k||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=g),this.selected_nodes[g.id]||this.processNodeSelected(g,n))}}var O=!1;if(g&&(this.allow_interaction||g.flags.allow_interaction)&&!m&&!this.read_only){if(!this.live_mode&&!g.flags.pinned&&this.bringToFront(g),this.allow_interaction&&!this.connecting_node&&!g.flags.collapsed&&!this.live_mode)if(!m&&g.resizable!==!1&&LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,g.pos[0]+g.size[0]-5,g.pos[1]+g.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=g,this.canvas.style.cursor="se-resize",m=!0;else{if(g.outputs)for(let D=0,U=g.outputs.length;D<U;++D){let q=g.outputs[D],F=g.getConnectionPos(!1,D);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,F[0]-15,F[1]-10,30,20)){this.connecting_node=g,this.connecting_output=q,this.connecting_output.slot_index=D,this.connecting_pos=g.getConnectionPos(!1,D),this.connecting_slot=D,LiteGraph.shift_click_do_break_link_from&&n.shiftKey&&g.disconnectOutput(D),T?(a=g.onOutputDblClick)==null||a.call(g,D,n):(r=g.onOutputClick)==null||r.call(g,D,n),m=!0;break}}if(g.inputs)for(let D=0,U=g.inputs.length;D<U;++D){let q=g.inputs[D],F=g.getConnectionPos(!0,D);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,F[0]-15,F[1]-10,30,20)){if(T?(l=g.onInputDblClick)==null||l.call(g,D,n):(p=g.onInputClick)==null||p.call(g,D,n),q.link!==null){var S=this.graph.links[q.link];LiteGraph.click_do_break_link_to&&(g.disconnectInput(D),this.dirty_bgcanvas=!0,m=!0),n.shiftKey&&(LiteGraph.click_do_break_link_to||g.disconnectInput(D),this.connecting_node=this.graph._nodes_by_id[S.origin_id],this.connecting_slot=S.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,m=!0)}m||(this.connecting_node=g,this.connecting_input=q,this.connecting_input.slot_index=D,this.connecting_pos=g.getConnectionPos(!0,D),this.connecting_slot=D,this.dirty_bgcanvas=!0,m=!0)}}}if(!m){var k=!1,G=[n.canvasX-g.pos[0],n.canvasY-g.pos[1]],P=this.processNodeWidgets(g,this.graph_mouse,n);P&&(k=!0,this.node_widget=[g,P]),this.allow_interaction&&T&&this.selected_nodes[g.id]&&((h=g.onDblClick)==null||h.call(g,n,G,this),this.processNodeDblClicked(g),k=!0),g.onMouseDown&&g.onMouseDown(n,G,this)?k=!0:(g.subgraph&&!g.skip_subgraph_button&&!g.flags.collapsed&&G[0]>g.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&G[1]<0&&setTimeout(()=>{this.openSubgraph(g.subgraph)},10),this.live_mode&&(O=!0,k=!0)),k?g.is_selected||this.processNodeSelected(g,n):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=g),this.processNodeSelected(g,n)),this.dirty_canvas=!0}}else if(!m){if(!this.read_only)for(let D=0;D<this.visible_links.length;++D){var j=this.visible_links[D],Y=j._pos;if(!(!Y||n.canvasX<Y[0]-4||n.canvasX>Y[0]+4||n.canvasY<Y[1]-4||n.canvasY>Y[1]+4)){this.showLinkMenu(j,n),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(n.canvasX,n.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){n.ctrlKey&&(this.dragging_rectangle=null);var K=LiteGraph.distance([n.canvasX,n.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);K*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}T&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(n),n.preventDefault(),n.stopPropagation()),(c=LiteGraph.debug)==null||c.call(LiteGraph,"DEBUG canvas click is_double_click,this.allow_searchbox",T,this.allow_searchbox),O=!0}!m&&O&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(n.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(g&&this.allow_interaction&&!m&&!this.read_only&&!this.connecting_node&&!g.flags.collapsed&&!this.live_mode){var Q=!1,$=!1,R=!1;if(g.outputs)for(let D=0,U=g.outputs.length;D<U;++D){var z=g.outputs[D];let q=g.getConnectionPos(!1,D);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,q[0]-15,q[1]-10,30,20)){Q=z,$=D,R=!0;break}}if(g.inputs)for(let D=0,U=g.inputs.length;D<U;++D){var N=g.inputs[D];let F=g.getConnectionPos(!0,D);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,F[0]-15,F[1]-10,30,20)){Q=N,$=D,R=!1;break}}if(Q&&$!==!1){var H=.5-($+1)/(R?g.outputs.length:g.inputs.length),X=g.getBounding(),de=[R?X[0]+X[2]:X[0],n.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:R?g:null,slotFrom:R?$:null,nodeTo:R?null:g,slotTo:R?null:$,position:de,nodeType:"AUTO",posAdd:[R?30:-30,-H*130],posSizeFix:[R?0:-1,0]})}}}else!m&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(n.which==3||LiteGraph.two_fingers_opens_menu&&this.userInput_isNotPrimary)&&this.allow_interaction&&!m&&!this.read_only&&(g&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[g.id]||n.shiftKey||n.ctrlKey||n.metaKey)?this.selected_nodes[g.id]||this.selectNodes([g],!0):this.selectNodes([g])),this.processContextMenu(g,n));return this.last_mouse[0]=n.clientX,this.last_mouse[1]=n.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!d.document.activeElement||d.document.activeElement.nodeName.toLowerCase()!="input"&&d.document.activeElement.nodeName.toLowerCase()!="textarea")&&n.preventDefault(),n.stopPropagation(),(u=this.onMouseDown)==null||u.call(this,n),!1}}}}function processMouseMove(n){var t,o;if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(n);var a=[n.clientX,n.clientY];this.mouse[0]=a[0],this.mouse[1]=a[1];var r=[a[0]-this.last_mouse[0],a[1]-this.last_mouse[1]];if(this.last_mouse=a,this.graph_mouse[0]=n.canvasX,this.graph_mouse[1]=n.canvasY,this.block_click)return n.preventDefault(),!1;n.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,n,this.node_widget[1]),this.dirty_canvas=!0);var l=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=n.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=n.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[n.canvasX-this.selected_group.pos[0],n.canvasY-this.selected_group.pos[1]];else{var p=r[0]/this.ds.scale,h=r[1]/this.ds.scale;this.selected_group.move(p,h,n.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=r[0]/this.ds.scale,this.ds.offset[1]+=r[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||l&&l.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(let _=0,g=this.graph._nodes.length;_<g;++_)this.graph._nodes[_].mouseOver&&l!=this.graph._nodes[_]&&(this.graph._nodes[_].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(n),this.node_over=null,this.dirty_canvas=!0);if(l){if(l.redraw_on_mouse&&(this.dirty_canvas=!0),l.mouseOver||(l.mouseOver=!0,this.node_over=l,this.dirty_canvas=!0,(t=l.onMouseEnter)==null||t.call(l,n)),(o=l.onMouseMove)==null||o.call(l,n,[n.canvasX-l.pos[0],n.canvasY-l.pos[1]],this),this.connecting_node){let _;if(this.connecting_output){if(_=this._highlight_input||[0,0],!this.isOverNodeBox(l,n.canvasX,n.canvasY)){let g=this.isOverNodeInput(l,n.canvasX,n.canvasY,_);if(g!=-1&&l.inputs[g]){let m=l.inputs[g].type;LiteGraph.isValidConnection(this.connecting_output.type,m)&&(this._highlight_input=_,this._highlight_input_slot=l.inputs[g])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input&&(_=this._highlight_output||[0,0],this.isOverNodeBox(l,n.canvasX,n.canvasY))){let g=this.isOverNodeOutput(l,n.canvasX,n.canvasY,_);if(g!=-1&&l.outputs[g]){let m=l.outputs[g].type;LiteGraph.isValidConnection(this.connecting_input.type,m)&&(this._highlight_output=_)}else this._highlight_output=null}}this.canvas&&(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,l.pos[0]+l.size[0]-5,l.pos[1]+l.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var c=null;for(let _=0;_<this.visible_links.length;++_){var u=this.visible_links[_],d=u._pos;if(!(!d||n.canvasX<d[0]-4||n.canvasX>d[0]+4||n.canvasY<d[1]-4||n.canvasY>d[1]+4)){c=u;break}}c!=this.over_link_center&&(this.over_link_center=c,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=l&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(n,[n.canvasX-this.node_capturing_input.pos[0],n.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(let _ in this.selected_nodes){let g=this.selected_nodes[_];g.pos[0]+=r[0]/this.ds.scale,g.pos[1]+=r[1]/this.ds.scale,g.is_selected||this.processNodeSelected(g,n)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var f=[n.canvasX-this.resizing_node.pos[0],n.canvasY-this.resizing_node.pos[1]],L=this.resizing_node.computeSize();f[0]=Math.max(L[0],f[0]),f[1]=Math.max(L[1],f[1]),this.resizing_node.setSize(f),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return n.preventDefault(),!1}}function processMouseUp(n){var t,o=n.isPrimary===void 0||n.isPrimary;if(!o)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var a=this.getCanvasWindow(),r=a.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(r.removeEventListener("pointermove",this._mousemove_callback,!0),this.canvas.addEventListener("pointermove",this._mousemove_callback,!0),r.removeEventListener("pointerup",this._mouseup_callback,!0)),this.adjustMouseEvent(n);var l=LiteGraph.getTime();if(n.click_time=l-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),n.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,n),this.node_widget=null,this.selected_group){var p=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),h=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(p,h,n.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var c=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var u=this.graph._nodes,d=new Float32Array(4),f=Math.abs(this.dragging_rectangle[2]),L=Math.abs(this.dragging_rectangle[3]),_=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-f:this.dragging_rectangle[0],g=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-L:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=_,this.dragging_rectangle[1]=g,this.dragging_rectangle[2]=f,this.dragging_rectangle[3]=L,!c||f>10&&L>10){var m=[];for(let E=0;E<u.length;++E){var b=u[E];b.getBounding(d),LiteGraph.overlapBounding(this.dragging_rectangle,d)&&m.push(b)}m.length&&this.selectNodes(m,n.shiftKey)}else this.selectNodes([c],n.shiftKey||n.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var C=this.connecting_output||this.connecting_input,T=C.type;if(c=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes),c){let E;this.connecting_output?(E=this.isOverNodeInput(c,n.canvasX,n.canvasY),E!=-1?this.connecting_node.connect(this.connecting_slot,c,E):this.connecting_node.connectByType(this.connecting_slot,c,T)):this.connecting_input&&(E=this.isOverNodeOutput(c,n.canvasX,n.canvasY),E!=-1?c.connect(E,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,c,T))}else LiteGraph.release_link_on_empty_shows_menu&&(n.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(n,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(n,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:n}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:n}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null):this.node_dragged?(c=this.node_dragged,c&&n.click_time<300&&LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,c.pos[0],c.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&c.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),(t=this.onNodeMoved)==null||t.call(this,this.node_dragged),this.graph.onGraphChanged({action:"nodeDrag",doSave:!0}),this.graph.afterChange(this.node_dragged),this.node_dragged=null):(c=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes),!c&&n.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(n,[n.canvasX-this.node_over.pos[0],n.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(n,[n.canvasX-this.node_capturing_input.pos[0],n.canvasY-this.node_capturing_input.pos[1]]))}else n.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):n.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return o&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),n.stopPropagation(),n.preventDefault(),!1}}function processMouseWheel(n){if(!(!this.graph||!this.allow_dragcanvas)){var t=n.wheelDeltaY!=null?n.wheelDeltaY:n.detail*-60;this.adjustMouseEvent(n);var o=n.clientX,a=n.clientY,r=!this.viewport||this.viewport&&o>=this.viewport[0]&&o<this.viewport[0]+this.viewport[2]&&a>=this.viewport[1]&&a<this.viewport[1]+this.viewport[3];if(r){var l=this.ds.scale;return l*=Math.pow(1.1,t*.01),this.ds.changeScale(l,[n.clientX,n.clientY]),this.graph.change(),n.preventDefault(),!1}}}function blockClick(){this.block_click=!0,this.last_mouseclick=0}function processKey(n){var t,o,a,r,l;if(this.graph){var p=!1;if(n.target.localName!="input"){if(n.type=="keydown"){if(n.keyCode==32&&(this.dragging_canvas=!0,p=!0),n.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),p=!0),n.keyCode==65&&n.ctrlKey&&(this.selectNodes(),p=!0),n.keyCode===67&&(n.metaKey||n.ctrlKey)&&!n.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),p=!0),n.keyCode===86&&(n.metaKey||n.ctrlKey)&&this.pasteFromClipboard(n.shiftKey),(n.keyCode==46||LiteGraph.backspace_delete&&n.keyCode==8)&&n.target.localName!="input"&&n.target.localName!="textarea"&&(this.deleteSelectedNodes(),p=!0),LiteGraph.actionHistory_enabled&&(n.keyCode==89&&n.ctrlKey||n.keyCode==90&&n.ctrlKey&&n.shiftKey?this.graph.actionHistoryForward():n.keyCode==90&&n.ctrlKey&&this.graph.actionHistoryBack()),(t=LiteGraph.debug)==null||t.call(LiteGraph,"Canvas keydown "+n.keyCode),this.selected_nodes)for(let h in this.selected_nodes)(a=(o=this.selected_nodes[h]).onKeyDown)==null||a.call(o,n)}else if(n.type=="keyup"&&(n.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(let h in this.selected_nodes)(l=(r=this.selected_nodes[h]).onKeyUp)==null||l.call(r,n);if(this.graph.change(),p)return n.preventDefault(),n.stopImmediatePropagation(),!1}}}function processDrop(n){n.preventDefault(),this.adjustMouseEvent(n);var t=n.clientX,o=n.clientY,a=!this.viewport||this.viewport&&t>=this.viewport[0]&&t<this.viewport[0]+this.viewport[2]&&o>=this.viewport[1]&&o<this.viewport[1]+this.viewport[3];if(a){t=n.localX,o=n.localY;var a=!this.viewport||this.viewport&&t>=this.viewport[0]&&t<this.viewport[0]+this.viewport[2]&&o>=this.viewport[1]&&o<this.viewport[1]+this.viewport[3];if(a){var r=[n.canvasX,n.canvasY],l=this.graph?this.graph.getNodeOnPos(r[0],r[1]):null;if(!l){var p=null;this.onDropItem&&(p=this.onDropItem(event)),p||this.checkDropItem(n);return}if(l.onDropFile||l.onDropData){var h=n.dataTransfer.files;if(h&&h.length)for(let _=0;_<h.length;_++){var c=n.dataTransfer.files[0],u=c.name;if(l.onDropFile&&l.onDropFile(c),l.onDropData){var d=new FileReader;d.onload=function(g){var m=g.target.result;l.onDropData(m,u,c)};var f=c.type.split("/")[0];f=="text"||f==""?d.readAsText(c):f=="image"?d.readAsDataURL(c):d.readAsArrayBuffer(c)}}}return l.onDropItem&&l.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}}}function checkDropItem(n){var t;if(n.dataTransfer.files.length){var o=n.dataTransfer.files[0],a=LGraphCanvas.getFileExtension(o.name).toLowerCase(),r=LiteGraph.node_types_by_file_extension[a];if(r){this.graph.beforeChange();var l=LiteGraph.createNode(r.type);l.pos=[n.canvasX,n.canvasY],this.graph.add(l,!1,{doProcessChange:!1}),(t=l.onDropFile)==null||t.call(l,o),this.graph.onGraphChanged({action:"fileDrop",doSave:!0}),this.graph.afterChange()}}}class EventsController{constructor(t){this.host=t}processUserInputDown(...t){return processUserInputDown.apply(this.host,t)}processMouseDown(...t){return processMouseDown.apply(this.host,t)}processMouseMove(...t){return processMouseMove.apply(this.host,t)}processMouseUp(...t){return processMouseUp.apply(this.host,t)}processMouseWheel(...t){return processMouseWheel.apply(this.host,t)}blockClick(...t){return blockClick.apply(this.host,t)}processKey(...t){return processKey.apply(this.host,t)}processDrop(...t){return processDrop.apply(this.host,t)}checkDropItem(...t){return checkDropItem.apply(this.host,t)}}function draw(n,t){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var o=LiteGraph.getTime();this.render_time=(o-this.last_draw_time)*.001,this.last_draw_time=o,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||t||this.always_render_background||this.graph&&this.graph._last_trigger_time&&o-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas();var a=this.dirty_canvas||n;if(a&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1,this.ds.scale<.7){if(a){var r=this.low_quality_rendering_threshold;const l=45;this.fps<l?(this.low_quality_rendering_counter+=l/this.fps,this.low_quality_rendering_counter=Math.min(this.low_quality_rendering_counter,2*r)):(this.low_quality_rendering_counter-=this.fps/l*.01,this.low_quality_rendering_counter=Math.max(this.low_quality_rendering_counter,0))}}else this.low_quality_rendering_counter=0}}function drawFrontCanvas(){var n,t,o,a,r;this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var l=this.ctx;if(l){var p=this.canvas;l.start2D&&!this.viewport&&(l.start2D(),l.restore(),l.setTransform(1,0,0,1,0,0));var h=this.viewport||this.dirty_area;if(h&&(l.save(),l.beginPath(),l.rect(h[0],h[1],h[2],h[3]),l.clip()),this.clear_background&&(h?l.clearRect(h[0],h[1],h[2],h[3]):l.clearRect(0,0,p.width,p.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():l.drawImage(this.bgcanvas,0,0),(n=this.onRender)==null||n.call(this,p,l),this.show_info&&this.renderInfo(l,h?h[0]:0,h?h[1]:0),this.graph){l.save(),this.ds.toCanvasContext(l);var c=this.computeVisibleNodes(null,this.visible_nodes);for(let m=0;m<c.length;++m){let b=c[m];l.save(),l.translate(b.pos[0],b.pos[1]),this.drawNode(b,l),l.restore()}if(this.render_execution_order&&this.drawExecutionOrder(l),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(l)),this.connecting_pos!=null){l.lineWidth=this.connections_width;var u=null,d=this.connecting_output||this.connecting_input,f=d.type,L=d.dir;L==null&&(this.connecting_output?L=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:L=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var _=d.shape;switch(f){case LiteGraph.EVENT:case LiteGraph.ACTION:u=LiteGraph.EVENT_LINK_COLOR;break;default:u=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(l,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,u,L,LiteGraph.CENTER),l.beginPath(),f===LiteGraph.EVENT||f===LiteGraph.ACTION||_===LiteGraph.BOX_SHAPE?(l.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),l.fill(),l.beginPath(),l.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):_===LiteGraph.ARROW_SHAPE?(l.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),l.closePath()):(l.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),l.fill(),l.beginPath(),l.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),l.fill(),l.fillStyle="#ffcc00",this._highlight_input){l.beginPath();var g=this._highlight_input_slot.shape;g===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),l.closePath()):l.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),l.fill()}this._highlight_output&&(l.beginPath(),g===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),l.closePath()):l.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),l.fill())}this.dragging_rectangle&&(l.strokeStyle="#FFF",l.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(l,this.over_link_center):(t=this.onDrawLinkTooltip)==null||t.call(this,l,null),(o=this.onDrawForeground)==null||o.call(this,l,this.visible_rect),l.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(l),(a=this.onDrawOverlay)==null||a.call(this,l),h&&l.restore(),(r=l.finish2D)==null||r.call(l)}}function lowQualityRenderingRequired(n){return this.ds.scale<n?this.low_quality_rendering_counter>this.low_quality_rendering_threshold:!1}function drawNode(n,t){var o,a,r;this.current_node=n;var l=n.color||n.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,p=n.bgcolor||n.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR,h=this.ds.scale<.6;if(this.live_mode){n.flags.collapsed||(t.shadowColor="transparent",(o=n.onDrawForeground)==null||o.call(n,t,this,this.canvas));return}var c=this.editor_alpha;if(t.globalAlpha=c,this.render_shadows&&!h?(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,t.shadowOffsetX=2*this.ds.scale,t.shadowOffsetY=2*this.ds.scale,t.shadowBlur=3*this.ds.scale):t.shadowColor="transparent",!(n.flags.collapsed&&(a=n.onDrawCollapsed)!=null&&a.call(n,t,this))){var u=n._shape||LiteGraph.BOX_SHAPE,d=temp_vec2;temp_vec2.set(n.size);var f=n.horizontal;if(n.flags.collapsed){t.font=this.inner_text_font;var L=n.getTitle?n.getTitle():n.title;L!=null&&(n._collapsed_width=Math.min(n.size[0],t.measureText(L).width+LiteGraph.NODE_TITLE_HEIGHT*2),d[0]=n._collapsed_width,d[1]=0)}(n.clip_area||this.clip_all_nodes)&&(t.save(),t.beginPath(),u==LiteGraph.BOX_SHAPE?t.rect(0,0,d[0],d[1]):u==LiteGraph.ROUND_SHAPE?t.roundRect(0,0,d[0],d[1],[10]):u==LiteGraph.CIRCLE_SHAPE&&t.arc(d[0]*.5,d[1]*.5,d[0]*.5,0,Math.PI*2),t.clip()),n.has_errors&&(p="red"),this.drawNodeShape(n,t,d,l,p,n.is_selected,n.mouseOver),t.shadowColor="transparent",(r=n.onDrawForeground)==null||r.call(n,t,this,this.canvas),LiteGraph.show_node_tooltip&&n.mouseOver&&n.is_selected&&(!this.selected_nodes||Object.keys(this.selected_nodes).length<=1)&&this.drawNodeTooltip(t,n),t.textAlign=f?"center":"left",t.font=this.inner_text_font;var _=!this.lowQualityRenderingRequired(.6),g=this.connecting_output,m=this.connecting_input;t.lineWidth=1;var b=0,C=new Float32Array(2),T;if(n.flags.collapsed){if(this.render_collapsed_slots){var E=null,N=null;if(n.inputs)for(let I=0;I<n.inputs.length;I++){var A=n.inputs[I];if(A.link!=null){E=A;break}}if(n.outputs)for(let I=0;I<n.outputs.length;I++){var A=n.outputs[I];!A.links||!A.links.length||(N=A)}if(E){let I=0,O=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(I=n._collapsed_width*.5,O=-LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#686",t.beginPath(),A.type===LiteGraph.EVENT||A.type===LiteGraph.ACTION||A.shape===LiteGraph.BOX_SHAPE?t.rect(I-7+.5,O-4,14,8):A.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(I+8,O),t.lineTo(I+-4,O-4),t.lineTo(I+-4,O+4),t.closePath()):t.arc(I,O,4,0,Math.PI*2),t.fill()}if(N){let I=n._collapsed_width,O=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(I=n._collapsed_width*.5,O=0),t.fillStyle="#686",t.strokeStyle="black",t.beginPath(),A.type===LiteGraph.EVENT||A.type===LiteGraph.ACTION||A.shape===LiteGraph.BOX_SHAPE?t.rect(I-7+.5,O-4,14,8):A.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(I+6,O),t.lineTo(I-6,O-4),t.lineTo(I-6,O+4),t.closePath()):t.arc(I,O,4,0,Math.PI*2),t.fill()}}}else{if(n.inputs)for(let I=0;I<n.inputs.length;I++){let O=n.inputs[I],S=O.type,k=O.shape;t.globalAlpha=c,this.connecting_output&&!LiteGraph.isValidConnection(O.type,g.type)&&(t.globalAlpha=.4*c),t.fillStyle=O.link!=null?O.color_on||this.default_connection_color_byType[S]||this.default_connection_color.input_on:O.color_off||this.default_connection_color_byTypeOff[S]||this.default_connection_color_byType[S]||this.default_connection_color.input_off;let G=n.getConnectionPos(!0,I,C);if(G[0]-=n.pos[0],G[1]-=n.pos[1],b<G[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(b=G[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.beginPath(),S=="array"?k=LiteGraph.GRID_SHAPE:O.name=="onTrigger"||O.name=="onExecuted"?k=LiteGraph.ARROW_SHAPE:(S===LiteGraph.EVENT||S===LiteGraph.ACTION)&&(k=LiteGraph.BOX_SHAPE),T=!0,k===LiteGraph.BOX_SHAPE?f?t.rect(G[0]-5+.5,G[1]-8+.5,10,14):t.rect(G[0]-6+.5,G[1]-5+.5,14,10):k===LiteGraph.ARROW_SHAPE?(t.moveTo(G[0]+8,G[1]+.5),t.lineTo(G[0]-4,G[1]+6+.5),t.lineTo(G[0]-4,G[1]-6+.5),t.closePath()):k===LiteGraph.GRID_SHAPE?(t.rect(G[0]-4,G[1]-4,2,2),t.rect(G[0]-1,G[1]-4,2,2),t.rect(G[0]+2,G[1]-4,2,2),t.rect(G[0]-4,G[1]-1,2,2),t.rect(G[0]-1,G[1]-1,2,2),t.rect(G[0]+2,G[1]-1,2,2),t.rect(G[0]-4,G[1]+2,2,2),t.rect(G[0]-1,G[1]+2,2,2),t.rect(G[0]+2,G[1]+2,2,2),T=!1):h?t.rect(G[0]-4,G[1]-4,8,8):t.arc(G[0],G[1],4,0,Math.PI*2),t.fill(),_&&!(O.name=="onTrigger"||O.name=="onExecuted")){let P=O.label!=null?O.label:O.name;P&&(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||O.dir==LiteGraph.UP?t.fillText(P,G[0],G[1]-10):t.fillText(P,G[0]+10,G[1]+5))}}if(t.textAlign=f?"center":"right",t.strokeStyle="black",n.outputs)for(let I=0;I<n.outputs.length;I++){let O=n.outputs[I],S=O.type,k=O.shape;this.connecting_input&&!LiteGraph.isValidConnection(S,m.type)&&(t.globalAlpha=.4*c);let G=n.getConnectionPos(!1,I,C);if(G[0]-=n.pos[0],G[1]-=n.pos[1],b<G[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(b=G[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.fillStyle=O.links&&O.links.length?O.color_on||this.default_connection_color_byType[S]||this.default_connection_color.output_on:O.color_off||this.default_connection_color_byTypeOff[S]||this.default_connection_color_byType[S]||this.default_connection_color.output_off,t.beginPath(),S=="array"?k=LiteGraph.GRID_SHAPE:O.name=="onTrigger"||O.name=="onExecuted"?k=LiteGraph.ARROW_SHAPE:(S===LiteGraph.EVENT||S===LiteGraph.ACTION)&&(k=LiteGraph.BOX_SHAPE),T=!0,k===LiteGraph.BOX_SHAPE?f?t.rect(G[0]-5+.5,G[1]-8+.5,10,14):t.rect(G[0]-6+.5,G[1]-5+.5,14,10):k===LiteGraph.ARROW_SHAPE?(t.moveTo(G[0]+8,G[1]+.5),t.lineTo(G[0]-4,G[1]+6+.5),t.lineTo(G[0]-4,G[1]-6+.5),t.closePath()):k===LiteGraph.GRID_SHAPE?(t.rect(G[0]-4,G[1]-4,2,2),t.rect(G[0]-1,G[1]-4,2,2),t.rect(G[0]+2,G[1]-4,2,2),t.rect(G[0]-4,G[1]-1,2,2),t.rect(G[0]-1,G[1]-1,2,2),t.rect(G[0]+2,G[1]-1,2,2),t.rect(G[0]-4,G[1]+2,2,2),t.rect(G[0]-1,G[1]+2,2,2),t.rect(G[0]+2,G[1]+2,2,2),T=!1):h?t.rect(G[0]-4,G[1]-4,8,8):t.arc(G[0],G[1],4,0,Math.PI*2),t.fill(),!h&&T&&t.stroke(),_&&!(O.name=="onTrigger"||O.name=="onExecuted")){let P=O.label!=null?O.label:O.name;P&&(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||O.dir==LiteGraph.DOWN?t.fillText(P,G[0],G[1]-8):t.fillText(P,G[0]-10,G[1]+5))}}if(t.textAlign="left",t.globalAlpha=1,n.widgets){var M=b;(f||n.widgets_up)&&(M=2),n.widgets_start_y!=null&&(M=n.widgets_start_y),this.drawNodeWidgets(n,M,t,this.node_widget&&this.node_widget[0]==n?this.node_widget[1]:null)}}(n.clip_area||this.clip_all_nodes)&&t.restore(),t.globalAlpha=1}}function drawNodeTooltip(n,t){var o;if(!t||!n){(o=LiteGraph.warn)==null||o.call(LiteGraph,"drawNodeTooltip: invalid node or ctx",t,n);return}var a=t.properties.tooltip!=null?t.properties.tooltip:"";if((!a||a=="")&&LiteGraph.show_node_tooltip_use_descr_property&&t.constructor.desc&&(a=t.constructor.desc),a=(a+"").trim(),!(!a||a=="")){var r=[0,-LiteGraph.NODE_TITLE_HEIGHT],l=t.flags.collapsed?[LiteGraph.NODE_COLLAPSED_WIDTH,LiteGraph.NODE_TITLE_HEIGHT]:t.size;n.font="14px Courier New",n.measureText(a);var p=Math.max(t.size[0],160)+20,h=t.ttip_oTMultiRet?t.ttip_oTMultiRet.height+15:21;n.globalAlpha=.7*this.editor_alpha,n.shadowColor=t.ttip_oTMultiRet?"black":"transparent",n.shadowOffsetX=2,n.shadowOffsetY=2,n.shadowBlur=3,n.fillStyle=t.ttip_oTMultiRet?"#454":"transparent",n.beginPath(),n.roundRect(r[0]-p*.5+l[0]/2,r[1]-15-h,p,h,[3]),n.moveTo(r[0]-10+l[0]/2,r[1]-15),n.lineTo(r[0]+10+l[0]/2,r[1]-15),n.lineTo(r[0]+l[0]/2,r[1]-5),n.fill(),n.shadowColor="transparent",n.textAlign="center",n.fillStyle=t.ttip_oTMultiRet?"#CEC":"transparent",n.globalAlpha=this.editor_alpha;var c=LiteGraph.canvasFillTextMultiline(n,a,r[0]+l[0]/2,r[1]-h,p,14);t.ttip_oTMultiRet=c,n.closePath()}}function drawNodeShape(n,t,o,a,r,l,p){var h;t.strokeStyle=a,t.fillStyle=r;var c=LiteGraph.NODE_TITLE_HEIGHT,u=this.lowQualityRenderingRequired(.5),d=n._shape||n.constructor.shape||LiteGraph.ROUND_SHAPE,f=n.constructor.title_mode,L=!0;f==LiteGraph.TRANSPARENT_TITLE||f==LiteGraph.NO_TITLE?L=!1:f==LiteGraph.AUTOHIDE_TITLE&&p&&(L=!0);var _=tmp_area;_[0]=0,_[1]=L?-c:0,_[2]=o[0]+1,_[3]=L?o[1]+c:o[1];var g=t.globalAlpha;if(t.beginPath(),d==LiteGraph.BOX_SHAPE||u?t.fillRect(_[0],_[1],_[2],_[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE?t.roundRect(_[0],_[1],_[2],_[3],d==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):d==LiteGraph.CIRCLE_SHAPE&&t.arc(o[0]*.5,o[1]*.5,o[0]*.5,0,Math.PI*2),t.fill(),!n.flags.collapsed&&L&&(t.shadowColor="transparent",t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(0,-1,_[2],2)),t.shadowColor="transparent",(h=n.onDrawBackground)==null||h.call(n,t,this,this.canvas,this.graph_mouse),L||f==LiteGraph.TRANSPARENT_TITLE){if(n.onDrawTitleBar)n.onDrawTitleBar(t,c,o,this.ds.scale,a);else if(f!=LiteGraph.TRANSPARENT_TITLE&&(n.constructor.title_color||this.render_title_colored)){var m=n.constructor.title_color||a;if(n.flags.collapsed&&(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var b=LGraphCanvas.gradients[m];if(!b){b=LGraphCanvas.gradients[m]=t.createLinearGradient(0,0,400,0);try{b.addColorStop(0,m)}catch{b.addColorStop(0,LiteGraph.NODE_DEFAULT_COLOR)}b.addColorStop(1,"#000")}t.fillStyle=b}else t.fillStyle=m;t.beginPath(),d==LiteGraph.BOX_SHAPE||u?t.rect(0,-c,o[0]+1,c):(d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE)&&t.roundRect(0,-c,o[0]+1,c,n.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),t.fill(),t.shadowColor="transparent"}let M=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[n.mode]&&(M=LiteGraph.NODE_MODES_COLORS[n.mode]),LiteGraph.node_box_coloured_when_on&&(M=n.action_triggered?"#FFF":n.execute_triggered?"#AAA":M);var C=10;if(n.onDrawTitleBox?n.onDrawTitleBox(t,c,o,this.ds.scale):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CIRCLE_SHAPE||d==LiteGraph.CARD_SHAPE?(u&&(t.fillStyle="black",t.beginPath(),t.arc(c*.5,c*-.5,C*.5+1,0,Math.PI*2),t.fill()),t.fillStyle=n.boxcolor||M||LiteGraph.NODE_DEFAULT_BOXCOLOR,u?t.fillRect(c*.5-C*.5,c*-.5-C*.5,C,C):(t.beginPath(),t.arc(c*.5,c*-.5,C*.5,0,Math.PI*2),t.fill())):(u&&(t.fillStyle="black",t.fillRect((c-C)*.5-1,(c+C)*-.5-1,C+2,C+2)),t.fillStyle=n.boxcolor||M||LiteGraph.NODE_DEFAULT_BOXCOLOR,t.fillRect((c-C)*.5,(c+C)*-.5,C,C)),t.globalAlpha=g,n.onDrawTitleText&&n.onDrawTitleText(t,c,o,this.ds.scale,this.title_text_font,l),!u){t.font=this.title_text_font;var T=String(n.getTitle());T&&(l?t.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:t.fillStyle=n.constructor.title_text_color||this.node_title_color,n.flags.collapsed?(t.textAlign="left",t.fillText(T.substring(0,20),c,LiteGraph.NODE_TITLE_TEXT_Y-c),t.textAlign="left"):(t.textAlign="left",t.fillText(T,c,LiteGraph.NODE_TITLE_TEXT_Y-c)))}if(!n.flags.collapsed&&n.subgraph&&!n.skip_subgraph_button){var E=LiteGraph.NODE_TITLE_HEIGHT,N=n.size[0]-E,A=LiteGraph.isInsideRectangle(this.graph_mouse[0]-n.pos[0],this.graph_mouse[1]-n.pos[1],N+2,-E+2,E-4,E-4);t.fillStyle=A?"#888":"#555",d==LiteGraph.BOX_SHAPE||u?t.fillRect(N+2,-E+2,E-4,E-4):(t.beginPath(),t.roundRect(N+2,-E+2,E-4,E-4,[4]),t.fill()),t.fillStyle="#333",t.beginPath(),t.moveTo(N+E*.2,-E*.6),t.lineTo(N+E*.8,-E*.6),t.lineTo(N+E*.5,-E*.3),t.fill()}n.onDrawTitle&&n.onDrawTitle(t)}l&&(n.onBounding&&n.onBounding(_),f==LiteGraph.TRANSPARENT_TITLE&&(_[1]-=c,_[3]+=c),t.lineWidth=1,t.globalAlpha=.8,t.beginPath(),d==LiteGraph.BOX_SHAPE?t.rect(-6+_[0],-6+_[1],12+_[2],12+_[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE&&n.flags.collapsed?t.roundRect(-6+_[0],-6+_[1],12+_[2],12+_[3],[this.round_radius*2]):d==LiteGraph.CARD_SHAPE?t.roundRect(-6+_[0],-6+_[1],12+_[2],12+_[3],[this.round_radius*2,2,this.round_radius*2,2]):d==LiteGraph.CIRCLE_SHAPE&&t.arc(o[0]*.5,o[1]*.5,o[0]*.5+6,0,Math.PI*2),t.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,t.stroke(),t.strokeStyle=a,t.globalAlpha=1),n.execute_triggered>0&&n.execute_triggered--,n.action_triggered>0&&n.action_triggered--}function drawExecutionOrder(n){n.shadowColor="transparent",n.globalAlpha=.25,n.textAlign="center",n.strokeStyle="white",n.globalAlpha=.75;var t=this.visible_nodes;for(let a=0;a<t.length;++a){var o=t[a];n.fillStyle="black",n.fillRect(o.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,o.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),o.order==0&&n.strokeRect(o.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,o.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),n.fillStyle="#FFF",n.fillText(o.order,o.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,o.pos[1]-6)}n.globalAlpha=1}function drawNodeWidgets(n,t,o,a){if(!n.widgets||!n.widgets.length)return 0;var r=n.size[0],l=n.widgets;t+=2;var p=LiteGraph.NODE_WIDGET_HEIGHT,h=!this.lowQualityRenderingRequired(.5);o.save(),o.globalAlpha=this.editor_alpha;var c=LiteGraph.WIDGET_OUTLINE_COLOR,u=LiteGraph.WIDGET_BGCOLOR,d=LiteGraph.WIDGET_TEXT_COLOR,f=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,L=15;for(let A=0;A<l.length;++A){var _=l[A],g=t;_.y&&(g=_.y),_.last_y=g,o.strokeStyle=c,o.fillStyle="#222",o.textAlign="left",_.disabled&&(o.globalAlpha*=.5);var m=_.width||r;switch(_.type){case"button":_.clicked&&(o.fillStyle="#AAA",_.clicked=!1,this.dirty_canvas=!0),o.fillRect(L,g,m-L*2,p),h&&!_.disabled&&o.strokeRect(L,g,m-L*2,p),h&&(o.textAlign="center",o.fillStyle=d,o.fillText(_.label||_.name,m*.5,g+p*.7));break;case"toggle":if(o.textAlign="left",o.strokeStyle=c,o.fillStyle=u,o.beginPath(),h?o.roundRect(L,g,m-L*2,p,[p*.5]):o.rect(L,g,m-L*2,p),o.fill(),h&&!_.disabled&&o.stroke(),o.fillStyle=_.value?"#89A":"#333",o.beginPath(),o.arc(m-L*2,g+p*.5,p*.36,0,Math.PI*2),o.fill(),h){o.fillStyle=f;const M=_.label||_.name;M!=null&&o.fillText(M,L*2,g+p*.7),o.fillStyle=_.value?d:f,o.textAlign="right",o.fillText(_.value?_.options.on||"true":_.options.off||"false",m-40,g+p*.7)}break;case"slider":o.fillStyle=u,o.fillRect(L,g,m-L*2,p);var b=_.options.max-_.options.min,C=(_.value-_.options.min)/b;if(C<0&&(C=0),C>1&&(C=1),o.fillStyle=_.options.hasOwnProperty("slider_color")?_.options.slider_color:a==_?"#89A":"#678",o.fillRect(L,g,C*(m-L*2),p),h&&!_.disabled&&o.strokeRect(L,g,m-L*2,p),_.marker){var T=(_.marker-_.options.min)/b;T<0&&(T=0),T>1&&(T=1),o.fillStyle=_.options.hasOwnProperty("marker_color")?_.options.marker_color:"#AA9",o.fillRect(L+T*(m-L*2),g,2,p)}h&&(o.textAlign="center",o.fillStyle=d,o.fillText(_.label||_.name+"  "+Number(_.value).toFixed(_.options.precision!=null?_.options.precision:3),m*.5,g+p*.7));break;case"number":case"combo":if(o.textAlign="left",o.strokeStyle=c,o.fillStyle=u,o.beginPath(),h?o.roundRect(L,g,m-L*2,p,[p*.5]):o.rect(L,g,m-L*2,p),o.fill(),h)if(_.disabled||o.stroke(),o.fillStyle=d,_.disabled||(o.beginPath(),o.moveTo(L+16,g+5),o.lineTo(L+6,g+p*.5),o.lineTo(L+16,g+p-5),o.fill(),o.beginPath(),o.moveTo(m-L-16,g+5),o.lineTo(m-L-6,g+p*.5),o.lineTo(m-L-16,g+p-5),o.fill()),o.fillStyle=f,o.fillText(_.label||_.name,L*2+5,g+p*.7),o.fillStyle=d,o.textAlign="right",_.type=="number")o.fillText(Number(_.value).toFixed(_.options.precision!==void 0?_.options.precision:3),m-L*2-20,g+p*.7);else{var E=_.value;if(_.options.values){var N=_.options.values;N.constructor===Function&&(N=N()),N&&N.constructor!==Array&&(E=N[_.value])}o.fillText(E,m-L*2-20,g+p*.7)}break;case"string":case"text":if(o.textAlign="left",o.strokeStyle=c,o.fillStyle=u,o.beginPath(),h?o.roundRect(L,g,m-L*2,p,[p*.5]):o.rect(L,g,m-L*2,p),o.fill(),h){_.disabled||o.stroke(),o.save(),o.beginPath(),o.rect(L,g,m-L*2,p),o.clip(),o.fillStyle=f;const M=_.label||_.name;M!=null&&o.fillText(M,L*2,g+p*.7),o.fillStyle=d,o.textAlign="right",o.fillText(String(_.value).substr(0,30),m-L*2,g+p*.7),o.restore()}break;default:_.draw&&_.draw(o,n,m,g,p);break}t+=(_.computeSize?_.computeSize(m)[1]:p)+4,o.globalAlpha=this.editor_alpha}o.restore(),o.textAlign="left"}function processNodeWidgets(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow();for(let i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type==="pointerdown"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var nvalue=LiteGraph.clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value,old_value)},20),this.dirty_canvas=!0;break;case"number":case"combo":case"enum":if(event.type=="pointermove"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type=="pointerdown"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));let n=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=n*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(n){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+n:index=values_list.indexOf(w.value)+n,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let t=function(o){return values!=values_list&&(o=text_values.indexOf(o)),this.value=o,inner_value_change(this,o,old_value),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:t.bind(w)},ref_window)}}else if(event.type=="pointerup"&&w.type=="number"){let delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,function(v){var s;if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(n){(s=LiteGraph.warn)==null||s.call(LiteGraph,n)}this.value=Number(v),inner_value_change(this,this.value,old_value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value,old_value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type=="pointerdown"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type=="pointerdown"&&this.prompt("Value",w.value,function(n){inner_value_change(this,n)}.bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return w}}}function inner_value_change(n,t,o){var a;(a=LiteGraph.debug)==null||a.call(LiteGraph,"inner_value_change for processNodeWidgets",n,t),o!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,o,w),node.graph.onGraphChanged({action:"widgetChanged",doSave:!0})),n.type=="number"&&(t=Number(t)),n.value=t,n.options&&n.options.property&&node.properties[n.options.property]!==void 0&&node.setProperty(n.options.property,t),n.callback&&n.callback(n.value,that,node,pos,event)}return null}function adjustNodesSize(){var n=this.graph._nodes;for(let t=0;t<n.length;++t)n[t].size=n[t].computeSize();this.setDirty(!0,!0)}function drawLinkTooltip(n,t){var o,a=t._pos;if(n.fillStyle="black",n.beginPath(),n.arc(a[0],a[1],3,0,Math.PI*2),n.fill(),t.data!=null&&!((o=this.onDrawLinkTooltip)!=null&&o.call(this,n,t,this))){var r=t.data,l=null;if(r.constructor===Number?l=r.toFixed(2):r.constructor===String?l='"'+r+'"':r.constructor===Boolean?l=String(r):r.toToolTip?l=r.toToolTip():l="["+r.constructor.name+"]",l!=null){l=l.substr(0,30),n.font="14px Courier New";var p=n.measureText(l),h=p.width+20,c=24;n.shadowColor="black",n.shadowOffsetX=2,n.shadowOffsetY=2,n.shadowBlur=3,n.fillStyle="#454",n.beginPath(),n.roundRect(a[0]-h*.5,a[1]-15-c,h,c,[3]),n.moveTo(a[0]-10,a[1]-15),n.lineTo(a[0]+10,a[1]-15),n.lineTo(a[0],a[1]-5),n.fill(),n.shadowColor="transparent",n.textAlign="center",n.fillStyle="#CEC",n.fillText(l,a[0],a[1]-15-c*.3)}}}function drawConnections(n){var t=LiteGraph.getTime(),o=this.visible_area;margin_area[0]=o[0]-20,margin_area[1]=o[1]-20,margin_area[2]=o[2]+40,margin_area[3]=o[3]+40,n.lineWidth=this.connections_width,n.fillStyle="#AAA",n.strokeStyle="#AAA",n.globalAlpha=this.editor_alpha;for(var a=this.graph._nodes,r=0,l=a.length;r<l;++r){var p=a[r];if(!(!p.inputs||!p.inputs.length))for(let N=0;N<p.inputs.length;++N){var h=p.inputs[N];if(!(!h||h.link==null)){var c=h.link,u=this.graph.links[c];if(u){var d=this.graph.getNodeById(u.origin_id);if(d!=null){var f=u.origin_slot,L=null;f==-1?L=[d.pos[0]+10,d.pos[1]+10]:L=d.getConnectionPos(!1,f,tempA);var _=p.getConnectionPos(!0,N,tempB);if(link_bounding[0]=L[0],link_bounding[1]=L[1],link_bounding[2]=_[0]-L[0],link_bounding[3]=_[1]-L[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!LiteGraph.overlapBounding(link_bounding,margin_area)){var g=d.outputs[f],m=p.inputs[N];if(!(!g||!m)){var b=g.dir||(d.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),C=m.dir||(p.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(n,L,_,u,!1,0,null,b,C),u&&u._last_time&&t-u._last_time<1e3){var T=2-(t-u._last_time)*.002,E=n.globalAlpha;n.globalAlpha=E*T,this.renderLink(n,L,_,u,!0,T,"white",b,C),n.globalAlpha=E}}}}}}}}n.globalAlpha=1}function renderLink(n,t,o,a,r,l,p,h,c,u){a&&this.visible_links.push(a),!p&&a&&(p=a.color||LGraphCanvas.link_type_colors[a.type]),p||(p=this.default_link_color),a!=null&&this.highlighted_links[a.id]&&(p="#FFF"),h=h||LiteGraph.RIGHT,c=c||LiteGraph.LEFT;var d=LiteGraph.distance(t,o);this.render_connections_border&&this.ds.scale>.6&&(n.lineWidth=this.connections_width+4),n.lineJoin="round",u=u||1,u>1&&(n.lineWidth=.5),n.beginPath();for(let S=0;S<u;S+=1){var f=(S-(u-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){n.moveTo(t[0],t[1]+f);let k=0,G=0,P=0,j=0;switch(h){case LiteGraph.LEFT:k=d*-.25;break;case LiteGraph.RIGHT:k=d*.25;break;case LiteGraph.UP:G=d*-.25;break;case LiteGraph.DOWN:G=d*.25;break}switch(c){case LiteGraph.LEFT:P=d*-.25;break;case LiteGraph.RIGHT:P=d*.25;break;case LiteGraph.UP:j=d*-.25;break;case LiteGraph.DOWN:j=d*.25;break}n.bezierCurveTo(t[0]+k,t[1]+G+f,o[0]+P,o[1]+j+f,o[0],o[1]+f)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){n.moveTo(t[0],t[1]+f);let k=0,G=0,P=0,j=0;switch(h){case LiteGraph.LEFT:k=-1;break;case LiteGraph.RIGHT:k=1;break;case LiteGraph.UP:G=-1;break;case LiteGraph.DOWN:G=1;break}switch(c){case LiteGraph.LEFT:P=-1;break;case LiteGraph.RIGHT:P=1;break;case LiteGraph.UP:j=-1;break;case LiteGraph.DOWN:j=1;break}var L=15;n.lineTo(t[0]+k*L,t[1]+G*L+f),n.lineTo(o[0]+P*L,o[1]+j*L+f),n.lineTo(o[0],o[1]+f)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){n.moveTo(t[0],t[1]);var _=t[0],g=t[1],m=o[0],b=o[1];h==LiteGraph.RIGHT?_+=10:g+=10,c==LiteGraph.LEFT?m-=10:b-=10,n.lineTo(_,g),n.lineTo((_+m)*.5,g),n.lineTo((_+m)*.5,b),n.lineTo(m,b),n.lineTo(o[0],o[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!r&&(n.strokeStyle="rgba(0,0,0,0.5)",n.stroke()),n.lineWidth=this.connections_width,n.fillStyle=n.strokeStyle=p,n.stroke();var C=this.computeConnectionPoint(t,o,.5,h,c);if(a&&a._pos&&(a._pos[0]=C[0],a._pos[1]=C[1]),this.ds.scale>=.6&&this.highquality_render&&c!=LiteGraph.CENTER){if(this.render_connection_arrows){var T=this.computeConnectionPoint(t,o,.25,h,c),E=this.computeConnectionPoint(t,o,.26,h,c),N=this.computeConnectionPoint(t,o,.75,h,c),A=this.computeConnectionPoint(t,o,.76,h,c),M=0,I=0;this.render_curved_connections?(M=-Math.atan2(E[0]-T[0],E[1]-T[1]),I=-Math.atan2(A[0]-N[0],A[1]-N[1])):I=M=o[1]>t[1]?0:Math.PI,n.save(),n.translate(T[0],T[1]),n.rotate(M),n.beginPath(),n.moveTo(-5,-3),n.lineTo(0,7),n.lineTo(5,-3),n.fill(),n.restore(),n.save(),n.translate(N[0],N[1]),n.rotate(I),n.beginPath(),n.moveTo(-5,-3),n.lineTo(0,7),n.lineTo(5,-3),n.fill(),n.restore()}n.beginPath(),n.arc(C[0],C[1],5,0,Math.PI*2),n.fill()}if(l){n.fillStyle=p;for(let S=0;S<5;++S){var O=(LiteGraph.getTime()*.001+S*.2)%1;C=this.computeConnectionPoint(t,o,O,h,c),n.beginPath(),n.arc(C[0],C[1],5,0,2*Math.PI),n.fill()}}}function computeConnectionPoint(n,t,o,a,r){a=a||LiteGraph.RIGHT,r=r||LiteGraph.LEFT;var l=LiteGraph.distance(n,t),p=n,h=[n[0],n[1]],c=[t[0],t[1]],u=t;switch(a){case LiteGraph.LEFT:h[0]+=l*-.25;break;case LiteGraph.RIGHT:h[0]+=l*.25;break;case LiteGraph.UP:h[1]+=l*-.25;break;case LiteGraph.DOWN:h[1]+=l*.25;break}switch(r){case LiteGraph.LEFT:c[0]+=l*-.25;break;case LiteGraph.RIGHT:c[0]+=l*.25;break;case LiteGraph.UP:c[1]+=l*-.25;break;case LiteGraph.DOWN:c[1]+=l*.25;break}var d=(1-o)*(1-o)*(1-o),f=3*((1-o)*(1-o))*o,L=3*(1-o)*(o*o),_=o*o*o,g=d*p[0]+f*h[0]+L*c[0]+_*u[0],m=d*p[1]+f*h[1]+L*c[1]+_*u[1];return[g,m]}function drawSubgraphPanel(n){var t,o=this.graph;if(o){var a=o._subgraph_node;if(!a){(t=LiteGraph.warn)==null||t.call(LiteGraph,"subgraph without subnode");return}this.drawSubgraphPanelLeft(o,a,n),this.drawSubgraphPanelRight(o,a,n)}}function drawSubgraphPanelLeft(n,t,o){var a,r=t.inputs?t.inputs.length:0,l=200,p=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(o.fillStyle="#111",o.globalAlpha=.8,o.beginPath(),o.roundRect(10,10,l,(r+1)*p+50,[8]),o.fill(),o.globalAlpha=1,o.fillStyle="#888",o.font="14px Arial",o.textAlign="left",o.fillText("Graph Inputs",20,34),this.drawButton(l-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var h=50;if(o.font="14px Arial",t.inputs)for(var c=0;c<t.inputs.length;++c){var u=t.inputs[c];if(!u.not_subgraph_input){if(this.drawButton(20,h+2,l-20,p-2)){var d=t.constructor.input_node_type||"graph/input";this.graph.beforeChange();var f=LiteGraph.createNode(d);f?(n.add(f,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([f]),this.node_dragged=f,this.dragging_canvas=!1,f.setProperty("name",u.name),f.setProperty("type",u.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(a=LiteGraph.error)==null||a.call(LiteGraph,"graph input node not found:",d)}o.fillStyle="#9C9",o.beginPath(),o.arc(l-16,h+p*.5,5,0,2*Math.PI),o.fill(),o.fillStyle="#AAA",o.fillText(u.name,30,h+p*.75),o.fillStyle="#777",o.fillText(u.type,130,h+p*.75),h+=p}}this.drawButton(20,h+2,l-20,p-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(t)}function drawSubgraphPanelRight(n,t,o){var a,r=t.outputs?t.outputs.length:0,l=this.bgcanvas.width,p=200,h=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);o.fillStyle="#111",o.globalAlpha=.8,o.beginPath(),o.roundRect(l-p-10,10,p,(r+1)*h+50,[8]),o.fill(),o.globalAlpha=1,o.fillStyle="#888",o.font="14px Arial",o.textAlign="left";const c="Graph Outputs";var u=o.measureText(c).width;if(o.fillText(c,l-u-20,34),this.drawButton(l-p,20,20,20,"X","#151515")){this.closeSubgraph();return}var d=50;if(o.font="14px Arial",t.outputs)for(var f=0;f<t.outputs.length;++f){var L=t.outputs[f];if(!L.not_subgraph_input){if(this.drawButton(l-p,d+2,p-20,h-2)){var _=t.constructor.output_node_type||"graph/output";this.graph.beforeChange();var g=LiteGraph.createNode(_);g?(n.add(g,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([g]),this.node_dragged=g,this.dragging_canvas=!1,g.setProperty("name",L.name),g.setProperty("type",L.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(a=LiteGraph.error)==null||a.call(LiteGraph,"graph input node not found:",_)}o.fillStyle="#9C9",o.beginPath(),o.arc(l-p+16,d+h*.5,5,0,2*Math.PI),o.fill(),o.fillStyle="#AAA",o.fillText(L.name,l-p+30,d+h*.75),o.fillStyle="#777",o.fillText(L.type,l-p+130,d+h*.75),d+=h}}this.drawButton(l-p,d+2,p-20,h-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(t)}function drawButton(n,t,o,a,r,l,p,h){var c=this.ctx;l=l||LiteGraph.NODE_DEFAULT_COLOR,p=p||"#555",h=h||LiteGraph.NODE_TEXT_COLOR;var u=this.ds.convertOffsetToCanvas(this.graph_mouse),d=LiteGraph.isInsideRectangle(u[0],u[1],n,t,o,a);if(u=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,u){var f=this.canvas.getBoundingClientRect();u[0]-=f.left,u[1]-=f.top}var L=u&&LiteGraph.isInsideRectangle(u[0],u[1],n,t,o,a);c.fillStyle=d?p:l,L&&(c.fillStyle="#AAA"),c.beginPath(),c.roundRect(n,t,o,a,[4]),c.fill(),r!=null&&r.constructor==String&&(c.fillStyle=h,c.textAlign="center",c.font=(a*.65|0)+"px Arial",c.fillText(r,n+o*.5,t+a*.75),c.textAlign="left");var _=L&&!this.block_click;return L&&this.blockClick(),_}function isAreaClicked(n,t,o,a,r){var l=this.last_click_position,p=l&&LiteGraph.isInsideRectangle(l[0],l[1],n,t,o,a),h=p&&!this.block_click;return p&&r&&this.blockClick(),h}function renderInfo(n,t,o){t=t||10,o=o||this.canvas.height-80,n.save(),n.translate(t,o),n.font="10px Arial",n.fillStyle="#888",n.textAlign="left",this.graph?(n.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),n.fillText("I: "+this.graph.iteration,5,26),n.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),n.fillText("V: "+this.graph._version,5,52),n.fillText("FPS:"+this.fps.toFixed(2),5,65)):n.fillText("No graph selected",5,13),n.restore()}function drawBackCanvas(){var n,t,o,a=this.bgcanvas;this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var r=this.bgctx;r.start&&r.start();var l=this.viewport||[0,0,r.canvas.width,r.canvas.height];if(this.clear_background&&r.clearRect(l[0],l[1],l[2],l[3]),this._graph_stack&&this._graph_stack.length){r.save();var p=this.graph._subgraph_node;r.strokeStyle=p.bgcolor,r.lineWidth=10,r.strokeRect(1,1,a.width-2,a.height-2),r.lineWidth=1,r.font="40px Arial",r.textAlign="center",r.fillStyle=p.bgcolor||"#AAA";let d="";this._graph_stack.slice(1).forEach((f,L)=>{d+=`${f._subgraph_node.getTitle()} ${L<this._graph_stack.length-2?">> ":""}`}),r.fillText(d+p.getTitle(),a.width*.5,40),r.restore()}var h=!1;if(this.onRenderBackground&&(h=this.onRenderBackground(a,r)),this.viewport||(r.restore(),r.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(r.save(),this.ds.toCanvasContext(r),this.ds.scale<1.5&&!h&&this.clear_background_color&&(r.fillStyle=this.clear_background_color,r.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!h){if(this.zoom_modify_alpha?r.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:r.globalAlpha=this.editor_alpha,r.imageSmoothingEnabled=r.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var c=this;this._bg_img.onload=function(){c.draw(!0,!0)}}var u=null;this._pattern==null&&this._bg_img.width>0?(u=r.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=u):u=this._pattern,u&&(r.fillStyle=u,r.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),r.fillStyle="transparent"),r.globalAlpha=1,r.imageSmoothingEnabled=r.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(a,r),(n=this.onDrawBackground)==null||n.call(this,r,this.visible_area),this.onBackgroundRender&&((t=LiteGraph.error)==null||t.call(LiteGraph,"WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(r.strokeStyle="#235",r.strokeRect(0,0,a.width,a.height)),this.render_connections_shadows?(r.shadowColor="#000",r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=6):r.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(r),r.shadowColor="rgba(0,0,0,0)",r.restore()}(o=r.finish)==null||o.call(r),this.dirty_bgcanvas=!1,this.dirty_canvas=!0}function drawGroups(n,t){if(this.graph){var o=this.graph._groups;t.save(),t.globalAlpha=.5*this.editor_alpha;for(let h=0;h<o.length;++h){var a=o[h];if(LiteGraph.overlapBounding(this.visible_area,a._bounding)){t.fillStyle=a.color||"#335",t.strokeStyle=a.color||"#335";var r=a._pos,l=a._size;t.globalAlpha=.25*this.editor_alpha,t.beginPath(),t.rect(r[0]+.5,r[1]+.5,l[0],l[1]),t.fill(),t.globalAlpha=this.editor_alpha,t.stroke(),t.beginPath(),t.moveTo(r[0]+l[0],r[1]+l[1]),t.lineTo(r[0]+l[0]-10,r[1]+l[1]),t.lineTo(r[0]+l[0],r[1]+l[1]-10),t.fill();var p=a.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;t.font=p+"px Arial",t.textAlign="left",t.fillText(a.title,r[0]+4,r[1]+p)}}t.restore()}}class RenderController{constructor(t){this.host=t}draw(...t){return draw.apply(this.host,t)}drawFrontCanvas(...t){return drawFrontCanvas.apply(this.host,t)}lowQualityRenderingRequired(...t){return lowQualityRenderingRequired.apply(this.host,t)}drawNode(...t){return drawNode.apply(this.host,t)}drawNodeTooltip(...t){return drawNodeTooltip.apply(this.host,t)}drawNodeShape(...t){return drawNodeShape.apply(this.host,t)}drawExecutionOrder(...t){return drawExecutionOrder.apply(this.host,t)}drawNodeWidgets(...t){return drawNodeWidgets.apply(this.host,t)}processNodeWidgets(...t){return processNodeWidgets.apply(this.host,t)}adjustNodesSize(...t){return adjustNodesSize.apply(this.host,t)}drawConnections(...t){return drawConnections.apply(this.host,t)}renderLink(...t){return renderLink.apply(this.host,t)}computeConnectionPoint(...t){return computeConnectionPoint.apply(this.host,t)}drawLinkTooltip(...t){return drawLinkTooltip.apply(this.host,t)}drawBackCanvas(...t){return drawBackCanvas.apply(this.host,t)}drawSubgraphPanel(...t){return drawSubgraphPanel.apply(this.host,t)}drawSubgraphPanelLeft(...t){return drawSubgraphPanelLeft.apply(this.host,t)}drawSubgraphPanelRight(...t){return drawSubgraphPanelRight.apply(this.host,t)}drawButton(...t){return drawButton.apply(this.host,t)}isAreaClicked(...t){return isAreaClicked.apply(this.host,t)}renderInfo(...t){return renderInfo.apply(this.host,t)}drawGroups(...t){return drawGroups.apply(this.host,t)}}function copyToClipboard(){var n,t={nodes:[],links:[]},o=0,a=[];for(let u in this.selected_nodes){let d=this.selected_nodes[u];d.clonable!==!1&&(d._relative_id=o,a.push(d),o+=1)}for(let u=0;u<a.length;++u){let d=a[u];if(d.clonable!==!1){var r=d.clone();if(!r){(n=LiteGraph.warn)==null||n.call(LiteGraph,"node type not found: "+d.type);continue}if(t.nodes.push(r.serialize()),d.inputs&&d.inputs.length)for(var l=0;l<d.inputs.length;++l){var p=d.inputs[l];if(!(!p||p.link==null)){var h=this.graph.links[p.link];if(h){var c=this.graph.getNodeById(h.origin_id);c&&t.links.push([c._relative_id,h.origin_slot,d._relative_id,h.target_slot,c.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))}function pasteFromClipboard(n=!1){var t;if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&n)){var o=localStorage.getItem("litegrapheditor_clipboard");if(o){this.graph.beforeChange();var a=JSON.parse(o),r=!1,l=!1;for(let g=0;g<a.nodes.length;++g)r?(r[0]>a.nodes[g].pos[0]&&(r[0]=a.nodes[g].pos[0],l[0]=g),r[1]>a.nodes[g].pos[1]&&(r[1]=a.nodes[g].pos[1],l[1]=g)):(r=[a.nodes[g].pos[0],a.nodes[g].pos[1]],l=[g,g]);var p=[];for(let g=0;g<a.nodes.length;++g){var h=a.nodes[g],c=LiteGraph.createNode(h.type);c&&(c.configure(h),c.pos[0]+=this.graph_mouse[0]-r[0],c.pos[1]+=this.graph_mouse[1]-r[1],this.graph.add(c,{doProcessChange:!1}),p.push(c))}for(let g=0;g<a.links.length;++g){var u=a.links[g],d=void 0,f=u[0];if(f!=null)d=p[f];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&n){var L=u[4];L&&(d=this.graph.getNodeById(L))}var _=p[u[2]];d&&_?d.connect(u[1],_,u[3]):(t=LiteGraph.warn)==null||t.call(LiteGraph,"Warning, nodes missing on pasting")}this.selectNodes(p),this.graph.onGraphChanged({action:"paste",doSave:!0}),this.graph.afterChange()}}}function processNodeDblClicked(n){var t;this.onShowNodePanel?this.onShowNodePanel(n):this.showShowNodePanel(n),(t=this.onNodeDblClicked)==null||t.call(this,n),this.setDirty(!0)}function processNodeSelected(n,t){var o;this.selectNode(n,t&&(t.shiftKey||t.ctrlKey||this.multi_select)),(o=this.onNodeSelected)==null||o.call(this,n)}function selectNode(n,t){n==null?this.deselectAllNodes():this.selectNodes([n],t)}function selectNodes(n,t){var o;t||this.deselectAllNodes(),n=n||this.graph._nodes,typeof n=="string"&&(n=[n]),Object.values(n).forEach(a=>{var r,l,p;if(a.is_selected){this.deselectNode(a);return}a.is_selected=!0,this.selected_nodes[a.id]=a,(r=a.onSelected)==null||r.call(a),(l=a.inputs)==null||l.forEach(h=>{this.highlighted_links[h.link]=!0}),(p=a.outputs)==null||p.forEach(h=>{var c;(c=h.links)==null||c.forEach(u=>{this.highlighted_links[u]=!0})})}),(o=this.onSelectionChange)==null||o.call(this,this.selected_nodes),this.setDirty(!0)}function deselectNode(n){var t,o,a,r;n.is_selected&&((t=n.onDeselected)==null||t.call(n),n.is_selected=!1,(o=this.onNodeDeselected)==null||o.call(this,n),(a=n.inputs)==null||a.forEach(l=>{var p;(p=this.highlighted_links)==null||delete p[l.link]}),(r=n.outputs)==null||r.forEach(l=>{var p;(p=l.links)==null||p.forEach(h=>{var c;return(c=this.highlighted_links)==null?!0:delete c[h]})}))}function deselectAllNodes(){var n,t;this.graph&&((n=this.graph._nodes)==null||n.forEach(o=>{var a,r;o.is_selected&&((a=o.onDeselected)==null||a.call(o),o.is_selected=!1,(r=this.onNodeDeselected)==null||r.call(this,o))}),this.selected_nodes={},this.current_node=null,this.highlighted_links={},(t=this.onSelectionChange)==null||t.call(this,this.selected_nodes),this.setDirty(!0))}function deleteSelectedNodes(){this.graph.beforeChange();for(let l in this.selected_nodes){var n=this.selected_nodes[l];if(!n.block_delete){if(n.inputs&&n.inputs.length&&n.outputs&&n.outputs.length&&LiteGraph.isValidConnection(n.inputs[0].type,n.outputs[0].type)&&n.inputs[0].link&&n.outputs[0].links&&n.outputs[0].links.length){var t=n.graph.links[n.inputs[0].link],o=n.graph.links[n.outputs[0].links[0]],a=n.getInputNode(0),r=n.getOutputNodes(0)[0];a&&r&&a.connect(t.origin_slot,r,o.target_slot)}this.graph.remove(n),this.onNodeDeselected&&this.onNodeDeselected(n)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()}function onNodeSelectionChange(){}function boundaryNodesForSelection(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))}class SelectionController{constructor(t){this.host=t}copyToClipboard(...t){return copyToClipboard.apply(this.host,t)}pasteFromClipboard(...t){return pasteFromClipboard.apply(this.host,t)}processNodeDblClicked(...t){return processNodeDblClicked.apply(this.host,t)}processNodeSelected(...t){return processNodeSelected.apply(this.host,t)}selectNode(...t){return selectNode.apply(this.host,t)}selectNodes(...t){return selectNodes.apply(this.host,t)}deselectNode(...t){return deselectNode.apply(this.host,t)}deselectAllNodes(...t){return deselectAllNodes.apply(this.host,t)}deleteSelectedNodes(...t){return deleteSelectedNodes.apply(this.host,t)}onNodeSelectionChange(...t){return onNodeSelectionChange.apply(this.host,t)}boundaryNodesForSelection(...t){return boundaryNodesForSelection.apply(this.host,t)}}function showLinkMenu(n,t){var o=this,a=o.graph.getNodeById(n.origin_id),r=o.graph.getNodeById(n.target_id),l=!1;a&&a.outputs&&a.outputs[n.origin_slot]&&(l=a.outputs[n.origin_slot].type);var p=!1;r&&r.outputs&&r.outputs[n.target_slot]&&(p=r.inputs[n.target_slot].type);var h=["Add Node",null,"Delete"],c=new LiteGraph.ContextMenu(h,{event:t,title:n.data!=null?n.data.constructor.name:null,callback:u});function u(d,f,L){switch(d){case"Add Node":LGraphCanvas.onMenuAdd(null,null,L,c,function(_){var g;(g=LiteGraph.debug)==null||g.call(LiteGraph,"node autoconnect"),!(!_.inputs||!_.inputs.length||!_.outputs||!_.outputs.length)&&a.connectByType(n.origin_slot,_,l)&&(_.connectByType(n.target_slot,r,p),_.pos[0]-=_.size[0]*.5)});break;case"Delete":o.graph.removeLink(n.id);break}}return!1}function createDefaultNodeForSlot(n={}){var t,o,a,r,l,p=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},n),h=this,c=p.nodeFrom&&p.slotFrom!==null,u=!c&&p.nodeTo&&p.slotTo!==null;if(!c&&!u)return(t=LiteGraph.warn)==null||t.call(LiteGraph,"No data passed to createDefaultNodeForSlot "+p.nodeFrom+" "+p.slotFrom+" "+p.nodeTo+" "+p.slotTo),!1;if(!p.nodeType)return(o=LiteGraph.warn)==null||o.call(LiteGraph,"No type to createDefaultNodeForSlot"),!1;var d=c?p.nodeFrom:p.nodeTo,f=c?p.slotFrom:p.slotTo,L=!1;switch(typeof f){case"string":L=c?d.findOutputSlot(f,!1):d.findInputSlot(f,!1),f=c?d.outputs[f]:d.inputs[f];break;case"object":L=c?d.findOutputSlot(f.name):d.findInputSlot(f.name);break;case"number":L=f,f=c?d.outputs[f]:d.inputs[f];break;default:return(a=LiteGraph.warn)==null||a.call(LiteGraph,"Cant get slot information "+f),!1}(f===!1||L===!1)&&((r=LiteGraph.warn)==null||r.call(LiteGraph,"createDefaultNodeForSlot bad slotX "+f+" "+L));var _=f.type==LiteGraph.EVENT?"_event_":f.type,g=c?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(g&&g[_]){f.link;var m=!1;if(typeof g[_]=="object"){for(var b in g[_])if(p.nodeType==g[_][b]||p.nodeType=="AUTO"){m=g[_][b];break}}else(p.nodeType==g[_]||p.nodeType=="AUTO")&&(m=g[_]);if(m){var C=!1;typeof m=="object"&&m.node&&(C=m,m=m.node);var T=LiteGraph.createNode(m);if(T){if(C){if(C.properties)for(const[E,N]of Object.entries(C.properties))T.addProperty(E,N);C.inputs&&(T.inputs=[],Object.values(C.inputs).forEach(E=>{T.addOutput(E[0],E[1])})),C.outputs&&(T.outputs=[],Object.values(C.outputs).forEach(E=>{T.addOutput(E[0],E[1])})),C.title&&(T.title=C.title),C.json&&T.configure(C.json)}return h.graph.add(T),T.pos=[p.position[0]+p.posAdd[0]+(p.posSizeFix[0]?p.posSizeFix[0]*T.size[0]:0),p.position[1]+p.posAdd[1]+(p.posSizeFix[1]?p.posSizeFix[1]*T.size[1]:0)],c?p.nodeFrom.connectByType(L,T,_):p.nodeTo.connectByTypeOutput(L,T,_),!0}else(l=LiteGraph.warn)==null||l.call(LiteGraph,"failed creating "+m)}}return!1}function showConnectionMenu(n={}){var t,o,a=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},n),r=this,l=a.nodeFrom&&a.slotFrom,p=!l&&a.nodeTo&&a.slotTo;if(!l&&!p)return(t=LiteGraph.warn)==null||t.call(LiteGraph,"No data passed to showConnectionMenu"),!1;var h=l?a.nodeFrom:a.nodeTo,c=l?a.slotFrom:a.slotTo,u=!1;switch(typeof c){case"string":u=l?h.findOutputSlot(c,!1):h.findInputSlot(c,!1),c=l?h.outputs[c]:h.inputs[c];break;case"object":u=l?h.findOutputSlot(c.name):h.findInputSlot(c.name);break;case"number":u=c,c=l?h.outputs[c]:h.inputs[c];break;default:return(o=LiteGraph.warn)==null||o.call(LiteGraph,"Cant get slot information "+c),!1}var d=["Add Node",null];r.allow_searchbox&&(d.push("Search"),d.push(null));const f=c.type===LiteGraph.EVENT?"_event_":c.type,L=l?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(L&&L[f]){const g=L[f];Array.isArray(g)||typeof g=="object"?Object.values(g).forEach(m=>{d.push(m)}):d.push(g)}var _=new LiteGraph.ContextMenu(d,{event:a.e,title:(c&&c.name!=""?c.name+(f?" | ":""):"")+(c&&f?f:""),callback:(g,m,b)=>{const C={"Add Node":()=>{LGraphCanvas.onMenuAdd(null,null,b,_,T=>{l?a.nodeFrom.connectByType(u,T,f):a.nodeTo.connectByTypeOutput(u,T,f)})},Search:()=>{l?r.showSearchBox(b,{node_from:a.nodeFrom,slot_from:c,type_filter_in:f}):r.showSearchBox(b,{node_to:a.nodeTo,slot_from:c,type_filter_out:f})},default:()=>{r.createDefaultNodeForSlot(Object.assign(a,{position:[a.e.canvasX,a.e.canvasY],nodeType:g}))}};(C[g]||C.default)()}});return!1}function getCanvasMenuOptions(){var n=null;if(this.getMenuOptions?n=this.getMenuOptions():(n=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],LiteGraph.showCanvasOptions&&n.push({content:"Options",callback:this.showShowGraphOptionsPanel}),Object.keys(this.selected_nodes).length>1&&n.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&n.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var t=this.getExtraMenuOptions(this,n);t&&(n=n.concat(t))}return n}function getNodeMenuOptions(n){var t=null;if(n.getMenuOptions?t=n.getMenuOptions(this):(t=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],n.resizable!==!1&&t.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),t.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),n.onGetInputs){var o=n.onGetInputs();o&&o.length&&(t[0].disabled=!1)}if(n.onGetOutputs){var a=n.onGetOutputs();a&&a.length&&(t[1].disabled=!1)}if(LiteGraph.do_add_triggers_slots&&(t[1].disabled=!1),n.getExtraMenuOptions){var r=n.getExtraMenuOptions(this,t);r&&(r.push(null),t=r.concat(t))}return n.clonable!==!1&&t.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&t.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),t.push(null,{content:"Remove",disabled:!(n.removable!==!1&&!n.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),n.graph&&n.graph.onGetNodeMenuOptions&&n.graph.onGetNodeMenuOptions(t,n),t}function getGroupMenuOptions(){var n=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return n}function processContextMenu(n,t){var o,a,r,l=this,p=LGraphCanvas.active_canvas,h=p.getCanvasWindow(),c=null,u={event:t,callback:g,extra:n};n&&(u.title=n.type);var d=null;if(n&&(d=n.getSlotInPosition(t.canvasX,t.canvasY),LGraphCanvas.active_node=n),d){if(c=[],n.getSlotMenuOptions)c=n.getSlotMenuOptions(d);else{((a=(o=d==null?void 0:d.output)==null?void 0:o.links)!=null&&a.length||(r=d.input)!=null&&r.link)&&c.push({content:"Disconnect Links",slot:d});var f=d.input||d.output;f.removable&&LiteGraph.canRemoveSlots&&c.push(f.locked?"Cannot remove":{content:"Remove Slot",slot:d}),!f.nameLocked&&LiteGraph.canRenameSlots&&c.push({content:"Rename Slot",slot:d})}var L=d.input||d.output;u.title=L.type||"*",L.type==LiteGraph.ACTION?u.title="Action":L.type==LiteGraph.EVENT&&(u.title="Event")}else if(n)c=this.getNodeMenuOptions(n);else{c=this.getCanvasMenuOptions();var _=this.graph.getGroupOnPos(t.canvasX,t.canvasY);_&&c.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:_,options:this.getGroupMenuOptions(_)}})}if(!c)return;new LiteGraph.ContextMenu(c,u,h);function g(m,b){if(!m)return;let C;if(m.content=="Remove Slot"){C=m.slot,n.graph.beforeChange(),C.input?n.removeInput(C.slot):C.output&&n.removeOutput(C.slot),n.graph.afterChange();return}else if(m.content=="Disconnect Links"){C=m.slot,n.graph.beforeChange(),C.output?n.disconnectOutput(C.slot):C.input&&n.disconnectInput(C.slot),n.graph.afterChange();return}else if(m.content=="Rename Slot"){C=m.slot;var T=C.input?n.getInputInfo(C.slot):n.getOutputInfo(C.slot),E=l.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",b),N=E.querySelector("input");N&&T&&(N.value=T.label||"");var A=function(){n.graph.beforeChange(),N.value&&(T&&(T.label=N.value),l.setDirty(!0)),E.close(),n.graph.afterChange()};E.querySelector("button").addEventListener("click",A),N.addEventListener("keydown",function(M){if(E.is_modified=!0,M.keyCode==27)E.close();else if(M.keyCode==13)A();else if(M.keyCode!=13&&M.target.localName!="textarea")return;M.preventDefault(),M.stopPropagation()}),N.focus()}}}function prompt(n="",t,o,a,r){var l,p=document.createElement("div");p.is_modified=!1,p.className="graphdialog rounded",r?p.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":p.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",p.close=()=>{var T;this.prompt_box=null,(T=p.parentNode)==null||T.removeChild(p)};var h=LGraphCanvas.active_canvas,c=h.canvas;c.parentNode.appendChild(p),this.ds.scale>1&&(p.style.transform=`scale(${this.ds.scale})`);var u=null,d=0;p.addEventListener("pointerleave",T=>{d>0||LiteGraph.dialog_close_on_mouse_leave&&!p.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(p.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),p.addEventListener("pointerenter",T=>{LiteGraph.dialog_close_on_mouse_leave&&u&&clearTimeout(u)});const f=p.querySelectorAll("select");f&&(d=0,f.forEach(T=>{T.addEventListener("pointerdown",E=>{d++}),T.addEventListener("focus",E=>{d++}),T.addEventListener("blur",E=>{d=Math.max(0,d-1)}),T.addEventListener("change",E=>{d=0})})),(l=this.prompt_box)==null||l.close(),this.prompt_box=p;var L=p.querySelector(".name");L.innerText=n;var _=p.querySelector(".value");_.value=t;const g=_;g.addEventListener("keydown",T=>{var E;switch(p.is_modified=!0,T.key){case"Escape":p.close();break;case"Enter":T.target.localName!=="textarea"&&typeof o=="function"&&(o(g.value),this.setDirty(!0)),(E=LiteGraph.debug)==null||E.call(LiteGraph,"prompt v2 ENTER",g.value,T.target.localName,o),p.close();break;default:return}T.preventDefault(),T.stopPropagation()}),p.querySelector("button").addEventListener("click",T=>{var E;typeof o=="function"&&(o(g.value),this.setDirty(!0)),(E=LiteGraph.debug)==null||E.call(LiteGraph,"prompt v2 OK",g.value,o),p.close()});var m=c.getBoundingClientRect(),b=-20,C=-20;return m&&(b-=m.left,C-=m.top),a?(p.style.left=a.clientX+b+"px",p.style.top=a.clientY+C+"px"):(p.style.left=c.width*.5+b+"px",p.style.top=c.height*.5+C+"px"),setTimeout(function(){g.focus()},10),p}function showSearchBox(n,t){var o={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled&&(Object.keys(LiteGraph.registered_slot_in_types||{}).length>0||Object.keys(LiteGraph.registered_slot_out_types||{}).length>0),type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};t=Object.assign(o,t||{});var a=this,r=LGraphCanvas.active_canvas,l=r.canvas,p=l.ownerDocument||document,h=document.createElement("div");if(h.className="litegraph litesearchbox graphdialog rounded",h.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",t.do_type_filter&&(h.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",h.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),t.show_close_button&&(h.innerHTML+="<button class='close_searchbox close'>X</button>"),h.innerHTML+="<div class='helper'></div>",p.fullscreenElement?p.fullscreenElement.appendChild(h):(p.body.appendChild(h),p.body.style.overflow="hidden"),t.do_type_filter)var c=h.querySelector(".slot_in_type_filter"),u=h.querySelector(".slot_out_type_filter");if(h.close=function(){a.search_box=null,this.blur(),l.focus(),p.body.style.overflow="",setTimeout(function(){a.canvas.focus()},20),h.parentNode&&h.parentNode.removeChild(h)},this.ds.scale>1&&(h.style.transform=`scale(${this.ds.scale})`),t.hide_on_mouse_leave){var d=0,f=null;if(h.addEventListener("pointerenter",function(O){f&&(clearTimeout(f),f=null)}),h.addEventListener("pointerleave",function(O){d>0||(f=setTimeout(function(){h.close()},500))}),t.do_type_filter){const O=function(S){S&&(S.addEventListener("pointerdown",function(k){d++}),S.addEventListener("focus",function(k){d++}),S.addEventListener("blur",function(k){d=Math.max(0,d-1)}),S.addEventListener("change",function(k){d=0}))};O(c),O(u)}}a.search_box&&a.search_box.close(),a.search_box=h;var L=h.querySelector(".helper"),_=null,g=null,m=null,b=h.querySelector("input");if(b&&(b.addEventListener("blur",function(O){a.search_box&&this.focus()}),b.addEventListener("keydown",function(O){if(O.key==="ArrowUp")M(!1);else if(O.key==="ArrowDown")M(!0);else if(O.key==="Escape")h.close();else if(O.key==="Enter")I(),m?A(m.innerHTML):_?A(_):h.close();else{g&&clearInterval(g),g=setTimeout(I,250);return}return O.preventDefault(),O.stopPropagation(),O.stopImmediatePropagation(),!0})),t.do_type_filter){if(c){let O=LiteGraph.slot_types_in,S=O.length;(t.type_filter_in==LiteGraph.EVENT||t.type_filter_in==LiteGraph.ACTION)&&(t.type_filter_in="_event_");for(let k=0;k<S;k++){let G=document.createElement("option");G.value=O[k],G.innerHTML=O[k],c.appendChild(G),t.type_filter_in!==!1&&(t.type_filter_in+"").toLowerCase()==(O[k]+"").toLowerCase()&&(G.selected=!0)}c.addEventListener("change",function(){I()})}if(u){let O=LiteGraph.slot_types_out,S=O.length;(t.type_filter_out==LiteGraph.EVENT||t.type_filter_out==LiteGraph.ACTION)&&(t.type_filter_out="_event_");for(let k=0;k<S;k++){let G=document.createElement("option");G.value=O[k],G.innerHTML=O[k],u.appendChild(G),t.type_filter_out!==!1&&(t.type_filter_out+"").toLowerCase()==(O[k]+"").toLowerCase()&&(G.selected=!0)}u.addEventListener("change",function(){I()})}}if(t.show_close_button){var C=h.querySelector(".close");C.addEventListener("click",h.close)}var T=l.getBoundingClientRect(),E=(n?n.clientX:T.left+T.width*.5)-80,N=(n?n.clientY:T.top+T.height*.5)-20;T.width-E<470&&(E=T.width-470),T.height-N<220&&(N=T.height-220),E<T.left+20&&(E=T.left+20),N<T.top+20&&(N=T.top+20),h.style.left=E+"px",h.style.top=N+"px",b.focus(),t.show_all_on_open&&I();function A(O){if(O)if(a.onSearchBoxSelection)a.onSearchBoxSelection(O,n,r);else{var S=LiteGraph.searchbox_extras[O.toLowerCase()];S&&(O=S.type),r.graph.beforeChange();var k=LiteGraph.createNode(O);if(k&&(k.pos=r.convertEventToCanvasOffset(n),r.graph.add(k,!1,{doProcessChange:!1})),S&&S.data){if(S.data.properties)for(let P in S.data.properties)k.addProperty(P,S.data.properties[P]);if(S.data.inputs){k.inputs=[];for(let P in S.data.inputs)k.addOutput(S.data.inputs[P][0],S.data.inputs[P][1])}if(S.data.outputs){k.outputs=[];for(let P in S.data.outputs)k.addOutput(S.data.outputs[P][0],S.data.outputs[P][1])}S.data.title&&(k.title=S.data.title),S.data.json&&k.configure(S.data.json)}let G;if(t.node_from){switch(G=!1,typeof t.slot_from){case"string":G=t.node_from.findOutputSlot(t.slot_from);break;case"object":t.slot_from.name?G=t.node_from.findOutputSlot(t.slot_from.name):G=-1,G==-1&&typeof t.slot_from.slot_index!="undefined"&&(G=t.slot_from.slot_index);break;case"number":G=t.slot_from;break;default:G=0}typeof t.node_from.outputs[G]!="undefined"&&G!==!1&&G>-1&&t.node_from.connectByType(G,k,t.node_from.outputs[G].type)}if(t.node_to){switch(G=!1,typeof t.slot_from){case"string":G=t.node_to.findInputSlot(t.slot_from);break;case"object":t.slot_from.name?G=t.node_to.findInputSlot(t.slot_from.name):G=-1,G==-1&&typeof t.slot_from.slot_index!="undefined"&&(G=t.slot_from.slot_index);break;case"number":G=t.slot_from;break;default:G=0}typeof t.node_to.inputs[G]!="undefined"&&G!==!1&&G>-1&&t.node_to.connectByTypeOutput(G,k,t.node_to.inputs[G].type)}r.graph.afterChange()}h.close()}function M(O){var S=m;m&&m.classList.remove("selected"),m?(m=O?m.nextSibling:m.previousSibling,m||(m=S)):m=O?L.childNodes[0]:L.childNodes[L.childNodes.length],m&&(m.classList.add("selected"),m.scrollIntoView({block:"end",behavior:"smooth"}))}function I(){g=null;var O=b.value;if(_=null,L.innerHTML="",!O&&!t.show_all_if_empty)return;if(a.onSearchBox){var S=a.onSearchBox(L,O,r);if(S)for(let $=0;$<S.length;++$)Q(S[$])}else{let $=function(H,X={}){var de={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},D=Object.assign(de,X),U=LiteGraph.registered_node_types[H];if(G&&U.filter!=G||(!t.show_all_if_empty||O)&&H.toLowerCase().indexOf(O)===-1)return!1;if(t.do_type_filter&&!D.skipFilter){var q=H;let ce;var F=R.value;if(D.inTypeOverride!==!1&&(F=D.inTypeOverride),R&&F&&LiteGraph.registered_slot_in_types[F]&&LiteGraph.registered_slot_in_types[F].nodes&&(ce=LiteGraph.registered_slot_in_types[F].nodes.includes(q),ce===!1)||(F=z.value,D.outTypeOverride!==!1&&(F=D.outTypeOverride),z&&F&&LiteGraph.registered_slot_out_types[F]&&LiteGraph.registered_slot_out_types[F].nodes&&(ce=LiteGraph.registered_slot_out_types[F].nodes.includes(q),ce===!1)))return!1}return!0};var k=0;O=O.toLowerCase();var G=r.filter||r.graph.filter;let R,z;t.do_type_filter&&a.search_box?(R=a.search_box.querySelector(".slot_in_type_filter"),z=a.search_box.querySelector(".slot_out_type_filter")):(R=!1,z=!1);for(let H in LiteGraph.searchbox_extras){var P=LiteGraph.searchbox_extras[H];if(!((!t.show_all_if_empty||O)&&P.desc.toLowerCase().indexOf(O)===-1)){var j=LiteGraph.registered_node_types[P.type];if(!(j&&j.filter!=G)&&$(P.type)&&(Q(P.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&k++>LGraphCanvas.search_limit))break}}var Y=null;if(Array.prototype.filter)Y=Object.keys(LiteGraph.registered_node_types).filter($);else{Y=[];for(let H in LiteGraph.registered_node_types)$(H)&&Y.push(H)}for(let H=0;H<Y.length&&(Q(Y[H]),!(LGraphCanvas.search_limit!==-1&&k++>LGraphCanvas.search_limit));H++);if(t.show_general_after_typefiltered&&(R.value||z.value)){var K=[];for(let H in LiteGraph.registered_node_types)$(H,{inTypeOverride:R&&R.value?"*":!1,outTypeOverride:z&&z.value?"*":!1})&&K.push(H);for(let H=0;H<K.length&&(Q(K[H],"generic_type"),!(LGraphCanvas.search_limit!==-1&&k++>LGraphCanvas.search_limit));H++);}if((R.value||z.value)&&L.childNodes.length==0&&t.show_general_if_none_on_typefilter){var K=[];for(let X in LiteGraph.registered_node_types)$(X,{skipFilter:!0})&&K.push(X);for(let X=0;X<K.length&&(Q(K[X],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&k++>LGraphCanvas.search_limit));X++);}}function Q($,R){var z=document.createElement("div");_||(_=$),z.innerText=$,z.dataset.type=encodeURIComponent($),z.className="litegraph lite-search-item",R&&(z.className+=" "+R),z.addEventListener("click",function(H){A(decodeURIComponent(this.dataset.type))}),L.appendChild(z)}}return h}function showEditPropertyValue(n,t,o){var a,r,l,p,h;if(!n||n.properties[t]===void 0)return;o=o||{};var c=n.getPropertyInfo(t),u=c.type;let d;if(u=="string"||u=="number"||u=="array"||u=="object")d="<input autofocus type='text' class='value'/>";else if((u=="enum"||u=="combo")&&c.values){(a=LiteGraph.debug)==null||a.call(LiteGraph,"CREATING showEditPropertyValue ENUM COMBO",_,u,L),d="<select autofocus type='text' class='value'>";for(let C in c.values){var f=C;c.values.constructor===Array&&(f=c.values[C]),d+="<option value='"+f+"' "+(f==n.properties[t]?"selected":"")+">"+c.values[C]+"</option>"}d+="</select>"}else if(u=="boolean"||u=="toggle")d="<input autofocus type='checkbox' class='value' "+(n.properties[t]?"checked":"")+"/>";else{(r=LiteGraph.warn)==null||r.call(LiteGraph,"unknown type: "+u);return}var L=this.createDialog("<span class='name'>"+(c.label?c.label:t)+"</span>"+d+"<button>OK</button>",o),_=!1;(u=="enum"||u=="combo")&&c.values?((l=LiteGraph.debug)==null||l.call(LiteGraph,"showEditPropertyValue ENUM COMBO",_,u,L),_=L.querySelector("select"),_.addEventListener("change",function(C){var T;L.modified(),(T=LiteGraph.debug)==null||T.call(LiteGraph,"Enum change",_,c,C.target),b(C.target.value)})):u=="boolean"||u=="toggle"?((p=LiteGraph.debug)==null||p.call(LiteGraph,"showEditPropertyValue TOGGLE",_,u,L),_=L.querySelector("input"),_&&_.addEventListener("click",function(C){L.modified(),b(!!_.checked)})):(_=L.querySelector("input"),(h=LiteGraph.debug)==null||h.call(LiteGraph,"showEditPropertyValue",_,u,L),_&&(_.addEventListener("blur",function(C){this.focus()}),f=n.properties[t]!==void 0?n.properties[t]:"",u!=="string"&&(f=JSON.stringify(f)),_.value=f,_.addEventListener("keydown",function(C){if(C.keyCode==27)L.close();else if(C.keyCode==13)m();else if(C.keyCode!=13){L.modified();return}C.preventDefault(),C.stopPropagation()}))),_&&_.focus();var g=L.querySelector("button");g.addEventListener("click",m);function m(){b(_.value)}function b(C){var T;c&&c.values&&c.values.constructor===Object&&c.values[C]!=null&&(C=c.values[C]),typeof n.properties[t]=="number"&&(C=Number(C)),(u=="array"||u=="object")&&(C=JSON.parse(C)),n.properties[t]=C,(T=n.graph)==null||T.onGraphChanged({action:"propertyChanged",doSave:!0}),n.onPropertyChanged&&n.onPropertyChanged(t,C),o.onclose&&o.onclose(),L.close(),n.setDirtyCanvas(!0,!0)}return L}function createDialog(n,t){var o={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};t=Object.assign(o,t||{});var a=document.createElement("div");a.className="graphdialog",a.innerHTML=n,a.is_modified=!1;var r=this.canvas.getBoundingClientRect(),l=-20,p=-20;if(r&&(l-=r.left,p-=r.top),t.position?(l+=t.position[0],p+=t.position[1]):t.event?(l+=t.event.clientX,p+=t.event.clientY):(l+=this.canvas.width*.5,p+=this.canvas.height*.5),a.style.left=l+"px",a.style.top=p+"px",this.canvas.parentNode.appendChild(a),t.checkForInput){var h=[],c=!1;h=a.querySelectorAll("input"),h&&h.forEach(function(L){L.addEventListener("keydown",function(_){if(a.modified(),_.keyCode==27)a.close();else if(_.keyCode!=13)return;_.preventDefault(),_.stopPropagation()}),c||L.focus()})}a.modified=function(){a.is_modified=!0},a.close=function(){a.parentNode&&a.parentNode.removeChild(a)};var u=null,d=0;a.addEventListener("pointerleave",function(L){d>0||(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!a.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(a.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),a.addEventListener("pointerenter",function(L){(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&u&&clearTimeout(u)});var f=a.querySelectorAll("select");return f&&f.forEach(function(L){L.addEventListener("pointerdown",function(_){d++}),L.addEventListener("focus",function(_){d++}),L.addEventListener("blur",function(_){d=Math.max(0,d-1)}),L.addEventListener("change",function(_){d=0})}),a}function createPanel(n,t){t=t||{};var o=t.window||window,a=document.createElement("div");if(a.className="litegraph dialog",a.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",a.header=a.querySelector(".dialog-header"),t.width&&(a.style.width=t.width+(t.width.constructor===Number?"px":"")),t.height&&(a.style.height=t.height+(t.height.constructor===Number?"px":"")),t.closable){var r=document.createElement("span");r.innerHTML="&#10005;",r.classList.add("close"),r.addEventListener("click",function(){a.close()}),a.header.appendChild(r)}return a.title_element=a.querySelector(".dialog-title"),a.title_element.innerText=n,a.content=a.querySelector(".dialog-content"),a.alt_content=a.querySelector(".dialog-alt-content"),a.footer=a.querySelector(".dialog-footer"),a.close=function(){a.onClose&&typeof a.onClose=="function"&&a.onClose(),a.parentNode&&a.parentNode.removeChild(a)},a.toggleAltContent=function(l){let p,h;typeof l!="undefined"?(p=l?"block":"none",h=l?"none":"block"):(p=a.alt_content.style.display!="block"?"block":"none",h=a.alt_content.style.display!="block"?"none":"block"),a.alt_content.style.display=p,a.content.style.display=h},a.toggleFooterVisibility=function(l){let p;typeof l!="undefined"?p=l?"block":"none":p=a.footer.style.display!="block"?"block":"none",a.footer.style.display=p},a.clear=function(){this.content.innerHTML=""},a.addHTML=function(l,p,h){var c=document.createElement("div");return p&&(c.className=p),c.innerHTML=l,h?a.footer.appendChild(c):a.content.appendChild(c),c},a.addButton=function(l,p,h){var c=document.createElement("button");return c.innerText=l,c.options=h,c.classList.add("btn"),c.addEventListener("click",p),a.footer.appendChild(c),c},a.addSeparator=function(){var l=document.createElement("div");l.className="separator",a.content.appendChild(l)},a.addWidget=function(l,p,h,c,u){var d,f;c=c||{};var L=String(h);l=l.toLowerCase(),l=="number"&&(L=h.toFixed(3));var _=document.createElement("div");_.className="property",_.innerHTML="<span class='property_name'></span><span class='property_value'></span>",_.querySelector(".property_name").innerText=c.label||p;var g=_.querySelector(".property_value");g.innerText=L,_.dataset.property=p,_.dataset.type=c.type||l,_.options=c,_.value=h,(d=LiteGraph.debug)==null||d.call(LiteGraph,"addWidget",l,h,g,c),l=="code"?_.addEventListener("click",function(b){a.inner_showCodePad(this.dataset.property)}):l=="boolean"?(_.classList.add("boolean"),h&&_.classList.add("bool-on"),_.addEventListener("click",function(){var b=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",m(b,this.value)})):l=="string"||l=="number"?(g.setAttribute("contenteditable",!0),g.addEventListener("keydown",function(b){b.code=="Enter"&&(l!="string"||!b.shiftKey)&&(b.preventDefault(),this.blur())}),g.addEventListener("blur",function(){var b=this.innerText,C=this.parentNode.dataset.property,T=this.parentNode.dataset.type;T=="number"&&(b=Number(b)),m(C,b)})):(l=="enum"||l=="combo")&&(L=LGraphCanvas.getPropertyPrintableValue(h,c.values),g.innerText=L,(f=LiteGraph.debug)==null||f.call(LiteGraph,"addWidget ENUM COMBO",l,L,g,c),g.addEventListener("click",function(b){var C=c.values||[],T=this.parentNode.dataset.property,E=this;new LiteGraph.ContextMenu(C,{event:b,className:"dark",callback:N},o);function N(A){return E.innerText=A,m(T,A),!1}})),a.content.appendChild(_);function m(b,C){var T;(T=LiteGraph.debug)==null||T.call(LiteGraph,"widgetInnerChange",b,C,c),c.callback&&c.callback(b,C,c),u&&u(b,C,c)}return _},a.onOpen&&typeof a.onOpen=="function"&&a.onOpen(),a}function closePanels(){var n=document.querySelector("#node-panel");n&&n.close(),n=document.querySelector("#option-panel"),n&&n.close()}function showShowGraphOptionsPanel(n,t){var o,a,r,l;let p;if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!((a=(o=t==null?void 0:t.event)==null?void 0:o.target)!=null&&a.lgraphcanvas)){(r=LiteGraph.warn)==null||r.call(LiteGraph,"References not found to add optionPanel",n,t),LiteGraph.debug&&((l=LiteGraph.debug)==null||l.call(LiteGraph,"!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas",t,t.event,t.event.target,t.event.target.lgraphcanvas));return}p=t.event.target.lgraphcanvas}else p=this;p.closePanels();var h=p.getCanvasWindow();panel=p.createPanel("Options",{closable:!0,window:h,onOpen:function(){p.OPTIONPANEL_IS_OPEN=!0},onClose:function(){p.OPTIONPANEL_IS_OPEN=!1,p.options_panel=null}}),p.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function c(){panel.content.innerHTML="";const u=(_,g,m)=>{m&&m.key&&(_=m.key),m.values&&(g=Object.values(m.values).indexOf(g)),p[_]=g};var d=LiteGraph.availableCanvasOptions;d.sort();for(var f in d){var L=d[f];panel.addWidget("boolean",L,p[L],{key:L,on:"True",off:"False"},u)}panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[p.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},u),panel.addSeparator(),panel.footer.innerHTML=""}c(),p.canvas.parentNode.appendChild(panel)}function showShowNodePanel(n){this.SELECTED_NODE=n,this.closePanels();var t=this.getCanvasWindow(),o=this,a=this.createPanel(n.title||"",{closable:!0,window:t,onOpen:function(){o.NODEPANEL_IS_OPEN=!0},onClose:function(){o.NODEPANEL_IS_OPEN=!1,o.node_panel=null}});o.node_panel=a,a.id="node-panel",a.node=n,a.classList.add("settings");function r(){a.content.innerHTML="",a.addHTML("<span class='node_type'>"+n.type+"</span><span class='node_desc'>"+(n.constructor.desc||"")+"</span><span class='separator'></span>"),a.addHTML("<h3>Properties</h3>");const l=(d,f)=>{var L,_;switch(o.graph.beforeChange(n),d){case"Title":n.title=f;break;case"Mode":var g=Object.values(LiteGraph.NODE_MODES).indexOf(f);g>=0&&LiteGraph.NODE_MODES[g]?n.changeMode(g):(L=LiteGraph.warn)==null||L.call(LiteGraph,"unexpected mode: "+f);break;case"Color":LGraphCanvas.node_colors[f]?(n.color=LGraphCanvas.node_colors[f].color,n.bgcolor=LGraphCanvas.node_colors[f].bgcolor):(_=LiteGraph.warn)==null||_.call(LiteGraph,"unexpected color: "+f);break;default:n.setProperty(d,f);break}o.graph.afterChange(),o.dirty_canvas=!0};a.addWidget("string","Title",n.title,{},l),a.addWidget("combo","Mode",LiteGraph.NODE_MODES[n.mode],{values:LiteGraph.NODE_MODES},l);var p="";n.color!==void 0&&(p=Object.keys(LGraphCanvas.node_colors).filter(function(d){return LGraphCanvas.node_colors[d].color==n.color})),a.addWidget("combo","Color",p,{values:Object.keys(LGraphCanvas.node_colors)},l);for(var h in n.properties){var c=n.properties[h],u=n.getPropertyInfo(h);n.onAddPropertyToPanel&&n.onAddPropertyToPanel(h,a,c,u,l)||a.addWidget(u.widget||u.type,h,c,u,l)}a.addSeparator(),n.onShowCustomPanelInfo&&n.onShowCustomPanelInfo(a),a.footer.innerHTML="",a.addButton("Delete",function(){n.block_delete||(n.graph.remove(n),a.close())}).classList.add("delete")}a.inner_showCodePad=function(l){a.classList.remove("settings"),a.classList.add("centered"),a.alt_content.innerHTML="<textarea class='code'></textarea>";var p=a.alt_content.querySelector("textarea"),h=()=>{a.toggleAltContent(!1),a.toggleFooterVisibility(!0),p.parentNode.removeChild(p),a.classList.add("settings"),a.classList.remove("centered"),r()};p.value=n.properties[l],p.addEventListener("keydown",function(d){d.code=="Enter"&&d.ctrlKey&&(n.setProperty(l,p.value),h())}),a.toggleAltContent(!0),a.toggleFooterVisibility(!1),p.style.height="calc(100% - 40px)";var c=a.addButton("Assign",function(){n.setProperty(l,p.value),h()});a.alt_content.appendChild(c);var u=a.addButton("Close",h);u.style.float="right",a.alt_content.appendChild(u)},r(),this.canvas.parentNode.appendChild(a)}function showSubgraphPropertiesDialog(n){var t;(t=LiteGraph.log)==null||t.call(LiteGraph,"showing subgraph properties dialog");var o=this.canvas.parentNode.querySelector(".subgraph_dialog");o&&o.close();var a=this.createPanel("Subgraph Inputs",{closable:!0,width:500});a.node=n,a.classList.add("subgraph_dialog");function r(){if(a.clear(),n.inputs)for(let d=0;d<n.inputs.length;++d){var h=n.inputs[d];if(!h.not_subgraph_input){var c="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",u=a.addHTML(c,"subgraph_property");u.dataset.name=h.name,u.dataset.slot=d,u.querySelector(".name").innerText=h.name,u.querySelector(".type").innerText=h.type,u.querySelector("button").addEventListener("click",function(f){n.removeInput(Number(this.parentNode.dataset.slot)),r()})}}}var l=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",p=a.addHTML(l,"subgraph_property extra",!0);return p.querySelector("button").addEventListener("click",function(h){var c=this.parentNode,u=c.querySelector(".name").value,d=c.querySelector(".type").value;!u||n.findInputSlot(u)!=-1||(n.addInput(u,d),c.querySelector(".name").value="",c.querySelector(".type").value="",r())}),r(),this.canvas.parentNode.appendChild(a),a}function showSubgraphPropertiesDialogRight(n){var t=this.canvas.parentNode.querySelector(".subgraph_dialog");t&&t.close();var o=this.createPanel("Subgraph Outputs",{closable:!0,width:500});o.node=n,o.classList.add("subgraph_dialog");function a(){if(o.clear(),n.outputs)for(let d=0;d<n.outputs.length;++d){var h=n.outputs[d];if(!h.not_subgraph_output){var c="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",u=o.addHTML(c,"subgraph_property");u.dataset.name=h.name,u.dataset.slot=d,u.querySelector(".name").innerText=h.name,u.querySelector(".type").innerText=h.type,u.querySelector("button").addEventListener("click",function(f){n.removeOutput(Number(this.parentNode.dataset.slot)),a()})}}}var r=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",l=o.addHTML(r,"subgraph_property extra",!0);l.querySelector(".name").addEventListener("keydown",function(h){e.keyCode==13&&p.apply(this)}),l.querySelector("button").addEventListener("click",function(h){p.apply(this)});function p(){var h=this.parentNode,c=h.querySelector(".name").value,u=h.querySelector(".type").value;!c||n.findOutputSlot(c)!=-1||(n.addOutput(c,u),h.querySelector(".name").value="",h.querySelector(".type").value="",a())}return a(),this.canvas.parentNode.appendChild(o),o}function checkPanels(){if(this.canvas){var n=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(let o=0;o<n.length;++o){var t=n[o];t.node&&(!t.node.graph||t.graph!=this.graph)&&t.close()}}}class UiController{constructor(t){this.host=t}showLinkMenu(...t){return showLinkMenu.apply(this.host,t)}createDefaultNodeForSlot(...t){return createDefaultNodeForSlot.apply(this.host,t)}showConnectionMenu(...t){return showConnectionMenu.apply(this.host,t)}getCanvasMenuOptions(...t){return getCanvasMenuOptions.apply(this.host,t)}getNodeMenuOptions(...t){return getNodeMenuOptions.apply(this.host,t)}getGroupMenuOptions(...t){return getGroupMenuOptions.apply(this.host,t)}processContextMenu(...t){return processContextMenu.apply(this.host,t)}prompt(...t){return prompt.apply(this.host,t)}showSearchBox(...t){return showSearchBox.apply(this.host,t)}showEditPropertyValue(...t){return showEditPropertyValue.apply(this.host,t)}createDialog(...t){return createDialog.apply(this.host,t)}createPanel(...t){return createPanel.apply(this.host,t)}closePanels(...t){return closePanels.apply(this.host,t)}showShowGraphOptionsPanel(...t){return showShowGraphOptionsPanel.apply(this.host,t)}showShowNodePanel(...t){return showShowNodePanel.apply(this.host,t)}showSubgraphPropertiesDialog(...t){return showSubgraphPropertiesDialog.apply(this.host,t)}showSubgraphPropertiesDialogRight(...t){return showSubgraphPropertiesDialogRight.apply(this.host,t)}checkPanels(...t){return checkPanels.apply(this.host,t)}}function createLGraphCanvasControllers(n){return{core:new CoreController(n),events:new EventsController(n),render:new RenderController(n),selection:new SelectionController(n),ui:new UiController(n)}}const delegateMap={clear:"core",setGraph:"core",getTopGraph:"core",openSubgraph:"core",closeSubgraph:"core",getCurrentGraph:"core",setCanvas:"core",_doNothing:"core",_doReturnTrue:"core",bindEvents:"core",unbindEvents:"core",enableWebGL:"core",setDirty:"core",getCanvasWindow:"core",startRendering:"core",stopRendering:"core",blockClick:"events",processUserInputDown:"events",processMouseDown:"events",processMouseMove:"events",processMouseUp:"events",processMouseWheel:"events",isOverNodeBox:"core",isOverNodeInput:"core",isOverNodeOutput:"core",processKey:"events",copyToClipboard:"selection",pasteFromClipboard:"selection",processDrop:"events",checkDropItem:"events",processNodeDblClicked:"selection",processNodeSelected:"selection",selectNode:"selection",selectNodes:"selection",deselectNode:"selection",deselectAllNodes:"selection",deleteSelectedNodes:"selection",centerOnNode:"core",adjustMouseEvent:"core",setZoom:"core",convertOffsetToCanvas:"core",convertCanvasToOffset:"core",convertEventToCanvasOffset:"core",bringToFront:"core",sendToBack:"core",computeVisibleNodes:"core",draw:"render",drawFrontCanvas:"render",drawSubgraphPanel:"render",drawSubgraphPanelLeft:"render",drawSubgraphPanelRight:"render",drawButton:"render",isAreaClicked:"render",renderInfo:"render",drawBackCanvas:"render",drawNode:"render",drawNodeTooltip:"render",drawLinkTooltip:"render",drawNodeShape:"render",drawConnections:"render",renderLink:"render",computeConnectionPoint:"render",drawExecutionOrder:"render",drawNodeWidgets:"render",processNodeWidgets:"render",drawGroups:"render",adjustNodesSize:"render",resize:"core",switchLiveMode:"core",onNodeSelectionChange:"selection",boundaryNodesForSelection:"selection",showLinkMenu:"ui",createDefaultNodeForSlot:"ui",showConnectionMenu:"ui",prompt:"ui",showSearchBox:"ui",showEditPropertyValue:"ui",createDialog:"ui",createPanel:"ui",closePanels:"ui",showShowGraphOptionsPanel:"ui",showShowNodePanel:"ui",showSubgraphPropertiesDialog:"ui",showSubgraphPropertiesDialogRight:"ui",checkPanels:"ui",getCanvasMenuOptions:"ui",getNodeMenuOptions:"ui",getGroupMenuOptions:"ui",processContextMenu:"ui",lowQualityRenderingRequired:"render"};function ensureControllers(n){return n.controllers||(n.controllers=createLGraphCanvasControllers(n)),n.controllers}function installLGraphCanvasDelegates(n){for(const[t,o]of Object.entries(delegateMap))Object.defineProperty(n.prototype,t,{value:function(...a){return ensureControllers(this)[o][t](...a)},writable:!0,configurable:!0})}function getFileExtension(n){const t=new URL(n).pathname,o=t.lastIndexOf(".");return o===-1?"":t.slice(o+1).toLowerCase()}function onGroupAdd(n,t,o){var a=LGraphCanvas.active_canvas,r=new LiteGraph.LGraphGroup;r.pos=a.convertEventToCanvasOffset(o),a.graph.add(r)}function getBoundaryNodes(n){let t=null,o=null,a=null,r=null;for(const l in n){const p=n[l],[h,c]=p.pos,[u,d]=p.size;(t===null||c<t.pos[1])&&(t=p),(o===null||h+u>o.pos[0]+o.size[0])&&(o=p),(a===null||c+d>a.pos[1]+a.size[1])&&(a=p),(r===null||h<r.pos[0])&&(r=p)}return{top:t,right:o,bottom:a,left:r}}function alignNodes(n,t,o){if(!n)return;const a=LGraphCanvas.active_canvas;let r=[];o===void 0?r=LGraphCanvas.getBoundaryNodes(n):r={top:o,right:o,bottom:o,left:o};for(const[l,p]of Object.entries(a.selected_nodes))switch(t){case"right":p.pos[0]=r.right.pos[0]+r.right.size[0]-p.size[0];break;case"left":p.pos[0]=r.left.pos[0];break;case"top":p.pos[1]=r.top.pos[1];break;case"bottom":p.pos[1]=r.bottom.pos[1]+r.bottom.size[1]-p.size[1];break}a.dirty_canvas=!0,a.dirty_bgcanvas=!0}function onNodeAlign(n,t,o,a,r){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:o,callback:l,parentMenu:a});function l(p){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,p.toLowerCase(),r)}}function onGroupAlign(n,t,o,a){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:o,callback:r,parentMenu:a});function r(l){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,l.toLowerCase())}}function onMenuAdd(n,t,o,a,r){var l=LGraphCanvas.active_canvas,p=l.getCanvasWindow(),h=l.graph;if(!h)return;function c(u,d){var f=LiteGraph.getNodeTypesCategories(l.filter||h.filter).filter(function(g){return g.startsWith(u)}),L=[];f.map(function(g){if(g){var m=new RegExp("^("+u+")"),b=g.replace(m,"").split("/")[0],C=u===""?b+"/":u+b+"/",T=b;T.indexOf("::")!=-1&&(T=T.split("::")[1]);var E=L.findIndex(function(N){return N.value===C});E===-1&&L.push({value:C,content:T,has_submenu:!0,callback:function(N,A,M,I){c(N.value,I)}})}});var _=LiteGraph.getNodeTypesInCategory(u.slice(0,-1),l.filter||h.filter);_.map(function(g){if(!g.skip_list){var m={value:g.type,content:g.title,has_submenu:!1,callback:function(b,C,T,E){var N=E.getFirstEvent();l.graph.beforeChange();var A=LiteGraph.createNode(b.value);A&&(A.pos=l.convertEventToCanvasOffset(N),l.graph.add(A)),r&&r(A),l.graph.afterChange()}};L.push(m)}}),new LiteGraph.ContextMenu(L,{event:o,parentMenu:d},p)}return c("",a),!1}function onMenuCollapseAll(){}function onMenuNodeEdit(){}function showMenuNodeOptionalInputs(n,t,o,a,r){var l;if(!r)return;var p=this,h=LGraphCanvas.active_canvas,c=h.getCanvasWindow();t=r.optional_inputs,r.onGetInputs&&(t=r.onGetInputs());var u=[];if(t)for(let m=0;m<t.length;m++){var d=t[m];if(!d){u.push(null);continue}var f=d[0];d[2]||(d[2]={}),d[2].label&&(f=d[2].label),d[2].removable=!0;var L={content:f,value:d};d[1]==LiteGraph.ACTION&&(L.className="event"),u.push(L)}if(r.onMenuNodeInputs){var _=r.onMenuNodeInputs(u);_&&(u=_)}if(LiteGraph.do_add_triggers_slots&&r.findInputSlot("onTrigger")==-1&&u.push({content:"On Trigger",value:["onTrigger",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),!u.length){LiteGraph.debug&&((l=LiteGraph.log)==null||l.call(LiteGraph,"no input entries"));return}new LiteGraph.ContextMenu(u,{event:o,callback:g,parentMenu:a,node:r},c);function g(m,b,C){var T;if(r&&(m.callback&&m.callback.call(p,r,m,b,C),m.value)){r.graph.beforeChange();const E=m.value[2]?Object.assign({},m.value[2]):{};r.addInput(m.value[0],m.value[1],E),(T=r.onNodeInputAdd)==null||T.call(r,m.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()}}return!1}function showMenuNodeOptionalOutputs(n,t,o,a,r){if(!r)return;var l=this,p=LGraphCanvas.active_canvas,h=p.getCanvasWindow();t=r.optional_outputs,r.onGetOutputs&&(t=r.onGetOutputs());var c=[];if(t)for(let g=0;g<t.length;g++){var u=t[g];if(!u){c.push(null);continue}if(!(r.flags&&r.flags.skip_repeated_outputs&&r.findOutputSlot(u[0])!=-1)){var d=u[0];u[2]||(u[2]={}),u[2].label&&(d=u[2].label),u[2].removable=!0;var f={content:d,value:u};u[1]==LiteGraph.EVENT&&(f.className="event"),c.push(f)}}if(this.onMenuNodeOutputs&&(c=this.onMenuNodeOutputs(c)),LiteGraph.do_add_triggers_slots&&r.findOutputSlot("onExecuted")==-1&&c.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),r.onMenuNodeOutputs){var L=r.onMenuNodeOutputs(c);L&&(c=L)}if(!c.length)return;new LiteGraph.ContextMenu(c,{event:o,callback:_,parentMenu:a,node:r},h);function _(g,m,b){var C;if(r&&(g.callback&&g.callback.call(l,r,g,m,b),!!g.value)){var T=g.value[1];if(T&&(T.constructor===Object||T.constructor===Array)){var E=[];for(let N in T)E.push({content:N,value:T[N]});return new LiteGraph.ContextMenu(E,{event:m,callback:_,parentMenu:a,node:r}),!1}else{r.graph.beforeChange();const N=g.value[2]?Object.assign({},g.value[2]):{};r.addOutput(g.value[0],g.value[1],N),(C=r.onNodeOutputAdd)==null||C.call(r,g.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()}}}return!1}function onShowMenuNodeProperties(n,t,o,a,r){if(!r||!r.properties)return;var l=LGraphCanvas.active_canvas,p=l.getCanvasWindow(),h=[];for(let d in r.properties){n=r.properties[d]!==void 0?r.properties[d]:" ",typeof n=="object"&&(n=JSON.stringify(n));var c=r.getPropertyInfo(d);(c.type=="enum"||c.type=="combo")&&(n=LGraphCanvas.getPropertyPrintableValue(n,c.values)),n=LGraphCanvas.decodeHTML(n),h.push({content:"<span class='property_name'>"+(c.label?c.label:d)+"</span><span class='property_value'>"+n+"</span>",value:d})}if(!h.length)return;new LiteGraph.ContextMenu(h,{event:o,callback:u,parentMenu:a,allow_html:!0,node:r},p);function u(d){if(r){var f=this.getBoundingClientRect();l.showEditPropertyValue(r,d.value,{position:[f.left,f.top]})}}return!1}function decodeHTML(n){var t=document.createElement("div");return t.innerText=n,t.innerHTML}function onMenuResizeNode(n,t,o,a,r){if(!r)return;const l=h=>{h.size=h.computeSize(),h.onResize&&h.onResize(h.size)};var p=LGraphCanvas.active_canvas;if(!p.selected_nodes||Object.keys(p.selected_nodes).length<=1)l(r);else for(let h in p.selected_nodes)l(p.selected_nodes[h]);r.setDirtyCanvas(!0,!0)}function onShowPropertyEditor(n,t,o,a,r){var l=n.property||"title",p=r[l],h=document.createElement("div");h.is_modified=!1,h.className="graphdialog",h.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",h.close=()=>{var E;(E=h.parentNode)==null||E.removeChild(h)};var c=h.querySelector(".name");c.innerText=l;var u=h.querySelector(".value");const d=()=>{u&&T(u.value)};u&&(u.value=p,u.addEventListener("blur",function(E){this.focus()}),u.addEventListener("keydown",function(E){if(h.is_modified=!0,E.keyCode==27)h.close();else if(E.keyCode==13)d();else if(E.keyCode!=13&&E.target.localName!="textarea")return;E.preventDefault(),E.stopPropagation()}));var f=LGraphCanvas.active_canvas,L=f.canvas,_=L.getBoundingClientRect(),g=-20,m=-20;_&&(g-=_.left,m-=_.top),event?(h.style.left=event.clientX+g+"px",h.style.top=event.clientY+m+"px"):(h.style.left=L.width*.5+g+"px",h.style.top=L.height*.5+m+"px");var b=h.querySelector("button");b.addEventListener("click",d),L.parentNode.appendChild(h),u&&u.focus();let C=null;h.addEventListener("pointerleave",E=>{LiteGraph.dialog_close_on_mouse_leave&&!h.is_modified&&(C=setTimeout(h.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),h.addEventListener("pointerenter",E=>{LiteGraph.dialog_close_on_mouse_leave&&C&&clearTimeout(C)});const T=E=>{var N;switch(n.type){case"Number":E=Number(E);break;case"Boolean":E=!!E;break}r[l]=E,(N=h.parentNode)==null||N.removeChild(h),r.setDirtyCanvas(!0,!0)}}function getPropertyPrintableValue(n,t){if(!t||t.constructor===Array)return String(n);if(t.constructor===Object){var o="";for(var a in t)if(t[a]==n){o=a;break}return String(n)+" ("+o+")"}}function onMenuNodeCollapse(n,t,o,a,r){r.graph.beforeChange();var l=function(h){h.collapse()},p=LGraphCanvas.active_canvas;if(!p.selected_nodes||Object.keys(p.selected_nodes).length<=1)l(r);else for(let h in p.selected_nodes)l(p.selected_nodes[h]);r.graph.afterChange()}function onMenuNodePin(n,t,o,a,r){r.pin()}function onMenuNodeMode(n,t,o,a,r){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:o,callback:l,parentMenu:a,node:r});function l(p){if(!r)return;var h=Object.values(LiteGraph.NODE_MODES).indexOf(p);const c=d=>{var f;h>=0&&LiteGraph.NODE_MODES[h]?d.changeMode(h):((f=LiteGraph.warn)==null||f.call(LiteGraph,"unexpected mode: "+p),d.changeMode(LiteGraph.ALWAYS))};var u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)c(r);else for(let d in u.selected_nodes)c(u.selected_nodes[d])}return!1}function onMenuNodeColors(n,t,o,a,r){if(!r)throw new Error("no node for color");var l=[];l.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(let h in LGraphCanvas.node_colors){let c=LGraphCanvas.node_colors[h];n={value:h,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+c.color+"; background-color:"+c.bgcolor+"'>"+h+"</span>"},l.push(n)}new LiteGraph.ContextMenu(l,{event:o,callback:p,parentMenu:a,node:r});function p(h){if(!r)return;let c=h.value?LGraphCanvas.node_colors[h.value]:null;const u=f=>{c?f.constructor===LiteGraph.LGraphGroup?f.color=c.groupcolor:(f.color=c.color,f.bgcolor=c.bgcolor):(delete f.color,delete f.bgcolor)};var d=LGraphCanvas.active_canvas;if(!d.selected_nodes||Object.keys(d.selected_nodes).length<=1)u(r);else for(let f in d.selected_nodes)u(d.selected_nodes[f]);r.setDirtyCanvas(!0,!0)}return!1}function onMenuNodeShapes(n,t,o,a,r){if(!r)throw new Error("no node passed");new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:o,callback:l,parentMenu:a,node:r});function l(p){if(!r)return;r.graph.beforeChange();const h=u=>{u.shape=p};var c=LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)h(r);else for(let u in c.selected_nodes)h(c.selected_nodes[u]);r.graph.afterChange(),r.setDirtyCanvas(!0)}return!1}function onMenuNodeRemove(n,t,o,a,r){if(!r)throw new Error("no node passed");var l=r.graph;l.beforeChange();const p=c=>{c.removable!==!1&&l.remove(c)};var h=LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)p(r);else for(let c in h.selected_nodes)p(h.selected_nodes[c]);l.afterChange(),r.setDirtyCanvas(!0,!0)}function onMenuNodeToSubgraph(n,t,o,a,r){var l=r.graph,p=LGraphCanvas.active_canvas;if(p){var h=Object.values(p.selected_nodes||{});h.length||(h=[r]);var c=LiteGraph.createNode("graph/subgraph");c.pos=r.pos.concat(),l.add(c),c.buildFromNodes(h),p.deselectAllNodes(),r.setDirtyCanvas(!0,!0)}}function onMenuNodeClone(n,t,o,a,r){r.graph.beforeChange();var l={};const p=c=>{if(c.clonable!==!1){var u=c.clone();u&&(u.pos=[c.pos[0]+5,c.pos[1]+5],c.graph.add(u),l[u.id]=u)}};var h=LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)p(r);else for(let c in h.selected_nodes)p(h.selected_nodes[c]);Object.keys(l).length&&h.selectNodes(l),r.graph.afterChange(),r.setDirtyCanvas(!0,!0)}const DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",link_type_colors={"-1":"#A86",number:"#AAA",node:"#DCA",string:"#77F",boolean:"#F77"},gradients={},search_limit=-1,node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};function applyLGraphCanvasStatics(n){Object.assign(n,{getFileExtension,onGroupAdd,getBoundaryNodes,alignNodes,onNodeAlign,onGroupAlign,onMenuAdd,onMenuCollapseAll,onMenuNodeEdit,showMenuNodeOptionalInputs,showMenuNodeOptionalOutputs,onShowMenuNodeProperties,decodeHTML,onMenuResizeNode,onShowPropertyEditor,getPropertyPrintableValue,onMenuNodeCollapse,onMenuNodePin,onMenuNodeMode,onMenuNodeColors,onMenuNodeShapes,onMenuNodeRemove,onMenuNodeToSubgraph,onMenuNodeClone}),n.DEFAULT_BACKGROUND_IMAGE=DEFAULT_BACKGROUND_IMAGE,n.link_type_colors=link_type_colors,n.gradients=gradients,n.search_limit=search_limit,n.node_colors=node_colors}class LGraphCanvas{constructor(t,o,a){a!=null||(a={skip_render:!1,autoresize:!1,clip_all_nodes:!1}),this.options=a,this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,t&&t.constructor===String&&(t=document.querySelector(t)),this.ds=new LiteGraph.DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=`${LiteGraph.NODE_TEXT_SIZE}px Arial`,this.inner_text_font=`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.move_destination_link_without_shift=!1,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.free_resize=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.autoresize=a.autoresize,this.skip_render=a.skip_render,this.clip_all_nodes=a.clip_all_nodes,this.free_resize=a.free_resize,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=a.viewport||null,this.low_quality_rendering_threshold=5,this.controllers=createLGraphCanvasControllers(this),this.processMouseWheel=this.processMouseWheel.bind(this),this.processKey=this.processKey.bind(this),this.processDrop=this.processDrop.bind(this),o==null||o.attachCanvas(this),this.setCanvas(t,a.skip_events),this.clear(),!this.skip_render&&!a.skip_render&&this.startRendering()}}installLGraphCanvasDelegates(LGraphCanvas),applyLGraphCanvasStatics(LGraphCanvas);class DragAndScale{constructor(t,o){B(this,"onMouseDown",a=>{if(!this.enabled)return;const r=this.element.getBoundingClientRect();var l=a.clientX-r.left,p=a.clientY-r.top;a.canvasx=l,a.canvasy=p,a.dragging=this.dragging;var h=!this.viewport||this.viewport&&l>=this.viewport[0]&&l<this.viewport[0]+this.viewport[2]&&p>=this.viewport[1]&&p<this.viewport[1]+this.viewport[3];h&&(this.dragging=!0,this.abortController=new AbortController,document.addEventListener("pointermove",this.onMouseMove,{signal:this.abortController.signal}),document.addEventListener("pointerup",this.onMouseUp,{signal:this.abortController.signal})),this.last_mouse[0]=l,this.last_mouse[1]=p}),B(this,"onMouseMove",a=>{if(!this.enabled)return;const r=this.element.getBoundingClientRect();var l=a.clientX-r.left,p=a.clientY-r.top;a.canvasx=l,a.canvasy=p,a.dragging=this.dragging;var h=l-this.last_mouse[0],c=p-this.last_mouse[1];this.dragging&&this.mouseDrag(h,c),this.last_mouse[0]=l,this.last_mouse[1]=p}),B(this,"onMouseUp",a=>{var r;this.dragging=!1,(r=this.abortController)==null||r.abort()}),B(this,"onWheel",a=>{a.wheel=-a.deltaY,a.delta=a.wheelDelta?a.wheelDelta/40:a.deltaY?-a.deltaY/3:0,this.changeDeltaScale(1+a.delta*.05)}),this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,o||this.bindEvents(t))}bindEvents(t){this.last_mouse=new Float32Array(2),t.addEventListener("pointerdown",this.onMouseDown),t.addEventListener("wheel",this.onWheel)}computeVisibleArea(t){if(!this.element){this.visible_area.set([0,0,0,0]);return}let o=this.element.width,a=this.element.height,r=-this.offset[0],l=-this.offset[1];if(t){r+=t[0]/this.scale,l+=t[1]/this.scale;const[c,u]=t.slice(2);o=c,a=u}const p=r+o/this.scale,h=l+a/this.scale;this.visible_area.set([r,l,p-r,h-l])}toCanvasContext(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]}convertCanvasToOffset(t,o=[0,0]){return o[0]=t[0]/this.scale-this.offset[0],o[1]=t[1]/this.scale-this.offset[1],o}mouseDrag(t,o){var a;this.offset[0]+=t/this.scale,this.offset[1]+=o/this.scale,(a=this.onredraw)==null||a.call(this,this)}changeScale(t,o){var a;if(t=LiteGraph.clamp(t,this.min_scale,this.max_scale),t==this.scale||!this.element)return;const r=this.element.getBoundingClientRect();if(r){o=o||[r.width*.5,r.height*.5];var l=this.convertCanvasToOffset(o);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var p=this.convertCanvasToOffset(o),h=[p[0]-l[0],p[1]-l[1]];this.offset[0]+=h[0],this.offset[1]+=h[1],(a=this.onredraw)==null||a.call(this,this)}}changeDeltaScale(t,o){this.changeScale(this.scale*t,o)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}var W,se,re,ne,ae,oe,le;const Z=class ge{constructor(t,o={}){ie(this,W);var a;this.options=o,(a=o.scroll_speed)!=null||(o.scroll_speed=.1),this.menu_elements=[],J(this,W,ne).call(this),J(this,W,ae).call(this),J(this,W,se).call(this),J(this,W,re).call(this),this.setTitle(this.options.title),this.addItems(t),J(this,W,oe).call(this),J(this,W,le).call(this)}setTitle(t){var o;if(!t)return;(o=this.titleElement)!=null||(this.titleElement=document.createElement("div"));const a=this.titleElement;a.className="litemenu-title",a.innerHTML=t,this.root.parentElement||this.root.appendChild(a)}addItems(t){for(let o=0;o<t.length;o++){let a=t[o];typeof a!="string"&&(a=a&&a.content!==void 0?String(a.content):String(a));let r=t[o];this.menu_elements.push(this.addItem(a,r,this.options))}}addItem(t,o,a={}){var r;const l=document.createElement("div");l.className="litemenu-entry submenu";let p=!1;o===null?l.classList.add("separator"):(l.innerHTML=(r=o==null?void 0:o.title)!=null?r:t,l.value=o,o&&(o.disabled&&(p=!0,l.classList.add("disabled")),(o.submenu||o.has_submenu)&&l.classList.add("has_submenu")),typeof o=="function"?(l.dataset.value=t,l.onclick_callback=o):l.dataset.value=o,o.className&&(l.className+=" "+o.className)),this.root.appendChild(l),p||l.addEventListener("click",c),!p&&a.autoopen&&l.addEventListener("pointerenter",u=>{const d=this.value;!d||!d.has_submenu||c.call(this,u)});var h=this;function c(u){var d,f,L,_,g;const m=this.value;let b=!0;if((d=LiteGraph.debug)==null||d.call(LiteGraph,"ContextMenu handleMenuItemClick",m,a,b,this.current_submenu,this),(f=h.current_submenu)==null||f.close(u),a.callback&&((L=LiteGraph.debug)==null||L.call(LiteGraph,"ContextMenu handleMenuItemClick callback",this,m,a,u,h,a.node),a.callback.call(this,m,a,u,h,a.node)===!0&&(b=!1)),m&&(m.callback&&!a.ignore_item_callbacks&&m.disabled!==!0&&((_=LiteGraph.debug)==null||_.call(LiteGraph,"ContextMenu using value callback and !ignore_item_callbacks",this,m,a,u,h,a.node),m.callback.call(this,m,a,u,h,a.extra)===!0&&(b=!1)),m.submenu)){if((g=LiteGraph.debug)==null||g.call(LiteGraph,"ContextMenu SUBMENU",this,m,m.submenu.options,e,h,a),!m.submenu.options)throw new Error("ContextMenu submenu needs options");new h.constructor(m.submenu.options,{callback:m.submenu.callback,event:u,parentMenu:h,ignore_item_callbacks:m.submenu.ignore_item_callbacks,title:m.submenu.title,extra:m.submenu.extra,autoopen:a.autoopen}),b=!1}b&&!h.lock&&h.close()}return l}close(t,o){var a,r;if(this.root.f_textfilter){const l=this._filterDoc||((a=t==null?void 0:t.target)==null?void 0:a.ownerDocument)||document;l.removeEventListener("keydown",this.root.f_textfilter,!0),l.removeEventListener("keydown",this.root.f_textfilter,!1),this._filterDoc=null}this.parentMenu&&!o&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,t===void 0?this.parentMenu.close():t&&!ge.isCursorOverElement(t,this.parentMenu.root)&&ge.trigger(this.parentMenu.root,"pointerleave",t)),(r=this.current_submenu)==null||r.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer),this.root.parentNode&&this.root.parentNode.removeChild(this.root)}static trigger(t,o,a,r){const l=new CustomEvent(o,{bubbles:!0,cancelable:!0,detail:a});return r&&Object.defineProperty(l,"litegraphTarget",{value:r}),t.dispatchEvent?t.dispatchEvent(l):t.__events&&t.__events.dispatchEvent(l),l}getTopMenu(){var t,o;return(o=(t=this.options.parentMenu)==null?void 0:t.getTopMenu())!=null?o:this}getFirstEvent(){var t,o;return(o=(t=this.options.parentMenu)==null?void 0:t.getFirstEvent())!=null?o:this.options.event}static isCursorOverElement(t,o){return LiteGraph.isInsideRectangle(t.clientX,t.clientY,o.left,o.top,o.width,o.height)}};W=new WeakSet,se=function(){const n=this.root=document.createElement("div");return this.options.className&&(n.className=this.options.className),n.classList.add("litegraph","litecontextmenu","litemenubar-panel"),n.style.minWidth="80px",n.style.minHeight="10px",n},re=function(){const n=this.root;n.style.pointerEvents="none",setTimeout(()=>{n.style.pointerEvents="auto"},100),n.addEventListener("pointerup",t=>(t.preventDefault(),!0)),n.addEventListener("contextmenu",t=>(t.button!=2||t.preventDefault(),!1)),n.addEventListener("pointerdown",t=>{if(t.button==2)return this.close(),t.preventDefault(),!0}),n.addEventListener("wheel",t=>{var o=parseInt(n.style.top);return n.style.top=(o+t.deltaY*this.options.scroll_speed).toFixed()+"px",t.preventDefault(),!0}),n.addEventListener("pointerenter",t=>{n.closing_timer&&clearTimeout(n.closing_timer)})},ne=function(){var n;const t=this.options.parentMenu;if(t){if(t.constructor!==this.constructor){(n=LiteGraph.error)==null||n.call(LiteGraph,"parentMenu must be of class ContextMenu, ignoring it"),this.options.parentMenu=null;return}this.parentMenu=t,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this}},ae=function(){var n;if(!this.options.event)return;const t=this.options.event.constructor.name;t!=="MouseEvent"&&t!=="CustomEvent"&&t!=="PointerEvent"&&((n=LiteGraph.error)==null||n.call(LiteGraph,`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${t})`),this.options.event=null)},oe=function(){var n,t,o,a;const r=(t=(n=this.options.event)==null?void 0:n.target.ownerDocument)!=null?t:document,l=(o=r.fullscreenElement)!=null?o:r.body,p=this.root,h=this;LiteGraph.context_menu_filter_enabled&&!this.options.parentMenu&&(r?(p.f_textfilter&&(r.removeEventListener("keydown",p.f_textfilter,!1),r.removeEventListener("keydown",p.f_textfilter,!0),p.f_textfilter=!1),p.f_textfilter=function(c){var u,d,f,L,_,g,m;if(h.current_submenu){(u=LiteGraph.debug)==null||u.call(LiteGraph,"Prevent filtering on ParentMenu",h);return}if(h.allOptions||(h.allOptions=h.menu_elements,h.selectedOption=!1),h.currentOptions||(h.currentOptions=h.allOptions),h.filteringText||(h.filteringText=""),c.key){var b=!1;switch(c.key){case"Backspace":h.filteringText.length&&(h.filteringText=h.filteringText.substring(0,h.filteringText.length-1),b=!0);break;case"Escape":p.f_textfilter&&(r.removeEventListener("keydown",p.f_textfilter,!1),r.removeEventListener("keydown",p.f_textfilter,!0),p.f_textfilter=!1),h.close();break;case"ArrowDown":do h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption+1,0),h.allOptions.length-1):0;while(h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.selectedOption<h.allOptions.length-1);h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&(h.selectedOption=h.currentOptions[h.currentOptions.length-1].menu_index),b=!0;break;case"ArrowUp":do h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption-1,0),h.allOptions.length-1):0;while(h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.selectedOption>0);h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&(h.currentOptions&&h.currentOptions.length?h.selectedOption=h.currentOptions[0].menu_index:h.selectedOption=!1),b=!0;break;case"ArrowLeft":break;case"ArrowRight":case"Enter":if(h.selectedOption!==!1)h.allOptions[h.selectedOption]?((d=LiteGraph.debug)==null||d.call(LiteGraph,"ContextElement simCLICK",h.allOptions[h.selectedOption]),h.allOptions[h.selectedOption].do_click&&h.allOptions[h.selectedOption].do_click(h.options.event,C)):((f=LiteGraph.debug)==null||f.call(LiteGraph,"ContextElement selection wrong",h.selectedOption),h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption,0),h.allOptions.length-1):0);else if(h.filteringText.length){for(let G in h.allOptions)if(h.allOptions[G].style.display!=="none"&&!(h.allOptions[G].classList+"").includes("separator")&&h.allOptions[G].textContent!=="Search"){(L=LiteGraph.debug)==null||L.call(LiteGraph,"ContextElement simCLICK",h.allOptions[G]),p.f_textfilter&&r&&(r.removeEventListener("keydown",p.f_textfilter,!1),r.removeEventListener("keydown",p.f_textfilter,!0),(_=LiteGraph.debug)==null||_.call(LiteGraph,"Cleaned ParentContextMenu listener",r,h));var C=!1;h.allOptions[G].do_click(c,C);break}}b=!0;break;default:(g=LiteGraph.debug)==null||g.call(LiteGraph,"ContextMenu filter: keyEvent",c.key);break}!b&&c.key.length==1&&(h.filteringText+=c.key,h.parentMenu)}if(h.filteringText&&h.filteringText!==""){var T=[];h.currentOptions=[];for(let G in h.allOptions){var E=h.allOptions[G].textContent,N=E.toLocaleLowerCase().includes(h.filteringText.toLocaleLowerCase()),A=E.toLocaleLowerCase().startsWith(h.filteringText.toLocaleLowerCase()),M=E.split("/"),I=!1;I=M.length>1&&M[M.length-1].toLocaleLowerCase().startsWith(h.filteringText.toLocaleLowerCase())||M.length==1&&A;var O=(h.allOptions[G].classList+"").includes("separator")||E==="Search";h.allOptions[G].menu_index=G,N&&!O?(T.push(h.allOptions[G]),h.allOptions[G].style.display="block",h.allOptions[G].hidden=!1,h.currentOptions.push(h.allOptions[G]),h.allOptions[G].filtered_index=h.currentOptions.length-1):(h.allOptions[G].hidden=!0,h.allOptions[G].style.display="none",h.allOptions[G].filtered_index=!1),I?h.allOptions[G].style.fontWeight="bold":A&&(h.allOptions[G].style.fontStyle="italic")}h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption,0),h.allOptions.length-1):0,h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.currentOptions.length&&(h.selectedOption=h.currentOptions[0].menu_index)}else{T=h.allOptions,h.currentOptions=h.allOptions;for(let G in h.allOptions)h.allOptions[G].style.display="block",h.allOptions[G].style.fontStyle="inherit",h.allOptions[G].style.fontWeight="inherit",h.allOptions[G].hidden=!1,h.allOptions[G].filtered_index=!1,h.allOptions[G].menu_index=G}var S=h.selectedOption!==!1;if(S){(m=LiteGraph.debug)==null||m.call(LiteGraph,"ContextMenu selection: ",h.selectedOption);for(let G in h.allOptions){var k=h.selectedOption+""==G+"";k?h.allOptions[G].classList.add("selected"):h.allOptions[G].classList.remove("selected")}}document.body.getBoundingClientRect(),p.getBoundingClientRect(),p.style.top=h.top_original+"px"},r.removeEventListener("keydown",p.f_textfilter,!0),r.addEventListener("keydown",p.f_textfilter,!0),this._filterDoc=r):(a=LiteGraph.warn)==null||a.call(LiteGraph,"NO root document to add context menu and event",r,options)),l.appendChild(this.root)},le=function(){var n;const t=this.options,o=this.root;let a=t.left||0,r=t.top||0;if(this.top_original=r,t.event){if(a=t.event.clientX-10,r=t.event.clientY-10,t.title&&(r-=20),this.top_original=r,t.parentMenu){const h=t.parentMenu.root.getBoundingClientRect();a=h.left+h.width}const l=document.body.getBoundingClientRect(),p=o.getBoundingClientRect();l.height===0&&((n=LiteGraph.error)==null||n.call(LiteGraph,"document.body height is 0. That is dangerous, set html,body { height: 100%; }")),l.width&&a>l.width-p.width-10&&(a=l.width-p.width-10),l.height&&r>l.height-p.height-10&&(r=l.height-p.height-10)}o.style.left=`${a}px`,o.style.top=`${r}px`,t.scale&&(o.style.transform=`scale(${t.scale})`)},B(Z,"closeAll",(n=window)=>{const t=n.document.querySelectorAll(".litecontextmenu");t.length&&t.forEach(o=>{var a;o.close?o.close():(a=o.parentNode)==null||a.removeChild(o)})});let ContextMenu=Z;var LiteGraph=new class{constructor(){B(this,"extendClass",(n,t)=>{for(let o in t)n.hasOwnProperty(o)||(n[o]=t[o]);if(t.prototype)for(let o in t.prototype)t.prototype.hasOwnProperty(o)&&(n.prototype.hasOwnProperty(o)||(t.prototype.__lookupGetter__(o)?n.prototype.__defineGetter__(o,t.prototype.__lookupGetter__(o)):n.prototype[o]=t.prototype[o],t.prototype.__lookupSetter__(o)&&n.prototype.__defineSetter__(o,t.prototype.__lookupSetter__(o))))}),B(this,"getParameterNames",n=>(n+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)),B(this,"clamp",(n,t,o)=>t>n?t:o<n?o:n),B(this,"pointer_to_mouse_events",Object.freeze({pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mouseup",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"})),B(this,"mouse_to_pointer_events",Object.freeze({mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseenter:"pointerenter",mouseleave:"pointerleave"})),B(this,"pointerAddListener",(n,t,o,a)=>{if(!(n!=null&&n.addEventListener)||typeof o!="function")return!1;const r=this.resolvePointerEventName(t);return n.addEventListener(r,o,a),!0}),B(this,"pointerRemoveListener",(n,t,o,a)=>{if(!(n!=null&&n.removeEventListener)||typeof o!="function")return!1;const r=this.resolvePointerEventName(t);return n.removeEventListener(r,o,a),!0}),B(this,"closeAllContextMenus",()=>{LiteGraph.warn("LiteGraph.closeAllContextMenus is deprecated in favor of ContextMenu.closeAll()"),ContextMenu.closeAll()}),this.VERSION="0.10.2",this.LLink=LLink,this.LGraph=LGraph,this.LGraphNode=LGraphNode,setupLGraphNodeDelegates(this),this.LGraphGroup=LGraphGroup,this.LGraphCanvas=LGraphCanvas,this.DragAndScale=DragAndScale,this.ContextMenu=ContextMenu,this.CANVAS_GRID_SIZE=10,this.NODE_TITLE_HEIGHT=30,this.NODE_TITLE_TEXT_Y=20,this.NODE_SLOT_HEIGHT=20,this.NODE_WIDGET_HEIGHT=20,this.NODE_WIDTH=140,this.NODE_MIN_WIDTH=50,this.NODE_COLLAPSED_RADIUS=10,this.NODE_COLLAPSED_WIDTH=80,this.NODE_TITLE_COLOR="#999",this.NODE_SELECTED_TITLE_COLOR="#FFF",this.NODE_TEXT_SIZE=14,this.NODE_TEXT_COLOR="#AAA",this.NODE_SUBTEXT_SIZE=12,this.NODE_DEFAULT_COLOR="#333",this.NODE_DEFAULT_BGCOLOR="#353535",this.NODE_DEFAULT_BOXCOLOR="#666",this.NODE_DEFAULT_SHAPE="box",this.NODE_BOX_OUTLINE_COLOR="#FFF",this.DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)",this.DEFAULT_GROUP_FONT=24,this.WIDGET_BGCOLOR="#222",this.WIDGET_OUTLINE_COLOR="#666",this.WIDGET_TEXT_COLOR="#DDD",this.WIDGET_SECONDARY_TEXT_COLOR="#999",this.LINK_COLOR="#9A9",this.EVENT_LINK_COLOR="#A86",this.CONNECTING_LINK_COLOR="#AFA",this.MAX_NUMBER_OF_NODES=1e3,this.DEFAULT_POSITION=[100,100],this.VALID_SHAPES=["default","box","round","card"],this.BOX_SHAPE=1,this.ROUND_SHAPE=2,this.CIRCLE_SHAPE=3,this.CARD_SHAPE=4,this.ARROW_SHAPE=5,this.GRID_SHAPE=6,this.INPUT=1,this.OUTPUT=2,this.EVENT=-1,this.ACTION=-1,this.NODE_MODES=["Always","On Event","Never","On Trigger","On Request"],this.NODE_MODES_COLORS=["#666","#422","#333","#224","#626"],this.ALWAYS=0,this.ON_EVENT=1,this.NEVER=2,this.ON_TRIGGER=3,this.ON_REQUEST=4,this.UP=1,this.DOWN=2,this.LEFT=3,this.RIGHT=4,this.CENTER=5,this.LINK_RENDER_MODES=["Straight","Linear","Spline"],this.STRAIGHT_LINK=0,this.LINEAR_LINK=1,this.SPLINE_LINK=2,this.NORMAL_TITLE=0,this.NO_TITLE=1,this.TRANSPARENT_TITLE=2,this.AUTOHIDE_TITLE=3,this.VERTICAL_LAYOUT="vertical",this.proxy=null,this.node_images_path="",this.catch_exceptions=!0,this.throw_errors=!0,this.allow_scripts=!1,this.use_deferred_actions=!0,this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.Globals={},this.searchbox_extras={},this.auto_sort_node_types=!1,this.node_box_coloured_when_on=!1,this.node_box_coloured_by_mode=!1,this.dialog_close_on_mouse_leave=!0,this.dialog_close_on_mouse_leave_delay=500,this.shift_click_do_break_link_from=!1,this.click_do_break_link_to=!1,this.search_hide_on_mouse_leave=!0,this.search_filter_enabled=!1,this.search_show_all_on_open=!0,this.applyPointerDefaults(),this.show_node_tooltip=!1,this.show_node_tooltip_use_descr_property=!1,this.auto_load_slot_types=!1,this.registered_slot_in_types={},this.registered_slot_out_types={},this.slot_types_in=[],this.slot_types_out=[],this.slot_types_default_in=[],this.slot_types_default_out=[],this.graphDefaultConfig={align_to_grid:!0,links_ontop:!1},this.alt_drag_do_clone_nodes=!1,this.alt_shift_drag_connect_clone_with_input=!0,this.do_add_triggers_slots=!1,this.allow_multi_output_for_events=!0,this.middle_click_slot_add_default_node=!1,this.release_link_on_empty_shows_menu=!1,this.two_fingers_opens_menu=!1,this.backspace_delete=!0,this.ctrl_shift_v_paste_connect_unselected_outputs=!1,this.actionHistory_enabled=!1,this.actionHistoryMaxSave=40,this.refreshAncestorsOnTriggers=!1,this.refreshAncestorsOnActions=!1,this.ensureUniqueExecutionAndActionCall=!1,this.use_uuids=!1,this.context_menu_filter_enabled=!1,this.showCanvasOptions=!1,this.availableCanvasOptions=["allow_addOutSlot_onExecuted","free_resize","highquality_render","use_gradients","pause_rendering","clear_background","read_only","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","move_destination_link_without_shift","set_canvas_dirty_on_mouse_event","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip"],this.actionHistoryMaxSave=40,this.canRemoveSlots=!0,this.canRemoveSlots_onlyOptional=!0,this.canRenameSlots=!0,this.canRenameSlots_onlyOptional=!0,this.ensureNodeSingleExecution=!1,this.ensureNodeSingleAction=!1,this.preventAncestorRecalculation=!1,this.ensureUniqueExecutionAndActionCall=!0,this.allowMultiOutputForEvents=!1,this.log_methods=["error","warn","info","log","debug"],this.logging_set_level(2)}logging_set_level(n){this.debug_level=Number(n)}logging(n){if(n>this.debug_level)return;function t(a){let r=[];for(let l=1;l<a.length;l++)typeof a[l]!="undefined"&&r.push(a[l]);return r}let o="debug";if(n>=0&&n<=4&&(o=["error","warn","info","log","debug"][n]),typeof console[o]!="function")throw console.warn("[LG-log] invalid console method",o,t(arguments)),new RangeError;console[o]("[LG]",...t(arguments))}error(){this.logging(0,...arguments)}warn(){this.logging(1,...arguments)}info(){this.logging(2,...arguments)}log(){this.logging(3,...arguments)}debug(){this.logging(4,...arguments)}registerNodeType(n,t){var o,a,r,l,p,h,c;if(!t.prototype)throw new Error("Cannot register a simple object, it must be a class with a prototype");t.type=n,(o=this.debug)==null||o.call(this,"registerNodeType","start",n);const u=t.name,d=n.lastIndexOf("/");t.category=n.substring(0,d),t.title||(t.title=u);const f=Object.getOwnPropertyDescriptors(LGraphNode.prototype);Object.keys(f).forEach(m=>{t.prototype.hasOwnProperty(m)||Object.defineProperty(t.prototype,m,f[m])});const L=this.registered_node_types[n];if(L&&((a=this.debug)==null||a.call(this,"registerNodeType","replacing node type",n,L)),!Object.prototype.hasOwnProperty.call(t.prototype,"shape")&&(Object.defineProperty(t.prototype,"shape",{set:function(m){switch(m){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=m}},get:function(){return this._shape},enumerable:!0,configurable:!0}),t.supported_extensions))for(let m in t.supported_extensions){const b=t.supported_extensions[m];b&&b.constructor===String&&(this.node_types_by_file_extension[b.toLowerCase()]=t)}if(this.registered_node_types[n]=t,t.constructor.name&&(this.Nodes[u]=t),(r=LiteGraph.onNodeTypeRegistered)==null||r.call(LiteGraph,n,t),L&&((l=LiteGraph.onNodeTypeReplaced)==null||l.call(LiteGraph,n,t,L)),t.prototype.onPropertyChange&&LiteGraph.warn("LiteGraph node class "+n+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),t.supported_extensions)for(var _=0;_<t.supported_extensions.length;_++){var g=t.supported_extensions[_];g&&g.constructor===String&&(this.node_types_by_file_extension[g.toLowerCase()]=t)}(p=this.debug)==null||p.call(this,"registerNodeType","type registered",n),this.auto_load_slot_types&&((h=this.debug)==null||h.call(this,"registerNodeType","do auto_load_slot_types",n)),new t((c=t.title)!=null?c:"tmpnode")}unregisterNodeType(n){const t=n.constructor===String?this.registered_node_types[n]:n;if(!t)throw new Error("node type not found: "+n);delete this.registered_node_types[t.type],t.constructor.name&&delete this.Nodes[t.constructor.name]}registerNodeAndSlotType(n,t,o=!1){const a=(n.constructor===String&&this.registered_node_types[n]!=="anonymous"?this.registered_node_types[n]:n).constructor.type;let r=[];typeof t=="string"?r=t.split(","):t==this.EVENT||t==this.ACTION?r=["_event_"]:r=["*"];for(let l=0;l<r.length;++l){let p=r[l];p===""&&(p="*");const h=o?"registered_slot_out_types":"registered_slot_in_types";this[h][p]===void 0&&(this[h][p]={nodes:[]}),this[h][p].nodes.includes(a)||this[h][p].nodes.push(a),o?this.slot_types_out.includes(p.toLowerCase())||(this.slot_types_out.push(p.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(p.toLowerCase())||(this.slot_types_in.push(p.toLowerCase()),this.slot_types_in.sort())}}buildNodeClassFromObject(n,t){var o="";if(t.inputs)for(let r=0;r<t.inputs.length;++r){let l=t.inputs[r][0],p=t.inputs[r][1];p&&p.constructor===String&&(p='"'+p+'"'),o+="this.addInput('"+l+"',"+p+`);
`}if(t.outputs)for(let r=0;r<t.outputs.length;++r){let l=t.outputs[r][0],p=t.outputs[r][1];p&&p.constructor===String&&(p='"'+p+'"'),o+="this.addOutput('"+l+"',"+p+`);
`}if(t.properties)for(let r in t.properties){let l=t.properties[r];l&&l.constructor===String&&(l='"'+l+'"'),o+="this.addProperty('"+r+"',"+l+`);
`}o+="if(this.onCreate)this.onCreate()";var a=Function(o);for(let r in t)r!="inputs"&&r!="outputs"&&r!="properties"&&(a.prototype[r]=t[r]);return a.title=t.title||n.split("/").pop(),a.desc=t.desc||"Generated from object",this.registerNodeType(n,a),a}wrapFunctionAsNode(n,t,o,a,r){const l=LiteGraph.getParameterNames(t),p=l.map((d,f)=>{const L=o!=null&&o[f]?`'${o[f]}'`:"0";return`this.addInput('${d}', ${L});`}).join(`
`),h=a?`'${a}'`:0,c=r?`this.properties = ${JSON.stringify(r)};`:"",u=new Function(`
            ${p}
            this.addOutput('out', ${h});
            ${c}
        `);return u.title=n.split("/").pop(),u.desc=`Generated from ${t.name}`,u.prototype.onExecute=function(){const d=l.map((L,_)=>this.getInputData(_)),f=t.apply(this,d);this.setOutputData(0,f)},this.registerNodeType(n,u),u}clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}}addNodeMethod(n,t){LGraphNode.prototype[n]=t;for(var o in this.registered_node_types){var a=this.registered_node_types[o];a.prototype[n]&&(a.prototype["_"+n]=a.prototype[n]),a.prototype[n]=t}}createNode(n,t,o={}){var a,r,l,p,h,c,u,d,f,L,_,g;const m=(a=this.registered_node_types[n])!=null?a:null;if(!m)return(r=this.log)==null||r.call(this,`GraphNode type "${n}" not registered.`),null;t=(l=t!=null?t:m.title)!=null?l:n;let b=null;if(LiteGraph.catch_exceptions)try{b=new m(t)}catch(C){return(p=this.error)==null||p.call(this,C),null}else b=new m(t);return b.type=n,(h=b.title)!=null||(b.title=t),(c=b.properties)!=null||(b.properties={}),(u=b.properties_info)!=null||(b.properties_info=[]),(d=b.flags)!=null||(b.flags={}),(f=b.size)!=null||(b.size=b.computeSize()),(L=b.pos)!=null||(b.pos=LiteGraph.DEFAULT_POSITION.concat()),(_=b.mode)!=null||(b.mode=LiteGraph.ALWAYS),Object.assign(b,o),(g=b.onNodeCreated)==null||g.call(b),b}getNodeType(n){return this.registered_node_types[n]}getNodeTypesInCategory(n,t){const o=Object.values(this.registered_node_types).filter(a=>a.filter!==t?!1:n===""?a.category===null:a.category===n);return this.auto_sort_node_types&&o.sort((a,r)=>a.title.localeCompare(r.title)),o}getNodeTypesCategories(n){const t={"":1};Object.values(this.registered_node_types).forEach(a=>{a.category&&!a.skip_list&&a.filter===n&&(t[a.category]=1)});const o=Object.keys(t);return this.auto_sort_node_types?o.sort():o}reloadNodes(n){var t,o,a,r=document.getElementsByTagName("script"),l=[];for(let u=0;u<r.length;u++)l.push(r[u]);var p=document.getElementsByTagName("head")[0];n=document.location.href+n;for(let u=0;u<l.length;u++){var h=l[u].src;if(!(!h||h.substr(0,n.length)!=n))try{(t=this.log)==null||t.call(this,"Reloading: "+h);var c=document.createElement("script");c.type="text/javascript",c.src=h,p.appendChild(c),p.removeChild(l[u])}catch(d){if(LiteGraph.throw_errors)throw d;(o=this.log)==null||o.call(this,"Error while reloading "+h)}}(a=this.log)==null||a.call(this,"Nodes reloaded")}cloneObject(n,t){if(n==null)return null;const o=JSON.parse(JSON.stringify(n));if(!t)return o;for(const a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);return t}uuidv4(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,n=>(n^Math.random()*16>>n/4).toString(16))}isValidConnection(n,t){if((n===""||n==="*")&&(n=0),(t===""||t==="*")&&(t=0),!n||!t||n===t||n===LiteGraph.EVENT&&t===LiteGraph.ACTION)return!0;if(n=String(n).toLowerCase(),t=String(t).toLowerCase(),!n.includes(",")&&!t.includes(","))return n===t;const o=n.split(","),a=t.split(",");for(const r of o)for(const l of a)if(this.isValidConnection(r,l))return!0;return!1}registerSearchboxExtra(n,t,o){this.searchbox_extras[t.toLowerCase()]={type:n,desc:t,data:o}}fetchFile(n,t,o,a){if(!n)return null;if(t=t||"text",n.constructor===String)return n.substr(0,4)=="http"&&LiteGraph.proxy&&(n=LiteGraph.proxy+n.substr(n.indexOf(":")+3)),fetch(n).then(l=>{if(!l.ok)throw new Error("File not found");if(t=="arraybuffer")return l.arrayBuffer();if(t=="text"||t=="string")return l.text();if(t=="json")return l.json();if(t=="blob")return l.blob()}).then(l=>{o&&o(l)}).catch(l=>{var p;(p=this.error)==null||p.call(this,"error fetching file:",n),a&&a(l)});if(n.constructor===File||n.constructor===Blob){var r=new FileReader;if(r.onload=l=>{var p=l.target.result;t=="json"&&(p=JSON.parse(p)),o&&o(p)},t=="arraybuffer")return r.readAsArrayBuffer(n);if(t=="text"||t=="json")return r.readAsText(n);if(t=="blob")return r.readAsBinaryString(n)}return null}applyPointerDefaults(){typeof window=="undefined"||typeof window.matchMedia!="function"||window.matchMedia("(pointer: coarse)").matches&&(this.dialog_close_on_mouse_leave=!1,this.search_hide_on_mouse_leave=!1)}compareObjects(n,t){const o=Object.keys(n);return o.length!==Object.keys(t).length?!1:o.every(a=>n[a]===t[a])}distance(n,t){const[o,a]=n,[r,l]=t;return Math.sqrt((r-o)**2+(l-a)**2)}colorToString(n){return"rgba("+Math.round(n[0]*255).toFixed()+","+Math.round(n[1]*255).toFixed()+","+Math.round(n[2]*255).toFixed()+","+(n.length==4?n[3].toFixed(2):"1.0")+")"}canvasFillTextMultiline(n,t,o,a,r,l){var p=(t+"").trim().split(" "),h="",c={lines:[],maxW:0,height:0};if(p.length>1)for(var u=0;u<p.length;u++){var d=h+p[u]+" ",f=n.measureText(d),L=f.width;L>r&&u>0?(n.fillText(h,o,a+l*c.lines.length),h=p[u]+" ",c.max=L,c.lines.push(h)):h=d}else h=p[0];return n.fillText(h,o,a+l*c.lines.length),c.lines.push(h),c.height=l*c.lines.length||l,c}isInsideRectangle(n,t,o,a,r,l){return n>o&&n<o+r&&t>a&&t<a+l}growBounding(n,t,o){t<n[0]?n[0]=t:t>n[2]&&(n[2]=t),o<n[1]?n[1]=o:o>n[3]&&(n[3]=o)}isInsideBounding(n,t){return n[0]>=t[0][0]&&n[1]>=t[0][1]&&n[0]<=t[1][0]&&n[1]<=t[1][1]}overlapBounding(n,t){const o=n[0]+n[2],a=n[1]+n[3],r=t[0]+t[2],l=t[1]+t[3];return!(n[0]>r||n[1]>l||o<t[0]||a<t[1])}hex2num(n){n.charAt(0)=="#"&&(n=n.slice(1)),n=n.toUpperCase();for(var t="0123456789ABCDEF",o=new Array(3),a=0,r,l,p=0;p<6;p+=2)r=t.indexOf(n.charAt(p)),l=t.indexOf(n.charAt(p+1)),o[a]=r*16+l,a++;return o}num2hex(n){for(var t="0123456789ABCDEF",o="#",a,r,l=0;l<3;l++)a=n[l]/16,r=n[l]%16,o+=t.charAt(a)+t.charAt(r);return o}resolvePointerEventName(n){if(typeof n!="string")return n;const t=n.toLowerCase(),o=this.pointerevents_method;return o==="mouse"?this.pointer_to_mouse_events[t]||t:o==="pointer"&&this.mouse_to_pointer_events[t]||t}set pointerevents_method(n){const t=typeof n=="string"?n.toLowerCase():"";if(t==="mouse"||t==="pointer"){this._pointerevents_method=t;return}this._pointerevents_method="pointer"}get pointerevents_method(){return this._pointerevents_method||"pointer"}};typeof performance!="undefined"?LiteGraph.getTime=performance.now.bind(performance):typeof Date!="undefined"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process!="undefined"?LiteGraph.getTime=()=>{var n=process.hrtime();return n[0]*.001+n[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()},typeof window!="undefined"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||(n=>{window.setTimeout(n,1e3/60)}));export{ContextMenu,DragAndScale,LGraph,LGraphCanvas,LGraphGroup,LGraphNode,LLink,LiteGraph};
