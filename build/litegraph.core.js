var le=Object.defineProperty,ee=n=>{throw TypeError(n)},he=(n,o,s)=>o in n?le(n,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[o]=s,X=(n,o,s)=>he(n,typeof o!="symbol"?o+"":o,s),ue=(n,o,s)=>o.has(n)||ee("Cannot "+s),te=(n,o,s)=>o.has(n)?ee("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(n):o.set(n,s),K=(n,o,s)=>(ue(n,o,"access private method"),s);class LLink{constructor(o,s,a,r,l,h){this.id=o,this.type=s,this.origin_id=a,this.origin_slot=r,this.target_id=l,this.target_slot=h,this._data=null,this._pos=new Float32Array(2)}configure(o){o.constructor===Array?(this.id=o[0],this.origin_id=o[1],this.origin_slot=o[2],this.target_id=o[3],this.target_slot=o[4],this.type=o[5]):(this.id=o.id,this.type=o.type,this.origin_id=o.origin_id,this.origin_slot=o.origin_slot,this.target_id=o.target_id,this.target_slot=o.target_slot)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}}function initializeGraphState(n){n.last_node_id=0,n.last_link_id=0,n._version=-1,n._nodes=[],n._nodes_by_id={},n._nodes_in_order=[],n._nodes_executable=null,n._groups=[],n.links={},n.iteration=0,n.config={},n.vars={},n.extra={},n.globaltime=0,n.runningtime=0,n.fixedtime=0,n.fixedtime_lapse=.01,n.elapsed_time=.01,n.last_update_time=0,n.starttime=0,n.catch_errors=!0,n.history={actionHistory:[],actionHistoryVersions:[],actionHistoryPtr:0},n.nodes_executing=[],n.nodes_actioning=[],n.node_ancestorsCalculated=[],n.nodes_executedAction=[],n._configuring=!1,n.inputs={},n.outputs={}}function mergeOptions(n,o){return Object.assign({},n,o)}let LiteGraph$o=null;function setLifecycleMethodsLiteGraph(n){LiteGraph$o=n}const lifecycleMethods={getSupportedTypes(){var n;return(n=this.supported_types)!=null?n:this.constructor.supported_types},clear(){var n;this.stop(),this.status=this.constructor.STATUS_STOPPED,(n=this._nodes)==null||n.forEach(o=>{var s;(s=o.onRemoved)==null||s.call(o)}),initializeGraphState(this),this.configApplyDefaults(),this.change(),this.sendActionToCanvas("clear")},configApply(n){this.config=mergeOptions(this.config,n)},configApplyDefaults(){var n=LiteGraph$o.graphDefaultConfig;this.configApply(n)}};let LiteGraph$n=null;function setCanvasBindingMethodsLiteGraph(n){LiteGraph$n=n}const canvasBindingMethods={attachCanvas(n){var o;if(!n instanceof LiteGraph$n.LGraphCanvas)throw new Error("attachCanvas expects a LiteGraph.LGraphCanvas instance");n.graph&&n.graph!=this&&n.graph.detachCanvas(n),n.graph=this,(o=this.list_of_graphcanvas)!=null||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(n)},detachCanvas(n){if(this.list_of_graphcanvas){var o=this.list_of_graphcanvas.indexOf(n);o!=-1&&(n.graph=null,this.list_of_graphcanvas.splice(o,1))}},sendActionToCanvas(n,o){if(this.list_of_graphcanvas)for(const s of this.list_of_graphcanvas)s[n]&&o&&s[n](...o)},change(){var n,o;(n=LiteGraph$n.log)==null||n.call(LiteGraph$n,"Graph visually changed"),this.sendActionToCanvas("setDirty",[!0,!0]),(o=this.on_change)==null||o.call(this,this)},setDirtyCanvas(n,o){this.sendActionToCanvas("setDirty",[n,o])},isLive(){if(!this.list_of_graphcanvas)return!1;for(var n=0;n<this.list_of_graphcanvas.length;++n){var o=this.list_of_graphcanvas[n];if(o.live_mode)return!0}return!1}};let LiteGraph$m=null;function setRuntimeLoopMethodsLiteGraph(n){LiteGraph$m=n}const runtimeLoopMethods={start(n=0){var o;if(this.status===this.constructor.STATUS_RUNNING)return;this.status=this.constructor.STATUS_RUNNING,(o=this.onPlayEvent)==null||o.call(this),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph$m.getTime(),this.last_update_time=this.starttime;const s=()=>{var a,r;this.execution_timer_id===-1&&(window.requestAnimationFrame(s),(a=this.onBeforeStep)==null||a.call(this),this.runStep(1,!this.catch_errors),(r=this.onAfterStep)==null||r.call(this))};n===0&&typeof window=="object"&&window.requestAnimationFrame?(this.execution_timer_id=-1,s()):this.execution_timer_id=setInterval(()=>{var a,r;(a=this.onBeforeStep)==null||a.call(this),this.runStep(1,!this.catch_errors),(r=this.onAfterStep)==null||r.call(this)},n)},stop(){var n;this.status!=this.constructor.STATUS_STOPPED&&(this.status=this.constructor.STATUS_STOPPED,(n=this.onStopEvent)==null||n.call(this),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},runStep(n=1,o,s){var a,r,l,h,c,p,u=LiteGraph$m.getTime();this.globaltime=.001*(u-this.starttime);var d=(a=this._nodes_executable)!=null?a:this._nodes;if(d){if(s||(s=d.length),o){for(let g=0;g<n;g++)d.forEach(_=>{var m,b;LiteGraph$m.use_deferred_actions&&(m=_._waiting_actions)!=null&&m.length&&_.executePendingActions(),_.mode===LiteGraph$m.ALWAYS&&((b=_.doExecute)==null||b.call(_))}),this.fixedtime+=this.fixedtime_lapse,(r=this.onExecuteStep)==null||r.call(this);(l=this.onAfterExecute)==null||l.call(this)}else try{for(let g=0;g<n;g++)d.forEach(_=>{var m,b;LiteGraph$m.use_deferred_actions&&(m=_._waiting_actions)!=null&&m.length&&_.executePendingActions(),_.mode===LiteGraph$m.ALWAYS&&((b=_.doExecute)==null||b.call(_))}),this.fixedtime+=this.fixedtime_lapse,(h=this.onExecuteStep)==null||h.call(this);(c=this.onAfterExecute)==null||c.call(this),this.errors_in_execution=!1}catch(g){if(this.errors_in_execution=!0,LiteGraph$m.throw_errors)throw g;(p=LiteGraph$m.log)==null||p.call(LiteGraph$m,`Error during execution: ${g}`),this.stop()}var f=LiteGraph$m.getTime(),L=f-u;L==0&&(L=1),this.execution_time=.001*L,this.globaltime+=.001*L,this.iteration+=1,this.elapsed_time=(f-this.last_update_time)*.001,this.last_update_time=f,this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[]}},getTime(){return this.globaltime},getFixedTime(){return this.fixedtime},getElapsedTime(){return this.elapsed_time},clearTriggeredSlots(){for(var n in this.links){var o=this.links[n];o&&o._last_time&&(o._last_time=0)}}};let LiteGraph$l=null;function setExecutionOrderMethodsLiteGraph(n){LiteGraph$l=n}const executionOrderMethods={updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var n=0;n<this._nodes_in_order.length;++n)this._nodes_in_order[n].onExecute&&this._nodes_executable.push(this._nodes_in_order[n])},computeExecutionOrder(n,o){var s,a=[],r=[],l={},h={},c={};for(let g=0,_=this._nodes.length;g<_;++g){let m=this._nodes[g];if(!(n&&!m.onExecute)){l[m.id]=m;var p=0;if(m.inputs)for(var u=0,d=m.inputs.length;u<d;u++)m.inputs[u]&&m.inputs[u].link!=null&&(p+=1);p==0?(r.push(m),o&&(m._level=1)):(o&&(m._level=0),c[m.id]=p)}}for(;r.length!=0;){var f=r.shift();if(a.push(f),delete l[f.id],!!f.outputs)for(let g=0;g<f.outputs.length;g++){let _=f.outputs[g];if(!(_==null||_.links==null||_.links.length==0))for(let m=0;m<_.links.length;m++){let b=_.links[m],G=this.links[b];if(!G||h[G.id])continue;let C=this.getNodeById(G.target_id);if(C==null){h[G.id]=!0;continue}o&&(!C._level||C._level<=f._level)&&(C._level=f._level+1),h[G.id]=!0,c[C.id]-=1,c[C.id]==0&&r.push(C)}}}for(let g in l)a.push(l[g]);a.length!=this._nodes.length&&LiteGraph$l.debug&&((s=LiteGraph$l.warn)==null||s.call(LiteGraph$l,"something went wrong, nodes missing"));var L=a.length;for(let g=0;g<L;++g)a[g].order=g;a=a.sort((g,_)=>{let m=g.constructor.priority||g.priority||0,b=_.constructor.priority||_.priority||0;return m==b?g.order-_.order:m-b});for(let g=0;g<L;++g)a[g].order=g;return a},getAncestors(n,o={}){for(var s={modesSkip:[],modesOnly:[],typesSkip:[],typesOnly:[]},a=Object.assign(s,o),r=[],l=[],h=[n],c={};h.length;){var p=h.shift();if(p&&!c[p.id]){if(c[p.id]=!0,p.id!=n.id){if(a.modesSkip&&a.modesSkip.length&&a.modesSkip.indexOf(p.mode)!=-1||a.modesOnly&&a.modesOnly.length&&a.modesOnly.indexOf(p.mode)==-1)continue;l.indexOf(p.id)==-1&&(r.push(p),l.push(p.id))}if(p.inputs)for(var u=0;u<p.inputs.length;++u){var d=p.getInputNode(u);if(d){var f=p.inputs[u].type;a.typesSkip&&a.typesSkip.length&&a.typesSkip.indexOf(f)!=-1||a.typesOnly&&a.typesOnly.length&&a.typesOnly.indexOf(d.mode)==-1||l.indexOf(d.id)==-1&&(c[d.id]||h.push(d))}}}}return r.sort((L,g)=>L.order-g.order),r},arrange(n=100,o){var s;const a=this.computeExecutionOrder(!1,!0),r=[];for(let h=0;h<a.length;++h){const c=a[h],p=c._level||1;(s=r[p])!=null||(r[p]=[]),r[p].push(c)}let l=n;for(let h=0;h<r.length;++h){const c=r[h];if(!c)continue;let p=100,u=n+LiteGraph$l.NODE_TITLE_HEIGHT;for(let d=0;d<c.length;++d){const f=c[d];f.pos[0]=o==LiteGraph$l.VERTICAL_LAYOUT?u:l,f.pos[1]=o==LiteGraph$l.VERTICAL_LAYOUT?l:u;const L=o==LiteGraph$l.VERTICAL_LAYOUT?1:0;f.size[L]>p&&(p=f.size[L]);const g=o==LiteGraph$l.VERTICAL_LAYOUT?0:1;u+=f.size[g]+n+LiteGraph$l.NODE_TITLE_HEIGHT}l+=p+n}this.setDirtyCanvas(!0,!0)}};let LiteGraph$k=null;function setNodeMutationMethodsLiteGraph(n){LiteGraph$k=n}const nodeMutationMethods={add(n,o,s={}){var a,r,l,h={doProcessChange:!0,doCalcSize:!0},c=Object.assign(h,s);if(n){if(n.constructor===LiteGraph$k.LGraphGroup){this._groups.push(n),this.setDirtyCanvas(!0),this.change(),n.graph=this,this.onGraphChanged({action:"groupAdd",doSave:c.doProcessChange});return}if(n.id!=-1&&this._nodes_by_id[n.id]!=null&&((a=LiteGraph$k.warn)==null||a.call(LiteGraph$k,"LiteGraph: there is already a node with this ID, changing it"),LiteGraph$k.use_uuids?n.id=LiteGraph$k.uuidv4():n.id=++this.last_node_id),this._nodes.length>=LiteGraph$k.MAX_NUMBER_OF_NODES)throw new Error("LiteGraph: max number of nodes in a graph reached");return LiteGraph$k.use_uuids?(n.id==null||n.id==-1)&&(n.id=LiteGraph$k.uuidv4()):n.id==null||n.id==-1?n.id=++this.last_node_id:this.last_node_id<n.id&&(this.last_node_id=n.id),n.graph=this,this.onGraphChanged({action:"nodeAdd",doSave:c.doProcessChange}),this._nodes.push(n),this._nodes_by_id[n.id]=n,(r=n.onAdded)==null||r.call(n,this),this.config.align_to_grid&&n.alignToGrid(),o||this.updateExecutionOrder(),(l=this.onNodeAdded)==null||l.call(this,n),c.doCalcSize&&n.setSize(n.computeSize()),this.setDirtyCanvas(!0),this.change(),n}},remove(n){var o,s;if(n.constructor===LiteGraph$k.LGraphGroup){var a=this._groups.indexOf(n);a!=-1&&this._groups.splice(a,1),n.graph=null,this.onGraphChanged({action:"groupRemove"}),this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[n.id]!=null&&!n.ignore_remove){if(n.inputs)for(let l=0;l<n.inputs.length;l++)n.inputs[l].link!=null&&n.disconnectInput(l,{doProcessChange:!1});if(n.outputs)for(let l=0;l<n.outputs.length;l++){let h=n.outputs[l];h.links!=null&&h.links.length&&n.disconnectOutput(l,!1,{doProcessChange:!1})}if((o=n.onRemoved)==null||o.call(n),n.graph=null,this.onGraphChanged({action:"nodeRemove"}),this.list_of_graphcanvas)for(let l=0;l<this.list_of_graphcanvas.length;++l){let h=this.list_of_graphcanvas[l];h.selected_nodes[n.id]&&delete h.selected_nodes[n.id],h.node_dragged==n&&(h.node_dragged=null)}var r=this._nodes.indexOf(n);r!=-1&&this._nodes.splice(r,1),delete this._nodes_by_id[n.id],(s=this.onNodeRemoved)==null||s.call(this,n),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},removeLink(n){var o=this.links[n];if(o){var s=this.getNodeById(o.target_id);s&&(this.beforeChange(),s.disconnectInput(o.target_slot),this.afterChange())}},checkNodeTypes(){for(var n,o=0;o<this._nodes.length;o++){var s=this._nodes[o],a=LiteGraph$k.registered_node_types[s.type];if(s.constructor!=a){LiteGraph$k.debug&&((n=LiteGraph$k.log)==null||n.call(LiteGraph$k,`node being replaced by newer version: ${s.type}`));var r=LiteGraph$k.createNode(s.type);this._nodes[o]=r,r.configure(s.serialize()),r.graph=this,this._nodes_by_id[r.id]=r,s.inputs&&(r.inputs=s.inputs.concat()),s.outputs&&(r.outputs=s.outputs.concat())}}this.updateExecutionOrder()}},nodeQueryMethods={getNodeById(n){return n==null?null:this._nodes_by_id[n]},findNodesByClass(n,o=[]){return o=this._nodes.filter(s=>s.constructor===n),o},findNodesByType(n,o=[]){const s=n.toLowerCase();return o=this._nodes.filter(a=>a.type.toLowerCase()===s),o},findNodeByTitle(n){var o;return(o=this._nodes.find(s=>s.title===n))!=null?o:null},findNodesByTitle(n){return this._nodes.filter(o=>o.title===n)},getNodeOnPos(n,o,s=this._nodes,a=0){var r;return(r=s.reverse().find(l=>l.isPointInside(n,o,a)))!=null?r:null},getGroupOnPos(n,o){var s;return(s=this._groups.find(a=>a.isPointInside(n,o,2,!0)))!=null?s:null}};let LiteGraph$j=null;function setGraphPortsMethodsLiteGraph(n){LiteGraph$j=n}const graphPortsMethods={addInput(n,o,s){var a,r,l=this.inputs[n];l||(this.beforeChange(),this.inputs[n]={name:n,type:o,value:s},this.onGraphChanged({action:"addInput"}),this.afterChange(),(a=this.onInputAdded)==null||a.call(this,n,o),(r=this.onInputsOutputsChange)==null||r.call(this))},setInputData(n,o){var s=this.inputs[n];s&&(s.value=o)},getInputData(n){var o=this.inputs[n];return o?o.value:null},renameInput(n,o){var s,a,r;if(o!=n){if(!this.inputs[n])return!1;if(this.inputs[o])return(s=LiteGraph$j.error)==null||s.call(LiteGraph$j,"there is already one input with that name"),!1;this.inputs[o]=this.inputs[n],delete this.inputs[n],this.onGraphChanged({action:"renameInput"}),(a=this.onInputRenamed)==null||a.call(this,n,o),(r=this.onInputsOutputsChange)==null||r.call(this)}},changeInputType(n,o){var s;if(!this.inputs[n])return!1;this.inputs[n].type&&String(this.inputs[n].type).toLowerCase()==String(o).toLowerCase()||(this.inputs[n].type=o,this.onGraphChanged({action:"changeInputType"}),(s=this.onInputTypeChanged)==null||s.call(this,n,o))},removeInput(n){var o,s;return this.inputs[n]?(delete this.inputs[n],this.onGraphChanged({action:"graphRemoveInput"}),(o=this.onInputRemoved)==null||o.call(this,n),(s=this.onInputsOutputsChange)==null||s.call(this),!0):!1},addOutput(n,o,s){var a,r;this.outputs[n]={name:n,type:o,value:s},this.onGraphChanged({action:"addOutput"}),(a=this.onOutputAdded)==null||a.call(this,n,o),(r=this.onInputsOutputsChange)==null||r.call(this)},setOutputData(n,o){var s=this.outputs[n];s&&(s.value=o)},getOutputData(n){var o=this.outputs[n];return o?o.value:null},renameOutput(n,o){var s,a,r;if(!this.outputs[n])return!1;if(this.outputs[o])return(s=LiteGraph$j.error)==null||s.call(LiteGraph$j,"there is already one output with that name"),!1;this.outputs[o]=this.outputs[n],delete this.outputs[n],this._version++,(a=this.onOutputRenamed)==null||a.call(this,n,o),(r=this.onInputsOutputsChange)==null||r.call(this)},changeOutputType(n,o){var s;if(!this.outputs[n])return!1;this.outputs[n].type&&String(this.outputs[n].type).toLowerCase()==String(o).toLowerCase()||(this.outputs[n].type=o,this.onGraphChanged({action:"changeOutputType"}),(s=this.onOutputTypeChanged)==null||s.call(this,n,o))},removeOutput(n){var o,s;return this.outputs[n]?(delete this.outputs[n],this.onGraphChanged({action:"removeOutput"}),(o=this.onOutputRemoved)==null||o.call(this,n),(s=this.onInputsOutputsChange)==null||s.call(this),!0):!1},triggerInput(n,o){for(var s=this.findNodesByTitle(n),a=0;a<s.length;++a)s[a].onTrigger(o)},setCallback(n,o){for(var s=this.findNodesByTitle(n),a=0;a<s.length;++a)s[a].setTrigger(o)}};let LiteGraph$i=null;function setGraphEventsMethodsLiteGraph(n){LiteGraph$i=n}const graphEventsMethods={sendEventToAllNodes(n,o,s=LiteGraph$i.ALWAYS){var a=this._nodes_in_order?this._nodes_in_order:this._nodes;if(a)for(let r=0,l=a.length;r<l;++r){const h=a[r];if(h.constructor===LiteGraph$i.Subgraph&&n!=="onExecute"){h.mode==s&&h.sendEventToAllNodes(n,o,s);continue}!h[n]||h.mode!==s||(o===void 0?h[n]():Array.isArray(o)?h[n].apply(h,o):h[n](o))}},onAction(n,o,s){this._input_nodes=this.findNodesByClass(LiteGraph$i.GraphInput,this._input_nodes);for(var a=0;a<this._input_nodes.length;++a){var r=this._input_nodes[a];if(r.properties.name==n){r.actionDo(n,o,s);break}}},trigger(n,o){var s;(s=this.onTrigger)==null||s.call(this,n,o)},beforeChange(n){var o;(o=this.onBeforeChange)==null||o.call(this,this,n),this.sendActionToCanvas("onBeforeChange",this)},afterChange(n){var o;(o=this.onAfterChange)==null||o.call(this,this,n),this.sendActionToCanvas("onAfterChange",this)},connectionChange(n){var o;this.updateExecutionOrder(),(o=this.onConnectionChange)==null||o.call(this,n),this.onGraphChanged({action:"connectionChange",doSave:!1}),this.sendActionToCanvas("onConnectionChange")}};let LiteGraph$h=null;function setSerializationLoadMethodsLiteGraph(n){LiteGraph$h=n}const serializationLoadMethods={serialize(){var n,o;const s=this._nodes.map(d=>d.serialize());var a=[];for(var r in this.links){var l=this.links[r];if(!l.serialize){(n=LiteGraph$h.warn)==null||n.call(LiteGraph$h,"weird LLink bug, link info is not a LLink but a regular object");var h=new LiteGraph$h.LLink;for(var c in l)h[c]=l[c];this.links[r]=h,l=h}a.push(l.serialize())}const p=this._groups.map(d=>d.serialize());var u={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:s,links:a,groups:p,config:this.config,extra:this.extra,version:LiteGraph$h.VERSION};return(o=this.onSerialize)==null||o.call(this,u),u},configure(n,o){var s,a,r,l,h;if(n){o||this.clear();var c=n.nodes;if(n.links&&n.links.constructor===Array){for(var p=[],u=0;u<n.links.length;++u){var d=n.links[u];if(!d){(s=LiteGraph$h.warn)==null||s.call(LiteGraph$h,"serialized graph link data contains errors, skipping.");continue}var f=new LiteGraph$h.LLink;f.configure(d),p[f.id]=f}n.links=p}for(let m in n)["nodes","groups"].includes(m)||(this[m]=n[m]);var L=!1;this._configuring=!0;try{if(this._nodes=[],c){for(let m=0,b=c.length;m<b;++m){var g=c[m],_=LiteGraph$h.createNode(g.type,g.title);_||((a=LiteGraph$h.log)==null||a.call(LiteGraph$h,`Node not found or has errors: ${g.type}`),_=new LiteGraph$h.LGraphNode,_.last_serialization=g,_.has_errors=!0,L=!0),_.id=g.id,this.add(_,!0,{doProcessChange:!1})}c.forEach(m=>{const b=this.getNodeById(m.id);b==null||b.configure(m)})}this._groups.length=0,n.groups&&n.groups.forEach(m=>{const b=new LiteGraph$h.LGraphGroup;b.configure(m),this.add(b,!0,{doProcessChange:!1})})}finally{this._configuring=!1}return this.updateExecutionOrder(),this.extra=(r=n.extra)!=null?r:{},(l=this.onConfigure)==null||l.call(this,n),n._version?(h=LiteGraph$h.debug)==null||h.call(LiteGraph$h,"skip onGraphChanged when configure passing version too!"):this.onGraphChanged({action:"graphConfigure",doSave:!1}),this.setDirtyCanvas(!0,!0),L}},load(n,o){var s=this;if(n.constructor===File||n.constructor===Blob){var a=new FileReader;a.addEventListener("load",l=>{var h=JSON.parse(l.target.result);s.configure(h),o==null||o()}),a.readAsText(n);return}var r=new XMLHttpRequest;r.open("GET",n,!0),r.send(null),r.onload=l=>{var h;if(r.status!==200){(h=LiteGraph$h.error)==null||h.call(LiteGraph$h,"Error loading graph:",r.status,r.response);return}var c=JSON.parse(r.response);s.configure(c),o==null||o()},r.onerror=l=>{var h;(h=LiteGraph$h.error)==null||h.call(LiteGraph$h,"Error loading graph:",l)}}};let LiteGraph$g=null;function setHistoryMethodsLiteGraph(n){LiteGraph$g=n}const historyMethods={onGraphSaved(n={}){var o={};Object.assign(o,n),this.savedVersion=this._version},onGraphLoaded(n={}){var o={};Object.assign(o,n),this.savedVersion=this._version},onGraphChanged(n={}){var o,s,a,r,l,h,c={action:"",doSave:!0,doSaveGraph:!0},p=Object.assign(c,n);if(!(this._configuring&&p.action!=="graphConfigure")&&(this._version++,p.action?(o=LiteGraph$g.debug)==null||o.call(LiteGraph$g,"Graph change",p.action):(s=LiteGraph$g.debug)==null||s.call(LiteGraph$g,"Graph change, no action",p),p.doSave&&LiteGraph$g.actionHistory_enabled)){(a=LiteGraph$g.debug)==null||a.call(LiteGraph$g,"onGraphChanged SAVE :: "+p.action);var u={actionName:p.action};p.doSaveGraph&&(u=Object.assign(u,{graphSave:this.serialize()}));for(var d=this.history;d.actionHistoryPtr<d.actionHistoryVersions.length-1;)(r=LiteGraph$g.debug)==null||r.call(LiteGraph$g,"popping: gone back? "+(d.actionHistoryPtr+" < "+(d.actionHistoryVersions.length-1))),d.actionHistoryVersions.pop();if(d.actionHistoryVersions.length>=LiteGraph$g.actionHistoryMaxSave){var f=d.actionHistoryVersions.shift();(l=LiteGraph$g.debug)==null||l.call(LiteGraph$g,"maximum saves reached: "+d.actionHistoryVersions.length+", remove older: "+f),d.actionHistory[f]=!1}d.actionHistoryPtr=d.actionHistoryVersions.length,d.actionHistoryVersions.push(d.actionHistoryPtr),d.actionHistory[d.actionHistoryPtr]=u,(h=LiteGraph$g.debug)==null||h.call(LiteGraph$g,"history saved: "+d.actionHistoryPtr,u.actionName)}},actionHistoryBack(n={}){var o,s,a,r,l,h={};Object.assign(h,n);var c=this.history;return c.actionHistoryPtr!=null&&c.actionHistoryPtr>=0?(c.actionHistoryPtr--,(o=LiteGraph$g.debug)==null||o.call(LiteGraph$g,"history step back: "+c.actionHistoryPtr),this.actionHistoryLoad({iVersion:c.actionHistoryPtr})?((a=LiteGraph$g.debug)==null||a.call(LiteGraph$g,"history loaded back: "+c.actionHistoryPtr),(r=LiteGraph$g.debug)==null||r.call(LiteGraph$g,this.history),!0):((s=LiteGraph$g.warn)==null||s.call(LiteGraph$g,"historyLoad failed, restore pointer? "+c.actionHistoryPtr),c.actionHistoryPtr++,!1)):((l=LiteGraph$g.debug)==null||l.call(LiteGraph$g,"history is already at older state"),!1)},actionHistoryForward(n={}){var o,s,a,r,l={};Object.assign(l,n);var h=this.history;return h.actionHistoryPtr<h.actionHistoryVersions.length?(h.actionHistoryPtr++,(o=LiteGraph$g.debug)==null||o.call(LiteGraph$g,"history step forward: "+h.actionHistoryPtr),this.actionHistoryLoad({iVersion:h.actionHistoryPtr})?((a=LiteGraph$g.debug)==null||a.call(LiteGraph$g,"history loaded forward: "+h.actionHistoryPtr),!0):((s=LiteGraph$g.warn)==null||s.call(LiteGraph$g,"historyLoad failed, restore pointer? "+h.actionHistoryPtr),h.actionHistoryPtr--,!1)):((r=LiteGraph$g.debug)==null||r.call(LiteGraph$g,"history is already at newer state"),!1)},actionHistoryLoad(n={}){var o,s={iVersion:!1,backStep:!1},a=Object.assign(s,n),r=this.history;if(r.actionHistory[a.iVersion]&&r.actionHistory[a.iVersion].graphSave){var l=JSON.stringify(this.history);return this.configure(r.actionHistory[a.iVersion].graphSave),this.history=JSON.parse(l),(o=LiteGraph$g.debug)==null||o.call(LiteGraph$g,"history loaded: "+a.iVersion,r.actionHistory[a.iVersion].actionName),!0}else return!1}};function installLGraphDelegates(n,o){n.__delegates_installed||(setLifecycleMethodsLiteGraph(o),setCanvasBindingMethodsLiteGraph(o),setRuntimeLoopMethodsLiteGraph(o),setExecutionOrderMethodsLiteGraph(o),setNodeMutationMethodsLiteGraph(o),setGraphPortsMethodsLiteGraph(o),setGraphEventsMethodsLiteGraph(o),setSerializationLoadMethodsLiteGraph(o),setHistoryMethodsLiteGraph(o),[lifecycleMethods,canvasBindingMethods,runtimeLoopMethods,executionOrderMethods,nodeMutationMethods,nodeQueryMethods,graphPortsMethods,graphEventsMethods,serializationLoadMethods,historyMethods].forEach(s=>{Object.entries(s).forEach(([a,r])=>{Object.defineProperty(n.prototype,a,{value:r,writable:!0,configurable:!0})})}),Object.defineProperty(n,"__delegates_installed",{value:!0,writable:!1,configurable:!1}))}class LGraph{constructor(o){var s;(s=LiteGraph.log)==null||s.call(LiteGraph,"Graph created"),this.list_of_graphcanvas=null,this.clear(),o&&this.configure(o)}}X(LGraph,"supported_types",["number","string","boolean"]),X(LGraph,"STATUS_STOPPED",1),X(LGraph,"STATUS_RUNNING",2);function setupLGraphDelegates(n=LiteGraph){installLGraphDelegates(LGraph,n)}let LiteGraph$f=null;function setLifecycleSerializationMethodsLiteGraph(n){LiteGraph$f=n}const lifecycleSerializationMethods={configure(n){var o,s,a,r,l;Object.entries(n).forEach(([h,c])=>{var p;if(h==="properties"){for(var u in c)this.properties[u]=c[u],(p=this.onPropertyChanged)==null||p.call(this,u,c[u]);return}c!==null&&(typeof c=="object"?this[h]&&this[h].configure?this[h].configure(c):this[h]=LiteGraph$f.cloneObject(c,this[h]):this[h]=c)}),n.title||(this.title=this.constructor.title),(o=this.inputs)==null||o.forEach((h,c)=>{var p,u;if(!h.link)return;const d=this.graph?this.graph.links[h.link]:null;(p=this.onConnectionsChange)==null||p.call(this,LiteGraph$f.INPUT,c,!0,d,h),(u=this.onInputAdded)==null||u.call(this,h)}),(s=this.outputs)==null||s.forEach((h,c)=>{var p;h.links&&(h.links.forEach(()=>{var u;const d=this.graph;(u=this.onConnectionsChange)==null||u.call(this,LiteGraph$f.OUTPUT,c,!0,d,h)}),(p=this.onOutputAdded)==null||p.call(this,h))}),this.widgets&&(this.widgets.forEach(h=>{h&&h.options&&h.options.property&&this.properties[h.options.property]!==void 0&&(h.value=JSON.parse(JSON.stringify(this.properties[h.options.property])))}),(a=n.widgets_values)==null||a.forEach((h,c)=>{this.widgets[c]&&(this.widgets[c].value=h)})),(r=this.onConfigure)==null||r.call(this,n),(l=this.graph)==null||l.onGraphChanged({action:"nodeConfigure",doSave:!1})},serialize(){var n,o,s,a={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph$f.cloneObject(this.flags),order:this.order,mode:this.mode};return this.constructor===LiteGraph$f.LGraphNode&&this.last_serialization?this.last_serialization:(this.inputs&&(a.inputs=LiteGraph$f.cloneObject(this.inputs)),this.outputs&&(this.outputs.forEach(r=>{delete r._data}),a.outputs=LiteGraph$f.cloneObject(this.outputs)),this.title&&this.title!=this.constructor.title&&(a.title=this.title),this.properties&&(a.properties=LiteGraph$f.cloneObject(this.properties)),this.widgets&&this.serialize_widgets&&(a.widgets_values=this.widgets.map(r=>{var l;return(l=r==null?void 0:r.value)!=null?l:null})),(n=a.type)!=null||(a.type=this.constructor.type),this.color&&(a.color=this.color),this.bgcolor&&(a.bgcolor=this.bgcolor),this.boxcolor&&(a.boxcolor=this.boxcolor),this.shape&&(a.shape=this.shape),(o=this.onSerialize)!=null&&o.call(this,a)&&((s=LiteGraph$f.warn)==null||s.call(LiteGraph$f,"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter")),a)},clone(){var n,o,s=LiteGraph$f.createNode(this.type);if(!s)return null;var a=LiteGraph$f.cloneObject(this.serialize());return(n=a.inputs)==null||n.forEach(r=>{r.link=null}),(o=a.outputs)==null||o.forEach(r=>{r.links&&(r.links.length=0)}),delete a.id,LiteGraph$f.use_uuids&&(a.id=LiteGraph$f.uuidv4()),s.configure(a),s},toString(){return JSON.stringify(this.serialize())},getTitle(){var n;return(n=this.title)!=null?n:this.constructor.title}};let LiteGraph$e=null;function setPropertiesWidgetsMethodsLiteGraph(n){LiteGraph$e=n}const propertiesWidgetsMethods={setProperty(n,o){var s,a;if(this.properties||(this.properties={}),o===this.properties[n])return;const r=this.properties[n];this.properties[n]=o,((s=this.onPropertyChanged)==null?void 0:s.call(this,n,o,r))===!1&&(this.properties[n]=r);const l=(a=this.widgets)==null?void 0:a.find(h=>{var c;return h&&((c=h.options)==null?void 0:c.property)===n});l&&(l.value=o)},addProperty(n,o,s,a){var r,l;const h={name:n,type:s,default_value:o,...a};return this.properties_info=(r=this.properties_info)!=null?r:[],this.properties_info.push(h),this.properties=(l=this.properties)!=null?l:{},this.properties[n]=o,h},getPropertyInfo(n){var o=null;if(this.properties_info){for(var s=0;s<this.properties_info.length;++s)if(this.properties_info[s].name==n){o=this.properties_info[s];break}}return this.constructor[`@${n}`]&&(o=this.constructor[`@${n}`]),this.constructor.widgets_info&&this.constructor.widgets_info[n]&&(o=this.constructor.widgets_info[n]),!o&&this.onGetPropertyInfo&&(o=this.onGetPropertyInfo(n)),o||(o={}),o.type||(o.type=typeof this.properties[n]),o.widget=="combo"&&(o.type="enum"),o},addWidget(n,o,s,a,r){var l,h,c;(l=this.widgets)!=null||(this.widgets=[]),!r&&a&&a.constructor===Object&&(r=a,a=null),r&&r.constructor===String&&(r={property:r}),a&&a.constructor===String&&(r!=null||(r={}),r.property=a,a=null),a&&a.constructor!==Function&&((h=LiteGraph$e.warn)==null||h.call(LiteGraph$e,"addWidget: callback must be a function"),a=null);var p={type:n.toLowerCase(),name:o,value:s,callback:a,options:r||{}};if(p.options.y!==void 0&&(p.y=p.options.y),!a&&!p.options.callback&&!p.options.property&&((c=LiteGraph$e.warn)==null||c.call(LiteGraph$e,"LiteGraph addWidget(...) without a callback or property assigned")),n=="combo"&&!p.options.values)throw Error("LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }");return this.widgets.push(p),this.setSize(this.computeSize()),p},addCustomWidget(n){var o;return(o=this.widgets)!=null||(this.widgets=[]),this.widgets.push(n),n}},ioDataMethods={setOutputData(n,o){var s;if(this.outputs){if((n==null?void 0:n.constructor)===String)n=this.findOutputSlot(n);else if(n==-1||n>=this.outputs.length)return;var a=this.outputs[n];a&&(a._data=o,(s=this.outputs[n].links)==null||s.forEach(r=>{const l=this.graph.links[r];l&&(l.data=o)}))}},setOutputDataType(n,o){var s,a;if(this.outputs&&!(n==-1||n>=this.outputs.length)){var r=this.outputs[n];r&&(r.type=o,(a=(s=this.outputs[n])==null?void 0:s.links)==null||a.forEach(l=>{this.graph.links[l]&&(this.graph.links[l].type=o)}))}},getInputData(n,o,s){var a;if(this.inputs&&!(n>=this.inputs.length||this.inputs[n].link==null)){var r=this.inputs[n].link,l=this.graph.links[r];if(!l)return null;if(!o)return l.data;var h=this.graph.getNodeById(l.origin_id);if(!h)return l.data;if(s){var c=this.id+"_getInputData_forced_"+Math.floor(Math.random()*9999),p={action:c,options:{action_call:c}};this.refreshAncestors(p)}return h.updateOutputData?h.updateOutputData(l.origin_slot):(a=h.doExecute)==null||a.call(h),l.data}},getInputDataType(n){if(!this.inputs||n>=this.inputs.length||this.inputs[n].link==null)return null;var o=this.inputs[n].link,s=this.graph.links[o];if(!s)return null;var a=this.graph.getNodeById(s.origin_id);if(!a)return s.type;var r=a.outputs[s.origin_slot];return r?r.type:null},getInputDataByName(n,o){var s=this.findInputSlot(n);return s==-1?null:this.getInputData(s,o)},isInputConnected(n){return this.inputs?n<this.inputs.length&&this.inputs[n].link!=null:!1},getInputInfo(n){return this.inputs&&n<this.inputs.length?this.inputs[n]:null},getInputLink(n){if(!this.inputs)return null;if(n<this.inputs.length){var o=this.inputs[n];return this.graph.links[o.link]}return null},getInputNode(n){if(!this.inputs||n>=this.inputs.length)return null;var o=this.inputs[n];if(!o||o.link===null)return null;var s=this.graph.links[o.link];return s?this.graph.getNodeById(s.origin_id):null},getInputOrProperty(n){if(this.inputs)for(var o=0,s=this.inputs.length;o<s;++o){var a=this.inputs[o];if(n==a.name&&a.link!=null){var r=this.graph.links[a.link];if(r)return r.data}}return this.properties?this.properties[n]:null},getOutputData(n){if(!this.outputs||n>=this.outputs.length)return null;var o=this.outputs[n];return o._data},getOutputInfo(n){return this.outputs&&n<this.outputs.length?this.outputs[n]:null},isOutputConnected(n){return this.outputs?n<this.outputs.length&&this.outputs[n].links&&this.outputs[n].links.length:!1},isAnyOutputConnected(){return this.outputs?this.outputs.some(n=>n.links&&n.links.length):!1},getOutputNodes(n){if(!this.outputs||n>=this.outputs.length)return null;const o=this.outputs[n];return!o.links||o.links.length===0?null:o.links.map(s=>this.graph.links[s]).filter(s=>s).map(s=>this.graph.getNodeById(s.target_id)).filter(s=>s)}};let LiteGraph$d=null;function setExecutionActionsMethodsLiteGraph(n){LiteGraph$d=n}const executionActionsMethods={addOnTriggerInput(){var n=this.findInputSlot("onTrigger");return n==-1?(this.addInput("onTrigger",LiteGraph$d.EVENT,{removable:!0,nameLocked:!0}),this.findInputSlot("onTrigger")):n},addOnExecutedOutput(){var n=this.findOutputSlot("onExecuted");return n==-1?(this.addOutput("onExecuted",LiteGraph$d.ACTION,{removable:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")):n},onAfterExecuteNode(n,o){var s,a=this.findOutputSlot("onExecuted");a!=-1&&((s=LiteGraph$d.debug)==null||s.call(LiteGraph$d,this.id+":"+this.order+" triggering slot onAfterExecute",n,o),this.triggerSlot(a,n,null,o))},changeMode(n){switch(n){case LiteGraph$d.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph$d.ON_EVENT:break;case LiteGraph$d.NEVER:break;case LiteGraph$d.ALWAYS:break;case LiteGraph$d.ON_REQUEST:break;default:return!1}return this.mode=n,!0},executePendingActions(){!this._waiting_actions||!this._waiting_actions.length||(this._waiting_actions.forEach(n=>{this.onAction(n[0],n[1],n[2],n[3],n[4])}),this._waiting_actions.length=0)},doExecute(n,o={}){var s,a,r,l,h;if(this.onExecute){if((s=o.action_call)!=null||(o.action_call=`${this.id}_exec_${Math.floor(Math.random()*9999)}`),this.graph.nodes_executing&&this.graph.nodes_executing[this.id]){(a=LiteGraph$d.debug)==null||a.call(LiteGraph$d,"NODE already executing! Prevent! "+this.id+":"+this.order);return}if(LiteGraph$d.ensureNodeSingleExecution&&this.exec_version&&this.exec_version>=this.graph.iteration&&this.exec_version!==void 0){(r=LiteGraph$d.debug)==null||r.call(LiteGraph$d,"!! NODE already EXECUTED THIS STEP !! "+this.exec_version);return}if(LiteGraph$d.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&o&&o.action_call&&this.graph.nodes_executedAction[this.id]==o.action_call){(l=LiteGraph$d.debug)==null||l.call(LiteGraph$d,"!! NODE already ACTION THIS STEP !! "+o.action_call);return}this.graph.nodes_executing[this.id]=!0,this.onExecute(n,o),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,o&&o.action_call&&(this.action_call=o.action_call,this.graph.nodes_executedAction[this.id]=o.action_call)}this.execute_triggered=2,(h=this.onAfterExecuteNode)==null||h.call(this,n,o)},execute(n,o={}){return this.doExecute(n,o)},actionDo(n,o,s={},a){var r,l,h,c;if(this.onAction){if((r=s.action_call)!=null||(s.action_call=`${this.id}_${n||"action"}_${Math.floor(Math.random()*9999)}`),LiteGraph$d.ensureNodeSingleAction&&this.graph.nodes_actioning&&this.graph.nodes_actioning[this.id]==s.action_call)return;if((l=LiteGraph$d.debug)==null||l.call(LiteGraph$d,"CheckActioned ? "+this.id+":"+this.order+" :: "+this.action_call),LiteGraph$d.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&s&&s.action_call&&this.graph.nodes_executedAction[this.id]==s.action_call){(h=LiteGraph$d.debug)==null||h.call(LiteGraph$d,"!! NODE already ACTION THIS STEP !! "+s.action_call),\u00E7;return}this.graph.nodes_actioning[this.id]=n||"actioning",this.onAction(n,o,s,a),this.graph.nodes_actioning[this.id]=!1,s&&s.action_call&&(this.action_call=s.action_call,this.graph.nodes_executedAction[this.id]=s.action_call)}this.action_triggered=2,(c=this.onAfterExecuteNode)==null||c.call(this,o,s)},trigger(n,o,s){!this.outputs||this.outputs.length===0||(this.graph&&(this.graph._last_trigger_time=LiteGraph$d.getTime()),this.outputs.forEach((a,r)=>{a&&a.type===LiteGraph$d.EVENT&&(!n||a.name===n)&&this.triggerSlot(r,o,null,s)}))},triggerSlot(n,o,s,a={}){var r,l,h,c;if(this.outputs){if(n==null){(r=LiteGraph$d.error)==null||r.call(LiteGraph$d,"triggerSlot","slot must be a number");return}n.constructor!==Number&&((l=LiteGraph$d.warn)==null||l.call(LiteGraph$d,"triggerSlot","slot must be a number, use node.trigger('name') if you want to use a string"));var p=this.outputs[n];if(p){var u=p.links;if(!(!u||!u.length)&&!(this.graph&&this.graph.ancestorsCall)){this.graph&&(this.graph._last_trigger_time=LiteGraph$d.getTime());for(var d=0;d<u.length;++d){var f=u[d];if(!(s!=null&&s!=f)){var L=this.graph.links[u[d]];if(L){L._last_time=LiteGraph$d.getTime();var g=this.graph.getNodeById(L.target_id);if(g){if(g.mode===LiteGraph$d.ON_TRIGGER)a.action_call||(a.action_call=`${this.id}_trigg_${Math.floor(Math.random()*9999)}`),LiteGraph$d.refreshAncestorsOnTriggers&&g.refreshAncestors({action:"trigger",param:o,options:a}),g.onExecute&&g.doExecute(o,a);else if(g.onAction){a.action_call||(a.action_call=`${this.id}_act_${Math.floor(Math.random()*9999)}`);let _=g.inputs[L.target_slot];(h=LiteGraph$d.debug)==null||h.call(LiteGraph$d,"triggerSlot","will call onACTION: "+this.id+":"+this.order+" :: "+_.name),LiteGraph$d.refreshAncestorsOnActions&&g.refreshAncestors({action:_.name,param:o,options:a}),LiteGraph$d.use_deferred_actions&&g.onExecute?((c=g._waiting_actions)!=null||(g._waiting_actions=[]),g._waiting_actions.push([_.name,o,a,L.target_slot])):g.actionDo(_.name,o,a,L.target_slot)}}}}}}}}},clearTriggeredSlot(n,o){!this.outputs||!this.outputs[n]||!this.outputs[n].links||this.outputs[n].links.forEach(s=>{if(o!==null&&o!==s)return;const a=this.graph.links[s];a&&(a._last_time=0)})}};let LiteGraph$c=null;function setSlotsMutationMethodsLiteGraph(n){LiteGraph$c=n}const slotsMutationMethods={setSize(n){var o;this.size=n,(o=this.onResize)==null||o.call(this,this.size)},addInput(n,o,s){return this.addSlot(n,o,s,!0)},addOutput(n,o,s){return this.addSlot(n,o,s,!1)},addSlot(n,o,s,a){var r,l,h,c;const p=a?{name:n,type:o,link:null,...s}:{name:n,type:o,links:null,...s};return a?(this.inputs=(r=this.inputs)!=null?r:[],this.inputs.push(p),(l=this.onInputAdded)==null||l.call(this,p),LiteGraph$c.registerNodeAndSlotType(this,o)):(this.outputs=(h=this.outputs)!=null?h:[],this.outputs.push(p),(c=this.onOutputAdded)==null||c.call(this,p),LiteGraph$c.auto_load_slot_types&&LiteGraph$c.registerNodeAndSlotType(this,o,!0)),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),p},addInputs(n){this.addSlots(n,!0)},addOutputs(n){this.addSlots(n,!1)},addSlots(n,o){var s;typeof n=="string"&&(n=[n]),n.forEach(a=>{var r,l,h,c,p,u;const d=o?{name:a[0],type:a[1],link:null,...(r=a[2])!=null?r:{}}:{name:a[0],type:a[1],links:null,...(l=a[2])!=null?l:{}};o?(this.inputs=(h=this.inputs)!=null?h:[],this.inputs.push(d),(c=this.onInputAdded)==null||c.call(this,d),LiteGraph$c.registerNodeAndSlotType(this,a[1])):(this.outputs=(p=this.outputs)!=null?p:[],this.outputs.push(d),(u=this.onOutputAdded)==null||u.call(this,d),LiteGraph$c.auto_load_slot_types&&LiteGraph$c.registerNodeAndSlotType(this,a[1],!0))}),this.setSize(this.computeSize()),(s=this.setDirtyCanvas)==null||s.call(this,!0,!0)},removeInput(n){var o;this.disconnectInput(n);const s=this.inputs.splice(n,1)[0];this.inputs.slice(n).filter(a=>!!a).forEach(a=>{const r=this.graph.links[a.link];r!=null&&r.target_slot&&r.target_slot--}),this.setSize(this.computeSize()),(o=this.onInputRemoved)==null||o.call(this,n,s),this.setDirtyCanvas(!0,!0)},removeOutput(n){var o;this.disconnectOutput(n),this.outputs=this.outputs.filter((s,a)=>a!==n),this.outputs.slice(n).forEach(s=>{!s||!s.links||s.links.forEach(a=>{const r=this.graph.links[a];r&&(r.origin_slot-=1)})}),this.setSize(this.computeSize()),(o=this.onOutputRemoved)==null||o.call(this,n),this.setDirtyCanvas(!0,!0)},addConnection(n,o,s,a){var r={name:n,type:o,pos:s,direction:a,links:null};return this.connections.push(r),r}};let LiteGraph$b=null;function setSlotsQueryMethodsLiteGraph(n){LiteGraph$b=n}const slotsQueryMethods={findInputSlot(n,o){if(!this.inputs)return-1;for(var s=0,a=this.inputs.length;s<a;++s)if(n==this.inputs[s].name)return o?this.inputs[s]:s;return-1},findOutputSlot(n,o=!1){if(!this.outputs)return-1;for(var s=0,a=this.outputs.length;s<a;++s)if(n==this.outputs[s].name)return o?this.outputs[s]:s;return-1},findInputSlotFree(n={}){var o={returnObj:!1,typesNotAccepted:[]},s=Object.assign(o,n);if(!this.inputs)return-1;for(var a=0,r=this.inputs.length;a<r;++a)if(!(this.inputs[a].link&&this.inputs[a].link!=null)&&!(s.typesNotAccepted&&s.typesNotAccepted.includes&&s.typesNotAccepted.includes(this.inputs[a].type)))return s.returnObj?this.inputs[a]:a;return-1},findOutputSlotFree(n={}){var o={returnObj:!1,typesNotAccepted:[]},s=Object.assign(o,n);if(!this.outputs)return-1;for(let a=0,r=this.outputs.length;a<r;++a)if(!(this.outputs[a].links&&this.outputs[a].links!=null)&&!(s.typesNotAccepted&&s.typesNotAccepted.includes&&s.typesNotAccepted.includes(this.outputs[a].type)))return s.returnObj?this.outputs[a]:a;return-1},findInputSlotByType(n,o,s,a){return this.findSlotByType(!0,n,o,s,a)},findOutputSlotByType(n,o,s,a){return this.findSlotByType(!1,n,o,s,a)},findSlotByType(n=!1,o,s=!1,a=!1,r=!1){var l=n?this.inputs:this.outputs;if(!l)return-1;(o==""||o=="*")&&(o=0);for(let h=0,c=l.length;h<c;++h){let p=(o+"").toLowerCase().split(","),u=l[h].type=="0"||l[h].type=="*"?"0":l[h].type;u=(u+"").toLowerCase().split(",");for(let d=0;d<p.length;d++)for(let f=0;f<u.length;f++)if(p[d]=="_event_"&&(p[d]=LiteGraph$b.EVENT),u[d]=="_event_"&&(u[d]=LiteGraph$b.EVENT),p[d]=="*"&&(p[d]=0),u[d]=="*"&&(u[d]=0),p[d]==u[f]){if(a&&l[h].links&&l[h].links!==null)continue;return s?l[h]:h}}if(a&&!r)for(let h=0,c=l.length;h<c;++h){let p=(o+"").toLowerCase().split(","),u=l[h].type=="0"||l[h].type=="*"?"0":l[h].type;u=(u+"").toLowerCase().split(",");for(let d=0;d<p.length;d++)for(let f=0;f<u.length;f++)if(p[d]=="*"&&(p[d]=0),u[d]=="*"&&(u[d]=0),p[d]==u[f])return s?l[h]:h}return-1},getSlotInPosition(n,o){var s=new Float32Array(2);if(this.inputs)for(let a=0,r=this.inputs.length;a<r;++a){let l=this.inputs[a];if(this.getConnectionPos(!0,a,s),LiteGraph$b.isInsideRectangle(n,o,s[0]-10,s[1]-5,20,10))return{input:l,slot:a,link_pos:s}}if(this.outputs)for(let a=0,r=this.outputs.length;a<r;++a){let l=this.outputs[a];if(this.getConnectionPos(!1,a,s),LiteGraph$b.isInsideRectangle(n,o,s[0]-10,s[1]-5,20,10))return{output:l,slot:a,link_pos:s}}return null}};let LiteGraph$a=null;function setConnectionsMethodsLiteGraph(n){LiteGraph$a=n}const connectionsMethods={connectByType(n,o,s="*",a={}){var r,l,h,c,p,u={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},d=Object.assign(u,a);o&&o.constructor===Number&&(o=this.graph.getNodeById(o));var f=o.findInputSlotByType(s,!1,!0);return f>=0&&f!==null?((r=LiteGraph$a.debug)==null||r.call(LiteGraph$a,"CONNbyTYPE type "+s+" for "+f),this.connect(n,o,f)):d.createEventInCase&&s==LiteGraph$a.EVENT?((l=LiteGraph$a.debug)==null||l.call(LiteGraph$a,"connect WILL CREATE THE onTrigger "+s+" to "+o),this.connect(n,o,-1)):d.generalTypeInCase&&(f=o.findInputSlotByType(0,!1,!0,!0),(h=LiteGraph$a.debug)==null||h.call(LiteGraph$a,"connect TO a general type (*, 0), if not found the specific type ",s," to ",o,"RES_SLOT:",f),f>=0)?this.connect(n,o,f):d.firstFreeIfOutputGeneralInCase&&(s==0||s=="*"||s=="")&&(f=o.findInputSlotFree({typesNotAccepted:[LiteGraph$a.EVENT]}),(c=LiteGraph$a.debug)==null||c.call(LiteGraph$a,"connect TO TheFirstFREE ",s," to ",o,"RES_SLOT:",f),f>=0)?this.connect(n,o,f):((p=LiteGraph$a.debug)==null||p.call(LiteGraph$a,"no way to connect type: ",s," to targetNODE ",o),null)},connectByTypeOutput(n,o,s="*",a={}){var r,l,h,c={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},p=Object.assign(c,a);o&&o.constructor===Number&&(o=this.graph.getNodeById(o));var u=o.findOutputSlotByType(s,!1,!0);return u>=0&&u!==null?((r=LiteGraph$a.debug)==null||r.call(LiteGraph$a,"CONNbyTYPE OUT! type "+s+" for "+u),o.connect(u,this,n)):p.generalTypeInCase&&(u=o.findOutputSlotByType(0,!1,!0,!0),u>=0)?o.connect(u,this,n):p.createEventInCase&&s==LiteGraph$a.EVENT&&LiteGraph$a.do_add_triggers_slots?(u=o.addOnExecutedOutput(),o.connect(u,this,n)):p.firstFreeIfInputGeneralInCase&&(s==0||s=="*"||s==""||s=="undefined")&&(u=o.findOutputSlotFree({typesNotAccepted:[LiteGraph$a.EVENT]}),u>=0)?o.connect(u,this,n):((l=LiteGraph$a.debug)==null||l.call(LiteGraph$a,"no way to connect byOUT type: ",s," to sourceNODE ",o),(h=LiteGraph$a.log)==null||h.call(LiteGraph$a,"type OUT! "+s+" not found or not free?"),null)},connect(n,o,s=0){var a,r,l,h,c,p,u,d,f,L,g,_,m,b;if(!this.graph)return(a=LiteGraph$a.log)==null||a.call(LiteGraph$a,"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(n.constructor===String){if(n=this.findOutputSlot(n),n==-1)return(r=LiteGraph$a.log)==null||r.call(LiteGraph$a,`Connect: Error, no slot of name ${n}`),null}else if(!this.outputs||n>=this.outputs.length)return(l=LiteGraph$a.log)==null||l.call(LiteGraph$a,"Connect: Error, slot number not found"),null;if(o&&o.constructor===Number&&(o=this.graph.getNodeById(o)),!o)throw new Error("target node is null");if(o==this)return null;if(s.constructor===String){if(s=o.findInputSlot(s),s==-1)return(h=LiteGraph$a.log)==null||h.call(LiteGraph$a,`Connect: Error, no slot of name ${s}`),null}else if(s===LiteGraph$a.EVENT)if(LiteGraph$a.do_add_triggers_slots)o.changeMode(LiteGraph$a.ON_TRIGGER),s=o.findInputSlot("onTrigger");else return null;else if(!o.inputs||s>=o.inputs.length)return(c=LiteGraph$a.log)==null||c.call(LiteGraph$a,"Connect: Error, slot number not found"),null;var G=!1,C=o.inputs[s],E=null,k=this.outputs[n];if(!this.outputs[n])return(p=LiteGraph$a.log)==null||p.call(LiteGraph$a,"Invalid slot passed: ",n,this.outputs),null;if(o.onBeforeConnectInput&&(s=o.onBeforeConnectInput(o)),((u=this.onConnectOutput)==null?void 0:u.call(this,n,C.type,C,o,s))===!1)return null;if(s===!1||s===null||!LiteGraph$a.isValidConnection(k.type,C.type))return this.setDirtyCanvas(!1,!0),G&&this.graph.connectionChange(this,E),null;if((d=LiteGraph$a.debug)==null||d.call(LiteGraph$a,"DBG targetSlot",s),((f=o.onConnectInput)==null?void 0:f.call(o,s,k.type,k,this,n))===!1||((L=this.onConnectOutput)==null?void 0:L.call(this,n,C.type,C,o,s))===!1)return null;o.inputs[s]&&o.inputs[s].link!=null&&(this.graph.beforeChange(),o.disconnectInput(s,{doProcessChange:!1}),G=!0),(g=k.links)!=null&&g.length&&k.type===LiteGraph$a.EVENT&&(LiteGraph$a.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(n,!1,{doProcessChange:!1}),G=!0));var A;return LiteGraph$a.use_uuids?A=LiteGraph$a.uuidv4():A=++this.graph.last_link_id,E=new LiteGraph$a.LLink(A,C.type||k.type,this.id,n,o.id,s),this.graph.links[E.id]=E,k.links==null&&(k.links=[]),k.links.push(E.id),!o.inputs||typeof o.inputs[s]=="undefined"?((_=LiteGraph$a.warn)==null||_.call(LiteGraph$a,"connect aborted: target slot does not exist on target node",o,s),k.links.pop(),delete this.graph.links[E.id],null):(o.inputs[s].link=E.id,(m=this.onConnectionsChange)==null||m.call(this,LiteGraph$a.OUTPUT,n,!0,E,k),(b=o.onConnectionsChange)==null||b.call(o,LiteGraph$a.INPUT,s,!0,E,C),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,o,s,this,n),this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,n,o,s)),this.graph.onGraphChanged({action:"connect"}),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,E),E)},disconnectOutput(n,o,s={}){var a,r,l,h,c,p,u={doProcessChange:!0},d=Object.assign(u,s);if(n.constructor===String){if(n=this.findOutputSlot(n),n==-1)return(a=LiteGraph$a.log)==null||a.call(LiteGraph$a,`Connect: Error, no slot of name ${n}`),!1}else if(!this.outputs||n>=this.outputs.length)return(r=LiteGraph$a.log)==null||r.call(LiteGraph$a,"Connect: Error, slot number not found"),!1;var f=this.outputs[n];if(!f||!f.links||f.links.length==0)return!1;if(o){if(o.constructor===Number&&(o=this.graph.getNodeById(o)),!o)throw new Error("Target Node not found");for(let g=0,_=f.links.length;g<_;g++){let m=f.links[g],b=this.graph.links[m];if(b.target_id==o.id){f.links.splice(g,1);var L=o.inputs[b.target_slot];L.link=null,delete this.graph.links[m],(l=this.graph)==null||l.onGraphChanged({action:"disconnectOutput",doSave:d.doProcessChange}),(h=o.onConnectionsChange)==null||h.call(o,LiteGraph$a.INPUT,b.target_slot,!1,b,L),(c=this.onConnectionsChange)==null||c.call(this,LiteGraph$a.OUTPUT,n,!1,b,f),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,n),this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,n),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,o,b.target_slot));break}}}else{for(let g=0,_=f.links.length;g<_;g++){let m=f.links[g],b=this.graph.links[m];b&&(o=this.graph.getNodeById(b.target_id),L=null,(p=this.graph)==null||p.onGraphChanged({action:"disconnectOutput",doSave:d.doProcessChange}),o&&(L=o.inputs[b.target_slot],L.link=null,o.onConnectionsChange&&o.onConnectionsChange(LiteGraph$a.INPUT,b.target_slot,!1,b,L),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,o,b.target_slot)),delete this.graph.links[m],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$a.OUTPUT,n,!1,b,f),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,n),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,o,b.target_slot)))}f.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},disconnectInput(n,o={}){var s,a,r,l={doProcessChange:!0},h=Object.assign(l,o);if(n.constructor===String){if(n=this.findInputSlot(n),n==-1)return(s=LiteGraph$a.log)==null||s.call(LiteGraph$a,`Connect: Error, no slot of name ${n}`),!1}else if(!this.inputs||n>=this.inputs.length)return(a=LiteGraph$a.log)==null||a.call(LiteGraph$a,"Connect: Error, slot number not found"),!1;var c=this.inputs[n];if(!c)return!1;var p=this.inputs[n].link;if(p!=null){this.inputs[n].link=null;var u=this.graph.links[p];if(u){var d=this.graph.getNodeById(u.origin_id);if(!d)return!1;var f=d.outputs[u.origin_slot];if(!f||!f.links||f.links.length==0)return!1;for(var L=0,g=f.links.length;L<g;L++)if(f.links[L]==p){f.links.splice(L,1);break}delete this.graph.links[p],(r=this.graph)==null||r.onGraphChanged({action:"disconnectInput",doSave:h.doProcessChange}),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$a.INPUT,n,!1,u,c),d.onConnectionsChange&&d.onConnectionsChange(LiteGraph$a.OUTPUT,L,!1,u,f),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,d,L),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,this,n))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0}};let LiteGraph$9=null;function setGeometryHitMethodsLiteGraph(n){LiteGraph$9=n}const geometryHitMethods={computeSize(n){if(this.constructor.size)return this.constructor.size.concat();var o=n||new Float32Array([0,0]),s=LiteGraph$9.NODE_TEXT_SIZE;const a=f=>f?s*f.length*.6:0;var r=a(this.title),l=0,h=0;this.inputs&&(l=this.inputs.reduce((f,L)=>{const g=L.label||L.name||"",_=a(g);return Math.max(f,_)},0)),this.outputs&&(h=this.outputs.reduce((f,L)=>{const g=L.label||L.name||"",_=a(g);return Math.max(f,_)},0)),o[0]=Math.max(l+h+10,r),o[0]=Math.max(o[0],LiteGraph$9.NODE_WIDTH),this.widgets&&this.widgets.length&&(o[0]=Math.max(o[0],LiteGraph$9.NODE_WIDTH*1.5));const c=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1,1)*LiteGraph$9.NODE_SLOT_HEIGHT;o[1]=c+(this.constructor.slot_start_y||0);let p=0;if(this.widgets&&this.widgets.length){for(var u=0,d=this.widgets.length;u<d;++u)this.widgets[u].computeSize?p+=this.widgets[u].computeSize(o[0])[1]+4:p+=LiteGraph$9.NODE_WIDGET_HEIGHT+4;p+=8}return this.widgets_up?o[1]=Math.max(o[1],p):this.widgets_start_y!=null?o[1]=Math.max(o[1],p+this.widgets_start_y):o[1]+=p,this.constructor.min_height&&o[1]<this.constructor.min_height&&(o[1]=this.constructor.min_height),o[1]+=6,o},getBounding(n=new Float32Array(4),o){const s=this.pos,a=this.flags.collapsed,r=this.size;let l=0,h=1,c=0,p=0;return o&&(l=4,h=6+l,c=4,p=5+c),n[0]=s[0]-l,n[1]=s[1]-LiteGraph$9.NODE_TITLE_HEIGHT-c,n[2]=a?(this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH)+h:r[0]+h,n[3]=a?LiteGraph$9.NODE_TITLE_HEIGHT+p:r[1]+LiteGraph$9.NODE_TITLE_HEIGHT+p,this.onBounding&&this.onBounding(n),n},isPointInside(n,o,s=0,a){var r=this.graph&&this.graph.isLive()?0:LiteGraph$9.NODE_TITLE_HEIGHT;if(a&&(r=0),this.flags&&this.flags.collapsed){if(LiteGraph$9.isInsideRectangle(n,o,this.pos[0]-s,this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT-s,(this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH)+2*s,LiteGraph$9.NODE_TITLE_HEIGHT+2*s))return!0}else if(this.pos[0]-4-s<n&&this.pos[0]+this.size[0]+4+s>n&&this.pos[1]-r-s<o&&this.pos[1]+this.size[1]+s>o)return!0;return!1},getConnectionPos(n,o,s=new Float32Array(2)){var a=0;n&&this.inputs&&(a=this.inputs.length),!n&&this.outputs&&(a=this.outputs.length);var r=LiteGraph$9.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var l=this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH;return this.horizontal?(s[0]=this.pos[0]+l*.5,n?s[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT:s[1]=this.pos[1]):(n?s[0]=this.pos[0]:s[0]=this.pos[0]+l,s[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT*.5),s}return n&&o==-1?(s[0]=this.pos[0]+LiteGraph$9.NODE_TITLE_HEIGHT*.5,s[1]=this.pos[1]+LiteGraph$9.NODE_TITLE_HEIGHT*.5,s):n&&a>o&&this.inputs[o].pos?(s[0]=this.pos[0]+this.inputs[o].pos[0],s[1]=this.pos[1]+this.inputs[o].pos[1],s):!n&&a>o&&this.outputs[o].pos?(s[0]=this.pos[0]+this.outputs[o].pos[0],s[1]=this.pos[1]+this.outputs[o].pos[1],s):this.horizontal?(s[0]=this.pos[0]+(o+.5)*(this.size[0]/a),n?s[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT:s[1]=this.pos[1]+this.size[1],s):(n?s[0]=this.pos[0]+r:s[0]=this.pos[0]+this.size[0]+1-r,s[1]=this.pos[1]+(o+.7)*LiteGraph$9.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),s)},localToScreen(n,o,s){return[(n+this.pos[0])*s.scale+s.offset[0],(o+this.pos[1])*s.scale+s.offset[1]]}};let LiteGraph$8=null;function setCanvasIntegrationMethodsLiteGraph(n){LiteGraph$8=n}const canvasIntegrationMethods={trace(n){var o,s,a,r;this.console||(this.console=[]),(s=(o=this.console).push)==null||s.call(o,n),this.console.length>this.constructor.MAX_CONSOLE&&((r=(a=this.console).shift)==null||r.call(a)),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,n)},setDirtyCanvas(n,o){this.graph&&this.graph.sendActionToCanvas("setDirty",[n,o])},loadImage(n){var o=new Image;o.src=LiteGraph$8.node_images_path+n,o.ready=!1;var s=this;return o.onload=function(){this.ready=!0,s.setDirtyCanvas(!0)},o},captureInput(n){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var o=this.graph.list_of_graphcanvas,s=0;s<o.length;++s){var a=o[s];!n&&a.node_capturing_input!=this||(a.node_capturing_input=n?this:null)}},collapse(n){this.graph.onGraphChanged({action:"collapse"}),!(this.constructor.collapsable===!1&&!n)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},pin(n){this.graph.onGraphChanged({action:"pin"}),n===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=n}};let LiteGraph$7=null;function setAncestorRefreshMethodsLiteGraph(n){LiteGraph$7=n}const ancestorRefreshMethods={refreshAncestors(n={}){var o={action:"",param:null,options:null,passParam:!0},s=Object.assign(o,n);if(this.inputs&&!(LiteGraph$7.preventAncestorRecalculation&&this.graph.node_ancestorsCalculated&&this.graph.node_ancestorsCalculated[this.id])){(!s.action||s.action=="")&&(s.action=this.id+"_ancestors"),(!s.param||s.param=="")&&(s.param=this.id+"_ancestors"),s.options||(s.options={}),s.options=Object.assign({action_call:s.action},s.options),this.graph.ancestorsCall=!0;var a={modesSkip:[LiteGraph$7.NEVER,LiteGraph$7.ON_EVENT,LiteGraph$7.ON_TRIGGER],modesOnly:[LiteGraph$7.ALWAYS,LiteGraph$7.ON_REQUEST],typesSkip:[LiteGraph$7.ACTION],typesOnly:[]},r=this.graph.getAncestors(this,a);for(iN in r)r[iN].doExecute(s.param,s.options),this.graph.node_ancestorsCalculated[r[iN].id]=!0;return this.graph.ancestorsCall=!1,this.graph.node_ancestorsCalculated[this.id]=!0,!0}}};let LiteGraph$6=null;function setMiscMethodsLiteGraph(n){LiteGraph$6=n}const miscMethods={alignToGrid(){this.pos[0]=LiteGraph$6.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph$6.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph$6.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph$6.CANVAS_GRID_SIZE)}};function installLGraphNodeDelegates(n,o){setLifecycleSerializationMethodsLiteGraph(o),setPropertiesWidgetsMethodsLiteGraph(o),setExecutionActionsMethodsLiteGraph(o),setSlotsMutationMethodsLiteGraph(o),setSlotsQueryMethodsLiteGraph(o),setConnectionsMethodsLiteGraph(o),setGeometryHitMethodsLiteGraph(o),setCanvasIntegrationMethodsLiteGraph(o),setAncestorRefreshMethodsLiteGraph(o),setMiscMethodsLiteGraph(o),[lifecycleSerializationMethods,propertiesWidgetsMethods,ioDataMethods,executionActionsMethods,slotsMutationMethods,slotsQueryMethods,connectionsMethods,geometryHitMethods,canvasIntegrationMethods,ancestorRefreshMethods,miscMethods].forEach(s=>{Object.entries(s).forEach(([a,r])=>{Object.defineProperty(n.prototype,a,{value:r,writable:!0,configurable:!0})})})}class LGraphNode{constructor(o="Unnamed"){this.title=o,this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}}set pos(o){var s;!o||o.length<2||((s=this._pos)!=null||(this._pos=new Float32Array(10,10)),this._pos[0]=o[0],this._pos[1]=o[1])}get pos(){return this._pos}}function setupLGraphNodeDelegates(n=LiteGraph){installLGraphNodeDelegates(LGraphNode,n)}class LGraphGroup{constructor(o="Group"){X(this,"isPointInside",LiteGraph.LGraphNode.prototype.isPointInside),X(this,"setDirtyCanvas",LiteGraph.LGraphNode.prototype.setDirtyCanvas);var s,a;this.title=o,this.font_size=24,this.color=(a=(s=LiteGraph.LGraphCanvas.node_colors.pale_blue)==null?void 0:s.groupcolor)!=null?a:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null}set pos(o){!o||o.length<2||(this._pos[0]=o[0],this._pos[1]=o[1])}get pos(){return this._pos}set size(o){!o||o.length<2||(this._size[0]=Math.max(140,o[0]),this._size[1]=Math.max(80,o[1]))}get size(){return this._size}configure(o){this.title=o.title,this._bounding.set(o.bounding),this.color=o.color,o.font_size&&(this.font_size=o.font_size)}serialize(){var o=this._bounding;return{title:this.title,bounding:o.map(s=>Math.round(s)),color:this.color,font_size:this.font_size}}move(o,s,a){var r,l;isNaN(o)&&((r=console.error)==null||r.call(console,"LGraphGroup.move() deltax NaN")),isNaN(s)&&((l=console.error)==null||l.call(console,"LGraphGroup.move() deltay NaN")),this._pos[0]+=o,this._pos[1]+=s,!a&&this._nodes.forEach(h=>{h.pos[0]+=o,h.pos[1]+=s})}recomputeInsideNodes(){this._nodes.length=0;var o=this.graph._nodes,s=new Float32Array(4);this._nodes=o.filter(a=>(a.getBounding(s),LiteGraph.overlapBounding(this._bounding,s)))}}function clear(){var n;this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.low_quality_rendering_counter=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),(n=this.onClear)==null||n.call(this)}function setGraph(n,o){var s;if(this.graph!=n){if(o||this.clear(),!n){(s=this.graph)==null||s.detachCanvas(this);return}n.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}}function getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}function openSubgraph(n){if(!n)throw new Error("graph cannot be null");if(this.graph==n)throw new Error("graph cannot be the same");this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),n.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)}function closeSubgraph(){if(!(!this._graph_stack||this._graph_stack.length==0)){var n=this.graph._subgraph_node,o=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},o.attachCanvas(this),this.setDirty(!0,!0),n&&(this.centerOnNode(n),this.selectNodes([n])),this.ds.offset=[0,0],this.ds.scale=1}}function getCurrentGraph(){return this.graph}function setCanvas(n,o){var s;if(n&&n.constructor===String&&(n=document.getElementById(n),!n))throw new Error("Error creating LiteGraph canvas: Canvas not found");if(n!==this.canvas&&(!n&&this.canvas&&(o||this.unbindEvents()),this.canvas=n,this.ds.element=n,!!n)){if(n.className+=" lgraphcanvas",n.data=this,n.tabindex="1",this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,n.getContext==null)throw n.localName!="canvas"?new Error("Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+n.localName):new Error("This browser doesn't support Canvas");var a=this.ctx=n.getContext("2d");a==null&&(n.webgl_enabled||(s=LiteGraph.info)==null||s.call(LiteGraph,"This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),o||this.bindEvents()}}function _doNothing(n){return n.preventDefault(),!1}function _doReturnTrue(n){return n.preventDefault(),!0}function bindEvents(){var n;if(this._events_binded){(n=LiteGraph.warn)==null||n.call(LiteGraph,"LGraphCanvas: events already binded");return}this._events_binded=!0;var o=this.canvas,s=this.getCanvasWindow(),a=s.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),o.addEventListener("pointerdown",this._mousedown_callback,!0),o.addEventListener("pointermove",this._mousemove_callback),o.addEventListener("pointerup",this._mouseup_callback,!0),o.addEventListener("contextmenu",this._doNothing),o.addEventListener("wheel",this.processMouseWheel),o.addEventListener("keydown",this.processKey),a.addEventListener("keyup",this.processKey),o.addEventListener("dragover",this._doNothing,!1),o.addEventListener("dragend",this._doNothing,!1),o.addEventListener("drop",this.processDrop),o.addEventListener("dragenter",this._doReturnTrue,!1)}function unbindEvents(){var n;if(!this._events_binded){(n=LiteGraph.warn)==null||n.call(LiteGraph,"LGraphCanvas: no events binded");return}this._events_binded=!1;var o=this.canvas,s=this.getCanvasWindow(),a=s.document;o.removeEventListener("pointerdown",this._mousedown_callback),o.removeEventListener("pointermove",this._mousemove_callback),o.removeEventListener("pointerup",this._mouseup_callback),o.removeEventListener("contextmenu",this._doNothing),o.removeEventListener("wheel",this.processMouseWheel),o.removeEventListener("keydown",this.processKey),a.removeEventListener("keyup",this.processKey),o.removeEventListener("dragover",this._doNothing,!1),o.removeEventListener("dragend",this._doNothing,!1),o.removeEventListener("drop",this.processDrop),o.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null}function enableWebGL(){if(typeof GL=="undefined")throw new Error("litegl.js must be included to use a WebGL canvas");if(typeof enableWebGLCanvas=="undefined")throw new Error("webglCanvas.js must be included to use this feature");this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0}function setDirty(n,o){n&&(this.dirty_canvas=!0),o&&(this.dirty_bgcanvas=!0)}function getCanvasWindow(){var n;if(!this.canvas)return window;var o=this.canvas.ownerDocument;return(n=o.defaultView)!=null?n:o.parentWindow}function startRendering(){if(this.is_rendering)return;this.is_rendering=!0,n.call(this);function n(){this.pause_rendering||this.draw();var o=this.getCanvasWindow();this.is_rendering&&o.requestAnimationFrame(n.bind(this))}}function stopRendering(){this.is_rendering=!1}function resize(n,o){if(!n&&!o){var s=this.canvas.parentNode;n=s.offsetWidth,o=s.offsetHeight}this.canvas.width==n&&this.canvas.height==o||(this.canvas.width=n,this.canvas.height=o,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))}function switchLiveMode(n){if(!n){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var o=this,s=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var a=setInterval(function(){o.editor_alpha*=s,o.dirty_canvas=!0,o.dirty_bgcanvas=!0,s<1&&o.editor_alpha<.01&&(clearInterval(a),s<1&&(o.live_mode=!0)),s>1&&o.editor_alpha>.99&&(clearInterval(a),o.editor_alpha=1)},1)}function centerOnNode(n){this.ds.offset[0]=-n.pos[0]-n.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-n.pos[1]-n.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)}function adjustMouseEvent(n){var o=0,s=0;if(this.canvas){var a=this.canvas.getBoundingClientRect();o=n.clientX-a.left,s=n.clientY-a.top}else o=n.clientX,s=n.clientY;this.last_mouse_position[0]=o,this.last_mouse_position[1]=s,n.canvasX=o/this.ds.scale-this.ds.offset[0],n.canvasY=s/this.ds.scale-this.ds.offset[1]}function setZoom(n,o){this.ds.changeScale(n,o),this.dirty_canvas=!0,this.dirty_bgcanvas=!0}function convertOffsetToCanvas(n,o){return this.ds.convertOffsetToCanvas(n,o)}function convertCanvasToOffset(n,o){return this.ds.convertCanvasToOffset(n,o)}function convertEventToCanvasOffset(n){var o=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([n.clientX-o.left,n.clientY-o.top])}const temp=new Float32Array(4),temp_vec2=new Float32Array(2),tmp_area=new Float32Array(4),margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);function isOverNodeBox(n,o,s){var a=LiteGraph.NODE_TITLE_HEIGHT;return!!LiteGraph.isInsideRectangle(o,s,n.pos[0]+2,n.pos[1]+2-a,a-4,a-4)}function isOverNodeInput(n,o,s,a){if(n.inputs)for(let h=0,c=n.inputs.length;h<c;++h){var r=n.getConnectionPos(!0,h),l=!1;if(n.horizontal?l=LiteGraph.isInsideRectangle(o,s,r[0]-5,r[1]-10,10,20):l=LiteGraph.isInsideRectangle(o,s,r[0]-10,r[1]-5,40,10),l)return a&&(a[0]=r[0],a[1]=r[1]),h}return-1}function isOverNodeOutput(n,o,s,a){if(n.outputs)for(let h=0,c=n.outputs.length;h<c;++h){var r=n.getConnectionPos(!1,h),l=!1;if(n.horizontal?l=LiteGraph.isInsideRectangle(o,s,r[0]-5,r[1]-10,10,20):l=LiteGraph.isInsideRectangle(o,s,r[0]-10,r[1]-5,40,10),l)return a&&(a[0]=r[0],a[1]=r[1]),h}return-1}function bringToFront(n){var o=this.graph._nodes.indexOf(n);o!=-1&&(this.graph._nodes.splice(o,1),this.graph._nodes.push(n))}function sendToBack(n){var o=this.graph._nodes.indexOf(n);o!=-1&&(this.graph._nodes.splice(o,1),this.graph._nodes.unshift(n))}function computeVisibleNodes(n,o){var s=o||[];s.length=0,n=n||this.graph._nodes;for(var a=0,r=n.length;a<r;++a){var l=n[a];this.live_mode&&!l.onDrawBackground&&!l.onDrawForeground||LiteGraph.overlapBounding(this.visible_area,l.getBounding(temp,!0))&&s.push(l)}return s}class CoreController{constructor(o){this.host=o}clear(...o){return clear.apply(this.host,o)}setGraph(...o){return setGraph.apply(this.host,o)}getTopGraph(...o){return getTopGraph.apply(this.host,o)}openSubgraph(...o){return openSubgraph.apply(this.host,o)}closeSubgraph(...o){return closeSubgraph.apply(this.host,o)}getCurrentGraph(...o){return getCurrentGraph.apply(this.host,o)}setCanvas(...o){return setCanvas.apply(this.host,o)}_doNothing(...o){return _doNothing.apply(this.host,o)}_doReturnTrue(...o){return _doReturnTrue.apply(this.host,o)}bindEvents(...o){return bindEvents.apply(this.host,o)}unbindEvents(...o){return unbindEvents.apply(this.host,o)}enableWebGL(...o){return enableWebGL.apply(this.host,o)}setDirty(...o){return setDirty.apply(this.host,o)}getCanvasWindow(...o){return getCanvasWindow.apply(this.host,o)}startRendering(...o){return startRendering.apply(this.host,o)}stopRendering(...o){return stopRendering.apply(this.host,o)}resize(...o){return resize.apply(this.host,o)}switchLiveMode(...o){return switchLiveMode.apply(this.host,o)}centerOnNode(...o){return centerOnNode.apply(this.host,o)}adjustMouseEvent(...o){return adjustMouseEvent.apply(this.host,o)}setZoom(...o){return setZoom.apply(this.host,o)}convertOffsetToCanvas(...o){return convertOffsetToCanvas.apply(this.host,o)}convertCanvasToOffset(...o){return convertCanvasToOffset.apply(this.host,o)}convertEventToCanvasOffset(...o){return convertEventToCanvasOffset.apply(this.host,o)}isOverNodeBox(...o){return isOverNodeBox.apply(this.host,o)}isOverNodeInput(...o){return isOverNodeInput.apply(this.host,o)}isOverNodeOutput(...o){return isOverNodeOutput.apply(this.host,o)}bringToFront(...o){return bringToFront.apply(this.host,o)}sendToBack(...o){return sendToBack.apply(this.host,o)}computeVisibleNodes(...o){return computeVisibleNodes.apply(this.host,o)}}function processUserInputDown(n){var o,s;if(this.pointer_is_down&&n.isPrimary!==void 0&&!n.isPrimary?this.userInput_isNotPrimary=!0:this.userInput_isNotPrimary=!1,this.userInput_type=n.pointerType?n.pointerType:!1,this.userInput_id=n.pointerId?n.pointerId:!1,n.pointerType)switch(n.pointerType){case"mouse":break;case"pen":break;case"touch":break;default:(o=LiteGraph.log)==null||o.call(LiteGraph,"pointerType unknown "+ev.pointerType)}return n.button!==void 0&&(this.userInput_button=n.button,n.button),n.buttons!==void 0&&(this.userInput_button_s=n.buttons),this.userInput_touches=n.changedTouches!==void 0&&n.changedTouches.length!==void 0?n.changedTouches:!1,this.userInput_touches&&this.userInput_touches.length&&((s=LiteGraph.debug)==null||s.call(LiteGraph,"check multiTouches",n.changedTouches)),this.processMouseDown(n)}function processMouseDown(n){var o,s,a,r,l,h,c,p,u;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(n);var d=this.getCanvasWindow();LGraphCanvas.active_canvas=this;var f=n.clientX,L=n.clientY;(o=LiteGraph.log)==null||o.call(LiteGraph,"pointerevents: processMouseDown pointerId:"+n.pointerId+" which:"+n.which+" isPrimary:"+n.isPrimary+" :: x y "+f+" "+L,"previousClick",this.last_mouseclick,"diffTimeClick",this.last_mouseclick?LiteGraph.getTime()-this.last_mouseclick:"notlast"),this.ds.viewport=this.viewport;var g=!this.viewport||this.viewport&&f>=this.viewport[0]&&f<this.viewport[0]+this.viewport[2]&&L>=this.viewport[1]&&L<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(this.canvas.removeEventListener("pointermove",this._mousemove_callback),d.document.addEventListener("pointermove",this._mousemove_callback,!0),d.document.addEventListener("pointerup",this._mouseup_callback,!0)),!!g){var _=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes,5),m=!1,b=LiteGraph.getTime(),G=n.isPrimary===void 0||n.isPrimary,C=b-this.last_mouseclick<300&&G;if(this.mouse[0]=n.clientX,this.mouse[1]=n.clientY,this.graph_mouse[0]=n.canvasX,this.graph_mouse[1]=n.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&G?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.ContextMenu.closeAll(d),!((s=this.onMouse)!=null&&s.call(this,n))){if(n.which==1&&!this.userInput_isNotPrimary){if(n.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=n.canvasX,this.dragging_rectangle[1]=n.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,m=!0),LiteGraph.alt_drag_do_clone_nodes&&n.altKey&&_&&this.allow_interaction&&!m&&!this.read_only){let M=_,z=_.clone();if(z){if(z.pos[0]+=5,z.pos[1]+=5,this.graph.add(z,!1,{doCalcSize:!1}),_=z,LiteGraph.alt_shift_drag_connect_clone_with_input&&n.shiftKey&&M.inputs&&M.inputs.length)for(var E=0;E<M.inputs.length;++E){var k=M.inputs[E];if(!(!k||k.link==null)){var A=this.graph.links[k.link];if(A&&A.type!==LiteGraph.EVENT){var D;A.origin_id&&(D=this.graph.getNodeById(A.origin_id));var I=_;D&&I&&D.connect(A.origin_slot,I,A.target_slot)}}}m=!0,N||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=_),this.selected_nodes[_.id]||this.processNodeSelected(_,n))}}var T=!1;if(_&&(this.allow_interaction||_.flags.allow_interaction)&&!m&&!this.read_only){if(!this.live_mode&&!_.flags.pinned&&this.bringToFront(_),this.allow_interaction&&!this.connecting_node&&!_.flags.collapsed&&!this.live_mode)if(!m&&_.resizable!==!1&&LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,_.pos[0]+_.size[0]-5,_.pos[1]+_.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=_,this.canvas.style.cursor="se-resize",m=!0;else{if(_.outputs)for(let M=0,z=_.outputs.length;M<z;++M){let Y=_.outputs[M],B=_.getConnectionPos(!1,M);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,B[0]-15,B[1]-10,30,20)){this.connecting_node=_,this.connecting_output=Y,this.connecting_output.slot_index=M,this.connecting_pos=_.getConnectionPos(!1,M),this.connecting_slot=M,LiteGraph.shift_click_do_break_link_from&&n.shiftKey&&_.disconnectOutput(M),C?(a=_.onOutputDblClick)==null||a.call(_,M,n):(r=_.onOutputClick)==null||r.call(_,M,n),m=!0;break}}if(_.inputs)for(let M=0,z=_.inputs.length;M<z;++M){let Y=_.inputs[M],B=_.getConnectionPos(!0,M);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,B[0]-15,B[1]-10,30,20)){if(C?(l=_.onInputDblClick)==null||l.call(_,M,n):(h=_.onInputClick)==null||h.call(_,M,n),Y.link!==null){var S=this.graph.links[Y.link];LiteGraph.click_do_break_link_to&&(_.disconnectInput(M),this.dirty_bgcanvas=!0,m=!0),n.shiftKey&&(LiteGraph.click_do_break_link_to||_.disconnectInput(M),this.connecting_node=this.graph._nodes_by_id[S.origin_id],this.connecting_slot=S.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,m=!0)}m||(this.connecting_node=_,this.connecting_input=Y,this.connecting_input.slot_index=M,this.connecting_pos=_.getConnectionPos(!0,M),this.connecting_slot=M,this.dirty_bgcanvas=!0,m=!0)}}}if(!m){var N=!1,O=[n.canvasX-_.pos[0],n.canvasY-_.pos[1]],P=this.processNodeWidgets(_,this.graph_mouse,n);P&&(N=!0,this.node_widget=[_,P]),this.allow_interaction&&C&&this.selected_nodes[_.id]&&((c=_.onDblClick)==null||c.call(_,n,O,this),this.processNodeDblClicked(_),N=!0),_.onMouseDown&&_.onMouseDown(n,O,this)?N=!0:(_.subgraph&&!_.skip_subgraph_button&&!_.flags.collapsed&&O[0]>_.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&O[1]<0&&setTimeout(()=>{this.openSubgraph(_.subgraph)},10),this.live_mode&&(T=!0,N=!0)),N?_.is_selected||this.processNodeSelected(_,n):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=_),this.processNodeSelected(_,n)),this.dirty_canvas=!0}}else if(!m){if(!this.read_only)for(let M=0;M<this.visible_links.length;++M){var j=this.visible_links[M],V=j._pos;if(!(!V||n.canvasX<V[0]-4||n.canvasX>V[0]+4||n.canvasY<V[1]-4||n.canvasY>V[1]+4)){this.showLinkMenu(j,n),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(n.canvasX,n.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){n.ctrlKey&&(this.dragging_rectangle=null);var q=LiteGraph.distance([n.canvasX,n.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);q*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}C&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(n),n.preventDefault(),n.stopPropagation()),(p=LiteGraph.debug)==null||p.call(LiteGraph,"DEBUG canvas click is_double_click,this.allow_searchbox",C,this.allow_searchbox),T=!0}!m&&T&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(n.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(_&&this.allow_interaction&&!m&&!this.read_only&&!this.connecting_node&&!_.flags.collapsed&&!this.live_mode){var J=!1,H=!1,$=!1;if(_.outputs)for(let M=0,z=_.outputs.length;M<z;++M){var F=_.outputs[M];let Y=_.getConnectionPos(!1,M);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,Y[0]-15,Y[1]-10,30,20)){J=F,H=M,$=!0;break}}if(_.inputs)for(let M=0,z=_.inputs.length;M<z;++M){var k=_.inputs[M];let B=_.getConnectionPos(!0,M);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,B[0]-15,B[1]-10,30,20)){J=k,H=M,$=!1;break}}if(J&&H!==!1){var R=.5-(H+1)/($?_.outputs.length:_.inputs.length),W=_.getBounding(),pe=[$?W[0]+W[2]:W[0],n.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:$?_:null,slotFrom:$?H:null,nodeTo:$?null:_,slotTo:$?null:H,position:pe,nodeType:"AUTO",posAdd:[$?30:-30,-R*130],posSizeFix:[$?0:-1,0]})}}}else!m&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(n.which==3||LiteGraph.two_fingers_opens_menu&&this.userInput_isNotPrimary)&&this.allow_interaction&&!m&&!this.read_only&&(_&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[_.id]||n.shiftKey||n.ctrlKey||n.metaKey)?this.selected_nodes[_.id]||this.selectNodes([_],!0):this.selectNodes([_])),this.processContextMenu(_,n));return this.last_mouse[0]=n.clientX,this.last_mouse[1]=n.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!d.document.activeElement||d.document.activeElement.nodeName.toLowerCase()!="input"&&d.document.activeElement.nodeName.toLowerCase()!="textarea")&&n.preventDefault(),n.stopPropagation(),(u=this.onMouseDown)==null||u.call(this,n),!1}}}}function processMouseMove(n){var o,s;if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(n);var a=[n.clientX,n.clientY];this.mouse[0]=a[0],this.mouse[1]=a[1];var r=[a[0]-this.last_mouse[0],a[1]-this.last_mouse[1]];if(this.last_mouse=a,this.graph_mouse[0]=n.canvasX,this.graph_mouse[1]=n.canvasY,this.block_click)return n.preventDefault(),!1;n.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,n,this.node_widget[1]),this.dirty_canvas=!0);var l=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=n.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=n.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[n.canvasX-this.selected_group.pos[0],n.canvasY-this.selected_group.pos[1]];else{var h=r[0]/this.ds.scale,c=r[1]/this.ds.scale;this.selected_group.move(h,c,n.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=r[0]/this.ds.scale,this.ds.offset[1]+=r[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||l&&l.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(let g=0,_=this.graph._nodes.length;g<_;++g)this.graph._nodes[g].mouseOver&&l!=this.graph._nodes[g]&&(this.graph._nodes[g].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(n),this.node_over=null,this.dirty_canvas=!0);if(l){if(l.redraw_on_mouse&&(this.dirty_canvas=!0),l.mouseOver||(l.mouseOver=!0,this.node_over=l,this.dirty_canvas=!0,(o=l.onMouseEnter)==null||o.call(l,n)),(s=l.onMouseMove)==null||s.call(l,n,[n.canvasX-l.pos[0],n.canvasY-l.pos[1]],this),this.connecting_node){let g;if(this.connecting_output){if(g=this._highlight_input||[0,0],!this.isOverNodeBox(l,n.canvasX,n.canvasY)){let _=this.isOverNodeInput(l,n.canvasX,n.canvasY,g);if(_!=-1&&l.inputs[_]){let m=l.inputs[_].type;LiteGraph.isValidConnection(this.connecting_output.type,m)&&(this._highlight_input=g,this._highlight_input_slot=l.inputs[_])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input&&(g=this._highlight_output||[0,0],this.isOverNodeBox(l,n.canvasX,n.canvasY))){let _=this.isOverNodeOutput(l,n.canvasX,n.canvasY,g);if(_!=-1&&l.outputs[_]){let m=l.outputs[_].type;LiteGraph.isValidConnection(this.connecting_input.type,m)&&(this._highlight_output=g)}else this._highlight_output=null}}this.canvas&&(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,l.pos[0]+l.size[0]-5,l.pos[1]+l.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var p=null;for(let g=0;g<this.visible_links.length;++g){var u=this.visible_links[g],d=u._pos;if(!(!d||n.canvasX<d[0]-4||n.canvasX>d[0]+4||n.canvasY<d[1]-4||n.canvasY>d[1]+4)){p=u;break}}p!=this.over_link_center&&(this.over_link_center=p,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=l&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(n,[n.canvasX-this.node_capturing_input.pos[0],n.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(let g in this.selected_nodes){let _=this.selected_nodes[g];_.pos[0]+=r[0]/this.ds.scale,_.pos[1]+=r[1]/this.ds.scale,_.is_selected||this.processNodeSelected(_,n)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var f=[n.canvasX-this.resizing_node.pos[0],n.canvasY-this.resizing_node.pos[1]],L=this.resizing_node.computeSize();f[0]=Math.max(L[0],f[0]),f[1]=Math.max(L[1],f[1]),this.resizing_node.setSize(f),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return n.preventDefault(),!1}}function processMouseUp(n){var o,s=n.isPrimary===void 0||n.isPrimary;if(!s)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var a=this.getCanvasWindow(),r=a.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(r.removeEventListener("pointermove",this._mousemove_callback,!0),this.canvas.addEventListener("pointermove",this._mousemove_callback,!0),r.removeEventListener("pointerup",this._mouseup_callback,!0)),this.adjustMouseEvent(n);var l=LiteGraph.getTime();if(n.click_time=l-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),n.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,n),this.node_widget=null,this.selected_group){var h=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),c=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(h,c,n.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var p=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var u=this.graph._nodes,d=new Float32Array(4),f=Math.abs(this.dragging_rectangle[2]),L=Math.abs(this.dragging_rectangle[3]),g=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-f:this.dragging_rectangle[0],_=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-L:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=g,this.dragging_rectangle[1]=_,this.dragging_rectangle[2]=f,this.dragging_rectangle[3]=L,!p||f>10&&L>10){var m=[];for(let E=0;E<u.length;++E){var b=u[E];b.getBounding(d),LiteGraph.overlapBounding(this.dragging_rectangle,d)&&m.push(b)}m.length&&this.selectNodes(m,n.shiftKey)}else this.selectNodes([p],n.shiftKey||n.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var G=this.connecting_output||this.connecting_input,C=G.type;if(p=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes),p){let E;this.connecting_output?(E=this.isOverNodeInput(p,n.canvasX,n.canvasY),E!=-1?this.connecting_node.connect(this.connecting_slot,p,E):this.connecting_node.connectByType(this.connecting_slot,p,C)):this.connecting_input&&(E=this.isOverNodeOutput(p,n.canvasX,n.canvasY),E!=-1?p.connect(E,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,p,C))}else LiteGraph.release_link_on_empty_shows_menu&&(n.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(n,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(n,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:n}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:n}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null):this.node_dragged?(p=this.node_dragged,p&&n.click_time<300&&LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,p.pos[0],p.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&p.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),(o=this.onNodeMoved)==null||o.call(this,this.node_dragged),this.graph.onGraphChanged({action:"nodeDrag",doSave:!0}),this.graph.afterChange(this.node_dragged),this.node_dragged=null):(p=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes),!p&&n.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(n,[n.canvasX-this.node_over.pos[0],n.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(n,[n.canvasX-this.node_capturing_input.pos[0],n.canvasY-this.node_capturing_input.pos[1]]))}else n.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):n.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return s&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),n.stopPropagation(),n.preventDefault(),!1}}function processMouseWheel(n){if(!(!this.graph||!this.allow_dragcanvas)){var o=n.wheelDeltaY!=null?n.wheelDeltaY:n.detail*-60;this.adjustMouseEvent(n);var s=n.clientX,a=n.clientY,r=!this.viewport||this.viewport&&s>=this.viewport[0]&&s<this.viewport[0]+this.viewport[2]&&a>=this.viewport[1]&&a<this.viewport[1]+this.viewport[3];if(r){var l=this.ds.scale;return l*=Math.pow(1.1,o*.01),this.ds.changeScale(l,[n.clientX,n.clientY]),this.graph.change(),n.preventDefault(),!1}}}function blockClick(){this.block_click=!0,this.last_mouseclick=0}function processKey(n){var o,s,a,r,l;if(this.graph){var h=!1;if(n.target.localName!="input"){if(n.type=="keydown"){if(n.keyCode==32&&(this.dragging_canvas=!0,h=!0),n.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),h=!0),n.keyCode==65&&n.ctrlKey&&(this.selectNodes(),h=!0),n.keyCode===67&&(n.metaKey||n.ctrlKey)&&!n.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),h=!0),n.keyCode===86&&(n.metaKey||n.ctrlKey)&&this.pasteFromClipboard(n.shiftKey),(n.keyCode==46||LiteGraph.backspace_delete&&n.keyCode==8)&&n.target.localName!="input"&&n.target.localName!="textarea"&&(this.deleteSelectedNodes(),h=!0),LiteGraph.actionHistory_enabled&&(n.keyCode==89&&n.ctrlKey||n.keyCode==90&&n.ctrlKey&&n.shiftKey?this.graph.actionHistoryForward():n.keyCode==90&&n.ctrlKey&&this.graph.actionHistoryBack()),(o=LiteGraph.debug)==null||o.call(LiteGraph,"Canvas keydown "+n.keyCode),this.selected_nodes)for(let c in this.selected_nodes)(a=(s=this.selected_nodes[c]).onKeyDown)==null||a.call(s,n)}else if(n.type=="keyup"&&(n.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(let c in this.selected_nodes)(l=(r=this.selected_nodes[c]).onKeyUp)==null||l.call(r,n);if(this.graph.change(),h)return n.preventDefault(),n.stopImmediatePropagation(),!1}}}function processDrop(n){n.preventDefault(),this.adjustMouseEvent(n);var o=n.clientX,s=n.clientY,a=!this.viewport||this.viewport&&o>=this.viewport[0]&&o<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3];if(a){o=n.localX,s=n.localY;var a=!this.viewport||this.viewport&&o>=this.viewport[0]&&o<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3];if(a){var r=[n.canvasX,n.canvasY],l=this.graph?this.graph.getNodeOnPos(r[0],r[1]):null;if(!l){var h=null;this.onDropItem&&(h=this.onDropItem(event)),h||this.checkDropItem(n);return}if(l.onDropFile||l.onDropData){var c=n.dataTransfer.files;if(c&&c.length)for(let g=0;g<c.length;g++){var p=n.dataTransfer.files[0],u=p.name;if(l.onDropFile&&l.onDropFile(p),l.onDropData){var d=new FileReader;d.onload=function(_){var m=_.target.result;l.onDropData(m,u,p)};var f=p.type.split("/")[0];f=="text"||f==""?d.readAsText(p):f=="image"?d.readAsDataURL(p):d.readAsArrayBuffer(p)}}}return l.onDropItem&&l.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}}}function checkDropItem(n){var o;if(n.dataTransfer.files.length){var s=n.dataTransfer.files[0],a=LGraphCanvas.getFileExtension(s.name).toLowerCase(),r=LiteGraph.node_types_by_file_extension[a];if(r){this.graph.beforeChange();var l=LiteGraph.createNode(r.type);l.pos=[n.canvasX,n.canvasY],this.graph.add(l,!1,{doProcessChange:!1}),(o=l.onDropFile)==null||o.call(l,s),this.graph.onGraphChanged({action:"fileDrop",doSave:!0}),this.graph.afterChange()}}}class EventsController{constructor(o){this.host=o}processUserInputDown(...o){return processUserInputDown.apply(this.host,o)}processMouseDown(...o){return processMouseDown.apply(this.host,o)}processMouseMove(...o){return processMouseMove.apply(this.host,o)}processMouseUp(...o){return processMouseUp.apply(this.host,o)}processMouseWheel(...o){return processMouseWheel.apply(this.host,o)}blockClick(...o){return blockClick.apply(this.host,o)}processKey(...o){return processKey.apply(this.host,o)}processDrop(...o){return processDrop.apply(this.host,o)}checkDropItem(...o){return checkDropItem.apply(this.host,o)}}function draw(n,o){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var s=LiteGraph.getTime();this.render_time=(s-this.last_draw_time)*.001,this.last_draw_time=s,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||o||this.always_render_background||this.graph&&this.graph._last_trigger_time&&s-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas();var a=this.dirty_canvas||n;if(a&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1,this.ds.scale<.7){if(a){var r=this.low_quality_rendering_threshold;const l=45;this.fps<l?(this.low_quality_rendering_counter+=l/this.fps,this.low_quality_rendering_counter=Math.min(this.low_quality_rendering_counter,2*r)):(this.low_quality_rendering_counter-=this.fps/l*.01,this.low_quality_rendering_counter=Math.max(this.low_quality_rendering_counter,0))}}else this.low_quality_rendering_counter=0}}function drawFrontCanvas(){var n,o,s,a,r;this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var l=this.ctx;if(l){var h=this.canvas;l.start2D&&!this.viewport&&(l.start2D(),l.restore(),l.setTransform(1,0,0,1,0,0));var c=this.viewport||this.dirty_area;if(c&&(l.save(),l.beginPath(),l.rect(c[0],c[1],c[2],c[3]),l.clip()),this.clear_background&&(c?l.clearRect(c[0],c[1],c[2],c[3]):l.clearRect(0,0,h.width,h.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():l.drawImage(this.bgcanvas,0,0),(n=this.onRender)==null||n.call(this,h,l),this.show_info&&this.renderInfo(l,c?c[0]:0,c?c[1]:0),this.graph){l.save(),this.ds.toCanvasContext(l);var p=this.computeVisibleNodes(null,this.visible_nodes);for(let m=0;m<p.length;++m){let b=p[m];l.save(),l.translate(b.pos[0],b.pos[1]),this.drawNode(b,l),l.restore()}if(this.render_execution_order&&this.drawExecutionOrder(l),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(l)),this.connecting_pos!=null){l.lineWidth=this.connections_width;var u=null,d=this.connecting_output||this.connecting_input,f=d.type,L=d.dir;L==null&&(this.connecting_output?L=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:L=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var g=d.shape;switch(f){case LiteGraph.EVENT:case LiteGraph.ACTION:u=LiteGraph.EVENT_LINK_COLOR;break;default:u=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(l,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,u,L,LiteGraph.CENTER),l.beginPath(),f===LiteGraph.EVENT||f===LiteGraph.ACTION||g===LiteGraph.BOX_SHAPE?(l.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),l.fill(),l.beginPath(),l.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):g===LiteGraph.ARROW_SHAPE?(l.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),l.closePath()):(l.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),l.fill(),l.beginPath(),l.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),l.fill(),l.fillStyle="#ffcc00",this._highlight_input){l.beginPath();var _=this._highlight_input_slot.shape;_===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),l.closePath()):l.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),l.fill()}this._highlight_output&&(l.beginPath(),_===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),l.closePath()):l.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),l.fill())}this.dragging_rectangle&&(l.strokeStyle="#FFF",l.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(l,this.over_link_center):(o=this.onDrawLinkTooltip)==null||o.call(this,l,null),(s=this.onDrawForeground)==null||s.call(this,l,this.visible_rect),l.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(l),(a=this.onDrawOverlay)==null||a.call(this,l),c&&l.restore(),(r=l.finish2D)==null||r.call(l)}}function lowQualityRenderingRequired(n){return this.ds.scale<n?this.low_quality_rendering_counter>this.low_quality_rendering_threshold:!1}function drawNode(n,o){var s,a,r;this.current_node=n;var l=n.color||n.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,h=n.bgcolor||n.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR,c=this.ds.scale<.6;if(this.live_mode){n.flags.collapsed||(o.shadowColor="transparent",(s=n.onDrawForeground)==null||s.call(n,o,this,this.canvas));return}var p=this.editor_alpha;if(o.globalAlpha=p,this.render_shadows&&!c?(o.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,o.shadowOffsetX=2*this.ds.scale,o.shadowOffsetY=2*this.ds.scale,o.shadowBlur=3*this.ds.scale):o.shadowColor="transparent",!(n.flags.collapsed&&(a=n.onDrawCollapsed)!=null&&a.call(n,o,this))){var u=n._shape||LiteGraph.BOX_SHAPE,d=temp_vec2;temp_vec2.set(n.size);var f=n.horizontal;if(n.flags.collapsed){o.font=this.inner_text_font;var L=n.getTitle?n.getTitle():n.title;L!=null&&(n._collapsed_width=Math.min(n.size[0],o.measureText(L).width+LiteGraph.NODE_TITLE_HEIGHT*2),d[0]=n._collapsed_width,d[1]=0)}(n.clip_area||this.clip_all_nodes)&&(o.save(),o.beginPath(),u==LiteGraph.BOX_SHAPE?o.rect(0,0,d[0],d[1]):u==LiteGraph.ROUND_SHAPE?o.roundRect(0,0,d[0],d[1],[10]):u==LiteGraph.CIRCLE_SHAPE&&o.arc(d[0]*.5,d[1]*.5,d[0]*.5,0,Math.PI*2),o.clip()),n.has_errors&&(h="red"),this.drawNodeShape(n,o,d,l,h,n.is_selected,n.mouseOver),o.shadowColor="transparent",(r=n.onDrawForeground)==null||r.call(n,o,this,this.canvas),LiteGraph.show_node_tooltip&&n.mouseOver&&n.is_selected&&(!this.selected_nodes||Object.keys(this.selected_nodes).length<=1)&&this.drawNodeTooltip(o,n),o.textAlign=f?"center":"left",o.font=this.inner_text_font;var g=!this.lowQualityRenderingRequired(.6),_=this.connecting_output,m=this.connecting_input;o.lineWidth=1;var b=0,G=new Float32Array(2),C;if(n.flags.collapsed){if(this.render_collapsed_slots){var E=null,k=null;if(n.inputs)for(let I=0;I<n.inputs.length;I++){var A=n.inputs[I];if(A.link!=null){E=A;break}}if(n.outputs)for(let I=0;I<n.outputs.length;I++){var A=n.outputs[I];!A.links||!A.links.length||(k=A)}if(E){let I=0,T=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(I=n._collapsed_width*.5,T=-LiteGraph.NODE_TITLE_HEIGHT),o.fillStyle="#686",o.beginPath(),A.type===LiteGraph.EVENT||A.type===LiteGraph.ACTION||A.shape===LiteGraph.BOX_SHAPE?o.rect(I-7+.5,T-4,14,8):A.shape===LiteGraph.ARROW_SHAPE?(o.moveTo(I+8,T),o.lineTo(I+-4,T-4),o.lineTo(I+-4,T+4),o.closePath()):o.arc(I,T,4,0,Math.PI*2),o.fill()}if(k){let I=n._collapsed_width,T=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(I=n._collapsed_width*.5,T=0),o.fillStyle="#686",o.strokeStyle="black",o.beginPath(),A.type===LiteGraph.EVENT||A.type===LiteGraph.ACTION||A.shape===LiteGraph.BOX_SHAPE?o.rect(I-7+.5,T-4,14,8):A.shape===LiteGraph.ARROW_SHAPE?(o.moveTo(I+6,T),o.lineTo(I-6,T-4),o.lineTo(I-6,T+4),o.closePath()):o.arc(I,T,4,0,Math.PI*2),o.fill()}}}else{if(n.inputs)for(let I=0;I<n.inputs.length;I++){let T=n.inputs[I],S=T.type,N=T.shape;o.globalAlpha=p,this.connecting_output&&!LiteGraph.isValidConnection(T.type,_.type)&&(o.globalAlpha=.4*p),o.fillStyle=T.link!=null?T.color_on||this.default_connection_color_byType[S]||this.default_connection_color.input_on:T.color_off||this.default_connection_color_byTypeOff[S]||this.default_connection_color_byType[S]||this.default_connection_color.input_off;let O=n.getConnectionPos(!0,I,G);if(O[0]-=n.pos[0],O[1]-=n.pos[1],b<O[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(b=O[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),o.beginPath(),S=="array"?N=LiteGraph.GRID_SHAPE:T.name=="onTrigger"||T.name=="onExecuted"?N=LiteGraph.ARROW_SHAPE:(S===LiteGraph.EVENT||S===LiteGraph.ACTION)&&(N=LiteGraph.BOX_SHAPE),C=!0,N===LiteGraph.BOX_SHAPE?f?o.rect(O[0]-5+.5,O[1]-8+.5,10,14):o.rect(O[0]-6+.5,O[1]-5+.5,14,10):N===LiteGraph.ARROW_SHAPE?(o.moveTo(O[0]+8,O[1]+.5),o.lineTo(O[0]-4,O[1]+6+.5),o.lineTo(O[0]-4,O[1]-6+.5),o.closePath()):N===LiteGraph.GRID_SHAPE?(o.rect(O[0]-4,O[1]-4,2,2),o.rect(O[0]-1,O[1]-4,2,2),o.rect(O[0]+2,O[1]-4,2,2),o.rect(O[0]-4,O[1]-1,2,2),o.rect(O[0]-1,O[1]-1,2,2),o.rect(O[0]+2,O[1]-1,2,2),o.rect(O[0]-4,O[1]+2,2,2),o.rect(O[0]-1,O[1]+2,2,2),o.rect(O[0]+2,O[1]+2,2,2),C=!1):c?o.rect(O[0]-4,O[1]-4,8,8):o.arc(O[0],O[1],4,0,Math.PI*2),o.fill(),g&&!(T.name=="onTrigger"||T.name=="onExecuted")){let P=T.label!=null?T.label:T.name;P&&(o.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||T.dir==LiteGraph.UP?o.fillText(P,O[0],O[1]-10):o.fillText(P,O[0]+10,O[1]+5))}}if(o.textAlign=f?"center":"right",o.strokeStyle="black",n.outputs)for(let I=0;I<n.outputs.length;I++){let T=n.outputs[I],S=T.type,N=T.shape;this.connecting_input&&!LiteGraph.isValidConnection(S,m.type)&&(o.globalAlpha=.4*p);let O=n.getConnectionPos(!1,I,G);if(O[0]-=n.pos[0],O[1]-=n.pos[1],b<O[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(b=O[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),o.fillStyle=T.links&&T.links.length?T.color_on||this.default_connection_color_byType[S]||this.default_connection_color.output_on:T.color_off||this.default_connection_color_byTypeOff[S]||this.default_connection_color_byType[S]||this.default_connection_color.output_off,o.beginPath(),S=="array"?N=LiteGraph.GRID_SHAPE:T.name=="onTrigger"||T.name=="onExecuted"?N=LiteGraph.ARROW_SHAPE:(S===LiteGraph.EVENT||S===LiteGraph.ACTION)&&(N=LiteGraph.BOX_SHAPE),C=!0,N===LiteGraph.BOX_SHAPE?f?o.rect(O[0]-5+.5,O[1]-8+.5,10,14):o.rect(O[0]-6+.5,O[1]-5+.5,14,10):N===LiteGraph.ARROW_SHAPE?(o.moveTo(O[0]+8,O[1]+.5),o.lineTo(O[0]-4,O[1]+6+.5),o.lineTo(O[0]-4,O[1]-6+.5),o.closePath()):N===LiteGraph.GRID_SHAPE?(o.rect(O[0]-4,O[1]-4,2,2),o.rect(O[0]-1,O[1]-4,2,2),o.rect(O[0]+2,O[1]-4,2,2),o.rect(O[0]-4,O[1]-1,2,2),o.rect(O[0]-1,O[1]-1,2,2),o.rect(O[0]+2,O[1]-1,2,2),o.rect(O[0]-4,O[1]+2,2,2),o.rect(O[0]-1,O[1]+2,2,2),o.rect(O[0]+2,O[1]+2,2,2),C=!1):c?o.rect(O[0]-4,O[1]-4,8,8):o.arc(O[0],O[1],4,0,Math.PI*2),o.fill(),!c&&C&&o.stroke(),g&&!(T.name=="onTrigger"||T.name=="onExecuted")){let P=T.label!=null?T.label:T.name;P&&(o.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||T.dir==LiteGraph.DOWN?o.fillText(P,O[0],O[1]-8):o.fillText(P,O[0]-10,O[1]+5))}}if(o.textAlign="left",o.globalAlpha=1,n.widgets){var D=b;(f||n.widgets_up)&&(D=2),n.widgets_start_y!=null&&(D=n.widgets_start_y),this.drawNodeWidgets(n,D,o,this.node_widget&&this.node_widget[0]==n?this.node_widget[1]:null)}}(n.clip_area||this.clip_all_nodes)&&o.restore(),o.globalAlpha=1}}function drawNodeTooltip(n,o){var s;if(!o||!n){(s=LiteGraph.warn)==null||s.call(LiteGraph,"drawNodeTooltip: invalid node or ctx",o,n);return}var a=o.properties.tooltip!=null?o.properties.tooltip:"";if((!a||a=="")&&LiteGraph.show_node_tooltip_use_descr_property&&o.constructor.desc&&(a=o.constructor.desc),a=(a+"").trim(),!(!a||a=="")){var r=[0,-LiteGraph.NODE_TITLE_HEIGHT],l=o.flags.collapsed?[LiteGraph.NODE_COLLAPSED_WIDTH,LiteGraph.NODE_TITLE_HEIGHT]:o.size;n.font="14px Courier New",n.measureText(a);var h=Math.max(o.size[0],160)+20,c=o.ttip_oTMultiRet?o.ttip_oTMultiRet.height+15:21;n.globalAlpha=.7*this.editor_alpha,n.shadowColor=o.ttip_oTMultiRet?"black":"transparent",n.shadowOffsetX=2,n.shadowOffsetY=2,n.shadowBlur=3,n.fillStyle=o.ttip_oTMultiRet?"#454":"transparent",n.beginPath(),n.roundRect(r[0]-h*.5+l[0]/2,r[1]-15-c,h,c,[3]),n.moveTo(r[0]-10+l[0]/2,r[1]-15),n.lineTo(r[0]+10+l[0]/2,r[1]-15),n.lineTo(r[0]+l[0]/2,r[1]-5),n.fill(),n.shadowColor="transparent",n.textAlign="center",n.fillStyle=o.ttip_oTMultiRet?"#CEC":"transparent",n.globalAlpha=this.editor_alpha;var p=LiteGraph.canvasFillTextMultiline(n,a,r[0]+l[0]/2,r[1]-c,h,14);o.ttip_oTMultiRet=p,n.closePath()}}function drawNodeShape(n,o,s,a,r,l,h){var c;o.strokeStyle=a,o.fillStyle=r;var p=LiteGraph.NODE_TITLE_HEIGHT,u=this.lowQualityRenderingRequired(.5),d=n._shape||n.constructor.shape||LiteGraph.ROUND_SHAPE,f=n.constructor.title_mode,L=!0;f==LiteGraph.TRANSPARENT_TITLE||f==LiteGraph.NO_TITLE?L=!1:f==LiteGraph.AUTOHIDE_TITLE&&h&&(L=!0);var g=tmp_area;g[0]=0,g[1]=L?-p:0,g[2]=s[0]+1,g[3]=L?s[1]+p:s[1];var _=o.globalAlpha;if(o.beginPath(),d==LiteGraph.BOX_SHAPE||u?o.fillRect(g[0],g[1],g[2],g[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE?o.roundRect(g[0],g[1],g[2],g[3],d==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):d==LiteGraph.CIRCLE_SHAPE&&o.arc(s[0]*.5,s[1]*.5,s[0]*.5,0,Math.PI*2),o.fill(),!n.flags.collapsed&&L&&(o.shadowColor="transparent",o.fillStyle="rgba(0,0,0,0.2)",o.fillRect(0,-1,g[2],2)),o.shadowColor="transparent",(c=n.onDrawBackground)==null||c.call(n,o,this,this.canvas,this.graph_mouse),L||f==LiteGraph.TRANSPARENT_TITLE){if(n.onDrawTitleBar)n.onDrawTitleBar(o,p,s,this.ds.scale,a);else if(f!=LiteGraph.TRANSPARENT_TITLE&&(n.constructor.title_color||this.render_title_colored)){var m=n.constructor.title_color||a;if(n.flags.collapsed&&(o.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var b=LGraphCanvas.gradients[m];if(!b){b=LGraphCanvas.gradients[m]=o.createLinearGradient(0,0,400,0);try{b.addColorStop(0,m)}catch{b.addColorStop(0,LiteGraph.NODE_DEFAULT_COLOR)}b.addColorStop(1,"#000")}o.fillStyle=b}else o.fillStyle=m;o.beginPath(),d==LiteGraph.BOX_SHAPE||u?o.rect(0,-p,s[0]+1,p):(d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE)&&o.roundRect(0,-p,s[0]+1,p,n.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),o.fill(),o.shadowColor="transparent"}let D=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[n.mode]&&(D=LiteGraph.NODE_MODES_COLORS[n.mode]),LiteGraph.node_box_coloured_when_on&&(D=n.action_triggered?"#FFF":n.execute_triggered?"#AAA":D);var G=10;if(n.onDrawTitleBox?n.onDrawTitleBox(o,p,s,this.ds.scale):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CIRCLE_SHAPE||d==LiteGraph.CARD_SHAPE?(u&&(o.fillStyle="black",o.beginPath(),o.arc(p*.5,p*-.5,G*.5+1,0,Math.PI*2),o.fill()),o.fillStyle=n.boxcolor||D||LiteGraph.NODE_DEFAULT_BOXCOLOR,u?o.fillRect(p*.5-G*.5,p*-.5-G*.5,G,G):(o.beginPath(),o.arc(p*.5,p*-.5,G*.5,0,Math.PI*2),o.fill())):(u&&(o.fillStyle="black",o.fillRect((p-G)*.5-1,(p+G)*-.5-1,G+2,G+2)),o.fillStyle=n.boxcolor||D||LiteGraph.NODE_DEFAULT_BOXCOLOR,o.fillRect((p-G)*.5,(p+G)*-.5,G,G)),o.globalAlpha=_,n.onDrawTitleText&&n.onDrawTitleText(o,p,s,this.ds.scale,this.title_text_font,l),!u){o.font=this.title_text_font;var C=String(n.getTitle());C&&(l?o.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:o.fillStyle=n.constructor.title_text_color||this.node_title_color,n.flags.collapsed?(o.textAlign="left",o.fillText(C.substring(0,20),p,LiteGraph.NODE_TITLE_TEXT_Y-p),o.textAlign="left"):(o.textAlign="left",o.fillText(C,p,LiteGraph.NODE_TITLE_TEXT_Y-p)))}if(!n.flags.collapsed&&n.subgraph&&!n.skip_subgraph_button){var E=LiteGraph.NODE_TITLE_HEIGHT,k=n.size[0]-E,A=LiteGraph.isInsideRectangle(this.graph_mouse[0]-n.pos[0],this.graph_mouse[1]-n.pos[1],k+2,-E+2,E-4,E-4);o.fillStyle=A?"#888":"#555",d==LiteGraph.BOX_SHAPE||u?o.fillRect(k+2,-E+2,E-4,E-4):(o.beginPath(),o.roundRect(k+2,-E+2,E-4,E-4,[4]),o.fill()),o.fillStyle="#333",o.beginPath(),o.moveTo(k+E*.2,-E*.6),o.lineTo(k+E*.8,-E*.6),o.lineTo(k+E*.5,-E*.3),o.fill()}n.onDrawTitle&&n.onDrawTitle(o)}l&&(n.onBounding&&n.onBounding(g),f==LiteGraph.TRANSPARENT_TITLE&&(g[1]-=p,g[3]+=p),o.lineWidth=1,o.globalAlpha=.8,o.beginPath(),d==LiteGraph.BOX_SHAPE?o.rect(-6+g[0],-6+g[1],12+g[2],12+g[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE&&n.flags.collapsed?o.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],[this.round_radius*2]):d==LiteGraph.CARD_SHAPE?o.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],[this.round_radius*2,2,this.round_radius*2,2]):d==LiteGraph.CIRCLE_SHAPE&&o.arc(s[0]*.5,s[1]*.5,s[0]*.5+6,0,Math.PI*2),o.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,o.stroke(),o.strokeStyle=a,o.globalAlpha=1),n.execute_triggered>0&&n.execute_triggered--,n.action_triggered>0&&n.action_triggered--}function drawExecutionOrder(n){n.shadowColor="transparent",n.globalAlpha=.25,n.textAlign="center",n.strokeStyle="white",n.globalAlpha=.75;var o=this.visible_nodes;for(let a=0;a<o.length;++a){var s=o[a];n.fillStyle="black",n.fillRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),s.order==0&&n.strokeRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),n.fillStyle="#FFF",n.fillText(s.order,s.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,s.pos[1]-6)}n.globalAlpha=1}function drawNodeWidgets(n,o,s,a){if(!n.widgets||!n.widgets.length)return 0;var r=n.size[0],l=n.widgets;o+=2;var h=LiteGraph.NODE_WIDGET_HEIGHT,c=!this.lowQualityRenderingRequired(.5);s.save(),s.globalAlpha=this.editor_alpha;var p=LiteGraph.WIDGET_OUTLINE_COLOR,u=LiteGraph.WIDGET_BGCOLOR,d=LiteGraph.WIDGET_TEXT_COLOR,f=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,L=15;for(let A=0;A<l.length;++A){var g=l[A],_=o;g.y&&(_=g.y),g.last_y=_,s.strokeStyle=p,s.fillStyle="#222",s.textAlign="left",g.disabled&&(s.globalAlpha*=.5);var m=g.width||r;switch(g.type){case"button":g.clicked&&(s.fillStyle="#AAA",g.clicked=!1,this.dirty_canvas=!0),s.fillRect(L,_,m-L*2,h),c&&!g.disabled&&s.strokeRect(L,_,m-L*2,h),c&&(s.textAlign="center",s.fillStyle=d,s.fillText(g.label||g.name,m*.5,_+h*.7));break;case"toggle":if(s.textAlign="left",s.strokeStyle=p,s.fillStyle=u,s.beginPath(),c?s.roundRect(L,_,m-L*2,h,[h*.5]):s.rect(L,_,m-L*2,h),s.fill(),c&&!g.disabled&&s.stroke(),s.fillStyle=g.value?"#89A":"#333",s.beginPath(),s.arc(m-L*2,_+h*.5,h*.36,0,Math.PI*2),s.fill(),c){s.fillStyle=f;const D=g.label||g.name;D!=null&&s.fillText(D,L*2,_+h*.7),s.fillStyle=g.value?d:f,s.textAlign="right",s.fillText(g.value?g.options.on||"true":g.options.off||"false",m-40,_+h*.7)}break;case"slider":s.fillStyle=u,s.fillRect(L,_,m-L*2,h);var b=g.options.max-g.options.min,G=(g.value-g.options.min)/b;if(G<0&&(G=0),G>1&&(G=1),s.fillStyle=g.options.hasOwnProperty("slider_color")?g.options.slider_color:a==g?"#89A":"#678",s.fillRect(L,_,G*(m-L*2),h),c&&!g.disabled&&s.strokeRect(L,_,m-L*2,h),g.marker){var C=(g.marker-g.options.min)/b;C<0&&(C=0),C>1&&(C=1),s.fillStyle=g.options.hasOwnProperty("marker_color")?g.options.marker_color:"#AA9",s.fillRect(L+C*(m-L*2),_,2,h)}c&&(s.textAlign="center",s.fillStyle=d,s.fillText(g.label||g.name+"  "+Number(g.value).toFixed(g.options.precision!=null?g.options.precision:3),m*.5,_+h*.7));break;case"number":case"combo":if(s.textAlign="left",s.strokeStyle=p,s.fillStyle=u,s.beginPath(),c?s.roundRect(L,_,m-L*2,h,[h*.5]):s.rect(L,_,m-L*2,h),s.fill(),c)if(g.disabled||s.stroke(),s.fillStyle=d,g.disabled||(s.beginPath(),s.moveTo(L+16,_+5),s.lineTo(L+6,_+h*.5),s.lineTo(L+16,_+h-5),s.fill(),s.beginPath(),s.moveTo(m-L-16,_+5),s.lineTo(m-L-6,_+h*.5),s.lineTo(m-L-16,_+h-5),s.fill()),s.fillStyle=f,s.fillText(g.label||g.name,L*2+5,_+h*.7),s.fillStyle=d,s.textAlign="right",g.type=="number")s.fillText(Number(g.value).toFixed(g.options.precision!==void 0?g.options.precision:3),m-L*2-20,_+h*.7);else{var E=g.value;if(g.options.values){var k=g.options.values;k.constructor===Function&&(k=k()),k&&k.constructor!==Array&&(E=k[g.value])}s.fillText(E,m-L*2-20,_+h*.7)}break;case"string":case"text":if(s.textAlign="left",s.strokeStyle=p,s.fillStyle=u,s.beginPath(),c?s.roundRect(L,_,m-L*2,h,[h*.5]):s.rect(L,_,m-L*2,h),s.fill(),c){g.disabled||s.stroke(),s.save(),s.beginPath(),s.rect(L,_,m-L*2,h),s.clip(),s.fillStyle=f;const D=g.label||g.name;D!=null&&s.fillText(D,L*2,_+h*.7),s.fillStyle=d,s.textAlign="right",s.fillText(String(g.value).substr(0,30),m-L*2,_+h*.7),s.restore()}break;default:g.draw&&g.draw(s,n,m,_,h);break}o+=(g.computeSize?g.computeSize(m)[1]:h)+4,s.globalAlpha=this.editor_alpha}s.restore(),s.textAlign="left"}function processNodeWidgets(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow();for(let i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type==="pointerdown"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var nvalue=LiteGraph.clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value,old_value)},20),this.dirty_canvas=!0;break;case"number":case"combo":case"enum":if(event.type=="pointermove"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type=="pointerdown"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));let n=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=n*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(n){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+n:index=values_list.indexOf(w.value)+n,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let o=function(s){return values!=values_list&&(s=text_values.indexOf(s)),this.value=s,inner_value_change(this,s,old_value),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:o.bind(w)},ref_window)}}else if(event.type=="pointerup"&&w.type=="number"){let delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,function(v){var t;if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(n){(t=LiteGraph.warn)==null||t.call(LiteGraph,n)}this.value=Number(v),inner_value_change(this,this.value,old_value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value,old_value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type=="pointerdown"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type=="pointerdown"&&this.prompt("Value",w.value,function(n){inner_value_change(this,n)}.bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return w}}}function inner_value_change(n,o,s){var a;(a=LiteGraph.debug)==null||a.call(LiteGraph,"inner_value_change for processNodeWidgets",n,o),s!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,s,w),node.graph.onGraphChanged({action:"widgetChanged",doSave:!0})),n.type=="number"&&(o=Number(o)),n.value=o,n.options&&n.options.property&&node.properties[n.options.property]!==void 0&&node.setProperty(n.options.property,o),n.callback&&n.callback(n.value,that,node,pos,event)}return null}function adjustNodesSize(){var n=this.graph._nodes;for(let o=0;o<n.length;++o)n[o].size=n[o].computeSize();this.setDirty(!0,!0)}function drawLinkTooltip(n,o){var s,a=o._pos;if(n.fillStyle="black",n.beginPath(),n.arc(a[0],a[1],3,0,Math.PI*2),n.fill(),o.data!=null&&!((s=this.onDrawLinkTooltip)!=null&&s.call(this,n,o,this))){var r=o.data,l=null;if(r.constructor===Number?l=r.toFixed(2):r.constructor===String?l='"'+r+'"':r.constructor===Boolean?l=String(r):r.toToolTip?l=r.toToolTip():l="["+r.constructor.name+"]",l!=null){l=l.substr(0,30),n.font="14px Courier New";var h=n.measureText(l),c=h.width+20,p=24;n.shadowColor="black",n.shadowOffsetX=2,n.shadowOffsetY=2,n.shadowBlur=3,n.fillStyle="#454",n.beginPath(),n.roundRect(a[0]-c*.5,a[1]-15-p,c,p,[3]),n.moveTo(a[0]-10,a[1]-15),n.lineTo(a[0]+10,a[1]-15),n.lineTo(a[0],a[1]-5),n.fill(),n.shadowColor="transparent",n.textAlign="center",n.fillStyle="#CEC",n.fillText(l,a[0],a[1]-15-p*.3)}}}function drawConnections(n){var o=LiteGraph.getTime(),s=this.visible_area;margin_area[0]=s[0]-20,margin_area[1]=s[1]-20,margin_area[2]=s[2]+40,margin_area[3]=s[3]+40,n.lineWidth=this.connections_width,n.fillStyle="#AAA",n.strokeStyle="#AAA",n.globalAlpha=this.editor_alpha;for(var a=this.graph._nodes,r=0,l=a.length;r<l;++r){var h=a[r];if(!(!h.inputs||!h.inputs.length))for(let k=0;k<h.inputs.length;++k){var c=h.inputs[k];if(!(!c||c.link==null)){var p=c.link,u=this.graph.links[p];if(u){var d=this.graph.getNodeById(u.origin_id);if(d!=null){var f=u.origin_slot,L=null;f==-1?L=[d.pos[0]+10,d.pos[1]+10]:L=d.getConnectionPos(!1,f,tempA);var g=h.getConnectionPos(!0,k,tempB);if(link_bounding[0]=L[0],link_bounding[1]=L[1],link_bounding[2]=g[0]-L[0],link_bounding[3]=g[1]-L[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!LiteGraph.overlapBounding(link_bounding,margin_area)){var _=d.outputs[f],m=h.inputs[k];if(!(!_||!m)){var b=_.dir||(d.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),G=m.dir||(h.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(n,L,g,u,!1,0,null,b,G),u&&u._last_time&&o-u._last_time<1e3){var C=2-(o-u._last_time)*.002,E=n.globalAlpha;n.globalAlpha=E*C,this.renderLink(n,L,g,u,!0,C,"white",b,G),n.globalAlpha=E}}}}}}}}n.globalAlpha=1}function renderLink(n,o,s,a,r,l,h,c,p,u){a&&this.visible_links.push(a),!h&&a&&(h=a.color||LGraphCanvas.link_type_colors[a.type]),h||(h=this.default_link_color),a!=null&&this.highlighted_links[a.id]&&(h="#FFF"),c=c||LiteGraph.RIGHT,p=p||LiteGraph.LEFT;var d=LiteGraph.distance(o,s);this.render_connections_border&&this.ds.scale>.6&&(n.lineWidth=this.connections_width+4),n.lineJoin="round",u=u||1,u>1&&(n.lineWidth=.5),n.beginPath();for(let S=0;S<u;S+=1){var f=(S-(u-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){n.moveTo(o[0],o[1]+f);let N=0,O=0,P=0,j=0;switch(c){case LiteGraph.LEFT:N=d*-.25;break;case LiteGraph.RIGHT:N=d*.25;break;case LiteGraph.UP:O=d*-.25;break;case LiteGraph.DOWN:O=d*.25;break}switch(p){case LiteGraph.LEFT:P=d*-.25;break;case LiteGraph.RIGHT:P=d*.25;break;case LiteGraph.UP:j=d*-.25;break;case LiteGraph.DOWN:j=d*.25;break}n.bezierCurveTo(o[0]+N,o[1]+O+f,s[0]+P,s[1]+j+f,s[0],s[1]+f)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){n.moveTo(o[0],o[1]+f);let N=0,O=0,P=0,j=0;switch(c){case LiteGraph.LEFT:N=-1;break;case LiteGraph.RIGHT:N=1;break;case LiteGraph.UP:O=-1;break;case LiteGraph.DOWN:O=1;break}switch(p){case LiteGraph.LEFT:P=-1;break;case LiteGraph.RIGHT:P=1;break;case LiteGraph.UP:j=-1;break;case LiteGraph.DOWN:j=1;break}var L=15;n.lineTo(o[0]+N*L,o[1]+O*L+f),n.lineTo(s[0]+P*L,s[1]+j*L+f),n.lineTo(s[0],s[1]+f)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){n.moveTo(o[0],o[1]);var g=o[0],_=o[1],m=s[0],b=s[1];c==LiteGraph.RIGHT?g+=10:_+=10,p==LiteGraph.LEFT?m-=10:b-=10,n.lineTo(g,_),n.lineTo((g+m)*.5,_),n.lineTo((g+m)*.5,b),n.lineTo(m,b),n.lineTo(s[0],s[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!r&&(n.strokeStyle="rgba(0,0,0,0.5)",n.stroke()),n.lineWidth=this.connections_width,n.fillStyle=n.strokeStyle=h,n.stroke();var G=this.computeConnectionPoint(o,s,.5,c,p);if(a&&a._pos&&(a._pos[0]=G[0],a._pos[1]=G[1]),this.ds.scale>=.6&&this.highquality_render&&p!=LiteGraph.CENTER){if(this.render_connection_arrows){var C=this.computeConnectionPoint(o,s,.25,c,p),E=this.computeConnectionPoint(o,s,.26,c,p),k=this.computeConnectionPoint(o,s,.75,c,p),A=this.computeConnectionPoint(o,s,.76,c,p),D=0,I=0;this.render_curved_connections?(D=-Math.atan2(E[0]-C[0],E[1]-C[1]),I=-Math.atan2(A[0]-k[0],A[1]-k[1])):I=D=s[1]>o[1]?0:Math.PI,n.save(),n.translate(C[0],C[1]),n.rotate(D),n.beginPath(),n.moveTo(-5,-3),n.lineTo(0,7),n.lineTo(5,-3),n.fill(),n.restore(),n.save(),n.translate(k[0],k[1]),n.rotate(I),n.beginPath(),n.moveTo(-5,-3),n.lineTo(0,7),n.lineTo(5,-3),n.fill(),n.restore()}n.beginPath(),n.arc(G[0],G[1],5,0,Math.PI*2),n.fill()}if(l){n.fillStyle=h;for(let S=0;S<5;++S){var T=(LiteGraph.getTime()*.001+S*.2)%1;G=this.computeConnectionPoint(o,s,T,c,p),n.beginPath(),n.arc(G[0],G[1],5,0,2*Math.PI),n.fill()}}}function computeConnectionPoint(n,o,s,a,r){a=a||LiteGraph.RIGHT,r=r||LiteGraph.LEFT;var l=LiteGraph.distance(n,o),h=n,c=[n[0],n[1]],p=[o[0],o[1]],u=o;switch(a){case LiteGraph.LEFT:c[0]+=l*-.25;break;case LiteGraph.RIGHT:c[0]+=l*.25;break;case LiteGraph.UP:c[1]+=l*-.25;break;case LiteGraph.DOWN:c[1]+=l*.25;break}switch(r){case LiteGraph.LEFT:p[0]+=l*-.25;break;case LiteGraph.RIGHT:p[0]+=l*.25;break;case LiteGraph.UP:p[1]+=l*-.25;break;case LiteGraph.DOWN:p[1]+=l*.25;break}var d=(1-s)*(1-s)*(1-s),f=3*((1-s)*(1-s))*s,L=3*(1-s)*(s*s),g=s*s*s,_=d*h[0]+f*c[0]+L*p[0]+g*u[0],m=d*h[1]+f*c[1]+L*p[1]+g*u[1];return[_,m]}function drawSubgraphPanel(n){var o,s=this.graph;if(s){var a=s._subgraph_node;if(!a){(o=LiteGraph.warn)==null||o.call(LiteGraph,"subgraph without subnode");return}this.drawSubgraphPanelLeft(s,a,n),this.drawSubgraphPanelRight(s,a,n)}}function drawSubgraphPanelLeft(n,o,s){var a,r=o.inputs?o.inputs.length:0,l=200,h=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(10,10,l,(r+1)*h+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left",s.fillText("Graph Inputs",20,34),this.drawButton(l-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var c=50;if(s.font="14px Arial",o.inputs)for(var p=0;p<o.inputs.length;++p){var u=o.inputs[p];if(!u.not_subgraph_input){if(this.drawButton(20,c+2,l-20,h-2)){var d=o.constructor.input_node_type||"graph/input";this.graph.beforeChange();var f=LiteGraph.createNode(d);f?(n.add(f,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([f]),this.node_dragged=f,this.dragging_canvas=!1,f.setProperty("name",u.name),f.setProperty("type",u.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(a=LiteGraph.error)==null||a.call(LiteGraph,"graph input node not found:",d)}s.fillStyle="#9C9",s.beginPath(),s.arc(l-16,c+h*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(u.name,30,c+h*.75),s.fillStyle="#777",s.fillText(u.type,130,c+h*.75),c+=h}}this.drawButton(20,c+2,l-20,h-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(o)}function drawSubgraphPanelRight(n,o,s){var a,r=o.outputs?o.outputs.length:0,l=this.bgcanvas.width,h=200,c=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(l-h-10,10,h,(r+1)*c+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left";const p="Graph Outputs";var u=s.measureText(p).width;if(s.fillText(p,l-u-20,34),this.drawButton(l-h,20,20,20,"X","#151515")){this.closeSubgraph();return}var d=50;if(s.font="14px Arial",o.outputs)for(var f=0;f<o.outputs.length;++f){var L=o.outputs[f];if(!L.not_subgraph_input){if(this.drawButton(l-h,d+2,h-20,c-2)){var g=o.constructor.output_node_type||"graph/output";this.graph.beforeChange();var _=LiteGraph.createNode(g);_?(n.add(_,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([_]),this.node_dragged=_,this.dragging_canvas=!1,_.setProperty("name",L.name),_.setProperty("type",L.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(a=LiteGraph.error)==null||a.call(LiteGraph,"graph input node not found:",g)}s.fillStyle="#9C9",s.beginPath(),s.arc(l-h+16,d+c*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(L.name,l-h+30,d+c*.75),s.fillStyle="#777",s.fillText(L.type,l-h+130,d+c*.75),d+=c}}this.drawButton(l-h,d+2,h-20,c-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(o)}function drawButton(n,o,s,a,r,l,h,c){var p=this.ctx;l=l||LiteGraph.NODE_DEFAULT_COLOR,h=h||"#555",c=c||LiteGraph.NODE_TEXT_COLOR;var u=this.ds.convertOffsetToCanvas(this.graph_mouse),d=LiteGraph.isInsideRectangle(u[0],u[1],n,o,s,a);if(u=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,u){var f=this.canvas.getBoundingClientRect();u[0]-=f.left,u[1]-=f.top}var L=u&&LiteGraph.isInsideRectangle(u[0],u[1],n,o,s,a);p.fillStyle=d?h:l,L&&(p.fillStyle="#AAA"),p.beginPath(),p.roundRect(n,o,s,a,[4]),p.fill(),r!=null&&r.constructor==String&&(p.fillStyle=c,p.textAlign="center",p.font=(a*.65|0)+"px Arial",p.fillText(r,n+s*.5,o+a*.75),p.textAlign="left");var g=L&&!this.block_click;return L&&this.blockClick(),g}function isAreaClicked(n,o,s,a,r){var l=this.last_click_position,h=l&&LiteGraph.isInsideRectangle(l[0],l[1],n,o,s,a),c=h&&!this.block_click;return h&&r&&this.blockClick(),c}function renderInfo(n,o,s){o=o||10,s=s||this.canvas.height-80,n.save(),n.translate(o,s),n.font="10px Arial",n.fillStyle="#888",n.textAlign="left",this.graph?(n.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),n.fillText("I: "+this.graph.iteration,5,26),n.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),n.fillText("V: "+this.graph._version,5,52),n.fillText("FPS:"+this.fps.toFixed(2),5,65)):n.fillText("No graph selected",5,13),n.restore()}function drawBackCanvas(){var n,o,s,a=this.bgcanvas;this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var r=this.bgctx;r.start&&r.start();var l=this.viewport||[0,0,r.canvas.width,r.canvas.height];if(this.clear_background&&r.clearRect(l[0],l[1],l[2],l[3]),this._graph_stack&&this._graph_stack.length){r.save();var h=this.graph._subgraph_node;r.strokeStyle=h.bgcolor,r.lineWidth=10,r.strokeRect(1,1,a.width-2,a.height-2),r.lineWidth=1,r.font="40px Arial",r.textAlign="center",r.fillStyle=h.bgcolor||"#AAA";let d="";this._graph_stack.slice(1).forEach((f,L)=>{d+=`${f._subgraph_node.getTitle()} ${L<this._graph_stack.length-2?">> ":""}`}),r.fillText(d+h.getTitle(),a.width*.5,40),r.restore()}var c=!1;if(this.onRenderBackground&&(c=this.onRenderBackground(a,r)),this.viewport||(r.restore(),r.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(r.save(),this.ds.toCanvasContext(r),this.ds.scale<1.5&&!c&&this.clear_background_color&&(r.fillStyle=this.clear_background_color,r.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!c){if(this.zoom_modify_alpha?r.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:r.globalAlpha=this.editor_alpha,r.imageSmoothingEnabled=r.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var p=this;this._bg_img.onload=function(){p.draw(!0,!0)}}var u=null;this._pattern==null&&this._bg_img.width>0?(u=r.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=u):u=this._pattern,u&&(r.fillStyle=u,r.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),r.fillStyle="transparent"),r.globalAlpha=1,r.imageSmoothingEnabled=r.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(a,r),(n=this.onDrawBackground)==null||n.call(this,r,this.visible_area),this.onBackgroundRender&&((o=LiteGraph.error)==null||o.call(LiteGraph,"WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(r.strokeStyle="#235",r.strokeRect(0,0,a.width,a.height)),this.render_connections_shadows?(r.shadowColor="#000",r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=6):r.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(r),r.shadowColor="rgba(0,0,0,0)",r.restore()}(s=r.finish)==null||s.call(r),this.dirty_bgcanvas=!1,this.dirty_canvas=!0}function drawGroups(n,o){if(this.graph){var s=this.graph._groups;o.save(),o.globalAlpha=.5*this.editor_alpha;for(let c=0;c<s.length;++c){var a=s[c];if(LiteGraph.overlapBounding(this.visible_area,a._bounding)){o.fillStyle=a.color||"#335",o.strokeStyle=a.color||"#335";var r=a._pos,l=a._size;o.globalAlpha=.25*this.editor_alpha,o.beginPath(),o.rect(r[0]+.5,r[1]+.5,l[0],l[1]),o.fill(),o.globalAlpha=this.editor_alpha,o.stroke(),o.beginPath(),o.moveTo(r[0]+l[0],r[1]+l[1]),o.lineTo(r[0]+l[0]-10,r[1]+l[1]),o.lineTo(r[0]+l[0],r[1]+l[1]-10),o.fill();var h=a.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;o.font=h+"px Arial",o.textAlign="left",o.fillText(a.title,r[0]+4,r[1]+h)}}o.restore()}}class RenderController{constructor(o){this.host=o}draw(...o){return draw.apply(this.host,o)}drawFrontCanvas(...o){return drawFrontCanvas.apply(this.host,o)}lowQualityRenderingRequired(...o){return lowQualityRenderingRequired.apply(this.host,o)}drawNode(...o){return drawNode.apply(this.host,o)}drawNodeTooltip(...o){return drawNodeTooltip.apply(this.host,o)}drawNodeShape(...o){return drawNodeShape.apply(this.host,o)}drawExecutionOrder(...o){return drawExecutionOrder.apply(this.host,o)}drawNodeWidgets(...o){return drawNodeWidgets.apply(this.host,o)}processNodeWidgets(...o){return processNodeWidgets.apply(this.host,o)}adjustNodesSize(...o){return adjustNodesSize.apply(this.host,o)}drawConnections(...o){return drawConnections.apply(this.host,o)}renderLink(...o){return renderLink.apply(this.host,o)}computeConnectionPoint(...o){return computeConnectionPoint.apply(this.host,o)}drawLinkTooltip(...o){return drawLinkTooltip.apply(this.host,o)}drawBackCanvas(...o){return drawBackCanvas.apply(this.host,o)}drawSubgraphPanel(...o){return drawSubgraphPanel.apply(this.host,o)}drawSubgraphPanelLeft(...o){return drawSubgraphPanelLeft.apply(this.host,o)}drawSubgraphPanelRight(...o){return drawSubgraphPanelRight.apply(this.host,o)}drawButton(...o){return drawButton.apply(this.host,o)}isAreaClicked(...o){return isAreaClicked.apply(this.host,o)}renderInfo(...o){return renderInfo.apply(this.host,o)}drawGroups(...o){return drawGroups.apply(this.host,o)}}function copyToClipboard(){var n,o={nodes:[],links:[]},s=0,a=[];for(let u in this.selected_nodes){let d=this.selected_nodes[u];d.clonable!==!1&&(d._relative_id=s,a.push(d),s+=1)}for(let u=0;u<a.length;++u){let d=a[u];if(d.clonable!==!1){var r=d.clone();if(!r){(n=LiteGraph.warn)==null||n.call(LiteGraph,"node type not found: "+d.type);continue}if(o.nodes.push(r.serialize()),d.inputs&&d.inputs.length)for(var l=0;l<d.inputs.length;++l){var h=d.inputs[l];if(!(!h||h.link==null)){var c=this.graph.links[h.link];if(c){var p=this.graph.getNodeById(c.origin_id);p&&o.links.push([p._relative_id,c.origin_slot,d._relative_id,c.target_slot,p.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(o))}function pasteFromClipboard(n=!1){var o;if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&n)){var s=localStorage.getItem("litegrapheditor_clipboard");if(s){this.graph.beforeChange();var a=JSON.parse(s),r=!1,l=!1;for(let _=0;_<a.nodes.length;++_)r?(r[0]>a.nodes[_].pos[0]&&(r[0]=a.nodes[_].pos[0],l[0]=_),r[1]>a.nodes[_].pos[1]&&(r[1]=a.nodes[_].pos[1],l[1]=_)):(r=[a.nodes[_].pos[0],a.nodes[_].pos[1]],l=[_,_]);var h=[];for(let _=0;_<a.nodes.length;++_){var c=a.nodes[_],p=LiteGraph.createNode(c.type);p&&(p.configure(c),p.pos[0]+=this.graph_mouse[0]-r[0],p.pos[1]+=this.graph_mouse[1]-r[1],this.graph.add(p,{doProcessChange:!1}),h.push(p))}for(let _=0;_<a.links.length;++_){var u=a.links[_],d=void 0,f=u[0];if(f!=null)d=h[f];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&n){var L=u[4];L&&(d=this.graph.getNodeById(L))}var g=h[u[2]];d&&g?d.connect(u[1],g,u[3]):(o=LiteGraph.warn)==null||o.call(LiteGraph,"Warning, nodes missing on pasting")}this.selectNodes(h),this.graph.onGraphChanged({action:"paste",doSave:!0}),this.graph.afterChange()}}}function processNodeDblClicked(n){var o;this.onShowNodePanel?this.onShowNodePanel(n):this.showShowNodePanel(n),(o=this.onNodeDblClicked)==null||o.call(this,n),this.setDirty(!0)}function processNodeSelected(n,o){var s;this.selectNode(n,o&&(o.shiftKey||o.ctrlKey||this.multi_select)),(s=this.onNodeSelected)==null||s.call(this,n)}function selectNode(n,o){n==null?this.deselectAllNodes():this.selectNodes([n],o)}function selectNodes(n,o){var s;o||this.deselectAllNodes(),n=n||this.graph._nodes,typeof n=="string"&&(n=[n]),Object.values(n).forEach(a=>{var r,l,h;if(a.is_selected){this.deselectNode(a);return}a.is_selected=!0,this.selected_nodes[a.id]=a,(r=a.onSelected)==null||r.call(a),(l=a.inputs)==null||l.forEach(c=>{this.highlighted_links[c.link]=!0}),(h=a.outputs)==null||h.forEach(c=>{var p;(p=c.links)==null||p.forEach(u=>{this.highlighted_links[u]=!0})})}),(s=this.onSelectionChange)==null||s.call(this,this.selected_nodes),this.setDirty(!0)}function deselectNode(n){var o,s,a,r;n.is_selected&&((o=n.onDeselected)==null||o.call(n),n.is_selected=!1,(s=this.onNodeDeselected)==null||s.call(this,n),(a=n.inputs)==null||a.forEach(l=>{var h;(h=this.highlighted_links)==null||delete h[l.link]}),(r=n.outputs)==null||r.forEach(l=>{var h;(h=l.links)==null||h.forEach(c=>{var p;return(p=this.highlighted_links)==null?!0:delete p[c]})}))}function deselectAllNodes(){var n,o;this.graph&&((n=this.graph._nodes)==null||n.forEach(s=>{var a,r;s.is_selected&&((a=s.onDeselected)==null||a.call(s),s.is_selected=!1,(r=this.onNodeDeselected)==null||r.call(this,s))}),this.selected_nodes={},this.current_node=null,this.highlighted_links={},(o=this.onSelectionChange)==null||o.call(this,this.selected_nodes),this.setDirty(!0))}function deleteSelectedNodes(){this.graph.beforeChange();for(let l in this.selected_nodes){var n=this.selected_nodes[l];if(!n.block_delete){if(n.inputs&&n.inputs.length&&n.outputs&&n.outputs.length&&LiteGraph.isValidConnection(n.inputs[0].type,n.outputs[0].type)&&n.inputs[0].link&&n.outputs[0].links&&n.outputs[0].links.length){var o=n.graph.links[n.inputs[0].link],s=n.graph.links[n.outputs[0].links[0]],a=n.getInputNode(0),r=n.getOutputNodes(0)[0];a&&r&&a.connect(o.origin_slot,r,s.target_slot)}this.graph.remove(n),this.onNodeDeselected&&this.onNodeDeselected(n)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()}function onNodeSelectionChange(){}function boundaryNodesForSelection(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))}class SelectionController{constructor(o){this.host=o}copyToClipboard(...o){return copyToClipboard.apply(this.host,o)}pasteFromClipboard(...o){return pasteFromClipboard.apply(this.host,o)}processNodeDblClicked(...o){return processNodeDblClicked.apply(this.host,o)}processNodeSelected(...o){return processNodeSelected.apply(this.host,o)}selectNode(...o){return selectNode.apply(this.host,o)}selectNodes(...o){return selectNodes.apply(this.host,o)}deselectNode(...o){return deselectNode.apply(this.host,o)}deselectAllNodes(...o){return deselectAllNodes.apply(this.host,o)}deleteSelectedNodes(...o){return deleteSelectedNodes.apply(this.host,o)}onNodeSelectionChange(...o){return onNodeSelectionChange.apply(this.host,o)}boundaryNodesForSelection(...o){return boundaryNodesForSelection.apply(this.host,o)}}function showLinkMenu(n,o){var s=this,a=s.graph.getNodeById(n.origin_id),r=s.graph.getNodeById(n.target_id),l=!1;a&&a.outputs&&a.outputs[n.origin_slot]&&(l=a.outputs[n.origin_slot].type);var h=!1;r&&r.outputs&&r.outputs[n.target_slot]&&(h=r.inputs[n.target_slot].type);var c=["Add Node",null,"Delete"],p=new LiteGraph.ContextMenu(c,{event:o,title:n.data!=null?n.data.constructor.name:null,callback:u});function u(d,f,L){switch(d){case"Add Node":LGraphCanvas.onMenuAdd(null,null,L,p,function(g){var _;(_=LiteGraph.debug)==null||_.call(LiteGraph,"node autoconnect"),!(!g.inputs||!g.inputs.length||!g.outputs||!g.outputs.length)&&a.connectByType(n.origin_slot,g,l)&&(g.connectByType(n.target_slot,r,h),g.pos[0]-=g.size[0]*.5)});break;case"Delete":s.graph.removeLink(n.id);break}}return!1}function createDefaultNodeForSlot(n={}){var o,s,a,r,l,h=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},n),c=this,p=h.nodeFrom&&h.slotFrom!==null,u=!p&&h.nodeTo&&h.slotTo!==null;if(!p&&!u)return(o=LiteGraph.warn)==null||o.call(LiteGraph,"No data passed to createDefaultNodeForSlot "+h.nodeFrom+" "+h.slotFrom+" "+h.nodeTo+" "+h.slotTo),!1;if(!h.nodeType)return(s=LiteGraph.warn)==null||s.call(LiteGraph,"No type to createDefaultNodeForSlot"),!1;var d=p?h.nodeFrom:h.nodeTo,f=p?h.slotFrom:h.slotTo,L=!1;switch(typeof f){case"string":L=p?d.findOutputSlot(f,!1):d.findInputSlot(f,!1),f=p?d.outputs[f]:d.inputs[f];break;case"object":L=p?d.findOutputSlot(f.name):d.findInputSlot(f.name);break;case"number":L=f,f=p?d.outputs[f]:d.inputs[f];break;default:return(a=LiteGraph.warn)==null||a.call(LiteGraph,"Cant get slot information "+f),!1}(f===!1||L===!1)&&((r=LiteGraph.warn)==null||r.call(LiteGraph,"createDefaultNodeForSlot bad slotX "+f+" "+L));var g=f.type==LiteGraph.EVENT?"_event_":f.type,_=p?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(_&&_[g]){f.link;var m=!1;if(typeof _[g]=="object"){for(var b in _[g])if(h.nodeType==_[g][b]||h.nodeType=="AUTO"){m=_[g][b];break}}else(h.nodeType==_[g]||h.nodeType=="AUTO")&&(m=_[g]);if(m){var G=!1;typeof m=="object"&&m.node&&(G=m,m=m.node);var C=LiteGraph.createNode(m);if(C){if(G){if(G.properties)for(const[E,k]of Object.entries(G.properties))C.addProperty(E,k);G.inputs&&(C.inputs=[],Object.values(G.inputs).forEach(E=>{C.addOutput(E[0],E[1])})),G.outputs&&(C.outputs=[],Object.values(G.outputs).forEach(E=>{C.addOutput(E[0],E[1])})),G.title&&(C.title=G.title),G.json&&C.configure(G.json)}return c.graph.add(C),C.pos=[h.position[0]+h.posAdd[0]+(h.posSizeFix[0]?h.posSizeFix[0]*C.size[0]:0),h.position[1]+h.posAdd[1]+(h.posSizeFix[1]?h.posSizeFix[1]*C.size[1]:0)],p?h.nodeFrom.connectByType(L,C,g):h.nodeTo.connectByTypeOutput(L,C,g),!0}else(l=LiteGraph.warn)==null||l.call(LiteGraph,"failed creating "+m)}}return!1}function showConnectionMenu(n={}){var o,s,a=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},n),r=this,l=a.nodeFrom&&a.slotFrom,h=!l&&a.nodeTo&&a.slotTo;if(!l&&!h)return(o=LiteGraph.warn)==null||o.call(LiteGraph,"No data passed to showConnectionMenu"),!1;var c=l?a.nodeFrom:a.nodeTo,p=l?a.slotFrom:a.slotTo,u=!1;switch(typeof p){case"string":u=l?c.findOutputSlot(p,!1):c.findInputSlot(p,!1),p=l?c.outputs[p]:c.inputs[p];break;case"object":u=l?c.findOutputSlot(p.name):c.findInputSlot(p.name);break;case"number":u=p,p=l?c.outputs[p]:c.inputs[p];break;default:return(s=LiteGraph.warn)==null||s.call(LiteGraph,"Cant get slot information "+p),!1}var d=["Add Node",null];r.allow_searchbox&&(d.push("Search"),d.push(null));const f=p.type===LiteGraph.EVENT?"_event_":p.type,L=l?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(L&&L[f]){const _=L[f];Array.isArray(_)||typeof _=="object"?Object.values(_).forEach(m=>{d.push(m)}):d.push(_)}var g=new LiteGraph.ContextMenu(d,{event:a.e,title:(p&&p.name!=""?p.name+(f?" | ":""):"")+(p&&f?f:""),callback:(_,m,b)=>{const G={"Add Node":()=>{LGraphCanvas.onMenuAdd(null,null,b,g,C=>{l?a.nodeFrom.connectByType(u,C,f):a.nodeTo.connectByTypeOutput(u,C,f)})},Search:()=>{l?r.showSearchBox(b,{node_from:a.nodeFrom,slot_from:p,type_filter_in:f}):r.showSearchBox(b,{node_to:a.nodeTo,slot_from:p,type_filter_out:f})},default:()=>{r.createDefaultNodeForSlot(Object.assign(a,{position:[a.e.canvasX,a.e.canvasY],nodeType:_}))}};(G[_]||G.default)()}});return!1}function getCanvasMenuOptions(){var n=null;if(this.getMenuOptions?n=this.getMenuOptions():(n=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],LiteGraph.showCanvasOptions&&n.push({content:"Options",callback:this.showShowGraphOptionsPanel}),Object.keys(this.selected_nodes).length>1&&n.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&n.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var o=this.getExtraMenuOptions(this,n);o&&(n=n.concat(o))}return n}function getNodeMenuOptions(n){var o=null;if(n.getMenuOptions?o=n.getMenuOptions(this):(o=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],n.resizable!==!1&&o.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),o.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),n.onGetInputs){var s=n.onGetInputs();s&&s.length&&(o[0].disabled=!1)}if(n.onGetOutputs){var a=n.onGetOutputs();a&&a.length&&(o[1].disabled=!1)}if(LiteGraph.do_add_triggers_slots&&(o[1].disabled=!1),n.getExtraMenuOptions){var r=n.getExtraMenuOptions(this,o);r&&(r.push(null),o=r.concat(o))}return n.clonable!==!1&&o.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&o.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),o.push(null,{content:"Remove",disabled:!(n.removable!==!1&&!n.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),n.graph&&n.graph.onGetNodeMenuOptions&&n.graph.onGetNodeMenuOptions(o,n),o}function getGroupMenuOptions(){var n=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return n}function processContextMenu(n,o){var s,a,r,l=this,h=LGraphCanvas.active_canvas,c=h.getCanvasWindow(),p=null,u={event:o,callback:_,extra:n};n&&(u.title=n.type);var d=null;if(n&&(d=n.getSlotInPosition(o.canvasX,o.canvasY),LGraphCanvas.active_node=n),d){if(p=[],n.getSlotMenuOptions)p=n.getSlotMenuOptions(d);else{((a=(s=d==null?void 0:d.output)==null?void 0:s.links)!=null&&a.length||(r=d.input)!=null&&r.link)&&p.push({content:"Disconnect Links",slot:d});var f=d.input||d.output;f.removable&&LiteGraph.canRemoveSlots&&p.push(f.locked?"Cannot remove":{content:"Remove Slot",slot:d}),!f.nameLocked&&LiteGraph.canRenameSlots&&p.push({content:"Rename Slot",slot:d})}var L=d.input||d.output;u.title=L.type||"*",L.type==LiteGraph.ACTION?u.title="Action":L.type==LiteGraph.EVENT&&(u.title="Event")}else if(n)p=this.getNodeMenuOptions(n);else{p=this.getCanvasMenuOptions();var g=this.graph.getGroupOnPos(o.canvasX,o.canvasY);g&&p.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:g,options:this.getGroupMenuOptions(g)}})}if(!p)return;new LiteGraph.ContextMenu(p,u,c);function _(m,b){if(!m)return;let G;if(m.content=="Remove Slot"){G=m.slot,n.graph.beforeChange(),G.input?n.removeInput(G.slot):G.output&&n.removeOutput(G.slot),n.graph.afterChange();return}else if(m.content=="Disconnect Links"){G=m.slot,n.graph.beforeChange(),G.output?n.disconnectOutput(G.slot):G.input&&n.disconnectInput(G.slot),n.graph.afterChange();return}else if(m.content=="Rename Slot"){G=m.slot;var C=G.input?n.getInputInfo(G.slot):n.getOutputInfo(G.slot),E=l.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",b),k=E.querySelector("input");k&&C&&(k.value=C.label||"");var A=function(){n.graph.beforeChange(),k.value&&(C&&(C.label=k.value),l.setDirty(!0)),E.close(),n.graph.afterChange()};E.querySelector("button").addEventListener("click",A),k.addEventListener("keydown",function(D){if(E.is_modified=!0,D.keyCode==27)E.close();else if(D.keyCode==13)A();else if(D.keyCode!=13&&D.target.localName!="textarea")return;D.preventDefault(),D.stopPropagation()}),k.focus()}}}function prompt(n="",o,s,a,r){var l,h=document.createElement("div");h.is_modified=!1,h.className="graphdialog rounded",r?h.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":h.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",h.close=()=>{var C;this.prompt_box=null,(C=h.parentNode)==null||C.removeChild(h)};var c=LGraphCanvas.active_canvas,p=c.canvas;p.parentNode.appendChild(h),this.ds.scale>1&&(h.style.transform=`scale(${this.ds.scale})`);var u=null,d=0;h.addEventListener("pointerleave",C=>{d>0||LiteGraph.dialog_close_on_mouse_leave&&!h.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(h.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),h.addEventListener("pointerenter",C=>{LiteGraph.dialog_close_on_mouse_leave&&u&&clearTimeout(u)});const f=h.querySelectorAll("select");f&&(d=0,f.forEach(C=>{C.addEventListener("pointerdown",E=>{d++}),C.addEventListener("focus",E=>{d++}),C.addEventListener("blur",E=>{d=Math.max(0,d-1)}),C.addEventListener("change",E=>{d=0})})),(l=this.prompt_box)==null||l.close(),this.prompt_box=h;var L=h.querySelector(".name");L.innerText=n;var g=h.querySelector(".value");g.value=o;const _=g;_.addEventListener("keydown",C=>{var E;switch(h.is_modified=!0,C.key){case"Escape":h.close();break;case"Enter":C.target.localName!=="textarea"&&typeof s=="function"&&(s(_.value),this.setDirty(!0)),(E=LiteGraph.debug)==null||E.call(LiteGraph,"prompt v2 ENTER",_.value,C.target.localName,s),h.close();break;default:return}C.preventDefault(),C.stopPropagation()}),h.querySelector("button").addEventListener("click",C=>{var E;typeof s=="function"&&(s(_.value),this.setDirty(!0)),(E=LiteGraph.debug)==null||E.call(LiteGraph,"prompt v2 OK",_.value,s),h.close()});var m=p.getBoundingClientRect(),b=-20,G=-20;return m&&(b-=m.left,G-=m.top),a?(h.style.left=a.clientX+b+"px",h.style.top=a.clientY+G+"px"):(h.style.left=p.width*.5+b+"px",h.style.top=p.height*.5+G+"px"),setTimeout(function(){_.focus()},10),h}function showSearchBox(n,o){var s={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled&&(Object.keys(LiteGraph.registered_slot_in_types||{}).length>0||Object.keys(LiteGraph.registered_slot_out_types||{}).length>0),type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};o=Object.assign(s,o||{});var a=this,r=LGraphCanvas.active_canvas,l=r.canvas,h=l.ownerDocument||document,c=document.createElement("div");if(c.className="litegraph litesearchbox graphdialog rounded",c.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",o.do_type_filter&&(c.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",c.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),o.show_close_button&&(c.innerHTML+="<button class='close_searchbox close'>X</button>"),c.innerHTML+="<div class='helper'></div>",h.fullscreenElement?h.fullscreenElement.appendChild(c):(h.body.appendChild(c),h.body.style.overflow="hidden"),o.do_type_filter)var p=c.querySelector(".slot_in_type_filter"),u=c.querySelector(".slot_out_type_filter");if(c.close=function(){a.search_box=null,this.blur(),l.focus(),h.body.style.overflow="",setTimeout(function(){a.canvas.focus()},20),c.parentNode&&c.parentNode.removeChild(c)},this.ds.scale>1&&(c.style.transform=`scale(${this.ds.scale})`),o.hide_on_mouse_leave){var d=0,f=null;if(c.addEventListener("pointerenter",function(T){f&&(clearTimeout(f),f=null)}),c.addEventListener("pointerleave",function(T){d>0||(f=setTimeout(function(){c.close()},500))}),o.do_type_filter){const T=function(S){S&&(S.addEventListener("pointerdown",function(N){d++}),S.addEventListener("focus",function(N){d++}),S.addEventListener("blur",function(N){d=Math.max(0,d-1)}),S.addEventListener("change",function(N){d=0}))};T(p),T(u)}}a.search_box&&a.search_box.close(),a.search_box=c;var L=c.querySelector(".helper"),g=null,_=null,m=null,b=c.querySelector("input");if(b&&(b.addEventListener("blur",function(T){a.search_box&&this.focus()}),b.addEventListener("keydown",function(T){if(T.key==="ArrowUp")D(!1);else if(T.key==="ArrowDown")D(!0);else if(T.key==="Escape")c.close();else if(T.key==="Enter")I(),m?A(m.innerHTML):g?A(g):c.close();else{_&&clearInterval(_),_=setTimeout(I,250);return}return T.preventDefault(),T.stopPropagation(),T.stopImmediatePropagation(),!0})),o.do_type_filter){if(p){let T=LiteGraph.slot_types_in,S=T.length;(o.type_filter_in==LiteGraph.EVENT||o.type_filter_in==LiteGraph.ACTION)&&(o.type_filter_in="_event_");for(let N=0;N<S;N++){let O=document.createElement("option");O.value=T[N],O.innerHTML=T[N],p.appendChild(O),o.type_filter_in!==!1&&(o.type_filter_in+"").toLowerCase()==(T[N]+"").toLowerCase()&&(O.selected=!0)}p.addEventListener("change",function(){I()})}if(u){let T=LiteGraph.slot_types_out,S=T.length;(o.type_filter_out==LiteGraph.EVENT||o.type_filter_out==LiteGraph.ACTION)&&(o.type_filter_out="_event_");for(let N=0;N<S;N++){let O=document.createElement("option");O.value=T[N],O.innerHTML=T[N],u.appendChild(O),o.type_filter_out!==!1&&(o.type_filter_out+"").toLowerCase()==(T[N]+"").toLowerCase()&&(O.selected=!0)}u.addEventListener("change",function(){I()})}}if(o.show_close_button){var G=c.querySelector(".close");G.addEventListener("click",c.close)}var C=l.getBoundingClientRect(),E=(n?n.clientX:C.left+C.width*.5)-80,k=(n?n.clientY:C.top+C.height*.5)-20;C.width-E<470&&(E=C.width-470),C.height-k<220&&(k=C.height-220),E<C.left+20&&(E=C.left+20),k<C.top+20&&(k=C.top+20),c.style.left=E+"px",c.style.top=k+"px",b.focus(),o.show_all_on_open&&I();function A(T){if(T)if(a.onSearchBoxSelection)a.onSearchBoxSelection(T,n,r);else{var S=LiteGraph.searchbox_extras[T.toLowerCase()];S&&(T=S.type),r.graph.beforeChange();var N=LiteGraph.createNode(T);if(N&&(N.pos=r.convertEventToCanvasOffset(n),r.graph.add(N,!1,{doProcessChange:!1})),S&&S.data){if(S.data.properties)for(let P in S.data.properties)N.addProperty(P,S.data.properties[P]);if(S.data.inputs){N.inputs=[];for(let P in S.data.inputs)N.addOutput(S.data.inputs[P][0],S.data.inputs[P][1])}if(S.data.outputs){N.outputs=[];for(let P in S.data.outputs)N.addOutput(S.data.outputs[P][0],S.data.outputs[P][1])}S.data.title&&(N.title=S.data.title),S.data.json&&N.configure(S.data.json)}let O;if(o.node_from){switch(O=!1,typeof o.slot_from){case"string":O=o.node_from.findOutputSlot(o.slot_from);break;case"object":o.slot_from.name?O=o.node_from.findOutputSlot(o.slot_from.name):O=-1,O==-1&&typeof o.slot_from.slot_index!="undefined"&&(O=o.slot_from.slot_index);break;case"number":O=o.slot_from;break;default:O=0}typeof o.node_from.outputs[O]!="undefined"&&O!==!1&&O>-1&&o.node_from.connectByType(O,N,o.node_from.outputs[O].type)}if(o.node_to){switch(O=!1,typeof o.slot_from){case"string":O=o.node_to.findInputSlot(o.slot_from);break;case"object":o.slot_from.name?O=o.node_to.findInputSlot(o.slot_from.name):O=-1,O==-1&&typeof o.slot_from.slot_index!="undefined"&&(O=o.slot_from.slot_index);break;case"number":O=o.slot_from;break;default:O=0}typeof o.node_to.inputs[O]!="undefined"&&O!==!1&&O>-1&&o.node_to.connectByTypeOutput(O,N,o.node_to.inputs[O].type)}r.graph.afterChange()}c.close()}function D(T){var S=m;m&&m.classList.remove("selected"),m?(m=T?m.nextSibling:m.previousSibling,m||(m=S)):m=T?L.childNodes[0]:L.childNodes[L.childNodes.length],m&&(m.classList.add("selected"),m.scrollIntoView({block:"end",behavior:"smooth"}))}function I(){_=null;var T=b.value;if(g=null,L.innerHTML="",!T&&!o.show_all_if_empty)return;if(a.onSearchBox){var S=a.onSearchBox(L,T,r);if(S)for(let H=0;H<S.length;++H)J(S[H])}else{let H=function(R,W={}){var pe={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},M=Object.assign(pe,W),z=LiteGraph.registered_node_types[R];if(O&&z.filter!=O||(!o.show_all_if_empty||T)&&R.toLowerCase().indexOf(T)===-1)return!1;if(o.do_type_filter&&!M.skipFilter){var Y=R;let Z;var B=$.value;if(M.inTypeOverride!==!1&&(B=M.inTypeOverride),$&&B&&LiteGraph.registered_slot_in_types[B]&&LiteGraph.registered_slot_in_types[B].nodes&&(Z=LiteGraph.registered_slot_in_types[B].nodes.includes(Y),Z===!1)||(B=F.value,M.outTypeOverride!==!1&&(B=M.outTypeOverride),F&&B&&LiteGraph.registered_slot_out_types[B]&&LiteGraph.registered_slot_out_types[B].nodes&&(Z=LiteGraph.registered_slot_out_types[B].nodes.includes(Y),Z===!1)))return!1}return!0};var N=0;T=T.toLowerCase();var O=r.filter||r.graph.filter;let $,F;o.do_type_filter&&a.search_box?($=a.search_box.querySelector(".slot_in_type_filter"),F=a.search_box.querySelector(".slot_out_type_filter")):($=!1,F=!1);for(let R in LiteGraph.searchbox_extras){var P=LiteGraph.searchbox_extras[R];if(!((!o.show_all_if_empty||T)&&P.desc.toLowerCase().indexOf(T)===-1)){var j=LiteGraph.registered_node_types[P.type];if(!(j&&j.filter!=O)&&H(P.type)&&(J(P.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&N++>LGraphCanvas.search_limit))break}}var V=null;if(Array.prototype.filter)V=Object.keys(LiteGraph.registered_node_types).filter(H);else{V=[];for(let R in LiteGraph.registered_node_types)H(R)&&V.push(R)}for(let R=0;R<V.length&&(J(V[R]),!(LGraphCanvas.search_limit!==-1&&N++>LGraphCanvas.search_limit));R++);if(o.show_general_after_typefiltered&&($.value||F.value)){var q=[];for(let R in LiteGraph.registered_node_types)H(R,{inTypeOverride:$&&$.value?"*":!1,outTypeOverride:F&&F.value?"*":!1})&&q.push(R);for(let R=0;R<q.length&&(J(q[R],"generic_type"),!(LGraphCanvas.search_limit!==-1&&N++>LGraphCanvas.search_limit));R++);}if(($.value||F.value)&&L.childNodes.length==0&&o.show_general_if_none_on_typefilter){var q=[];for(let W in LiteGraph.registered_node_types)H(W,{skipFilter:!0})&&q.push(W);for(let W=0;W<q.length&&(J(q[W],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&N++>LGraphCanvas.search_limit));W++);}}function J(H,$){var F=document.createElement("div");g||(g=H),F.innerText=H,F.dataset.type=encodeURIComponent(H),F.className="litegraph lite-search-item",$&&(F.className+=" "+$),F.addEventListener("click",function(R){A(decodeURIComponent(this.dataset.type))}),L.appendChild(F)}}return c}function showEditPropertyValue(n,o,s){var a,r,l,h,c;if(!n||n.properties[o]===void 0)return;s=s||{};var p=n.getPropertyInfo(o),u=p.type;let d;if(u=="string"||u=="number"||u=="array"||u=="object")d="<input autofocus type='text' class='value'/>";else if((u=="enum"||u=="combo")&&p.values){(a=LiteGraph.debug)==null||a.call(LiteGraph,"CREATING showEditPropertyValue ENUM COMBO",g,u,L),d="<select autofocus type='text' class='value'>";for(let G in p.values){var f=G;p.values.constructor===Array&&(f=p.values[G]),d+="<option value='"+f+"' "+(f==n.properties[o]?"selected":"")+">"+p.values[G]+"</option>"}d+="</select>"}else if(u=="boolean"||u=="toggle")d="<input autofocus type='checkbox' class='value' "+(n.properties[o]?"checked":"")+"/>";else{(r=LiteGraph.warn)==null||r.call(LiteGraph,"unknown type: "+u);return}var L=this.createDialog("<span class='name'>"+(p.label?p.label:o)+"</span>"+d+"<button>OK</button>",s),g=!1;(u=="enum"||u=="combo")&&p.values?((l=LiteGraph.debug)==null||l.call(LiteGraph,"showEditPropertyValue ENUM COMBO",g,u,L),g=L.querySelector("select"),g.addEventListener("change",function(G){var C;L.modified(),(C=LiteGraph.debug)==null||C.call(LiteGraph,"Enum change",g,p,G.target),b(G.target.value)})):u=="boolean"||u=="toggle"?((h=LiteGraph.debug)==null||h.call(LiteGraph,"showEditPropertyValue TOGGLE",g,u,L),g=L.querySelector("input"),g&&g.addEventListener("click",function(G){L.modified(),b(!!g.checked)})):(g=L.querySelector("input"),(c=LiteGraph.debug)==null||c.call(LiteGraph,"showEditPropertyValue",g,u,L),g&&(g.addEventListener("blur",function(G){this.focus()}),f=n.properties[o]!==void 0?n.properties[o]:"",u!=="string"&&(f=JSON.stringify(f)),g.value=f,g.addEventListener("keydown",function(G){if(G.keyCode==27)L.close();else if(G.keyCode==13)m();else if(G.keyCode!=13){L.modified();return}G.preventDefault(),G.stopPropagation()}))),g&&g.focus();var _=L.querySelector("button");_.addEventListener("click",m);function m(){b(g.value)}function b(G){var C;p&&p.values&&p.values.constructor===Object&&p.values[G]!=null&&(G=p.values[G]),typeof n.properties[o]=="number"&&(G=Number(G)),(u=="array"||u=="object")&&(G=JSON.parse(G)),n.properties[o]=G,(C=n.graph)==null||C.onGraphChanged({action:"propertyChanged",doSave:!0}),n.onPropertyChanged&&n.onPropertyChanged(o,G),s.onclose&&s.onclose(),L.close(),n.setDirtyCanvas(!0,!0)}return L}function createDialog(n,o){var s={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};o=Object.assign(s,o||{});var a=document.createElement("div");a.className="graphdialog",a.innerHTML=n,a.is_modified=!1;var r=this.canvas.getBoundingClientRect(),l=-20,h=-20;if(r&&(l-=r.left,h-=r.top),o.position?(l+=o.position[0],h+=o.position[1]):o.event?(l+=o.event.clientX,h+=o.event.clientY):(l+=this.canvas.width*.5,h+=this.canvas.height*.5),a.style.left=l+"px",a.style.top=h+"px",this.canvas.parentNode.appendChild(a),o.checkForInput){var c=[],p=!1;c=a.querySelectorAll("input"),c&&c.forEach(function(L){L.addEventListener("keydown",function(g){if(a.modified(),g.keyCode==27)a.close();else if(g.keyCode!=13)return;g.preventDefault(),g.stopPropagation()}),p||L.focus()})}a.modified=function(){a.is_modified=!0},a.close=function(){a.parentNode&&a.parentNode.removeChild(a)};var u=null,d=0;a.addEventListener("pointerleave",function(L){d>0||(o.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!a.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(a.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),a.addEventListener("pointerenter",function(L){(o.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&u&&clearTimeout(u)});var f=a.querySelectorAll("select");return f&&f.forEach(function(L){L.addEventListener("pointerdown",function(g){d++}),L.addEventListener("focus",function(g){d++}),L.addEventListener("blur",function(g){d=Math.max(0,d-1)}),L.addEventListener("change",function(g){d=0})}),a}function createPanel(n,o){o=o||{};var s=o.window||window,a=document.createElement("div");if(a.className="litegraph dialog",a.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",a.header=a.querySelector(".dialog-header"),o.width&&(a.style.width=o.width+(o.width.constructor===Number?"px":"")),o.height&&(a.style.height=o.height+(o.height.constructor===Number?"px":"")),o.closable){var r=document.createElement("span");r.innerHTML="&#10005;",r.classList.add("close"),r.addEventListener("click",function(){a.close()}),a.header.appendChild(r)}return a.title_element=a.querySelector(".dialog-title"),a.title_element.innerText=n,a.content=a.querySelector(".dialog-content"),a.alt_content=a.querySelector(".dialog-alt-content"),a.footer=a.querySelector(".dialog-footer"),a.close=function(){a.onClose&&typeof a.onClose=="function"&&a.onClose(),a.parentNode&&a.parentNode.removeChild(a)},a.toggleAltContent=function(l){let h,c;typeof l!="undefined"?(h=l?"block":"none",c=l?"none":"block"):(h=a.alt_content.style.display!="block"?"block":"none",c=a.alt_content.style.display!="block"?"none":"block"),a.alt_content.style.display=h,a.content.style.display=c},a.toggleFooterVisibility=function(l){let h;typeof l!="undefined"?h=l?"block":"none":h=a.footer.style.display!="block"?"block":"none",a.footer.style.display=h},a.clear=function(){this.content.innerHTML=""},a.addHTML=function(l,h,c){var p=document.createElement("div");return h&&(p.className=h),p.innerHTML=l,c?a.footer.appendChild(p):a.content.appendChild(p),p},a.addButton=function(l,h,c){var p=document.createElement("button");return p.innerText=l,p.options=c,p.classList.add("btn"),p.addEventListener("click",h),a.footer.appendChild(p),p},a.addSeparator=function(){var l=document.createElement("div");l.className="separator",a.content.appendChild(l)},a.addWidget=function(l,h,c,p,u){var d,f;p=p||{};var L=String(c);l=l.toLowerCase(),l=="number"&&(L=c.toFixed(3));var g=document.createElement("div");g.className="property",g.innerHTML="<span class='property_name'></span><span class='property_value'></span>",g.querySelector(".property_name").innerText=p.label||h;var _=g.querySelector(".property_value");_.innerText=L,g.dataset.property=h,g.dataset.type=p.type||l,g.options=p,g.value=c,(d=LiteGraph.debug)==null||d.call(LiteGraph,"addWidget",l,c,_,p),l=="code"?g.addEventListener("click",function(b){a.inner_showCodePad(this.dataset.property)}):l=="boolean"?(g.classList.add("boolean"),c&&g.classList.add("bool-on"),g.addEventListener("click",function(){var b=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",m(b,this.value)})):l=="string"||l=="number"?(_.setAttribute("contenteditable",!0),_.addEventListener("keydown",function(b){b.code=="Enter"&&(l!="string"||!b.shiftKey)&&(b.preventDefault(),this.blur())}),_.addEventListener("blur",function(){var b=this.innerText,G=this.parentNode.dataset.property,C=this.parentNode.dataset.type;C=="number"&&(b=Number(b)),m(G,b)})):(l=="enum"||l=="combo")&&(L=LGraphCanvas.getPropertyPrintableValue(c,p.values),_.innerText=L,(f=LiteGraph.debug)==null||f.call(LiteGraph,"addWidget ENUM COMBO",l,L,_,p),_.addEventListener("click",function(b){var G=p.values||[],C=this.parentNode.dataset.property,E=this;new LiteGraph.ContextMenu(G,{event:b,className:"dark",callback:k},s);function k(A){return E.innerText=A,m(C,A),!1}})),a.content.appendChild(g);function m(b,G){var C;(C=LiteGraph.debug)==null||C.call(LiteGraph,"widgetInnerChange",b,G,p),p.callback&&p.callback(b,G,p),u&&u(b,G,p)}return g},a.onOpen&&typeof a.onOpen=="function"&&a.onOpen(),a}function closePanels(){var n=document.querySelector("#node-panel");n&&n.close(),n=document.querySelector("#option-panel"),n&&n.close()}function showShowGraphOptionsPanel(n,o){var s,a,r,l;let h;if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!((a=(s=o==null?void 0:o.event)==null?void 0:s.target)!=null&&a.lgraphcanvas)){(r=LiteGraph.warn)==null||r.call(LiteGraph,"References not found to add optionPanel",n,o),LiteGraph.debug&&((l=LiteGraph.debug)==null||l.call(LiteGraph,"!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas",o,o.event,o.event.target,o.event.target.lgraphcanvas));return}h=o.event.target.lgraphcanvas}else h=this;h.closePanels();var c=h.getCanvasWindow();panel=h.createPanel("Options",{closable:!0,window:c,onOpen:function(){h.OPTIONPANEL_IS_OPEN=!0},onClose:function(){h.OPTIONPANEL_IS_OPEN=!1,h.options_panel=null}}),h.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function p(){panel.content.innerHTML="";const u=(g,_,m)=>{m&&m.key&&(g=m.key),m.values&&(_=Object.values(m.values).indexOf(_)),h[g]=_};var d=LiteGraph.availableCanvasOptions;d.sort();for(var f in d){var L=d[f];panel.addWidget("boolean",L,h[L],{key:L,on:"True",off:"False"},u)}panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[h.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},u),panel.addSeparator(),panel.footer.innerHTML=""}p(),h.canvas.parentNode.appendChild(panel)}function showShowNodePanel(n){this.SELECTED_NODE=n,this.closePanels();var o=this.getCanvasWindow(),s=this,a=this.createPanel(n.title||"",{closable:!0,window:o,onOpen:function(){s.NODEPANEL_IS_OPEN=!0},onClose:function(){s.NODEPANEL_IS_OPEN=!1,s.node_panel=null}});s.node_panel=a,a.id="node-panel",a.node=n,a.classList.add("settings");function r(){a.content.innerHTML="",a.addHTML("<span class='node_type'>"+n.type+"</span><span class='node_desc'>"+(n.constructor.desc||"")+"</span><span class='separator'></span>"),a.addHTML("<h3>Properties</h3>");const l=(d,f)=>{var L,g;switch(s.graph.beforeChange(n),d){case"Title":n.title=f;break;case"Mode":var _=Object.values(LiteGraph.NODE_MODES).indexOf(f);_>=0&&LiteGraph.NODE_MODES[_]?n.changeMode(_):(L=LiteGraph.warn)==null||L.call(LiteGraph,"unexpected mode: "+f);break;case"Color":LGraphCanvas.node_colors[f]?(n.color=LGraphCanvas.node_colors[f].color,n.bgcolor=LGraphCanvas.node_colors[f].bgcolor):(g=LiteGraph.warn)==null||g.call(LiteGraph,"unexpected color: "+f);break;default:n.setProperty(d,f);break}s.graph.afterChange(),s.dirty_canvas=!0};a.addWidget("string","Title",n.title,{},l),a.addWidget("combo","Mode",LiteGraph.NODE_MODES[n.mode],{values:LiteGraph.NODE_MODES},l);var h="";n.color!==void 0&&(h=Object.keys(LGraphCanvas.node_colors).filter(function(d){return LGraphCanvas.node_colors[d].color==n.color})),a.addWidget("combo","Color",h,{values:Object.keys(LGraphCanvas.node_colors)},l);for(var c in n.properties){var p=n.properties[c],u=n.getPropertyInfo(c);n.onAddPropertyToPanel&&n.onAddPropertyToPanel(c,a,p,u,l)||a.addWidget(u.widget||u.type,c,p,u,l)}a.addSeparator(),n.onShowCustomPanelInfo&&n.onShowCustomPanelInfo(a),a.footer.innerHTML="",a.addButton("Delete",function(){n.block_delete||(n.graph.remove(n),a.close())}).classList.add("delete")}a.inner_showCodePad=function(l){a.classList.remove("settings"),a.classList.add("centered"),a.alt_content.innerHTML="<textarea class='code'></textarea>";var h=a.alt_content.querySelector("textarea"),c=()=>{a.toggleAltContent(!1),a.toggleFooterVisibility(!0),h.parentNode.removeChild(h),a.classList.add("settings"),a.classList.remove("centered"),r()};h.value=n.properties[l],h.addEventListener("keydown",function(d){d.code=="Enter"&&d.ctrlKey&&(n.setProperty(l,h.value),c())}),a.toggleAltContent(!0),a.toggleFooterVisibility(!1),h.style.height="calc(100% - 40px)";var p=a.addButton("Assign",function(){n.setProperty(l,h.value),c()});a.alt_content.appendChild(p);var u=a.addButton("Close",c);u.style.float="right",a.alt_content.appendChild(u)},r(),this.canvas.parentNode.appendChild(a)}function showSubgraphPropertiesDialog(n){var o;(o=LiteGraph.log)==null||o.call(LiteGraph,"showing subgraph properties dialog");var s=this.canvas.parentNode.querySelector(".subgraph_dialog");s&&s.close();var a=this.createPanel("Subgraph Inputs",{closable:!0,width:500});a.node=n,a.classList.add("subgraph_dialog");function r(){if(a.clear(),n.inputs)for(let d=0;d<n.inputs.length;++d){var c=n.inputs[d];if(!c.not_subgraph_input){var p="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",u=a.addHTML(p,"subgraph_property");u.dataset.name=c.name,u.dataset.slot=d,u.querySelector(".name").innerText=c.name,u.querySelector(".type").innerText=c.type,u.querySelector("button").addEventListener("click",function(f){n.removeInput(Number(this.parentNode.dataset.slot)),r()})}}}var l=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",h=a.addHTML(l,"subgraph_property extra",!0);return h.querySelector("button").addEventListener("click",function(c){var p=this.parentNode,u=p.querySelector(".name").value,d=p.querySelector(".type").value;!u||n.findInputSlot(u)!=-1||(n.addInput(u,d),p.querySelector(".name").value="",p.querySelector(".type").value="",r())}),r(),this.canvas.parentNode.appendChild(a),a}function showSubgraphPropertiesDialogRight(n){var o=this.canvas.parentNode.querySelector(".subgraph_dialog");o&&o.close();var s=this.createPanel("Subgraph Outputs",{closable:!0,width:500});s.node=n,s.classList.add("subgraph_dialog");function a(){if(s.clear(),n.outputs)for(let d=0;d<n.outputs.length;++d){var c=n.outputs[d];if(!c.not_subgraph_output){var p="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",u=s.addHTML(p,"subgraph_property");u.dataset.name=c.name,u.dataset.slot=d,u.querySelector(".name").innerText=c.name,u.querySelector(".type").innerText=c.type,u.querySelector("button").addEventListener("click",function(f){n.removeOutput(Number(this.parentNode.dataset.slot)),a()})}}}var r=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",l=s.addHTML(r,"subgraph_property extra",!0);l.querySelector(".name").addEventListener("keydown",function(c){e.keyCode==13&&h.apply(this)}),l.querySelector("button").addEventListener("click",function(c){h.apply(this)});function h(){var c=this.parentNode,p=c.querySelector(".name").value,u=c.querySelector(".type").value;!p||n.findOutputSlot(p)!=-1||(n.addOutput(p,u),c.querySelector(".name").value="",c.querySelector(".type").value="",a())}return a(),this.canvas.parentNode.appendChild(s),s}function checkPanels(){if(this.canvas){var n=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(let s=0;s<n.length;++s){var o=n[s];o.node&&(!o.node.graph||o.graph!=this.graph)&&o.close()}}}class UiController{constructor(o){this.host=o}showLinkMenu(...o){return showLinkMenu.apply(this.host,o)}createDefaultNodeForSlot(...o){return createDefaultNodeForSlot.apply(this.host,o)}showConnectionMenu(...o){return showConnectionMenu.apply(this.host,o)}getCanvasMenuOptions(...o){return getCanvasMenuOptions.apply(this.host,o)}getNodeMenuOptions(...o){return getNodeMenuOptions.apply(this.host,o)}getGroupMenuOptions(...o){return getGroupMenuOptions.apply(this.host,o)}processContextMenu(...o){return processContextMenu.apply(this.host,o)}prompt(...o){return prompt.apply(this.host,o)}showSearchBox(...o){return showSearchBox.apply(this.host,o)}showEditPropertyValue(...o){return showEditPropertyValue.apply(this.host,o)}createDialog(...o){return createDialog.apply(this.host,o)}createPanel(...o){return createPanel.apply(this.host,o)}closePanels(...o){return closePanels.apply(this.host,o)}showShowGraphOptionsPanel(...o){return showShowGraphOptionsPanel.apply(this.host,o)}showShowNodePanel(...o){return showShowNodePanel.apply(this.host,o)}showSubgraphPropertiesDialog(...o){return showSubgraphPropertiesDialog.apply(this.host,o)}showSubgraphPropertiesDialogRight(...o){return showSubgraphPropertiesDialogRight.apply(this.host,o)}checkPanels(...o){return checkPanels.apply(this.host,o)}}function createLGraphCanvasControllers(n){return{core:new CoreController(n),events:new EventsController(n),render:new RenderController(n),selection:new SelectionController(n),ui:new UiController(n)}}const delegateMap={clear:"core",setGraph:"core",getTopGraph:"core",openSubgraph:"core",closeSubgraph:"core",getCurrentGraph:"core",setCanvas:"core",_doNothing:"core",_doReturnTrue:"core",bindEvents:"core",unbindEvents:"core",enableWebGL:"core",setDirty:"core",getCanvasWindow:"core",startRendering:"core",stopRendering:"core",blockClick:"events",processUserInputDown:"events",processMouseDown:"events",processMouseMove:"events",processMouseUp:"events",processMouseWheel:"events",isOverNodeBox:"core",isOverNodeInput:"core",isOverNodeOutput:"core",processKey:"events",copyToClipboard:"selection",pasteFromClipboard:"selection",processDrop:"events",checkDropItem:"events",processNodeDblClicked:"selection",processNodeSelected:"selection",selectNode:"selection",selectNodes:"selection",deselectNode:"selection",deselectAllNodes:"selection",deleteSelectedNodes:"selection",centerOnNode:"core",adjustMouseEvent:"core",setZoom:"core",convertOffsetToCanvas:"core",convertCanvasToOffset:"core",convertEventToCanvasOffset:"core",bringToFront:"core",sendToBack:"core",computeVisibleNodes:"core",draw:"render",drawFrontCanvas:"render",drawSubgraphPanel:"render",drawSubgraphPanelLeft:"render",drawSubgraphPanelRight:"render",drawButton:"render",isAreaClicked:"render",renderInfo:"render",drawBackCanvas:"render",drawNode:"render",drawNodeTooltip:"render",drawLinkTooltip:"render",drawNodeShape:"render",drawConnections:"render",renderLink:"render",computeConnectionPoint:"render",drawExecutionOrder:"render",drawNodeWidgets:"render",processNodeWidgets:"render",drawGroups:"render",adjustNodesSize:"render",resize:"core",switchLiveMode:"core",onNodeSelectionChange:"selection",boundaryNodesForSelection:"selection",showLinkMenu:"ui",createDefaultNodeForSlot:"ui",showConnectionMenu:"ui",prompt:"ui",showSearchBox:"ui",showEditPropertyValue:"ui",createDialog:"ui",createPanel:"ui",closePanels:"ui",showShowGraphOptionsPanel:"ui",showShowNodePanel:"ui",showSubgraphPropertiesDialog:"ui",showSubgraphPropertiesDialogRight:"ui",checkPanels:"ui",getCanvasMenuOptions:"ui",getNodeMenuOptions:"ui",getGroupMenuOptions:"ui",processContextMenu:"ui",lowQualityRenderingRequired:"render"};function ensureControllers(n){return n.controllers||(n.controllers=createLGraphCanvasControllers(n)),n.controllers}function installLGraphCanvasDelegates(n){for(const[o,s]of Object.entries(delegateMap))Object.defineProperty(n.prototype,o,{value:function(...a){return ensureControllers(this)[s][o](...a)},writable:!0,configurable:!0})}function getFileExtension(n){const o=new URL(n).pathname,s=o.lastIndexOf(".");return s===-1?"":o.slice(s+1).toLowerCase()}function onGroupAdd(n,o,s){var a=LGraphCanvas.active_canvas,r=new LiteGraph.LGraphGroup;r.pos=a.convertEventToCanvasOffset(s),a.graph.add(r)}function getBoundaryNodes(n){let o=null,s=null,a=null,r=null;for(const l in n){const h=n[l],[c,p]=h.pos,[u,d]=h.size;(o===null||p<o.pos[1])&&(o=h),(s===null||c+u>s.pos[0]+s.size[0])&&(s=h),(a===null||p+d>a.pos[1]+a.size[1])&&(a=h),(r===null||c<r.pos[0])&&(r=h)}return{top:o,right:s,bottom:a,left:r}}function alignNodes(n,o,s){if(!n)return;const a=LGraphCanvas.active_canvas;let r=[];s===void 0?r=LGraphCanvas.getBoundaryNodes(n):r={top:s,right:s,bottom:s,left:s};for(const[l,h]of Object.entries(a.selected_nodes))switch(o){case"right":h.pos[0]=r.right.pos[0]+r.right.size[0]-h.size[0];break;case"left":h.pos[0]=r.left.pos[0];break;case"top":h.pos[1]=r.top.pos[1];break;case"bottom":h.pos[1]=r.bottom.pos[1]+r.bottom.size[1]-h.size[1];break}a.dirty_canvas=!0,a.dirty_bgcanvas=!0}function onNodeAlign(n,o,s,a,r){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:l,parentMenu:a});function l(h){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,h.toLowerCase(),r)}}function onGroupAlign(n,o,s,a){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:r,parentMenu:a});function r(l){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,l.toLowerCase())}}function onMenuAdd(n,o,s,a,r){var l=LGraphCanvas.active_canvas,h=l.getCanvasWindow(),c=l.graph;if(!c)return;function p(u,d){var f=LiteGraph.getNodeTypesCategories(l.filter||c.filter).filter(function(_){return _.startsWith(u)}),L=[];f.map(function(_){if(_){var m=new RegExp("^("+u+")"),b=_.replace(m,"").split("/")[0],G=u===""?b+"/":u+b+"/",C=b;C.indexOf("::")!=-1&&(C=C.split("::")[1]);var E=L.findIndex(function(k){return k.value===G});E===-1&&L.push({value:G,content:C,has_submenu:!0,callback:function(k,A,D,I){p(k.value,I)}})}});var g=LiteGraph.getNodeTypesInCategory(u.slice(0,-1),l.filter||c.filter);g.map(function(_){if(!_.skip_list){var m={value:_.type,content:_.title,has_submenu:!1,callback:function(b,G,C,E){var k=E.getFirstEvent();l.graph.beforeChange();var A=LiteGraph.createNode(b.value);A&&(A.pos=l.convertEventToCanvasOffset(k),l.graph.add(A)),r&&r(A),l.graph.afterChange()}};L.push(m)}}),new LiteGraph.ContextMenu(L,{event:s,parentMenu:d},h)}return p("",a),!1}function onMenuCollapseAll(){}function onMenuNodeEdit(){}function showMenuNodeOptionalInputs(n,o,s,a,r){var l;if(!r)return;var h=this,c=LGraphCanvas.active_canvas,p=c.getCanvasWindow();o=r.optional_inputs,r.onGetInputs&&(o=r.onGetInputs());var u=[];if(o)for(let m=0;m<o.length;m++){var d=o[m];if(!d){u.push(null);continue}var f=d[0];d[2]||(d[2]={}),d[2].label&&(f=d[2].label),d[2].removable=!0;var L={content:f,value:d};d[1]==LiteGraph.ACTION&&(L.className="event"),u.push(L)}if(r.onMenuNodeInputs){var g=r.onMenuNodeInputs(u);g&&(u=g)}if(LiteGraph.do_add_triggers_slots&&r.findInputSlot("onTrigger")==-1&&u.push({content:"On Trigger",value:["onTrigger",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),!u.length){LiteGraph.debug&&((l=LiteGraph.log)==null||l.call(LiteGraph,"no input entries"));return}new LiteGraph.ContextMenu(u,{event:s,callback:_,parentMenu:a,node:r},p);function _(m,b,G){var C;if(r&&(m.callback&&m.callback.call(h,r,m,b,G),m.value)){r.graph.beforeChange();const E=m.value[2]?Object.assign({},m.value[2]):{};r.addInput(m.value[0],m.value[1],E),(C=r.onNodeInputAdd)==null||C.call(r,m.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()}}return!1}function showMenuNodeOptionalOutputs(n,o,s,a,r){if(!r)return;var l=this,h=LGraphCanvas.active_canvas,c=h.getCanvasWindow();o=r.optional_outputs,r.onGetOutputs&&(o=r.onGetOutputs());var p=[];if(o)for(let _=0;_<o.length;_++){var u=o[_];if(!u){p.push(null);continue}if(!(r.flags&&r.flags.skip_repeated_outputs&&r.findOutputSlot(u[0])!=-1)){var d=u[0];u[2]||(u[2]={}),u[2].label&&(d=u[2].label),u[2].removable=!0;var f={content:d,value:u};u[1]==LiteGraph.EVENT&&(f.className="event"),p.push(f)}}if(this.onMenuNodeOutputs&&(p=this.onMenuNodeOutputs(p)),LiteGraph.do_add_triggers_slots&&r.findOutputSlot("onExecuted")==-1&&p.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),r.onMenuNodeOutputs){var L=r.onMenuNodeOutputs(p);L&&(p=L)}if(!p.length)return;new LiteGraph.ContextMenu(p,{event:s,callback:g,parentMenu:a,node:r},c);function g(_,m,b){var G;if(r&&(_.callback&&_.callback.call(l,r,_,m,b),!!_.value)){var C=_.value[1];if(C&&(C.constructor===Object||C.constructor===Array)){var E=[];for(let k in C)E.push({content:k,value:C[k]});return new LiteGraph.ContextMenu(E,{event:m,callback:g,parentMenu:a,node:r}),!1}else{r.graph.beforeChange();const k=_.value[2]?Object.assign({},_.value[2]):{};r.addOutput(_.value[0],_.value[1],k),(G=r.onNodeOutputAdd)==null||G.call(r,_.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()}}}return!1}function onShowMenuNodeProperties(n,o,s,a,r){if(!r||!r.properties)return;var l=LGraphCanvas.active_canvas,h=l.getCanvasWindow(),c=[];for(let d in r.properties){n=r.properties[d]!==void 0?r.properties[d]:" ",typeof n=="object"&&(n=JSON.stringify(n));var p=r.getPropertyInfo(d);(p.type=="enum"||p.type=="combo")&&(n=LGraphCanvas.getPropertyPrintableValue(n,p.values)),n=LGraphCanvas.decodeHTML(n),c.push({content:"<span class='property_name'>"+(p.label?p.label:d)+"</span><span class='property_value'>"+n+"</span>",value:d})}if(!c.length)return;new LiteGraph.ContextMenu(c,{event:s,callback:u,parentMenu:a,allow_html:!0,node:r},h);function u(d){if(r){var f=this.getBoundingClientRect();l.showEditPropertyValue(r,d.value,{position:[f.left,f.top]})}}return!1}function decodeHTML(n){var o=document.createElement("div");return o.innerText=n,o.innerHTML}function onMenuResizeNode(n,o,s,a,r){if(!r)return;const l=c=>{c.size=c.computeSize(),c.onResize&&c.onResize(c.size)};var h=LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)l(r);else for(let c in h.selected_nodes)l(h.selected_nodes[c]);r.setDirtyCanvas(!0,!0)}function onShowPropertyEditor(n,o,s,a,r){var l=n.property||"title",h=r[l],c=document.createElement("div");c.is_modified=!1,c.className="graphdialog",c.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",c.close=()=>{var E;(E=c.parentNode)==null||E.removeChild(c)};var p=c.querySelector(".name");p.innerText=l;var u=c.querySelector(".value");const d=()=>{u&&C(u.value)};u&&(u.value=h,u.addEventListener("blur",function(E){this.focus()}),u.addEventListener("keydown",function(E){if(c.is_modified=!0,E.keyCode==27)c.close();else if(E.keyCode==13)d();else if(E.keyCode!=13&&E.target.localName!="textarea")return;E.preventDefault(),E.stopPropagation()}));var f=LGraphCanvas.active_canvas,L=f.canvas,g=L.getBoundingClientRect(),_=-20,m=-20;g&&(_-=g.left,m-=g.top),s?(c.style.left=s.clientX+_+"px",c.style.top=s.clientY+m+"px"):(c.style.left=L.width*.5+_+"px",c.style.top=L.height*.5+m+"px");var b=c.querySelector("button");b.addEventListener("click",d),L.parentNode.appendChild(c),u&&u.focus();let G=null;c.addEventListener("pointerleave",E=>{LiteGraph.dialog_close_on_mouse_leave&&!c.is_modified&&(G=setTimeout(c.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),c.addEventListener("pointerenter",E=>{LiteGraph.dialog_close_on_mouse_leave&&G&&clearTimeout(G)});const C=E=>{var k;switch(n.type){case"Number":E=Number(E);break;case"Boolean":E=!!E;break}r[l]=E,(k=c.parentNode)==null||k.removeChild(c),r.setDirtyCanvas(!0,!0)}}function getPropertyPrintableValue(n,o){if(!o||o.constructor===Array)return String(n);if(o.constructor===Object){var s="";for(var a in o)if(o[a]==n){s=a;break}return String(n)+" ("+s+")"}}function onMenuNodeCollapse(n,o,s,a,r){r.graph.beforeChange();var l=function(c){c.collapse()},h=LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)l(r);else for(let c in h.selected_nodes)l(h.selected_nodes[c]);r.graph.afterChange()}function onMenuNodePin(n,o,s,a,r){r.pin()}function onMenuNodeMode(n,o,s,a,r){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:s,callback:l,parentMenu:a,node:r});function l(h){if(!r)return;var c=Object.values(LiteGraph.NODE_MODES).indexOf(h);const p=d=>{var f;c>=0&&LiteGraph.NODE_MODES[c]?d.changeMode(c):((f=LiteGraph.warn)==null||f.call(LiteGraph,"unexpected mode: "+h),d.changeMode(LiteGraph.ALWAYS))};var u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)p(r);else for(let d in u.selected_nodes)p(u.selected_nodes[d])}return!1}function onMenuNodeColors(n,o,s,a,r){if(!r)throw new Error("no node for color");var l=[];l.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(let c in LGraphCanvas.node_colors){let p=LGraphCanvas.node_colors[c];n={value:c,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+p.color+"; background-color:"+p.bgcolor+"'>"+c+"</span>"},l.push(n)}new LiteGraph.ContextMenu(l,{event:s,callback:h,parentMenu:a,node:r});function h(c){if(!r)return;let p=c.value?LGraphCanvas.node_colors[c.value]:null;const u=f=>{p?f.constructor===LiteGraph.LGraphGroup?f.color=p.groupcolor:(f.color=p.color,f.bgcolor=p.bgcolor):(delete f.color,delete f.bgcolor)};var d=LGraphCanvas.active_canvas;if(!d.selected_nodes||Object.keys(d.selected_nodes).length<=1)u(r);else for(let f in d.selected_nodes)u(d.selected_nodes[f]);r.setDirtyCanvas(!0,!0)}return!1}function onMenuNodeShapes(n,o,s,a,r){if(!r)throw new Error("no node passed");new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:s,callback:l,parentMenu:a,node:r});function l(h){if(!r)return;r.graph.beforeChange();const c=u=>{u.shape=h};var p=LGraphCanvas.active_canvas;if(!p.selected_nodes||Object.keys(p.selected_nodes).length<=1)c(r);else for(let u in p.selected_nodes)c(p.selected_nodes[u]);r.graph.afterChange(),r.setDirtyCanvas(!0)}return!1}function onMenuNodeRemove(n,o,s,a,r){if(!r)throw new Error("no node passed");var l=r.graph;l.beforeChange();const h=p=>{p.removable!==!1&&l.remove(p)};var c=LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)h(r);else for(let p in c.selected_nodes)h(c.selected_nodes[p]);l.afterChange(),r.setDirtyCanvas(!0,!0)}function onMenuNodeToSubgraph(n,o,s,a,r){var l=r.graph,h=LGraphCanvas.active_canvas;if(h){var c=Object.values(h.selected_nodes||{});c.length||(c=[r]);var p=LiteGraph.createNode("graph/subgraph");p.pos=r.pos.concat(),l.add(p),p.buildFromNodes(c),h.deselectAllNodes(),r.setDirtyCanvas(!0,!0)}}function onMenuNodeClone(n,o,s,a,r){r.graph.beforeChange();var l={};const h=p=>{if(p.clonable!==!1){var u=p.clone();u&&(u.pos=[p.pos[0]+5,p.pos[1]+5],p.graph.add(u),l[u.id]=u)}};var c=LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)h(r);else for(let p in c.selected_nodes)h(c.selected_nodes[p]);Object.keys(l).length&&c.selectNodes(l),r.graph.afterChange(),r.setDirtyCanvas(!0,!0)}const DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",link_type_colors={"-1":"#A86",number:"#AAA",node:"#DCA",string:"#77F",boolean:"#F77"},gradients={},search_limit=-1,node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};function applyLGraphCanvasStatics(n){Object.assign(n,{getFileExtension,onGroupAdd,getBoundaryNodes,alignNodes,onNodeAlign,onGroupAlign,onMenuAdd,onMenuCollapseAll,onMenuNodeEdit,showMenuNodeOptionalInputs,showMenuNodeOptionalOutputs,onShowMenuNodeProperties,decodeHTML,onMenuResizeNode,onShowPropertyEditor,getPropertyPrintableValue,onMenuNodeCollapse,onMenuNodePin,onMenuNodeMode,onMenuNodeColors,onMenuNodeShapes,onMenuNodeRemove,onMenuNodeToSubgraph,onMenuNodeClone}),n.DEFAULT_BACKGROUND_IMAGE=DEFAULT_BACKGROUND_IMAGE,n.link_type_colors=link_type_colors,n.gradients=gradients,n.search_limit=search_limit,n.node_colors=node_colors}class LGraphCanvas{constructor(o,s,a){a!=null||(a={skip_render:!1,autoresize:!1,clip_all_nodes:!1}),this.options=a,this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,o&&o.constructor===String&&(o=document.querySelector(o)),this.ds=new LiteGraph.DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=`${LiteGraph.NODE_TEXT_SIZE}px Arial`,this.inner_text_font=`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.move_destination_link_without_shift=!1,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.free_resize=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.autoresize=a.autoresize,this.skip_render=a.skip_render,this.clip_all_nodes=a.clip_all_nodes,this.free_resize=a.free_resize,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=a.viewport||null,this.low_quality_rendering_threshold=5,this.controllers=createLGraphCanvasControllers(this),this.processMouseWheel=this.processMouseWheel.bind(this),this.processKey=this.processKey.bind(this),this.processDrop=this.processDrop.bind(this),s==null||s.attachCanvas(this),this.setCanvas(o,a.skip_events),this.clear(),!this.skip_render&&!a.skip_render&&this.startRendering()}}installLGraphCanvasDelegates(LGraphCanvas),applyLGraphCanvasStatics(LGraphCanvas);class DragAndScale{constructor(o,s){X(this,"onMouseDown",a=>{if(!this.enabled)return;const r=this.element.getBoundingClientRect();var l=a.clientX-r.left,h=a.clientY-r.top;a.canvasx=l,a.canvasy=h,a.dragging=this.dragging;var c=!this.viewport||this.viewport&&l>=this.viewport[0]&&l<this.viewport[0]+this.viewport[2]&&h>=this.viewport[1]&&h<this.viewport[1]+this.viewport[3];c&&(this.dragging=!0,this.abortController=new AbortController,document.addEventListener("pointermove",this.onMouseMove,{signal:this.abortController.signal}),document.addEventListener("pointerup",this.onMouseUp,{signal:this.abortController.signal})),this.last_mouse[0]=l,this.last_mouse[1]=h}),X(this,"onMouseMove",a=>{if(!this.enabled)return;const r=this.element.getBoundingClientRect();var l=a.clientX-r.left,h=a.clientY-r.top;a.canvasx=l,a.canvasy=h,a.dragging=this.dragging;var c=l-this.last_mouse[0],p=h-this.last_mouse[1];this.dragging&&this.mouseDrag(c,p),this.last_mouse[0]=l,this.last_mouse[1]=h}),X(this,"onMouseUp",a=>{var r;this.dragging=!1,(r=this.abortController)==null||r.abort()}),X(this,"onWheel",a=>{a.wheel=-a.deltaY,a.delta=a.wheelDelta?a.wheelDelta/40:a.deltaY?-a.deltaY/3:0,this.changeDeltaScale(1+a.delta*.05)}),this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),o&&(this.element=o,s||this.bindEvents(o))}bindEvents(o){this.last_mouse=new Float32Array(2),o.addEventListener("pointerdown",this.onMouseDown),o.addEventListener("wheel",this.onWheel)}computeVisibleArea(o){if(!this.element){this.visible_area.set([0,0,0,0]);return}let s=this.element.width,a=this.element.height,r=-this.offset[0],l=-this.offset[1];if(o){r+=o[0]/this.scale,l+=o[1]/this.scale;const[p,u]=o.slice(2);s=p,a=u}const h=r+s/this.scale,c=l+a/this.scale;this.visible_area.set([r,l,h-r,c-l])}toCanvasContext(o){o.scale(this.scale,this.scale),o.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(o){return[(o[0]+this.offset[0])*this.scale,(o[1]+this.offset[1])*this.scale]}convertCanvasToOffset(o,s=[0,0]){return s[0]=o[0]/this.scale-this.offset[0],s[1]=o[1]/this.scale-this.offset[1],s}mouseDrag(o,s){var a;this.offset[0]+=o/this.scale,this.offset[1]+=s/this.scale,(a=this.onredraw)==null||a.call(this,this)}changeScale(o,s){var a;if(o=LiteGraph.clamp(o,this.min_scale,this.max_scale),o==this.scale||!this.element)return;const r=this.element.getBoundingClientRect();if(r){s=s||[r.width*.5,r.height*.5];var l=this.convertCanvasToOffset(s);this.scale=o,Math.abs(this.scale-1)<.01&&(this.scale=1);var h=this.convertCanvasToOffset(s),c=[h[0]-l[0],h[1]-l[1]];this.offset[0]+=c[0],this.offset[1]+=c[1],(a=this.onredraw)==null||a.call(this,this)}}changeDeltaScale(o,s){this.changeScale(this.scale*o,s)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}function normalizeContextMenuOptions(n={}){var o;return(o=n.scroll_speed)!=null||(n.scroll_speed=.1),n}function linkContextMenuToParent(n,o){var s;const a=n.options.parentMenu;if(a){if(a.constructor!==n.constructor){(s=o.error)==null||s.call(o,"parentMenu must be of class ContextMenu, ignoring it"),n.options.parentMenu=null;return}n.parentMenu=a,n.parentMenu.lock=!0,n.parentMenu.current_submenu=n}}function validateContextMenuEventClass(n,o){var s;if(!n.options.event)return;const a=n.options.event.constructor.name;a!=="MouseEvent"&&a!=="CustomEvent"&&a!=="PointerEvent"&&((s=o.error)==null||s.call(o,`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${a})`),n.options.event=null)}function createContextMenuRoot(n){const o=n.root=document.createElement("div");return n.options.className&&(o.className=n.options.className),o.classList.add("litegraph","litecontextmenu","litemenubar-panel"),o.style.minWidth="80px",o.style.minHeight="10px",o}function setContextMenuTitle(n,o){var s;if(!o)return;(s=n.titleElement)!=null||(n.titleElement=document.createElement("div"));const a=n.titleElement;a.className="litemenu-title",a.innerHTML=o,n.root.parentElement||n.root.appendChild(a)}function addContextMenuItems(n,o){for(let s=0;s<o.length;s++){let a=o[s];typeof a!="string"&&(a=a&&a.content!==void 0?String(a.content):String(a));const r=o[s];n.menu_elements.push(n.addItem(a,r,n.options))}}function resolveContextMenuHost(n){var o,s,a;const r=(s=(o=n.options.event)==null?void 0:o.target.ownerDocument)!=null?s:document,l=(a=r.fullscreenElement)!=null?a:r.body;return{doc:r,parent:l}}function appendContextMenuRoot(n,o){o.appendChild(n.root)}function bindContextMenuRootEvents(n){const o=n.root;o.style.pointerEvents="none",setTimeout(()=>{o.style.pointerEvents="auto"},100),o.addEventListener("pointerup",s=>(s.preventDefault(),!0)),o.addEventListener("contextmenu",s=>(s.button!=2||s.preventDefault(),!1)),o.addEventListener("pointerdown",s=>{if(s.button==2)return n.close(),s.preventDefault(),!0}),o.addEventListener("wheel",s=>{const a=parseInt(o.style.top);return o.style.top=(a+s.deltaY*n.options.scroll_speed).toFixed()+"px",s.preventDefault(),!0}),o.addEventListener("pointerenter",s=>{o.closing_timer&&clearTimeout(o.closing_timer)})}function setupContextMenuFiltering(n,o,s,a){var r;if(!o){(r=a.warn)==null||r.call(a,"NO root document to add context menu and event",o,n.options);return}s.f_textfilter&&(o.removeEventListener("keydown",s.f_textfilter,!1),o.removeEventListener("keydown",s.f_textfilter,!0),s.f_textfilter=!1),s.f_textfilter=function(l){var h,c,p,u,d,f,L;if(n.current_submenu){(h=a.debug)==null||h.call(a,"Prevent filtering on ParentMenu",n);return}if(n.allOptions||(n.allOptions=n.menu_elements,n.selectedOption=!1),n.currentOptions||(n.currentOptions=n.allOptions),n.filteringText||(n.filteringText=""),l.key){let g=!1;switch(l.key){case"Backspace":n.filteringText.length&&(n.filteringText=n.filteringText.substring(0,n.filteringText.length-1),g=!0);break;case"Escape":s.f_textfilter&&(o.removeEventListener("keydown",s.f_textfilter,!1),o.removeEventListener("keydown",s.f_textfilter,!0),s.f_textfilter=!1),n.close();break;case"ArrowDown":do n.selectedOption=n.selectedOption!==!1?Math.min(Math.max(n.selectedOption+1,0),n.allOptions.length-1):0;while(n.allOptions[n.selectedOption]&&n.allOptions[n.selectedOption].hidden&&n.selectedOption<n.allOptions.length-1);n.allOptions[n.selectedOption]&&n.allOptions[n.selectedOption].hidden&&(n.selectedOption=n.currentOptions[n.currentOptions.length-1].menu_index),g=!0;break;case"ArrowUp":do n.selectedOption=n.selectedOption!==!1?Math.min(Math.max(n.selectedOption-1,0),n.allOptions.length-1):0;while(n.allOptions[n.selectedOption]&&n.allOptions[n.selectedOption].hidden&&n.selectedOption>0);n.allOptions[n.selectedOption]&&n.allOptions[n.selectedOption].hidden&&(n.currentOptions&&n.currentOptions.length?n.selectedOption=n.currentOptions[0].menu_index:n.selectedOption=!1),g=!0;break;case"ArrowLeft":break;case"ArrowRight":case"Enter":if(n.selectedOption!==!1)n.allOptions[n.selectedOption]?((c=a.debug)==null||c.call(a,"ContextElement simCLICK",n.allOptions[n.selectedOption]),n.allOptions[n.selectedOption].do_click&&n.allOptions[n.selectedOption].do_click(n.options.event,ignore_parent_menu)):((p=a.debug)==null||p.call(a,"ContextElement selection wrong",n.selectedOption),n.selectedOption=n.selectedOption!==!1?Math.min(Math.max(n.selectedOption,0),n.allOptions.length-1):0);else if(n.filteringText.length){for(const _ in n.allOptions)if(n.allOptions[_].style.display!=="none"&&!(n.allOptions[_].classList+"").includes("separator")&&n.allOptions[_].textContent!=="Search"){(u=a.debug)==null||u.call(a,"ContextElement simCLICK",n.allOptions[_]),s.f_textfilter&&o&&(o.removeEventListener("keydown",s.f_textfilter,!1),o.removeEventListener("keydown",s.f_textfilter,!0),(d=a.debug)==null||d.call(a,"Cleaned ParentContextMenu listener",o,n)),n.allOptions[_].do_click(l,!1);break}}g=!0;break;default:(f=a.debug)==null||f.call(a,"ContextMenu filter: keyEvent",l.key);break}!g&&l.key.length==1&&(n.filteringText+=l.key,n.parentMenu)}if(n.filteringText&&n.filteringText!==""){const g=[];n.currentOptions=[];for(const _ in n.allOptions){const m=n.allOptions[_].textContent,b=m.toLocaleLowerCase().includes(n.filteringText.toLocaleLowerCase()),G=m.toLocaleLowerCase().startsWith(n.filteringText.toLocaleLowerCase()),C=m.split("/"),E=C.length>1&&C[C.length-1].toLocaleLowerCase().startsWith(n.filteringText.toLocaleLowerCase())||C.length==1&&G,k=(n.allOptions[_].classList+"").includes("separator")||m==="Search";n.allOptions[_].menu_index=_,b&&!k?(g.push(n.allOptions[_]),n.allOptions[_].style.display="block",n.allOptions[_].hidden=!1,n.currentOptions.push(n.allOptions[_]),n.allOptions[_].filtered_index=n.currentOptions.length-1):(n.allOptions[_].hidden=!0,n.allOptions[_].style.display="none",n.allOptions[_].filtered_index=!1),E?n.allOptions[_].style.fontWeight="bold":G&&(n.allOptions[_].style.fontStyle="italic")}n.selectedOption=n.selectedOption!==!1?Math.min(Math.max(n.selectedOption,0),n.allOptions.length-1):0,n.allOptions[n.selectedOption]&&n.allOptions[n.selectedOption].hidden&&n.currentOptions.length&&(n.selectedOption=n.currentOptions[0].menu_index)}else{n.currentOptions=n.allOptions;for(const g in n.allOptions)n.allOptions[g].style.display="block",n.allOptions[g].style.fontStyle="inherit",n.allOptions[g].style.fontWeight="inherit",n.allOptions[g].hidden=!1,n.allOptions[g].filtered_index=!1,n.allOptions[g].menu_index=g}if(n.selectedOption!==!1){(L=a.debug)==null||L.call(a,"ContextMenu selection: ",n.selectedOption);for(const g in n.allOptions)n.selectedOption+""==g+""?n.allOptions[g].classList.add("selected"):n.allOptions[g].classList.remove("selected")}document.body.getBoundingClientRect(),s.getBoundingClientRect(),s.style.top=n.top_original+"px"},o.removeEventListener("keydown",s.f_textfilter,!0),o.addEventListener("keydown",s.f_textfilter,!0),n._filterDoc=o}function calculateContextMenuBestPosition(n,o){var s;const a=n.options,r=n.root;let l=a.left||0,h=a.top||0;if(n.top_original=h,a.event){if(l=a.event.clientX-10,h=a.event.clientY-10,a.title&&(h-=20),n.top_original=h,a.parentMenu){const u=a.parentMenu.root.getBoundingClientRect();l=u.left+u.width}const c=document.body.getBoundingClientRect(),p=r.getBoundingClientRect();c.height===0&&((s=o.error)==null||s.call(o,"document.body height is 0. That is dangerous, set html,body { height: 100%; }")),c.width&&l>c.width-p.width-10&&(l=c.width-p.width-10),c.height&&h>c.height-p.height-10&&(h=c.height-p.height-10)}r.style.left=`${l}px`,r.style.top=`${h}px`,a.scale&&(r.style.transform=`scale(${a.scale})`)}function createContextMenuItem(n,o,s,a={},r){var l;const h=document.createElement("div");h.className="litemenu-entry submenu";let c=!1;s===null?h.classList.add("separator"):(h.innerHTML=(l=s==null?void 0:s.title)!=null?l:o,h.value=s,s&&(s.disabled&&(c=!0,h.classList.add("disabled")),(s.submenu||s.has_submenu)&&h.classList.add("has_submenu")),typeof s=="function"?(h.dataset.value=o,h.onclick_callback=s):h.dataset.value=s,s.className&&(h.className+=" "+s.className)),n.root.appendChild(h),c||h.addEventListener("click",u),!c&&a.autoopen&&h.addEventListener("pointerenter",d=>{const f=n.value;!f||!f.has_submenu||u.call(n,d)});const p=n;function u(d){var f,L,g,_,m;const b=this.value;let G=!0;if((f=r.debug)==null||f.call(r,"ContextMenu handleMenuItemClick",b,a,G,this.current_submenu,this),(L=p.current_submenu)==null||L.close(d),a.callback&&((g=r.debug)==null||g.call(r,"ContextMenu handleMenuItemClick callback",this,b,a,d,p,a.node),a.callback.call(this,b,a,d,p,a.node)===!0&&(G=!1)),b&&(b.callback&&!a.ignore_item_callbacks&&b.disabled!==!0&&((_=r.debug)==null||_.call(r,"ContextMenu using value callback and !ignore_item_callbacks",this,b,a,d,p,a.node),b.callback.call(this,b,a,d,p,a.extra)===!0&&(G=!1)),b.submenu)){if((m=r.debug)==null||m.call(r,"ContextMenu SUBMENU",this,b,b.submenu.options,d,p,a),!b.submenu.options)throw new Error("ContextMenu submenu needs options");new p.constructor(b.submenu.options,{callback:b.submenu.callback,event:d,parentMenu:p,ignore_item_callbacks:b.submenu.ignore_item_callbacks,title:b.submenu.title,extra:b.submenu.extra,autoopen:a.autoopen}),G=!1}G&&!p.lock&&p.close()}return h}function closeContextMenuInstance(n,o,s,a){var r,l;if(n.root.f_textfilter){const h=n._filterDoc||((r=o==null?void 0:o.target)==null?void 0:r.ownerDocument)||document;h.removeEventListener("keydown",n.root.f_textfilter,!0),h.removeEventListener("keydown",n.root.f_textfilter,!1),n._filterDoc=null}n.parentMenu&&!s&&(n.parentMenu.lock=!1,n.parentMenu.current_submenu=null,o===void 0?n.parentMenu.close():o&&!a.isCursorOverElement(o,n.parentMenu.root)&&a.trigger(n.parentMenu.root,"pointerleave",o)),(l=n.current_submenu)==null||l.close(o,!0),n.root.closing_timer&&clearTimeout(n.root.closing_timer),n.root.parentNode&&n.root.parentNode.removeChild(n.root)}function closeAllContextMenus(n=window){const o=n.document.querySelectorAll(".litecontextmenu");o.length&&o.forEach(s=>{var a;s.close?s.close():(a=s.parentNode)==null||a.removeChild(s)})}function triggerContextMenuEvent(n,o,s,a){const r=new CustomEvent(o,{bubbles:!0,cancelable:!0,detail:s});return a&&Object.defineProperty(r,"litegraphTarget",{value:a}),n.dispatchEvent?n.dispatchEvent(r):n.__events&&n.__events.dispatchEvent(r),r}function isCursorOverContextElement(n,o,s){return s.isInsideRectangle(n.clientX,n.clientY,o.left,o.top,o.width,o.height)}var U,ie,se,re,ne,ae,oe;const Q=class ce{constructor(o,s={}){te(this,U),this.options=normalizeContextMenuOptions(s),this.menu_elements=[],K(this,U,re).call(this),K(this,U,ne).call(this),K(this,U,ie).call(this),K(this,U,se).call(this),this.setTitle(this.options.title),this.addItems(o),K(this,U,ae).call(this),K(this,U,oe).call(this)}setTitle(o){setContextMenuTitle(this,o)}addItems(o){addContextMenuItems(this,o)}addItem(o,s,a={}){return createContextMenuItem(this,o,s,a,LiteGraph)}close(o,s){closeContextMenuInstance(this,o,s,ce)}static trigger(o,s,a,r){return triggerContextMenuEvent(o,s,a,r)}getTopMenu(){var o,s;return(s=(o=this.options.parentMenu)==null?void 0:o.getTopMenu())!=null?s:this}getFirstEvent(){var o,s;return(s=(o=this.options.parentMenu)==null?void 0:o.getFirstEvent())!=null?s:this.options.event}static isCursorOverElement(o,s){return isCursorOverContextElement(o,s,LiteGraph)}};U=new WeakSet,ie=function(){return createContextMenuRoot(this)},se=function(){bindContextMenuRootEvents(this)},re=function(){linkContextMenuToParent(this,LiteGraph)},ne=function(){validateContextMenuEventClass(this,LiteGraph)},ae=function(){const{doc:n,parent:o}=resolveContextMenuHost(this);LiteGraph.context_menu_filter_enabled&&!this.options.parentMenu&&setupContextMenuFiltering(this,n,this.root,LiteGraph),appendContextMenuRoot(this,o)},oe=function(){calculateContextMenuBestPosition(this,LiteGraph)},X(Q,"closeAll",(n=window)=>closeAllContextMenus(n));let ContextMenu=Q;const loggingMethods={logging_set_level(n){this.debug_level=Number(n)},logging(n){if(n>this.debug_level)return;function o(a){let r=[];for(let l=1;l<a.length;l++)typeof a[l]!="undefined"&&r.push(a[l]);return r}let s="debug";if(n>=0&&n<=4&&(s=["error","warn","info","log","debug"][n]),typeof console[s]!="function")throw console.warn("[LG-log] invalid console method",s,o(arguments)),new RangeError;console[s]("[LG]",...o(arguments))},error(){this.logging(0,...arguments)},warn(){this.logging(1,...arguments)},info(){this.logging(2,...arguments)},log(){this.logging(3,...arguments)},debug(){this.logging(4,...arguments)}};let LiteGraph$5=null;function setNodeRegistryMethodsLiteGraph(n){LiteGraph$5=n}const nodeRegistryMethods={registerNodeType(n,o){var s,a,r,l,h,c,p;if(!o.prototype)throw new Error("Cannot register a simple object, it must be a class with a prototype");o.type=n,(s=this.debug)==null||s.call(this,"registerNodeType","start",n);const u=o.name,d=n.lastIndexOf("/");o.category=n.substring(0,d),o.title||(o.title=u);const f=Object.getOwnPropertyDescriptors(LiteGraph$5.LGraphNode.prototype);Object.keys(f).forEach(m=>{o.prototype.hasOwnProperty(m)||Object.defineProperty(o.prototype,m,f[m])});const L=this.registered_node_types[n];if(L&&((a=this.debug)==null||a.call(this,"registerNodeType","replacing node type",n,L)),!Object.prototype.hasOwnProperty.call(o.prototype,"shape")&&(Object.defineProperty(o.prototype,"shape",{set:function(m){switch(m){case"default":delete this._shape;break;case"box":this._shape=LiteGraph$5.BOX_SHAPE;break;case"round":this._shape=LiteGraph$5.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph$5.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph$5.CARD_SHAPE;break;default:this._shape=m}},get:function(){return this._shape},enumerable:!0,configurable:!0}),o.supported_extensions))for(let m in o.supported_extensions){const b=o.supported_extensions[m];b&&b.constructor===String&&(this.node_types_by_file_extension[b.toLowerCase()]=o)}if(this.registered_node_types[n]=o,o.constructor.name&&(this.Nodes[u]=o),(r=LiteGraph$5.onNodeTypeRegistered)==null||r.call(LiteGraph$5,n,o),L&&((l=LiteGraph$5.onNodeTypeReplaced)==null||l.call(LiteGraph$5,n,o,L)),o.prototype.onPropertyChange&&LiteGraph$5.warn("LiteGraph node class "+n+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),o.supported_extensions)for(var g=0;g<o.supported_extensions.length;g++){var _=o.supported_extensions[g];_&&_.constructor===String&&(this.node_types_by_file_extension[_.toLowerCase()]=o)}(h=this.debug)==null||h.call(this,"registerNodeType","type registered",n),this.auto_load_slot_types&&((c=this.debug)==null||c.call(this,"registerNodeType","do auto_load_slot_types",n)),new o((p=o.title)!=null?p:"tmpnode")},unregisterNodeType(n){const o=n.constructor===String?this.registered_node_types[n]:n;if(!o)throw new Error("node type not found: "+n);delete this.registered_node_types[o.type],o.constructor.name&&delete this.Nodes[o.constructor.name]},clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod(n,o){LiteGraph$5.LGraphNode.prototype[n]=o;for(var s in this.registered_node_types){var a=this.registered_node_types[s];a.prototype[n]&&(a.prototype["_"+n]=a.prototype[n]),a.prototype[n]=o}},reloadNodes(n){var o,s,a,r=document.getElementsByTagName("script"),l=[];for(let u=0;u<r.length;u++)l.push(r[u]);var h=document.getElementsByTagName("head")[0];n=document.location.href+n;for(let u=0;u<l.length;u++){var c=l[u].src;if(!(!c||c.substr(0,n.length)!=n))try{(o=this.log)==null||o.call(this,"Reloading: "+c);var p=document.createElement("script");p.type="text/javascript",p.src=c,h.appendChild(p),h.removeChild(l[u])}catch(d){if(LiteGraph$5.throw_errors)throw d;(s=this.log)==null||s.call(this,"Error while reloading "+c)}}(a=this.log)==null||a.call(this,"Nodes reloaded")}};let LiteGraph$4=null;function setNodeFactoryMethodsLiteGraph(n){LiteGraph$4=n}const nodeFactoryMethods={buildNodeClassFromObject(n,o){var s="";if(o.inputs)for(let r=0;r<o.inputs.length;++r){let l=o.inputs[r][0],h=o.inputs[r][1];h&&h.constructor===String&&(h='"'+h+'"'),s+="this.addInput('"+l+"',"+h+`);
`}if(o.outputs)for(let r=0;r<o.outputs.length;++r){let l=o.outputs[r][0],h=o.outputs[r][1];h&&h.constructor===String&&(h='"'+h+'"'),s+="this.addOutput('"+l+"',"+h+`);
`}if(o.properties)for(let r in o.properties){let l=o.properties[r];l&&l.constructor===String&&(l='"'+l+'"'),s+="this.addProperty('"+r+"',"+l+`);
`}s+="if(this.onCreate)this.onCreate()";var a=Function(s);for(let r in o)r!="inputs"&&r!="outputs"&&r!="properties"&&(a.prototype[r]=o[r]);return a.title=o.title||n.split("/").pop(),a.desc=o.desc||"Generated from object",this.registerNodeType(n,a),a},wrapFunctionAsNode(n,o,s,a,r){const l=LiteGraph$4.getParameterNames(o),h=l.map((d,f)=>{const L=s!=null&&s[f]?`'${s[f]}'`:"0";return`this.addInput('${d}', ${L});`}).join(`
`),c=a?`'${a}'`:0,p=r?`this.properties = ${JSON.stringify(r)};`:"",u=new Function(`
            ${h}
            this.addOutput('out', ${c});
            ${p}
        `);return u.title=n.split("/").pop(),u.desc=`Generated from ${o.name}`,u.prototype.onExecute=function(){const d=l.map((L,g)=>this.getInputData(g)),f=o.apply(this,d);this.setOutputData(0,f)},this.registerNodeType(n,u),u},createNode(n,o,s={}){var a,r,l,h,c,p,u,d,f,L,g,_;const m=(a=this.registered_node_types[n])!=null?a:null;if(!m)return(r=this.log)==null||r.call(this,`GraphNode type "${n}" not registered.`),null;o=(l=o!=null?o:m.title)!=null?l:n;let b=null;if(LiteGraph$4.catch_exceptions)try{b=new m(o)}catch(G){return(h=this.error)==null||h.call(this,G),null}else b=new m(o);return b.type=n,(c=b.title)!=null||(b.title=o),(p=b.properties)!=null||(b.properties={}),(u=b.properties_info)!=null||(b.properties_info=[]),(d=b.flags)!=null||(b.flags={}),(f=b.size)!=null||(b.size=b.computeSize()),(L=b.pos)!=null||(b.pos=LiteGraph$4.DEFAULT_POSITION.concat()),(g=b.mode)!=null||(b.mode=LiteGraph$4.ALWAYS),Object.assign(b,s),(_=b.onNodeCreated)==null||_.call(b),b},getNodeType(n){return this.registered_node_types[n]},getNodeTypesInCategory(n,o){const s=Object.values(this.registered_node_types).filter(a=>a.filter!==o?!1:n===""?a.category===null:a.category===n);return this.auto_sort_node_types&&s.sort((a,r)=>a.title.localeCompare(r.title)),s},getNodeTypesCategories(n){const o={"":1};Object.values(this.registered_node_types).forEach(a=>{a.category&&!a.skip_list&&a.filter===n&&(o[a.category]=1)});const s=Object.keys(o);return this.auto_sort_node_types?s.sort():s}},slotTypesMethods={registerNodeAndSlotType(n,o,s=!1){const a=(n.constructor===String&&this.registered_node_types[n]!=="anonymous"?this.registered_node_types[n]:n).constructor.type;let r=[];typeof o=="string"?r=o.split(","):o==this.EVENT||o==this.ACTION?r=["_event_"]:r=["*"];for(let l=0;l<r.length;++l){let h=r[l];h===""&&(h="*");const c=s?"registered_slot_out_types":"registered_slot_in_types";this[c][h]===void 0&&(this[c][h]={nodes:[]}),this[c][h].nodes.includes(a)||this[c][h].nodes.push(a),s?this.slot_types_out.includes(h.toLowerCase())||(this.slot_types_out.push(h.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(h.toLowerCase())||(this.slot_types_in.push(h.toLowerCase()),this.slot_types_in.sort())}},registerSearchboxExtra(n,o,s){this.searchbox_extras[o.toLowerCase()]={type:n,desc:o,data:s}}};let LiteGraph$3=null;function setTypeCompatMethodsLiteGraph(n){LiteGraph$3=n}const typeCompatMethods={isValidConnection(n,o){if((n===""||n==="*")&&(n=0),(o===""||o==="*")&&(o=0),!n||!o||n===o||n===LiteGraph$3.EVENT&&o===LiteGraph$3.ACTION)return!0;if(n=String(n).toLowerCase(),o=String(o).toLowerCase(),!n.includes(",")&&!o.includes(","))return n===o;const s=n.split(","),a=o.split(",");for(const r of s)for(const l of a)if(this.isValidConnection(r,l))return!0;return!1}};let LiteGraph$2=null;function setFileUtilsMethodsLiteGraph(n){LiteGraph$2=n}const fileUtilsMethods={fetchFile(n,o,s,a){if(!n)return null;if(o=o||"text",n.constructor===String)return n.substr(0,4)=="http"&&LiteGraph$2.proxy&&(n=LiteGraph$2.proxy+n.substr(n.indexOf(":")+3)),fetch(n).then(l=>{if(!l.ok)throw new Error("File not found");if(o=="arraybuffer")return l.arrayBuffer();if(o=="text"||o=="string")return l.text();if(o=="json")return l.json();if(o=="blob")return l.blob()}).then(l=>{s&&s(l)}).catch(l=>{var h;(h=this.error)==null||h.call(this,"error fetching file:",n),a&&a(l)});if(n.constructor===File||n.constructor===Blob){var r=new FileReader;if(r.onload=l=>{var h=l.target.result;o=="json"&&(h=JSON.parse(h)),s&&s(h)},o=="arraybuffer")return r.readAsArrayBuffer(n);if(o=="text"||o=="json")return r.readAsText(n);if(o=="blob")return r.readAsBinaryString(n)}return null}},pointerEventsMethods={applyPointerDefaults(){typeof window=="undefined"||typeof window.matchMedia!="function"||window.matchMedia("(pointer: coarse)").matches&&(this.dialog_close_on_mouse_leave=!1,this.search_hide_on_mouse_leave=!1)},resolvePointerEventName(n){if(typeof n!="string")return n;const o=n.toLowerCase(),s=this.pointerevents_method;return s==="mouse"?this.pointer_to_mouse_events[o]||o:s==="pointer"&&this.mouse_to_pointer_events[o]||o},pointerAddListener(n,o,s,a){if(!(n!=null&&n.addEventListener)||typeof s!="function")return!1;const r=this.resolvePointerEventName(o);return n.addEventListener(r,s,a),!0},pointerRemoveListener(n,o,s,a){if(!(n!=null&&n.removeEventListener)||typeof s!="function")return!1;const r=this.resolvePointerEventName(o);return n.removeEventListener(r,s,a),!0},set pointerevents_method(n){const o=typeof n=="string"?n.toLowerCase():"";if(o==="mouse"||o==="pointer"){this._pointerevents_method=o;return}this._pointerevents_method="pointer"},get pointerevents_method(){return this._pointerevents_method||"pointer"}},objectUtilsMethods={cloneObject(n,o){if(n==null)return null;const s=JSON.parse(JSON.stringify(n));if(!o)return s;for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&(o[a]=s[a]);return o},uuidv4(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,n=>(n^Math.random()*16>>n/4).toString(16))},compareObjects(n,o){const s=Object.keys(n);return s.length!==Object.keys(o).length?!1:s.every(a=>n[a]===o[a])}},mathColorUtilsMethods={distance(n,o){const[s,a]=n,[r,l]=o;return Math.sqrt((r-s)**2+(l-a)**2)},colorToString(n){return"rgba("+Math.round(n[0]*255).toFixed()+","+Math.round(n[1]*255).toFixed()+","+Math.round(n[2]*255).toFixed()+","+(n.length==4?n[3].toFixed(2):"1.0")+")"},isInsideRectangle(n,o,s,a,r,l){return n>s&&n<s+r&&o>a&&o<a+l},growBounding(n,o,s){o<n[0]?n[0]=o:o>n[2]&&(n[2]=o),s<n[1]?n[1]=s:s>n[3]&&(n[3]=s)},isInsideBounding(n,o){return n[0]>=o[0][0]&&n[1]>=o[0][1]&&n[0]<=o[1][0]&&n[1]<=o[1][1]},overlapBounding(n,o){const s=n[0]+n[2],a=n[1]+n[3],r=o[0]+o[2],l=o[1]+o[3];return!(n[0]>r||n[1]>l||s<o[0]||a<o[1])},hex2num(n){n.charAt(0)=="#"&&(n=n.slice(1)),n=n.toUpperCase();for(var o="0123456789ABCDEF",s=new Array(3),a=0,r,l,h=0;h<6;h+=2)r=o.indexOf(n.charAt(h)),l=o.indexOf(n.charAt(h+1)),s[a]=r*16+l,a++;return s},num2hex(n){for(var o="0123456789ABCDEF",s="#",a,r,l=0;l<3;l++)a=n[l]/16,r=n[l]%16,s+=o.charAt(a)+o.charAt(r);return s},clamp:(n,o,s)=>o>n?o:s<n?s:n},canvasTextUtilsMethods={canvasFillTextMultiline(n,o,s,a,r,l){var h=(o+"").trim().split(" "),c="",p={lines:[],maxW:0,height:0};if(h.length>1)for(var u=0;u<h.length;u++){var d=c+h[u]+" ",f=n.measureText(d),L=f.width;L>r&&u>0?(n.fillText(c,s,a+l*p.lines.length),c=h[u]+" ",p.max=L,p.lines.push(c)):c=d}else c=h[0];return n.fillText(c,s,a+l*p.lines.length),p.lines.push(c),p.height=l*p.lines.length||l,p}},classUtilsMethods={extendClass:(n,o)=>{for(let s in o)n.hasOwnProperty(s)||(n[s]=o[s]);if(o.prototype)for(let s in o.prototype)o.prototype.hasOwnProperty(s)&&(n.prototype.hasOwnProperty(s)||(o.prototype.__lookupGetter__(s)?n.prototype.__defineGetter__(s,o.prototype.__lookupGetter__(s)):n.prototype[s]=o.prototype[s],o.prototype.__lookupSetter__(s)&&n.prototype.__defineSetter__(s,o.prototype.__lookupSetter__(s))))},getParameterNames:n=>(n+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)};let LiteGraph$1=null;function setLegacyCompatMethodsLiteGraph(n){LiteGraph$1=n}const legacyCompatMethods={closeAllContextMenus:()=>{LiteGraph$1.warn("LiteGraph.closeAllContextMenus is deprecated in favor of LiteGraph.ContextMenu.closeAll()"),LiteGraph$1.ContextMenu.closeAll()}};function installLiteGraphDelegates(n){const o=Object.getPrototypeOf(n);o.__litegraph_delegates_installed||(setNodeRegistryMethodsLiteGraph(n),setNodeFactoryMethodsLiteGraph(n),setTypeCompatMethodsLiteGraph(n),setFileUtilsMethodsLiteGraph(n),setLegacyCompatMethodsLiteGraph(n),[loggingMethods,nodeRegistryMethods,nodeFactoryMethods,slotTypesMethods,typeCompatMethods,fileUtilsMethods,pointerEventsMethods,objectUtilsMethods,mathColorUtilsMethods,canvasTextUtilsMethods,classUtilsMethods,legacyCompatMethods].forEach(s=>{const a=Object.getOwnPropertyDescriptors(s);delete a.__proto__,Object.entries(a).forEach(([r,l])=>{Object.defineProperty(o,r,{...l,configurable:!0})})}),Object.defineProperty(o,"__litegraph_delegates_installed",{value:!0,writable:!1,enumerable:!1,configurable:!1}))}function applyCoreDefaults(n){n.VERSION="0.10.2",n.CANVAS_GRID_SIZE=10,n.NODE_TITLE_HEIGHT=30,n.NODE_TITLE_TEXT_Y=20,n.NODE_SLOT_HEIGHT=20,n.NODE_WIDGET_HEIGHT=20,n.NODE_WIDTH=140,n.NODE_MIN_WIDTH=50,n.NODE_COLLAPSED_RADIUS=10,n.NODE_COLLAPSED_WIDTH=80,n.NODE_TITLE_COLOR="#999",n.NODE_SELECTED_TITLE_COLOR="#FFF",n.NODE_TEXT_SIZE=14,n.NODE_TEXT_COLOR="#AAA",n.NODE_SUBTEXT_SIZE=12,n.NODE_DEFAULT_COLOR="#333",n.NODE_DEFAULT_BGCOLOR="#353535",n.NODE_DEFAULT_BOXCOLOR="#666",n.NODE_DEFAULT_SHAPE="box",n.NODE_BOX_OUTLINE_COLOR="#FFF",n.DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)",n.DEFAULT_GROUP_FONT=24,n.WIDGET_BGCOLOR="#222",n.WIDGET_OUTLINE_COLOR="#666",n.WIDGET_TEXT_COLOR="#DDD",n.WIDGET_SECONDARY_TEXT_COLOR="#999",n.LINK_COLOR="#9A9",n.EVENT_LINK_COLOR="#A86",n.CONNECTING_LINK_COLOR="#AFA",n.MAX_NUMBER_OF_NODES=1e3,n.DEFAULT_POSITION=[100,100],n.VALID_SHAPES=["default","box","round","card"],n.BOX_SHAPE=1,n.ROUND_SHAPE=2,n.CIRCLE_SHAPE=3,n.CARD_SHAPE=4,n.ARROW_SHAPE=5,n.GRID_SHAPE=6,n.INPUT=1,n.OUTPUT=2,n.EVENT=-1,n.ACTION=-1,n.NODE_MODES=["Always","On Event","Never","On Trigger","On Request"],n.NODE_MODES_COLORS=["#666","#422","#333","#224","#626"],n.ALWAYS=0,n.ON_EVENT=1,n.NEVER=2,n.ON_TRIGGER=3,n.ON_REQUEST=4,n.UP=1,n.DOWN=2,n.LEFT=3,n.RIGHT=4,n.CENTER=5,n.LINK_RENDER_MODES=["Straight","Linear","Spline"],n.STRAIGHT_LINK=0,n.LINEAR_LINK=1,n.SPLINE_LINK=2,n.NORMAL_TITLE=0,n.NO_TITLE=1,n.TRANSPARENT_TITLE=2,n.AUTOHIDE_TITLE=3,n.VERTICAL_LAYOUT="vertical",n.proxy=null,n.node_images_path="",n.catch_exceptions=!0,n.throw_errors=!0,n.allow_scripts=!1,n.use_deferred_actions=!0,n.registered_node_types={},n.node_types_by_file_extension={},n.Nodes={},n.Globals={}}function applyUiDefaults(n){n.searchbox_extras={},n.auto_sort_node_types=!1,n.node_box_coloured_when_on=!1,n.node_box_coloured_by_mode=!1,n.dialog_close_on_mouse_leave=!0,n.dialog_close_on_mouse_leave_delay=500,n.search_hide_on_mouse_leave=!0,n.search_filter_enabled=!1,n.search_show_all_on_open=!0,n.show_node_tooltip=!1,n.show_node_tooltip_use_descr_property=!1,n.showCanvasOptions=!1,n.availableCanvasOptions=["allow_addOutSlot_onExecuted","free_resize","highquality_render","use_gradients","pause_rendering","clear_background","read_only","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","move_destination_link_without_shift","set_canvas_dirty_on_mouse_event","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip"]}function applyBehaviorDefaults(n){n.shift_click_do_break_link_from=!1,n.click_do_break_link_to=!1,n.pointer_to_mouse_events=Object.freeze({pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mouseup",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"}),n.mouse_to_pointer_events=Object.freeze({mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseenter:"pointerenter",mouseleave:"pointerleave"}),n.applyPointerDefaults(),n.alt_drag_do_clone_nodes=!1,n.alt_shift_drag_connect_clone_with_input=!0,n.do_add_triggers_slots=!1,n.allow_multi_output_for_events=!0,n.middle_click_slot_add_default_node=!1,n.release_link_on_empty_shows_menu=!1,n.two_fingers_opens_menu=!1,n.backspace_delete=!0,n.ctrl_shift_v_paste_connect_unselected_outputs=!1,n.actionHistory_enabled=!1,n.actionHistoryMaxSave=40,n.refreshAncestorsOnTriggers=!1,n.refreshAncestorsOnActions=!1,n.ensureUniqueExecutionAndActionCall=!1,n.use_uuids=!1,n.context_menu_filter_enabled=!1,n.actionHistoryMaxSave=40,n.canRemoveSlots=!0,n.canRemoveSlots_onlyOptional=!0,n.canRenameSlots=!0,n.canRenameSlots_onlyOptional=!0,n.ensureNodeSingleExecution=!1,n.ensureNodeSingleAction=!1,n.preventAncestorRecalculation=!1,n.ensureUniqueExecutionAndActionCall=!0,n.allowMultiOutputForEvents=!1,n.log_methods=["error","warn","info","log","debug"]}function applySlotsDefaults(n){n.auto_load_slot_types=!1,n.registered_slot_in_types={},n.registered_slot_out_types={},n.slot_types_in=[],n.slot_types_out=[],n.slot_types_default_in=[],n.slot_types_default_out=[],n.graphDefaultConfig={align_to_grid:!0,links_ontop:!1}}var LiteGraph=new class{constructor(){this.LLink=LLink,this.LGraph=LGraph,setupLGraphDelegates(this),this.LGraphNode=LGraphNode,setupLGraphNodeDelegates(this),this.LGraphGroup=LGraphGroup,this.LGraphCanvas=LGraphCanvas,this.DragAndScale=DragAndScale,this.ContextMenu=ContextMenu,installLiteGraphDelegates(this),applyCoreDefaults(this),applyUiDefaults(this),applyBehaviorDefaults(this),applySlotsDefaults(this),this.logging_set_level(2)}};typeof performance!="undefined"?LiteGraph.getTime=performance.now.bind(performance):typeof Date!="undefined"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process!="undefined"?LiteGraph.getTime=()=>{var n=process.hrtime();return n[0]*.001+n[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()},typeof window!="undefined"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||(n=>{window.setTimeout(n,1e3/60)}));export{ContextMenu,DragAndScale,LGraph,LGraphCanvas,LGraphGroup,LGraphNode,LLink,LiteGraph};
