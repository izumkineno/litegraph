var Rl=Object.defineProperty,Cl=tl=>{throw TypeError(tl)},Dl=(tl,el,il)=>el in tl?Rl(tl,el,{enumerable:!0,configurable:!0,writable:!0,value:il}):tl[el]=il,gl=(tl,el,il)=>Dl(tl,typeof el!="symbol"?el+"":el,il),Nl=(tl,el,il)=>el.has(tl)||Cl("Cannot "+il),Sl=(tl,el,il)=>el.has(tl)?Cl("Cannot add the same private member more than once"):el instanceof WeakSet?el.add(tl):el.set(tl,il),vl=(tl,el,il)=>(Nl(tl,el,"access private method"),il),t;(function(tl){tl[tl.No=0]="No",tl[tl.Yes=1]="Yes",tl[tl.NoAndSkip=2]="NoAndSkip",tl[tl.YesAndSkip=3]="YesAndSkip"})(t||(t={}));const e$1={};function s(tl){return tl===void 0}function r(tl){return tl==null}function i(tl){return typeof tl=="string"}const{isFinite:n}=Number;function o(tl){return typeof tl=="number"}const a=/^-?\d+(?:\.\d+)?$/;function h(tl){return typeof tl=="string"&&a.test(tl)?+tl:tl}const{isArray:l}=Array;function d(tl){return tl&&typeof tl=="object"}function c(tl){return d(tl)&&!l(tl)}function u(tl){return JSON.stringify(tl)==="{}"}const _={default:(tl,el)=>(p(el,tl),p(tl,el),tl),assign(tl,el,il){let sl;Object.keys(el).forEach(nl=>{var ol,rl;if(sl=el[nl],(sl==null?void 0:sl.constructor)===Object&&((ol=tl[nl])===null||ol===void 0?void 0:ol.constructor)===Object)return p(tl[nl],el[nl],il&&il[nl]);il&&nl in il?((rl=il[nl])===null||rl===void 0?void 0:rl.constructor)===Object&&p(tl[nl]={},el[nl],il[nl]):tl[nl]=el[nl]})},copyAttrs:(tl,el,il)=>(il.forEach(sl=>{s(el[sl])||(tl[sl]=el[sl])}),tl),clone:tl=>JSON.parse(JSON.stringify(tl)),toMap(tl){const el={};for(let il=0,sl=tl.length;il<sl;il++)el[tl[il]]=!0;return el},stintSet(tl,el,il){il||(il=void 0),tl[el]!==il&&(tl[el]=il)}},{assign:p}=_;class f{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:el}=this;return el&&el.length===6&&el[0]===1}get __usePathBox(){return this.__pathInputed}get __blendMode(){if(this.eraser&&this.eraser!=="path")return"destination-out";const{blendMode:el}=this;return el==="pass-through"?null:el}constructor(el){this.__leaf=el}__get(el){if(this.__input){const il=this.__input[el];if(!s(il))return il}return this[el]}__getData(){const el={tag:this.__leaf.tag},{__input:il}=this;let sl;for(let nl in this)nl[0]!=="_"&&(sl=il?il[nl]:void 0,el[nl]=s(sl)?this[nl]:sl);return el}__setInput(el,il){this.__input||(this.__input={}),this.__input[el]=il}__getInput(el){if(this.__input){const il=this.__input[el];if(!s(il))return il}if(el!=="path"||this.__pathInputed)return this["_"+el]}__removeInput(el){this.__input&&!s(this.__input[el])&&(this.__input[el]=void 0)}__getInputData(el,il){const sl={};if(el)if(l(el))for(let nl of el)sl[nl]=this.__getInput(nl);else for(let nl in el)sl[nl]=this.__getInput(nl);else{let nl,ol,{__input:rl}=this;sl.tag=this.__leaf.tag;for(let al in this)if(al[0]!=="_"&&(nl=this["_"+al],!s(nl))){if(al==="path"&&!this.__pathInputed)continue;ol=rl?rl[al]:void 0,sl[al]=s(ol)?nl:ol}}if(il&&il.matrix){const{a:nl,b:ol,c:rl,d:al,e:ll,f:cl}=this.__leaf.__localMatrix;sl.matrix={a:nl,b:ol,c:rl,d:al,e:ll,f:cl}}return sl}__setMiddle(el,il){this.__middle||(this.__middle={}),this.__middle[el]=il}__getMiddle(el){return this.__middle&&this.__middle[el]}__checkSingle(){const el=this;if(el.blendMode==="pass-through"){const il=this.__leaf;el.opacity<1&&(il.isBranch||el.__hasMultiPaint)||il.__hasEraser||el.eraser||el.filter?el.__single=!0:el.__single&&(el.__single=!1)}else el.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}const g={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(tl){const{types:el}=y;return el[tl]?el[tl]++:(el[tl]=1,0)}},y=g;let m,x,w;const{max:b}=Math,B=[0,0,0,0],v={zero:[...B],tempFour:B,set:(tl,el,il,sl,nl)=>(il===void 0&&(il=sl=nl=el),tl[0]=el,tl[1]=il,tl[2]=sl,tl[3]=nl,tl),setTemp:(tl,el,il,sl)=>k(B,tl,el,il,sl),toTempAB(tl,el,il){w=il?o(tl)?el:tl:[],o(tl)?(m=O(tl),x=el):o(el)?(m=tl,x=O(el)):(m=tl,x=el),m.length!==4&&(m=C(m)),x.length!==4&&(x=C(x))},get(tl,el){let il;if(!o(tl))switch(tl.length){case 4:il=s(el)?tl:[...tl];break;case 2:il=[tl[0],tl[1],tl[0],tl[1]];break;case 3:il=[tl[0],tl[1],tl[2],tl[1]];break;case 1:tl=tl[0];break;default:tl=0}if(il||(il=[tl,tl,tl,tl]),!s(el))for(let sl=0;sl<4;sl++)il[sl]>el&&(il[sl]=el);return il},max:(tl,el,il)=>o(tl)&&o(el)?b(tl,el):(T(tl,el,il),k(w,b(m[0],x[0]),b(m[1],x[1]),b(m[2],x[2]),b(m[3],x[3]))),add:(tl,el,il)=>o(tl)&&o(el)?tl+el:(T(tl,el,il),k(w,m[0]+x[0],m[1]+x[1],m[2]+x[2],m[3]+x[3])),swapAndScale(tl,el,il,sl){if(o(tl))return el===il?tl*el:[tl*il,tl*el];const nl=sl?tl:[],[ol,rl,al,ll]=tl.length===4?tl:C(tl);return k(nl,al*il,ll*el,ol*il,rl*el)}},{set:k,get:C,setTemp:O,toTempAB:T}=v,{round:P,pow:S,max:L,floor:R,PI:E}=Math,I$1={within:(tl,el,il)=>(d(el)&&(il=el.max,el=el.min),!s(el)&&tl<el&&(tl=el),!s(il)&&tl>il&&(tl=il),tl),fourNumber:v.get,formatRotation:(tl,el)=>(tl%=360,el?tl<0&&(tl+=360):(tl>180&&(tl-=360),tl<-180&&(tl+=360)),I$1.float(tl)),getGapRotation(tl,el,il=0){let sl=tl+il;if(el>1){const nl=Math.abs(sl%el);(nl<1||nl>el-1)&&(sl=Math.round(sl/el)*el)}return sl-il},float(tl,el){const il=s(el)?1e12:S(10,el);return(tl=P(tl*il)/il)===-0?0:tl},sign:tl=>tl<0?-1:1,getScaleData(tl,el,il,sl){if(sl||(sl={}),el){const nl=(o(el)?el:el.width||0)/il.width,ol=(o(el)?el:el.height||0)/il.height;sl.scaleX=nl||ol||1,sl.scaleY=ol||nl||1}else tl&&I$1.assignScale(sl,tl);return sl},assignScale(tl,el){o(el)?tl.scaleX=tl.scaleY=el:(tl.scaleX=el.x,tl.scaleY=el.y)},getFloorScale:(tl,el=1)=>L(R(tl),el)/tl,randInt:M,randColor:tl=>`rgba(${M(255)},${M(255)},${M(255)},${tl||1})`};function M(tl){return Math.round(Math.random()*tl)}const A=E/180,W$1=2*E,N$1=E/2;function Y$1(){return{x:0,y:0}}function D(){return{x:0,y:0,width:0,height:0}}function X$1(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:z$1,cos:F$1,acos:U$1,sqrt:j$1}=Math,{float:V$1}=I$1,H={};function G$1(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const q$1={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:G$1(),tempMatrix:{},set(tl,el=1,il=0,sl=0,nl=1,ol=0,rl=0){tl.a=el,tl.b=il,tl.c=sl,tl.d=nl,tl.e=ol,tl.f=rl},get:X$1,getWorld:G$1,copy(tl,el){tl.a=el.a,tl.b=el.b,tl.c=el.c,tl.d=el.d,tl.e=el.e,tl.f=el.f},translate(tl,el,il){tl.e+=el,tl.f+=il},translateInner(tl,el,il,sl){tl.e+=tl.a*el+tl.c*il,tl.f+=tl.b*el+tl.d*il,sl&&(tl.e-=el,tl.f-=il)},scale(tl,el,il=el){tl.a*=el,tl.b*=el,tl.c*=il,tl.d*=il},pixelScale(tl,el,il){il||(il=tl),il.a=tl.a*el,il.b=tl.b*el,il.c=tl.c*el,il.d=tl.d*el,il.e=tl.e*el,il.f=tl.f*el},scaleOfOuter(tl,el,il,sl){Q$1.toInnerPoint(tl,el,H),Q$1.scaleOfInner(tl,H,il,sl)},scaleOfInner(tl,el,il,sl=il){Q$1.translateInner(tl,el.x,el.y),Q$1.scale(tl,il,sl),Q$1.translateInner(tl,-el.x,-el.y)},rotate(tl,el){const{a:il,b:sl,c:nl,d:ol}=tl,rl=F$1(el*=A),al=z$1(el);tl.a=il*rl-sl*al,tl.b=il*al+sl*rl,tl.c=nl*rl-ol*al,tl.d=nl*al+ol*rl},rotateOfOuter(tl,el,il){Q$1.toInnerPoint(tl,el,H),Q$1.rotateOfInner(tl,H,il)},rotateOfInner(tl,el,il){Q$1.translateInner(tl,el.x,el.y),Q$1.rotate(tl,il),Q$1.translateInner(tl,-el.x,-el.y)},skew(tl,el,il){const{a:sl,b:nl,c:ol,d:rl}=tl;il&&(il*=A,tl.a=sl+ol*il,tl.b=nl+rl*il),el&&(el*=A,tl.c=ol+sl*el,tl.d=rl+nl*el)},skewOfOuter(tl,el,il,sl){Q$1.toInnerPoint(tl,el,H),Q$1.skewOfInner(tl,H,il,sl)},skewOfInner(tl,el,il,sl=0){Q$1.translateInner(tl,el.x,el.y),Q$1.skew(tl,il,sl),Q$1.translateInner(tl,-el.x,-el.y)},multiply(tl,el){const{a:il,b:sl,c:nl,d:ol,e:rl,f:al}=tl;tl.a=el.a*il+el.b*nl,tl.b=el.a*sl+el.b*ol,tl.c=el.c*il+el.d*nl,tl.d=el.c*sl+el.d*ol,tl.e=el.e*il+el.f*nl+rl,tl.f=el.e*sl+el.f*ol+al},multiplyParent(tl,el,il,sl,nl){const{e:ol,f:rl}=tl;if(il||(il=tl),s(sl)&&(sl=tl.a!==1||tl.b||tl.c||tl.d!==1),sl){const{a:al,b:ll,c:cl,d:ul}=tl;il.a=al*el.a+ll*el.c,il.b=al*el.b+ll*el.d,il.c=cl*el.a+ul*el.c,il.d=cl*el.b+ul*el.d,nl&&(il.scaleX=el.scaleX*nl.scaleX,il.scaleY=el.scaleY*nl.scaleY)}else il.a=el.a,il.b=el.b,il.c=el.c,il.d=el.d,nl&&(il.scaleX=el.scaleX,il.scaleY=el.scaleY);il.e=ol*el.a+rl*el.c+el.e,il.f=ol*el.b+rl*el.d+el.f},divide(tl,el){Q$1.multiply(tl,Q$1.tempInvert(el))},divideParent(tl,el){Q$1.multiplyParent(tl,Q$1.tempInvert(el))},tempInvert(tl){const{tempMatrix:el}=Q$1;return Q$1.copy(el,tl),Q$1.invert(el),el},invert(tl){const{a:el,b:il,c:sl,d:nl,e:ol,f:rl}=tl;if(il||sl){const al=1/(el*nl-il*sl);tl.a=nl*al,tl.b=-il*al,tl.c=-sl*al,tl.d=el*al,tl.e=-(ol*nl-rl*sl)*al,tl.f=-(rl*el-ol*il)*al}else if(el===1&&nl===1)tl.e=-ol,tl.f=-rl;else{const al=1/(el*nl);tl.a=nl*al,tl.d=el*al,tl.e=-ol*nl*al,tl.f=-rl*el*al}},toOuterPoint(tl,el,il,sl){const{x:nl,y:ol}=el;il||(il=el),il.x=nl*tl.a+ol*tl.c,il.y=nl*tl.b+ol*tl.d,sl||(il.x+=tl.e,il.y+=tl.f)},toInnerPoint(tl,el,il,sl){const{a:nl,b:ol,c:rl,d:al}=tl,ll=1/(nl*al-ol*rl),{x:cl,y:ul}=el;if(il||(il=el),il.x=(cl*al-ul*rl)*ll,il.y=(ul*nl-cl*ol)*ll,!sl){const{e:dl,f:fl}=tl;il.x-=(dl*al-fl*rl)*ll,il.y-=(fl*nl-dl*ol)*ll}},setLayout(tl,el,il,sl,nl){const{x:ol,y:rl,scaleX:al,scaleY:ll}=el;if(s(nl)&&(nl=el.rotation||el.skewX||el.skewY),nl){const{rotation:cl,skewX:ul,skewY:dl}=el,fl=cl*A,hl=F$1(fl),_l=z$1(fl);if(ul||dl){const yl=ul*A,ml=dl*A;tl.a=(hl+ml*-_l)*al,tl.b=(_l+ml*hl)*al,tl.c=(yl*hl-_l)*ll,tl.d=(hl+yl*_l)*ll}else tl.a=hl*al,tl.b=_l*al,tl.c=-_l*ll,tl.d=hl*ll}else tl.a=al,tl.b=0,tl.c=0,tl.d=ll;tl.e=ol,tl.f=rl,(il=il||sl)&&Q$1.translateInner(tl,-il.x,-il.y,!sl)},getLayout(tl,el,il,sl){const{a:nl,b:ol,c:rl,d:al,e:ll,f:cl}=tl;let ul,dl,fl,hl,_l,yl=ll,ml=cl;if(ol||rl){const Tl=nl*al-ol*rl;if(rl&&!sl){ul=j$1(nl*nl+ol*ol),dl=Tl/ul;const Il=nl/ul;fl=ol>0?U$1(Il):-U$1(Il)}else{dl=j$1(rl*rl+al*al),ul=Tl/dl;const Il=rl/dl;fl=N$1-(al>0?U$1(-Il):-U$1(Il))}const bl=V$1(F$1(fl)),Gl=z$1(fl);ul=V$1(ul),dl=V$1(dl),hl=bl?V$1((rl/dl+Gl)/bl/A,9):0,_l=bl?V$1((ol/ul-Gl)/bl/A,9):0,fl=V$1(fl/A)}else ul=nl,dl=al,fl=hl=_l=0;return(el=il||el)&&(yl+=el.x*nl+el.y*rl,ml+=el.x*ol+el.y*al,il||(yl-=el.x,ml-=el.y)),{x:yl,y:ml,scaleX:ul,scaleY:dl,rotation:fl,skewX:hl,skewY:_l}},withScale(tl,el,il=el){const sl=tl;if(!el||!il){const{a:nl,b:ol,c:rl,d:al}=tl;ol||rl?il=(nl*al-ol*rl)/(el=j$1(nl*nl+ol*ol)):(el=nl,il=al)}return sl.scaleX=el,sl.scaleY=il,sl},reset(tl){Q$1.set(tl)}},Q$1=q$1,{float:J$2}=I$1,{toInnerPoint:Z$2,toOuterPoint:$$1}=q$1,{sin:K$1,cos:tt$2,abs:et$2,sqrt:st$2,atan2:rt$2,min:it$2,round:nt$2}=Math,ot$2={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(tl,el=0,il=0){tl.x=el,tl.y=il},setRadius(tl,el,il){tl.radiusX=el,tl.radiusY=s(il)?el:il},copy(tl,el){tl.x=el.x,tl.y=el.y},copyFrom(tl,el,il){tl.x=el,tl.y=il},round(tl,el){tl.x=el?nt$2(tl.x-.5)+.5:nt$2(tl.x),tl.y=el?nt$2(tl.y-.5)+.5:nt$2(tl.y)},move(tl,el,il){d(el)?(tl.x+=el.x,tl.y+=el.y):(tl.x+=el,tl.y+=il)},scale(tl,el,il=el){tl.x&&(tl.x*=el),tl.y&&(tl.y*=il)},scaleOf(tl,el,il,sl=il){tl.x+=(tl.x-el.x)*(il-1),tl.y+=(tl.y-el.y)*(sl-1)},rotate(tl,el,il){il||(il=at$2.defaultPoint);const sl=tt$2(el*=A),nl=K$1(el),ol=tl.x-il.x,rl=tl.y-il.y;tl.x=il.x+ol*sl-rl*nl,tl.y=il.y+ol*nl+rl*sl},tempToInnerOf(tl,el){const{tempPoint:il}=at$2;return lt$2(il,tl),Z$2(el,il,il),il},tempToOuterOf(tl,el){const{tempPoint:il}=at$2;return lt$2(il,tl),$$1(el,il,il),il},tempToInnerRadiusPointOf(tl,el){const{tempRadiusPoint:il}=at$2;return lt$2(il,tl),at$2.toInnerRadiusPointOf(tl,el,il),il},copyRadiusPoint:(tl,el,il,sl)=>(lt$2(tl,el),dt$2(tl,il,sl),tl),toInnerRadiusPointOf(tl,el,il){il||(il=tl),Z$2(el,tl,il),il.radiusX=Math.abs(tl.radiusX/el.scaleX),il.radiusY=Math.abs(tl.radiusY/el.scaleY)},toInnerOf(tl,el,il){Z$2(el,tl,il)},toOuterOf(tl,el,il){$$1(el,tl,il)},getCenter:(tl,el)=>({x:tl.x+(el.x-tl.x)/2,y:tl.y+(el.y-tl.y)/2}),getCenterX:(tl,el)=>tl+(el-tl)/2,getCenterY:(tl,el)=>tl+(el-tl)/2,getDistance:(tl,el)=>ht$2(tl.x,tl.y,el.x,el.y),getDistanceFrom(tl,el,il,sl){const nl=et$2(il-tl),ol=et$2(sl-el);return st$2(nl*nl+ol*ol)},getMinDistanceFrom:(tl,el,il,sl,nl,ol)=>it$2(ht$2(tl,el,il,sl),ht$2(il,sl,nl,ol)),getAngle:(tl,el)=>ct$2(tl,el)/A,getRotation:(tl,el,il,sl)=>(sl||(sl=el),at$2.getRadianFrom(tl.x,tl.y,el.x,el.y,il.x,il.y,sl.x,sl.y)/A),getRadianFrom(tl,el,il,sl,nl,ol,rl,al){s(rl)&&(rl=il,al=sl);const ll=tl-il,cl=el-sl,ul=nl-rl,dl=ol-al;return Math.atan2(ll*dl-cl*ul,ll*ul+cl*dl)},getAtan2:(tl,el)=>rt$2(el.y-tl.y,el.x-tl.x),getDistancePoint(tl,el,il,sl,nl){const ol=ct$2(tl,el);return nl&&(tl=el),sl||(el={}),el.x=tl.x+tt$2(ol)*il,el.y=tl.y+K$1(ol)*il,el},toNumberPoints(tl){let el=tl;return d(tl[0])&&(el=[],tl.forEach(il=>el.push(il.x,il.y))),el},isSame:(tl,el)=>J$2(tl.x)===J$2(el.x)&&J$2(tl.y)===J$2(el.y),reset(tl){at$2.reset(tl)}},at$2=ot$2,{getDistanceFrom:ht$2,copy:lt$2,setRadius:dt$2,getAtan2:ct$2}=at$2;let ut$2=class nc{constructor(el,il){this.set(el,il)}set(el,il){return d(el)?ot$2.copy(this,el):ot$2.set(this,el,il),this}get(){const{x:el,y:il}=this;return{x:el,y:il}}clone(){return new nc(this)}move(el,il){return ot$2.move(this,el,il),this}scale(el,il){return ot$2.scale(this,el,il),this}scaleOf(el,il,sl){return ot$2.scaleOf(this,el,il,sl),this}rotate(el,il){return ot$2.rotate(this,el,il),this}rotateOf(el,il){return ot$2.rotate(this,il,el),this}getRotation(el,il,sl){return ot$2.getRotation(this,el,il,sl)}toInnerOf(el,il){return ot$2.toInnerOf(this,el,il),this}toOuterOf(el,il){return ot$2.toOuterOf(this,el,il),this}getCenter(el){return new nc(ot$2.getCenter(this,el))}getDistance(el){return ot$2.getDistance(this,el)}getDistancePoint(el,il,sl,nl){return new nc(ot$2.getDistancePoint(this,el,il,sl,nl))}getAngle(el){return ot$2.getAngle(this,el)}getAtan2(el){return ot$2.getAtan2(this,el)}isSame(el){return ot$2.isSame(this,el)}reset(){return ot$2.reset(this),this}};const _t$2=new ut$2;let pt$2=class lc{constructor(el,il,sl,nl,ol,rl){this.set(el,il,sl,nl,ol,rl)}set(el,il,sl,nl,ol,rl){return d(el)?q$1.copy(this,el):q$1.set(this,el,il,sl,nl,ol,rl),this}setWith(el){return q$1.copy(this,el),this.scaleX=el.scaleX,this.scaleY=el.scaleY,this}get(){const{a:el,b:il,c:sl,d:nl,e:ol,f:rl}=this;return{a:el,b:il,c:sl,d:nl,e:ol,f:rl}}clone(){return new lc(this)}translate(el,il){return q$1.translate(this,el,il),this}translateInner(el,il){return q$1.translateInner(this,el,il),this}scale(el,il){return q$1.scale(this,el,il),this}scaleWith(el,il){return q$1.scale(this,el,il),this.scaleX*=el,this.scaleY*=il||el,this}pixelScale(el){return q$1.pixelScale(this,el),this}scaleOfOuter(el,il,sl){return q$1.scaleOfOuter(this,el,il,sl),this}scaleOfInner(el,il,sl){return q$1.scaleOfInner(this,el,il,sl),this}rotate(el){return q$1.rotate(this,el),this}rotateOfOuter(el,il){return q$1.rotateOfOuter(this,el,il),this}rotateOfInner(el,il){return q$1.rotateOfInner(this,el,il),this}skew(el,il){return q$1.skew(this,el,il),this}skewOfOuter(el,il,sl){return q$1.skewOfOuter(this,el,il,sl),this}skewOfInner(el,il,sl){return q$1.skewOfInner(this,el,il,sl),this}multiply(el){return q$1.multiply(this,el),this}multiplyParent(el){return q$1.multiplyParent(this,el),this}divide(el){return q$1.divide(this,el),this}divideParent(el){return q$1.divideParent(this,el),this}invert(){return q$1.invert(this),this}invertWith(){return q$1.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(el,il,sl){q$1.toOuterPoint(this,el,il,sl)}toInnerPoint(el,il,sl){q$1.toInnerPoint(this,el,il,sl)}setLayout(el,il,sl){return q$1.setLayout(this,el,il,sl),this}getLayout(el,il,sl){return q$1.getLayout(this,el,il,sl)}withScale(el,il){return q$1.withScale(this,el,il)}reset(){q$1.reset(this)}};const ft$2=new pt$2,gt$2={tempPointBounds:{},setPoint(tl,el,il){tl.minX=tl.maxX=el,tl.minY=tl.maxY=il},addPoint(tl,el,il){tl.minX=el<tl.minX?el:tl.minX,tl.minY=il<tl.minY?il:tl.minY,tl.maxX=el>tl.maxX?el:tl.maxX,tl.maxY=il>tl.maxY?il:tl.maxY},addBounds(tl,el,il,sl,nl){yt$2(tl,el,il),yt$2(tl,el+sl,il+nl)},copy(tl,el){tl.minX=el.minX,tl.minY=el.minY,tl.maxX=el.maxX,tl.maxY=el.maxY},addPointBounds(tl,el){tl.minX=el.minX<tl.minX?el.minX:tl.minX,tl.minY=el.minY<tl.minY?el.minY:tl.minY,tl.maxX=el.maxX>tl.maxX?el.maxX:tl.maxX,tl.maxY=el.maxY>tl.maxY?el.maxY:tl.maxY},toBounds(tl,el){el.x=tl.minX,el.y=tl.minY,el.width=tl.maxX-tl.minX,el.height=tl.maxY-tl.minY}},{addPoint:yt$2}=gt$2;var mt$3,xt$2;(function(tl){tl[tl.top=0]="top",tl[tl.right=1]="right",tl[tl.bottom=2]="bottom",tl[tl.left=3]="left"})(mt$3||(mt$3={})),(function(tl){tl[tl.topLeft=0]="topLeft",tl[tl.top=1]="top",tl[tl.topRight=2]="topRight",tl[tl.right=3]="right",tl[tl.bottomRight=4]="bottomRight",tl[tl.bottom=5]="bottom",tl[tl.bottomLeft=6]="bottomLeft",tl[tl.left=7]="left",tl[tl.center=8]="center",tl[tl["top-left"]=0]="top-left",tl[tl["top-right"]=2]="top-right",tl[tl["bottom-right"]=4]="bottom-right",tl[tl["bottom-left"]=6]="bottom-left"})(xt$2||(xt$2={}));const wt$2=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];wt$2.forEach(tl=>tl.type="percent");const bt$3={directionData:wt$2,tempPoint:{},get:Bt$3,toPoint(tl,el,il,sl,nl,ol){const rl=Bt$3(tl);il.x=rl.x,il.y=rl.y,rl.type==="percent"&&(il.x*=el.width,il.y*=el.height,nl&&(ol||(il.x-=nl.x,il.y-=nl.y),rl.x&&(il.x-=rl.x===1?nl.width:rl.x===.5?rl.x*nl.width:0),rl.y&&(il.y-=rl.y===1?nl.height:rl.y===.5?rl.y*nl.height:0))),sl||(il.x+=el.x,il.y+=el.y)},getPoint:(tl,el,il)=>(il||(il={}),bt$3.toPoint(tl,el,il,!0),il)};function Bt$3(tl){return i(tl)?wt$2[xt$2[tl]]:tl}const{toPoint:vt$2}=bt$3,kt$3={toPoint(tl,el,il,sl,nl,ol){vt$2(tl,il,sl,nl,el,ol)}},{tempPointBounds:Ct$3,setPoint:Ot$3,addPoint:Tt$3,toBounds:Pt$3}=gt$2,{toOuterPoint:St$3}=q$1,{float:Lt$3,fourNumber:Rt$3}=I$1,{floor:Et$3,ceil:It$3}=Math;let Mt$3,At$3,Wt$3,Nt$3;const Yt$3={},Dt$3={},Xt$3={},zt$2={tempBounds:Xt$3,set(tl,el=0,il=0,sl=0,nl=0){tl.x=el,tl.y=il,tl.width=sl,tl.height=nl},copy(tl,el){tl.x=el.x,tl.y=el.y,tl.width=el.width,tl.height=el.height},copyAndSpread(tl,el,il,sl,nl){const{x:ol,y:rl,width:al,height:ll}=el;if(l(il)){const cl=Rt$3(il);sl?Ft$3.set(tl,ol+cl[3],rl+cl[0],al-cl[1]-cl[3],ll-cl[2]-cl[0]):Ft$3.set(tl,ol-cl[3],rl-cl[0],al+cl[1]+cl[3],ll+cl[2]+cl[0])}else sl&&(il=-il),Ft$3.set(tl,ol-il,rl-il,al+2*il,ll+2*il);nl&&(nl==="width"?(tl.y=rl,tl.height=ll):(tl.x=ol,tl.width=al))},minX:tl=>tl.width>0?tl.x:tl.x+tl.width,minY:tl=>tl.height>0?tl.y:tl.y+tl.height,maxX:tl=>tl.width>0?tl.x+tl.width:tl.x,maxY:tl=>tl.height>0?tl.y+tl.height:tl.y,move(tl,el,il){tl.x+=el,tl.y+=il},scroll(tl,el){tl.x+=el.scrollX,tl.y+=el.scrollY},getByMove:(tl,el,il)=>(tl=Object.assign({},tl),Ft$3.move(tl,el,il),tl),toOffsetOutBounds(tl,el,il){el?jt$3(el,tl):el=tl,il||(il=tl),el.offsetX=Ft$3.maxX(il),el.offsetY=Ft$3.maxY(il),Ft$3.move(el,-el.offsetX,-el.offsetY)},scale(tl,el,il=el,sl){sl||ot$2.scale(tl,el,il),tl.width*=el,tl.height*=il},scaleOf(tl,el,il,sl=il){ot$2.scaleOf(tl,el,il,sl),tl.width*=il,tl.height*=sl},tempToOuterOf:(tl,el)=>(Ft$3.copy(Xt$3,tl),Ft$3.toOuterOf(Xt$3,el),Xt$3),getOuterOf:(tl,el)=>(tl=Object.assign({},tl),Ft$3.toOuterOf(tl,el),tl),toOuterOf(tl,el,il){if(il||(il=tl),el.b===0&&el.c===0){const{a:sl,d:nl,e:ol,f:rl}=el;sl>0?(il.width=tl.width*sl,il.x=ol+tl.x*sl):(il.width=tl.width*-sl,il.x=ol+tl.x*sl-il.width),nl>0?(il.height=tl.height*nl,il.y=rl+tl.y*nl):(il.height=tl.height*-nl,il.y=rl+tl.y*nl-il.height)}else Yt$3.x=tl.x,Yt$3.y=tl.y,St$3(el,Yt$3,Dt$3),Ot$3(Ct$3,Dt$3.x,Dt$3.y),Yt$3.x=tl.x+tl.width,St$3(el,Yt$3,Dt$3),Tt$3(Ct$3,Dt$3.x,Dt$3.y),Yt$3.y=tl.y+tl.height,St$3(el,Yt$3,Dt$3),Tt$3(Ct$3,Dt$3.x,Dt$3.y),Yt$3.x=tl.x,St$3(el,Yt$3,Dt$3),Tt$3(Ct$3,Dt$3.x,Dt$3.y),Pt$3(Ct$3,il)},toInnerOf(tl,el,il){il||(il=tl),Ft$3.move(il,-el.e,-el.f),Ft$3.scale(il,1/el.a,1/el.d)},getFitMatrix(tl,el,il=1){const sl=Math.min(il,Ft$3.getFitScale(tl,el));return new pt$2(sl,0,0,sl,-el.x*sl,-el.y*sl)},getFitScale(tl,el,il){const sl=tl.width/el.width,nl=tl.height/el.height;return il?Math.max(sl,nl):Math.min(sl,nl)},put(tl,el,il="center",sl=1,nl=!0,ol){ol||(ol=el),i(sl)&&(sl=Ft$3.getFitScale(tl,el,sl==="cover")),Xt$3.width=nl?el.width*=sl:el.width*sl,Xt$3.height=nl?el.height*=sl:el.height*sl,kt$3.toPoint(il,Xt$3,tl,ol,!0,!0)},getSpread(tl,el,il){const sl={};return Ft$3.copyAndSpread(sl,tl,el,!1,il),sl},spread(tl,el,il){Ft$3.copyAndSpread(tl,tl,el,!1,il)},shrink(tl,el,il){Ft$3.copyAndSpread(tl,tl,el,!0,il)},ceil(tl){const{x:el,y:il}=tl;tl.x=Et$3(tl.x),tl.y=Et$3(tl.y),tl.width=el>tl.x?It$3(tl.width+el-tl.x):It$3(tl.width),tl.height=il>tl.y?It$3(tl.height+il-tl.y):It$3(tl.height)},unsign(tl){tl.width<0&&(tl.x+=tl.width,tl.width=-tl.width),tl.height<0&&(tl.y+=tl.height,tl.height=-tl.height)},float(tl,el){tl.x=Lt$3(tl.x,el),tl.y=Lt$3(tl.y,el),tl.width=Lt$3(tl.width,el),tl.height=Lt$3(tl.height,el)},add(tl,el,il){Mt$3=tl.x+tl.width,At$3=tl.y+tl.height,Wt$3=el.x,Nt$3=el.y,il||(Wt$3+=el.width,Nt$3+=el.height),Mt$3=Mt$3>Wt$3?Mt$3:Wt$3,At$3=At$3>Nt$3?At$3:Nt$3,tl.x=tl.x<el.x?tl.x:el.x,tl.y=tl.y<el.y?tl.y:el.y,tl.width=Mt$3-tl.x,tl.height=At$3-tl.y},addList(tl,el){Ft$3.setListWithFn(tl,el,void 0,!0)},setList(tl,el,il=!1){Ft$3.setListWithFn(tl,el,void 0,il)},addListWithFn(tl,el,il){Ft$3.setListWithFn(tl,el,il,!0)},setListWithFn(tl,el,il,sl=!1){let nl,ol=!0;for(let rl=0,al=el.length;rl<al;rl++)nl=il?il(el[rl],rl):el[rl],nl&&(nl.width||nl.height)&&(ol?(ol=!1,sl||jt$3(tl,nl)):Ut$3(tl,nl));ol&&Ft$3.reset(tl)},setPoints(tl,el){el.forEach((il,sl)=>sl===0?Ot$3(Ct$3,il.x,il.y):Tt$3(Ct$3,il.x,il.y)),Pt$3(Ct$3,tl)},setPoint(tl,el){Ft$3.set(tl,el.x,el.y)},addPoint(tl,el){Ut$3(tl,el,!0)},getPoints(tl){const{x:el,y:il,width:sl,height:nl}=tl;return[{x:el,y:il},{x:el+sl,y:il},{x:el+sl,y:il+nl},{x:el,y:il+nl}]},hitRadiusPoint:(tl,el,il)=>(il&&(el=ot$2.tempToInnerRadiusPointOf(el,il)),el.x>=tl.x-el.radiusX&&el.x<=tl.x+tl.width+el.radiusX&&el.y>=tl.y-el.radiusY&&el.y<=tl.y+tl.height+el.radiusY),hitPoint:(tl,el,il)=>(il&&(el=ot$2.tempToInnerOf(el,il)),el.x>=tl.x&&el.x<=tl.x+tl.width&&el.y>=tl.y&&el.y<=tl.y+tl.height),hit:(tl,el,il)=>(il&&(el=Ft$3.tempToOuterOf(el,il)),!(tl.y+tl.height<el.y||el.y+el.height<tl.y||tl.x+tl.width<el.x||el.x+el.width<tl.x)),includes:(tl,el,il)=>(il&&(el=Ft$3.tempToOuterOf(el,il)),tl.x<=el.x&&tl.y<=el.y&&tl.x+tl.width>=el.x+el.width&&tl.y+tl.height>=el.y+el.height),getIntersectData(tl,el,il){if(il&&(el=Ft$3.tempToOuterOf(el,il)),!Ft$3.hit(tl,el))return{x:0,y:0,width:0,height:0};let{x:sl,y:nl,width:ol,height:rl}=el;return Mt$3=sl+ol,At$3=nl+rl,Wt$3=tl.x+tl.width,Nt$3=tl.y+tl.height,sl=sl>tl.x?sl:tl.x,nl=nl>tl.y?nl:tl.y,Mt$3=Mt$3<Wt$3?Mt$3:Wt$3,At$3=At$3<Nt$3?At$3:Nt$3,ol=Mt$3-sl,rl=At$3-nl,{x:sl,y:nl,width:ol,height:rl}},intersect(tl,el,il){Ft$3.copy(tl,Ft$3.getIntersectData(tl,el,il))},isSame:(tl,el)=>tl.x===el.x&&tl.y===el.y&&tl.width===el.width&&tl.height===el.height,isEmpty:tl=>tl.x===0&&tl.y===0&&tl.width===0&&tl.height===0,hasSize:tl=>tl.width&&tl.height,reset(tl){Ft$3.set(tl)}},Ft$3=zt$2,{add:Ut$3,copy:jt$3}=Ft$3;let Vt$3=class rc{get minX(){return zt$2.minX(this)}get minY(){return zt$2.minY(this)}get maxX(){return zt$2.maxX(this)}get maxY(){return zt$2.maxY(this)}constructor(el,il,sl,nl){this.set(el,il,sl,nl)}set(el,il,sl,nl){return d(el)?zt$2.copy(this,el):zt$2.set(this,el,il,sl,nl),this}get(){const{x:el,y:il,width:sl,height:nl}=this;return{x:el,y:il,width:sl,height:nl}}clone(){return new rc(this)}move(el,il){return zt$2.move(this,el,il),this}scale(el,il,sl){return zt$2.scale(this,el,il,sl),this}scaleOf(el,il,sl){return zt$2.scaleOf(this,el,il,sl),this}toOuterOf(el,il){return zt$2.toOuterOf(this,el,il),this}toInnerOf(el,il){return zt$2.toInnerOf(this,el,il),this}getFitMatrix(el,il){return zt$2.getFitMatrix(this,el,il)}put(el,il,sl){zt$2.put(this,el,il,sl)}spread(el,il){return zt$2.spread(this,el,il),this}shrink(el,il){return zt$2.shrink(this,el,il),this}ceil(){return zt$2.ceil(this),this}unsign(){return zt$2.unsign(this),this}float(el){return zt$2.float(this,el),this}add(el){return zt$2.add(this,el),this}addList(el){return zt$2.setList(this,el,!0),this}setList(el){return zt$2.setList(this,el),this}addListWithFn(el,il){return zt$2.setListWithFn(this,el,il,!0),this}setListWithFn(el,il){return zt$2.setListWithFn(this,el,il),this}setPoint(el){return zt$2.setPoint(this,el),this}setPoints(el){return zt$2.setPoints(this,el),this}addPoint(el){return zt$2.addPoint(this,el),this}getPoints(){return zt$2.getPoints(this)}hitPoint(el,il){return zt$2.hitPoint(this,el,il)}hitRadiusPoint(el,il){return zt$2.hitRadiusPoint(this,el,il)}hit(el,il){return zt$2.hit(this,el,il)}includes(el,il){return zt$2.includes(this,el,il)}intersect(el,il){return zt$2.intersect(this,el,il),this}getIntersect(el,il){return new rc(zt$2.getIntersectData(this,el,il))}isSame(el){return zt$2.isSame(this,el)}isEmpty(){return zt$2.isEmpty(this)}reset(){zt$2.reset(this)}};const Ht$3=new Vt$3;let Gt$2=class{constructor(tl,el,il,sl,nl,ol){d(tl)?this.copy(tl):this.set(tl,el,il,sl,nl,ol)}set(tl=0,el=0,il=0,sl=0,nl=0,ol=0){this.top=tl,this.right=el,this.bottom=il,this.left=sl,this.width=nl,this.height=ol}copy(tl){const{top:el,right:il,bottom:sl,left:nl,width:ol,height:rl}=tl;this.set(el,il,sl,nl,ol,rl)}getBoundsFrom(tl){const{top:el,right:il,bottom:sl,left:nl,width:ol,height:rl}=this;return new Vt$3(nl,el,ol||tl.width-nl-il,rl||tl.height-el-sl)}};const qt$2={number:(tl,el)=>d(tl)?tl.type==="percent"?tl.value*el:tl.value:tl},Qt$2={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1},{floor:Jt$2,max:Zt$2}=Math,$t$2={toURL(tl,el){let il=encodeURIComponent(tl);return el==="text"?il="data:text/plain;charset=utf-8,"+il:el==="svg"&&(il="data:image/svg+xml,"+il),il},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",isLarge:(tl,el,il,sl)=>tl.width*tl.height*(el?el*il:1)>(sl||Kt$3.maxCacheSize),isSuperLarge:(tl,el,il)=>Kt$3.isLarge(tl,el,il,Kt$3.maxPatternSize),getRealURL(tl){const{prefix:el,suffix:il}=Kt$3;return!il||tl.startsWith("data:")||tl.startsWith("blob:")||(tl+=(tl.includes("?")?"&":"?")+il),el&&tl[0]==="/"&&(tl=el+tl),tl},resize(tl,el,il,sl,nl,ol,rl,al,ll,cl){const ul=Zt$2(Jt$2(el+(sl||0)),1),dl=Zt$2(Jt$2(il+(nl||0)),1);let fl,hl,_l;cl&&(_l=qt$2.number(cl.offset,cl.type==="x"?el:il))&&(cl.type==="x"?fl=!0:hl=!0);const yl=$t$2.origin.createCanvas(hl?2*ul:ul,fl?2*dl:dl),ml=yl.getContext("2d");if(al&&(ml.globalAlpha=al),ml.imageSmoothingEnabled=rl!==!1,Kt$3.canUse(tl)){if(ol){const Tl=el/ol.width,bl=il/ol.height;ml.setTransform(Tl,0,0,bl,-ol.x*Tl,-ol.y*bl),ml.drawImage(tl,0,0,tl.width,tl.height)}else ml.drawImage(tl,0,0,el,il);_l&&(ml.drawImage(yl,0,0,ul,dl,fl?_l-ul:ul,fl?dl:_l-dl,ul,dl),ml.drawImage(yl,0,0,ul,dl,fl?_l:ul,fl?dl:_l,ul,dl))}return yl},canUse:tl=>tl&&tl.width&&!tl.__closed,setPatternTransform(tl,el,il){try{el&&tl.setTransform&&(tl.setTransform(el),el=void 0)}catch{}il&&_.stintSet(il,"transform",el)}}},{image:Kt$3}=$t$2,{randColor:te$2}=I$1;let ee$2=class ac{constructor(el){this.repeatMap={},this.name=el}static get(el){return new ac(el)}static set filter(el){this.filterList=se$2(el)}static set exclude(el){this.excludeList=se$2(el)}static drawRepaint(el,il){const sl=te$2();el.fillWorld(il,sl.replace("1)",".1)")),el.strokeWorld(il,sl)}static drawBounds(el,il,sl){const nl=ac.showBounds==="hit",ol=el.__nowWorld,rl=te$2();nl&&(il.setWorld(ol),el.__drawHitPath(il),il.fillStyle=rl.replace("1)",".2)"),il.fill()),il.resetTransform(),il.setStroke(rl,2),nl?il.stroke():il.strokeWorld(ol,rl)}log(...el){if(re$2.enable){if(re$2.filterList.length&&re$2.filterList.every(il=>il!==this.name)||re$2.excludeList.length&&re$2.excludeList.some(il=>il===this.name))return;console.log("%c"+this.name,"color:#21ae62",...el)}}tip(...el){re$2.enable&&this.warn(...el)}warn(...el){re$2.showWarn&&console.warn(this.name,...el)}repeat(el,...il){this.repeatMap[el]||(this.warn("repeat:"+el,...il),this.repeatMap[el]=!0)}error(...el){try{throw new Error}catch(il){console.error(this.name,...el,il)}}};function se$2(tl){return tl?i(tl)&&(tl=[tl]):tl=[],tl}ee$2.filterList=[],ee$2.excludeList=[],ee$2.showWarn=!0;const re$2=ee$2,ie$2=ee$2.get("RunTime"),ne$2={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(tl,el){const il=g.create(g.RUNTIME);return oe$2.currentId=oe$2.idMap[il]=el?performance.now():Date.now(),oe$2.currentName=oe$2.nameMap[il]=tl,oe$2.nameToIdMap[tl]=il,il},end(tl,el){const il=oe$2.idMap[tl],sl=oe$2.nameMap[tl],nl=el?(performance.now()-il)/1e3:Date.now()-il;oe$2.idMap[tl]=oe$2.nameMap[tl]=oe$2.nameToIdMap[sl]=void 0,ie$2.log(sl,nl,"ms")},endOfName(tl,el){const il=oe$2.nameToIdMap[tl];s(il)||oe$2.end(il,el)}},oe$2=ne$2,ae$2=[],he$2={list:{},add(tl,...el){this.list[tl]=!0,ae$2.push(...el)},has(tl,el){const il=this.list[tl];return!il&&el&&this.need(tl),il},need(tl){console.error("please install and import plugin: "+(tl.includes("-x")?"":"@leafer-in/")+tl)}};setTimeout(()=>ae$2.forEach(tl=>he$2.has(tl,!0)));const le$2={editor:tl=>he$2.need("editor")},de$2=ee$2.get("UICreator"),ce$2={list:{},register(tl){const{__tag:el}=tl.prototype;ue$2[el]&&de$2.repeat(el),ue$2[el]=tl},get(tl,el,il,sl,nl,ol){if(!ue$2[tl])return void de$2.warn("not register "+tl);const rl=new ue$2[tl](el);return s(il)||(rl.x=il,sl&&(rl.y=sl),nl&&(rl.width=nl),ol&&(rl.height=ol)),rl}},{list:ue$2}=ce$2,_e$2=ee$2.get("EventCreator"),pe$2={nameList:{},register(tl){let el;Object.keys(tl).forEach(il=>{el=tl[il],i(el)&&(fe$2[el]&&_e$2.repeat(el),fe$2[el]=tl)})},changeName(tl,el){const il=fe$2[tl];if(il){const sl=Object.keys(il).find(nl=>il[nl]===tl);sl&&(il[sl]=el,fe$2[el]=il)}},has(tl){return!!this.nameList[tl]},get:(tl,...el)=>new fe$2[tl](...el)},{nameList:fe$2}=pe$2;let ge$2=class{constructor(){this.list=[]}add(tl){tl.manager=this,this.list.push(tl)}get(tl){let el;const{list:il}=this;for(let nl=0,ol=il.length;nl<ol;nl++)if(el=il[nl],el.recycled&&el.isSameSize(tl))return el.recycled=!1,el.manager||(el.manager=this),el;const sl=le$2.canvas(tl);return this.add(sl),sl}recycle(tl){tl.recycled=!0}clearRecycled(){let tl;const el=[];for(let il=0,sl=this.list.length;il<sl;il++)tl=this.list[il],tl.recycled?tl.destroy():el.push(tl);this.list=el}clear(){this.list.forEach(tl=>{tl.destroy()}),this.list.length=0}destroy(){this.clear()}};function ye$2(tl,el,il,sl){var nl,ol=arguments.length,rl=ol<3?el:sl===null?sl=Object.getOwnPropertyDescriptor(el,il):sl;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")rl=Reflect.decorate(tl,el,il,sl);else for(var al=tl.length-1;al>=0;al--)(nl=tl[al])&&(rl=(ol<3?nl(rl):ol>3?nl(el,il,rl):nl(el,il))||rl);return ol>3&&rl&&Object.defineProperty(el,il,rl),rl}function me$2(tl,el,il,sl){return new(il||(il=Promise))(function(nl,ol){function rl(cl){try{ll(sl.next(cl))}catch(ul){ol(ul)}}function al(cl){try{ll(sl.throw(cl))}catch(ul){ol(ul)}}function ll(cl){var ul;cl.done?nl(cl.value):(ul=cl.value,ul instanceof il?ul:new il(function(dl){dl(ul)})).then(rl,al)}ll((sl=sl.apply(tl,[])).next())})}function xe$2(tl){return(el,il)=>{tl||(tl=il);const sl={get(){return this.context[tl]},set(nl){this.context[tl]=nl}};il==="strokeCap"&&(sl.set=function(nl){this.context[tl]=nl==="none"?"butt":nl}),Object.defineProperty(el,il,sl)}}const we$2=[];function be$2(){return(tl,el)=>{we$2.push(el)}}const Be$2=[];let ve$2=class{set blendMode(tl){tl==="normal"&&(tl="source-over"),this.context.globalCompositeOperation=tl}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(tl){this.context.setLineDash(tl||Be$2)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let tl;we$2.forEach(el=>{tl=this.context[el],tl&&(this[el]=tl.bind(this.context))}),this.textBaseline="alphabetic"}setTransform(tl,el,il,sl,nl,ol){}resetTransform(){}getTransform(){}save(){}restore(){}transform(tl,el,il,sl,nl,ol){d(tl)?this.context.transform(tl.a,tl.b,tl.c,tl.d,tl.e,tl.f):this.context.transform(tl,el,il,sl,nl,ol)}translate(tl,el){}scale(tl,el){}rotate(tl){}fill(tl,el){}stroke(tl){}clip(tl,el){}fillRect(tl,el,il,sl){}strokeRect(tl,el,il,sl){}clearRect(tl,el,il,sl){}drawImage(tl,el,il,sl,nl,ol,rl,al,ll){switch(arguments.length){case 9:if(el<0){const cl=-el/sl*al;sl+=el,el=0,ol+=cl,al-=cl}if(il<0){const cl=-il/nl*ll;nl+=il,il=0,rl+=cl,ll-=cl}this.context.drawImage(tl,el,il,sl,nl,ol,rl,al,ll);break;case 5:this.context.drawImage(tl,el,il,sl,nl);break;case 3:this.context.drawImage(tl,el,il)}}beginPath(){}moveTo(tl,el){}lineTo(tl,el){}bezierCurveTo(tl,el,il,sl,nl,ol){}quadraticCurveTo(tl,el,il,sl){}closePath(){}arc(tl,el,il,sl,nl,ol){}arcTo(tl,el,il,sl,nl){}ellipse(tl,el,il,sl,nl,ol,rl,al){}rect(tl,el,il,sl){}roundRect(tl,el,il,sl,nl){}createConicGradient(tl,el,il){}createLinearGradient(tl,el,il,sl){}createPattern(tl,el){}createRadialGradient(tl,el,il,sl,nl,ol){}fillText(tl,el,il,sl){}measureText(tl){}strokeText(tl,el,il,sl){}destroy(){this.context=null}};ye$2([xe$2("imageSmoothingEnabled")],ve$2.prototype,"smooth",void 0),ye$2([xe$2("imageSmoothingQuality")],ve$2.prototype,"smoothLevel",void 0),ye$2([xe$2("globalAlpha")],ve$2.prototype,"opacity",void 0),ye$2([xe$2()],ve$2.prototype,"fillStyle",void 0),ye$2([xe$2()],ve$2.prototype,"strokeStyle",void 0),ye$2([xe$2("lineWidth")],ve$2.prototype,"strokeWidth",void 0),ye$2([xe$2("lineCap")],ve$2.prototype,"strokeCap",void 0),ye$2([xe$2("lineJoin")],ve$2.prototype,"strokeJoin",void 0),ye$2([xe$2("lineDashOffset")],ve$2.prototype,"dashOffset",void 0),ye$2([xe$2()],ve$2.prototype,"miterLimit",void 0),ye$2([xe$2()],ve$2.prototype,"shadowBlur",void 0),ye$2([xe$2()],ve$2.prototype,"shadowColor",void 0),ye$2([xe$2()],ve$2.prototype,"shadowOffsetX",void 0),ye$2([xe$2()],ve$2.prototype,"shadowOffsetY",void 0),ye$2([xe$2()],ve$2.prototype,"filter",void 0),ye$2([xe$2()],ve$2.prototype,"font",void 0),ye$2([xe$2()],ve$2.prototype,"fontKerning",void 0),ye$2([xe$2()],ve$2.prototype,"fontStretch",void 0),ye$2([xe$2()],ve$2.prototype,"fontVariantCaps",void 0),ye$2([xe$2()],ve$2.prototype,"textAlign",void 0),ye$2([xe$2()],ve$2.prototype,"textBaseline",void 0),ye$2([xe$2()],ve$2.prototype,"textRendering",void 0),ye$2([xe$2()],ve$2.prototype,"wordSpacing",void 0),ye$2([xe$2()],ve$2.prototype,"letterSpacing",void 0),ye$2([xe$2()],ve$2.prototype,"direction",void 0),ye$2([be$2()],ve$2.prototype,"setTransform",null),ye$2([be$2()],ve$2.prototype,"resetTransform",null),ye$2([be$2()],ve$2.prototype,"getTransform",null),ye$2([be$2()],ve$2.prototype,"save",null),ye$2([be$2()],ve$2.prototype,"restore",null),ye$2([be$2()],ve$2.prototype,"translate",null),ye$2([be$2()],ve$2.prototype,"scale",null),ye$2([be$2()],ve$2.prototype,"rotate",null),ye$2([be$2()],ve$2.prototype,"fill",null),ye$2([be$2()],ve$2.prototype,"stroke",null),ye$2([be$2()],ve$2.prototype,"clip",null),ye$2([be$2()],ve$2.prototype,"fillRect",null),ye$2([be$2()],ve$2.prototype,"strokeRect",null),ye$2([be$2()],ve$2.prototype,"clearRect",null),ye$2([be$2()],ve$2.prototype,"beginPath",null),ye$2([be$2()],ve$2.prototype,"moveTo",null),ye$2([be$2()],ve$2.prototype,"lineTo",null),ye$2([be$2()],ve$2.prototype,"bezierCurveTo",null),ye$2([be$2()],ve$2.prototype,"quadraticCurveTo",null),ye$2([be$2()],ve$2.prototype,"closePath",null),ye$2([be$2()],ve$2.prototype,"arc",null),ye$2([be$2()],ve$2.prototype,"arcTo",null),ye$2([be$2()],ve$2.prototype,"ellipse",null),ye$2([be$2()],ve$2.prototype,"rect",null),ye$2([be$2()],ve$2.prototype,"roundRect",null),ye$2([be$2()],ve$2.prototype,"createConicGradient",null),ye$2([be$2()],ve$2.prototype,"createLinearGradient",null),ye$2([be$2()],ve$2.prototype,"createPattern",null),ye$2([be$2()],ve$2.prototype,"createRadialGradient",null),ye$2([be$2()],ve$2.prototype,"fillText",null),ye$2([be$2()],ve$2.prototype,"measureText",null),ye$2([be$2()],ve$2.prototype,"strokeText",null);const{copy:ke$2,multiplyParent:Ce$2,pixelScale:Oe$2}=q$1,{round:Te$2}=Math,Pe$2=new Vt$3,Se$2=new Vt$3,Le$2={width:1,height:1,pixelRatio:1},Re$2=["width","height","pixelRatio"];let Ee$2=class extends ve$2{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio||0}get pixelHeight(){return this.height*this.pixelRatio||0}get pixelSnap(){return this.config.pixelSnap}set pixelSnap(tl){this.config.pixelSnap=tl}get allowBackgroundColor(){return this.view&&this.parentView}constructor(tl,el){super(),this.size={},this.worldTransform={},tl||(tl=Le$2),this.manager=el,this.innerId=g.create(g.CNAVAS);const{width:il,height:sl,pixelRatio:nl}=tl;this.autoLayout=!il||!sl,this.size.pixelRatio=nl||$t$2.devicePixelRatio,this.config=tl,this.init()}init(){}__createContext(){const{view:tl}=this,{contextSettings:el}=this.config;this.context=el?tl.getContext("2d",el):tl.getContext("2d"),this.__bindContext()}export(tl,el){}toBlob(tl,el){}toDataURL(tl,el){}saveAs(tl,el){}resize(tl,el=!0){if(this.isSameSize(tl))return;let il;this.context&&!this.unreal&&el&&this.width&&(il=this.getSameCanvas(),il.copyWorld(this));const sl=this.size;_.copyAttrs(sl,tl,Re$2),Re$2.forEach(nl=>sl[nl]||(sl[nl]=1)),this.bounds=new Vt$3(0,0,this.width,this.height),this.updateViewSize(),this.updateClientBounds(),this.context&&(this.smooth=this.config.smooth,!this.unreal&&il&&(this.clearWorld(il.bounds),this.copyWorld(il),il.recycle()))}updateViewSize(){}updateClientBounds(){}getClientBounds(tl){return tl&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(tl,el){}stopAutoLayout(){}setCursor(tl){}setWorld(tl,el){const{pixelRatio:il,pixelSnap:sl}=this,nl=this.worldTransform;el&&Ce$2(tl,el,nl),Oe$2(tl,il,nl),sl&&!tl.ignorePixelSnap&&(tl.half&&tl.half*il%2?(nl.e=Te$2(nl.e-.5)+.5,nl.f=Te$2(nl.f-.5)+.5):(nl.e=Te$2(nl.e),nl.f=Te$2(nl.f))),this.setTransform(nl.a,nl.b,nl.c,nl.d,nl.e,nl.f)}useWorldTransform(tl){tl&&(this.worldTransform=tl);const el=this.worldTransform;el&&this.setTransform(el.a,el.b,el.c,el.d,el.e,el.f)}setStroke(tl,el,il,sl){el&&(this.strokeWidth=el),tl&&(this.strokeStyle=tl),il&&this.setStrokeOptions(il,sl)}setStrokeOptions(tl,el){let{strokeCap:il,strokeJoin:sl,dashPattern:nl,dashOffset:ol,miterLimit:rl}=tl;el&&(el.strokeCap&&(il=el.strokeCap),el.strokeJoin&&(sl=el.strokeJoin),s(el.dashPattern)||(nl=el.dashPattern),s(el.dashOffset)||(ol=el.dashOffset),el.miterLimit&&(rl=el.miterLimit)),this.strokeCap=il,this.strokeJoin=sl,this.dashPattern=nl,this.dashOffset=ol,this.miterLimit=rl}saveBlendMode(tl){this.savedBlendMode=this.blendMode,this.blendMode=tl}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(tl,el){return!0}hitStroke(tl,el){return!0}hitPixel(tl,el,il=1){return!0}setWorldShadow(tl,el,il,sl){const{pixelRatio:nl}=this;this.shadowOffsetX=tl*nl,this.shadowOffsetY=el*nl,this.shadowBlur=il*nl,this.shadowColor=sl||"black"}setWorldBlur(tl){const{pixelRatio:el}=this;this.filter=`blur(${tl*el}px)`}copyWorld(tl,el,il,sl,nl){sl&&(this.blendMode=sl),el?(this.setTempPixelBounds(el,nl),il?(this.setTempPixelBounds2(il,nl),il=Se$2):il=Pe$2,this.drawImage(tl.view,Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height,il.x,il.y,il.width,il.height)):this.drawImage(tl.view,0,0),sl&&(this.blendMode="source-over")}copyWorldToInner(tl,el,il,sl,nl){el.b||el.c?(this.save(),this.resetTransform(),this.copyWorld(tl,el,zt$2.tempToOuterOf(il,el),sl,nl),this.restore()):(sl&&(this.blendMode=sl),this.setTempPixelBounds(el,nl),this.drawImage(tl.view,Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height,il.x,il.y,il.width,il.height),sl&&(this.blendMode="source-over"))}copyWorldByReset(tl,el,il,sl,nl,ol){this.resetTransform(),this.copyWorld(tl,el,il,sl,ol),nl||this.useWorldTransform()}useGrayscaleAlpha(tl){let el,il;this.setTempPixelBounds(tl,!0,!0);const{context:sl}=this,nl=sl.getImageData(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),{data:ol}=nl;for(let rl=0,al=ol.length;rl<al;rl+=4)il=.299*ol[rl]+.587*ol[rl+1]+.114*ol[rl+2],(el=ol[rl+3])&&(ol[rl+3]=el===255?il:el*(il/255));sl.putImageData(nl,Pe$2.x,Pe$2.y)}useMask(tl,el,il){this.copyWorld(tl,el,il,"destination-in")}useEraser(tl,el,il){this.copyWorld(tl,el,il,"destination-out")}fillWorld(tl,el,il,sl){il&&(this.blendMode=il),this.fillStyle=el,this.setTempPixelBounds(tl,sl),this.fillRect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),il&&(this.blendMode="source-over")}strokeWorld(tl,el,il,sl){il&&(this.blendMode=il),this.strokeStyle=el,this.setTempPixelBounds(tl,sl),this.strokeRect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),il&&(this.blendMode="source-over")}clipWorld(tl,el=!0){this.beginPath(),this.setTempPixelBounds(tl,el),this.rect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),this.clip()}clipUI(tl){tl.windingRule?this.clip(tl.windingRule):this.clip()}clearWorld(tl,el=!0){this.setTempPixelBounds(tl,el),this.clearRect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height)}clear(){const{pixelRatio:tl}=this;this.clearRect(0,0,this.width*tl+2,this.height*tl+2)}setTempPixelBounds(tl,el,il){this.copyToPixelBounds(Pe$2,tl,el,il)}setTempPixelBounds2(tl,el,il){this.copyToPixelBounds(Se$2,tl,el,il)}copyToPixelBounds(tl,el,il,sl){tl.set(el),sl&&tl.intersect(this.bounds),tl.scale(this.pixelRatio),il&&tl.ceil()}isSameSize(tl){return this.width===tl.width&&this.height===tl.height&&(!tl.pixelRatio||this.pixelRatio===tl.pixelRatio)}getSameCanvas(tl,el){const{size:il,pixelSnap:sl}=this,nl=this.manager?this.manager.get(il):le$2.canvas(Object.assign({},il));return nl.save(),tl&&(ke$2(nl.worldTransform,this.worldTransform),nl.useWorldTransform()),el&&(nl.smooth=this.smooth),nl.pixelSnap!==sl&&(nl.pixelSnap=sl),nl}recycle(tl){this.recycled||(this.restore(),tl?this.clearWorld(tl):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(tl){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}};const Ie$2={creator:{},parse(tl,el){},convertToCanvasData(tl,el){}},Me$2={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Ae$2=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Me$2),We$2={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},Ne$2={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},Ye$2=Object.assign(Object.assign({},Ne$2),Me$2),De$2=Ae$2,Xe$2={};for(let tl in De$2)Xe$2[De$2[tl]]=tl;const ze$2={};for(let tl in De$2)ze$2[De$2[tl]]=We$2[tl];const Fe$2={drawRoundRect(tl,el,il,sl,nl,ol){const rl=I$1.fourNumber(ol,Math.min(sl/2,nl/2)),al=el+sl,ll=il+nl;rl[0]?tl.moveTo(el+rl[0],il):tl.moveTo(el,il),rl[1]?tl.arcTo(al,il,al,ll,rl[1]):tl.lineTo(al,il),rl[2]?tl.arcTo(al,ll,el,ll,rl[2]):tl.lineTo(al,ll),rl[3]?tl.arcTo(el,ll,el,il,rl[3]):tl.lineTo(el,ll),rl[0]?tl.arcTo(el,il,al,il,rl[0]):tl.lineTo(el,il)}},{sin:Ue$2,cos:je$2,hypot:Ve$2,atan2:He$2,ceil:Ge$2,abs:qe$2,PI:Qe$2,sqrt:Je$2,pow:Ze$2}=Math,{setPoint:$e$2,addPoint:Ke$2}=gt$2,{set:ts$1,toNumberPoints:es$1}=ot$2,{M:ss$1,L:rs$1,C:is$1,Q:ns$1,Z:os$1}=Ae$2,as$1={},hs={points(tl,el,il,sl){let nl=es$1(el);if(tl.push(ss$1,nl[0],nl[1]),il&&nl.length>5){let ol,rl,al,ll,cl,ul,dl,fl,hl,_l,yl,ml,Tl,bl,Gl,Il=nl.length;const Ml=il===!0?.5:il;sl&&(nl=[nl[Il-2],nl[Il-1],...nl,nl[0],nl[1],nl[2],nl[3]],Il=nl.length);for(let zl=2;zl<Il-2;zl+=2)ol=nl[zl-2],rl=nl[zl-1],al=nl[zl],ll=nl[zl+1],cl=nl[zl+2],ul=nl[zl+3],yl=al-ol,ml=ll-rl,Tl=Je$2(Ze$2(yl,2)+Ze$2(ml,2)),bl=Je$2(Ze$2(cl-al,2)+Ze$2(ul-ll,2)),(Tl||bl)&&(Gl=Tl+bl,Tl=Ml*Tl/Gl,bl=Ml*bl/Gl,cl-=ol,ul-=rl,dl=al-Tl*cl,fl=ll-Tl*ul,zl===2?sl||tl.push(ns$1,dl,fl,al,ll):(yl||ml)&&tl.push(is$1,hl,_l,dl,fl,al,ll),hl=al+bl*cl,_l=ll+bl*ul);sl||tl.push(ns$1,hl,_l,nl[Il-2],nl[Il-1])}else for(let ol=2,rl=nl.length;ol<rl;ol+=2)tl.push(rs$1,nl[ol],nl[ol+1]);sl&&tl.push(os$1)},rect(tl,el,il,sl,nl){Ie$2.creator.path=tl,Ie$2.creator.moveTo(el,il).lineTo(el+sl,il).lineTo(el+sl,il+nl).lineTo(el,il+nl).lineTo(el,il)},roundRect(tl,el,il,sl,nl,ol){Ie$2.creator.path=[],Fe$2.drawRoundRect(Ie$2.creator,el,il,sl,nl,ol),tl.push(...Ie$2.convertToCanvasData(Ie$2.creator.path,!0))},arcTo(tl,el,il,sl,nl,ol,rl,al,ll,cl,ul){const dl=sl-el,fl=nl-il,hl=ol-sl,_l=rl-nl;let yl=He$2(fl,dl),ml=He$2(_l,hl);const Tl=Ve$2(dl,fl),bl=Ve$2(hl,_l);let Gl=ml-yl;if(Gl<0&&(Gl+=W$1),Tl<1e-12||bl<1e-12||Gl<1e-12||qe$2(Gl-Qe$2)<1e-12)return tl&&tl.push(rs$1,sl,nl),ll&&($e$2(ll,el,il),Ke$2(ll,sl,nl)),ul&&ts$1(ul,el,il),void(cl&&ts$1(cl,sl,nl));const Il=dl*_l-hl*fl<0,Ml=Il?-1:1,zl=al/je$2(Gl/2),Fl=sl+zl*je$2(yl+Gl/2+N$1*Ml),Bl=nl+zl*Ue$2(yl+Gl/2+N$1*Ml);return yl-=N$1*Ml,ml-=N$1*Ml,cs(tl,Fl,Bl,al,al,0,yl/A,ml/A,Il,ll,cl,ul)},arc:(tl,el,il,sl,nl,ol,rl,al,ll,cl)=>cs(tl,el,il,sl,sl,0,nl,ol,rl,al,ll,cl),ellipse(tl,el,il,sl,nl,ol,rl,al,ll,cl,ul,dl){const fl=ol*A,hl=Ue$2(fl),_l=je$2(fl);let yl=rl*A,ml=al*A;yl>Qe$2&&(yl-=W$1),ml<0&&(ml+=W$1);let Tl=ml-yl;Tl<0?Tl+=W$1:Tl>W$1&&(Tl-=W$1),ll&&(Tl-=W$1);const bl=Ge$2(qe$2(Tl/N$1)),Gl=Tl/bl,Il=Ue$2(Gl/4),Ml=8/3*Il*Il/Ue$2(Gl/2);ml=yl+Gl;let zl,Fl,Bl,Wl,Hl,$l,Ul,jl,Vl=je$2(yl),Yl=Ue$2(yl),Ql=Bl=_l*sl*Vl-hl*nl*Yl,ql=Wl=hl*sl*Vl+_l*nl*Yl,Kl=el+Bl,Jl=il+Wl;tl&&tl.push(tl.length?rs$1:ss$1,Kl,Jl),cl&&$e$2(cl,Kl,Jl),dl&&ts$1(dl,Kl,Jl);for(let Zl=0;Zl<bl;Zl++)zl=je$2(ml),Fl=Ue$2(ml),Bl=_l*sl*zl-hl*nl*Fl,Wl=hl*sl*zl+_l*nl*Fl,Hl=el+Ql-Ml*(_l*sl*Yl+hl*nl*Vl),$l=il+ql-Ml*(hl*sl*Yl-_l*nl*Vl),Ul=el+Bl+Ml*(_l*sl*Fl+hl*nl*zl),jl=il+Wl+Ml*(hl*sl*Fl-_l*nl*zl),tl&&tl.push(is$1,Hl,$l,Ul,jl,el+Bl,il+Wl),cl&&ds(el+Ql,il+ql,Hl,$l,Ul,jl,el+Bl,il+Wl,cl,!0),Ql=Bl,ql=Wl,Vl=zl,Yl=Fl,yl=ml,ml+=Gl;ul&&ts$1(ul,el+Bl,il+Wl)},quadraticCurveTo(tl,el,il,sl,nl,ol,rl){tl.push(is$1,(el+2*sl)/3,(il+2*nl)/3,(ol+2*sl)/3,(rl+2*nl)/3,ol,rl)},toTwoPointBoundsByQuadraticCurve(tl,el,il,sl,nl,ol,rl,al){ds(tl,el,(tl+2*il)/3,(el+2*sl)/3,(nl+2*il)/3,(ol+2*sl)/3,nl,ol,rl,al)},toTwoPointBounds(tl,el,il,sl,nl,ol,rl,al,ll,cl){const ul=[];let dl,fl,hl,_l,yl,ml,Tl,bl,Gl=tl,Il=il,Ml=nl,zl=rl;for(let Fl=0;Fl<2;++Fl)if(Fl==1&&(Gl=el,Il=sl,Ml=ol,zl=al),dl=-3*Gl+9*Il-9*Ml+3*zl,fl=6*Gl-12*Il+6*Ml,hl=3*Il-3*Gl,Math.abs(dl)<1e-12){if(Math.abs(fl)<1e-12)continue;_l=-hl/fl,0<_l&&_l<1&&ul.push(_l)}else Tl=fl*fl-4*hl*dl,bl=Math.sqrt(Tl),Tl<0||(yl=(-fl+bl)/(2*dl),0<yl&&yl<1&&ul.push(yl),ml=(-fl-bl)/(2*dl),0<ml&&ml<1&&ul.push(ml));cl?Ke$2(ll,tl,el):$e$2(ll,tl,el),Ke$2(ll,rl,al);for(let Fl=0,Bl=ul.length;Fl<Bl;Fl++)ls(ul[Fl],tl,el,il,sl,nl,ol,rl,al,as$1),Ke$2(ll,as$1.x,as$1.y)},getPointAndSet(tl,el,il,sl,nl,ol,rl,al,ll,cl){const ul=1-tl,dl=ul*ul*ul,fl=3*ul*ul*tl,hl=3*ul*tl*tl,_l=tl*tl*tl;cl.x=dl*el+fl*sl+hl*ol+_l*al,cl.y=dl*il+fl*nl+hl*rl+_l*ll},getPoint(tl,el,il,sl,nl,ol,rl,al,ll){const cl={};return ls(tl,el,il,sl,nl,ol,rl,al,ll,cl),cl},getDerivative(tl,el,il,sl,nl){const ol=1-tl;return 3*ol*ol*(il-el)+6*ol*tl*(sl-il)+3*tl*tl*(nl-sl)}},{getPointAndSet:ls,toTwoPointBounds:ds,ellipse:cs}=hs,{sin:us,cos:_s,sqrt:ps,atan2:fs}=Math,{ellipse:gs}=hs,ys={ellipticalArc(tl,el,il,sl,nl,ol,rl,al,ll,cl,ul){const dl=(ll-el)/2,fl=(cl-il)/2,hl=ol*A,_l=us(hl),yl=_s(hl),ml=-yl*dl-_l*fl,Tl=-yl*fl+_l*dl,bl=sl*sl,Gl=nl*nl,Il=Tl*Tl,Ml=ml*ml,zl=bl*Gl-bl*Il-Gl*Ml;let Fl=0;if(zl<0){const Ql=ps(1-zl/(bl*Gl));sl*=Ql,nl*=Ql}else Fl=(rl===al?-1:1)*ps(zl/(bl*Il+Gl*Ml));const Bl=Fl*sl*Tl/nl,Wl=-Fl*nl*ml/sl,Hl=fs((Tl-Wl)/nl,(ml-Bl)/sl),$l=fs((-Tl-Wl)/nl,(-ml-Bl)/sl);let Ul=$l-Hl;al===0&&Ul>0?Ul-=W$1:al===1&&Ul<0&&(Ul+=W$1);const jl=el+dl+yl*Bl-_l*Wl,Vl=il+fl+_l*Bl+yl*Wl,Yl=Ul<0?1:0;ul||$t$2.ellipseToCurve?gs(tl,jl,Vl,sl,nl,ol,Hl/A,$l/A,Yl):sl!==nl||ol?tl.push(Ae$2.G,jl,Vl,sl,nl,ol,Hl/A,$l/A,Yl):tl.push(Ae$2.O,jl,Vl,sl,Hl/A,$l/A,Yl)}},ms={toCommand:tl=>[],toNode:tl=>[]},{M:xs,m:ws,L:bs,l:Bs,H:vs,h:ks,V:Cs,v:Os,C:Ts,c:Ps,S:Ss,s:Ls,Q:Rs,q:Es,T:Is,t:Ms,A:As,a:Ws,Z:Ns,z:Ys,N:Ds,D:Xs,X:zs,G:Fs,F:Us,O:js,P:Vs,U:Hs}=Ae$2,{rect:Gs,roundRect:qs,arcTo:Qs,arc:Js,ellipse:Zs,quadraticCurveTo:$s}=hs,{ellipticalArc:Ks}=ys,tr=ee$2.get("PathConvert"),er={},sr={current:{dot:0},stringify(tl,el){let il,sl,nl,ol=0,rl=tl.length,al="";for(;ol<rl;){sl=tl[ol],il=ze$2[sl],al+=sl===nl?" ":Xe$2[sl];for(let ll=1;ll<il;ll++)al+=I$1.float(tl[ol+ll],el),ll===il-1||(al+=" ");nl=sl,ol+=il}return al},parse(tl,el){let il,sl,nl,ol="";const rl=[],al=el?Ye$2:Ne$2;for(let ll=0,cl=tl.length;ll<cl;ll++)sl=tl[ll],Qt$2[sl]?(sl==="."&&(rr.dot&&(ir(rl,ol),ol=""),rr.dot++),ol==="0"&&sl!=="."&&(ir(rl,ol),ol=""),ol+=sl):Ae$2[sl]?(ol&&(ir(rl,ol),ol=""),rr.name=Ae$2[sl],rr.length=We$2[sl],rr.index=0,ir(rl,rr.name),!il&&al[sl]&&(il=!0)):sl==="-"||sl==="+"?nl==="e"||nl==="E"?ol+=sl:(ol&&ir(rl,ol),ol=sl):ol&&(ir(rl,ol),ol=""),nl=sl;return ol&&ir(rl,ol),il?sr.toCanvasData(rl,el):rl},toCanvasData(tl,el){let il,sl,nl,ol,rl,al=0,ll=0,cl=0,ul=0,dl=0,fl=tl.length;const hl=[];for(;dl<fl;){switch(nl=tl[dl],nl){case ws:tl[dl+1]+=al,tl[dl+2]+=ll;case xs:al=tl[dl+1],ll=tl[dl+2],hl.push(xs,al,ll),dl+=3;break;case ks:tl[dl+1]+=al;case vs:al=tl[dl+1],hl.push(bs,al,ll),dl+=2;break;case Os:tl[dl+1]+=ll;case Cs:ll=tl[dl+1],hl.push(bs,al,ll),dl+=2;break;case Bs:tl[dl+1]+=al,tl[dl+2]+=ll;case bs:al=tl[dl+1],ll=tl[dl+2],hl.push(bs,al,ll),dl+=3;break;case Ls:tl[dl+1]+=al,tl[dl+2]+=ll,tl[dl+3]+=al,tl[dl+4]+=ll,nl=Ss;case Ss:rl=ol===Ts||ol===Ss,cl=rl?2*al-il:tl[dl+1],ul=rl?2*ll-sl:tl[dl+2],il=tl[dl+1],sl=tl[dl+2],al=tl[dl+3],ll=tl[dl+4],hl.push(Ts,cl,ul,il,sl,al,ll),dl+=5;break;case Ps:tl[dl+1]+=al,tl[dl+2]+=ll,tl[dl+3]+=al,tl[dl+4]+=ll,tl[dl+5]+=al,tl[dl+6]+=ll,nl=Ts;case Ts:il=tl[dl+3],sl=tl[dl+4],al=tl[dl+5],ll=tl[dl+6],hl.push(Ts,tl[dl+1],tl[dl+2],il,sl,al,ll),dl+=7;break;case Ms:tl[dl+1]+=al,tl[dl+2]+=ll,nl=Is;case Is:rl=ol===Rs||ol===Is,il=rl?2*al-il:tl[dl+1],sl=rl?2*ll-sl:tl[dl+2],el?$s(hl,al,ll,il,sl,tl[dl+1],tl[dl+2]):hl.push(Rs,il,sl,tl[dl+1],tl[dl+2]),al=tl[dl+1],ll=tl[dl+2],dl+=3;break;case Es:tl[dl+1]+=al,tl[dl+2]+=ll,tl[dl+3]+=al,tl[dl+4]+=ll,nl=Rs;case Rs:il=tl[dl+1],sl=tl[dl+2],el?$s(hl,al,ll,il,sl,tl[dl+3],tl[dl+4]):hl.push(Rs,il,sl,tl[dl+3],tl[dl+4]),al=tl[dl+3],ll=tl[dl+4],dl+=5;break;case Ws:tl[dl+6]+=al,tl[dl+7]+=ll;case As:Ks(hl,al,ll,tl[dl+1],tl[dl+2],tl[dl+3],tl[dl+4],tl[dl+5],tl[dl+6],tl[dl+7],el),al=tl[dl+6],ll=tl[dl+7],dl+=8;break;case Ys:case Ns:hl.push(Ns),dl++;break;case Ds:al=tl[dl+1],ll=tl[dl+2],el?Gs(hl,al,ll,tl[dl+3],tl[dl+4]):nr(hl,tl,dl,5),dl+=5;break;case Xs:al=tl[dl+1],ll=tl[dl+2],el?qs(hl,al,ll,tl[dl+3],tl[dl+4],[tl[dl+5],tl[dl+6],tl[dl+7],tl[dl+8]]):nr(hl,tl,dl,9),dl+=9;break;case zs:al=tl[dl+1],ll=tl[dl+2],el?qs(hl,al,ll,tl[dl+3],tl[dl+4],tl[dl+5]):nr(hl,tl,dl,6),dl+=6;break;case Fs:Zs(el?hl:nr(hl,tl,dl,9),tl[dl+1],tl[dl+2],tl[dl+3],tl[dl+4],tl[dl+5],tl[dl+6],tl[dl+7],tl[dl+8],null,er),al=er.x,ll=er.y,dl+=9;break;case Us:el?Zs(hl,tl[dl+1],tl[dl+2],tl[dl+3],tl[dl+4],0,0,360,!1):nr(hl,tl,dl,5),al=tl[dl+1]+tl[dl+3],ll=tl[dl+2],dl+=5;break;case js:Js(el?hl:nr(hl,tl,dl,7),tl[dl+1],tl[dl+2],tl[dl+3],tl[dl+4],tl[dl+5],tl[dl+6],null,er),al=er.x,ll=er.y,dl+=7;break;case Vs:el?Js(hl,tl[dl+1],tl[dl+2],tl[dl+3],0,360,!1):nr(hl,tl,dl,4),al=tl[dl+1]+tl[dl+3],ll=tl[dl+2],dl+=4;break;case Hs:Qs(el?hl:nr(hl,tl,dl,6),al,ll,tl[dl+1],tl[dl+2],tl[dl+3],tl[dl+4],tl[dl+5],null,er),al=er.x,ll=er.y,dl+=6;break;default:return tr.error(`command: ${nl} [index:${dl}]`,tl),hl}ol=nl}return hl},objectToCanvasData(tl){if(tl[0].name.length>1)return ms.toCommand(tl);{const el=[];return tl.forEach(il=>{switch(il.name){case"M":el.push(xs,il.x,il.y);break;case"L":el.push(bs,il.x,il.y);break;case"C":el.push(Ts,il.x1,il.y1,il.x2,il.y2,il.x,il.y);break;case"Q":el.push(Rs,il.x1,il.y1,il.x,il.y);break;case"Z":el.push(Ns)}}),el}},copyData(tl,el,il,sl){for(let nl=il,ol=il+sl;nl<ol;nl++)tl.push(el[nl])},pushData(tl,el){rr.index===rr.length&&(rr.index=1,tl.push(rr.name)),tl.push(Number(el)),rr.index++,rr.dot=0}},{current:rr,pushData:ir,copyData:nr}=sr,{M:or,L:ar,C:hr,Q:lr,Z:dr,N:cr,D:ur,X:_r,G:pr,F:fr,O:gr,P:yr,U:mr}=Ae$2,{getMinDistanceFrom:xr,getRadianFrom:wr}=ot$2,{tan:br,min:Br,abs:vr}=Math,kr={},Cr={beginPath(tl){tl.length=0},moveTo(tl,el,il){tl.push(or,el,il)},lineTo(tl,el,il){tl.push(ar,el,il)},bezierCurveTo(tl,el,il,sl,nl,ol,rl){tl.push(hr,el,il,sl,nl,ol,rl)},quadraticCurveTo(tl,el,il,sl,nl){tl.push(lr,el,il,sl,nl)},closePath(tl){tl.push(dr)},rect(tl,el,il,sl,nl){tl.push(cr,el,il,sl,nl)},roundRect(tl,el,il,sl,nl,ol){if(o(ol))tl.push(_r,el,il,sl,nl,ol);else{const rl=I$1.fourNumber(ol);rl?tl.push(ur,el,il,sl,nl,...rl):tl.push(cr,el,il,sl,nl)}},ellipse(tl,el,il,sl,nl,ol,rl,al,ll){if(sl===nl)return Tr(tl,el,il,sl,rl,al,ll);r(ol)?tl.push(fr,el,il,sl,nl):(r(rl)&&(rl=0),r(al)&&(al=360),tl.push(pr,el,il,sl,nl,ol,rl,al,ll?1:0))},arc(tl,el,il,sl,nl,ol,rl){r(nl)?tl.push(yr,el,il,sl):(r(nl)&&(nl=0),r(ol)&&(ol=360),tl.push(gr,el,il,sl,nl,ol,rl?1:0))},arcTo(tl,el,il,sl,nl,ol,rl,al,ll){if(!s(rl)){const cl=xr(rl,al,el,il,sl,nl)/(ll?1:2);ol=Br(ol,Br(cl,cl*vr(br(wr(rl,al,el,il,sl,nl)/2))))}tl.push(mr,el,il,sl,nl,ol)},drawEllipse(tl,el,il,sl,nl,ol,rl,al,ll){hs.ellipse(null,el,il,sl,nl,r(ol)?0:ol,r(rl)?0:rl,r(al)?360:al,ll,null,null,kr),tl.push(or,kr.x,kr.y),Or(tl,el,il,sl,nl,ol,rl,al,ll)},drawArc(tl,el,il,sl,nl,ol,rl){hs.arc(null,el,il,sl,r(nl)?0:nl,r(ol)?360:ol,rl,null,null,kr),tl.push(or,kr.x,kr.y),Tr(tl,el,il,sl,nl,ol,rl)},drawPoints(tl,el,il,sl){hs.points(tl,el,il,sl)}},{ellipse:Or,arc:Tr}=Cr,{moveTo:Pr,lineTo:Sr,quadraticCurveTo:Lr,bezierCurveTo:Rr,closePath:Er,beginPath:Ir,rect:Mr,roundRect:Ar,ellipse:Wr,arc:Nr,arcTo:Yr,drawEllipse:Dr,drawArc:Xr,drawPoints:zr}=Cr;class Fr{set path(el){this.__path=el}get path(){return this.__path}constructor(el){this.set(el)}set(el){return this.__path=el?i(el)?Ie$2.parse(el):el:[],this}beginPath(){return Ir(this.__path),this.paint(),this}moveTo(el,il){return Pr(this.__path,el,il),this.paint(),this}lineTo(el,il){return Sr(this.__path,el,il),this.paint(),this}bezierCurveTo(el,il,sl,nl,ol,rl){return Rr(this.__path,el,il,sl,nl,ol,rl),this.paint(),this}quadraticCurveTo(el,il,sl,nl){return Lr(this.__path,el,il,sl,nl),this.paint(),this}closePath(){return Er(this.__path),this.paint(),this}rect(el,il,sl,nl){return Mr(this.__path,el,il,sl,nl),this.paint(),this}roundRect(el,il,sl,nl,ol){return Ar(this.__path,el,il,sl,nl,ol),this.paint(),this}ellipse(el,il,sl,nl,ol,rl,al,ll){return Wr(this.__path,el,il,sl,nl,ol,rl,al,ll),this.paint(),this}arc(el,il,sl,nl,ol,rl){return Nr(this.__path,el,il,sl,nl,ol,rl),this.paint(),this}arcTo(el,il,sl,nl,ol){return Yr(this.__path,el,il,sl,nl,ol),this.paint(),this}drawEllipse(el,il,sl,nl,ol,rl,al,ll){return Dr(this.__path,el,il,sl,nl,ol,rl,al,ll),this.paint(),this}drawArc(el,il,sl,nl,ol,rl){return Xr(this.__path,el,il,sl,nl,ol,rl),this.paint(),this}drawPoints(el,il,sl){return zr(this.__path,el,il,sl),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:Ur,L:jr,C:Vr,Q:Hr,Z:Gr,N:qr,D:Qr,X:Jr,G:Zr,F:$r,O:Kr,P:ti$2,U:ei$2}=Ae$2,si$2=ee$2.get("PathDrawer"),ri$2={drawPathByData(tl,el){if(!el)return;let il,sl=0,nl=el.length;for(;sl<nl;)switch(il=el[sl],il){case Ur:tl.moveTo(el[sl+1],el[sl+2]),sl+=3;break;case jr:tl.lineTo(el[sl+1],el[sl+2]),sl+=3;break;case Vr:tl.bezierCurveTo(el[sl+1],el[sl+2],el[sl+3],el[sl+4],el[sl+5],el[sl+6]),sl+=7;break;case Hr:tl.quadraticCurveTo(el[sl+1],el[sl+2],el[sl+3],el[sl+4]),sl+=5;break;case Gr:tl.closePath(),sl+=1;break;case qr:tl.rect(el[sl+1],el[sl+2],el[sl+3],el[sl+4]),sl+=5;break;case Qr:tl.roundRect(el[sl+1],el[sl+2],el[sl+3],el[sl+4],[el[sl+5],el[sl+6],el[sl+7],el[sl+8]]),sl+=9;break;case Jr:tl.roundRect(el[sl+1],el[sl+2],el[sl+3],el[sl+4],el[sl+5]),sl+=6;break;case Zr:tl.ellipse(el[sl+1],el[sl+2],el[sl+3],el[sl+4],el[sl+5]*A,el[sl+6]*A,el[sl+7]*A,el[sl+8]),sl+=9;break;case $r:tl.ellipse(el[sl+1],el[sl+2],el[sl+3],el[sl+4],0,0,W$1,!1),sl+=5;break;case Kr:tl.arc(el[sl+1],el[sl+2],el[sl+3],el[sl+4]*A,el[sl+5]*A,el[sl+6]),sl+=7;break;case ti$2:tl.arc(el[sl+1],el[sl+2],el[sl+3],0,W$1,!1),sl+=4;break;case ei$2:tl.arcTo(el[sl+1],el[sl+2],el[sl+3],el[sl+4],el[sl+5]),sl+=6;break;default:return void si$2.error(`command: ${il} [index:${sl}]`,el)}}},{M:ii$2,L:ni$2,C:oi$2,Q:ai$2,Z:hi$2,N:li$2,D:di$2,X:ci$1,G:ui$1,F:_i$2,O:pi$1,P:fi$1,U:gi$1}=Ae$2,{toTwoPointBounds:yi$1,toTwoPointBoundsByQuadraticCurve:mi$1,arcTo:xi$1,arc:wi$1,ellipse:bi$1}=hs,{addPointBounds:Bi$1,copy:vi$1,addPoint:ki$1,setPoint:Ci$1,addBounds:Oi$1,toBounds:Ti$1}=gt$2,Pi$1=ee$2.get("PathBounds");let Si$1,Li$1,Ri$1;const Ei$1={},Ii$1={},Mi$1={},Ai$1={toBounds(tl,el){Ai$1.toTwoPointBounds(tl,Ii$1),Ti$1(Ii$1,el)},toTwoPointBounds(tl,el){if(!tl||!tl.length)return Ci$1(el,0,0);let il,sl,nl,ol,rl,al=0,ll=0,cl=0;const ul=tl.length;for(;al<ul;)switch(rl=tl[al],al===0&&(rl===hi$2||rl===oi$2||rl===ai$2?Ci$1(el,ll,cl):Ci$1(el,tl[al+1],tl[al+2])),rl){case ii$2:case ni$2:ll=tl[al+1],cl=tl[al+2],ki$1(el,ll,cl),al+=3;break;case oi$2:nl=tl[al+5],ol=tl[al+6],yi$1(ll,cl,tl[al+1],tl[al+2],tl[al+3],tl[al+4],nl,ol,Ei$1),Bi$1(el,Ei$1),ll=nl,cl=ol,al+=7;break;case ai$2:il=tl[al+1],sl=tl[al+2],nl=tl[al+3],ol=tl[al+4],mi$1(ll,cl,il,sl,nl,ol,Ei$1),Bi$1(el,Ei$1),ll=nl,cl=ol,al+=5;break;case hi$2:al+=1;break;case li$2:ll=tl[al+1],cl=tl[al+2],Oi$1(el,ll,cl,tl[al+3],tl[al+4]),al+=5;break;case di$2:case ci$1:ll=tl[al+1],cl=tl[al+2],Oi$1(el,ll,cl,tl[al+3],tl[al+4]),al+=rl===di$2?9:6;break;case ui$1:bi$1(null,tl[al+1],tl[al+2],tl[al+3],tl[al+4],tl[al+5],tl[al+6],tl[al+7],tl[al+8],Ei$1,Mi$1),al===0?vi$1(el,Ei$1):Bi$1(el,Ei$1),ll=Mi$1.x,cl=Mi$1.y,al+=9;break;case _i$2:ll=tl[al+1],cl=tl[al+2],Li$1=tl[al+3],Ri$1=tl[al+4],Oi$1(el,ll-Li$1,cl-Ri$1,2*Li$1,2*Ri$1),ll+=Li$1,al+=5;break;case pi$1:wi$1(null,tl[al+1],tl[al+2],tl[al+3],tl[al+4],tl[al+5],tl[al+6],Ei$1,Mi$1),al===0?vi$1(el,Ei$1):Bi$1(el,Ei$1),ll=Mi$1.x,cl=Mi$1.y,al+=7;break;case fi$1:ll=tl[al+1],cl=tl[al+2],Si$1=tl[al+3],Oi$1(el,ll-Si$1,cl-Si$1,2*Si$1,2*Si$1),ll+=Si$1,al+=4;break;case gi$1:xi$1(null,ll,cl,tl[al+1],tl[al+2],tl[al+3],tl[al+4],tl[al+5],Ei$1,Mi$1),al===0?vi$1(el,Ei$1):Bi$1(el,Ei$1),ll=Mi$1.x,cl=Mi$1.y,al+=6;break;default:return void Pi$1.error(`command: ${rl} [index:${al}]`,tl)}}},{M:Wi$1,L:Ni$1,Z:Yi$1}=Ae$2,{getCenterX:Di$1,getCenterY:Xi$1}=ot$2,{arcTo:zi$1}=Cr,Fi$1={smooth(tl,el,il){let sl,nl,ol,rl=0,al=0,ll=0,cl=0,ul=0,dl=0,fl=0,hl=0,_l=0;l(el)&&(el=el[0]||0);const yl=tl.length,ml=yl===9,Tl=[];for(;rl<yl;){switch(sl=tl[rl],sl){case Wi$1:cl=hl=tl[rl+1],ul=_l=tl[rl+2],rl+=3,tl[rl]===Ni$1?(dl=tl[rl+1],fl=tl[rl+2],ml?Tl.push(Wi$1,cl,ul):Tl.push(Wi$1,Di$1(cl,dl),Xi$1(ul,fl))):Tl.push(Wi$1,cl,ul);break;case Ni$1:switch(al=tl[rl+1],ll=tl[rl+2],rl+=3,tl[rl]){case Ni$1:zi$1(Tl,al,ll,tl[rl+1],tl[rl+2],el,hl,_l,ml);break;case Yi$1:zi$1(Tl,al,ll,cl,ul,el,hl,_l,ml);break;default:Tl.push(Ni$1,al,ll)}hl=al,_l=ll;break;case Yi$1:nl!==Yi$1&&(zi$1(Tl,cl,ul,dl,fl,el,hl,_l,ml),Tl.push(Yi$1)),rl+=1;break;default:ol=ze$2[sl];for(let bl=0;bl<ol;bl++)Tl.push(tl[rl+bl]);rl+=ol}nl=sl}return sl!==Yi$1&&(Tl[1]=cl,Tl[2]=ul),Tl}};function Ui$1(tl){return new Fr(tl)}const ji$1=Ui$1();Ie$2.creator=Ui$1(),Ie$2.parse=sr.parse,Ie$2.convertToCanvasData=sr.toCanvasData;const{drawRoundRect:Vi$1}=Fe$2;function Hi$1(tl){(function(el){el&&!el.roundRect&&(el.roundRect=function(il,sl,nl,ol,rl){Vi$1(this,il,sl,nl,ol,rl)})})(tl)}const Gi$1={alphaPixelTypes:["png","webp","svg"],upperCaseTypeMap:{},mimeType:(tl,el="image")=>!tl||tl.startsWith(el)?tl:(tl==="jpg"&&(tl="jpeg"),el+"/"+tl),fileType(tl){const el=tl.split(".");return el[el.length-1]},isOpaqueImage(tl){const el=qi$1.fileType(tl);return["jpg","jpeg"].some(il=>il===el)},getExportOptions(tl){switch(typeof tl){case"object":return tl;case"number":return{quality:tl};case"boolean":return{blob:tl};default:return{}}}},qi$1=Gi$1;qi$1.mineType=qi$1.mimeType,qi$1.alphaPixelTypes.forEach(tl=>qi$1.upperCaseTypeMap[tl]=tl.toUpperCase());const Qi$1=ee$2.get("TaskProcessor");let Ji$1=class{constructor(tl){this.parallel=!0,this.time=1,this.id=g.create(g.TASK),this.task=tl}run(){return me$2(this,void 0,void 0,function*(){try{if(this.isComplete||this.runing)return;if(this.runing=!0,this.canUse&&!this.canUse())return this.cancel();this.task&&(yield this.task())}catch(tl){Qi$1.error(tl)}})}complete(){this.isComplete=!0,this.parent=this.task=this.canUse=null}cancel(){this.isCancel=!0,this.complete()}},Zi$1=class{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:tl}=this;let el=0,il=0;for(let sl=0;sl<tl;sl++)sl<=this.finishedIndex?(il+=this.list[sl].time,sl===this.finishedIndex&&(el=il)):el+=this.list[sl].time;return this.isComplete?1:il/el}constructor(tl){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,tl&&_.assign(this.config,tl),this.empty()}add(tl,el,il){let sl,nl,ol,rl;const al=new Ji$1(tl);return al.parent=this,o(el)?rl=el:el&&(nl=el.parallel,sl=el.start,ol=el.time,rl=el.delay,il||(il=el.canUse)),ol&&(al.time=ol),nl===!1&&(al.parallel=!1),il&&(al.canUse=il),s(rl)?this.push(al,sl):(this.delayNumber++,setTimeout(()=>{this.delayNumber&&(this.delayNumber--,this.push(al,sl))},rl)),this.isComplete=!1,al}push(tl,el){this.list.push(tl),el===!1||this.timer||(this.timer=setTimeout(()=>this.start()))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach(tl=>{tl.isComplete||tl.run()}),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const tl=this.list[this.index];tl?tl.run().then(()=>{this.onTask(tl),this.index++,tl.isCancel?this.runTask():this.nextTask()}).catch(el=>{this.onError(el)}):this.timer=setTimeout(()=>this.nextTask())}runParallelTasks(){this.parallelList.forEach(tl=>this.runParallelTask(tl))}runParallelTask(tl){tl.run().then(()=>{this.onTask(tl),this.fillParallelTask()}).catch(el=>{this.onParallelError(el)})}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout(()=>this.run())}setParallelList(){let tl;const{config:el,list:il,index:sl}=this;this.parallelList=[],this.parallelSuccessNumber=0;let nl=sl+el.parallel;if(nl>il.length&&(nl=il.length),el.parallel>1)for(let ol=sl;ol<nl&&(tl=il[ol],tl.parallel);ol++)this.parallelList.push(tl)}fillParallelTask(){let tl;const el=this.parallelList;this.parallelSuccessNumber++,el.pop();const il=el.length,sl=this.finishedIndex+il;if(el.length){if(!this.running)return;sl<this.total&&(tl=this.list[sl],tl&&tl.parallel&&(el.push(tl),this.runParallelTask(tl)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(tl){tl.complete(),this.config.onTask&&this.config.onTask()}onParallelError(tl){this.parallelList.forEach(el=>{el.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(tl)}onError(tl){this.pause(),this.config.onError&&this.config.onError(tl)}destroy(){this.stop()}};const $i$1=ee$2.get("Resource"),Ki$1={tasker:new Zi$1,queue:new Zi$1({parallel:1}),map:{},get isComplete(){return tn.tasker.isComplete},set(tl,el){tn.map[tl]&&$i$1.repeat(tl),tn.map[tl]=el},get:tl=>tn.map[tl],remove(tl){const el=tn.map[tl];el&&(el.destroy&&el.destroy(),delete tn.map[tl])},loadImage(tl,el){return new Promise((il,sl)=>{const nl=this.setImage(tl,tl,el);nl.load(()=>il(nl),ol=>sl(ol))})},setImage(tl,el,il){let sl;return i(el)?sl={url:el}:el.url||(sl={url:tl,view:el}),sl&&(il&&(sl.format=il),el=le$2.image(sl)),tn.set(tl,el),el},loadFilm(tl,el){},loadVideo(tl,el){},destroy(){tn.map={}}},tn=Ki$1,en={maxRecycled:10,recycledList:[],patternTasker:Ki$1.queue,get(tl,el){let il=Ki$1.get(tl.url);return il||Ki$1.set(tl.url,il=el==="film"?le$2.film(tl):le$2.image(tl)),il.use++,il},recycle(tl){tl.use--,setTimeout(()=>{tl.use||($t$2.image.isLarge(tl)?tl.url&&Ki$1.remove(tl.url):(tl.clearLevels(),sn.recycledList.push(tl)))})},recyclePaint(tl){sn.recycle(tl.image)},clearRecycled(tl){const el=sn.recycledList;(el.length>sn.maxRecycled||tl)&&(el.forEach(il=>(!il.use||tl)&&il.url&&Ki$1.remove(il.url)),el.length=0)},clearLevels(){},hasAlphaPixel:tl=>Gi$1.alphaPixelTypes.some(el=>sn.isFormat(el,tl)),isFormat(tl,el){if(el.format)return el.format===tl;const{url:il}=el;if(il.startsWith("data:")){if(il.startsWith("data:"+Gi$1.mimeType(tl)))return!0}else if(il.includes("."+tl)||il.includes("."+Gi$1.upperCaseTypeMap[tl])||tl==="png"&&!il.includes("."))return!0;return!1},destroy(){this.clearRecycled(!0)}},sn=en,{IMAGE:rn,create:nn}=g;class on{get tag(){return"Image"}get url(){return this.config.url}get crossOrigin(){const{crossOrigin:el}=this.config;return s(el)?$t$2.image.crossOrigin:el}get completed(){return this.ready||!!this.error}constructor(el){if(this.use=0,this.waitComplete=[],this.innerId=nn(rn),this.config=el||(el={url:""}),el.view){const{view:il}=el;this.setView(il.config?il.view:il)}en.isFormat("svg",el)&&(this.isSVG=!0),en.hasAlphaPixel(el)&&(this.hasAlphaPixel=!0)}load(el,il,sl){return this.loading||(this.loading=!0,Ki$1.tasker.add(()=>me$2(this,void 0,void 0,function*(){return yield $t$2.origin["load"+this.tag](this.getLoadUrl(sl),this.crossOrigin,this).then(nl=>{sl&&this.setThumbView(nl),this.setView(nl)}).catch(nl=>{this.error=nl,this.onComplete(!1)})}))),this.waitComplete.push(el,il),this.waitComplete.length-2}unload(el,il){const sl=this.waitComplete;if(il){const nl=sl[el+1];nl&&nl({type:"stop"})}sl[el]=sl[el+1]=void 0}setView(el){this.ready=!0,this.width||(this.width=el.width,this.height=el.height,this.view=el),this.onComplete(!0)}onComplete(el){let il;this.waitComplete.forEach((sl,nl)=>{il=nl%2,sl&&(el?il||sl(this):il&&sl(this.error))}),this.waitComplete.length=0,this.loading=!1}getFull(el){return this.view}getCanvas(el,il,sl,nl,ol,rl,al,ll){if(el||(el=this.width),il||(il=this.height),this.cache){let{params:ul,data:dl}=this.cache;for(let fl in ul)if(ul[fl]!==arguments[fl]){dl=null;break}if(dl)return dl}const cl=$t$2.image.resize(this.view,el,il,ol,rl,void 0,al,sl,nl,ll);return this.cache=this.use>1?{data:cl,params:arguments}:null,cl}getPattern(el,il,sl,nl){const ol=$t$2.canvas.createPattern(el,il);return $t$2.image.setPatternTransform(ol,sl,nl),ol}render(el,il,sl,nl,ol,rl,al,ll,cl){el.drawImage(this.view,il,sl,nl,ol)}getLoadUrl(el){return this.url}setThumbView(el){}getThumbSize(el){}getMinLevel(){}getLevelData(el,il,sl){}clearLevels(el){}destroy(){this.clearLevels();const{view:el}=this;el&&el.close&&el.close(),this.config={url:""},this.cache=this.view=null,this.waitComplete.length=0}}class an extends on{get tag(){return"Film"}}class hn extends on{get tag(){return"Video"}}function ln(tl,el,il,sl){sl||(il.configurable=il.enumerable=!0),Object.defineProperty(tl,el,il)}function dn(tl,el){return Object.getOwnPropertyDescriptor(tl,el)}function cn(tl,el){const il="_"+tl;return{get(){const sl=this[il];return sl==null?el:sl},set(sl){this[il]=sl}}}function un(tl,el){return(il,sl)=>pn(il,sl,tl,el&&el(sl))}function _n(tl){return tl}function pn(tl,el,il,sl){ln(tl,el,Object.assign({get(){return this.__getAttr(el)},set(nl){this.__setAttr(el,nl)}},sl||{})),Un(tl,el,il)}function fn(tl){return un(tl)}function gn(tl,el){return un(tl,il=>({set(sl){this.__setAttr(il,sl,el)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}}))}function yn(tl,el){return un(tl,il=>({set(sl){this.__setAttr(il,sl,el)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__scrollWorld||(this.__scrollWorld={}))}}))}function mn(tl){return un(tl,el=>({set(il){this.__setAttr(el,il)&&(this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal(),vn(this))}}))}function xn(tl,el){return un(tl,il=>({set(sl){this.__setAttr(il,sl,el)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}}))}function wn(tl,el){return un(tl,il=>({set(sl){this.__setAttr(il,sl,el)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}}))}function bn(tl,el){return un(tl,il=>({set(sl){this.__setAttr(il,sl,el)&&vn(this)}}))}function Bn(tl){return un(tl,el=>({set(il){this.__setAttr(el,il)&&(vn(this),this.__.__removeNaturalSize())}}))}function vn(tl){tl.__layout.boxChanged||tl.__layout.boxChange(),tl.__hasAutoLayout&&(tl.__layout.matrixChanged||tl.__layout.matrixChange())}function kn(tl){return un(tl,el=>({set(il){const sl=this.__;sl.__pathInputed!==2&&(sl.__pathInputed=il?1:0),il||(sl.__pathForRender=void 0),this.__setAttr(el,il),vn(this)}}))}const Cn=bn;function On(tl,el){return un(tl,il=>({set(sl){this.__setAttr(il,sl)&&(Tn(this),el&&(this.__.__useStroke=!0))}}))}function Tn(tl){tl.__layout.strokeChanged||tl.__layout.strokeChange(),tl.__.__useArrow&&vn(tl)}const Pn=On;function Sn(tl){return un(tl,el=>({set(il){this.__setAttr(el,il),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Ln(tl){return un(tl,el=>({set(il){this.__setAttr(el,il)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}}))}function Rn(tl){return un(tl,el=>({set(il){if(this.__setAttr(el,il)){const sl=this.__;_.stintSet(sl,"__useDim",sl.dim||sl.bright||sl.dimskip),this.__layout.surfaceChange()}}}))}function En(tl){return un(tl,el=>({set(il){this.__setAttr(el,il)&&(this.__layout.opacityChanged||this.__layout.opacityChange()),this.mask&&Mn(this)}}))}function In(tl){return un(tl,el=>({set(il){const sl=this.visible;if(sl===!0&&il===0){if(this.animationOut)return this.__runAnimation("out",()=>An(this,el,il,sl))}else sl===0&&il===!0&&this.animation&&this.__runAnimation("in");An(this,el,il,sl),this.mask&&Mn(this)}}))}function Mn(tl){const{parent:el}=tl;if(el){const{__hasMask:il}=el;el.__updateMask(),il!==el.__hasMask&&el.forceUpdate()}}function An(tl,el,il,sl){tl.__setAttr(el,il)&&(tl.__layout.opacityChanged||tl.__layout.opacityChange(),sl!==0&&il!==0||vn(tl))}function Wn(tl){return un(tl,el=>({set(il){this.__setAttr(el,il)&&(this.__layout.surfaceChange(),this.waitParent(()=>{this.parent.__layout.childrenSortChange()}))}}))}function Nn(tl){return un(tl,el=>({set(il){this.__setAttr(el,il)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent(()=>{this.parent.__updateMask(il)}))}}))}function Yn(tl){return un(tl,el=>({set(il){this.__setAttr(el,il)&&this.waitParent(()=>{this.parent.__updateEraser(il)})}}))}function Dn(tl){return un(tl,el=>({set(il){this.__setAttr(el,il)&&(this.__layout.hitCanvasChanged=!0,ee$2.showBounds==="hit"&&this.__layout.surfaceChange(),this.leafer&&this.leafer.updateCursor())}}))}function Xn(tl){return un(tl,el=>({set(il){this.__setAttr(el,il),this.leafer&&this.leafer.updateCursor()}}))}function zn(tl){return(el,il)=>{ln(el,"__DataProcessor",{get:()=>tl})}}function Fn(tl){return(el,il)=>{ln(el,"__LayoutProcessor",{get:()=>tl})}}function Un(tl,el,il){const sl=tl.__DataProcessor.prototype,nl="_"+el,ol=(function(ul){return"set"+ul.charAt(0).toUpperCase()+ul.slice(1)})(el),rl=cn(el,il);if(s(il))rl.get=function(){return this[nl]};else if(typeof il=="function")rl.get=function(){const ul=this[nl];return ul==null?il(this.__leaf):ul};else if(d(il)){const ul=u(il);rl.get=function(){const dl=this[nl];return dl==null?this[nl]=ul?{}:_.clone(il):dl}}const al=tl.isBranchLeaf;el==="width"?rl.get=function(){const ul=this[nl];if(ul==null){const dl=this,fl=dl.__naturalWidth,hl=dl.__leaf;return!il||hl.pathInputed?hl.boxBounds.width:fl?dl._height&&dl.__useNaturalRatio?dl._height*fl/dl.__naturalHeight:fl:al&&hl.children.length?hl.boxBounds.width:il}return ul}:el==="height"&&(rl.get=function(){const ul=this[nl];if(ul==null){const dl=this,fl=dl.__naturalHeight,hl=dl.__leaf;return!il||hl.pathInputed?hl.boxBounds.height:fl?dl._width&&dl.__useNaturalRatio?dl._width*fl/dl.__naturalWidth:fl:al&&hl.children.length?hl.boxBounds.height:il}return ul});let ll,cl=sl;for(;!ll&&cl;)ll=dn(cl,el),cl=cl.__proto__;ll&&ll.set&&(rl.set=ll.set),sl[ol]&&(rl.set=sl[ol],delete sl[ol]),ln(sl,el,rl)}const jn=new ee$2("rewrite"),Vn=[],Hn=["destroy","constructor"];function Gn(tl){return(el,il)=>{Vn.push({name:el.constructor.name+"."+il,run:()=>{el[il]=tl}})}}function qn(){return tl=>{Qn()}}function Qn(tl){Vn.length&&(Vn.forEach(el=>{tl&&jn.error(el.name,"\u9700\u5728Class\u4E0A\u88C5\u9970@rewriteAble()"),el.run()}),Vn.length=0)}function Jn(tl,el){return il=>{var sl;(tl.prototype?(sl=tl.prototype,Object.getOwnPropertyNames(sl)):Object.keys(tl)).forEach(nl=>{Hn.includes(nl)||el&&el.includes(nl)||(tl.prototype?dn(tl.prototype,nl).writable&&(il.prototype[nl]=tl.prototype[nl]):il.prototype[nl]=tl[nl])})}}function Zn(){return tl=>{ce$2.register(tl)}}function $n(){return tl=>{pe$2.register(tl)}}setTimeout(()=>Qn(!0));const{copy:Kn,toInnerPoint:to,toOuterPoint:eo,scaleOfOuter:so,rotateOfOuter:ro,skewOfOuter:io,multiplyParent:no,divideParent:oo,getLayout:ao}=q$1,ho={},{round:lo}=Math,co={updateAllMatrix(tl,el,il){if(el&&tl.__hasAutoLayout&&tl.__layout.matrixChanged&&(il=!0),po(tl,el,il),tl.isBranch){const{children:sl}=tl;for(let nl=0,ol=sl.length;nl<ol;nl++)_o(sl[nl],el,il)}},updateMatrix(tl,el,il){const sl=tl.__layout;el?il&&(sl.waitAutoLayout=!0,tl.__hasAutoLayout&&(sl.matrixChanged=!1)):sl.waitAutoLayout&&(sl.waitAutoLayout=!1),sl.matrixChanged&&tl.__updateLocalMatrix(),sl.waitAutoLayout||tl.__updateWorldMatrix()},updateBounds(tl){const el=tl.__layout;el.boundsChanged&&tl.__updateLocalBounds(),el.waitAutoLayout||tl.__updateWorldBounds()},updateAllWorldOpacity(tl){if(tl.__updateWorldOpacity(),tl.isBranch){const{children:el}=tl;for(let il=0,sl=el.length;il<sl;il++)fo(el[il])}},updateChange(tl){const el=tl.__layout;el.stateStyleChanged&&tl.updateState(),el.opacityChanged&&fo(tl),tl.__updateChange()},updateAllChange(tl){if(yo(tl),tl.isBranch){const{children:el}=tl;for(let il=0,sl=el.length;il<sl;il++)go(el[il])}},worldHittable(tl){for(;tl;){if(!tl.__.hittable)return!1;tl=tl.parent}return!0},draggable:tl=>(tl.draggable||tl.editable)&&tl.hitSelf&&!tl.locked,copyCanvasByWorld(tl,el,il,sl,nl,ol){sl||(sl=tl.__nowWorld),tl.__worldFlipped||$t$2.fullImageShadow?el.copyWorldByReset(il,sl,tl.__nowWorld,nl,ol):el.copyWorldToInner(il,sl,tl.__layout.renderBounds,nl)},moveWorld(tl,el,il=0,sl,nl){const ol=d(el)?Object.assign({},el):{x:el,y:il};sl?eo(tl.localTransform,ol,ol,!0):tl.parent&&to(tl.parent.scrollWorldTransform,ol,ol,!0),uo.moveLocal(tl,ol.x,ol.y,nl)},moveLocal(tl,el,il=0,sl){d(el)&&(il=el.y,el=el.x),el+=tl.x,il+=tl.y,tl.leafer&&tl.leafer.config.pointSnap&&(el=lo(el),il=lo(il)),sl?tl.animate({x:el,y:il},sl):(tl.x=el,tl.y=il)},zoomOfWorld(tl,el,il,sl,nl,ol){uo.zoomOfLocal(tl,mo(tl,el),il,sl,nl,ol)},zoomOfLocal(tl,el,il,sl=il,nl,ol){const rl=tl.__localMatrix;if(o(sl)||(sl&&(ol=sl),sl=il),Kn(ho,rl),so(ho,el,il,sl),uo.hasHighPosition(tl))uo.setTransform(tl,ho,nl,ol);else{const al=tl.x+ho.e-rl.e,ll=tl.y+ho.f-rl.f;ol&&!nl?tl.animate({x:al,y:ll,scaleX:tl.scaleX*il,scaleY:tl.scaleY*sl},ol):(tl.x=al,tl.y=ll,tl.scaleResize(il,sl,nl!==!0))}},rotateOfWorld(tl,el,il,sl){uo.rotateOfLocal(tl,mo(tl,el),il,sl)},rotateOfLocal(tl,el,il,sl){const nl=tl.__localMatrix;Kn(ho,nl),ro(ho,el,il),uo.hasHighPosition(tl)?uo.setTransform(tl,ho,!1,sl):tl.set({x:tl.x+ho.e-nl.e,y:tl.y+ho.f-nl.f,rotation:I$1.formatRotation(tl.rotation+il)},sl)},skewOfWorld(tl,el,il,sl,nl,ol){uo.skewOfLocal(tl,mo(tl,el),il,sl,nl,ol)},skewOfLocal(tl,el,il,sl=0,nl,ol){Kn(ho,tl.__localMatrix),io(ho,el,il,sl),uo.setTransform(tl,ho,nl,ol)},transformWorld(tl,el,il,sl){Kn(ho,tl.worldTransform),no(ho,el),tl.parent&&oo(ho,tl.parent.scrollWorldTransform),uo.setTransform(tl,ho,il,sl)},transform(tl,el,il,sl){Kn(ho,tl.localTransform),no(ho,el),uo.setTransform(tl,ho,il,sl)},setTransform(tl,el,il,sl){const nl=tl.__,ol=nl.origin&&uo.getInnerOrigin(tl,nl.origin),rl=ao(el,ol,nl.around&&uo.getInnerOrigin(tl,nl.around));if(uo.hasOffset(tl)&&(rl.x-=nl.offsetX,rl.y-=nl.offsetY),il){const al=rl.scaleX/tl.scaleX,ll=rl.scaleY/tl.scaleY;if(delete rl.scaleX,delete rl.scaleY,ol){zt$2.scale(tl.boxBounds,Math.abs(al),Math.abs(ll));const cl=uo.getInnerOrigin(tl,nl.origin);ot$2.move(rl,ol.x-cl.x,ol.y-cl.y)}tl.set(rl),tl.scaleResize(al,ll,!1)}else tl.set(rl,sl)},getFlipTransform(tl,el){const il={a:1,b:0,c:0,d:1,e:0,f:0},sl=el==="x"?1:-1;return so(il,uo.getLocalOrigin(tl,"center"),-1*sl,1*sl),il},getLocalOrigin:(tl,el)=>ot$2.tempToOuterOf(uo.getInnerOrigin(tl,el),tl.localTransform),getInnerOrigin(tl,el){const il={};return bt$3.toPoint(el,tl.boxBounds,il),il},getRelativeWorld:(tl,el,il)=>(Kn(ho,tl.worldTransform),oo(ho,el.scrollWorldTransform),il?ho:Object.assign({},ho)),drop(tl,el,il,sl){tl.setTransform(uo.getRelativeWorld(tl,el,!0),sl),el.add(tl,il)},hasHighPosition:tl=>tl.origin||tl.around||uo.hasOffset(tl),hasOffset:tl=>tl.offsetX||tl.offsetY,hasParent(tl,el){if(!el)return!1;for(;tl;){if(el===tl)return!0;tl=tl.parent}},animateMove(tl,el,il=.3){if(el.x||el.y)if(Math.abs(el.x)<1&&Math.abs(el.y)<1)tl.move(el);else{const sl=el.x*il,nl=el.y*il;el.x-=sl,el.y-=nl,tl.move(sl,nl),$t$2.requestRender(()=>uo.animateMove(tl,el,il))}}},uo=co,{updateAllMatrix:_o,updateMatrix:po,updateAllWorldOpacity:fo,updateAllChange:go,updateChange:yo}=uo;function mo(tl,el){return tl.updateLayout(),tl.parent?ot$2.tempToInnerOf(el,tl.parent.scrollWorldTransform):el}const xo={worldBounds:tl=>tl.__world,localBoxBounds:tl=>tl.__.eraser||tl.__.visible===0?null:tl.__local||tl.__layout,localStrokeBounds:tl=>tl.__.eraser||tl.__.visible===0?null:tl.__layout.localStrokeBounds,localRenderBounds:tl=>tl.__.eraser||tl.__.visible===0?null:tl.__layout.localRenderBounds,maskLocalBoxBounds:(tl,el)=>bo(tl,el)&&tl.__localBoxBounds,maskLocalStrokeBounds:(tl,el)=>bo(tl,el)&&tl.__layout.localStrokeBounds,maskLocalRenderBounds:(tl,el)=>bo(tl,el)&&tl.__layout.localRenderBounds,excludeRenderBounds:(tl,el)=>!(!el.bounds||el.bounds.hit(tl.__world,el.matrix))||!(!el.hideBounds||!el.hideBounds.includes(tl.__world,el.matrix))};let wo;function bo(tl,el){return el||(wo=0),tl.__.mask&&(wo=1),wo<0?null:(wo&&(wo=-1),!0)}const{updateBounds:Bo}=co,vo={sort:(tl,el)=>tl.__.zIndex===el.__.zIndex?tl.__tempNumber-el.__tempNumber:tl.__.zIndex-el.__.zIndex,pushAllChildBranch(tl,el){if(tl.__tempNumber=1,tl.__.__childBranchNumber){const{children:il}=tl;for(let sl=0,nl=il.length;sl<nl;sl++)(tl=il[sl]).isBranch&&(tl.__tempNumber=1,el.add(tl),ko(tl,el))}},pushAllParent(tl,el){const{keys:il}=el;if(il)for(;tl.parent&&s(il[tl.parent.innerId]);)el.add(tl.parent),tl=tl.parent;else for(;tl.parent;)el.add(tl.parent),tl=tl.parent},pushAllBranchStack(tl,el){let il=el.length;const{children:sl}=tl;for(let nl=0,ol=sl.length;nl<ol;nl++)sl[nl].isBranch&&el.push(sl[nl]);for(let nl=il,ol=el.length;nl<ol;nl++)Co(el[nl],el)},updateBounds(tl,el){const il=[tl];Co(tl,il),Oo(il,el)},updateBoundsByBranchStack(tl,el){let il,sl;for(let nl=tl.length-1;nl>-1;nl--){il=tl[nl],sl=il.children;for(let ol=0,rl=sl.length;ol<rl;ol++)Bo(sl[ol]);el&&el===il||Bo(il)}},move(tl,el,il){let sl;const{children:nl}=tl;for(let ol=0,rl=nl.length;ol<rl;ol++)sl=(tl=nl[ol]).__world,sl.e+=el,sl.f+=il,sl.x+=el,sl.y+=il,tl.isBranch&&To(tl,el,il)},scale(tl,el,il,sl,nl,ol,rl){let al;const{children:ll}=tl,cl=sl-1,ul=nl-1;for(let dl=0,fl=ll.length;dl<fl;dl++)al=(tl=ll[dl]).__world,al.a*=sl,al.d*=nl,(al.b||al.c)&&(al.b*=sl,al.c*=nl),al.e===al.x&&al.f===al.y?(al.x=al.e+=(al.e-ol)*cl+el,al.y=al.f+=(al.f-rl)*ul+il):(al.e+=(al.e-ol)*cl+el,al.f+=(al.f-rl)*ul+il,al.x+=(al.x-ol)*cl+el,al.y+=(al.y-rl)*ul+il),al.width*=sl,al.height*=nl,al.scaleX*=sl,al.scaleY*=nl,tl.isBranch&&Po(tl,el,il,sl,nl,ol,rl)}},{pushAllChildBranch:ko,pushAllBranchStack:Co,updateBoundsByBranchStack:Oo,move:To,scale:Po}=vo,So={run(tl){if(tl&&tl.length){const el=tl.length;for(let il=0;il<el;il++)tl[il]();tl.length===el?tl.length=0:tl.splice(0,el)}}},{getRelativeWorld:Lo,updateBounds:Ro}=co,{toOuterOf:Eo,getPoints:Io,copy:Mo}=zt$2,Ao="_localContentBounds",Wo="_worldContentBounds",No="_worldBoxBounds",Yo="_worldStrokeBounds";class Do{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(el){this._contentBounds=el}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}set renderBounds(el){this._renderBounds=el}get localContentBounds(){return Eo(this.contentBounds,this.leaf.__localMatrix,this[Ao]||(this[Ao]={})),this[Ao]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return Eo(this.contentBounds,this.leaf.__world,this[Wo]||(this[Wo]={})),this[Wo]}get worldBoxBounds(){return Eo(this.boxBounds,this.leaf.__world,this[No]||(this[No]={})),this[No]}get worldStrokeBounds(){return Eo(this.strokeBounds,this.leaf.__world,this[Yo]||(this[Yo]={})),this[Yo]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(el){this.leaf=el,this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),el.__world&&(this.boxBounds={x:0,y:0,width:0,height:0},this.boxChange(),this.matrixChange())}createLocal(){const el=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=el),this._localRenderBounds||(this._localRenderBounds=el)}update(){const{leaf:el}=this,{leafer:il}=el;if(el.isApp)return Ro(el);if(il)il.ready?il.watcher.changed&&il.layouter.layout():il.start();else{let sl=el;for(;sl.parent&&!sl.parent.leafer;)sl=sl.parent;const nl=sl;if(nl.__fullLayouting)return;nl.__fullLayouting=!0,$t$2.layout(nl),delete nl.__fullLayouting}}getTransform(el="world"){this.update();const{leaf:il}=this;switch(el){case"world":return il.__world;case"local":return il.__localMatrix;case"inner":return q$1.defaultMatrix;case"page":el=il.zoomLayer;default:return Lo(il,el)}}getBounds(el,il="world"){switch(this.update(),il){case"world":return this.getWorldBounds(el);case"local":return this.getLocalBounds(el);case"inner":return this.getInnerBounds(el);case"page":il=this.leaf.zoomLayer;default:return new Vt$3(this.getInnerBounds(el)).toOuterOf(this.getTransform(il))}}getInnerBounds(el="box"){switch(el){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(el="box"){switch(el){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(el="box"){switch(el){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(el,il="world",sl){const{leaf:nl}=this;let ol,rl,al,ll=this.getInnerBounds(el);switch(il){case"world":ol=nl.getWorldPoint(ll),rl=nl.__world;break;case"local":const{scaleX:cl,scaleY:ul,rotation:dl,skewX:fl,skewY:hl}=nl.__;al={scaleX:cl,scaleY:ul,rotation:dl,skewX:fl,skewY:hl},ol=nl.getLocalPointByInner(ll);break;case"inner":ol=ll,rl=q$1.defaultMatrix;break;case"page":il=nl.zoomLayer;default:ol=nl.getWorldPoint(ll,il),rl=Lo(nl,il,!0)}if(al||(al=q$1.getLayout(rl)),Mo(al,ll),ot$2.copy(al,ol),sl){const{scaleX:cl,scaleY:ul}=al,dl=Math.abs(cl),fl=Math.abs(ul);dl===1&&fl===1||(al.scaleX/=dl,al.scaleY/=fl,al.width*=dl,al.height*=fl)}return al}getLayoutPoints(el,il="world"){const{leaf:sl}=this,nl=Io(this.getInnerBounds(el));let ol;switch(il){case"world":ol=null;break;case"local":ol=sl.parent;break;case"inner":break;case"page":il=sl.zoomLayer;default:ol=il}return s(ol)||nl.forEach(rl=>sl.innerToWorld(rl,null,!1,ol)),nl}shrinkContent(){const{x:el,y:il,width:sl,height:nl}=this.boxBounds;this._contentBounds={x:el,y:il,width:sl,height:nl}}spreadStroke(){const{x:el,y:il,width:sl,height:nl}=this.strokeBounds;this._strokeBounds={x:el,y:il,width:sl,height:nl},this._localStrokeBounds={x:el,y:il,width:sl,height:nl},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:el,y:il,width:sl,height:nl}=this.renderBounds;this._renderBounds={x:el,y:il,width:sl,height:nl},this._localRenderBounds={x:el,y:il,width:sl,height:nl}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const el=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,el&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=this.affectChildrenSort=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class Xo{constructor(el,il){this.bubbles=!1,this.type=el,il&&(this.target=il)}stopDefault(){this.isStopDefault=!0,this.origin&&$t$2.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&$t$2.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&$t$2.event.stop(this.origin)}}class zo extends Xo{constructor(el,il,sl){super(el,il),this.parent=sl,this.child=il}}zo.ADD="child.add",zo.REMOVE="child.remove",zo.CREATED="created",zo.MOUNTED="mounted",zo.UNMOUNTED="unmounted",zo.DESTROY="destroy";const Fo="property.scroll";class Uo extends Xo{constructor(el,il,sl,nl,ol){super(el,il),this.attrName=sl,this.oldValue=nl,this.newValue=ol}}Uo.CHANGE="property.change",Uo.LEAFER_CHANGE="property.leafer_change",Uo.SCROLL=Fo;const jo={scrollX:Fo,scrollY:Fo};class Vo extends Xo{constructor(el,il){super(el),Object.assign(this,il)}}Vo.LOAD="image.load",Vo.LOADED="image.loaded",Vo.ERROR="image.error";class Ho extends Xo{static checkHas(el,il,sl){sl==="on"?il===Jo?el.__hasWorldEvent=!0:el.__hasLocalEvent=!0:(el.__hasLocalEvent=el.hasEvent(Go)||el.hasEvent(qo)||el.hasEvent(Qo),el.__hasWorldEvent=el.hasEvent(Jo))}static emitLocal(el){if(el.leaferIsReady){const{resized:il}=el.__layout;il!=="local"&&(el.emit(Go,el),il==="inner"&&el.emit(qo,el)),el.emit(Qo,el)}}static emitWorld(el){el.leaferIsReady&&el.emit(Jo,this)}}Ho.RESIZE="bounds.resize",Ho.INNER="bounds.inner",Ho.LOCAL="bounds.local",Ho.WORLD="bounds.world";const{RESIZE:Go,INNER:qo,LOCAL:Qo,WORLD:Jo}=Ho,Zo={};[Go,qo,Qo,Jo].forEach(tl=>Zo[tl]=1);class $o extends Xo{get bigger(){if(!this.old)return!0;const{width:el,height:il}=this.old;return this.width>=el&&this.height>=il}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(el,il){d(el)?(super($o.RESIZE),Object.assign(this,el)):super(el),this.old=il}static isResizing(el){return this.resizingKeys&&!s(this.resizingKeys[el.innerId])}}$o.RESIZE="resize";class Ko extends Xo{constructor(el,il){super(el),this.data=il}}Ko.REQUEST="watch.request",Ko.DATA="watch.data";class ta extends Xo{constructor(el,il,sl){super(el),il&&(this.data=il,this.times=sl)}}ta.REQUEST="layout.request",ta.START="layout.start",ta.BEFORE="layout.before",ta.LAYOUT="layout",ta.AFTER="layout.after",ta.AGAIN="layout.again",ta.END="layout.end";class ea extends Xo{constructor(el,il,sl,nl){super(el),il&&(this.times=il),sl&&(this.renderBounds=sl,this.renderOptions=nl)}}ea.REQUEST="render.request",ea.CHILD_START="render.child_start",ea.CHILD_END="render.child_end",ea.START="render.start",ea.BEFORE="render.before",ea.RENDER="render",ea.AFTER="render.after",ea.AGAIN="render.again",ea.END="render.end",ea.NEXT="render.next";class sa extends Xo{}sa.START="leafer.start",sa.BEFORE_READY="leafer.before_ready",sa.READY="leafer.ready",sa.AFTER_READY="leafer.after_ready",sa.VIEW_READY="leafer.view_ready",sa.VIEW_COMPLETED="leafer.view_completed",sa.STOP="leafer.stop",sa.RESTART="leafer.restart",sa.END="leafer.end",sa.UPDATE_MODE="leafer.update_mode",sa.TRANSFORM="leafer.transform",sa.MOVE="leafer.move",sa.SCALE="leafer.scale",sa.ROTATE="leafer.rotate",sa.SKEW="leafer.skew";const{MOVE:ra,SCALE:ia,ROTATE:na,SKEW:oa}=sa,aa={x:ra,y:ra,scaleX:ia,scaleY:ia,rotation:na,skewX:oa,skewY:oa},ha={};class la{set event(el){this.on(el)}on(el,il,sl){if(!il){let ul;if(l(el))el.forEach(dl=>this.on(dl[0],dl[1],dl[2]));else for(let dl in el)l(ul=el[dl])?this.on(dl,ul[0],ul[1]):this.on(dl,ul);return}let nl,ol,rl;sl&&(sl==="once"?ol=!0:typeof sl=="boolean"?nl=sl:(nl=sl.capture,ol=sl.once));const al=da(this,nl,!0),ll=i(el)?el.split(" "):el,cl=ol?{listener:il,once:ol}:{listener:il};ll.forEach(ul=>{ul&&(rl=al[ul],rl?rl.findIndex(dl=>dl.listener===il)===-1&&rl.push(cl):al[ul]=[cl],Zo[ul]&&Ho.checkHas(this,ul,"on"))})}off(el,il,sl){if(el){const nl=i(el)?el.split(" "):el;if(il){let ol,rl,al;sl&&(ol=typeof sl=="boolean"?sl:sl!=="once"&&sl.capture);const ll=da(this,ol);nl.forEach(cl=>{cl&&(rl=ll[cl],rl&&(al=rl.findIndex(ul=>ul.listener===il),al>-1&&rl.splice(al,1),rl.length||delete ll[cl],Zo[cl]&&Ho.checkHas(this,cl,"off")))})}else{const{__bubbleMap:ol,__captureMap:rl}=this;nl.forEach(al=>{ol&&delete ol[al],rl&&delete rl[al]})}}else this.__bubbleMap=this.__captureMap=void 0}on_(el,il,sl,nl){return il?this.on(el,sl?il=il.bind(sl):il,nl):l(el)&&el.forEach(ol=>this.on(ol[0],ol[2]?ol[1]=ol[1].bind(ol[2]):ol[1],ol[3])),{type:el,current:this,listener:il,options:nl}}off_(el){if(!el)return;const il=l(el)?el:[el];il.forEach(sl=>{sl&&(sl.listener?sl.current.off(sl.type,sl.listener,sl.options):l(sl.type)&&sl.type.forEach(nl=>sl.current.off(nl[0],nl[1],nl[3])))}),il.length=0}once(el,il,sl,nl){if(!il)return l(el)&&el.forEach(ol=>this.once(ol[0],ol[1],ol[2],ol[3]));d(sl)?il=il.bind(sl):nl=sl,this.on(el,il,{once:!0,capture:nl})}emit(el,il,sl){!il&&pe$2.has(el)&&(il=pe$2.get(el,{type:el,target:this,current:this}));const nl=da(this,sl)[el];if(nl){let ol;for(let rl=0,al=nl.length;rl<al&&!((ol=nl[rl])&&(ol.listener(il),ol.once&&(this.off(el,ol.listener,sl),rl--,al--),il&&il.isStopNow));rl++);}this.syncEventer&&this.syncEventer.emitEvent(il,sl)}emitEvent(el,il){el.current=this,this.emit(el.type,el,il)}hasEvent(el,il){if(this.syncEventer&&this.syncEventer.hasEvent(el,il))return!0;const{__bubbleMap:sl,__captureMap:nl}=this,ol=sl&&sl[el],rl=nl&&nl[el];return!!(s(il)?ol||rl:il?rl:ol)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function da(tl,el,il){if(el){const{__captureMap:sl}=tl;return sl||(il?tl.__captureMap={}:ha)}{const{__bubbleMap:sl}=tl;return sl||(il?tl.__bubbleMap={}:ha)}}const{on:ca,on_:ua,off:_a,off_:pa,once:fa,emit:ga,emitEvent:ya,hasEvent:ma,destroy:xa}=la.prototype,wa={on:ca,on_:ua,off:_a,off_:pa,once:fa,emit:ga,emitEvent:ya,hasEvent:ma,destroyEventer:xa},ba=ee$2.get("setAttr"),Ba={__setAttr(tl,el,il){if(this.leaferIsCreated){const sl=this.__.__getInput(tl);if(!il||n(el)||s(el)||(ba.warn(this.innerName,tl,el),el=void 0),d(el)||sl!==el){if(this.__realSetAttr(tl,el),this.isLeafer){this.emitEvent(new Uo(Uo.LEAFER_CHANGE,this,tl,sl,el));const ol=aa[tl];ol&&(this.emitEvent(new sa(ol,this)),this.emitEvent(new sa(sa.TRANSFORM,this)))}this.emitPropertyEvent(Uo.CHANGE,tl,sl,el);const nl=jo[tl];return nl&&this.emitPropertyEvent(nl,tl,sl,el),!0}return!1}return this.__realSetAttr(tl,el),!0},emitPropertyEvent(tl,el,il,sl){const nl=new Uo(tl,this,el,il,sl);this.isLeafer||this.hasEvent(tl)&&this.emitEvent(nl),this.leafer.emitEvent(nl)},__realSetAttr(tl,el){const il=this.__;il[tl]=el,this.__proxyData&&this.setProxyAttr(tl,el),il.normalStyle&&(this.lockNormalStyle||s(il.normalStyle[tl])||(il.normalStyle[tl]=el))},__getAttr(tl){return this.__proxyData?this.getProxyAttr(tl):this.__.__get(tl)}},{setLayout:va,multiplyParent:ka,translateInner:Ca,defaultWorld:Oa}=q$1,{toPoint:Ta,tempPoint:Pa}=bt$3,Sa={__updateWorldMatrix(){const{parent:tl,__layout:el,__world:il,__scrollWorld:sl,__:nl}=this;ka(this.__local||el,tl?tl.__scrollWorld||tl.__world:Oa,il,!!el.affectScaleOrRotation,nl),sl&&Ca(Object.assign(sl,il),nl.scrollX,nl.scrollY)},__updateLocalMatrix(){if(this.__local){const tl=this.__layout,el=this.__local,il=this.__;tl.affectScaleOrRotation&&(tl.scaleChanged&&(tl.resized||(tl.resized="scale"))||tl.rotationChanged)&&(va(el,il,null,null,tl.affectRotation),tl.scaleChanged=tl.rotationChanged=void 0),el.e=il.x+il.offsetX,el.f=il.y+il.offsetY,(il.around||il.origin)&&(Ta(il.around||il.origin,tl.boxBounds,Pa),Ca(el,-Pa.x,-Pa.y,!il.around))}this.__layout.matrixChanged=void 0}},{updateMatrix:La,updateAllMatrix:Ra}=co,{updateBounds:Ea}=vo,{toOuterOf:Ia,copyAndSpread:Ma,copy:Aa}=zt$2,{toBounds:Wa}=Ai$1,Na={__updateWorldBounds(){const{__layout:tl,__world:el}=this;Ia(tl.renderBounds,el,el),tl.resized&&(tl.resized==="inner"&&this.__onUpdateSize(),this.__hasLocalEvent&&Ho.emitLocal(this),tl.resized=void 0),this.__hasWorldEvent&&Ho.emitWorld(this)},__updateLocalBounds(){const tl=this.__layout;tl.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),tl.resized="inner"),tl.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),tl.localBoxChanged=void 0,tl.strokeSpread&&(tl.strokeChanged=!0),tl.renderSpread&&(tl.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),tl.boxChanged=void 0,tl.strokeChanged&&(tl.strokeSpread=this.__updateStrokeSpread(),tl.strokeSpread?(tl.strokeBounds===tl.boxBounds&&tl.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):tl.spreadStrokeCancel(),tl.strokeChanged=void 0,(tl.renderSpread||tl.strokeSpread!==tl.strokeBoxSpread)&&(tl.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),tl.resized="inner"),tl.renderChanged&&(tl.renderSpread=this.__updateRenderSpread(),tl.renderSpread?(tl.renderBounds!==tl.boxBounds&&tl.renderBounds!==tl.strokeBounds||tl.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):tl.spreadRenderCancel(),tl.renderChanged=void 0,this.parent&&this.parent.__layout.renderChange()),tl.resized||(tl.resized="local"),tl.boundsChanged=void 0},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),Ia(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){Ia(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){Ia(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(tl,el){const il=this.__layout.boxBounds,sl=this.__;sl.__usePathBox?Wa(sl.path,il):(il.x=0,il.y=0,il.width=sl.width,il.height=sl.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.__extraUpdate(),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),Ra(this),Ea(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(Ra(this),Ea(this,this))):La(this)},__updateNaturalSize(){const{__:tl,__layout:el}=this;tl.__naturalWidth=el.boxBounds.width,tl.__naturalHeight=el.boxBounds.height},__updateStrokeBounds(tl){const el=this.__layout;Ma(el.strokeBounds,el.boxBounds,el.strokeBoxSpread)},__updateRenderBounds(tl){const el=this.__layout,{renderSpread:il}=el;o(il)&&il<=0?Aa(el.renderBounds,el.strokeBounds):Ma(el.renderBounds,el.boxBounds,il)}},Ya={__render(tl,el){if(el.shape)return this.__renderShape(tl,el);if((!el.cellList||el.cellList.has(this))&&this.__worldOpacity){const il=this.__;if(il.bright&&!el.topRendering)return el.topList.add(this);if(tl.setWorld(this.__nowWorld=this.__getNowWorld(el)),tl.opacity=el.dimOpacity&&!il.dimskip?il.opacity*el.dimOpacity:il.opacity,this.__.__single){if(il.eraser==="path")return this.__renderEraser(tl,el);const sl=tl.getSameCanvas(!0,!0);this.__draw(sl,el,tl),co.copyCanvasByWorld(this,tl,sl,this.__nowWorld,il.__blendMode,!0),sl.recycle(this.__nowWorld)}else this.__draw(tl,el);ee$2.showBounds&&ee$2.drawBounds(this,tl,el)}},__renderShape(tl,el){this.__worldOpacity&&(tl.setWorld(this.__nowWorld=this.__getNowWorld(el)),this.__drawShape(tl,el))},__clip(tl,el){this.__worldOpacity&&(tl.setWorld(this.__nowWorld=this.__getNowWorld(el)),this.__drawRenderPath(tl),tl.clipUI(this))},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:Da}=xo,{hasSize:Xa}=zt$2,za={__updateChange(){const{__layout:tl}=this;tl.childrenSortChanged&&(this.__updateSortChildren(),tl.childrenSortChanged=!1),this.__.__checkSingle()},__render(tl,el){const il=this.__nowWorld=this.__getNowWorld(el);if(this.__worldOpacity&&Xa(il)){const sl=this.__;if(sl.__useDim)if(sl.dim)el.dimOpacity=sl.dim===!0?.2:sl.dim;else{if(sl.bright&&!el.topRendering)return el.topList.add(this);sl.dimskip&&el.dimOpacity&&(el.dimOpacity=0)}if(sl.__single&&!this.isBranchLeaf){if(sl.eraser==="path")return this.__renderEraser(tl,el);const nl=tl.getSameCanvas(!1,!0);this.__renderBranch(nl,el),tl.opacity=el.dimOpacity?sl.opacity*el.dimOpacity:sl.opacity,tl.copyWorldByReset(nl,il,il,sl.__blendMode,!0),nl.recycle(il)}else this.__renderBranch(tl,el)}},__renderBranch(tl,el){if(this.__hasMask)this.__renderMask(tl,el);else{let il;const{children:sl}=this;for(let nl=0,ol=sl.length;nl<ol;nl++)il=sl[nl],Da(il,el)||(il.__.complex?il.__renderComplex(tl,el):il.__render(tl,el))}},__clip(tl,el){if(this.__worldOpacity){const{children:il}=this;for(let sl=0,nl=il.length;sl<nl;sl++)Da(il[sl],el)||il[sl].__clip(tl,el)}}},Fa={},{LEAF:Ua,create:ja}=g,{stintSet:Va}=_,{toInnerPoint:Ha,toOuterPoint:Ga,multiplyParent:qa}=q$1,{toOuterOf:Qa}=zt$2,{copy:Ja,move:Za}=ot$2,{moveLocal:$a,zoomOfLocal:Ka,rotateOfLocal:th,skewOfLocal:eh,moveWorld:sh,zoomOfWorld:rh,rotateOfWorld:ih,skewOfWorld:nh,transform:oh,transformWorld:ah,setTransform:hh,getFlipTransform:lh,getLocalOrigin:dh,getRelativeWorld:ch,drop:uh}=co;let _h=class{get tag(){return this.__tag}set tag(tl){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return f}get __LayoutProcessor(){return Do}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get scrollWorldTransform(){return this.updateLayout(),this.__scrollWorld||this.__world}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.updateLayout(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){return this.leaferIsCreated&&this.leafer.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(tl){this.on(tl)}constructor(tl){this.innerId=ja(Ua),this.reset(tl),this.__bubbleMap&&this.__emitLifeEvent(zo.CREATED)}reset(tl){this.leafer&&this.leafer.forceRender(this.__world),tl!==0&&(this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},tl!==null&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0})),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),tl&&(tl.__&&(tl=tl.toJSON()),tl.children?this.set(tl):Object.assign(this,tl))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(tl,el){el&&(tl=tl.bind(el)),this.parent?tl():this.on(zo.ADD,tl,"once")}waitLeafer(tl,el){el&&(tl=tl.bind(el)),this.leafer?tl():this.on(zo.MOUNTED,tl,"once")}nextRender(tl,el,il){this.leafer?this.leafer.nextRender(tl,el,il):this.waitLeafer(()=>this.leafer.nextRender(tl,el,il))}removeNextRender(tl){this.nextRender(tl,null,"off")}__bindLeafer(tl){if(this.isLeafer&&tl!==null&&(tl=this),this.leafer&&!tl&&this.leafer.leafs--,this.leafer=tl,tl?(tl.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(zo.MOUNTED)):this.__emitLifeEvent(zo.UNMOUNTED),this.isBranch){const{children:el}=this;for(let il=0,sl=el.length;il<sl;il++)el[il].__bindLeafer(tl)}}set(tl,el){}get(tl){}setAttr(tl,el){this[tl]=el}getAttr(tl){return this[tl]}getComputedAttr(tl){return this.__[tl]}toJSON(tl){return tl&&this.__layout.update(),this.__.__getInputData(null,tl)}toString(tl){return JSON.stringify(this.toJSON(tl))}toSVG(){}__SVG(tl){}toHTML(){}__setAttr(tl,el){return!0}__getAttr(tl){}setProxyAttr(tl,el){}getProxyAttr(tl){}find(tl,el){}findTag(tl){}findOne(tl,el){}findId(tl){}focus(tl){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate(tl){s(tl)?tl="width":tl==="surface"&&(tl="blendMode");const el=this.__.__getInput(tl);this.__[tl]=s(el)?null:void 0,this[tl]=el}forceRender(tl,el){this.forceUpdate("surface")}__extraUpdate(){this.leaferIsReady&&this.leafer.layouter.addExtra(this)}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(tl,el){}__updateContentBounds(){}__updateStrokeBounds(tl){}__updateRenderBounds(tl){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(tl){this.__hasEraser=!!tl||this.children.some(el=>el.__.eraser)}__renderEraser(tl,el){tl.save(),this.__clip(tl,el);const{renderBounds:il}=this.__layout;tl.clearRect(il.x,il.y,il.width,il.height),tl.restore()}__updateMask(tl){this.__hasMask=this.children.some(el=>el.__.mask&&el.__.visible&&el.__.opacity)}__renderMask(tl,el){}__getNowWorld(tl){if(tl.matrix){this.__cameraWorld||(this.__cameraWorld={});const el=this.__cameraWorld,il=this.__world;return qa(il,tl.matrix,el,void 0,il),Qa(this.__layout.renderBounds,el,el),Va(el,"half",il.half),Va(el,"ignorePixelSnap",il.ignorePixelSnap),el}return this.__world}getClampRenderScale(){let{scaleX:tl}=this.__nowWorld||this.__world;return tl<0&&(tl=-tl),tl>1?tl:1}getRenderScaleData(tl,el){let{scaleX:il,scaleY:sl}=en.patternLocked?this.__world:this.__nowWorld;return tl&&(il<0&&(il=-il),sl<0&&(sl=-sl)),(el===!0||el==="zoom-in"&&il>1&&sl>1)&&(il=sl=1),Fa.scaleX=il,Fa.scaleY=sl,Fa}getTransform(tl){return this.__layout.getTransform(tl||"local")}getBounds(tl,el){return this.__layout.getBounds(tl,el)}getLayoutBounds(tl,el,il){return this.__layout.getLayoutBounds(tl,el,il)}getLayoutPoints(tl,el){return this.__layout.getLayoutPoints(tl,el)}getWorldBounds(tl,el,il){const sl=el?ch(this,el):this.worldTransform,nl=il?tl:{};return Qa(tl,sl,nl),nl}worldToLocal(tl,el,il,sl){this.parent?this.parent.worldToInner(tl,el,il,sl):el&&Ja(el,tl)}localToWorld(tl,el,il,sl){this.parent?this.parent.innerToWorld(tl,el,il,sl):el&&Ja(el,tl)}worldToInner(tl,el,il,sl){sl&&(sl.innerToWorld(tl,el,il),tl=el||tl),Ha(this.scrollWorldTransform,tl,el,il)}innerToWorld(tl,el,il,sl){Ga(this.scrollWorldTransform,tl,el,il),sl&&sl.worldToInner(el||tl,null,il)}getBoxPoint(tl,el,il,sl){return this.getBoxPointByInner(this.getInnerPoint(tl,el,il,sl),null,null,!0)}getBoxPointByInner(tl,el,il,sl){const nl=sl?tl:Object.assign({},tl),{x:ol,y:rl}=this.boxBounds;return Za(nl,-ol,-rl),nl}getInnerPoint(tl,el,il,sl){const nl=sl?tl:{};return this.worldToInner(tl,nl,il,el),nl}getInnerPointByBox(tl,el,il,sl){const nl=sl?tl:Object.assign({},tl),{x:ol,y:rl}=this.boxBounds;return Za(nl,ol,rl),nl}getInnerPointByLocal(tl,el,il,sl){return this.getInnerPoint(tl,this.parent,il,sl)}getLocalPoint(tl,el,il,sl){const nl=sl?tl:{};return this.worldToLocal(tl,nl,il,el),nl}getLocalPointByInner(tl,el,il,sl){return this.getWorldPoint(tl,this.parent,il,sl)}getPagePoint(tl,el,il,sl){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(tl,el,il,sl)}getWorldPoint(tl,el,il,sl){const nl=sl?tl:{};return this.innerToWorld(tl,nl,il,el),nl}getWorldPointByBox(tl,el,il,sl){return this.getWorldPoint(this.getInnerPointByBox(tl,null,null,sl),el,il,!0)}getWorldPointByLocal(tl,el,il,sl){const nl=sl?tl:{};return this.localToWorld(tl,nl,il,el),nl}getWorldPointByPage(tl,el,il,sl){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(tl,el,il,sl)}setTransform(tl,el,il){hh(this,tl,el,il)}transform(tl,el,il){oh(this,tl,el,il)}move(tl,el,il){$a(this,tl,el,il)}moveInner(tl,el,il){sh(this,tl,el,!0,il)}scaleOf(tl,el,il,sl,nl){Ka(this,dh(this,tl),el,il,sl,nl)}rotateOf(tl,el,il){th(this,dh(this,tl),el,il)}skewOf(tl,el,il,sl,nl){eh(this,dh(this,tl),el,il,sl,nl)}transformWorld(tl,el,il){ah(this,tl,el,il)}moveWorld(tl,el,il){sh(this,tl,el,!1,il)}scaleOfWorld(tl,el,il,sl,nl){rh(this,tl,el,il,sl,nl)}rotateOfWorld(tl,el){ih(this,tl,el)}skewOfWorld(tl,el,il,sl,nl){nh(this,tl,el,il,sl,nl)}flip(tl,el){oh(this,lh(this,tl),!1,el)}scaleResize(tl,el=tl,il){this.scaleX*=tl,this.scaleY*=el}__scaleResize(tl,el){}resizeWidth(tl){}resizeHeight(tl){}hit(tl,el){return!0}__hitWorld(tl,el){return!0}__hit(tl,el){return!0}__hitFill(tl){return!0}__hitStroke(tl,el){return!0}__hitPixel(tl){return!0}__drawHitPath(tl){}__updateHitCanvas(){}__render(tl,el){}__renderComplex(tl,el){}__drawFast(tl,el){}__draw(tl,el,il){}__clip(tl,el){}__renderShape(tl,el){}__drawShape(tl,el){}__updateWorldOpacity(){}__updateChange(){}__drawPath(tl){}__drawRenderPath(tl){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return he$2.need("path")}getMotionPoint(tl){return he$2.need("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation(tl,el){}__updateSortChildren(){}add(tl,el){}remove(tl,el){this.parent&&this.parent.remove(this,el)}dropTo(tl,el,il){uh(this,tl,el,il)}on(tl,el,il){}off(tl,el,il){}on_(tl,el,il,sl){}off_(tl){}once(tl,el,il,sl){}emit(tl,el,il){}emitEvent(tl,el){}hasEvent(tl,el){return!1}static changeAttr(tl,el,il){il?this.addAttr(tl,el,il):Un(this.prototype,tl,el)}static addAttr(tl,el,il,sl){il||(il=bn),il(el,sl)(this.prototype,tl)}__emitLifeEvent(tl){this.hasEvent(tl)&&this.emitEvent(new zo(tl,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(zo.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}};_h=ye$2([Jn(Ba),Jn(Sa),Jn(Na),Jn(wa),Jn(Ya)],_h);const{setListWithFn:ph}=zt$2,{sort:fh}=vo,{localBoxBounds:gh,localStrokeBounds:yh,localRenderBounds:mh,maskLocalBoxBounds:xh,maskLocalStrokeBounds:wh,maskLocalRenderBounds:bh}=xo,Bh=new ee$2("Branch");let vh=class extends _h{__updateStrokeSpread(){const{children:tl}=this;for(let el=0,il=tl.length;el<il;el++)if(tl[el].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:tl}=this;for(let el=0,il=tl.length;el<il;el++)if(tl[el].__layout.renderSpread)return 1;return 0}__updateBoxBounds(tl,el){ph(el||this.__layout.boxBounds,this.children,this.__hasMask?xh:gh)}__updateStrokeBounds(tl){ph(tl||this.__layout.strokeBounds,this.children,this.__hasMask?wh:yh)}__updateRenderBounds(tl){ph(tl||this.__layout.renderBounds,this.children,this.__hasMask?bh:mh)}__updateSortChildren(){let tl;const{children:el}=this;if(el.length>1){for(let il=0,sl=el.length;il<sl;il++)el[il].__tempNumber=il,el[il].__.zIndex&&(tl=!0);el.sort(fh),this.__layout.affectChildrenSort=tl}}add(tl,el){if(tl===this||tl.destroyed)return Bh.warn("add self or destroyed");const il=s(el);if(!tl.__){if(l(tl))return tl.forEach(nl=>{this.add(nl,el),il||el++});if(!(tl=ce$2.get(tl.tag,tl)))return}tl.parent&&tl.parent.remove(tl),tl.parent=this,il?this.children.push(tl):this.children.splice(el,0,tl),tl.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1);const sl=tl.__layout;sl.boxChanged||sl.boxChange(),sl.matrixChanged||sl.matrixChange(),tl.__bubbleMap&&tl.__emitLifeEvent(zo.ADD),this.leafer&&(tl.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(zo.ADD,tl)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...tl){this.add(tl)}remove(tl,el){tl?tl.__?tl.animationOut?tl.__runAnimation("out",()=>this.__remove(tl,el)):this.__remove(tl,el):this.find(tl).forEach(il=>this.remove(il,el)):s(tl)&&super.remove(null,el)}removeAll(tl){const{children:el}=this;el.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,el.forEach(il=>{this.__realRemoveChild(il),tl&&il.destroy()}))}clear(){this.removeAll(!0)}__remove(tl,el){const il=this.children.indexOf(tl);il>-1&&(this.children.splice(il,1),tl.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(tl),el&&tl.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(tl){tl.__emitLifeEvent(zo.REMOVE),tl.parent=null,this.leafer&&(tl.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(zo.REMOVE,tl),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(tl,el){const il=new zo(tl,el,this);this.hasEvent(tl)&&!this.isLeafer&&this.emitEvent(il),this.leafer.emitEvent(il)}};vh=ye$2([Jn(za)],vh);class kh{get length(){return this.list.length}constructor(el){this.reset(),el&&(l(el)?this.addList(el):this.add(el))}has(el){return el&&!s(this.keys[el.innerId])}indexAt(el){return this.list[el]}indexOf(el){const il=this.keys[el.innerId];return s(il)?-1:il}add(el){const{list:il,keys:sl}=this;s(sl[el.innerId])&&(il.push(el),sl[el.innerId]=il.length-1)}addAt(el,il=0){const{keys:sl}=this;if(s(sl[el.innerId])){const{list:nl}=this;for(let ol=il,rl=nl.length;ol<rl;ol++)sl[nl[ol].innerId]++;il===0?nl.unshift(el):(il>nl.length&&(il=nl.length),nl.splice(il,0,el)),sl[el.innerId]=il}}addList(el){for(let il=0;il<el.length;il++)this.add(el[il])}remove(el){const{list:il}=this;let sl;for(let nl=0,ol=il.length;nl<ol;nl++)s(sl)?il[nl].innerId===el.innerId&&(sl=nl,delete this.keys[el.innerId]):this.keys[il[nl].innerId]=nl-1;s(sl)||il.splice(sl,1)}sort(el){const{list:il}=this;el?il.sort((sl,nl)=>nl.__level-sl.__level):il.sort((sl,nl)=>sl.__level-nl.__level)}forEach(el){this.list.forEach(el)}clone(){const el=new kh;return el.list=[...this.list],el.keys=Object.assign({},this.keys),el}update(){this.keys={};const{list:el,keys:il}=this;for(let sl=0,nl=el.length;sl<nl;sl++)il[el[sl].innerId]=sl}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class Ch{get length(){return this._length}constructor(el){this._length=0,this.reset(),el&&(l(el)?this.addList(el):this.add(el))}has(el){return!s(this.keys[el.innerId])}without(el){return s(this.keys[el.innerId])}sort(el){const{levels:il}=this;el?il.sort((sl,nl)=>nl-sl):il.sort((sl,nl)=>sl-nl)}addList(el){el.forEach(il=>{this.add(il)})}add(el){const{keys:il,levelMap:sl}=this;il[el.innerId]||(il[el.innerId]=1,sl[el.__level]?sl[el.__level].push(el):(sl[el.__level]=[el],this.levels.push(el.__level)),this._length++)}forEach(el){let il;this.levels.forEach(sl=>{il=this.levelMap[sl];for(let nl=0,ol=il.length;nl<ol;nl++)el(il[nl])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const Oh="2.0.2";function St$2(tl,el,il,sl){var nl,ol=arguments.length,rl=ol<3?el:sl===null?sl=Object.getOwnPropertyDescriptor(el,il):sl;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")rl=Reflect.decorate(tl,el,il,sl);else for(var al=tl.length-1;al>=0;al--)(nl=tl[al])&&(rl=(ol<3?nl(rl):ol>3?nl(el,il,rl):nl(el,il))||rl);return ol>3&&rl&&Object.defineProperty(el,il,rl),rl}function mt$2(tl){return un(tl,el=>({set(il){this.__setAttr(el,il),il&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Rt$2(tl){return un(tl,el=>({set(il){this.__setAttr(el,il),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function kt$2(){return(tl,el)=>{const il="_"+el;ln(tl,el,{set(sl){this.isLeafer&&(this[il]=sl)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[il]||this:this.leafer&&this.leafer.zoomLayer}})}}function Bt$2(tl){return(el,il)=>{ln(el,il,cn(il,tl))}}const At$2={},Ct$2={hasTransparent:function(tl){if(!tl||tl.length===7||tl.length===4)return!1;if(tl==="transparent")return!0;const el=tl[0];if(el==="#")switch(tl.length){case 5:return tl[4]!=="f"&&tl[4]!=="F";case 9:return tl[7]!=="f"&&tl[7]!=="F"||tl[8]!=="f"&&tl[8]!=="F"}else if((el==="r"||el==="h")&&tl[3]==="a"){const il=tl.lastIndexOf(",");if(il>-1)return parseFloat(tl.slice(il+1))<1}return!1}},bt$2=qt$2,Pt$2={},Ft$2={},Wt$2={},Et$2={},Tt$2={},Dt$2={apply(){he$2.need("filter")}},It$2={},Lt$2={setStyleName:()=>he$2.need("state"),set:()=>he$2.need("state")},zt$1={list:{},register(tl,el){zt$1.list[tl]=el},get:tl=>zt$1.list[tl]},{parse:Mt$2,objectToCanvasData:Ot$2}=sr,{stintSet:Nt$2}=_,{hasTransparent:Vt$2}=Ct$2,Ht$2={originPaint:{}},Yt$2=ee$2.get("UIData");let Ut$2=class extends f{get scale(){const{scaleX:tl,scaleY:el}=this;return tl!==el?{x:tl,y:el}:tl}get __strokeWidth(){return this.__getRealStrokeWidth()}get __maxStrokeWidth(){const tl=this;return tl.__hasMultiStrokeStyle?Math.max(tl.__hasMultiStrokeStyle,tl.strokeWidth):tl.strokeWidth}get __hasMultiPaint(){const tl=this;return tl.fill&&this.__useStroke||tl.__isFills&&tl.fill.length>1||tl.__isStrokes&&tl.stroke.length>1||tl.__useEffect}get __clipAfterFill(){const tl=this;return tl.cornerRadius||tl.innerShadow||tl.__pathInputed}get __hasSurface(){return this.fill||this.stroke}get __autoWidth(){return this._width==null}get __autoHeight(){return this._height==null}get __autoSide(){return this._width==null||this._height==null}get __autoSize(){return this._width==null&&this._height==null}setVisible(tl){this._visible=tl;const{leafer:el}=this.__leaf;el&&(el.watcher.hasVisible=!0)}setWidth(tl){tl<0?(this._width=-tl,this.__leaf.scaleX*=-1,Yt$2.warn("width < 0, instead -scaleX ",this)):this._width=tl}setHeight(tl){tl<0?(this._height=-tl,this.__leaf.scaleY*=-1,Yt$2.warn("height < 0, instead -scaleY",this)):this._height=tl}setFill(tl){this.__naturalWidth&&this.__removeNaturalSize(),i(tl)||!tl?(Nt$2(this,"__isTransparentFill",Vt$2(tl)),this.__isFills&&this.__removePaint("fill",!0),this._fill=tl):d(tl)&&this.__setPaint("fill",tl)}setStroke(tl){i(tl)||!tl?(Nt$2(this,"__isTransparentStroke",Vt$2(tl)),this.__isStrokes&&this.__removePaint("stroke",!0),this._stroke=tl):d(tl)&&this.__setPaint("stroke",tl)}setPath(tl){const el=i(tl);el||tl&&d(tl[0])?(this.__setInput("path",tl),this._path=el?Mt$2(tl):Ot$2(tl)):(this.__input&&this.__removeInput("path"),this._path=tl)}setShadow(tl){Xt$2(this,"shadow",tl)}setInnerShadow(tl){Xt$2(this,"innerShadow",tl)}setFilter(tl){Xt$2(this,"filter",tl)}__computePaint(){const{fill:tl,stroke:el}=this.__input;tl&&Ft$2.compute("fill",this.__leaf),el&&Ft$2.compute("stroke",this.__leaf),this.__needComputePaint=void 0}__getRealStrokeWidth(tl){let{strokeWidth:el,strokeWidthFixed:il}=this;if(tl&&(tl.strokeWidth&&(el=tl.strokeWidth),s(tl.strokeWidthFixed)||(il=tl.strokeWidthFixed)),il){const sl=this.__leaf.getClampRenderScale();return sl>1?el/sl:el}return el}__setPaint(tl,el){this.__setInput(tl,el);const il=this.__leaf.__layout;il.boxChanged||il.boxChange(),l(el)&&!el.length?this.__removePaint(tl):tl==="fill"?(this.__isFills=!0,this._fill||(this._fill=Ht$2)):(this.__isStrokes=!0,this._stroke||(this._stroke=Ht$2))}__removePaint(tl,el){el&&this.__removeInput(tl),Wt$2.recycleImage(tl,this),tl==="fill"?(Nt$2(this,"__isAlphaPixelFill",void 0),this._fill=this.__isFills=void 0):(Nt$2(this,"__isAlphaPixelStroke",void 0),Nt$2(this,"__hasMultiStrokeStyle",void 0),this._stroke=this.__isStrokes=void 0)}};function Xt$2(tl,el,il){tl.__setInput(el,il),l(il)?(il.some(sl=>sl.visible===!1)&&(il=il.filter(sl=>sl.visible!==!1)),il.length||(il=void 0)):il=il&&il.visible!==!1?[il]:void 0,tl["_"+el]=il}let jt$2=class extends Ut$2{},Jt$1=class extends jt$2{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return this.__single||this.__clipAfterFill}get __clipAfterFill(){const tl=this;return tl.overflow!=="show"&&tl.__leaf.children.length&&(tl.__leaf.isOverflow||super.__clipAfterFill)}},qt$1=class extends jt$2{__getInputData(tl,el){const il=super.__getInputData(tl,el);return Re$2.forEach(sl=>delete il[sl]),il}},Gt$1=class extends Jt$1{},$t$1=class extends Ut$2{get __usePathBox(){return this.points||this.__pathInputed}},Kt$2=class extends Ut$2{get __boxStroke(){return!this.__pathInputed}},Qt$1=class extends Ut$2{get __boxStroke(){return!this.__pathInputed}},Zt$1=class extends $t$1{},te$1=class extends Ut$2{},ee$1=class extends Ut$2{get __pathInputed(){return 2}},ie$1=class extends jt$2{};const se$1={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};let oe$1=class extends Ut$2{get __useNaturalRatio(){return!1}setFontWeight(tl){i(tl)?(this.__setInput("fontWeight",tl),tl=se$1[tl]||400):this.__input&&this.__removeInput("fontWeight"),this._fontWeight=tl}setBoxStyle(tl){let el=this.__leaf,il=el.__box;if(tl){const{boxStyle:sl}=this;if(il)for(let rl in sl)il[rl]=void 0;else il=el.__box=ce$2.get("Rect",0);const nl=el.__layout,ol=il.__layout;sl||(il.parent=el,il.__world=el.__world,ol.boxBounds=nl.boxBounds),il.set(tl),ol.strokeChanged&&nl.strokeChange()}else il&&(el.__box=il.parent=null,il.destroy());this._boxStyle=tl}__getInputData(tl,el){const il=super.__getInputData(tl,el);return il.textEditing&&delete il.textEditing,il}},re$1=class extends Kt$2{get __urlType(){return"image"}setUrl(tl){this.__setImageFill(tl),this._url=tl}__setImageFill(tl){this.fill=tl?{type:this.__urlType,mode:"stretch",url:tl}:void 0}__getData(){const tl=super.__getData();return tl.url&&delete tl.fill,tl}__getInputData(tl,el){const il=super.__getInputData(tl,el);return il.url&&delete il.fill,il}},ae$1=class extends Kt$2{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(tl,el){const il=super.__getInputData(tl,el);return il.url=this.__leaf.canvas.toDataURL("image/png"),il}};const{max:ne$1,add:_e$1}=v,he$1={__updateStrokeSpread(){let tl=0,el=0;const il=this.__,{strokeAlign:sl,__maxStrokeWidth:nl}=il,ol=this.__box;if((il.stroke||il.hitStroke==="all")&&nl&&sl!=="inside"&&(el=tl=sl==="center"?nl/2:nl,!il.__boxStroke)){const rl=il.__isLinePath?0:10*tl,al=il.strokeCap==="none"?0:nl;tl+=Math.max(rl,al)}return il.__useArrow&&(tl+=5*nl),ol&&(tl=ne$1(tl,ol.__layout.strokeSpread=ol.__updateStrokeSpread()),el=Math.max(el,ol.__layout.strokeBoxSpread)),this.__layout.strokeBoxSpread=el,tl},__updateRenderSpread(){let tl=0;const{shadow:el,innerShadow:il,blur:sl,backgroundBlur:nl,filter:ol,renderSpread:rl}=this.__,{strokeSpread:al}=this.__layout,ll=this.__box;el&&(tl=Tt$2.getShadowRenderSpread(this,el)),sl&&(tl=ne$1(tl,sl)),ol&&(tl=_e$1(tl,Dt$2.getSpread(ol))),rl&&(tl=_e$1(tl,rl)),al&&(tl=_e$1(tl,al));let cl=tl;return il&&(cl=ne$1(cl,Tt$2.getInnerShadowSpread(this,il))),nl&&(cl=ne$1(cl,nl)),this.__layout.renderShapeSpread=cl,ll?ne$1(ll.__updateRenderSpread(),tl):tl}},{stintSet:de$1}=_,le$1={__updateChange(){const tl=this.__;if(tl.__useStroke){const el=tl.__useStroke=!(!tl.stroke||!tl.strokeWidth);de$1(this.__world,"half",el&&tl.strokeAlign==="center"&&tl.strokeWidth%2),de$1(tl,"__fillAfterStroke",el&&tl.strokeAlign==="outside"&&tl.fill&&!tl.__isTransparentFill)}if(tl.__useEffect){const{shadow:el,fill:il,stroke:sl}=tl,nl=tl.innerShadow||tl.blur||tl.backgroundBlur||tl.filter;de$1(tl,"__isFastShadow",el&&!nl&&el.length<2&&!el[0].spread&&!Tt$2.isTransformShadow(el[0])&&il&&!tl.__isTransparentFill&&!(l(il)&&il.length>1)&&(this.useFastShadow||!sl||sl&&tl.strokeAlign==="inside")),tl.__useEffect=!(!el&&!nl)}tl.__checkSingle(),de$1(tl,"__complex",tl.__isFills||tl.__isStrokes||tl.cornerRadius||tl.__useEffect)},__drawFast(tl,el){pe$1(this,tl,el)},__draw(tl,el,il){const sl=this.__;if(sl.__complex){sl.__needComputePaint&&sl.__computePaint();const{fill:nl,stroke:ol,__drawAfterFill:rl,__fillAfterStroke:al,__isFastShadow:ll}=sl;if(this.__drawRenderPath(tl),sl.__useEffect&&!ll){const cl=Ft$2.shape(this,tl,el);this.__nowWorld=this.__getNowWorld(el);const{shadow:ul,innerShadow:dl,filter:fl}=sl;ul&&Tt$2.shadow(this,tl,cl),al&&(sl.__isStrokes?Ft$2.strokes(ol,this,tl,el):Ft$2.stroke(ol,this,tl,el)),nl&&(sl.__isFills?Ft$2.fills(nl,this,tl,el):Ft$2.fill(nl,this,tl,el)),rl&&this.__drawAfterFill(tl,el),dl&&Tt$2.innerShadow(this,tl,cl),ol&&!al&&(sl.__isStrokes?Ft$2.strokes(ol,this,tl,el):Ft$2.stroke(ol,this,tl,el)),fl&&Dt$2.apply(fl,this,this.__nowWorld,tl,il,cl),cl.worldCanvas&&cl.worldCanvas.recycle(),cl.canvas.recycle()}else{if(al&&(sl.__isStrokes?Ft$2.strokes(ol,this,tl,el):Ft$2.stroke(ol,this,tl,el)),ll){const cl=sl.shadow[0],{scaleX:ul,scaleY:dl}=this.getRenderScaleData(!0,cl.scaleFixed);tl.save(),tl.setWorldShadow(cl.x*ul,cl.y*dl,cl.blur*ul,Ct$2.string(cl.color))}nl&&(sl.__isFills?Ft$2.fills(nl,this,tl,el):Ft$2.fill(nl,this,tl,el)),ll&&tl.restore(),rl&&this.__drawAfterFill(tl,el),ol&&!al&&(sl.__isStrokes?Ft$2.strokes(ol,this,tl,el):Ft$2.stroke(ol,this,tl,el))}}else sl.__pathForRender?pe$1(this,tl,el):this.__drawFast(tl,el)},__drawShape(tl,el){this.__drawRenderPath(tl);const il=this.__,{fill:sl,stroke:nl}=il;sl&&!el.ignoreFill&&(il.__isAlphaPixelFill?Ft$2.fills(sl,this,tl,el):Ft$2.fill("#000000",this,tl,el)),il.__isCanvas&&this.__drawAfterFill(tl,el),nl&&!el.ignoreStroke&&(il.__isAlphaPixelStroke?Ft$2.strokes(nl,this,tl,el):Ft$2.stroke("#000000",this,tl,el))},__drawAfterFill(tl,el){this.__.__clipAfterFill?(tl.save(),tl.clipUI(this),this.__drawContent(tl,el),tl.restore()):this.__drawContent(tl,el)}};function pe$1(tl,el,il){const{fill:sl,stroke:nl,__drawAfterFill:ol,__fillAfterStroke:rl}=tl.__;tl.__drawRenderPath(el),rl&&Ft$2.stroke(nl,tl,el,il),sl&&Ft$2.fill(sl,tl,el,il),ol&&tl.__drawAfterFill(el,il),nl&&!rl&&Ft$2.stroke(nl,tl,el,il)}const ue$1={__drawFast(tl,el){let{x:il,y:sl,width:nl,height:ol}=this.__layout.boxBounds;const{fill:rl,stroke:al,__drawAfterFill:ll}=this.__;if(rl&&(tl.fillStyle=rl,tl.fillRect(il,sl,nl,ol)),ll&&this.__drawAfterFill(tl,el),al){const{strokeAlign:cl,__strokeWidth:ul}=this.__;if(!ul)return;tl.setStroke(al,ul,this.__);const dl=ul/2;switch(cl){case"center":tl.strokeRect(0,0,nl,ol);break;case"inside":nl-=ul,ol-=ul,nl<0||ol<0?(tl.save(),this.__clip(tl,el),tl.strokeRect(il+dl,sl+dl,nl,ol),tl.restore()):tl.strokeRect(il+dl,sl+dl,nl,ol);break;case"outside":tl.strokeRect(il-dl,sl-dl,nl+ul,ol+ul)}}}};var ce$1;let ge$1=ce$1=class extends _h{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(tl){I$1.assignScale(this,tl)}get scale(){return this.__.scale}get isAutoWidth(){const tl=this.__;return tl.__autoWidth||tl.autoWidth}get isAutoHeight(){const tl=this.__;return tl.__autoHeight||tl.autoHeight}get pen(){const{path:tl}=this.__;return ji$1.set(this.path=tl||[]),tl||this.__drawPathByBox(ji$1),ji$1}reset(tl){}set(tl,el){tl&&Object.assign(this,tl)}get(tl){return i(tl)?this.__.__getInput(tl):this.__.__getInputData(tl)}createProxyData(){}find(tl,el){return he$2.need("find")}findTag(tl){return this.find({tag:tl})}findOne(tl,el){return he$2.need("find")}findId(tl){return this.findOne({id:tl})}getPath(tl,el){this.__layout.update();let il=el?this.__.__pathForRender:this.__.path;return il||(ji$1.set(il=[]),this.__drawPathByBox(ji$1,!el)),tl?sr.toCanvasData(il,!0):il}getPathString(tl,el,il){return sr.stringify(this.getPath(tl,el),il)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const tl=this.__;!tl.lazy||this.__inLazyBounds||It$2.running?tl.__computePaint():tl.__needComputePaint=!0}}__updateRenderPath(){const tl=this.__;tl.path?(tl.__pathForRender=tl.cornerRadius?Fi$1.smooth(tl.path,tl.cornerRadius,tl.cornerSmoothing):tl.path,tl.__useArrow&&Pt$2.addArrows(this)):tl.__pathForRender&&(tl.__pathForRender=void 0)}__drawRenderPath(tl){tl.beginPath(),this.__drawPathByData(tl,this.__.__pathForRender)}__drawPath(tl){tl.beginPath(),this.__drawPathByData(tl,this.__.path,!0)}__drawPathByData(tl,el,il){el?ri$2.drawPathByData(tl,el):this.__drawPathByBox(tl,il)}__drawPathByBox(tl,el){const{x:il,y:sl,width:nl,height:ol}=this.__layout.boxBounds;if(this.__.cornerRadius&&!el){const{cornerRadius:rl}=this.__;tl.roundRect(il,sl,nl,ol,o(rl)?[rl]:rl)}else tl.rect(il,sl,nl,ol);tl.closePath()}drawImagePlaceholder(tl,el,il){Ft$2.fill(this.__.placeholderColor,this,el,il)}animate(tl,el,il,sl){return this.set(tl),he$2.need("animate")}killAnimate(tl,el){}export(tl,el){return he$2.need("export")}syncExport(tl,el){return he$2.need("export")}clone(tl){const el=_.clone(this.toJSON());return tl&&Object.assign(el,tl),ce$1.one(el)}static one(tl,el,il,sl,nl){return ce$2.get(tl.tag||this.prototype.__tag,tl,el,il,sl,nl)}static registerUI(){Zn()(this)}static registerData(tl){zn(tl)(this.prototype)}static setEditConfig(tl){}static setEditOuter(tl){}static setEditInner(tl){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}};St$2([zn(Ut$2)],ge$1.prototype,"__",void 0),St$2([kt$2()],ge$1.prototype,"zoomLayer",void 0),St$2([fn("")],ge$1.prototype,"id",void 0),St$2([fn("")],ge$1.prototype,"name",void 0),St$2([fn("")],ge$1.prototype,"className",void 0),St$2([Ln("pass-through")],ge$1.prototype,"blendMode",void 0),St$2([En(1)],ge$1.prototype,"opacity",void 0),St$2([In(!0)],ge$1.prototype,"visible",void 0),St$2([Ln(!1)],ge$1.prototype,"locked",void 0),St$2([Rn(!1)],ge$1.prototype,"dim",void 0),St$2([Rn(!1)],ge$1.prototype,"dimskip",void 0),St$2([Wn(0)],ge$1.prototype,"zIndex",void 0),St$2([Nn(!1)],ge$1.prototype,"mask",void 0),St$2([Yn(!1)],ge$1.prototype,"eraser",void 0),St$2([gn(0,!0)],ge$1.prototype,"x",void 0),St$2([gn(0,!0)],ge$1.prototype,"y",void 0),St$2([bn(100,!0)],ge$1.prototype,"width",void 0),St$2([bn(100,!0)],ge$1.prototype,"height",void 0),St$2([xn(1,!0)],ge$1.prototype,"scaleX",void 0),St$2([xn(1,!0)],ge$1.prototype,"scaleY",void 0),St$2([wn(0,!0)],ge$1.prototype,"rotation",void 0),St$2([wn(0,!0)],ge$1.prototype,"skewX",void 0),St$2([wn(0,!0)],ge$1.prototype,"skewY",void 0),St$2([gn(0,!0)],ge$1.prototype,"offsetX",void 0),St$2([gn(0,!0)],ge$1.prototype,"offsetY",void 0),St$2([yn(0,!0)],ge$1.prototype,"scrollX",void 0),St$2([yn(0,!0)],ge$1.prototype,"scrollY",void 0),St$2([mn()],ge$1.prototype,"origin",void 0),St$2([mn()],ge$1.prototype,"around",void 0),St$2([fn(!1)],ge$1.prototype,"lazy",void 0),St$2([Bn(1)],ge$1.prototype,"pixelRatio",void 0),St$2([Sn(0)],ge$1.prototype,"renderSpread",void 0),St$2([kn()],ge$1.prototype,"path",void 0),St$2([Cn()],ge$1.prototype,"windingRule",void 0),St$2([Cn(!0)],ge$1.prototype,"closed",void 0),St$2([bn(0)],ge$1.prototype,"padding",void 0),St$2([bn(!1)],ge$1.prototype,"lockRatio",void 0),St$2([bn()],ge$1.prototype,"widthRange",void 0),St$2([bn()],ge$1.prototype,"heightRange",void 0),St$2([fn(!1)],ge$1.prototype,"draggable",void 0),St$2([fn()],ge$1.prototype,"dragBounds",void 0),St$2([fn("auto")],ge$1.prototype,"dragBoundsType",void 0),St$2([fn(!1)],ge$1.prototype,"editable",void 0),St$2([Dn(!0)],ge$1.prototype,"hittable",void 0),St$2([Dn("path")],ge$1.prototype,"hitFill",void 0),St$2([Pn("path")],ge$1.prototype,"hitStroke",void 0),St$2([Dn(!1)],ge$1.prototype,"hitBox",void 0),St$2([Dn(!0)],ge$1.prototype,"hitChildren",void 0),St$2([Dn(!0)],ge$1.prototype,"hitSelf",void 0),St$2([Dn()],ge$1.prototype,"hitRadius",void 0),St$2([Xn("")],ge$1.prototype,"cursor",void 0),St$2([Ln()],ge$1.prototype,"fill",void 0),St$2([Pn(void 0,!0)],ge$1.prototype,"stroke",void 0),St$2([Pn("inside")],ge$1.prototype,"strokeAlign",void 0),St$2([Pn(1,!0)],ge$1.prototype,"strokeWidth",void 0),St$2([Pn(!1)],ge$1.prototype,"strokeWidthFixed",void 0),St$2([Pn("none")],ge$1.prototype,"strokeCap",void 0),St$2([Pn("miter")],ge$1.prototype,"strokeJoin",void 0),St$2([Pn()],ge$1.prototype,"dashPattern",void 0),St$2([Pn(0)],ge$1.prototype,"dashOffset",void 0),St$2([Pn(10)],ge$1.prototype,"miterLimit",void 0),St$2([Cn(0)],ge$1.prototype,"cornerRadius",void 0),St$2([Cn()],ge$1.prototype,"cornerSmoothing",void 0),St$2([mt$2()],ge$1.prototype,"shadow",void 0),St$2([mt$2()],ge$1.prototype,"innerShadow",void 0),St$2([mt$2()],ge$1.prototype,"blur",void 0),St$2([mt$2()],ge$1.prototype,"backgroundBlur",void 0),St$2([mt$2()],ge$1.prototype,"grayscale",void 0),St$2([mt$2()],ge$1.prototype,"filter",void 0),St$2([Ln()],ge$1.prototype,"placeholderColor",void 0),St$2([fn(100)],ge$1.prototype,"placeholderDelay",void 0),St$2([fn({})],ge$1.prototype,"data",void 0),St$2([Gn(_h.prototype.reset)],ge$1.prototype,"reset",null),ge$1=ce$1=St$2([Jn(he$1),Jn(le$1),qn()],ge$1);let ye$1=class extends ge$1{get __tag(){return"Group"}get isBranch(){return!0}reset(tl){this.__setBranch(),super.reset(tl)}__setBranch(){this.children||(this.children=[])}set(tl,el){if(tl)if(tl.children){const{children:il}=tl;delete tl.children,this.children?this.clear():this.__setBranch(),super.set(tl,el),il.forEach(sl=>this.add(sl)),tl.children=il}else super.set(tl,el)}toJSON(tl){const el=super.toJSON(tl);if(!this.childlessJSON){const il=el.children=[];this.children.forEach(sl=>sl.skipJSON||il.push(sl.toJSON(tl)))}return el}pick(tl,el){}addAt(tl,el){this.add(tl,el)}addAfter(tl,el){this.add(tl,this.children.indexOf(el)+1)}addBefore(tl,el){this.add(tl,this.children.indexOf(el))}add(tl,el){}addMany(...tl){}remove(tl,el){}removeAll(tl){}clear(){}};var ve$1;St$2([zn(jt$2)],ye$1.prototype,"__",void 0),St$2([bn(0)],ye$1.prototype,"width",void 0),St$2([bn(0)],ye$1.prototype,"height",void 0),ye$1=St$2([Jn(vh),Zn()],ye$1);const fe$1=ee$2.get("Leafer");let we$1=ve$1=class extends ye$1{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&Ki$1.isComplete}get layoutLocked(){return!this.layouter.running}get view(){return this.canvas&&this.canvas.view}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds(!0)||D()}constructor(tl,el){super(el),this.config={start:!0,hittable:!0,smooth:!0,lazySpeard:100},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=tl,tl&&(tl.view||tl.width)&&this.init(tl),ve$1.list.add(this)}init(tl,el){if(this.canvas)return;let il;const{config:sl}=this;this.__setLeafer(this),el&&(this.parentApp=el,this.__bindApp(el),il=el.running),tl&&(this.parent=el,this.initType(tl.type),this.parent=void 0,_.assign(sl,tl));const nl=this.canvas=le$2.canvas(sl);this.__controllers.push(this.renderer=le$2.renderer(this,nl,sl),this.watcher=le$2.watcher(this,sl),this.layouter=le$2.layouter(this,sl)),this.isApp&&this.__setApp(),this.__checkAutoLayout(),el||(this.selector=le$2.selector(this),this.interaction=le$2.interaction(this,nl,this.selector,sl),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=le$2.hitCanvasManager()),this.canvasManager=new ge$2,il=sl.start),this.hittable=sl.hittable,this.fill=sl.fill,this.canvasManager.add(nl),this.__listenEvents(),il&&(this.__startTimer=setTimeout(this.start.bind(this))),So.run(this.__initWait),this.onInit()}onInit(){}initType(tl){}set(tl,el){this.waitInit(()=>{super.set(tl,el)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(sa.RESTART):this.emitLeafer(sa.START),this.__controllers.forEach(tl=>tl.start()),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach(tl=>tl.stop()),this.running=!1,this.emitLeafer(sa.STOP))}unlockLayout(tl=!0){this.layouter.start(),tl&&this.updateLayout()}lockLayout(tl=!0){tl&&this.updateLayout(),this.layouter.stop()}resize(tl){const el=_.copyAttrs({},tl,Re$2);Object.keys(el).forEach(il=>this[il]=el[il])}forceRender(tl,el){const{renderer:il}=this;il&&(il.addBlock(tl?new Vt$3(tl):this.canvas.bounds),this.viewReady&&(el?il.render():il.update()))}requestRender(tl=!1){this.renderer&&this.renderer.update(tl)}updateCursor(tl){const el=this.interaction;el&&(tl?el.setCursor(tl):el.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(tl){const{canvas:el}=this;if(!el||el.isSameSize(tl))return;const il=_.copyAttrs({},this.canvas,Re$2);el.resize(tl),this.updateLazyBounds(),this.__onResize(new $o(tl,il))}__onResize(tl){this.emitEvent(tl),_.copyAttrs(this.__,tl,Re$2),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp(tl){this.selector=tl.selector,this.interaction=tl.interaction,this.canvasManager=tl.canvasManager,this.hitCanvasManager=tl.hitCanvasManager}__setLeafer(tl){this.leafer=tl,this.__level=1}__checkAutoLayout(){const{config:tl,parentApp:el}=this;el||(tl.width&&tl.height||(this.autoLayout=new Gt$2(tl)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(tl,el){return this.canvas&&(Re$2.includes(tl)?this.__changeCanvasSize(tl,el):tl==="fill"?this.__changeFill(el):tl==="hittable"?this.parent||(this.canvas.hittable=el):tl==="zIndex"?(this.canvas.zIndex=el,setTimeout(()=>this.parent&&this.parent.__updateSortChildren())):tl==="mode"&&this.emit(sa.UPDATE_MODE,{mode:el})),super.__setAttr(tl,el)}__getAttr(tl){return this.canvas&&Re$2.includes(tl)?this.canvas[tl]:super.__getAttr(tl)}__changeCanvasSize(tl,el){const{config:il,canvas:sl}=this,nl=_.copyAttrs({},sl,Re$2);nl[tl]=il[tl]=el,il.width&&il.height?sl.stopAutoLayout():this.__checkAutoLayout(),this.__doResize(nl)}__changeFill(tl){this.config.fill=tl,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=tl:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready=!0,this.emitLeafer(sa.BEFORE_READY),this.emitLeafer(sa.READY),this.emitLeafer(sa.AFTER_READY),So.run(this.__readyWait)}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(sa.VIEW_READY),So.run(this.__viewReadyWait))}__onLayoutEnd(){const{grow:tl,width:el,height:il}=this.config;if(tl){let{width:sl,height:nl,pixelRatio:ol}=this;const rl=tl==="box"?this.worldBoxBounds:this.__world;el||(sl=Math.max(1,rl.x+rl.width)),il||(nl=Math.max(1,rl.y+rl.height)),this.__doResize({width:sl,height:nl,pixelRatio:ol})}this.ready||this.__onReady()}__onNextRender(){if(this.viewReady){So.run(this.__nextRenderWait);const{imageReady:tl}=this;tl&&!this.viewCompleted&&this.__checkViewCompleted(),tl||(this.viewCompleted=!1,this.requestRender())}else this.requestRender()}__checkViewCompleted(tl=!0){this.nextRender(()=>{this.imageReady&&(tl&&this.emitLeafer(sa.VIEW_COMPLETED),So.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit(tl,el){el&&(tl=tl.bind(el)),this.__initWait||(this.__initWait=[]),this.canvas?tl():this.__initWait.push(tl)}waitReady(tl,el){el&&(tl=tl.bind(el)),this.ready?tl():this.__readyWait.push(tl)}waitViewReady(tl,el){el&&(tl=tl.bind(el)),this.viewReady?tl():this.__viewReadyWait.push(tl)}waitViewCompleted(tl,el){el&&(tl=tl.bind(el)),this.__viewCompletedWait.push(tl),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(tl,el,il){el&&(tl=tl.bind(el));const sl=this.__nextRenderWait;if(il){for(let nl=0;nl<sl.length;nl++)if(sl[nl]===tl){sl.splice(nl,1);break}}else sl.push(tl);this.requestRender()}zoom(tl,el,il,sl){return he$2.need("view")}getValidMove(tl,el,il){return{x:tl,y:el}}getValidScale(tl){return tl}getWorldPointByClient(tl,el){return this.interaction&&this.interaction.getLocal(tl,el)}getPagePointByClient(tl,el){return this.getPagePoint(this.getWorldPointByClient(tl,el))}getClientPointByWorld(tl){const{x:el,y:il}=this.clientBounds;return{x:el+tl.x,y:il+tl.y}}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(tl){}emitLeafer(tl){this.emitEvent(new sa(tl,this))}__listenEvents(){const tl=ne$2.start("FirstCreate "+this.innerName);this.once([[sa.START,()=>ne$2.end(tl)],[ta.START,this.updateLazyBounds,this],[ea.START,this.__onCreated,this],[ea.END,this.__onViewReady,this]]),this.__eventIds.push(this.on_([[Ko.DATA,this.__onWatchData,this],[ta.END,this.__onLayoutEnd,this],[ea.NEXT,this.__onNextRender,this]]))}__removeListenEvents(){this.off_(this.__eventIds)}destroy(tl){const el=()=>{if(!this.destroyed){ve$1.list.remove(this);try{this.stop(),this.emitLeafer(sa.END),this.__removeListenEvents(),this.__controllers.forEach(il=>!(this.parent&&il===this.interaction)&&il.destroy()),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager&&this.canvasManager.destroy()),this.canvas&&this.canvas.destroy(),this.config.view=this.parentApp=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{en.clearRecycled()},100)}catch(il){fe$1.error(il)}}};tl?el():setTimeout(el)}};we$1.list=new kh,St$2([zn(qt$1)],we$1.prototype,"__",void 0),St$2([bn()],we$1.prototype,"pixelRatio",void 0),St$2([fn("normal")],we$1.prototype,"mode",void 0),we$1=ve$1=St$2([Zn()],we$1);let xe$1=class extends ge$1{get __tag(){return"Rect"}};St$2([zn(Kt$2)],xe$1.prototype,"__",void 0),xe$1=St$2([Jn(ue$1),qn(),Zn()],xe$1);const{add:Se$1,includes:me$1,scroll:Re$1}=zt$2,ke$1=xe$1.prototype,Be$1=ye$1.prototype;let Ae$1=class extends ye$1{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(tl){super(tl),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(tl){if(this.children.length&&!this.pathInputed){const el=this.__;if(el.__autoSide){el.__hasSurface&&this.__extraUpdate(),super.__updateBoxBounds();const{boxBounds:il}=this.__layout;el.__autoSize||(el.__autoWidth?(il.width+=il.x,il.x=0,il.height=el.height,il.y=0):(il.height+=il.y,il.y=0,il.width=el.width,il.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let tl,el;if(this.children.length){const il=this.__,sl=this.__layout,{renderBounds:nl,boxBounds:ol}=sl,{overflow:rl}=il,al=sl.childrenRenderBounds||(sl.childrenRenderBounds=D());super.__updateRenderBounds(al),(el=rl&&rl.includes("scroll"))&&(Se$1(al,ol),Re$1(al,il)),this.__updateRectRenderBounds(),tl=!me$1(ol,al),tl&&rl==="show"&&Se$1(nl,al)}else this.__updateRectRenderBounds();_.stintSet(this,"isOverflow",tl),this.__checkScroll(el)}__updateRectRenderBounds(){}__checkScroll(tl){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(tl,el){}__renderGroup(tl,el){}__render(tl,el){this.__.__drawAfterFill?this.__renderRect(tl,el):(this.__renderRect(tl,el),this.children.length&&this.__renderGroup(tl,el)),this.hasScroller&&this.scroller.__render(tl,el)}__drawContent(tl,el){this.__renderGroup(tl,el),(this.__.__useStroke||this.__.__useEffect)&&(tl.setWorld(this.__nowWorld),this.__drawRenderPath(tl))}};St$2([zn(Jt$1)],Ae$1.prototype,"__",void 0),St$2([bn(100)],Ae$1.prototype,"width",void 0),St$2([bn(100)],Ae$1.prototype,"height",void 0),St$2([fn(!1)],Ae$1.prototype,"resizeChildren",void 0),St$2([Sn("show")],Ae$1.prototype,"overflow",void 0),St$2([Gn(ke$1.__updateStrokeSpread)],Ae$1.prototype,"__updateStrokeSpread",null),St$2([Gn(ke$1.__updateRenderSpread)],Ae$1.prototype,"__updateRectRenderSpread",null),St$2([Gn(ke$1.__updateBoxBounds)],Ae$1.prototype,"__updateRectBoxBounds",null),St$2([Gn(ke$1.__updateStrokeBounds)],Ae$1.prototype,"__updateStrokeBounds",null),St$2([Gn(ke$1.__updateRenderBounds)],Ae$1.prototype,"__updateRectRenderBounds",null),St$2([Gn(ke$1.__updateChange)],Ae$1.prototype,"__updateRectChange",null),St$2([Gn(ke$1.__render)],Ae$1.prototype,"__renderRect",null),St$2([Gn(Be$1.__render)],Ae$1.prototype,"__renderGroup",null),Ae$1=St$2([qn(),Zn()],Ae$1);let Ce$1=class extends Ae$1{get __tag(){return"Frame"}get isFrame(){return!0}};St$2([zn(Gt$1)],Ce$1.prototype,"__",void 0),St$2([Ln("#FFFFFF")],Ce$1.prototype,"fill",void 0),St$2([Sn("hide")],Ce$1.prototype,"overflow",void 0),Ce$1=St$2([Zn()],Ce$1);const{moveTo:be$1,closePath:Pe$1,ellipse:Fe$1}=Cr;let We$1=class extends ge$1{get __tag(){return"Ellipse"}__updatePath(){const{width:tl,height:el,innerRadius:il,startAngle:sl,endAngle:nl}=this.__,ol=tl/2,rl=el/2,al=this.__.path=[];let ll;il?sl||nl?(il<1?Fe$1(al,ol,rl,ol*il,rl*il,0,sl,nl,!1):ll=!0,Fe$1(al,ol,rl,ol,rl,0,nl,sl,!0)):(il<1&&(Fe$1(al,ol,rl,ol*il,rl*il),be$1(al,tl,rl)),Fe$1(al,ol,rl,ol,rl,0,360,0,!0)):sl||nl?(be$1(al,ol,rl),Fe$1(al,ol,rl,ol,rl,0,sl,nl,!1)):Fe$1(al,ol,rl,ol,rl),ll||Pe$1(al),$t$2.ellipseToCurve&&(this.__.path=this.getPath(!0))}};St$2([zn(Qt$1)],We$1.prototype,"__",void 0),St$2([Cn(0)],We$1.prototype,"innerRadius",void 0),St$2([Cn(0)],We$1.prototype,"startAngle",void 0),St$2([Cn(0)],We$1.prototype,"endAngle",void 0),We$1=St$2([Zn()],We$1);const{sin:Ee$1,cos:Te$1,PI:De$1}=Math,{moveTo:Ie$1,lineTo:Le$1,closePath:ze$1,drawPoints:Me$1}=Cr;let Oe$1=class extends ge$1{get __tag(){return"Polygon"}__updatePath(){const tl=this.__,el=tl.path=[];if(tl.points)Me$1(el,tl.points,tl.curve,!0);else{const{width:il,height:sl,sides:nl}=tl,ol=il/2,rl=sl/2;Ie$1(el,ol,0);for(let al=1;al<nl;al++)Le$1(el,ol+ol*Ee$1(2*al*De$1/nl),rl-rl*Te$1(2*al*De$1/nl));ze$1(el)}}};St$2([zn(Zt$1)],Oe$1.prototype,"__",void 0),St$2([Cn(3)],Oe$1.prototype,"sides",void 0),St$2([Cn()],Oe$1.prototype,"points",void 0),St$2([Cn(0)],Oe$1.prototype,"curve",void 0),Oe$1=St$2([qn(),Zn()],Oe$1);const{sin:Ne$1,cos:Ve$1,PI:He$1}=Math,{moveTo:Ye$1,lineTo:Ue$1,closePath:Xe$1}=Cr;let je$1=class extends ge$1{get __tag(){return"Star"}__updatePath(){const{width:tl,height:el,corners:il,innerRadius:sl}=this.__,nl=tl/2,ol=el/2,rl=this.__.path=[];Ye$1(rl,nl,0);for(let al=1;al<2*il;al++)Ue$1(rl,nl+(al%2==0?nl:nl*sl)*Ne$1(al*He$1/il),ol-(al%2==0?ol:ol*sl)*Ve$1(al*He$1/il));Xe$1(rl)}};St$2([zn(te$1)],je$1.prototype,"__",void 0),St$2([Cn(5)],je$1.prototype,"corners",void 0),St$2([Cn(.382)],je$1.prototype,"innerRadius",void 0),je$1=St$2([Zn()],je$1);const{moveTo:Je$1,lineTo:qe$1,drawPoints:Ge$1}=Cr,{rotate:$e$1,getAngle:Ke$1,getDistance:Qe$1,defaultPoint:Ze$1}=ot$2;let ti$1=class extends ge$1{get __tag(){return"Line"}get toPoint(){const{width:tl,rotation:el}=this.__,il=Y$1();return tl&&(il.x=tl),el&&$e$1(il,el),il}set toPoint(tl){this.width=Qe$1(Ze$1,tl),this.rotation=Ke$1(Ze$1,tl),this.height&&(this.height=0)}__updatePath(){const tl=this.__,el=tl.path=[];tl.points?Ge$1(el,tl.points,tl.curve,tl.closed):(Je$1(el,0,0),qe$1(el,this.width,0))}};St$2([zn($t$1)],ti$1.prototype,"__",void 0),St$2([On("center")],ti$1.prototype,"strokeAlign",void 0),St$2([bn(0)],ti$1.prototype,"height",void 0),St$2([Cn()],ti$1.prototype,"points",void 0),St$2([Cn(0)],ti$1.prototype,"curve",void 0),St$2([Cn(!1)],ti$1.prototype,"closed",void 0),ti$1=St$2([Zn()],ti$1);let ei$1=class extends xe$1{get __tag(){return"Image"}get ready(){const{image:tl}=this;return tl&&tl.ready}get image(){const{fill:tl}=this.__;return l(tl)&&tl[0].image}};St$2([zn(re$1)],ei$1.prototype,"__",void 0),St$2([bn("")],ei$1.prototype,"url",void 0),ei$1=St$2([Zn()],ei$1);const ii$1=ei$1;let si$1=class extends xe$1{get __tag(){return"Canvas"}get context(){return this.canvas.context}get ready(){return!this.url}constructor(tl){super(tl),this.canvas=le$2.canvas(this.__),tl&&tl.url&&this.drawImage(tl.url)}drawImage(tl){new on({url:tl}).load(el=>{this.context.drawImage(el.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new Vo(Vo.LOADED,{image:el}))})}draw(tl,el,il,sl){const nl=new pt$2(tl.worldTransform).invert(),ol=new pt$2;el&&ol.translate(el.x,el.y),il&&(o(il)?ol.scale(il):ol.scale(il.x,il.y)),sl&&ol.rotate(sl),nl.multiplyParent(ol),tl.__render(this.canvas,{matrix:nl.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(tl,el){const{width:il,height:sl}=this.__,{view:nl}=this.canvas;tl.drawImage(nl,0,0,nl.width,nl.height,0,0,il,sl)}__updateSize(){const{canvas:tl}=this;if(tl){const{smooth:el,safeResize:il}=this.__;tl.resize(this.__,il),tl.smooth!==el&&(tl.smooth=el)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null),super.destroy()}};St$2([zn(ae$1)],si$1.prototype,"__",void 0),St$2([Rt$2(100)],si$1.prototype,"width",void 0),St$2([Rt$2(100)],si$1.prototype,"height",void 0),St$2([Rt$2(1)],si$1.prototype,"pixelRatio",void 0),St$2([Rt$2(!0)],si$1.prototype,"smooth",void 0),St$2([fn(!1)],si$1.prototype,"safeResize",void 0),St$2([Rt$2()],si$1.prototype,"contextSettings",void 0),si$1=St$2([Zn()],si$1);const{copyAndSpread:oi$1,includes:ri$1,spread:ai$1,setList:ni$1}=zt$2,{stintSet:_i$1}=_;let hi$1=class extends ge$1{get __tag(){return"Text"}get textDrawData(){return this.updateLayout(),this.__.__textDrawData}__updateTextDrawData(){const tl=this.__,{lineHeight:el,letterSpacing:il,fontFamily:sl,fontSize:nl,fontWeight:ol,italic:rl,textCase:al,textOverflow:ll,padding:cl,width:ul,height:dl}=tl;tl.__lineHeight=bt$2.number(el,nl),tl.__letterSpacing=bt$2.number(il,nl),tl.__baseLine=tl.__lineHeight-(tl.__lineHeight-.7*nl)/2,tl.__font=`${rl?"italic ":""}${al==="small-caps"?"small-caps ":""}${ol!=="normal"?ol+" ":""}${nl||12}px ${sl||"caption"}`,_i$1(tl,"__padding",cl&&I$1.fourNumber(cl)),_i$1(tl,"__clipText",ll!=="show"&&!tl.__autoSize),_i$1(tl,"__isCharMode",ul||dl||tl.__letterSpacing||al!=="none"),tl.__textDrawData=At$2.getDrawData((tl.__isPlacehold=tl.placeholder&&tl.text==="")?tl.placeholder:tl.text,this.__)}__updateBoxBounds(){const tl=this.__,el=this.__layout,{fontSize:il,italic:sl,padding:nl,__autoWidth:ol,__autoHeight:rl}=tl;this.__updateTextDrawData();const{bounds:al}=tl.__textDrawData,ll=el.boxBounds;if(el.contentBounds=al,tl.__lineHeight<il&&ai$1(al,il/2),ol||rl){if(ll.x=ol?al.x:0,ll.y=rl?al.y:0,ll.width=ol?al.width:tl.width,ll.height=rl?al.height:tl.height,nl){const[cl,ul,dl,fl]=tl.__padding;ol&&(ll.x-=fl,ll.width+=ul+fl),rl&&(ll.y-=cl,ll.height+=dl+cl)}this.__updateNaturalSize()}else super.__updateBoxBounds();sl&&(ll.width+=.16*il),_.stintSet(this,"isOverflow",!ri$1(ll,al)),this.isOverflow?(ni$1(tl.__textBoxBounds={},[ll,al]),el.renderChanged=!0):tl.__textBoxBounds=ll}__updateRenderSpread(){let tl=super.__updateRenderSpread();return tl||(tl=this.isOverflow?1:0),tl}__updateRenderBounds(){const{renderBounds:tl,renderSpread:el}=this.__layout;oi$1(tl,this.__.__textBoxBounds,el),this.__box&&(this.__box.__layout.renderBounds=tl)}__updateChange(){super.__updateChange();const tl=this.__box;tl&&(tl.__onUpdateSize(),tl.__updateChange())}__drawRenderPath(tl){tl.font=this.__.__font}__draw(tl,el,il){const sl=this.__box;sl&&(sl.__nowWorld=this.__nowWorld,sl.__draw(tl,el,il)),this.textEditing&&!el.exporting||super.__draw(tl,el,il)}__drawShape(tl,el){el.shape&&this.__box&&this.__box.__drawShape(tl,el),super.__drawShape(tl,el)}destroy(){this.boxStyle&&(this.boxStyle=null),super.destroy()}};St$2([zn(oe$1)],hi$1.prototype,"__",void 0),St$2([bn(0)],hi$1.prototype,"width",void 0),St$2([bn(0)],hi$1.prototype,"height",void 0),St$2([Ln()],hi$1.prototype,"boxStyle",void 0),St$2([fn(!1)],hi$1.prototype,"resizeFontSize",void 0),St$2([Ln("#000000")],hi$1.prototype,"fill",void 0),St$2([On("outside")],hi$1.prototype,"strokeAlign",void 0),St$2([Dn("all")],hi$1.prototype,"hitFill",void 0),St$2([bn("")],hi$1.prototype,"text",void 0),St$2([bn("")],hi$1.prototype,"placeholder",void 0),St$2([bn("caption")],hi$1.prototype,"fontFamily",void 0),St$2([bn(12)],hi$1.prototype,"fontSize",void 0),St$2([bn("normal")],hi$1.prototype,"fontWeight",void 0),St$2([bn(!1)],hi$1.prototype,"italic",void 0),St$2([bn("none")],hi$1.prototype,"textCase",void 0),St$2([bn("none")],hi$1.prototype,"textDecoration",void 0),St$2([bn(0)],hi$1.prototype,"letterSpacing",void 0),St$2([bn({type:"percent",value:1.5})],hi$1.prototype,"lineHeight",void 0),St$2([bn(0)],hi$1.prototype,"paraIndent",void 0),St$2([bn(0)],hi$1.prototype,"paraSpacing",void 0),St$2([bn("x")],hi$1.prototype,"writingMode",void 0),St$2([bn("left")],hi$1.prototype,"textAlign",void 0),St$2([bn("top")],hi$1.prototype,"verticalAlign",void 0),St$2([bn(!0)],hi$1.prototype,"autoSizeAlign",void 0),St$2([bn("normal")],hi$1.prototype,"textWrap",void 0),St$2([bn("show")],hi$1.prototype,"textOverflow",void 0),St$2([Ln(!1)],hi$1.prototype,"textEditing",void 0),hi$1=St$2([Zn()],hi$1);let di$1=class extends ge$1{get __tag(){return"Path"}};St$2([zn(ee$1)],di$1.prototype,"__",void 0),St$2([On("center")],di$1.prototype,"strokeAlign",void 0),di$1=St$2([Zn()],di$1);let li$1=class extends ye$1{get __tag(){return"Pen"}setStyle(tl){const el=this.pathElement=new di$1(tl);return this.pathStyle=tl,this.__path=el.path||(el.path=[]),this.add(el),this}beginPath(){return this}moveTo(tl,el){return this}lineTo(tl,el){return this}bezierCurveTo(tl,el,il,sl,nl,ol){return this}quadraticCurveTo(tl,el,il,sl){return this}closePath(){return this}rect(tl,el,il,sl){return this}roundRect(tl,el,il,sl,nl){return this}ellipse(tl,el,il,sl,nl,ol,rl,al){return this}arc(tl,el,il,sl,nl,ol){return this}arcTo(tl,el,il,sl,nl){return this}drawEllipse(tl,el,il,sl,nl,ol,rl,al){return this}drawArc(tl,el,il,sl,nl,ol){return this}drawPoints(tl,el,il){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}};St$2([zn(ie$1)],li$1.prototype,"__",void 0),St$2([(tl,el)=>{ln(tl,el,{get(){return this.__path}})}],li$1.prototype,"path",void 0),li$1=St$2([Jn(Fr,["set","path","paint"]),Zn()],li$1);function I(tl,el,il,sl){var nl,ol=arguments.length,rl=ol<3?el:sl===null?sl=Object.getOwnPropertyDescriptor(el,il):sl;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")rl=Reflect.decorate(tl,el,il,sl);else for(var al=tl.length-1;al>=0;al--)(nl=tl[al])&&(rl=(ol<3?nl(rl):ol>3?nl(el,il,rl):nl(el,il))||rl);return ol>3&&rl&&Object.defineProperty(el,il,rl),rl}let N=class extends we$1{get __tag(){return"App"}get isApp(){return!0}constructor(tl,el){super(tl,el)}init(tl,el){if(super.init(tl,el),tl){const{ground:il,tree:sl,sky:nl,editor:ol}=tl;il&&(this.ground=this.addLeafer(il)),(sl||ol)&&(this.tree=this.addLeafer(sl||{type:tl.type||"design"})),(nl||ol)&&(this.sky=this.addLeafer(nl)),ol&&le$2.editor(ol,this)}}__setApp(){const{canvas:tl}=this,{realCanvas:el,view:il}=this.config;el||il===this.canvas.view||!tl.parentView?this.realCanvas=!0:tl.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable()}__updateLocalBounds(){this.forEach(tl=>tl.updateLayout()),super.__updateLocalBounds()}start(){super.start(),this.forEach(tl=>tl.start())}stop(){this.forEach(tl=>tl.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.forEach(tl=>tl.unlockLayout())}lockLayout(){super.lockLayout(),this.forEach(tl=>tl.lockLayout())}forceRender(tl,el){this.forEach(il=>il.forceRender(tl,el))}addLeafer(tl){const el=new we$1(tl);return this.add(el),el}add(tl,el){if(!tl.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout(()=>this.add(tl,el),10);tl.init(this.__getChildConfig(tl.userConfig),this)}super.add(tl,el),s(el)||(tl.canvas.childIndex=el),this.__listenChildEvents(tl)}forEach(tl){this.children.forEach(tl)}__onCreated(){this.created=this.children.every(tl=>tl.created)}__onReady(){this.children.every(tl=>tl.ready)&&super.__onReady()}__onViewReady(){this.children.every(tl=>tl.viewReady)&&super.__onViewReady()}__onChildRenderEnd(tl){this.renderer.addBlock(tl.renderBounds),this.viewReady&&this.renderer.update()}__render(tl,el){tl.context&&this.forEach(il=>el.matrix?il.__render(tl,el):tl.copyWorld(il.canvas,el.bounds))}__onResize(tl){this.forEach(el=>el.resize(tl)),super.__onResize(tl)}updateLayout(){this.forEach(tl=>tl.updateLayout())}__getChildConfig(tl){const el=Object.assign({},this.config);return el.hittable=el.realCanvas=void 0,tl&&_.assign(el,tl),this.autoLayout&&_.copyAttrs(el,this,Re$2),el.view=this.realCanvas?void 0:this.view,el.fill=void 0,el}__listenChildEvents(tl){tl.once([[ta.END,this.__onReady,this],[ea.START,this.__onCreated,this],[ea.END,this.__onViewReady,this]]),this.realCanvas&&this.__eventIds.push(tl.on_(ea.END,this.__onChildRenderEnd,this))}};N=I([Zn()],N);const F={},W={isHoldSpaceKey:()=>W.isHold("Space"),isHold:tl=>F[tl],isHoldKeys:(tl,el)=>el?tl(el):void 0,setDownCode(tl){F[tl]||(F[tl]=!0)},setUpCode(tl){F[tl]=!1}},K={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(tl){tl.buttons||(tl.buttons=1)},left:tl=>tl.buttons===1,right:tl=>tl.buttons===2,middle:tl=>tl.buttons===4};class V extends Xo{get spaceKey(){return W.isHoldSpaceKey()}get left(){return K.left(this)}get right(){return K.right(this)}get middle(){return K.middle(this)}constructor(el){super(el.type),this.bubbles=!0,Object.assign(this,el)}isHoldKeys(el){return W.isHoldKeys(el,this)}getBoxPoint(el){return(el||this.current).getBoxPoint(this)}getInnerPoint(el){return(el||this.current).getInnerPoint(this)}getLocalPoint(el){return(el||this.current).getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(el){return this.getInnerPoint(el)}getLocal(el){return this.getLocalPoint(el)}getPage(){return this.getPagePoint()}static changeName(el,il){pe$2.changeName(el,il)}}const{min:U,max:j,abs:X}=Math,{float:Y,sign:z}=I$1,{minX:G,maxX:Z$1,minY:q,maxY:J$1}=zt$2,Q=new Vt$3,$=new Vt$3,tt$1={limitMove(tl,el){const{dragBounds:il,dragBoundsType:sl}=tl;il&&et$1.getValidMove(tl.__localBoxBounds,et$1.getDragBounds(tl),sl,el,!0),et$1.axisMove(tl,el)},limitScaleOf(tl,el,il,sl){const{dragBounds:nl,dragBoundsType:ol}=tl;nl&&et$1.getValidScaleOf(tl.__localBoxBounds,et$1.getDragBounds(tl),ol,tl.getLocalPointByInner(tl.getInnerPointByBox(el)),il,sl,!0)},axisMove(tl,el){const{draggable:il}=tl;il==="x"&&(el.y=0),il==="y"&&(el.x=0)},getDragBounds(tl){const{dragBounds:el}=tl;return el==="parent"?tl.parent.boxBounds:el},isInnerMode:(tl,el,il,sl)=>il==="inner"||il==="auto"&&tl[sl]>el[sl],getValidMove(tl,el,il,sl,nl){const ol=tl.x+sl.x,rl=tl.y+sl.y,al=ol+tl.width,ll=rl+tl.height,cl=el.x+el.width,ul=el.y+el.height;return nl||(sl=Object.assign({},sl)),et$1.isInnerMode(tl,el,il,"width")?ol>el.x?sl.x+=el.x-ol:al<cl&&(sl.x+=cl-al):ol<el.x?sl.x+=el.x-ol:al>cl&&(sl.x+=cl-al),et$1.isInnerMode(tl,el,il,"height")?rl>el.y?sl.y+=el.y-rl:ll<ul&&(sl.y+=ul-ll):rl<el.y?sl.y+=el.y-rl:ll>ul&&(sl.y+=ul-ll),sl.x=Y(sl.x),sl.y=Y(sl.y),sl},getValidScaleOf(tl,el,il,sl,nl,ol,rl){rl||(nl=Object.assign({},nl)),$.set(el),Q.set(tl).scaleOf(sl,nl.x,nl.y);const al=(sl.x-tl.x)/tl.width,ll=1-al,cl=(sl.y-tl.y)/tl.height,ul=1-cl;let dl,fl,hl,_l,yl=1,ml=1;return et$1.isInnerMode(tl,el,il,"width")?(nl.x<0&&Q.scaleOf(sl,yl=1/nl.x,1),hl=Y(Q.minX-$.minX),_l=Y($.maxX-Q.maxX),dl=al&&hl>0?1+hl/(al*Q.width):1,fl=ll&&_l>0?1+_l/(ll*Q.width):1,yl*=j(dl,fl)):(nl.x<0&&((Y(G(tl)-G(el))<=0||Y(Z$1(el)-Z$1(tl))<=0)&&Q.scaleOf(sl,yl=1/nl.x,1),Q.unsign()),hl=Y($.minX-Q.minX),_l=Y(Q.maxX-$.maxX),dl=al&&hl>0?1-hl/(al*Q.width):1,fl=ll&&_l>0?1-_l/(ll*Q.width):1,yl*=U(dl,fl)),et$1.isInnerMode(tl,el,il,"height")?(nl.y<0&&Q.scaleOf(sl,1,ml=1/nl.y),hl=Y(Q.minY-$.minY),_l=Y($.maxY-Q.maxY),dl=cl&&hl>0?1+hl/(cl*Q.height):1,fl=ul&&_l>0?1+_l/(ul*Q.height):1,ml*=j(dl,fl),ol&&(dl=j(X(yl),X(ml)),yl=z(yl)*dl,ml=z(ml)*dl)):(nl.y<0&&((Y(q(tl)-q(el))<=0||Y(J$1(el)-J$1(tl))<=0)&&Q.scaleOf(sl,1,ml=1/nl.y),Q.unsign()),hl=Y($.minY-Q.minY),_l=Y(Q.maxY-$.maxY),dl=cl&&hl>0?1-hl/(cl*Q.height):1,fl=ul&&_l>0?1-_l/(ul*Q.height):1,ml*=U(dl,fl)),nl.x*=n(yl)?yl:1,nl.y*=n(ml)?ml:1,nl}},et$1=tt$1;let it$1=class extends V{};it$1.POINTER="pointer",it$1.BEFORE_DOWN="pointer.before_down",it$1.BEFORE_MOVE="pointer.before_move",it$1.BEFORE_UP="pointer.before_up",it$1.DOWN="pointer.down",it$1.MOVE="pointer.move",it$1.UP="pointer.up",it$1.OVER="pointer.over",it$1.OUT="pointer.out",it$1.ENTER="pointer.enter",it$1.LEAVE="pointer.leave",it$1.TAP="tap",it$1.DOUBLE_TAP="double_tap",it$1.CLICK="click",it$1.DOUBLE_CLICK="double_click",it$1.LONG_PRESS="long_press",it$1.LONG_TAP="long_tap",it$1.MENU="pointer.menu",it$1.MENU_TAP="pointer.menu_tap",it$1=I([$n()],it$1);const st$1=it$1,at$1={};let nt$1=class extends it$1{static setList(tl){this.list=tl instanceof kh?tl:new kh(tl)}static setData(tl){this.data=tl}static getValidMove(tl,el,il,sl=!0){const nl=tl.getLocalPoint(il,null,!0);return ot$2.move(nl,el.x-tl.x,el.y-tl.y),sl&&this.limitMove(tl,nl),tt$1.axisMove(tl,nl),nl}static limitMove(tl,el){tt$1.limitMove(tl,el)}getPageMove(tl){return this.assignMove(tl),this.current.getPagePoint(at$1,null,!0)}getInnerMove(tl,el){return tl||(tl=this.current),this.assignMove(el),tl.getInnerPoint(at$1,null,!0)}getLocalMove(tl,el){return tl||(tl=this.current),this.assignMove(el),tl.getLocalPoint(at$1,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(tl){return this.getInnerMove(tl,!0)}getLocalTotal(tl){return this.getLocalMove(tl,!0)}getPageBounds(){const tl=this.getPageTotal(),el=this.getPagePoint(),il={};return zt$2.set(il,el.x-tl.x,el.y-tl.y,tl.x,tl.y),zt$2.unsign(il),il}assignMove(tl){at$1.x=tl?this.totalX:this.moveX,at$1.y=tl?this.totalY:this.moveY}};nt$1.BEFORE_DRAG="drag.before_drag",nt$1.START="drag.start",nt$1.DRAG="drag",nt$1.END="drag.end",nt$1.OVER="drag.over",nt$1.OUT="drag.out",nt$1.ENTER="drag.enter",nt$1.LEAVE="drag.leave",nt$1=I([$n()],nt$1);const rt$1=nt$1;let ht$1=class extends it$1{static setList(tl){nt$1.setList(tl)}static setData(tl){nt$1.setData(tl)}};ht$1.DROP="drop",ht$1=I([$n()],ht$1);let ot$1=class extends nt$1{};ot$1.BEFORE_MOVE="move.before_move",ot$1.START="move.start",ot$1.MOVE="move",ot$1.DRAG_ANIMATE="move.drag_animate",ot$1.END="move.end",ot$1.PULL_DOWN="move.pull_down",ot$1.REACH_BOTTOM="move.reach_bottom",ot$1=I([$n()],ot$1);let dt$1=class extends V{};dt$1=I([$n()],dt$1);const gt$1=dt$1;let lt$1=class extends it$1{};lt$1.BEFORE_ROTATE="rotate.before_rotate",lt$1.START="rotate.start",lt$1.ROTATE="rotate",lt$1.END="rotate.end",lt$1=I([$n()],lt$1);let ct$1=class extends nt$1{};ct$1.SWIPE="swipe",ct$1.LEFT="swipe.left",ct$1.RIGHT="swipe.right",ct$1.UP="swipe.up",ct$1.DOWN="swipe.down",ct$1=I([$n()],ct$1);let ut$1=class extends it$1{};ut$1.BEFORE_ZOOM="zoom.before_zoom",ut$1.START="zoom.start",ut$1.ZOOM="zoom",ut$1.END="zoom.end",ut$1=I([$n()],ut$1);let pt$1=class extends V{};pt$1.BEFORE_DOWN="key.before_down",pt$1.BEFORE_UP="key.before_up",pt$1.DOWN="key.down",pt$1.HOLD="key.hold",pt$1.UP="key.up",pt$1=I([$n()],pt$1);const _t$1={getDragEventData:(tl,el,il)=>Object.assign(Object.assign({},il),{x:il.x,y:il.y,moveX:il.x-el.x,moveY:il.y-el.y,totalX:il.x-tl.x,totalY:il.y-tl.y}),getDropEventData:(tl,el,il)=>Object.assign(Object.assign({},tl),{list:el,data:il}),getSwipeDirection:tl=>tl<-45&&tl>-135?ct$1.UP:tl>45&&tl<135?ct$1.DOWN:tl<=45&&tl>=-45?ct$1.RIGHT:ct$1.LEFT,getSwipeEventData:(tl,el,il)=>Object.assign(Object.assign({},il),{moveX:el.moveX,moveY:el.moveY,totalX:il.x-tl.x,totalY:il.y-tl.y,type:mt$1.getSwipeDirection(ot$2.getAngle(tl,il))}),getBase(tl){const el=tl.button===1?4:tl.button;return{altKey:tl.altKey,ctrlKey:tl.ctrlKey,shiftKey:tl.shiftKey,metaKey:tl.metaKey,time:Date.now(),buttons:s(tl.buttons)?1:tl.buttons===0?el:tl.buttons,origin:tl}},pathHasEventType(tl,el){const{list:il}=tl;for(let sl=0,nl=il.length;sl<nl;sl++)if(il[sl].hasEvent(el))return!0;return!1},filterPathByEventType(tl,el){const il=new kh,{list:sl}=tl;for(let nl=0,ol=sl.length;nl<ol;nl++)sl[nl].hasEvent(el)&&il.add(sl[nl]);return il},pathCanDrag:tl=>tl&&tl.list.some(el=>co.draggable(el)||!el.isLeafer&&el.hasEvent(nt$1.DRAG)),pathHasOutside:tl=>tl&&tl.list.some(el=>el.isOutside)},mt$1=_t$1,vt$1=new kh,{getDragEventData:ft$1,getDropEventData:yt$1,getSwipeEventData:Et$1}=_t$1;let Dt$1=class{constructor(tl){this.dragDataList=[],this.interaction=tl}setDragData(tl){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=ft$1(tl,tl,tl),this.canAnimate=this.canDragOut=!0}getList(tl,el){const{proxy:il}=this.interaction.selector,sl=il&&il.list.length,nl=nt$1.list||this.draggableList||vt$1;return this.dragging&&(sl?tl?vt$1:new kh(el?[...il.list,...il.dragHoverExclude]:il.list):nl)}checkDrag(tl,el){const{interaction:il}=this;if(this.moving&&tl.buttons<1)return this.canAnimate=!1,void il.pointerCancel();!this.moving&&el&&(this.moving=il.canMove(this.downData)||il.isHoldRightKey||il.isMobileDragEmpty)&&(this.dragData.moveType="drag",il.emit(ot$1.START,this.dragData)),this.moving||this.dragStart(tl,el),this.drag(tl)}dragStart(tl,el){this.dragging||(this.dragging=el&&K.left(tl),this.dragging&&(this.interaction.emit(nt$1.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints(tl){this.dragStartPoints={},tl.forEach(el=>this.dragStartPoints[el.innerId]={x:el.x,y:el.y})}getDraggableList(tl){let el;for(let il=0,sl=tl.length;il<sl;il++)if(el=tl.list[il],co.draggable(el)){this.draggableList=new kh(el);break}}drag(tl){const{interaction:el,dragData:il,downData:sl}=this,{path:nl,throughPath:ol}=sl;this.dragData=ft$1(sl,il,tl),ol&&(this.dragData.throughPath=ol),this.dragData.path=nl,this.dragDataList.push(this.dragData),this.moving?(tl.moving=!0,this.dragData.moveType="drag",el.emit(ot$1.BEFORE_MOVE,this.dragData),el.emit(ot$1.MOVE,this.dragData)):this.dragging&&(tl.dragging=!0,this.dragReal(),el.emit(nt$1.BEFORE_DRAG,this.dragData),el.emit(nt$1.DRAG,this.dragData))}dragReal(tl){const{interaction:el}=this,{running:il}=el,sl=this.realDraggableList;if(sl.length&&il){const{totalX:nl,totalY:ol}=this.dragData,{dragLimitAnimate:rl}=el.p,al=!rl||!!tl;sl.forEach(ll=>{if(ll.draggable){const cl=i(ll.draggable),ul=nt$1.getValidMove(ll,this.dragStartPoints[ll.innerId],{x:nl,y:ol},al||cl);rl&&!cl&&tl?co.animateMove(ll,ul,o(rl)?rl:.3):ll.move(ul)}})}}dragOverOrOut(tl){const{interaction:el}=this,{dragOverPath:il}=this,{path:sl}=tl;this.dragOverPath=sl,il?sl.indexAt(0)!==il.indexAt(0)&&(el.emit(nt$1.OUT,tl,il),el.emit(nt$1.OVER,tl,sl)):el.emit(nt$1.OVER,tl,sl)}dragEnterOrLeave(tl){const{interaction:el}=this,{dragEnterPath:il}=this,{path:sl}=tl;el.emit(nt$1.LEAVE,tl,il,sl),el.emit(nt$1.ENTER,tl,sl,il),this.dragEnterPath=sl}dragEnd(tl){(this.dragging||this.moving)&&(this.checkDragEndAnimate(tl)||this.dragEndReal(tl))}dragEndReal(tl){const{interaction:el,downData:il,dragData:sl}=this;tl||(tl=sl);const{path:nl,throughPath:ol}=il,rl=ft$1(il,tl,tl);if(ol&&(rl.throughPath=ol),rl.path=nl,this.moving&&(this.moving=!1,rl.moveType="drag",el.emit(ot$1.END,rl)),this.dragging){const al=this.getList();this.dragging=!1,el.p.dragLimitAnimate&&this.dragReal(!0),el.emit(nt$1.END,rl),this.swipe(tl,il,sl,rl),this.drop(tl,al,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}swipe(tl,el,il,sl){const{interaction:nl}=this;if(ot$2.getDistance(el,tl)>nl.config.pointer.swipeDistance){const ol=Et$1(el,il,sl);this.interaction.emit(ol.type,ol)}}drop(tl,el,il){const sl=yt$1(tl,el,nt$1.data);sl.path=il,this.interaction.emit(ht$1.DROP,sl),this.interaction.emit(nt$1.LEAVE,tl,il)}dragReset(){nt$1.list=nt$1.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null,this.dragDataList=[]}checkDragEndAnimate(tl,el){return!1}animate(tl,el){}stopAnimate(){}checkDragOut(tl){}autoMoveOnDragOut(tl){}autoMoveCancel(){}destroy(){this.dragReset()}};const Pt$1=ee$2.get("emit"),xt$1=["move","zoom","rotate","key"];function wt$1(tl,el,il,sl,nl){if(xt$1.some(ol=>el.startsWith(ol))&&tl.__.hitChildren&&!Tt$1(tl,nl)){let ol;for(let rl=0,al=tl.children.length;rl<al;rl++)ol=tl.children[rl],!il.path.has(ol)&&ol.__.hittable&&Ot$1(ol,el,il,sl,nl)}}function Ot$1(tl,el,il,sl,nl){if(tl.destroyed)return!1;if(tl.__.hitSelf&&!Tt$1(tl,nl)&&(Lt$2.updateEventStyle&&!sl&&Lt$2.updateEventStyle(tl,el),tl.hasEvent(el,sl))){il.phase=sl?1:tl===il.target?2:3;const ol=pe$2.get(el,il);if(tl.emitEvent(ol,sl),ol.isStop)return!0}return!1}function Tt$1(tl,el){return el&&el.has(tl)}const Lt$1={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8}},pointer:{type:"pointer",snap:!0,hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20},touch:{preventDefault:"auto"},multiTouch:{},move:{autoDistance:2},zoom:{},cursor:!0,keyEvent:!0},{pathHasEventType:Rt$1,pathCanDrag:Ct$1,pathHasOutside:bt$1}=_t$1;let Mt$1=class{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return this.m.drag===!0||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&K.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&K.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&W.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor(tl,el,il,sl){this.config=_.clone(Lt$1),this.tapCount=0,this.downKeyMap={},this.target=tl,this.canvas=el,this.selector=il,this.defaultPath=new kh(tl),this.createTransformer(),this.dragger=new Dt$1(this),sl&&(this.config=_.default(sl,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(tl){}pointerDown(tl,el){tl||(tl=this.hoverData),tl&&(K.defaultLeft(tl),this.updateDownData(tl),this.checkPath(tl,el),this.downTime=Date.now(),this.emit(it$1.BEFORE_DOWN,tl),tl.path.needUpdate&&this.updateDownData(tl),this.emit(it$1.DOWN,tl),K.left(tl)&&(this.tapWait(),this.longPressWait(tl)),this.waitRightTap=K.right(tl),this.dragger.setDragData(tl),this.isHoldRightKey||this.updateCursor(tl))}pointerMove(tl){if(tl||(tl=this.hoverData),!tl)return;const{downData:el}=this;el&&K.defaultLeft(tl),(this.canvas.bounds.hitPoint(tl)||el)&&(this.pointerMoveReal(tl),el&&this.dragger.checkDragOut(tl))}pointerMoveReal(tl){if(this.emit(it$1.BEFORE_MOVE,tl,this.defaultPath),this.downData){const el=ot$2.getDistance(this.downData,tl)>this.p.dragDistance;el&&(this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag(tl,el)}this.dragger.moving||(this.updateHoverData(tl),this.checkPath(tl),this.emit(it$1.MOVE,tl),this.pointerHover(tl),this.dragging&&(this.dragger.dragOverOrOut(tl),this.dragger.dragEnterOrLeave(tl))),this.updateCursor(this.downData||tl)}pointerUp(tl){const{downData:el}=this;if(tl||(tl=el),!el)return;K.defaultLeft(tl),tl.multiTouch=el.multiTouch,this.findPath(tl);const il=Object.assign(Object.assign({},tl),{path:tl.path.clone()});tl.path.addList(el.path.list),this.checkPath(tl),this.downData=null,this.emit(it$1.BEFORE_UP,tl),this.emit(it$1.UP,tl),this.touchLeave(tl),tl.isCancel||(this.tap(tl),this.menuTap(tl)),this.dragger.dragEnd(tl),this.updateCursor(il)}pointerCancel(){const tl=Object.assign({},this.dragger.dragData);tl.isCancel=!0,this.pointerUp(tl)}menu(tl){this.findPath(tl),this.emit(it$1.MENU,tl),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap(tl)}menuTap(tl){this.waitRightTap&&this.waitMenuTap&&(this.emit(it$1.MENU_TAP,tl),this.waitRightTap=this.waitMenuTap=!1)}createTransformer(){}move(tl){}zoom(tl){}rotate(tl){}transformEnd(){}wheel(tl){}multiTouch(tl,el){}keyDown(tl){if(!this.config.keyEvent)return;this.emit(pt$1.BEFORE_DOWN,tl,this.defaultPath);const{code:el}=tl;this.downKeyMap[el]||(this.downKeyMap[el]=!0,W.setDownCode(el),this.emit(pt$1.HOLD,tl,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(pt$1.DOWN,tl,this.defaultPath)}keyUp(tl){if(!this.config.keyEvent)return;this.emit(pt$1.BEFORE_UP,tl,this.defaultPath);const{code:el}=tl;this.downKeyMap[el]=!1,W.setUpCode(el),this.emit(pt$1.UP,tl,this.defaultPath),this.cursor==="grab"&&this.updateCursor()}pointerHover(tl){!this.canHover||this.dragging&&!this.p.dragHover||(tl.path||(tl.path=new kh),this.pointerOverOrOut(tl),this.pointerEnterOrLeave(tl))}pointerOverOrOut(tl){const{path:el}=tl,{overPath:il}=this;this.overPath=el,il?el.indexAt(0)!==il.indexAt(0)&&(this.emit(it$1.OUT,tl,il),this.emit(it$1.OVER,tl,el)):this.emit(it$1.OVER,tl,el)}pointerEnterOrLeave(tl){let{path:el}=tl;this.downData&&!this.moveMode&&(el=el.clone(),this.downData.path.forEach(sl=>el.add(sl)));const{enterPath:il}=this;this.enterPath=el,this.emit(it$1.LEAVE,tl,il,el),this.emit(it$1.ENTER,tl,el,il)}touchLeave(tl){tl.pointerType==="touch"&&this.enterPath&&(this.emit(it$1.LEAVE,tl),this.dragger.dragging&&this.emit(ht$1.LEAVE,tl))}tap(tl){const{pointer:el}=this.config,il=this.longTap(tl);if(!el.tapMore&&il||!this.waitTap)return;el.tapMore&&this.emitTap(tl);const sl=Date.now()-this.downTime,nl=[it$1.DOUBLE_TAP,it$1.DOUBLE_CLICK].some(ol=>Rt$1(tl.path,ol));sl<el.tapTime+50&&nl?(this.tapCount++,this.tapCount===2?(this.tapWaitCancel(),this.emitDoubleTap(tl)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{el.tapMore||(this.tapWaitCancel(),this.emitTap(tl))},el.tapTime))):el.tapMore||(this.tapWaitCancel(),this.emitTap(tl))}findPath(tl,el){const{hitRadius:il,through:sl}=this.p,{bottomList:nl,target:ol}=this;$t$2.backgrounder||tl.origin||ol&&ol.updateLayout();const rl=this.selector.getByPoint(tl,il,Object.assign({bottomList:nl,name:tl.type},el||{through:sl}));return rl.throughPath&&(tl.throughPath=rl.throughPath),tl.path=rl.path,rl.path}isRootPath(tl){return tl&&tl.path.list[0].isLeafer}isTreePath(tl){const el=this.target.app;return!(!el||!el.isApp)&&el.editor&&!tl.path.has(el.editor)&&tl.path.has(el.tree)&&!tl.target.syncEventer}checkPath(tl,el){(el||this.moveMode&&!bt$1(tl.path))&&(tl.path=this.defaultPath)}canMove(tl){return tl&&(this.moveMode||this.m.drag==="auto"&&!Ct$1(tl.path))&&!bt$1(tl.path)}isDrag(tl){return this.dragger.getList().has(tl)}isPress(tl){return this.downData&&this.downData.path.has(tl)}isHover(tl){return this.enterPath&&this.enterPath.has(tl)}isFocus(tl){return this.focusData===tl}cancelHover(){const{hoverData:tl}=this;tl&&(tl.path=this.defaultPath,this.pointerHover(tl))}stopDragAnimate(){this.dragger.stopAnimate()}updateDownData(tl,el,il){const{downData:sl}=this;!tl&&sl&&(tl=sl),tl&&(this.findPath(tl,el),il&&sl&&tl.path.addList(sl.path.list),this.downData=tl)}updateHoverData(tl){tl||(tl=this.hoverData),tl&&(this.findPath(tl,{exclude:this.dragger.getList(!1,!0),name:it$1.MOVE}),this.hoverData=tl)}updateCursor(tl){if(!this.config.cursor||!this.canHover)return;if(tl||(this.updateHoverData(),tl=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(tl))return this.setCursor(this.downData?"grabbing":"grab");if(!tl)return;let el,il;const{path:sl}=tl;for(let nl=0,ol=sl.length;nl<ol&&(el=sl.list[nl],il=el.syncEventer&&el.syncEventer.cursor||el.cursor,!il);nl++);this.setCursor(il)}setCursor(tl){this.cursor=tl}getLocal(tl,el){const il=this.canvas.getClientBounds(el),sl={x:tl.clientX-il.x,y:tl.clientY-il.y},{bounds:nl}=this.canvas;return sl.x*=nl.width/il.width,sl.y*=nl.height/il.height,this.p.snap&&ot$2.round(sl),sl}emitTap(tl){this.emit(it$1.TAP,tl),this.emit(it$1.CLICK,tl)}emitDoubleTap(tl){this.emit(it$1.DOUBLE_TAP,tl),this.emit(it$1.DOUBLE_CLICK,tl)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){this.waitTap&&(clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0)}longPressWait(tl){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(it$1.LONG_PRESS,tl)},this.p.longPressTime)}longTap(tl){let el;return this.longPressed&&(this.emit(it$1.LONG_TAP,tl),(Rt$1(tl.path,it$1.LONG_TAP)||Rt$1(tl.path,it$1.LONG_PRESS))&&(el=!0)),this.longPressWaitCancel(),el}longPressWaitCancel(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressed=!1)}__onResize(){const{dragOut:tl}=this.m;this.shrinkCanvasBounds=new Vt$3(this.canvas.bounds),this.shrinkCanvasBounds.spread(-(o(tl)?tl:2))}__listenEvents(){const{target:tl}=this;this.__eventIds=[tl.on_($o.RESIZE,this.__onResize,this)],tl.once(sa.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(tl,el,il,sl){this.running&&(function(nl,ol,rl,al){if(!rl&&!ol.path)return;let ll;ol.type=nl,rl?ol=Object.assign(Object.assign({},ol),{path:rl}):rl=ol.path,ol.target=rl.indexAt(0);try{for(let cl=rl.length-1;cl>-1;cl--){if(ll=rl.list[cl],Ot$1(ll,nl,ol,!0,al))return;ll.isApp&&wt$1(ll,nl,ol,!0,al)}for(let cl=0,ul=rl.length;cl<ul;cl++)if(ll=rl.list[cl],ll.isApp&&wt$1(ll,nl,ol,!1,al),Ot$1(ll,nl,ol,!1,al))return}catch(cl){Pt$1.error(cl)}})(tl,el,il,sl)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer&&this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}},St$1=class{static set(tl,el){this.custom[tl]=el}static get(tl){return this.custom[tl]}};St$1.custom={};let At$1=class extends ge$2{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new kh,this.pixelList=new kh}getPixelType(tl,el){return this.__autoClear(),this.pixelList.add(tl),le$2.hitCanvas(el)}getPathType(tl){return this.__autoClear(),this.pathList.add(tl),le$2.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(tl){tl.length&&(tl.forEach(el=>{el.__hitCanvas&&(el.__hitCanvas.destroy(),el.__hitCanvas=null)}),tl.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}};$t$2.getSelector=function(tl){return tl.leafer?tl.leafer.selector:$t$2.selector||($t$2.selector=le$2.selector())};const{toInnerRadiusPointOf:Bt$1,copyRadiusPoint:kt$1}=ot$2,{hitRadiusPoint:Ht$1,hitPoint:It$1}=zt$2,Nt$1={},Ft$1={},Wt$1=_h.prototype;Wt$1.hit=function(tl,el=0){this.updateLayout(),kt$1(Ft$1,tl,el);const il=this.__world;return!!(el?Ht$1(il,Ft$1):It$1(il,Ft$1))&&(this.isBranch?$t$2.getSelector(this).hitPoint(Object.assign({},Ft$1),el,{target:this}):this.__hitWorld(Ft$1))},Wt$1.__hitWorld=function(tl,el){const il=this.__;if(!il.hitSelf)return!1;const sl=this.__world,nl=this.__layout,ol=sl.width<10&&sl.height<10;if(il.hitRadius&&(kt$1(Nt$1,tl,il.hitRadius),tl=Nt$1),Bt$1(tl,sl,Nt$1),il.hitBox||ol){if(zt$2.hitRadiusPoint(nl.boxBounds,Nt$1))return!0;if(ol)return!1}return!nl.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),nl.boundsChanged||(nl.hitCanvasChanged=!1)),this.__hit(Nt$1,el)},Wt$1.__hitFill=function(tl){const el=this.__hitCanvas;return el&&el.hitFill(tl,this.__.windingRule)},Wt$1.__hitStroke=function(tl,el){const il=this.__hitCanvas;return il&&il.hitStroke(tl,el)},Wt$1.__hitPixel=function(tl){const el=this.__hitCanvas;return el&&el.hitPixel(tl,this.__layout.renderBounds,el.hitScale)},Wt$1.__drawHitPath=function(tl){tl&&this.__drawRenderPath(tl)};const Kt$1=new pt$2,Vt$1=ge$1.prototype;Vt$1.__updateHitCanvas=function(){this.__box&&this.__box.__updateHitCanvas();const{hitCanvasManager:tl}=this.leafer||this.parent&&this.parent.leafer||{};if(!tl)return;const el=this.__,il=(el.__isAlphaPixelFill||el.__isCanvas)&&el.hitFill==="pixel",sl=el.__isAlphaPixelStroke&&el.hitStroke==="pixel",nl=il||sl;this.__hitCanvas||(this.__hitCanvas=nl?tl.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):tl.getPathType(this));const ol=this.__hitCanvas;if(nl){const{renderBounds:rl}=this.__layout,al=$t$2.image.hitCanvasSize,ll=ol.hitScale=Ht$3.set(0,0,al,al).getFitMatrix(rl).a,{x:cl,y:ul,width:dl,height:fl}=Ht$3.set(rl).scale(ll);ol.resize({width:dl,height:fl,pixelRatio:1}),ol.clear(),en.patternLocked=!0,this.__renderShape(ol,{matrix:Kt$1.setWith(this.__world).scaleWith(1/ll).invertWith().translate(-cl,-ul),snapshot:!0,ignoreFill:!il,ignoreStroke:!sl}),en.patternLocked=!1,ol.resetTransform(),el.__isHitPixel=!0}else el.__isHitPixel&&(el.__isHitPixel=!1);this.__drawHitPath(ol),ol.setStrokeOptions(el)},Vt$1.__hit=function(tl,el){if(this.__box&&this.__box.__hit(tl))return!0;const il=this.__;if(il.__isHitPixel&&this.__hitPixel(tl))return!0;const{hitFill:sl}=il,nl=(il.fill||il.__isCanvas)&&(sl==="path"||sl==="pixel"&&!(il.__isAlphaPixelFill||il.__isCanvas))||sl==="all"||el;if(nl&&this.__hitFill(tl))return!0;const{hitStroke:ol,__maxStrokeWidth:rl}=il,al=il.stroke&&(ol==="path"||ol==="pixel"&&!il.__isAlphaPixelStroke)||ol==="all";if(!nl&&!al)return!1;const ll=2*tl.radiusX;let cl=ll;if(al)switch(il.strokeAlign){case"inside":if(cl+=2*rl,!nl&&this.__hitFill(tl)&&this.__hitStroke(tl,cl))return!0;cl=ll;break;case"center":cl+=rl;break;case"outside":if(cl+=2*rl,!nl){if(!this.__hitFill(tl)&&this.__hitStroke(tl,cl))return!0;cl=ll}}return!!cl&&this.__hitStroke(tl,cl)};const Ut$1=ge$1.prototype,jt$1=xe$1.prototype,Xt$1=Ae$1.prototype;jt$1.__updateHitCanvas=Xt$1.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&this.hitFill==="pixel"||this.hitStroke==="all"?Ut$1.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},jt$1.__hitFill=Xt$1.__hitFill=function(tl){return this.__hitCanvas?Ut$1.__hitFill.call(this,tl):zt$2.hitRadiusPoint(this.__layout.boxBounds,tl)},hi$1.prototype.__drawHitPath=function(tl){const{__lineHeight:el,fontSize:il,__baseLine:sl,__letterSpacing:nl,__textDrawData:ol}=this.__;tl.beginPath(),nl<0?this.__drawPathByBox(tl):ol.rows.forEach(rl=>tl.rect(rl.x,rl.y-sl,rl.width,el<il?il:el))},ye$1.prototype.pick=function(tl,el){return el||(el=e$1),this.updateLayout(),$t$2.getSelector(this).getByPoint(tl,el.hitRadius||0,Object.assign(Object.assign({},el),{target:this}))};const Yt$1=Ee$2.prototype;Yt$1.hitFill=function(tl,el){return el?this.context.isPointInPath(tl.x,tl.y,el):this.context.isPointInPath(tl.x,tl.y)},Yt$1.hitStroke=function(tl,el){return this.strokeWidth=el,this.context.isPointInStroke(tl.x,tl.y)},Yt$1.hitPixel=function(tl,el,il=1){let{x:sl,y:nl,radiusX:ol,radiusY:rl}=tl;el&&(sl-=el.x,nl-=el.y),Ht$3.set(sl-ol,nl-rl,2*ol,2*rl).scale(il).ceil();const{data:al}=this.context.getImageData(Ht$3.x,Ht$3.y,Ht$3.width||1,Ht$3.height||1);for(let ll=0,cl=al.length;ll<cl;ll+=4)if(al[ll+3]>0)return!0;return al[3]>0};var Z;function J(tl,el,il,sl){return new(il||(il=Promise))(function(nl,ol){function rl(cl){try{ll(sl.next(cl))}catch(ul){ol(ul)}}function al(cl){try{ll(sl.throw(cl))}catch(ul){ol(ul)}}function ll(cl){var ul;cl.done?nl(cl.value):(ul=cl.value,ul instanceof il?ul:new il(function(dl){dl(ul)})).then(rl,al)}ll((sl=sl.apply(tl,el||[])).next())})}(function(tl){tl[tl.none=1]="none",tl[tl.free=2]="free",tl[tl.mirrorAngle=3]="mirrorAngle",tl[tl.mirror=4]="mirror"})(Z||(Z={})),typeof SuppressedError=="function"&&SuppressedError;const tt=ee$2.get("LeaferCanvas");class et extends Ee$2{set zIndex(el){const{style:il}=this.view;il.zIndex=el,this.setAbsolute(this.view)}set childIndex(el){const{view:il,parentView:sl}=this;if(il&&sl){const nl=sl.children[el];nl?(this.setAbsolute(nl),sl.insertBefore(il,nl)):sl.appendChild(nl)}}init(){const{config:el}=this,il=el.view||el.canvas;il?this.__createViewFrom(il):this.__createView();const{style:sl}=this.view;if(sl.display||(sl.display="block"),this.parentView=this.view.parentElement,this.parentView){const nl=this.parentView.style;nl.webkitUserSelect=nl.userSelect="none",this.view.classList.add("leafer-canvas-view")}$t$2.syncDomFont&&!this.parentView&&(sl.display="none",document.body&&document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(el)}set backgroundColor(el){this.view.style.backgroundColor=el}get backgroundColor(){return this.view.style.backgroundColor}set hittable(el){this.view.style.pointerEvents=el?"auto":"none"}get hittable(){return this.view.style.pointerEvents!=="none"}__createView(){this.view=document.createElement("canvas")}__createViewFrom(el){let il=i(el)?document.getElementById(el):el;if(il)if(il instanceof HTMLCanvasElement)this.view=il;else{let sl=il;if(il===window||il===document){const ol=document.createElement("div"),{style:rl}=ol;rl.position="absolute",rl.top=rl.bottom=rl.left=rl.right="0px",document.body.appendChild(ol),sl=ol}this.__createView();const nl=this.view;sl.hasChildNodes()&&(this.setAbsolute(nl),sl.style.position||(sl.style.position="relative")),sl.appendChild(nl)}else tt.error(`no id: ${el}`),this.__createView()}setAbsolute(el){const{style:il}=el;il.position="absolute",il.top=il.left="0px"}updateViewSize(){const{width:el,height:il,pixelRatio:sl}=this,{style:nl}=this.view;nl.width=el+"px",nl.height=il+"px",this.unreal||(this.view.width=Math.ceil(el*sl),this.view.height=Math.ceil(il*sl))}updateClientBounds(){this.view.parentElement&&(this.clientBounds=this.view.getBoundingClientRect())}startAutoLayout(el,il){if(this.resizeListener=il,el){if(this.autoBounds=el,this.resizeObserver)return;try{this.resizeObserver=new ResizeObserver(nl=>{this.updateClientBounds();for(const ol of nl)this.checkAutoBounds(ol.contentRect)});const sl=this.parentView;sl?(this.resizeObserver.observe(sl),this.checkAutoBounds(sl.getBoundingClientRect())):(this.checkAutoBounds(this.view),tt.warn("no parent"))}catch{this.imitateResizeObserver()}this.stopListenPixelRatio()}else this.listenPixelRatio(),this.unreal&&this.updateViewSize()}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),$t$2.requestRender(this.imitateResizeObserver.bind(this)))}listenPixelRatio(){this.windowListener||window.addEventListener("resize",this.windowListener=()=>{const el=$t$2.devicePixelRatio;if(!this.config.pixelRatio&&this.pixelRatio!==el){const{width:il,height:sl}=this;this.emitResize({width:il,height:sl,pixelRatio:el})}})}stopListenPixelRatio(){this.windowListener&&(window.removeEventListener("resize",this.windowListener),this.windowListener=null)}checkAutoBounds(el){const il=this.view,{x:sl,y:nl,width:ol,height:rl}=this.autoBounds.getBoundsFrom(el),al={width:ol,height:rl,pixelRatio:this.config.pixelRatio?this.pixelRatio:$t$2.devicePixelRatio};if(!this.isSameSize(al)){const{style:ll}=il;ll.marginLeft=sl+"px",ll.marginTop=nl+"px",this.emitResize(al)}}stopAutoLayout(){this.autoLayout=!1,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeListener=this.resizeObserver=null}emitResize(el){const il={};_.copyAttrs(il,this,Re$2),this.resize(el),this.resizeListener&&!s(this.width)&&this.resizeListener(new $o(el,il))}unrealCanvas(){if(!this.unreal&&this.parentView){let el=this.view;el&&el.remove(),el=this.view=document.createElement("div"),this.parentView.appendChild(this.view),el.classList.add("leafer-app-view"),this.unreal=!0}}destroy(){const{view:el}=this;el&&(this.stopAutoLayout(),this.stopListenPixelRatio(),el.parentElement&&el.remove(),super.destroy())}}function it(tl,el){$t$2.origin={createCanvas(il,sl){const nl=document.createElement("canvas");return nl.width=il,nl.height=sl,nl},canvasToDataURL:(il,sl,nl)=>{const ol=Gi$1.mimeType(sl),rl=il.toDataURL(ol,nl);return ol==="image/bmp"?rl.replace("image/png;","image/bmp;"):rl},canvasToBolb:(il,sl,nl)=>new Promise(ol=>il.toBlob(ol,Gi$1.mimeType(sl),nl)),canvasSaveAs:(il,sl,nl)=>{const ol=il.toDataURL(Gi$1.mimeType(Gi$1.fileType(sl)),nl);return $t$2.origin.download(ol,sl)},download(il,sl){return J(this,void 0,void 0,function*(){let nl=document.createElement("a");nl.href=il,nl.download=sl,document.body.appendChild(nl),nl.click(),document.body.removeChild(nl)})},loadImage:(il,sl,nl)=>new Promise((ol,rl)=>{const al=new $t$2.origin.Image;sl&&(al.setAttribute("crossOrigin",sl),al.crossOrigin=sl),al.onload=()=>{ol(al)},al.onerror=ll=>{rl(ll)},al.src=$t$2.image.getRealURL(il)}),loadContent(il){return J(this,arguments,void 0,function*(sl,nl="text"){const ol=yield fetch(sl);if(!ol.ok)throw new Error(`${ol.status}`);return yield ol[nl]()})},Image,PointerEvent,DragEvent},$t$2.event={stopDefault(il){il.preventDefault()},stopNow(il){il.stopImmediatePropagation()},stop(il){il.stopPropagation()}},$t$2.canvas=le$2.canvas(),$t$2.conicGradientSupport=!!$t$2.canvas.context.createConicGradient}Hi$1(CanvasRenderingContext2D.prototype),Hi$1(Path2D.prototype),Object.assign(le$2,{canvas:(tl,el)=>new et(tl,el),image:tl=>new on(tl)}),$t$2.name="web",$t$2.isMobile="ontouchstart"in window,$t$2.requestRender=function(tl){window.requestAnimationFrame(tl)},ln($t$2,"devicePixelRatio",{get:()=>devicePixelRatio});const{userAgent:st}=navigator;st.indexOf("Firefox")>-1?($t$2.conicGradientRotate90=!0,$t$2.intWheelDeltaY=!0,$t$2.syncDomFont=!0):(/iPhone|iPad|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent))&&($t$2.fullImageShadow=!0),st.indexOf("Windows")>-1?($t$2.os="Windows",$t$2.intWheelDeltaY=!0):st.indexOf("Mac")>-1?$t$2.os="Mac":st.indexOf("Linux")>-1&&($t$2.os="Linux");class nt{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove&&this.config.usePartLayout){const el=new kh;return this.__updatedList.list.forEach(il=>{il.leafer&&el.add(il)}),el}return this.__updatedList}constructor(el,il){this.totalTimes=0,this.config={},this.__updatedList=new kh,this.target=el,il&&(this.config=_.default(il,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(ea.REQUEST)}__onAttrChange(el){this.config.usePartLayout&&this.__updatedList.add(el.target),this.update()}__onChildEvent(el){this.config.usePartLayout&&(el.type===zo.ADD?(this.hasAdd=!0,this.__pushChild(el.child)):(this.hasRemove=!0,this.__updatedList.add(el.parent))),this.update()}__pushChild(el){this.__updatedList.add(el),el.isBranch&&this.__loopChildren(el)}__loopChildren(el){const{children:il}=el;for(let sl=0,nl=il.length;sl<nl;sl++)this.__pushChild(il[sl])}__onRquestData(){this.target.emitEvent(new Ko(Ko.DATA,{updatedList:this.updatedList})),this.__updatedList=new kh,this.totalTimes++,this.changed=this.hasVisible=this.hasRemove=this.hasAdd=!1}__listenEvents(){this.__eventIds=[this.target.on_([[Uo.CHANGE,this.__onAttrChange,this],[[zo.ADD,zo.REMOVE],this.__onChildEvent,this],[Ko.REQUEST,this.__onRquestData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.__updatedList=null)}}const{updateAllMatrix:ot,updateBounds:rt,updateChange:at}=co,{pushAllChildBranch:ht,pushAllParent:lt}=vo,{worldBounds:ct}=xo;class dt{constructor(el){this.updatedBounds=new Vt$3,this.beforeBounds=new Vt$3,this.afterBounds=new Vt$3,l(el)&&(el=new kh(el)),this.updatedList=el}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,ct)}setAfter(){this.afterBounds.setListWithFn(this.updatedList.list,ct),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(el){this.updatedList.addList(el.updatedList.list),this.beforeBounds.add(el.beforeBounds),this.afterBounds.add(el.afterBounds),this.updatedBounds.add(el.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:ut,updateAllChange:ft}=co,pt=ee$2.get("Layouter");class gt{constructor(el,il){this.totalTimes=0,this.config={usePartLayout:!0},this.__levelList=new Ch,this.target=el,il&&(this.config=_.default(il,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(this.layouting||!this.running)return;const{target:el}=this;this.times=0;try{el.emit(ta.START),this.layoutOnce(),el.emitEvent(new ta(ta.END,this.layoutedBlocks,this.times))}catch(il){pt.error(il)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?pt.warn("layouting"):this.times>3?pt.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Ko.REQUEST),this.totalTimes>1&&this.config.usePartLayout?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var el;if(!(!((el=this.__updatedList)===null||el===void 0)&&el.length))return;const il=ne$2.start("PartLayout"),{target:sl,__updatedList:nl}=this,{BEFORE:ol,LAYOUT:rl,AFTER:al}=ta,ll=this.getBlocks(nl);ll.forEach(cl=>cl.setBefore()),sl.emitEvent(new ta(ol,ll,this.times)),this.extraBlock=null,nl.sort(),(function(cl,ul){let dl;cl.list.forEach(fl=>{dl=fl.__layout,ul.without(fl)&&!dl.proxyZoom&&(dl.matrixChanged?(ot(fl,!0),ul.add(fl),fl.isBranch&&ht(fl,ul),lt(fl,ul)):dl.boundsChanged&&(ul.add(fl),fl.isBranch&&(fl.__tempNumber=0),lt(fl,ul)))})})(nl,this.__levelList),(function(cl){let ul,dl,fl;cl.sort(!0),cl.levels.forEach(hl=>{ul=cl.levelMap[hl];for(let _l=0,yl=ul.length;_l<yl;_l++){if(dl=ul[_l],dl.isBranch&&dl.__tempNumber){fl=dl.children;for(let ml=0,Tl=fl.length;ml<Tl;ml++)fl[ml].isBranch||rt(fl[ml])}rt(dl)}})})(this.__levelList),(function(cl){cl.list.forEach(at)})(nl),this.extraBlock&&ll.push(this.extraBlock),ll.forEach(cl=>cl.setAfter()),sl.emitEvent(new ta(rl,ll,this.times)),sl.emitEvent(new ta(al,ll,this.times)),this.addBlocks(ll),this.__levelList.reset(),this.__updatedList=null,ne$2.end(il)}fullLayout(){const el=ne$2.start("FullLayout"),{target:il}=this,{BEFORE:sl,LAYOUT:nl,AFTER:ol}=ta,rl=this.getBlocks(new kh(il));il.emitEvent(new ta(sl,rl,this.times)),gt.fullLayout(il),rl.forEach(al=>{al.setAfter()}),il.emitEvent(new ta(nl,rl,this.times)),il.emitEvent(new ta(ol,rl,this.times)),this.addBlocks(rl),ne$2.end(el)}static fullLayout(el){ut(el,!0),el.isBranch?vo.updateBounds(el):co.updateBounds(el),ft(el)}addExtra(el){if(!this.__updatedList.has(el)){const{updatedList:il,beforeBounds:sl}=this.extraBlock||(this.extraBlock=new dt([]));il.length?sl.add(el.__world):sl.set(el.__world),il.add(el)}}createBlock(el){return new dt(el)}getBlocks(el){return[this.createBlock(el)]}addBlocks(el){this.layoutedBlocks?this.layoutedBlocks.push(...el):this.layoutedBlocks=el}__onReceiveWatchData(el){this.__updatedList=el.data.updatedList}__listenEvents(){this.__eventIds=[this.target.on_([[ta.REQUEST,this.layout,this],[ta.AGAIN,this.layoutAgain,this],[Ko.DATA,this.__onReceiveWatchData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const wt=ee$2.get("Renderer");class _t{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(el,il,sl){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,ceilPartPixel:!0,maxFPS:120},this.frames=[],this.target=el,this.canvas=il,sl&&(this.config=_.default(sl,this.config)),this.__listenEvents()}start(){this.running=!0,this.update(!1)}stop(){this.running=!1}update(el=!0){this.changed||(this.changed=el),this.requestTime||this.__requestRender()}requestLayout(){this.target.emit(ta.REQUEST)}checkRender(){if(this.running){const{target:el}=this;el.isApp&&(el.emit(ea.CHILD_START,el),el.children.forEach(il=>{il.renderer.FPS=this.FPS,il.renderer.checkRender()}),el.emit(ea.CHILD_END,el)),this.changed&&this.canvas.view&&this.render(),this.target.emit(ea.NEXT)}}render(el){if(!this.running||!this.canvas.view)return this.update();const{target:il}=this;this.times=0,this.totalBounds=new Vt$3,wt.log(il.innerName,"--->");try{this.emitRender(ea.START),this.renderOnce(el),this.emitRender(ea.END,this.totalBounds),en.clearRecycled()}catch(sl){this.rendering=!1,wt.error(sl)}wt.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(el){if(this.rendering)return wt.warn("rendering");if(this.times>3)return wt.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new Vt$3,this.renderOptions={},el)this.emitRender(ea.BEFORE),el();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(ea.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(ea.RENDER,this.renderBounds,this.renderOptions),this.emitRender(ea.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:el,updateBlocks:il}=this;il&&(this.mergeBlocks(),il.forEach(sl=>{el.bounds.hit(sl)&&!sl.isEmpty()&&this.clipRender(sl)}))}clipRender(el){const il=ne$2.start("PartRender"),{canvas:sl}=this,nl=el.getIntersect(sl.bounds),ol=new Vt$3(nl);sl.save(),nl.spread(_t.clipSpread).ceil();const{ceilPartPixel:rl}=this.config;sl.clipWorld(nl,rl),sl.clearWorld(nl,rl),this.__render(nl,ol),sl.restore(),ne$2.end(il)}fullRender(){const el=ne$2.start("FullRender"),{canvas:il}=this;il.save(),il.clear(),this.__render(il.bounds),il.restore(),ne$2.end(el)}__render(el,il){const{canvas:sl,target:nl}=this,ol=el.includes(nl.__world),rl=ol?{includes:ol}:{bounds:el,includes:ol};this.needFill&&sl.fillWorld(el,this.config.fill),ee$2.showRepaint&&ee$2.drawRepaint(sl,el),this.config.useCellRender&&(rl.cellList=this.getCellList()),$t$2.render(nl,sl,rl),this.renderBounds=il=il||el,this.renderOptions=rl,this.totalBounds.isEmpty()?this.totalBounds=il:this.totalBounds.add(il),sl.updateRender(il)}getCellList(){}addBlock(el,il){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(el)}mergeBlocks(){const{updateBlocks:el}=this;if(el){const il=new Vt$3;il.setList(el),el.length=0,el.push(il)}}__requestRender(){const el=this.target;if(this.requestTime||!el)return;if(el.parentApp)return el.parentApp.requestRender(!1);this.requestTime=this.frameTime||Date.now();const il=()=>{const sl=1e3/((this.frameTime=Date.now())-this.requestTime),{maxFPS:nl}=this.config;if(nl&&sl>nl)return $t$2.requestRender(il);const{frames:ol}=this;ol.length>30&&ol.shift(),ol.push(sl),this.FPS=Math.round(ol.reduce((rl,al)=>rl+al,0)/ol.length),this.requestTime=0,this.checkRender()};$t$2.requestRender(il)}__onResize(el){if(!this.canvas.unreal){if(el.bigger||!el.samePixelRatio){const{width:il,height:sl}=el.old;if(!new Vt$3(0,0,il,sl).includes(this.target.__world)||this.needFill||!el.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new Vt$3(0,0,1,1)),this.update()}}__onLayoutEnd(el){el.data&&el.data.map(il=>{let sl;const{updatedList:nl}=il;nl&&nl.list.some(ol=>(sl=!ol.__world.width||!ol.__world.height,sl&&(ol.isLeafer||wt.tip(ol.innerName,": empty"),sl=!ol.isBranch||ol.isBranchLeaf),sl)),this.addBlock(sl?this.canvas.bounds:il.updatedBounds,nl)})}emitRender(el,il,sl){this.target.emitEvent(new ea(el,this.times,il,sl))}__listenEvents(){this.__eventIds=[this.target.on_([[ea.REQUEST,this.update,this],[ta.END,this.__onLayoutEnd,this],[ea.AGAIN,this.renderAgain,this],[$o.RESIZE,this.__onResize,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.config={},this.target=this.canvas=null)}}_t.clipSpread=10;const mt={},{copyRadiusPoint:vt}=ot$2,{hitRadiusPoint:yt}=zt$2;class xt{constructor(el,il){this.target=el,this.selector=il}getByPoint(el,il,sl){il||(il=0),sl||(sl={});const nl=sl.through||!1,ol=sl.ignoreHittable||!1,rl=sl.target||this.target;this.exclude=sl.exclude||null,this.point={x:el.x,y:el.y,radiusX:il,radiusY:il},this.findList=new kh(sl.findList),sl.findList||this.hitBranch(rl.isBranchLeaf?{children:[rl]}:rl);const{list:al}=this.findList,ll=this.getBestMatchLeaf(al,sl.bottomList,ol,!!sl.findList),cl=ol?this.getPath(ll):this.getHitablePath(ll);return this.clear(),nl?{path:cl,target:ll,throughPath:al.length?this.getThroughPath(al):cl}:{path:cl,target:ll}}hitPoint(el,il,sl){return!!this.getByPoint(el,il,sl).target}getBestMatchLeaf(el,il,sl,nl){const ol=this.findList=new kh;if(el.length){let rl;const{x:al,y:ll}=this.point,cl={x:al,y:ll,radiusX:0,radiusY:0};for(let ul=0,dl=el.length;ul<dl;ul++)if(rl=el[ul],(sl||co.worldHittable(rl))&&(this.hitChild(rl,cl),ol.length)){if(rl.isBranchLeaf&&el.some(fl=>fl!==rl&&co.hasParent(fl,rl))){ol.reset();break}return ol.list[0]}}if(il){for(let rl=0,al=il.length;rl<al;rl++)if(this.hitChild(il[rl].target,this.point,il[rl].proxy),ol.length)return ol.list[0]}return nl?null:sl?el[0]:el.find(rl=>co.worldHittable(rl))}getPath(el){const il=new kh,sl=[],{target:nl}=this;for(;el&&(el.syncEventer&&sl.push(el.syncEventer),il.add(el),(el=el.parent)!==nl););return sl.length&&sl.forEach(ol=>{for(;ol&&(ol.__.hittable&&il.add(ol),(ol=ol.parent)!==nl););}),nl&&il.add(nl),il}getHitablePath(el){const il=this.getPath(el&&el.hittable?el:null);let sl,nl=new kh;for(let ol=il.list.length-1;ol>-1&&(sl=il.list[ol],sl.__.hittable)&&(nl.addAt(sl,0),sl.__.hitChildren&&(!sl.isLeafer||sl.mode!=="draw"));ol--);return nl}getThroughPath(el){const il=new kh,sl=[];for(let al=el.length-1;al>-1;al--)sl.push(this.getPath(el[al]));let nl,ol,rl;for(let al=0,ll=sl.length;al<ll;al++){nl=sl[al],ol=sl[al+1];for(let cl=0,ul=nl.length;cl<ul&&(rl=nl.list[cl],!ol||!ol.has(rl));cl++)il.add(rl)}return il}hitBranch(el){this.eachFind(el.children,el.__onlyHitMask)}eachFind(el,il){let sl,nl,ol;const{point:rl}=this;for(let al=el.length-1;al>-1;al--)if(sl=el[al],ol=sl.__,ol.visible&&(!il||ol.mask))if(nl=yt(sl.__world,ol.hitRadius?vt(mt,rl,ol.hitRadius):rl),sl.isBranch){if(nl||sl.__ignoreHitWorld){if(sl.isBranchLeaf&&ol.__clipAfterFill&&!sl.__hitWorld(rl,!0))continue;sl.topChildren&&this.eachFind(sl.topChildren,!1),this.eachFind(sl.children,sl.__onlyHitMask),sl.isBranchLeaf&&this.hitChild(sl,rl)}}else nl&&this.hitChild(sl,rl)}hitChild(el,il,sl){if((!this.exclude||!this.exclude.has(el))&&el.__hitWorld(il)){const{parent:nl}=el;if(nl&&nl.__hasMask&&!el.__.mask){let ol,rl=[];const{children:al}=nl;for(let ll=0,cl=al.length;ll<cl;ll++)if(ol=al[ll],ol.__.mask&&rl.push(ol),ol===el){if(rl&&!rl.every(ul=>ul.__hitWorld(il)))return;break}}this.findList.add(sl||el)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}class bt{constructor(el,il){this.config={},il&&(this.config=_.default(il,this.config)),this.picker=new xt(this.target=el,this),this.finder=le$2.finder&&le$2.finder()}getByPoint(el,il,sl){const{target:nl,picker:ol}=this;return $t$2.backgrounder&&nl&&nl.updateLayout(),ol.getByPoint(el,il,sl)}hitPoint(el,il,sl){return this.picker.hitPoint(el,il,sl)}getBy(el,il,sl,nl){return this.finder?this.finder.getBy(el,il,sl,nl):he$2.need("find")}destroy(){this.picker.destroy(),this.finder&&this.finder.destroy()}}Object.assign(le$2,{watcher:(tl,el)=>new nt(tl,el),layouter:(tl,el)=>new gt(tl,el),renderer:(tl,el,il)=>new _t(tl,el,il),selector:(tl,el)=>new bt(tl,el)}),$t$2.layout=gt.fullLayout,$t$2.render=function(tl,el,il){const sl=Object.assign(Object.assign({},il),{topRendering:!0});il.topList=new kh,tl.__render(el,il),il.topList.length&&il.topList.forEach(nl=>nl.__render(el,sl))};const St={convert(tl,el){const il=_t$1.getBase(tl),{x:sl,y:nl}=el,ol=Object.assign(Object.assign({},il),{x:sl,y:nl,width:tl.width,height:tl.height,pointerType:tl.pointerType,pressure:tl.pressure});return ol.pointerType==="pen"&&(ol.tangentialPressure=tl.tangentialPressure,ol.tiltX=tl.tiltX,ol.tiltY=tl.tiltY,ol.twist=tl.twist),ol},convertMouse(tl,el){const il=_t$1.getBase(tl),{x:sl,y:nl}=el;return Object.assign(Object.assign({},il),{x:sl,y:nl,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(tl,el){const il=St.getTouch(tl),sl=_t$1.getBase(tl),{x:nl,y:ol}=el;return Object.assign(Object.assign({},sl),{x:nl,y:ol,width:1,height:1,pointerType:"touch",multiTouch:tl.touches.length>1,pressure:il.force})},getTouch:tl=>tl.targetTouches[0]||tl.changedTouches[0]},Lt={convert(tl){const el=_t$1.getBase(tl);return Object.assign(Object.assign({},el),{code:tl.code,key:tl.key})}},{pathCanDrag:kt}=_t$1;class Tt extends Mt$1{get notPointer(){const{p:el}=this;return el.type!=="pointer"||el.touch||this.useMultiTouch}get notTouch(){const{p:el}=this;return el.type==="mouse"||this.usePointer}get notMouse(){return this.usePointer||this.useTouch}__listenEvents(){super.__listenEvents();const el=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,pointerleave:this.onPointerLeave,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:il,windowEvents:sl}=this;for(let nl in il)il[nl]=il[nl].bind(this),el.addEventListener(nl,il[nl]);for(let nl in sl)sl[nl]=sl[nl].bind(this),window.addEventListener(nl,sl[nl])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:el,windowEvents:il}=this;for(let sl in el)this.view.removeEventListener(sl,el[sl]),this.viewEvents={};for(let sl in il)window.removeEventListener(sl,il[sl]),this.windowEvents={}}getTouches(el){const il=[];for(let sl=0,nl=el.length;sl<nl;sl++)il.push(el[sl]);return il}preventDefaultPointer(el){const{pointer:il}=this.config;il.preventDefault&&el.preventDefault()}preventDefaultWheel(el){const{wheel:il}=this.config;il.preventDefault&&el.preventDefault()}preventWindowPointer(el){return!this.downData&&el.target!==this.view}onKeyDown(el){this.keyDown(Lt.convert(el))}onKeyUp(el){this.keyUp(Lt.convert(el))}onContextMenu(el){this.config.pointer.preventDefaultMenu&&el.preventDefault(),this.menu(St.convert(el,this.getLocal(el)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(el){this.preventDefaultPointer(el),this.notPointer||(this.usePointer||(this.usePointer=!0),this.pointerDown(St.convert(el,this.getLocal(el))))}onPointerMove(el,il){if(this.notPointer||this.preventWindowPointer(el))return;this.usePointer||(this.usePointer=!0);const sl=St.convert(el,this.getLocal(el,!0));il?this.pointerHover(sl):this.pointerMove(sl)}onPointerLeave(el){this.onPointerMove(el,!0)}onPointerUp(el){this.downData&&this.preventDefaultPointer(el),this.notPointer||this.preventWindowPointer(el)||this.pointerUp(St.convert(el,this.getLocal(el)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(el){this.preventDefaultPointer(el),this.notMouse||this.pointerDown(St.convertMouse(el,this.getLocal(el)))}onMouseMove(el){this.notMouse||this.preventWindowPointer(el)||this.pointerMove(St.convertMouse(el,this.getLocal(el,!0)))}onMouseUp(el){this.downData&&this.preventDefaultPointer(el),this.notMouse||this.preventWindowPointer(el)||this.pointerUp(St.convertMouse(el,this.getLocal(el)))}onMouseCancel(){this.notMouse||this.pointerCancel()}onTouchStart(el){const il=St.getTouch(el),sl=this.getLocal(il,!0),{preventDefault:nl}=this.config.touch;(nl===!0||nl==="auto"&&kt(this.findPath(sl)))&&el.preventDefault(),this.multiTouchStart(el),this.notTouch||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(St.convertTouch(el,sl)))}onTouchMove(el){if(this.multiTouchMove(el),this.notTouch||this.preventWindowPointer(el))return;const il=St.getTouch(el);this.pointerMove(St.convertTouch(el,this.getLocal(il)))}onTouchEnd(el){if(this.multiTouchEnd(),this.notTouch||this.preventWindowPointer(el))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const il=St.getTouch(el);this.pointerUp(St.convertTouch(el,this.getLocal(il)))}onTouchCancel(){this.notTouch||this.pointerCancel()}multiTouchStart(el){this.useMultiTouch=el.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(el.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(el){if(this.useMultiTouch&&el.touches.length>1){const il=this.getTouches(el.touches),sl=this.getKeepTouchList(this.touches,il);sl.length>1&&(this.multiTouch(_t$1.getBase(el),sl),this.touches=il)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(el,il){let sl;const nl=[];return el.forEach(ol=>{sl=il.find(rl=>rl.identifier===ol.identifier),sl&&nl.push({from:this.getLocal(ol),to:this.getLocal(sl)})}),nl}getLocalTouchs(el){return el.map(il=>this.getLocal(il))}onWheel(el){this.preventDefaultWheel(el),this.wheel(Object.assign(Object.assign(Object.assign({},_t$1.getBase(el)),this.getLocal(el)),{deltaX:el.deltaX,deltaY:el.deltaY}))}onGesturestart(el){this.useMultiTouch||(this.preventDefaultWheel(el),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(el){if(this.useMultiTouch)return;this.preventDefaultWheel(el);const il=_t$1.getBase(el);Object.assign(il,this.getLocal(el));const sl=el.scale/this.lastGestureScale,nl=(el.rotation-this.lastGestureRotation)/Math.PI*180*(I$1.within(this.config.wheel.rotateSpeed,0,1)/4+.1);this.zoom(Object.assign(Object.assign({},il),{scale:sl*sl})),this.rotate(Object.assign(Object.assign({},il),{rotation:nl})),this.lastGestureScale=el.scale,this.lastGestureRotation=el.rotation}onGestureend(el){this.useMultiTouch||(this.preventDefaultWheel(el),this.transformEnd())}setCursor(el){super.setCursor(el);const il=[];this.eachCursor(el,il),d(il[il.length-1])&&il.push("default"),this.canvas.view.style.cursor=il.map(sl=>d(sl)?`url(${sl.url}) ${sl.x||0} ${sl.y||0}`:sl).join(",")}eachCursor(el,il,sl=0){if(sl++,l(el))el.forEach(nl=>this.eachCursor(nl,il,sl));else{const nl=i(el)&&St$1.get(el);nl&&sl<2?this.eachCursor(nl,il,sl):il.push(el)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function Bt(tl,el,il){tl.__.__font?Ft$2.fillText(tl,el,il):tl.__.windingRule?el.fill(tl.__.windingRule):el.fill()}function Et(tl,el,il,sl,nl){const ol=il.__;d(tl)?Ft$2.drawStrokesStyle(tl,el,!1,il,sl,nl):(sl.setStroke(tl,ol.__strokeWidth*el,ol),sl.stroke()),ol.__useArrow&&Ft$2.strokeArrow(tl,il,sl,nl)}function Pt(tl,el,il,sl,nl){const ol=il.__;d(tl)?Ft$2.drawStrokesStyle(tl,el,!0,il,sl,nl):(sl.setStroke(tl,ol.__strokeWidth*el,ol),Ft$2.drawTextStroke(il,sl,nl))}function Rt(tl,el,il,sl,nl){const ol=sl.getSameCanvas(!0,!0);ol.font=il.__.__font,Pt(tl,2,il,ol,nl),ol.blendMode=el==="outside"?"destination-out":"destination-in",Ft$2.fillText(il,ol,nl),ol.blendMode="normal",co.copyCanvasByWorld(il,sl,ol),ol.recycle(il.__nowWorld)}const{getSpread:Mt,copyAndSpread:Ct,toOuterOf:At,getOuterOf:Ot,getByMove:Dt,move:Wt,getIntersectData:It}=zt$2,Ft={};let zt;const{stintSet:jt}=_,{hasTransparent:Ut}=Ct$2;function Gt(tl,el,il){if(!d(el)||el.visible===!1||el.opacity===0)return;let sl;const{boxBounds:nl}=il.__layout,{type:ol}=el;switch(ol){case"image":case"film":case"video":if(!el.url)return;sl=Wt$2.image(il,tl,el,nl,!zt||!zt[el.url]),ol!=="image"&&Wt$2[ol](sl);break;case"linear":sl=Et$2.linearGradient(el,nl);break;case"radial":sl=Et$2.radialGradient(el,nl);break;case"angular":sl=Et$2.conicGradient(el,nl);break;case"solid":const{color:rl,opacity:al}=el;sl={type:ol,style:Ct$2.string(rl,al)};break;default:s(el.r)||(sl={type:"solid",style:Ct$2.string(el)})}if(sl&&(sl.originPaint=el,i(sl.style)&&Ut(sl.style)&&(sl.isTransparent=!0),el.style)){if(el.style.strokeWidth===0)return;sl.strokeStyle=el.style}return sl}const Yt={compute:function(tl,el){const il=el.__,sl=[];let nl,ol,rl,al=il.__input[tl];l(al)||(al=[al]),zt=Wt$2.recycleImage(tl,il);for(let ll,cl=0,ul=al.length;cl<ul;cl++)(ll=Gt(tl,al[cl],el))&&(sl.push(ll),ll.strokeStyle&&(rl||(rl=1),ll.strokeStyle.strokeWidth&&(rl=Math.max(rl,ll.strokeStyle.strokeWidth))));il["_"+tl]=sl.length?sl:void 0,sl.length?(sl.every(ll=>ll.isTransparent)&&(sl.some(ll=>ll.image)&&(nl=!0),ol=!0),tl==="fill"?(jt(il,"__isAlphaPixelFill",nl),jt(il,"__isTransparentFill",ol)):(jt(il,"__isAlphaPixelStroke",nl),jt(il,"__isTransparentStroke",ol),jt(il,"__hasMultiStrokeStyle",rl))):il.__removePaint(tl,!1)},fill:function(tl,el,il,sl){il.fillStyle=tl,Bt(el,il,sl)},fills:function(tl,el,il,sl){let nl,ol,rl;for(let al=0,ll=tl.length;al<ll;al++){if(nl=tl[al],ol=nl.originPaint,nl.image){if(rl?rl++:rl=1,Wt$2.checkImage(nl,!el.__.__font,el,il,sl))continue;if(!nl.style){rl===1&&nl.image.isPlacehold&&el.drawImagePlaceholder(nl,il,sl);continue}}if(il.fillStyle=nl.style,nl.transform||ol.scaleFixed){if(il.save(),nl.transform&&il.transform(nl.transform),ol.scaleFixed){const{scaleX:cl,scaleY:ul}=el.getRenderScaleData(!0);(ol.scaleFixed===!0||ol.scaleFixed==="zoom-in"&&cl>1&&ul>1)&&il.scale(1/cl,1/ul)}ol.blendMode&&(il.blendMode=ol.blendMode),Bt(el,il,sl),il.restore()}else ol.blendMode?(il.saveBlendMode(ol.blendMode),Bt(el,il,sl),il.restoreBlendMode()):Bt(el,il,sl)}},fillPathOrText:Bt,fillText:function(tl,el,il){const sl=tl.__,{rows:nl,decorationY:ol}=sl.__textDrawData;let rl;sl.__isPlacehold&&sl.placeholderColor&&(el.fillStyle=sl.placeholderColor);for(let al=0,ll=nl.length;al<ll;al++)rl=nl[al],rl.text?el.fillText(rl.text,rl.x,rl.y):rl.data&&rl.data.forEach(cl=>{el.fillText(cl.char,cl.x,rl.y)});if(ol){const{decorationColor:al,decorationHeight:ll}=sl.__textDrawData;al&&(el.fillStyle=al),nl.forEach(cl=>ol.forEach(ul=>el.fillRect(cl.x,cl.y+ul,cl.width,ll)))}},stroke:function(tl,el,il,sl){const nl=el.__;if(nl.__strokeWidth)if(nl.__font)Ft$2.strokeText(tl,el,il,sl);else switch(nl.strokeAlign){case"center":Et(tl,1,el,il,sl);break;case"inside":(function(ol,rl,al,ll){al.save(),al.clipUI(rl),Et(ol,2,rl,al,ll),al.restore()})(tl,el,il,sl);break;case"outside":(function(ol,rl,al,ll){const cl=rl.__;if(cl.__fillAfterStroke)Et(ol,2,rl,al,ll);else{const{renderBounds:ul}=rl.__layout,dl=al.getSameCanvas(!0,!0);rl.__drawRenderPath(dl),Et(ol,2,rl,dl,ll),dl.clipUI(cl),dl.clearWorld(ul),co.copyCanvasByWorld(rl,al,dl),dl.recycle(rl.__nowWorld)}})(tl,el,il,sl)}},strokes:function(tl,el,il,sl){Ft$2.stroke(tl,el,il,sl)},strokeText:function(tl,el,il,sl){switch(el.__.strokeAlign){case"center":Pt(tl,1,el,il,sl);break;case"inside":Rt(tl,"inside",el,il,sl);break;case"outside":el.__.__fillAfterStroke?Pt(tl,2,el,il,sl):Rt(tl,"outside",el,il,sl)}},drawTextStroke:function(tl,el,il){let sl,nl=tl.__.__textDrawData;const{rows:ol,decorationY:rl}=nl;for(let al=0,ll=ol.length;al<ll;al++)sl=ol[al],sl.text?el.strokeText(sl.text,sl.x,sl.y):sl.data&&sl.data.forEach(cl=>{el.strokeText(cl.char,cl.x,sl.y)});if(rl){const{decorationHeight:al}=nl;ol.forEach(ll=>rl.forEach(cl=>el.strokeRect(ll.x,ll.y+cl,ll.width,al)))}},drawStrokesStyle:function(tl,el,il,sl,nl,ol){let rl;const al=sl.__,{__hasMultiStrokeStyle:ll}=al;ll||nl.setStroke(void 0,al.__strokeWidth*el,al);for(let cl=0,ul=tl.length;cl<ul;cl++)if(rl=tl[cl],(!rl.image||!Wt$2.checkImage(rl,!1,sl,nl,ol))&&rl.style){if(ll){const{strokeStyle:dl}=rl;dl?nl.setStroke(rl.style,al.__getRealStrokeWidth(dl)*el,al,dl):nl.setStroke(rl.style,al.__strokeWidth*el,al)}else nl.strokeStyle=rl.style;rl.originPaint.blendMode?(nl.saveBlendMode(rl.originPaint.blendMode),il?Ft$2.drawTextStroke(sl,nl,ol):nl.stroke(),nl.restoreBlendMode()):il?Ft$2.drawTextStroke(sl,nl,ol):nl.stroke()}},shape:function(tl,el,il){const sl=el.getSameCanvas(),nl=el.bounds,ol=tl.__nowWorld,rl=tl.__layout,al=tl.__nowWorldShapeBounds||(tl.__nowWorldShapeBounds={});let ll,cl,ul,dl,fl,hl;At(rl.strokeSpread?(Ct(Ft,rl.boxBounds,rl.strokeSpread),Ft):rl.boxBounds,ol,al);let{scaleX:_l,scaleY:yl}=tl.getRenderScaleData(!0);if(nl.includes(al))hl=sl,ll=fl=al,cl=ol;else{let ml;if($t$2.fullImageShadow)ml=al;else{const Il=rl.renderShapeSpread?Mt(nl,v.swapAndScale(rl.renderShapeSpread,_l,yl)):nl;ml=It(Il,al)}dl=nl.getFitMatrix(ml);let{a:Tl,d:bl}=dl;dl.a<1&&(hl=el.getSameCanvas(),tl.__renderShape(hl,il),_l*=Tl,yl*=bl),fl=Ot(al,dl),ll=Dt(fl,-dl.e,-dl.f),cl=Ot(ol,dl),Wt(cl,-dl.e,-dl.f);const Gl=il.matrix;Gl?(ul=new pt$2(dl),ul.multiply(Gl),Tl*=Gl.scaleX,bl*=Gl.scaleY):ul=dl,ul.withScale(Tl,bl),il=Object.assign(Object.assign({},il),{matrix:ul})}return tl.__renderShape(sl,il),{canvas:sl,matrix:ul,fitMatrix:dl,bounds:ll,renderBounds:cl,worldCanvas:hl,shapeBounds:fl,scaleX:_l,scaleY:yl}}};let Xt,Vt=new Vt$3;const{isSame:Nt}=zt$2;function Ht(tl,el,il,sl,nl,ol){const rl=tl.__;if(el==="fill"&&!rl.__naturalWidth&&(rl.__naturalWidth=sl.width/rl.pixelRatio,rl.__naturalHeight=sl.height/rl.pixelRatio,rl.__autoSide))return tl.forceUpdate("width"),tl.__proxyData&&(tl.setProxyAttr("width",rl.width),tl.setProxyAttr("height",rl.height)),!1;if(!nl.data){Wt$2.createData(nl,sl,il,ol);const{transform:al}=nl.data,{opacity:ll,blendMode:cl}=il,ul=al&&!al.onlyScale||rl.path||rl.cornerRadius;(ul||ll&&ll<1||cl)&&(nl.complex=!ul||2)}return!0}function qt(tl,el){$t(tl,Vo.LOAD,el)}function Kt(tl,el){$t(tl,Vo.LOADED,el)}function Qt(tl,el,il){el.error=il,tl.forceUpdate("surface"),$t(tl,Vo.ERROR,el)}function $t(tl,el,il){tl.hasEvent(el)&&tl.emitEvent(new Vo(el,il))}function Zt(tl,el){const{leafer:il}=tl;il&&il.viewReady&&(il.renderer.ignore=el)}const{get:Jt,translate:te}=q$1,ee=new Vt$3,ie={},se={};function ne(tl,el,il,sl){const nl=i(tl)||sl?(sl?il-sl*el:il%el)/((sl||Math.floor(il/el))-1):tl;return tl==="auto"&&nl<0?0:nl}let oe={},re=X$1();const{get:ae,set:he,rotateOfOuter:le,translate:ce,scaleOfOuter:de,multiplyParent:ue,scale:fe,rotate:pe,skew:ge}=q$1;function we(tl,el,il,sl,nl,ol,rl,al){rl&&pe(tl,rl),al&&ge(tl,al.x,al.y),nl&&fe(tl,nl,ol),ce(tl,el.x+il,el.y+sl)}const{get:_e,scale:me,copy:ve}=q$1,{getFloorScale:ye}=I$1,{abs:xe}=Math,be={image:function(tl,el,il,sl,nl){let ol,rl;const al=en.get(il,il.type);return Xt&&il===Xt.paint&&Nt(sl,Xt.boxBounds)?ol=Xt.leafPaint:(ol={type:il.type,image:al},al.hasAlphaPixel&&(ol.isTransparent=!0),Xt=al.use>1?{leafPaint:ol,paint:il,boxBounds:Vt.set(sl)}:null),(nl||al.loading)&&(rl={image:al,attrName:el,attrValue:il}),al.ready?(Ht(tl,el,il,al,ol,sl),nl&&(qt(tl,rl),Kt(tl,rl))):al.error?nl&&Qt(tl,rl,al.error):(nl&&(Zt(tl,!0),qt(tl,rl)),ol.loadId=al.load(()=>{Zt(tl,!1),tl.destroyed||(Ht(tl,el,il,al,ol,sl)&&(al.hasAlphaPixel&&(tl.__layout.hitCanvasChanged=!0),tl.forceUpdate("surface")),Kt(tl,rl)),ol.loadId=void 0},ll=>{Zt(tl,!1),Qt(tl,rl,ll),ol.loadId=void 0},il.lod&&al.getThumbSize(il.lod)),tl.placeholderColor&&(tl.placeholderDelay?setTimeout(()=>{al.ready||(al.isPlacehold=!0,tl.forceUpdate("surface"))},tl.placeholderDelay):al.isPlacehold=!0)),ol},checkImage:function(tl,el,il,sl,nl){const{scaleX:ol,scaleY:rl}=Wt$2.getImageRenderScaleData(tl,il,sl,nl),al=tl.film?tl.nowIndex:ol+"-"+rl,{image:ll,data:cl,originPaint:ul}=tl,{exporting:dl,snapshot:fl}=nl;return!(!cl||tl.patternId===al&&!dl||fl)&&(el&&(cl.repeat?el=!1:ul.changeful||tl.film||$t$2.name==="miniapp"&&$o.isResizing(il)||dl||(el=$t$2.image.isLarge(ll,ol,rl)||ll.width*ol>8096||ll.height*rl>8096)),el?(il.__.__isFastShadow&&(sl.fillStyle=tl.style||"#000",sl.fill()),Wt$2.drawImage(tl,ol,rl,il,sl,nl),!0):(!tl.style||ul.sync||dl?Wt$2.createPattern(tl,il,sl,nl):Wt$2.createPatternTask(tl,il,sl,nl),!1))},drawImage:function(tl,el,il,sl,nl,ol){const{data:rl,image:al,complex:ll}=tl;let{width:cl,height:ul}=al;if(ll){const{blendMode:dl,opacity:fl}=tl.originPaint,{transform:hl}=rl;nl.save(),ll===2&&nl.clipUI(sl),dl&&(nl.blendMode=dl),fl&&(nl.opacity*=fl),hl&&nl.transform(hl),al.render(nl,0,0,cl,ul,sl,tl,el,il),nl.restore()}else rl.scaleX&&(cl*=rl.scaleX,ul*=rl.scaleY),al.render(nl,0,0,cl,ul,sl,tl,el,il)},getImageRenderScaleData:function(tl,el,il,sl){const nl=el.getRenderScaleData(!0,tl.originPaint.scaleFixed),{data:ol}=tl;if(il){const{pixelRatio:rl}=il;nl.scaleX*=rl,nl.scaleY*=rl}return ol&&ol.scaleX&&(nl.scaleX*=Math.abs(ol.scaleX),nl.scaleY*=Math.abs(ol.scaleY)),nl},recycleImage:function(tl,el){const il=el["_"+tl];if(l(il)){let sl,nl,ol,rl,al;for(let ll=0,cl=il.length;ll<cl;ll++)sl=il[ll],nl=sl.image,al=nl&&nl.url,al&&(ol||(ol={}),ol[al]=!0,en.recyclePaint(sl),nl.loading&&(rl||(rl=el.__input&&el.__input[tl]||[],l(rl)||(rl=[rl])),nl.unload(il[ll].loadId,!rl.some(ul=>ul.url===al))));return ol}return null},createPatternTask:function(tl,el,il,sl){tl.patternTask||(tl.patternTask=en.patternTasker.add(()=>J(this,void 0,void 0,function*(){Wt$2.createPattern(tl,el,il,sl),el.forceUpdate("surface")}),0,()=>(tl.patternTask=null,il.bounds.hit(el.__nowWorld))))},createPattern:function(tl,el,il,sl){let{scaleX:nl,scaleY:ol}=Wt$2.getImageRenderScaleData(tl,el,il,sl),rl=tl.film?tl.nowIndex:nl+"-"+ol;if(tl.patternId!==rl&&!el.destroyed&&(!$t$2.image.isLarge(tl.image,nl,ol)||tl.data.repeat)){const{image:al,data:ll}=tl,{opacity:cl,filters:ul}=tl.originPaint,{transform:dl,gap:fl}=ll,hl=Wt$2.getPatternFixScale(tl,nl,ol);let _l,yl,ml,{width:Tl,height:bl}=al;hl&&(nl*=hl,ol*=hl),Tl*=nl,bl*=ol,fl&&(yl=fl.x*nl/xe(ll.scaleX||1),ml=fl.y*ol/xe(ll.scaleY||1)),(dl||nl!==1||ol!==1)&&(nl*=ye(Tl+(yl||0)),ol*=ye(bl+(ml||0)),_l=_e(),dl&&ve(_l,dl),me(_l,1/nl,1/ol));const Gl=al.getCanvas(Tl,bl,cl,ul,yl,ml,el.leafer&&el.leafer.config.smooth,ll.interlace),Il=al.getPattern(Gl,ll.repeat||$t$2.origin.noRepeat||"no-repeat",_l,tl);tl.style=Il,tl.patternId=rl}},getPatternFixScale:function(tl,el,il){const{image:sl}=tl;let nl,ol=$t$2.image.maxPatternSize,rl=sl.width*sl.height;return sl.isSVG?el>1&&(nl=Math.ceil(el)/el):ol>rl&&(ol=rl),(rl*=el*il)>ol&&(nl=Math.sqrt(ol/rl)),nl},createData:function(tl,el,il,sl){tl.data=Wt$2.getPatternData(il,sl,el)},getPatternData:function(tl,el,il){tl.padding&&(el=ee.set(el).shrink(tl.padding)),tl.mode==="strench"&&(tl.mode="stretch");const{width:sl,height:nl}=il,{mode:ol,align:rl,offset:al,scale:ll,size:cl,rotation:ul,skew:dl,clipSize:fl,repeat:hl,gap:_l,interlace:yl}=tl,ml=el.width===sl&&el.height===nl,Tl={mode:ol},bl=rl!=="center"&&(ul||0)%180==90;let Gl,Il;switch(zt$2.set(se,0,0,bl?nl:sl,bl?sl:nl),ol&&ol!=="cover"&&ol!=="fit"?((ll||cl)&&(I$1.getScaleData(ll,cl,il,ie),Gl=ie.scaleX,Il=ie.scaleY),(rl||_l||hl)&&(Gl&&zt$2.scale(se,Gl,Il,!0),rl&&kt$3.toPoint(rl,se,el,se,!0,!0))):ml&&!ul||(Gl=Il=zt$2.getFitScale(el,se,ol!=="fit"),zt$2.put(el,il,rl,Gl,!1,se),zt$2.scale(se,Gl,Il,!0)),al&&ot$2.move(se,al),ol){case"stretch":ml?Gl&&(Gl=Il=void 0):(Gl=el.width/sl,Il=el.height/nl,Wt$2.stretchMode(Tl,el,Gl,Il));break;case"normal":case"clip":if(se.x||se.y||Gl||fl||ul||dl){let zl,Fl;fl&&(zl=el.width/fl.width,Fl=el.height/fl.height),Wt$2.clipMode(Tl,el,se.x,se.y,Gl,Il,ul,dl,zl,Fl),zl&&(Gl=Gl?Gl*zl:zl,Il=Il?Il*Fl:Fl)}break;case"repeat":(!ml||Gl||ul||dl)&&Wt$2.repeatMode(Tl,el,sl,nl,se.x,se.y,Gl,Il,ul,dl,rl,tl.freeTransform),hl||(Tl.repeat="repeat");const Ml=d(hl);(_l||Ml)&&(Tl.gap=(function(zl,Fl,Bl,Wl,Hl){let $l,Ul;return d(zl)?($l=zl.x,Ul=zl.y):$l=Ul=zl,{x:ne($l,Bl,Hl.width,Fl&&Fl.x),y:ne(Ul,Wl,Hl.height,Fl&&Fl.y)}})(_l,Ml&&hl,se.width,se.height,el));break;default:Gl&&Wt$2.fillOrFitMode(Tl,el,se.x,se.y,Gl,Il,ul)}return Tl.transform||(el.x||el.y)&&te(Tl.transform=Jt(),el.x,el.y),Gl&&(Tl.scaleX=Gl,Tl.scaleY=Il),hl&&(Tl.repeat=i(hl)?hl==="x"?"repeat-x":"repeat-y":"repeat"),yl&&(Tl.interlace=o(yl)||yl.type==="percent"?{type:"x",offset:yl}:yl),Tl},stretchMode:function(tl,el,il,sl){const nl=ae(),{x:ol,y:rl}=el;ol||rl?ce(nl,ol,rl):il>0&&sl>0&&(nl.onlyScale=!0),fe(nl,il,sl),tl.transform=nl},fillOrFitMode:function(tl,el,il,sl,nl,ol,rl){const al=ae();ce(al,el.x+il,el.y+sl),fe(al,nl,ol),rl&&le(al,{x:el.x+el.width/2,y:el.y+el.height/2},rl),tl.transform=al},clipMode:function(tl,el,il,sl,nl,ol,rl,al,ll,cl){const ul=ae();we(ul,el,il,sl,nl,ol,rl,al),ll&&(rl||al?(he(re),de(re,el,ll,cl),ue(ul,re)):de(ul,el,ll,cl)),tl.transform=ul},repeatMode:function(tl,el,il,sl,nl,ol,rl,al,ll,cl,ul,dl){const fl=ae();if(dl)we(fl,el,nl,ol,rl,al,ll,cl);else{if(ll)if(ul==="center")le(fl,{x:il/2,y:sl/2},ll);else switch(pe(fl,ll),ll){case 90:ce(fl,sl,0);break;case 180:ce(fl,il,sl);break;case 270:ce(fl,0,il)}oe.x=el.x+nl,oe.y=el.y+ol,ce(fl,oe.x,oe.y),rl&&de(fl,oe,rl,al)}tl.transform=fl}},{toPoint:Se}=bt$3,{hasTransparent:Le}=Ct$2,ke={},Te={};function Be(tl,el,il,sl){if(il){let nl,ol,rl,al;for(let ll=0,cl=il.length;ll<cl;ll++)nl=il[ll],i(nl)?(rl=ll/(cl-1),ol=Ct$2.string(nl,sl)):(rl=nl.offset,ol=Ct$2.string(nl.color,sl)),el.addColorStop(rl,ol),!al&&Le(ol)&&(al=!0);al&&(tl.isTransparent=!0)}}const{getAngle:Ee,getDistance:Pe}=ot$2,{get:Re,rotateOfOuter:Me,scaleOfOuter:Ce}=q$1,{toPoint:Ae}=bt$3,Oe={},De={};function We(tl,el,il,sl,nl){let ol;const{width:rl,height:al}=tl;if(rl!==al||sl){const ll=Ee(el,il);ol=Re(),nl?(Ce(ol,el,rl/al*(sl||1),1),Me(ol,el,ll+90)):(Ce(ol,el,1,rl/al*(sl||1)),Me(ol,el,ll))}return ol}const{getDistance:Ie}=ot$2,{toPoint:Fe}=bt$3,ze={},je={},Ue={linearGradient:function(tl,el){let{from:il,to:sl,type:nl,opacity:ol}=tl;Se(il||"top",el,ke),Se(sl||"bottom",el,Te);const rl=$t$2.canvas.createLinearGradient(ke.x,ke.y,Te.x,Te.y),al={type:nl,style:rl};return Be(al,rl,tl.stops,ol),al},radialGradient:function(tl,el){let{from:il,to:sl,type:nl,opacity:ol,stretch:rl}=tl;Ae(il||"center",el,Oe),Ae(sl||"bottom",el,De);const al=$t$2.canvas.createRadialGradient(Oe.x,Oe.y,0,Oe.x,Oe.y,Pe(Oe,De)),ll={type:nl,style:al};Be(ll,al,tl.stops,ol);const cl=We(el,Oe,De,rl,!0);return cl&&(ll.transform=cl),ll},conicGradient:function(tl,el){let{from:il,to:sl,type:nl,opacity:ol,stretch:rl}=tl;Fe(il||"center",el,ze),Fe(sl||"bottom",el,je);const al=$t$2.conicGradientSupport?$t$2.canvas.createConicGradient(0,ze.x,ze.y):$t$2.canvas.createRadialGradient(ze.x,ze.y,0,ze.x,ze.y,Ie(ze,je)),ll={type:nl,style:al};Be(ll,al,tl.stops,ol);const cl=We(el,ze,je,rl||1,$t$2.conicGradientRotate90);return cl&&(ll.transform=cl),ll},getTransform:We},{copy:Ge,move:Ye,toOffsetOutBounds:Xe}=zt$2,{max:Ve,abs:Ne}=Math,He={},qe=new pt$2,Ke={};function Qe(tl,el){let il,sl,nl,ol,rl=0,al=0,ll=0,cl=0;return el.forEach(ul=>{il=ul.x||0,sl=ul.y||0,ol=1.5*(ul.blur||0),nl=Ne(ul.spread||0),rl=Ve(rl,nl+ol-sl),al=Ve(al,nl+ol+il),ll=Ve(ll,nl+ol+sl),cl=Ve(cl,nl+ol-il)}),rl===al&&al===ll&&ll===cl?rl:[rl,al,ll,cl]}function $e(tl,el,il){const{shapeBounds:sl}=il;let nl,ol;$t$2.fullImageShadow?(Ge(He,tl.bounds),Ye(He,el.x-sl.x,el.y-sl.y),nl=tl.bounds,ol=He):(nl=sl,ol=el),tl.copyWorld(il.canvas,nl,ol)}const{toOffsetOutBounds:Ze}=zt$2,Je={},ti=Qe,ei={shadow:function(tl,el,il){let sl,nl;const{__nowWorld:ol}=tl,{shadow:rl}=tl.__,{worldCanvas:al,bounds:ll,renderBounds:cl,shapeBounds:ul,scaleX:dl,scaleY:fl}=il,hl=el.getSameCanvas(),_l=rl.length-1;Xe(ll,Ke,cl),rl.forEach((yl,ml)=>{let Tl=1;if(yl.scaleFixed){const bl=Math.abs(ol.scaleX);bl>1&&(Tl=1/bl)}hl.setWorldShadow(Ke.offsetX+(yl.x||0)*dl*Tl,Ke.offsetY+(yl.y||0)*fl*Tl,(yl.blur||0)*dl*Tl,Ct$2.string(yl.color)),nl=Tt$2.getShadowTransform(tl,hl,il,yl,Ke,Tl),nl&&hl.setTransform(nl),$e(hl,Ke,il),nl&&hl.resetTransform(),sl=cl,yl.box&&(hl.restore(),hl.save(),al&&(hl.copyWorld(hl,cl,ol,"copy"),sl=ol),al?hl.copyWorld(al,ol,ol,"destination-out"):hl.copyWorld(il.canvas,ul,ll,"destination-out")),co.copyCanvasByWorld(tl,el,hl,sl,yl.blendMode),_l&&ml<_l&&hl.clearWorld(sl)}),hl.recycle(sl)},innerShadow:function(tl,el,il){let sl,nl;const{__nowWorld:ol}=tl,{innerShadow:rl}=tl.__,{worldCanvas:al,bounds:ll,renderBounds:cl,shapeBounds:ul,scaleX:dl,scaleY:fl}=il,hl=el.getSameCanvas(),_l=rl.length-1;Ze(ll,Je,cl),rl.forEach((yl,ml)=>{let Tl=1;if(yl.scaleFixed){const bl=Math.abs(ol.scaleX);bl>1&&(Tl=1/bl)}hl.save(),hl.setWorldShadow(Je.offsetX+(yl.x||0)*dl*Tl,Je.offsetY+(yl.y||0)*fl*Tl,(yl.blur||0)*dl*Tl),nl=Tt$2.getShadowTransform(tl,hl,il,yl,Je,Tl,!0),nl&&hl.setTransform(nl),$e(hl,Je,il),hl.restore(),al?(hl.copyWorld(hl,cl,ol,"copy"),hl.copyWorld(al,ol,ol,"source-out"),sl=ol):(hl.copyWorld(il.canvas,ul,ll,"source-out"),sl=cl),hl.fillWorld(sl,Ct$2.string(yl.color),"source-in"),co.copyCanvasByWorld(tl,el,hl,sl,yl.blendMode),_l&&ml<_l&&hl.clearWorld(sl)}),hl.recycle(sl)},blur:function(tl,el,il){const{blur:sl}=tl.__;il.setWorldBlur(sl*tl.__nowWorld.a),il.copyWorldToInner(el,tl.__nowWorld,tl.__layout.renderBounds),il.filter="none"},backgroundBlur:function(tl,el,il){},getShadowRenderSpread:Qe,getShadowTransform:function(tl,el,il,sl,nl,ol,rl){if(sl.spread){const al=2*sl.spread*ol*(rl?-1:1),{width:ll,height:cl}=tl.__layout.strokeBounds;return qe.set().scaleOfOuter({x:(nl.x+nl.width/2)*el.pixelRatio,y:(nl.y+nl.height/2)*el.pixelRatio},1+al/ll,1+al/cl),qe}},isTransformShadow(tl){},getInnerShadowSpread:ti},{excludeRenderBounds:ii}=xo;let si;function ni(tl,el,il,sl,nl,ol,rl,al){switch(el){case"grayscale":si||(si=!0,nl.useGrayscaleAlpha(tl.__nowWorld));case"alpha":(function(ll,cl,ul,dl,fl,hl){const _l=ll.__nowWorld;ul.resetTransform(),ul.opacity=1,ul.useMask(dl,_l),hl&&dl.recycle(_l),ri(ll,cl,ul,1,fl,hl)})(tl,il,sl,nl,rl,al);break;case"opacity-path":ri(tl,il,sl,ol,rl,al);break;case"path":al&&il.restore()}}function oi(tl){return tl.getSameCanvas(!1,!0)}function ri(tl,el,il,sl,nl,ol){const rl=tl.__nowWorld;el.resetTransform(),el.opacity=sl,el.copyWorld(il,rl,void 0,nl),ol?il.recycle(rl):il.clearWorld(rl)}ye$1.prototype.__renderMask=function(tl,el){let il,sl,nl,ol,rl,al;const{children:ll}=this;for(let cl=0,ul=ll.length;cl<ul;cl++){if(il=ll[cl],al=il.__.mask,al){rl&&(ni(this,rl,tl,nl,sl,ol,void 0,!0),sl=nl=null),al!=="clipping"&&al!=="clipping-path"||ii(il,el)||il.__render(tl,el),ol=il.__.opacity,si=!1,al==="path"||al==="clipping-path"?(ol<1?(rl="opacity-path",nl||(nl=oi(tl))):(rl="path",tl.save()),il.__clip(nl||tl,el)):(rl=al==="grayscale"?"grayscale":"alpha",sl||(sl=oi(tl)),nl||(nl=oi(tl)),il.__render(sl,el));continue}const dl=ol===1&&il.__.__blendMode;dl&&ni(this,rl,tl,nl,sl,ol,void 0,!1),ii(il,el)||il.__render(nl||tl,el),dl&&ni(this,rl,tl,nl,sl,ol,dl,!1)}ni(this,rl,tl,nl,sl,ol,void 0,!0)};const ai=`>)]}%!?,.:;'"\u300B\uFF09\u300D\u3009\u300F\u3017\u3011\u3015\uFF5D\u2510\uFF1E\u2019\u201D\uFF01\uFF1F\uFF0C\u3001\u3002\uFF1A\uFF1B\u2030`,hi=ai+"_#~&*+\\=|\u226E\u226F\u2248\u2260\uFF1D\u2026",li=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map(([tl,el])=>`[\\u${tl.toString(16)}-\\u${el.toString(16)}]`).join("|"));function ci(tl){const el={};return tl.split("").forEach(il=>el[il]=!0),el}const di=ci("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),ui=ci(`{[(<'"\u300A\uFF08\u300C\u3008\u300E\u3016\u3010\u3014\uFF5B\u250C\uFF1C\u2018\u201C\uFF1D\xA5\uFFE5\uFF04\u20AC\xA3\uFFE1\xA2\uFFE0`),fi=ci(ai),pi=ci(hi),gi=ci("- \u2014\uFF0F\uFF5E\uFF5C\u2506\xB7");var wi;(function(tl){tl[tl.Letter=0]="Letter",tl[tl.Single=1]="Single",tl[tl.Before=2]="Before",tl[tl.After=3]="After",tl[tl.Symbol=4]="Symbol",tl[tl.Break=5]="Break"})(wi||(wi={}));const{Letter:_i,Single:mi,Before:vi,After:yi,Symbol:xi,Break:bi}=wi;function Si(tl){return di[tl]?_i:gi[tl]?bi:ui[tl]?vi:fi[tl]?yi:pi[tl]?xi:li.test(tl)?mi:_i}const Li={trimRight(tl){const{words:el}=tl;let il,sl=0,nl=el.length;for(let ol=nl-1;ol>-1&&(il=el[ol].data[0],il.char===" ");ol--)sl++,tl.width-=il.width;sl&&el.splice(nl-sl,sl)}};function ki(tl,el,il){switch(el){case"title":return il?tl.toUpperCase():tl;case"upper":return tl.toUpperCase();case"lower":return tl.toLowerCase();default:return tl}}const{trimRight:Ti}=Li,{Letter:Bi,Single:Ei,Before:Pi,After:Ri,Symbol:Mi,Break:Ci}=wi;let Ai,Oi,Di,Wi,Ii,Fi,zi,ji,Ui,Gi,Yi,Xi,Vi,Ni,Hi,qi,Ki,Qi=[];function $i(tl,el){Ui&&!ji&&(ji=Ui),Ai.data.push({char:tl,width:el}),Di+=el}function Zi(){Wi+=Di,Ai.width=Di,Oi.words.push(Ai),Ai={data:[]},Di=0}function Ji(){Ni&&(Hi.paraNumber++,Oi.paraStart=!0,Ni=!1),Ui&&(Oi.startCharSize=ji,Oi.endCharSize=Ui,ji=0),Oi.width=Wi,qi.width?Ti(Oi):Ki&&ts(),Qi.push(Oi),Oi={words:[]},Wi=0}function ts(){Wi>(Hi.maxWidth||0)&&(Hi.maxWidth=Wi)}const{top:es,right:is,bottom:ss,left:ns}=mt$3;function os(tl,el,il){const{bounds:sl,rows:nl}=tl;sl[el]+=il;for(let ol=0;ol<nl.length;ol++)nl[ol][el]+=il}const rs={getDrawData:function(tl,el){i(tl)||(tl=String(tl));let il=0,sl=0,nl=el.__getInput("width")||0,ol=el.__getInput("height")||0;const{__padding:rl}=el;rl&&(nl?(il=rl[ns],nl-=rl[is]+rl[ns],!nl&&(nl=.01)):el.autoSizeAlign||(il=rl[ns]),ol?(sl=rl[es],ol-=rl[es]+rl[ss],!ol&&(ol=.01)):el.autoSizeAlign||(sl=rl[es]));const al={bounds:{x:il,y:sl,width:nl,height:ol},rows:[],paraNumber:0,font:$t$2.canvas.font=el.__font};return(function(ll,cl,ul){Hi=ll,Qi=ll.rows,qi=ll.bounds,Ki=!qi.width&&!ul.autoSizeAlign;const{__letterSpacing:dl,paraIndent:fl,textCase:hl}=ul,{canvas:_l}=$t$2,{width:yl}=qi;if(ul.__isCharMode){const ml=ul.textWrap!=="none",Tl=ul.textWrap==="break";Ni=!0,Yi=null,ji=zi=Ui=Di=Wi=0,Ai={data:[]},Oi={words:[]},dl&&(cl=[...cl]);for(let bl=0,Gl=cl.length;bl<Gl;bl++)Fi=cl[bl],Fi===`
`?(Di&&Zi(),Oi.paraEnd=!0,Ji(),Ni=!0):(Gi=Si(Fi),Gi===Bi&&hl!=="none"&&(Fi=ki(Fi,hl,!Di)),zi=_l.measureText(Fi).width,dl&&(dl<0&&(Ui=zi),zi+=dl),Xi=Gi===Ei&&(Yi===Ei||Yi===Bi)||Yi===Ei&&Gi!==Ri,Vi=!(Gi!==Pi&&Gi!==Ei||Yi!==Mi&&Yi!==Ri),Ii=Ni&&fl?yl-fl:yl,ml&&yl&&Wi+Di+zi>Ii&&(Tl?(Di&&Zi(),Wi&&Ji()):(Vi||(Vi=Gi===Bi&&Yi==Ri),(Xi||Vi||Gi===Ci||Gi===Pi||Gi===Ei||Di+zi>Ii)&&Di&&Zi(),Wi&&Ji())),Fi===" "&&Ni!==!0&&Wi+Di===0||(Gi===Ci?(Fi===" "&&Di&&Zi(),$i(Fi,zi),Zi()):((Xi||Vi)&&Di&&Zi(),$i(Fi,zi))),Yi=Gi);Di&&Zi(),Wi&&Ji(),Qi.length>0&&(Qi[Qi.length-1].paraEnd=!0)}else cl.split(`
`).forEach(ml=>{Hi.paraNumber++,Wi=_l.measureText(ml).width,Qi.push({x:fl||0,text:ml,width:Wi,paraStart:!0}),Ki&&ts()})})(al,tl,el),rl&&(function(ll,cl,ul,dl,fl){if(!dl&&ul.autoSizeAlign)switch(ul.textAlign){case"left":os(cl,"x",ll[ns]);break;case"right":os(cl,"x",-ll[is])}if(!fl&&ul.autoSizeAlign)switch(ul.verticalAlign){case"top":os(cl,"y",ll[es]);break;case"bottom":os(cl,"y",-ll[ss])}})(rl,al,el,nl,ol),(function(ll,cl){const{rows:ul,bounds:dl}=ll,fl=ul.length,{__lineHeight:hl,__baseLine:_l,__letterSpacing:yl,__clipText:ml,textAlign:Tl,verticalAlign:bl,paraSpacing:Gl,autoSizeAlign:Il}=cl;let{x:Ml,y:zl,width:Fl,height:Bl}=dl,Wl=hl*fl+(Gl?Gl*(ll.paraNumber-1):0),Hl=_l;if(ml&&Wl>Bl)Wl=Math.max(cl.__autoHeight?Wl:Bl,hl),fl>1&&(ll.overflow=fl);else if(Bl||Il)switch(bl){case"middle":zl+=(Bl-Wl)/2;break;case"bottom":zl+=Bl-Wl}Hl+=zl;let $l,Ul,jl,Vl=Fl||Il?Fl:ll.maxWidth;for(let Yl=0,Ql=fl;Yl<Ql;Yl++){if($l=ul[Yl],$l.x=Ml,$l.width<Fl||$l.width>Fl&&!ml)switch(Tl){case"center":$l.x+=(Vl-$l.width)/2;break;case"right":$l.x+=Vl-$l.width}$l.paraStart&&Gl&&Yl>0&&(Hl+=Gl),$l.y=Hl,Hl+=hl,ll.overflow>Yl&&Hl>Wl&&($l.isOverflow=!0,ll.overflow=Yl+1),Ul=$l.x,jl=$l.width,yl<0&&($l.width<0?(jl=-$l.width+cl.fontSize+yl,Ul-=jl,jl+=cl.fontSize):jl-=yl),Ul<dl.x&&(dl.x=Ul),jl>dl.width&&(dl.width=jl),ml&&Fl&&Fl<jl&&($l.isOverflow=!0,ll.overflow||(ll.overflow=ul.length))}dl.y=zl,dl.height=Wl})(al,el),el.__isCharMode&&(function(ll,cl,ul){const{rows:dl}=ll,{textAlign:fl,paraIndent:hl,__letterSpacing:_l}=cl,yl=ul&&fl.includes("both"),ml=yl||ul&&fl.includes("justify"),Tl=ml&&fl.includes("letter");let bl,Gl,Il,Ml,zl,Fl,Bl,Wl,Hl,$l;dl.forEach(Ul=>{Ul.words&&(zl=hl&&Ul.paraStart?hl:0,Wl=Ul.words.length,ml&&($l=!Ul.paraEnd||yl,Gl=ul-Ul.width-zl,Tl?Ml=Gl/(Ul.words.reduce((jl,Vl)=>jl+Vl.data.length,0)-1):Il=Wl>1?Gl/(Wl-1):0),Fl=_l||Ul.isOverflow||Tl?0:Il?1:2,Ul.isOverflow&&!_l&&(Ul.textMode=!0),Fl===2?(Ul.x+=zl,(function(jl){jl.text="",jl.words.forEach(Vl=>{Vl.data.forEach(Yl=>{jl.text+=Yl.char})})})(Ul)):(Ul.x+=zl,bl=Ul.x,Ul.data=[],Ul.words.forEach((jl,Vl)=>{Fl===1?(Bl={char:"",x:bl},bl=(function(Yl,Ql,ql){return Yl.forEach(Kl=>{ql.char+=Kl.char,Ql+=Kl.width}),Ql})(jl.data,bl,Bl),(Ul.isOverflow||Bl.char!==" ")&&Ul.data.push(Bl)):bl=(function(Yl,Ql,ql,Kl,Jl){return Yl.forEach(Zl=>{(Kl||Zl.char!==" ")&&(Zl.x=Ql,ql.push(Zl)),Ql+=Zl.width,Jl&&(Ql+=Jl)}),Ql})(jl.data,bl,Ul.data,Ul.isOverflow,$l&&Ml),$l&&(Hl=Vl===Wl-1,Il?Hl||(bl+=Il,Ul.width+=Il):Ml&&(Ul.width+=Ml*(jl.data.length-(Hl?1:0))))})),Ul.words=null)})})(al,el,nl),al.overflow&&(function(ll,cl,ul,dl){const{rows:fl,overflow:hl}=ll;let{textOverflow:_l}=cl;if(hl&&fl.splice(hl),dl&&_l&&_l!=="show"){let yl,ml;_l==="hide"?_l="":_l==="ellipsis"&&(_l="...");const Tl=_l?$t$2.canvas.measureText(_l).width:0,bl=ul+dl-Tl;(cl.textWrap==="none"?fl:[fl[hl-1]]).forEach(Gl=>{if(Gl.isOverflow&&Gl.data){let Il=Gl.data.length-1;for(let Ml=Il;Ml>-1&&(yl=Gl.data[Ml],ml=yl.x+yl.width,!(Ml===Il&&ml<bl));Ml--){if(ml<bl&&yl.char!==" "||!Ml){Gl.data.splice(Ml+1),Gl.width-=yl.width;break}Gl.width-=yl.width}Gl.width+=Tl,Gl.data.push({char:_l,x:ml}),Gl.textMode&&(function(Ml){Ml.text="",Ml.data.forEach(zl=>{Ml.text+=zl.char}),Ml.data=null})(Gl)}})}})(al,el,il,nl),el.textDecoration!=="none"&&(function(ll,cl){let ul,dl=0;const{fontSize:fl,textDecoration:hl}=cl;switch(ll.decorationHeight=fl/11,d(hl)?(ul=hl.type,hl.color&&(ll.decorationColor=Ct$2.string(hl.color)),hl.offset&&(dl=Math.min(.3*fl,Math.max(hl.offset,.15*-fl)))):ul=hl,ul){case"under":ll.decorationY=[.15*fl+dl];break;case"delete":ll.decorationY=[.35*-fl];break;case"under-delete":ll.decorationY=[.15*fl+dl,.35*-fl]}})(al,el),al}},as={string:function(tl,el){if(!tl)return"#000";const il=o(el)&&el<1;if(i(tl)){if(!il||!Ct$2.object)return tl;tl=Ct$2.object(tl)}let sl=s(tl.a)?1:tl.a;il&&(sl*=el);const nl=tl.r+","+tl.g+","+tl.b;return sl===1?"rgb("+nl+")":"rgba("+nl+","+sl+")"}};Object.assign(At$2,rs),Object.assign(Ct$2,as),Object.assign(Ft$2,Yt),Object.assign(Wt$2,be),Object.assign(Et$2,Ue),Object.assign(Tt$2,ei),Object.assign(le$2,{interaction:(tl,el,il,sl)=>new Tt(tl,el,il,sl),hitCanvas:(tl,el)=>new et(tl,el),hitCanvasManager:()=>new At$1}),it();const LeaferUIRuntime=Object.freeze(Object.defineProperty({__proto__:null,AlignHelper:kt$3,get Answer(){return t},get App(){return N},AroundHelper:bt$3,AutoBounds:Gt$2,BezierHelper:hs,Bounds:Vt$3,BoundsEvent:Ho,BoundsHelper:zt$2,get Box(){return Ae$1},BoxData:Jt$1,get Branch(){return vh},BranchHelper:vo,BranchRender:za,get Canvas(){return si$1},CanvasData:ae$1,CanvasManager:ge$2,ChildEvent:zo,ColorConvert:Ct$2,Creator:le$2,Cursor:St$1,DataHelper:_,Debug:ee$2,get Direction4(){return mt$3},get Direction9(){return xt$2},DragBoundsHelper:tt$1,get DragEvent(){return nt$1},Dragger:Dt$1,get DropEvent(){return ht$1},Effect:Tt$2,get Ellipse(){return We$1},EllipseData:Qt$1,EllipseHelper:ys,Event:Xo,EventCreator:pe$2,Eventer:la,Export:It$2,FileHelper:Gi$1,Filter:Dt$2,FourNumberHelper:v,get Frame(){return Ce$1},FrameData:Gt$1,get Group(){return ye$1},GroupData:jt$2,HitCanvasManager:At$1,get Image(){return ei$1},ImageData:re$1,ImageEvent:Vo,ImageManager:en,IncrementId:g,Interaction:Tt,InteractionBase:Mt$1,InteractionHelper:_t$1,get KeyEvent(){return pt$1},Keyboard:W,LayoutEvent:ta,Layouter:gt,get Leaf(){return _h},LeafBounds:Na,LeafBoundsHelper:xo,LeafData:f,LeafDataProxy:Ba,LeafEventer:wa,LeafHelper:co,LeafLayout:Do,LeafLevelList:Ch,LeafList:kh,LeafMatrix:Sa,LeafRender:Ya,get Leafer(){return we$1},LeaferCanvas:et,LeaferCanvasBase:Ee$2,LeaferData:qt$1,LeaferEvent:sa,LeaferFilm:an,LeaferImage:on,LeaferVideo:hn,get Line(){return ti$1},LineData:$t$1,MathHelper:I$1,Matrix:pt$2,MatrixHelper:q$1,get MoveEvent(){return ot$1},MyDragEvent:rt$1,MyImage:ii$1,MyPointerEvent:st$1,MyTouchEvent:gt$1,NeedConvertToCanvasCommandMap:Ne$2,OneRadian:A,PI2:W$1,PI_2:N$1,Paint:Ft$2,PaintGradient:Et$2,PaintImage:Wt$2,get Path(){return di$1},PathArrow:Pt$2,PathBounds:Ai$1,PathCommandDataHelper:Cr,PathCommandMap:Ae$2,PathCommandNodeHelper:ms,PathConvert:sr,PathCorner:Fi$1,PathCreator:Fr,PathData:ee$1,PathDrawer:ri$2,PathHelper:Ie$2,get PathNodeHandleType(){return Z},PathNumberCommandLengthMap:ze$2,PathNumberCommandMap:Xe$2,get Pen(){return li$1},PenData:ie$1,Picker:xt,Platform:$t$2,Plugin:he$2,Point:ut$2,PointHelper:ot$2,PointerButton:K,get PointerEvent(){return it$1},get Polygon(){return Oe$1},PolygonData:Zt$1,PropertyEvent:Uo,get Rect(){return xe$1},RectData:Kt$2,RectHelper:Fe$2,RectRender:ue$1,RenderEvent:ea,Renderer:_t,ResizeEvent:$o,Resource:Ki$1,get RotateEvent(){return lt$1},Run:ne$2,Selector:bt,get Star(){return je$1},StarData:te$1,State:Lt$2,StringNumberMap:Qt$2,get SwipeEvent(){return ct$1},TaskItem:Ji$1,TaskProcessor:Zi$1,get Text(){return hi$1},TextConvert:At$2,TextData:oe$1,get TouchEvent(){return dt$1},Transition:zt$1,TwoPointBoundsHelper:gt$2,get UI(){return ge$1},UIBounds:he$1,UICreator:ce$2,UIData:Ut$2,UIEvent:V,UIRender:le$1,UnitConvert:bt$2,UnitConvertHelper:qt$2,WaitHelper:So,WatchEvent:Ko,Watcher:nt,get ZoomEvent(){return ut$1},affectRenderBoundsType:Sn,affectStrokeBoundsType:On,attr:_n,autoLayoutType:mn,boundsType:bn,canvasPatch:Hi$1,canvasSizeAttrs:Re$2,createAttr:Bt$2,createDescriptor:cn,cursorType:Xn,dataProcessor:zn,dataType:fn,decorateLeafAttr:un,defineDataProcessor:Un,defineKey:ln,defineLeafAttr:pn,dimType:Rn,doBoundsType:vn,doStrokeType:Tn,effectType:mt$2,emptyData:e$1,eraserType:Yn,extraPropertyEventMap:jo,getBoundsData:D,getDescriptor:dn,getMatrixData:X$1,getPointData:Y$1,hitType:Dn,isArray:l,isData:c,isEmptyData:u,isFinite:n,isNull:r,isNumber:o,isObject:d,isString:i,isUndefined:s,layoutProcessor:Fn,leaferTransformAttrMap:aa,maskType:Nn,naturalBoundsType:Bn,opacityType:En,path:Ui$1,pathInputType:kn,pathType:Cn,pen:ji$1,positionType:gn,registerUI:Zn,registerUIEvent:$n,resizeType:Rt$2,rewrite:Gn,rewriteAble:qn,rotationType:wn,scaleType:xn,scrollType:yn,sortType:Wn,strokeType:Pn,surfaceType:Ln,tempBounds:Ht$3,tempMatrix:ft$2,tempPoint:_t$2,tryToNumber:h,useCanvas:it,useModule:Jn,version:Oh,visibleType:In,zoomLayerType:kt$2},Symbol.toStringTag,{value:"Module"}));class LLink{constructor(el,il,sl,nl,ol,rl){this.id=el,this.type=il,this.origin_id=sl,this.origin_slot=nl,this.target_id=ol,this.target_slot=rl,this._data=null,this._pos=new Float32Array(2)}configure(el){el.constructor===Array?(this.id=el[0],this.origin_id=el[1],this.origin_slot=el[2],this.target_id=el[3],this.target_slot=el[4],this.type=el[5]):(this.id=el.id,this.type=el.type,this.origin_id=el.origin_id,this.origin_slot=el.origin_slot,this.target_id=el.target_id,this.target_slot=el.target_slot)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}}function initializeGraphState(tl){tl.last_node_id=0,tl.last_link_id=0,tl._version=-1,tl._nodes=[],tl._nodes_by_id={},tl._nodes_in_order=[],tl._nodes_executable=null,tl._groups=[],tl.links={},tl.iteration=0,tl.config={},tl.vars={},tl.extra={},tl.globaltime=0,tl.runningtime=0,tl.fixedtime=0,tl.fixedtime_lapse=.01,tl.elapsed_time=.01,tl.last_update_time=0,tl.starttime=0,tl.catch_errors=!0,tl.history={actionHistory:[],actionHistoryVersions:[],actionHistoryPtr:0},tl.nodes_executing=[],tl.nodes_actioning=[],tl.node_ancestorsCalculated=[],tl.nodes_executedAction=[],tl._configuring=!1,tl.inputs={},tl.outputs={}}function mergeOptions(tl,el){return Object.assign({},tl,el)}let LiteGraph$o=null;function setLifecycleMethodsLiteGraph(tl){LiteGraph$o=tl}const lifecycleMethods={getSupportedTypes(){var tl;return(tl=this.supported_types)!=null?tl:this.constructor.supported_types},clear(){var tl;this.stop(),this.status=this.constructor.STATUS_STOPPED,(tl=this._nodes)==null||tl.forEach(el=>{var il;(il=el.onRemoved)==null||il.call(el)}),initializeGraphState(this),this.configApplyDefaults(),this.change(),this.sendActionToCanvas("clear")},configApply(tl){this.config=mergeOptions(this.config,tl)},configApplyDefaults(){var tl=LiteGraph$o.graphDefaultConfig;this.configApply(tl)}};let LiteGraph$n=null;function setCanvasBindingMethodsLiteGraph(tl){LiteGraph$n=tl}const canvasBindingMethods={attachCanvas(tl){var el;if(!tl instanceof LiteGraph$n.LGraphCanvas)throw new Error("attachCanvas expects a LiteGraph.LGraphCanvas instance");tl.graph&&tl.graph!=this&&tl.graph.detachCanvas(tl),tl.graph=this,(el=this.list_of_graphcanvas)!=null||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(tl)},detachCanvas(tl){if(this.list_of_graphcanvas){var el=this.list_of_graphcanvas.indexOf(tl);el!=-1&&(tl.graph=null,this.list_of_graphcanvas.splice(el,1))}},sendActionToCanvas(tl,el){if(this.list_of_graphcanvas)for(const il of this.list_of_graphcanvas)il[tl]&&el&&il[tl](...el)},change(){var tl,el;(tl=LiteGraph$n.log)==null||tl.call(LiteGraph$n,"Graph visually changed"),this.sendActionToCanvas("setDirty",[!0,!0]),(el=this.on_change)==null||el.call(this,this)},setDirtyCanvas(tl,el){this.sendActionToCanvas("setDirty",[tl,el])},isLive(){if(!this.list_of_graphcanvas)return!1;for(var tl=0;tl<this.list_of_graphcanvas.length;++tl){var el=this.list_of_graphcanvas[tl];if(el.live_mode)return!0}return!1}};let LiteGraph$m=null;function setRuntimeLoopMethodsLiteGraph(tl){LiteGraph$m=tl}const runtimeLoopMethods={start(tl=0){var el;if(this.status===this.constructor.STATUS_RUNNING)return;this.status=this.constructor.STATUS_RUNNING,(el=this.onPlayEvent)==null||el.call(this),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph$m.getTime(),this.last_update_time=this.starttime;const il=()=>{var sl,nl;this.execution_timer_id===-1&&(window.requestAnimationFrame(il),(sl=this.onBeforeStep)==null||sl.call(this),this.runStep(1,!this.catch_errors),(nl=this.onAfterStep)==null||nl.call(this))};tl===0&&typeof window=="object"&&window.requestAnimationFrame?(this.execution_timer_id=-1,il()):this.execution_timer_id=setInterval(()=>{var sl,nl;(sl=this.onBeforeStep)==null||sl.call(this),this.runStep(1,!this.catch_errors),(nl=this.onAfterStep)==null||nl.call(this)},tl)},stop(){var tl;this.status!=this.constructor.STATUS_STOPPED&&(this.status=this.constructor.STATUS_STOPPED,(tl=this.onStopEvent)==null||tl.call(this),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},runStep(tl=1,el,il){var sl,nl,ol,rl,al,ll,cl=LiteGraph$m.getTime();this.globaltime=.001*(cl-this.starttime);var ul=(sl=this._nodes_executable)!=null?sl:this._nodes;if(ul){if(il||(il=ul.length),el){for(let hl=0;hl<tl;hl++)ul.forEach(_l=>{var yl,ml;LiteGraph$m.use_deferred_actions&&(yl=_l._waiting_actions)!=null&&yl.length&&_l.executePendingActions(),_l.mode===LiteGraph$m.ALWAYS&&((ml=_l.doExecute)==null||ml.call(_l))}),this.fixedtime+=this.fixedtime_lapse,(nl=this.onExecuteStep)==null||nl.call(this);(ol=this.onAfterExecute)==null||ol.call(this)}else try{for(let hl=0;hl<tl;hl++)ul.forEach(_l=>{var yl,ml;LiteGraph$m.use_deferred_actions&&(yl=_l._waiting_actions)!=null&&yl.length&&_l.executePendingActions(),_l.mode===LiteGraph$m.ALWAYS&&((ml=_l.doExecute)==null||ml.call(_l))}),this.fixedtime+=this.fixedtime_lapse,(rl=this.onExecuteStep)==null||rl.call(this);(al=this.onAfterExecute)==null||al.call(this),this.errors_in_execution=!1}catch(hl){if(this.errors_in_execution=!0,LiteGraph$m.throw_errors)throw hl;(ll=LiteGraph$m.log)==null||ll.call(LiteGraph$m,`Error during execution: ${hl}`),this.stop()}var dl=LiteGraph$m.getTime(),fl=dl-cl;fl==0&&(fl=1),this.execution_time=.001*fl,this.globaltime+=.001*fl,this.iteration+=1,this.elapsed_time=(dl-this.last_update_time)*.001,this.last_update_time=dl,this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[]}},getTime(){return this.globaltime},getFixedTime(){return this.fixedtime},getElapsedTime(){return this.elapsed_time},clearTriggeredSlots(){for(var tl in this.links){var el=this.links[tl];el&&el._last_time&&(el._last_time=0)}}};let LiteGraph$l=null;function setExecutionOrderMethodsLiteGraph(tl){LiteGraph$l=tl}const executionOrderMethods={updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var tl=0;tl<this._nodes_in_order.length;++tl)this._nodes_in_order[tl].onExecute&&this._nodes_executable.push(this._nodes_in_order[tl])},computeExecutionOrder(tl,el){var il,sl=[],nl=[],ol={},rl={},al={};for(let hl=0,_l=this._nodes.length;hl<_l;++hl){let yl=this._nodes[hl];if(!(tl&&!yl.onExecute)){ol[yl.id]=yl;var ll=0;if(yl.inputs)for(var cl=0,ul=yl.inputs.length;cl<ul;cl++)yl.inputs[cl]&&yl.inputs[cl].link!=null&&(ll+=1);ll==0?(nl.push(yl),el&&(yl._level=1)):(el&&(yl._level=0),al[yl.id]=ll)}}for(;nl.length!=0;){var dl=nl.shift();if(sl.push(dl),delete ol[dl.id],!!dl.outputs)for(let hl=0;hl<dl.outputs.length;hl++){let _l=dl.outputs[hl];if(!(_l==null||_l.links==null||_l.links.length==0))for(let yl=0;yl<_l.links.length;yl++){let ml=_l.links[yl],Tl=this.links[ml];if(!Tl||rl[Tl.id])continue;let bl=this.getNodeById(Tl.target_id);if(bl==null){rl[Tl.id]=!0;continue}el&&(!bl._level||bl._level<=dl._level)&&(bl._level=dl._level+1),rl[Tl.id]=!0,al[bl.id]-=1,al[bl.id]==0&&nl.push(bl)}}}for(let hl in ol)sl.push(ol[hl]);sl.length!=this._nodes.length&&LiteGraph$l.debug&&((il=LiteGraph$l.warn)==null||il.call(LiteGraph$l,"something went wrong, nodes missing"));var fl=sl.length;for(let hl=0;hl<fl;++hl)sl[hl].order=hl;sl=sl.sort((hl,_l)=>{let yl=hl.constructor.priority||hl.priority||0,ml=_l.constructor.priority||_l.priority||0;return yl==ml?hl.order-_l.order:yl-ml});for(let hl=0;hl<fl;++hl)sl[hl].order=hl;return sl},getAncestors(tl,el={}){for(var il={modesSkip:[],modesOnly:[],typesSkip:[],typesOnly:[]},sl=Object.assign(il,el),nl=[],ol=[],rl=[tl],al={};rl.length;){var ll=rl.shift();if(ll&&!al[ll.id]){if(al[ll.id]=!0,ll.id!=tl.id){if(sl.modesSkip&&sl.modesSkip.length&&sl.modesSkip.indexOf(ll.mode)!=-1||sl.modesOnly&&sl.modesOnly.length&&sl.modesOnly.indexOf(ll.mode)==-1)continue;ol.indexOf(ll.id)==-1&&(nl.push(ll),ol.push(ll.id))}if(ll.inputs)for(var cl=0;cl<ll.inputs.length;++cl){var ul=ll.getInputNode(cl);if(ul){var dl=ll.inputs[cl].type;sl.typesSkip&&sl.typesSkip.length&&sl.typesSkip.indexOf(dl)!=-1||sl.typesOnly&&sl.typesOnly.length&&sl.typesOnly.indexOf(ul.mode)==-1||ol.indexOf(ul.id)==-1&&(al[ul.id]||rl.push(ul))}}}}return nl.sort((fl,hl)=>fl.order-hl.order),nl},arrange(tl=100,el){var il;const sl=this.computeExecutionOrder(!1,!0),nl=[];for(let rl=0;rl<sl.length;++rl){const al=sl[rl],ll=al._level||1;(il=nl[ll])!=null||(nl[ll]=[]),nl[ll].push(al)}let ol=tl;for(let rl=0;rl<nl.length;++rl){const al=nl[rl];if(!al)continue;let ll=100,cl=tl+LiteGraph$l.NODE_TITLE_HEIGHT;for(let ul=0;ul<al.length;++ul){const dl=al[ul];dl.pos[0]=el==LiteGraph$l.VERTICAL_LAYOUT?cl:ol,dl.pos[1]=el==LiteGraph$l.VERTICAL_LAYOUT?ol:cl;const fl=el==LiteGraph$l.VERTICAL_LAYOUT?1:0;dl.size[fl]>ll&&(ll=dl.size[fl]);const hl=el==LiteGraph$l.VERTICAL_LAYOUT?0:1;cl+=dl.size[hl]+tl+LiteGraph$l.NODE_TITLE_HEIGHT}ol+=ll+tl}this.setDirtyCanvas(!0,!0)}};let LiteGraph$k=null;function setNodeMutationMethodsLiteGraph(tl){LiteGraph$k=tl}const nodeMutationMethods={add(tl,el,il={}){var sl,nl,ol,rl={doProcessChange:!0,doCalcSize:!0},al=Object.assign(rl,il);if(tl){if(tl.constructor===LiteGraph$k.LGraphGroup){this._groups.push(tl),this.setDirtyCanvas(!0),this.change(),tl.graph=this,this.onGraphChanged({action:"groupAdd",doSave:al.doProcessChange});return}if(tl.id!=-1&&this._nodes_by_id[tl.id]!=null&&((sl=LiteGraph$k.warn)==null||sl.call(LiteGraph$k,"LiteGraph: there is already a node with this ID, changing it"),LiteGraph$k.use_uuids?tl.id=LiteGraph$k.uuidv4():tl.id=++this.last_node_id),this._nodes.length>=LiteGraph$k.MAX_NUMBER_OF_NODES)throw new Error("LiteGraph: max number of nodes in a graph reached");return LiteGraph$k.use_uuids?(tl.id==null||tl.id==-1)&&(tl.id=LiteGraph$k.uuidv4()):tl.id==null||tl.id==-1?tl.id=++this.last_node_id:this.last_node_id<tl.id&&(this.last_node_id=tl.id),tl.graph=this,this.onGraphChanged({action:"nodeAdd",doSave:al.doProcessChange}),this._nodes.push(tl),this._nodes_by_id[tl.id]=tl,(nl=tl.onAdded)==null||nl.call(tl,this),this.config.align_to_grid&&tl.alignToGrid(),el||this.updateExecutionOrder(),(ol=this.onNodeAdded)==null||ol.call(this,tl),al.doCalcSize&&tl.setSize(tl.computeSize()),this.setDirtyCanvas(!0),this.change(),tl}},remove(tl){var el,il;if(tl.constructor===LiteGraph$k.LGraphGroup){var sl=this._groups.indexOf(tl);sl!=-1&&this._groups.splice(sl,1),tl.graph=null,this.onGraphChanged({action:"groupRemove"}),this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[tl.id]!=null&&!tl.ignore_remove){if(tl.inputs)for(let ol=0;ol<tl.inputs.length;ol++)tl.inputs[ol].link!=null&&tl.disconnectInput(ol,{doProcessChange:!1});if(tl.outputs)for(let ol=0;ol<tl.outputs.length;ol++){let rl=tl.outputs[ol];rl.links!=null&&rl.links.length&&tl.disconnectOutput(ol,!1,{doProcessChange:!1})}if((el=tl.onRemoved)==null||el.call(tl),tl.graph=null,this.onGraphChanged({action:"nodeRemove"}),this.list_of_graphcanvas)for(let ol=0;ol<this.list_of_graphcanvas.length;++ol){let rl=this.list_of_graphcanvas[ol];rl.selected_nodes[tl.id]&&delete rl.selected_nodes[tl.id],rl.node_dragged==tl&&(rl.node_dragged=null)}var nl=this._nodes.indexOf(tl);nl!=-1&&this._nodes.splice(nl,1),delete this._nodes_by_id[tl.id],(il=this.onNodeRemoved)==null||il.call(this,tl),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},removeLink(tl){var el=this.links[tl];if(el){var il=this.getNodeById(el.target_id);il&&(this.beforeChange(),il.disconnectInput(el.target_slot),this.afterChange())}},checkNodeTypes(){for(var tl,el=0;el<this._nodes.length;el++){var il=this._nodes[el],sl=LiteGraph$k.registered_node_types[il.type];if(il.constructor!=sl){LiteGraph$k.debug&&((tl=LiteGraph$k.log)==null||tl.call(LiteGraph$k,`node being replaced by newer version: ${il.type}`));var nl=LiteGraph$k.createNode(il.type);this._nodes[el]=nl,nl.configure(il.serialize()),nl.graph=this,this._nodes_by_id[nl.id]=nl,il.inputs&&(nl.inputs=il.inputs.concat()),il.outputs&&(nl.outputs=il.outputs.concat())}}this.updateExecutionOrder()}},nodeQueryMethods={getNodeById(tl){return tl==null?null:this._nodes_by_id[tl]},findNodesByClass(tl,el=[]){return el=this._nodes.filter(il=>il.constructor===tl),el},findNodesByType(tl,el=[]){const il=tl.toLowerCase();return el=this._nodes.filter(sl=>sl.type.toLowerCase()===il),el},findNodeByTitle(tl){var el;return(el=this._nodes.find(il=>il.title===tl))!=null?el:null},findNodesByTitle(tl){return this._nodes.filter(el=>el.title===tl)},getNodeOnPos(tl,el,il=this._nodes,sl=0){var nl;return(nl=il.reverse().find(ol=>ol.isPointInside(tl,el,sl)))!=null?nl:null},getGroupOnPos(tl,el){var il;return(il=this._groups.find(sl=>sl.isPointInside(tl,el,2,!0)))!=null?il:null}};let LiteGraph$j=null;function setGraphPortsMethodsLiteGraph(tl){LiteGraph$j=tl}const graphPortsMethods={addInput(tl,el,il){var sl,nl,ol=this.inputs[tl];ol||(this.beforeChange(),this.inputs[tl]={name:tl,type:el,value:il},this.onGraphChanged({action:"addInput"}),this.afterChange(),(sl=this.onInputAdded)==null||sl.call(this,tl,el),(nl=this.onInputsOutputsChange)==null||nl.call(this))},setInputData(tl,el){var il=this.inputs[tl];il&&(il.value=el)},getInputData(tl){var el=this.inputs[tl];return el?el.value:null},renameInput(tl,el){var il,sl,nl;if(el!=tl){if(!this.inputs[tl])return!1;if(this.inputs[el])return(il=LiteGraph$j.error)==null||il.call(LiteGraph$j,"there is already one input with that name"),!1;this.inputs[el]=this.inputs[tl],delete this.inputs[tl],this.onGraphChanged({action:"renameInput"}),(sl=this.onInputRenamed)==null||sl.call(this,tl,el),(nl=this.onInputsOutputsChange)==null||nl.call(this)}},changeInputType(tl,el){var il;if(!this.inputs[tl])return!1;this.inputs[tl].type&&String(this.inputs[tl].type).toLowerCase()==String(el).toLowerCase()||(this.inputs[tl].type=el,this.onGraphChanged({action:"changeInputType"}),(il=this.onInputTypeChanged)==null||il.call(this,tl,el))},removeInput(tl){var el,il;return this.inputs[tl]?(delete this.inputs[tl],this.onGraphChanged({action:"graphRemoveInput"}),(el=this.onInputRemoved)==null||el.call(this,tl),(il=this.onInputsOutputsChange)==null||il.call(this),!0):!1},addOutput(tl,el,il){var sl,nl;this.outputs[tl]={name:tl,type:el,value:il},this.onGraphChanged({action:"addOutput"}),(sl=this.onOutputAdded)==null||sl.call(this,tl,el),(nl=this.onInputsOutputsChange)==null||nl.call(this)},setOutputData(tl,el){var il=this.outputs[tl];il&&(il.value=el)},getOutputData(tl){var el=this.outputs[tl];return el?el.value:null},renameOutput(tl,el){var il,sl,nl;if(!this.outputs[tl])return!1;if(this.outputs[el])return(il=LiteGraph$j.error)==null||il.call(LiteGraph$j,"there is already one output with that name"),!1;this.outputs[el]=this.outputs[tl],delete this.outputs[tl],this._version++,(sl=this.onOutputRenamed)==null||sl.call(this,tl,el),(nl=this.onInputsOutputsChange)==null||nl.call(this)},changeOutputType(tl,el){var il;if(!this.outputs[tl])return!1;this.outputs[tl].type&&String(this.outputs[tl].type).toLowerCase()==String(el).toLowerCase()||(this.outputs[tl].type=el,this.onGraphChanged({action:"changeOutputType"}),(il=this.onOutputTypeChanged)==null||il.call(this,tl,el))},removeOutput(tl){var el,il;return this.outputs[tl]?(delete this.outputs[tl],this.onGraphChanged({action:"removeOutput"}),(el=this.onOutputRemoved)==null||el.call(this,tl),(il=this.onInputsOutputsChange)==null||il.call(this),!0):!1},triggerInput(tl,el){for(var il=this.findNodesByTitle(tl),sl=0;sl<il.length;++sl)il[sl].onTrigger(el)},setCallback(tl,el){for(var il=this.findNodesByTitle(tl),sl=0;sl<il.length;++sl)il[sl].setTrigger(el)}};let LiteGraph$i=null;function setGraphEventsMethodsLiteGraph(tl){LiteGraph$i=tl}const graphEventsMethods={sendEventToAllNodes(tl,el,il=LiteGraph$i.ALWAYS){var sl=this._nodes_in_order?this._nodes_in_order:this._nodes;if(sl)for(let nl=0,ol=sl.length;nl<ol;++nl){const rl=sl[nl];if(rl.constructor===LiteGraph$i.Subgraph&&tl!=="onExecute"){rl.mode==il&&rl.sendEventToAllNodes(tl,el,il);continue}!rl[tl]||rl.mode!==il||(el===void 0?rl[tl]():Array.isArray(el)?rl[tl].apply(rl,el):rl[tl](el))}},onAction(tl,el,il){this._input_nodes=this.findNodesByClass(LiteGraph$i.GraphInput,this._input_nodes);for(var sl=0;sl<this._input_nodes.length;++sl){var nl=this._input_nodes[sl];if(nl.properties.name==tl){nl.actionDo(tl,el,il);break}}},trigger(tl,el){var il;(il=this.onTrigger)==null||il.call(this,tl,el)},beforeChange(tl){var el;(el=this.onBeforeChange)==null||el.call(this,this,tl),this.sendActionToCanvas("onBeforeChange",this)},afterChange(tl){var el;(el=this.onAfterChange)==null||el.call(this,this,tl),this.sendActionToCanvas("onAfterChange",this)},connectionChange(tl){var el;this.updateExecutionOrder(),(el=this.onConnectionChange)==null||el.call(this,tl),this.onGraphChanged({action:"connectionChange",doSave:!1}),this.sendActionToCanvas("onConnectionChange")}};let LiteGraph$h=null;function setSerializationLoadMethodsLiteGraph(tl){LiteGraph$h=tl}const serializationLoadMethods={serialize(){var tl,el;const il=this._nodes.map(ul=>ul.serialize());var sl=[];for(var nl in this.links){var ol=this.links[nl];if(!ol.serialize){(tl=LiteGraph$h.warn)==null||tl.call(LiteGraph$h,"weird LLink bug, link info is not a LLink but a regular object");var rl=new LiteGraph$h.LLink;for(var al in ol)rl[al]=ol[al];this.links[nl]=rl,ol=rl}sl.push(ol.serialize())}const ll=this._groups.map(ul=>ul.serialize());var cl={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:il,links:sl,groups:ll,config:this.config,extra:this.extra,version:LiteGraph$h.VERSION};return(el=this.onSerialize)==null||el.call(this,cl),cl},configure(tl,el){var il,sl,nl,ol,rl;if(tl){el||this.clear();var al=tl.nodes;if(tl.links&&tl.links.constructor===Array){for(var ll=[],cl=0;cl<tl.links.length;++cl){var ul=tl.links[cl];if(!ul){(il=LiteGraph$h.warn)==null||il.call(LiteGraph$h,"serialized graph link data contains errors, skipping.");continue}var dl=new LiteGraph$h.LLink;dl.configure(ul),ll[dl.id]=dl}tl.links=ll}for(let yl in tl)["nodes","groups"].includes(yl)||(this[yl]=tl[yl]);var fl=!1;this._configuring=!0;try{if(this._nodes=[],al){for(let yl=0,ml=al.length;yl<ml;++yl){var hl=al[yl],_l=LiteGraph$h.createNode(hl.type,hl.title);_l||((sl=LiteGraph$h.log)==null||sl.call(LiteGraph$h,`Node not found or has errors: ${hl.type}`),_l=new LiteGraph$h.LGraphNode,_l.last_serialization=hl,_l.has_errors=!0,fl=!0),_l.id=hl.id,this.add(_l,!0,{doProcessChange:!1})}al.forEach(yl=>{const ml=this.getNodeById(yl.id);ml==null||ml.configure(yl)})}this._groups.length=0,tl.groups&&tl.groups.forEach(yl=>{const ml=new LiteGraph$h.LGraphGroup;ml.configure(yl),this.add(ml,!0,{doProcessChange:!1})})}finally{this._configuring=!1}return this.updateExecutionOrder(),this.extra=(nl=tl.extra)!=null?nl:{},(ol=this.onConfigure)==null||ol.call(this,tl),tl._version?(rl=LiteGraph$h.debug)==null||rl.call(LiteGraph$h,"skip onGraphChanged when configure passing version too!"):this.onGraphChanged({action:"graphConfigure",doSave:!1}),this.setDirtyCanvas(!0,!0),fl}},load(tl,el){var il=this;if(tl.constructor===File||tl.constructor===Blob){var sl=new FileReader;sl.addEventListener("load",ol=>{var rl=JSON.parse(ol.target.result);il.configure(rl),el==null||el()}),sl.readAsText(tl);return}var nl=new XMLHttpRequest;nl.open("GET",tl,!0),nl.send(null),nl.onload=ol=>{var rl;if(nl.status!==200){(rl=LiteGraph$h.error)==null||rl.call(LiteGraph$h,"Error loading graph:",nl.status,nl.response);return}var al=JSON.parse(nl.response);il.configure(al),el==null||el()},nl.onerror=ol=>{var rl;(rl=LiteGraph$h.error)==null||rl.call(LiteGraph$h,"Error loading graph:",ol)}}};let LiteGraph$g=null;function setHistoryMethodsLiteGraph(tl){LiteGraph$g=tl}const historyMethods={onGraphSaved(tl={}){var el={};Object.assign(el,tl),this.savedVersion=this._version},onGraphLoaded(tl={}){var el={};Object.assign(el,tl),this.savedVersion=this._version},onGraphChanged(tl={}){var el,il,sl,nl,ol,rl,al={action:"",doSave:!0,doSaveGraph:!0},ll=Object.assign(al,tl);if(!(this._configuring&&ll.action!=="graphConfigure")&&(this._version++,ll.action?(el=LiteGraph$g.debug)==null||el.call(LiteGraph$g,"Graph change",ll.action):(il=LiteGraph$g.debug)==null||il.call(LiteGraph$g,"Graph change, no action",ll),ll.doSave&&LiteGraph$g.actionHistory_enabled)){(sl=LiteGraph$g.debug)==null||sl.call(LiteGraph$g,"onGraphChanged SAVE :: "+ll.action);var cl={actionName:ll.action};ll.doSaveGraph&&(cl=Object.assign(cl,{graphSave:this.serialize()}));for(var ul=this.history;ul.actionHistoryPtr<ul.actionHistoryVersions.length-1;)(nl=LiteGraph$g.debug)==null||nl.call(LiteGraph$g,"popping: gone back? "+(ul.actionHistoryPtr+" < "+(ul.actionHistoryVersions.length-1))),ul.actionHistoryVersions.pop();if(ul.actionHistoryVersions.length>=LiteGraph$g.actionHistoryMaxSave){var dl=ul.actionHistoryVersions.shift();(ol=LiteGraph$g.debug)==null||ol.call(LiteGraph$g,"maximum saves reached: "+ul.actionHistoryVersions.length+", remove older: "+dl),ul.actionHistory[dl]=!1}ul.actionHistoryPtr=ul.actionHistoryVersions.length,ul.actionHistoryVersions.push(ul.actionHistoryPtr),ul.actionHistory[ul.actionHistoryPtr]=cl,(rl=LiteGraph$g.debug)==null||rl.call(LiteGraph$g,"history saved: "+ul.actionHistoryPtr,cl.actionName)}},actionHistoryBack(tl={}){var el,il,sl,nl,ol,rl={};Object.assign(rl,tl);var al=this.history;return al.actionHistoryPtr!=null&&al.actionHistoryPtr>=0?(al.actionHistoryPtr--,(el=LiteGraph$g.debug)==null||el.call(LiteGraph$g,"history step back: "+al.actionHistoryPtr),this.actionHistoryLoad({iVersion:al.actionHistoryPtr})?((sl=LiteGraph$g.debug)==null||sl.call(LiteGraph$g,"history loaded back: "+al.actionHistoryPtr),(nl=LiteGraph$g.debug)==null||nl.call(LiteGraph$g,this.history),!0):((il=LiteGraph$g.warn)==null||il.call(LiteGraph$g,"historyLoad failed, restore pointer? "+al.actionHistoryPtr),al.actionHistoryPtr++,!1)):((ol=LiteGraph$g.debug)==null||ol.call(LiteGraph$g,"history is already at older state"),!1)},actionHistoryForward(tl={}){var el,il,sl,nl,ol={};Object.assign(ol,tl);var rl=this.history;return rl.actionHistoryPtr<rl.actionHistoryVersions.length?(rl.actionHistoryPtr++,(el=LiteGraph$g.debug)==null||el.call(LiteGraph$g,"history step forward: "+rl.actionHistoryPtr),this.actionHistoryLoad({iVersion:rl.actionHistoryPtr})?((sl=LiteGraph$g.debug)==null||sl.call(LiteGraph$g,"history loaded forward: "+rl.actionHistoryPtr),!0):((il=LiteGraph$g.warn)==null||il.call(LiteGraph$g,"historyLoad failed, restore pointer? "+rl.actionHistoryPtr),rl.actionHistoryPtr--,!1)):((nl=LiteGraph$g.debug)==null||nl.call(LiteGraph$g,"history is already at newer state"),!1)},actionHistoryLoad(tl={}){var el,il={iVersion:!1,backStep:!1},sl=Object.assign(il,tl),nl=this.history;if(nl.actionHistory[sl.iVersion]&&nl.actionHistory[sl.iVersion].graphSave){var ol=JSON.stringify(this.history);return this.configure(nl.actionHistory[sl.iVersion].graphSave),this.history=JSON.parse(ol),(el=LiteGraph$g.debug)==null||el.call(LiteGraph$g,"history loaded: "+sl.iVersion,nl.actionHistory[sl.iVersion].actionName),!0}else return!1}};function installLGraphDelegates(tl,el){tl.__delegates_installed||(setLifecycleMethodsLiteGraph(el),setCanvasBindingMethodsLiteGraph(el),setRuntimeLoopMethodsLiteGraph(el),setExecutionOrderMethodsLiteGraph(el),setNodeMutationMethodsLiteGraph(el),setGraphPortsMethodsLiteGraph(el),setGraphEventsMethodsLiteGraph(el),setSerializationLoadMethodsLiteGraph(el),setHistoryMethodsLiteGraph(el),[lifecycleMethods,canvasBindingMethods,runtimeLoopMethods,executionOrderMethods,nodeMutationMethods,nodeQueryMethods,graphPortsMethods,graphEventsMethods,serializationLoadMethods,historyMethods].forEach(il=>{Object.entries(il).forEach(([sl,nl])=>{Object.defineProperty(tl.prototype,sl,{value:nl,writable:!0,configurable:!0})})}),Object.defineProperty(tl,"__delegates_installed",{value:!0,writable:!1,configurable:!1}))}class LGraph{constructor(el){var il;(il=LiteGraph.log)==null||il.call(LiteGraph,"Graph created"),this.list_of_graphcanvas=null,this.clear(),el&&this.configure(el)}}gl(LGraph,"supported_types",["number","string","boolean"]),gl(LGraph,"STATUS_STOPPED",1),gl(LGraph,"STATUS_RUNNING",2);function setupLGraphDelegates(tl=LiteGraph){installLGraphDelegates(LGraph,tl)}let LiteGraph$f=null;function setLifecycleSerializationMethodsLiteGraph(tl){LiteGraph$f=tl}const lifecycleSerializationMethods={configure(tl){var el,il,sl,nl,ol;Object.entries(tl).forEach(([rl,al])=>{var ll;if(rl==="properties"){for(var cl in al)this.properties[cl]=al[cl],(ll=this.onPropertyChanged)==null||ll.call(this,cl,al[cl]);return}al!==null&&(typeof al=="object"?this[rl]&&this[rl].configure?this[rl].configure(al):this[rl]=LiteGraph$f.cloneObject(al,this[rl]):this[rl]=al)}),tl.title||(this.title=this.constructor.title),(el=this.inputs)==null||el.forEach((rl,al)=>{var ll,cl;if(!rl.link)return;const ul=this.graph?this.graph.links[rl.link]:null;(ll=this.onConnectionsChange)==null||ll.call(this,LiteGraph$f.INPUT,al,!0,ul,rl),(cl=this.onInputAdded)==null||cl.call(this,rl)}),(il=this.outputs)==null||il.forEach((rl,al)=>{var ll;rl.links&&(rl.links.forEach(()=>{var cl;const ul=this.graph;(cl=this.onConnectionsChange)==null||cl.call(this,LiteGraph$f.OUTPUT,al,!0,ul,rl)}),(ll=this.onOutputAdded)==null||ll.call(this,rl))}),this.widgets&&(this.widgets.forEach(rl=>{rl&&rl.options&&rl.options.property&&this.properties[rl.options.property]!==void 0&&(rl.value=JSON.parse(JSON.stringify(this.properties[rl.options.property])))}),(sl=tl.widgets_values)==null||sl.forEach((rl,al)=>{this.widgets[al]&&(this.widgets[al].value=rl)})),(nl=this.onConfigure)==null||nl.call(this,tl),(ol=this.graph)==null||ol.onGraphChanged({action:"nodeConfigure",doSave:!1})},serialize(){var tl,el,il,sl={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph$f.cloneObject(this.flags),order:this.order,mode:this.mode};return this.constructor===LiteGraph$f.LGraphNode&&this.last_serialization?this.last_serialization:(this.inputs&&(sl.inputs=LiteGraph$f.cloneObject(this.inputs)),this.outputs&&(this.outputs.forEach(nl=>{delete nl._data}),sl.outputs=LiteGraph$f.cloneObject(this.outputs)),this.title&&this.title!=this.constructor.title&&(sl.title=this.title),this.properties&&(sl.properties=LiteGraph$f.cloneObject(this.properties)),this.widgets&&this.serialize_widgets&&(sl.widgets_values=this.widgets.map(nl=>{var ol;return(ol=nl==null?void 0:nl.value)!=null?ol:null})),(tl=sl.type)!=null||(sl.type=this.constructor.type),this.color&&(sl.color=this.color),this.bgcolor&&(sl.bgcolor=this.bgcolor),this.boxcolor&&(sl.boxcolor=this.boxcolor),this.shape&&(sl.shape=this.shape),(el=this.onSerialize)!=null&&el.call(this,sl)&&((il=LiteGraph$f.warn)==null||il.call(LiteGraph$f,"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter")),sl)},clone(){var tl,el,il=LiteGraph$f.createNode(this.type);if(!il)return null;var sl=LiteGraph$f.cloneObject(this.serialize());return(tl=sl.inputs)==null||tl.forEach(nl=>{nl.link=null}),(el=sl.outputs)==null||el.forEach(nl=>{nl.links&&(nl.links.length=0)}),delete sl.id,LiteGraph$f.use_uuids&&(sl.id=LiteGraph$f.uuidv4()),il.configure(sl),il},toString(){return JSON.stringify(this.serialize())},getTitle(){var tl;return(tl=this.title)!=null?tl:this.constructor.title}};let LiteGraph$e=null;function setPropertiesWidgetsMethodsLiteGraph(tl){LiteGraph$e=tl}const propertiesWidgetsMethods={setProperty(tl,el){var il,sl;if(this.properties||(this.properties={}),el===this.properties[tl])return;const nl=this.properties[tl];this.properties[tl]=el,((il=this.onPropertyChanged)==null?void 0:il.call(this,tl,el,nl))===!1&&(this.properties[tl]=nl);const ol=(sl=this.widgets)==null?void 0:sl.find(rl=>{var al;return rl&&((al=rl.options)==null?void 0:al.property)===tl});ol&&(ol.value=el)},addProperty(tl,el,il,sl){var nl,ol;const rl={name:tl,type:il,default_value:el,...sl};return this.properties_info=(nl=this.properties_info)!=null?nl:[],this.properties_info.push(rl),this.properties=(ol=this.properties)!=null?ol:{},this.properties[tl]=el,rl},getPropertyInfo(tl){var el=null;if(this.properties_info){for(var il=0;il<this.properties_info.length;++il)if(this.properties_info[il].name==tl){el=this.properties_info[il];break}}return this.constructor[`@${tl}`]&&(el=this.constructor[`@${tl}`]),this.constructor.widgets_info&&this.constructor.widgets_info[tl]&&(el=this.constructor.widgets_info[tl]),!el&&this.onGetPropertyInfo&&(el=this.onGetPropertyInfo(tl)),el||(el={}),el.type||(el.type=typeof this.properties[tl]),el.widget=="combo"&&(el.type="enum"),el},addWidget(tl,el,il,sl,nl){var ol,rl,al;(ol=this.widgets)!=null||(this.widgets=[]),!nl&&sl&&sl.constructor===Object&&(nl=sl,sl=null),nl&&nl.constructor===String&&(nl={property:nl}),sl&&sl.constructor===String&&(nl!=null||(nl={}),nl.property=sl,sl=null),sl&&sl.constructor!==Function&&((rl=LiteGraph$e.warn)==null||rl.call(LiteGraph$e,"addWidget: callback must be a function"),sl=null);var ll={type:tl.toLowerCase(),name:el,value:il,callback:sl,options:nl||{}};if(ll.options.y!==void 0&&(ll.y=ll.options.y),!sl&&!ll.options.callback&&!ll.options.property&&((al=LiteGraph$e.warn)==null||al.call(LiteGraph$e,"LiteGraph addWidget(...) without a callback or property assigned")),tl=="combo"&&!ll.options.values)throw Error("LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }");return this.widgets.push(ll),this.setSize(this.computeSize()),ll},addCustomWidget(tl){var el;return(el=this.widgets)!=null||(this.widgets=[]),this.widgets.push(tl),tl}},ioDataMethods={setOutputData(tl,el){var il;if(this.outputs){if((tl==null?void 0:tl.constructor)===String)tl=this.findOutputSlot(tl);else if(tl==-1||tl>=this.outputs.length)return;var sl=this.outputs[tl];sl&&(sl._data=el,(il=this.outputs[tl].links)==null||il.forEach(nl=>{const ol=this.graph.links[nl];ol&&(ol.data=el)}))}},setOutputDataType(tl,el){var il,sl;if(this.outputs&&!(tl==-1||tl>=this.outputs.length)){var nl=this.outputs[tl];nl&&(nl.type=el,(sl=(il=this.outputs[tl])==null?void 0:il.links)==null||sl.forEach(ol=>{this.graph.links[ol]&&(this.graph.links[ol].type=el)}))}},getInputData(tl,el,il){var sl;if(this.inputs&&!(tl>=this.inputs.length||this.inputs[tl].link==null)){var nl=this.inputs[tl].link,ol=this.graph.links[nl];if(!ol)return null;if(!el)return ol.data;var rl=this.graph.getNodeById(ol.origin_id);if(!rl)return ol.data;if(il){var al=this.id+"_getInputData_forced_"+Math.floor(Math.random()*9999),ll={action:al,options:{action_call:al}};this.refreshAncestors(ll)}return rl.updateOutputData?rl.updateOutputData(ol.origin_slot):(sl=rl.doExecute)==null||sl.call(rl),ol.data}},getInputDataType(tl){if(!this.inputs||tl>=this.inputs.length||this.inputs[tl].link==null)return null;var el=this.inputs[tl].link,il=this.graph.links[el];if(!il)return null;var sl=this.graph.getNodeById(il.origin_id);if(!sl)return il.type;var nl=sl.outputs[il.origin_slot];return nl?nl.type:null},getInputDataByName(tl,el){var il=this.findInputSlot(tl);return il==-1?null:this.getInputData(il,el)},isInputConnected(tl){return this.inputs?tl<this.inputs.length&&this.inputs[tl].link!=null:!1},getInputInfo(tl){return this.inputs&&tl<this.inputs.length?this.inputs[tl]:null},getInputLink(tl){if(!this.inputs)return null;if(tl<this.inputs.length){var el=this.inputs[tl];return this.graph.links[el.link]}return null},getInputNode(tl){if(!this.inputs||tl>=this.inputs.length)return null;var el=this.inputs[tl];if(!el||el.link===null)return null;var il=this.graph.links[el.link];return il?this.graph.getNodeById(il.origin_id):null},getInputOrProperty(tl){if(this.inputs)for(var el=0,il=this.inputs.length;el<il;++el){var sl=this.inputs[el];if(tl==sl.name&&sl.link!=null){var nl=this.graph.links[sl.link];if(nl)return nl.data}}return this.properties?this.properties[tl]:null},getOutputData(tl){if(!this.outputs||tl>=this.outputs.length)return null;var el=this.outputs[tl];return el._data},getOutputInfo(tl){return this.outputs&&tl<this.outputs.length?this.outputs[tl]:null},isOutputConnected(tl){return this.outputs?tl<this.outputs.length&&this.outputs[tl].links&&this.outputs[tl].links.length:!1},isAnyOutputConnected(){return this.outputs?this.outputs.some(tl=>tl.links&&tl.links.length):!1},getOutputNodes(tl){if(!this.outputs||tl>=this.outputs.length)return null;const el=this.outputs[tl];return!el.links||el.links.length===0?null:el.links.map(il=>this.graph.links[il]).filter(il=>il).map(il=>this.graph.getNodeById(il.target_id)).filter(il=>il)}};let LiteGraph$d=null;function setExecutionActionsMethodsLiteGraph(tl){LiteGraph$d=tl}const executionActionsMethods={addOnTriggerInput(){var tl=this.findInputSlot("onTrigger");return tl==-1?(this.addInput("onTrigger",LiteGraph$d.EVENT,{removable:!0,nameLocked:!0}),this.findInputSlot("onTrigger")):tl},addOnExecutedOutput(){var tl=this.findOutputSlot("onExecuted");return tl==-1?(this.addOutput("onExecuted",LiteGraph$d.ACTION,{removable:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")):tl},onAfterExecuteNode(tl,el){var il,sl=this.findOutputSlot("onExecuted");sl!=-1&&((il=LiteGraph$d.debug)==null||il.call(LiteGraph$d,this.id+":"+this.order+" triggering slot onAfterExecute",tl,el),this.triggerSlot(sl,tl,null,el))},changeMode(tl){switch(tl){case LiteGraph$d.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph$d.ON_EVENT:break;case LiteGraph$d.NEVER:break;case LiteGraph$d.ALWAYS:break;case LiteGraph$d.ON_REQUEST:break;default:return!1}return this.mode=tl,!0},executePendingActions(){!this._waiting_actions||!this._waiting_actions.length||(this._waiting_actions.forEach(tl=>{this.onAction(tl[0],tl[1],tl[2],tl[3],tl[4])}),this._waiting_actions.length=0)},doExecute(tl,el={}){var il,sl,nl,ol,rl;if(this.onExecute){if((il=el.action_call)!=null||(el.action_call=`${this.id}_exec_${Math.floor(Math.random()*9999)}`),this.graph.nodes_executing&&this.graph.nodes_executing[this.id]){(sl=LiteGraph$d.debug)==null||sl.call(LiteGraph$d,"NODE already executing! Prevent! "+this.id+":"+this.order);return}if(LiteGraph$d.ensureNodeSingleExecution&&this.exec_version&&this.exec_version>=this.graph.iteration&&this.exec_version!==void 0){(nl=LiteGraph$d.debug)==null||nl.call(LiteGraph$d,"!! NODE already EXECUTED THIS STEP !! "+this.exec_version);return}if(LiteGraph$d.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&el&&el.action_call&&this.graph.nodes_executedAction[this.id]==el.action_call){(ol=LiteGraph$d.debug)==null||ol.call(LiteGraph$d,"!! NODE already ACTION THIS STEP !! "+el.action_call);return}this.graph.nodes_executing[this.id]=!0,this.onExecute(tl,el),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,el&&el.action_call&&(this.action_call=el.action_call,this.graph.nodes_executedAction[this.id]=el.action_call)}this.execute_triggered=2,(rl=this.onAfterExecuteNode)==null||rl.call(this,tl,el)},execute(tl,el={}){return this.doExecute(tl,el)},actionDo(tl,el,il={},sl){var nl,ol,rl,al;if(this.onAction){if((nl=il.action_call)!=null||(il.action_call=`${this.id}_${tl||"action"}_${Math.floor(Math.random()*9999)}`),LiteGraph$d.ensureNodeSingleAction&&this.graph.nodes_actioning&&this.graph.nodes_actioning[this.id]==il.action_call)return;if((ol=LiteGraph$d.debug)==null||ol.call(LiteGraph$d,"CheckActioned ? "+this.id+":"+this.order+" :: "+this.action_call),LiteGraph$d.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&il&&il.action_call&&this.graph.nodes_executedAction[this.id]==il.action_call){(rl=LiteGraph$d.debug)==null||rl.call(LiteGraph$d,"!! NODE already ACTION THIS STEP !! "+il.action_call),\u00E7;return}this.graph.nodes_actioning[this.id]=tl||"actioning",this.onAction(tl,el,il,sl),this.graph.nodes_actioning[this.id]=!1,il&&il.action_call&&(this.action_call=il.action_call,this.graph.nodes_executedAction[this.id]=il.action_call)}this.action_triggered=2,(al=this.onAfterExecuteNode)==null||al.call(this,el,il)},trigger(tl,el,il){!this.outputs||this.outputs.length===0||(this.graph&&(this.graph._last_trigger_time=LiteGraph$d.getTime()),this.outputs.forEach((sl,nl)=>{sl&&sl.type===LiteGraph$d.EVENT&&(!tl||sl.name===tl)&&this.triggerSlot(nl,el,null,il)}))},triggerSlot(tl,el,il,sl={}){var nl,ol,rl,al;if(this.outputs){if(tl==null){(nl=LiteGraph$d.error)==null||nl.call(LiteGraph$d,"triggerSlot","slot must be a number");return}tl.constructor!==Number&&((ol=LiteGraph$d.warn)==null||ol.call(LiteGraph$d,"triggerSlot","slot must be a number, use node.trigger('name') if you want to use a string"));var ll=this.outputs[tl];if(ll){var cl=ll.links;if(!(!cl||!cl.length)&&!(this.graph&&this.graph.ancestorsCall)){this.graph&&(this.graph._last_trigger_time=LiteGraph$d.getTime());for(var ul=0;ul<cl.length;++ul){var dl=cl[ul];if(!(il!=null&&il!=dl)){var fl=this.graph.links[cl[ul]];if(fl){fl._last_time=LiteGraph$d.getTime();var hl=this.graph.getNodeById(fl.target_id);if(hl){if(hl.mode===LiteGraph$d.ON_TRIGGER)sl.action_call||(sl.action_call=`${this.id}_trigg_${Math.floor(Math.random()*9999)}`),LiteGraph$d.refreshAncestorsOnTriggers&&hl.refreshAncestors({action:"trigger",param:el,options:sl}),hl.onExecute&&hl.doExecute(el,sl);else if(hl.onAction){sl.action_call||(sl.action_call=`${this.id}_act_${Math.floor(Math.random()*9999)}`);let _l=hl.inputs[fl.target_slot];(rl=LiteGraph$d.debug)==null||rl.call(LiteGraph$d,"triggerSlot","will call onACTION: "+this.id+":"+this.order+" :: "+_l.name),LiteGraph$d.refreshAncestorsOnActions&&hl.refreshAncestors({action:_l.name,param:el,options:sl}),LiteGraph$d.use_deferred_actions&&hl.onExecute?((al=hl._waiting_actions)!=null||(hl._waiting_actions=[]),hl._waiting_actions.push([_l.name,el,sl,fl.target_slot])):hl.actionDo(_l.name,el,sl,fl.target_slot)}}}}}}}}},clearTriggeredSlot(tl,el){!this.outputs||!this.outputs[tl]||!this.outputs[tl].links||this.outputs[tl].links.forEach(il=>{if(el!==null&&el!==il)return;const sl=this.graph.links[il];sl&&(sl._last_time=0)})}};let LiteGraph$c=null;function setSlotsMutationMethodsLiteGraph(tl){LiteGraph$c=tl}const slotsMutationMethods={setSize(tl){var el;this.size=tl,(el=this.onResize)==null||el.call(this,this.size)},addInput(tl,el,il){return this.addSlot(tl,el,il,!0)},addOutput(tl,el,il){return this.addSlot(tl,el,il,!1)},addSlot(tl,el,il,sl){var nl,ol,rl,al;const ll=sl?{name:tl,type:el,link:null,...il}:{name:tl,type:el,links:null,...il};return sl?(this.inputs=(nl=this.inputs)!=null?nl:[],this.inputs.push(ll),(ol=this.onInputAdded)==null||ol.call(this,ll),LiteGraph$c.registerNodeAndSlotType(this,el)):(this.outputs=(rl=this.outputs)!=null?rl:[],this.outputs.push(ll),(al=this.onOutputAdded)==null||al.call(this,ll),LiteGraph$c.auto_load_slot_types&&LiteGraph$c.registerNodeAndSlotType(this,el,!0)),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),ll},addInputs(tl){this.addSlots(tl,!0)},addOutputs(tl){this.addSlots(tl,!1)},addSlots(tl,el){var il;typeof tl=="string"&&(tl=[tl]),tl.forEach(sl=>{var nl,ol,rl,al,ll,cl;const ul=el?{name:sl[0],type:sl[1],link:null,...(nl=sl[2])!=null?nl:{}}:{name:sl[0],type:sl[1],links:null,...(ol=sl[2])!=null?ol:{}};el?(this.inputs=(rl=this.inputs)!=null?rl:[],this.inputs.push(ul),(al=this.onInputAdded)==null||al.call(this,ul),LiteGraph$c.registerNodeAndSlotType(this,sl[1])):(this.outputs=(ll=this.outputs)!=null?ll:[],this.outputs.push(ul),(cl=this.onOutputAdded)==null||cl.call(this,ul),LiteGraph$c.auto_load_slot_types&&LiteGraph$c.registerNodeAndSlotType(this,sl[1],!0))}),this.setSize(this.computeSize()),(il=this.setDirtyCanvas)==null||il.call(this,!0,!0)},removeInput(tl){var el;this.disconnectInput(tl);const il=this.inputs.splice(tl,1)[0];this.inputs.slice(tl).filter(sl=>!!sl).forEach(sl=>{const nl=this.graph.links[sl.link];nl!=null&&nl.target_slot&&nl.target_slot--}),this.setSize(this.computeSize()),(el=this.onInputRemoved)==null||el.call(this,tl,il),this.setDirtyCanvas(!0,!0)},removeOutput(tl){var el;this.disconnectOutput(tl),this.outputs=this.outputs.filter((il,sl)=>sl!==tl),this.outputs.slice(tl).forEach(il=>{!il||!il.links||il.links.forEach(sl=>{const nl=this.graph.links[sl];nl&&(nl.origin_slot-=1)})}),this.setSize(this.computeSize()),(el=this.onOutputRemoved)==null||el.call(this,tl),this.setDirtyCanvas(!0,!0)},addConnection(tl,el,il,sl){var nl={name:tl,type:el,pos:il,direction:sl,links:null};return this.connections.push(nl),nl}};let LiteGraph$b=null;function setSlotsQueryMethodsLiteGraph(tl){LiteGraph$b=tl}const slotsQueryMethods={findInputSlot(tl,el){if(!this.inputs)return-1;for(var il=0,sl=this.inputs.length;il<sl;++il)if(tl==this.inputs[il].name)return el?this.inputs[il]:il;return-1},findOutputSlot(tl,el=!1){if(!this.outputs)return-1;for(var il=0,sl=this.outputs.length;il<sl;++il)if(tl==this.outputs[il].name)return el?this.outputs[il]:il;return-1},findInputSlotFree(tl={}){var el={returnObj:!1,typesNotAccepted:[]},il=Object.assign(el,tl);if(!this.inputs)return-1;for(var sl=0,nl=this.inputs.length;sl<nl;++sl)if(!(this.inputs[sl].link&&this.inputs[sl].link!=null)&&!(il.typesNotAccepted&&il.typesNotAccepted.includes&&il.typesNotAccepted.includes(this.inputs[sl].type)))return il.returnObj?this.inputs[sl]:sl;return-1},findOutputSlotFree(tl={}){var el={returnObj:!1,typesNotAccepted:[]},il=Object.assign(el,tl);if(!this.outputs)return-1;for(let sl=0,nl=this.outputs.length;sl<nl;++sl)if(!(this.outputs[sl].links&&this.outputs[sl].links!=null)&&!(il.typesNotAccepted&&il.typesNotAccepted.includes&&il.typesNotAccepted.includes(this.outputs[sl].type)))return il.returnObj?this.outputs[sl]:sl;return-1},findInputSlotByType(tl,el,il,sl){return this.findSlotByType(!0,tl,el,il,sl)},findOutputSlotByType(tl,el,il,sl){return this.findSlotByType(!1,tl,el,il,sl)},findSlotByType(tl=!1,el,il=!1,sl=!1,nl=!1){var ol=tl?this.inputs:this.outputs;if(!ol)return-1;(el==""||el=="*")&&(el=0);for(let rl=0,al=ol.length;rl<al;++rl){let ll=(el+"").toLowerCase().split(","),cl=ol[rl].type=="0"||ol[rl].type=="*"?"0":ol[rl].type;cl=(cl+"").toLowerCase().split(",");for(let ul=0;ul<ll.length;ul++)for(let dl=0;dl<cl.length;dl++)if(ll[ul]=="_event_"&&(ll[ul]=LiteGraph$b.EVENT),cl[ul]=="_event_"&&(cl[ul]=LiteGraph$b.EVENT),ll[ul]=="*"&&(ll[ul]=0),cl[ul]=="*"&&(cl[ul]=0),ll[ul]==cl[dl]){if(sl&&ol[rl].links&&ol[rl].links!==null)continue;return il?ol[rl]:rl}}if(sl&&!nl)for(let rl=0,al=ol.length;rl<al;++rl){let ll=(el+"").toLowerCase().split(","),cl=ol[rl].type=="0"||ol[rl].type=="*"?"0":ol[rl].type;cl=(cl+"").toLowerCase().split(",");for(let ul=0;ul<ll.length;ul++)for(let dl=0;dl<cl.length;dl++)if(ll[ul]=="*"&&(ll[ul]=0),cl[ul]=="*"&&(cl[ul]=0),ll[ul]==cl[dl])return il?ol[rl]:rl}return-1},getSlotInPosition(tl,el){var il=new Float32Array(2);if(this.inputs)for(let sl=0,nl=this.inputs.length;sl<nl;++sl){let ol=this.inputs[sl];if(this.getConnectionPos(!0,sl,il),LiteGraph$b.isInsideRectangle(tl,el,il[0]-10,il[1]-5,20,10))return{input:ol,slot:sl,link_pos:il}}if(this.outputs)for(let sl=0,nl=this.outputs.length;sl<nl;++sl){let ol=this.outputs[sl];if(this.getConnectionPos(!1,sl,il),LiteGraph$b.isInsideRectangle(tl,el,il[0]-10,il[1]-5,20,10))return{output:ol,slot:sl,link_pos:il}}return null}};let LiteGraph$a=null;function setConnectionsMethodsLiteGraph(tl){LiteGraph$a=tl}const connectionsMethods={connectByType(tl,el,il="*",sl={}){var nl,ol,rl,al,ll,cl={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},ul=Object.assign(cl,sl);el&&el.constructor===Number&&(el=this.graph.getNodeById(el));var dl=el.findInputSlotByType(il,!1,!0);return dl>=0&&dl!==null?((nl=LiteGraph$a.debug)==null||nl.call(LiteGraph$a,"CONNbyTYPE type "+il+" for "+dl),this.connect(tl,el,dl)):ul.createEventInCase&&il==LiteGraph$a.EVENT?((ol=LiteGraph$a.debug)==null||ol.call(LiteGraph$a,"connect WILL CREATE THE onTrigger "+il+" to "+el),this.connect(tl,el,-1)):ul.generalTypeInCase&&(dl=el.findInputSlotByType(0,!1,!0,!0),(rl=LiteGraph$a.debug)==null||rl.call(LiteGraph$a,"connect TO a general type (*, 0), if not found the specific type ",il," to ",el,"RES_SLOT:",dl),dl>=0)?this.connect(tl,el,dl):ul.firstFreeIfOutputGeneralInCase&&(il==0||il=="*"||il=="")&&(dl=el.findInputSlotFree({typesNotAccepted:[LiteGraph$a.EVENT]}),(al=LiteGraph$a.debug)==null||al.call(LiteGraph$a,"connect TO TheFirstFREE ",il," to ",el,"RES_SLOT:",dl),dl>=0)?this.connect(tl,el,dl):((ll=LiteGraph$a.debug)==null||ll.call(LiteGraph$a,"no way to connect type: ",il," to targetNODE ",el),null)},connectByTypeOutput(tl,el,il="*",sl={}){var nl,ol,rl,al={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},ll=Object.assign(al,sl);el&&el.constructor===Number&&(el=this.graph.getNodeById(el));var cl=el.findOutputSlotByType(il,!1,!0);return cl>=0&&cl!==null?((nl=LiteGraph$a.debug)==null||nl.call(LiteGraph$a,"CONNbyTYPE OUT! type "+il+" for "+cl),el.connect(cl,this,tl)):ll.generalTypeInCase&&(cl=el.findOutputSlotByType(0,!1,!0,!0),cl>=0)?el.connect(cl,this,tl):ll.createEventInCase&&il==LiteGraph$a.EVENT&&LiteGraph$a.do_add_triggers_slots?(cl=el.addOnExecutedOutput(),el.connect(cl,this,tl)):ll.firstFreeIfInputGeneralInCase&&(il==0||il=="*"||il==""||il=="undefined")&&(cl=el.findOutputSlotFree({typesNotAccepted:[LiteGraph$a.EVENT]}),cl>=0)?el.connect(cl,this,tl):((ol=LiteGraph$a.debug)==null||ol.call(LiteGraph$a,"no way to connect byOUT type: ",il," to sourceNODE ",el),(rl=LiteGraph$a.log)==null||rl.call(LiteGraph$a,"type OUT! "+il+" not found or not free?"),null)},connect(tl,el,il=0){var sl,nl,ol,rl,al,ll,cl,ul,dl,fl,hl,_l,yl,ml;if(!this.graph)return(sl=LiteGraph$a.log)==null||sl.call(LiteGraph$a,"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(tl.constructor===String){if(tl=this.findOutputSlot(tl),tl==-1)return(nl=LiteGraph$a.log)==null||nl.call(LiteGraph$a,`Connect: Error, no slot of name ${tl}`),null}else if(!this.outputs||tl>=this.outputs.length)return(ol=LiteGraph$a.log)==null||ol.call(LiteGraph$a,"Connect: Error, slot number not found"),null;if(el&&el.constructor===Number&&(el=this.graph.getNodeById(el)),!el)throw new Error("target node is null");if(el==this)return null;if(il.constructor===String){if(il=el.findInputSlot(il),il==-1)return(rl=LiteGraph$a.log)==null||rl.call(LiteGraph$a,`Connect: Error, no slot of name ${il}`),null}else if(il===LiteGraph$a.EVENT)if(LiteGraph$a.do_add_triggers_slots)el.changeMode(LiteGraph$a.ON_TRIGGER),il=el.findInputSlot("onTrigger");else return null;else if(!el.inputs||il>=el.inputs.length)return(al=LiteGraph$a.log)==null||al.call(LiteGraph$a,"Connect: Error, slot number not found"),null;var Tl=!1,bl=el.inputs[il],Gl=null,Il=this.outputs[tl];if(!this.outputs[tl])return(ll=LiteGraph$a.log)==null||ll.call(LiteGraph$a,"Invalid slot passed: ",tl,this.outputs),null;if(el.onBeforeConnectInput&&(il=el.onBeforeConnectInput(el)),((cl=this.onConnectOutput)==null?void 0:cl.call(this,tl,bl.type,bl,el,il))===!1)return null;if(il===!1||il===null||!LiteGraph$a.isValidConnection(Il.type,bl.type))return this.setDirtyCanvas(!1,!0),Tl&&this.graph.connectionChange(this,Gl),null;if((ul=LiteGraph$a.debug)==null||ul.call(LiteGraph$a,"DBG targetSlot",il),((dl=el.onConnectInput)==null?void 0:dl.call(el,il,Il.type,Il,this,tl))===!1||((fl=this.onConnectOutput)==null?void 0:fl.call(this,tl,bl.type,bl,el,il))===!1)return null;el.inputs[il]&&el.inputs[il].link!=null&&(this.graph.beforeChange(),el.disconnectInput(il,{doProcessChange:!1}),Tl=!0),(hl=Il.links)!=null&&hl.length&&Il.type===LiteGraph$a.EVENT&&(LiteGraph$a.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(tl,!1,{doProcessChange:!1}),Tl=!0));var Ml;return LiteGraph$a.use_uuids?Ml=LiteGraph$a.uuidv4():Ml=++this.graph.last_link_id,Gl=new LiteGraph$a.LLink(Ml,bl.type||Il.type,this.id,tl,el.id,il),this.graph.links[Gl.id]=Gl,Il.links==null&&(Il.links=[]),Il.links.push(Gl.id),!el.inputs||typeof el.inputs[il]=="undefined"?((_l=LiteGraph$a.warn)==null||_l.call(LiteGraph$a,"connect aborted: target slot does not exist on target node",el,il),Il.links.pop(),delete this.graph.links[Gl.id],null):(el.inputs[il].link=Gl.id,(yl=this.onConnectionsChange)==null||yl.call(this,LiteGraph$a.OUTPUT,tl,!0,Gl,Il),(ml=el.onConnectionsChange)==null||ml.call(el,LiteGraph$a.INPUT,il,!0,Gl,bl),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,el,il,this,tl),this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,tl,el,il)),this.graph.onGraphChanged({action:"connect"}),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,Gl),Gl)},disconnectOutput(tl,el,il={}){var sl,nl,ol,rl,al,ll,cl={doProcessChange:!0},ul=Object.assign(cl,il);if(tl.constructor===String){if(tl=this.findOutputSlot(tl),tl==-1)return(sl=LiteGraph$a.log)==null||sl.call(LiteGraph$a,`Connect: Error, no slot of name ${tl}`),!1}else if(!this.outputs||tl>=this.outputs.length)return(nl=LiteGraph$a.log)==null||nl.call(LiteGraph$a,"Connect: Error, slot number not found"),!1;var dl=this.outputs[tl];if(!dl||!dl.links||dl.links.length==0)return!1;if(el){if(el.constructor===Number&&(el=this.graph.getNodeById(el)),!el)throw new Error("Target Node not found");for(let hl=0,_l=dl.links.length;hl<_l;hl++){let yl=dl.links[hl],ml=this.graph.links[yl];if(ml.target_id==el.id){dl.links.splice(hl,1);var fl=el.inputs[ml.target_slot];fl.link=null,delete this.graph.links[yl],(ol=this.graph)==null||ol.onGraphChanged({action:"disconnectOutput",doSave:ul.doProcessChange}),(rl=el.onConnectionsChange)==null||rl.call(el,LiteGraph$a.INPUT,ml.target_slot,!1,ml,fl),(al=this.onConnectionsChange)==null||al.call(this,LiteGraph$a.OUTPUT,tl,!1,ml,dl),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,tl),this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,tl),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,el,ml.target_slot));break}}}else{for(let hl=0,_l=dl.links.length;hl<_l;hl++){let yl=dl.links[hl],ml=this.graph.links[yl];ml&&(el=this.graph.getNodeById(ml.target_id),fl=null,(ll=this.graph)==null||ll.onGraphChanged({action:"disconnectOutput",doSave:ul.doProcessChange}),el&&(fl=el.inputs[ml.target_slot],fl.link=null,el.onConnectionsChange&&el.onConnectionsChange(LiteGraph$a.INPUT,ml.target_slot,!1,ml,fl),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,el,ml.target_slot)),delete this.graph.links[yl],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$a.OUTPUT,tl,!1,ml,dl),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,tl),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,el,ml.target_slot)))}dl.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},disconnectInput(tl,el={}){var il,sl,nl,ol={doProcessChange:!0},rl=Object.assign(ol,el);if(tl.constructor===String){if(tl=this.findInputSlot(tl),tl==-1)return(il=LiteGraph$a.log)==null||il.call(LiteGraph$a,`Connect: Error, no slot of name ${tl}`),!1}else if(!this.inputs||tl>=this.inputs.length)return(sl=LiteGraph$a.log)==null||sl.call(LiteGraph$a,"Connect: Error, slot number not found"),!1;var al=this.inputs[tl];if(!al)return!1;var ll=this.inputs[tl].link;if(ll!=null){this.inputs[tl].link=null;var cl=this.graph.links[ll];if(cl){var ul=this.graph.getNodeById(cl.origin_id);if(!ul)return!1;var dl=ul.outputs[cl.origin_slot];if(!dl||!dl.links||dl.links.length==0)return!1;for(var fl=0,hl=dl.links.length;fl<hl;fl++)if(dl.links[fl]==ll){dl.links.splice(fl,1);break}delete this.graph.links[ll],(nl=this.graph)==null||nl.onGraphChanged({action:"disconnectInput",doSave:rl.doProcessChange}),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$a.INPUT,tl,!1,cl,al),ul.onConnectionsChange&&ul.onConnectionsChange(LiteGraph$a.OUTPUT,fl,!1,cl,dl),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,ul,fl),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,this,tl))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0}};let LiteGraph$9=null;function setGeometryHitMethodsLiteGraph(tl){LiteGraph$9=tl}const geometryHitMethods={computeSize(tl){if(this.constructor.size)return this.constructor.size.concat();var el=tl||new Float32Array([0,0]),il=LiteGraph$9.NODE_TEXT_SIZE;const sl=dl=>dl?il*dl.length*.6:0;var nl=sl(this.title),ol=0,rl=0;this.inputs&&(ol=this.inputs.reduce((dl,fl)=>{const hl=fl.label||fl.name||"",_l=sl(hl);return Math.max(dl,_l)},0)),this.outputs&&(rl=this.outputs.reduce((dl,fl)=>{const hl=fl.label||fl.name||"",_l=sl(hl);return Math.max(dl,_l)},0)),el[0]=Math.max(ol+rl+10,nl),el[0]=Math.max(el[0],LiteGraph$9.NODE_WIDTH),this.widgets&&this.widgets.length&&(el[0]=Math.max(el[0],LiteGraph$9.NODE_WIDTH*1.5));const al=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1,1)*LiteGraph$9.NODE_SLOT_HEIGHT;el[1]=al+(this.constructor.slot_start_y||0);let ll=0;if(this.widgets&&this.widgets.length){for(var cl=0,ul=this.widgets.length;cl<ul;++cl)this.widgets[cl].computeSize?ll+=this.widgets[cl].computeSize(el[0])[1]+4:ll+=LiteGraph$9.NODE_WIDGET_HEIGHT+4;ll+=8}return this.widgets_up?el[1]=Math.max(el[1],ll):this.widgets_start_y!=null?el[1]=Math.max(el[1],ll+this.widgets_start_y):el[1]+=ll,this.constructor.min_height&&el[1]<this.constructor.min_height&&(el[1]=this.constructor.min_height),el[1]+=6,el},getBounding(tl=new Float32Array(4),el){const il=this.pos,sl=this.flags.collapsed,nl=this.size;let ol=0,rl=1,al=0,ll=0;return el&&(ol=4,rl=6+ol,al=4,ll=5+al),tl[0]=il[0]-ol,tl[1]=il[1]-LiteGraph$9.NODE_TITLE_HEIGHT-al,tl[2]=sl?(this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH)+rl:nl[0]+rl,tl[3]=sl?LiteGraph$9.NODE_TITLE_HEIGHT+ll:nl[1]+LiteGraph$9.NODE_TITLE_HEIGHT+ll,this.onBounding&&this.onBounding(tl),tl},isPointInside(tl,el,il=0,sl){var nl=this.graph&&this.graph.isLive()?0:LiteGraph$9.NODE_TITLE_HEIGHT;if(sl&&(nl=0),this.flags&&this.flags.collapsed){if(LiteGraph$9.isInsideRectangle(tl,el,this.pos[0]-il,this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT-il,(this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH)+2*il,LiteGraph$9.NODE_TITLE_HEIGHT+2*il))return!0}else if(this.pos[0]-4-il<tl&&this.pos[0]+this.size[0]+4+il>tl&&this.pos[1]-nl-il<el&&this.pos[1]+this.size[1]+il>el)return!0;return!1},getConnectionPos(tl,el,il=new Float32Array(2)){var sl=0;tl&&this.inputs&&(sl=this.inputs.length),!tl&&this.outputs&&(sl=this.outputs.length);var nl=LiteGraph$9.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var ol=this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH;return this.horizontal?(il[0]=this.pos[0]+ol*.5,tl?il[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT:il[1]=this.pos[1]):(tl?il[0]=this.pos[0]:il[0]=this.pos[0]+ol,il[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT*.5),il}return tl&&el==-1?(il[0]=this.pos[0]+LiteGraph$9.NODE_TITLE_HEIGHT*.5,il[1]=this.pos[1]+LiteGraph$9.NODE_TITLE_HEIGHT*.5,il):tl&&sl>el&&this.inputs[el].pos?(il[0]=this.pos[0]+this.inputs[el].pos[0],il[1]=this.pos[1]+this.inputs[el].pos[1],il):!tl&&sl>el&&this.outputs[el].pos?(il[0]=this.pos[0]+this.outputs[el].pos[0],il[1]=this.pos[1]+this.outputs[el].pos[1],il):this.horizontal?(il[0]=this.pos[0]+(el+.5)*(this.size[0]/sl),tl?il[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT:il[1]=this.pos[1]+this.size[1],il):(tl?il[0]=this.pos[0]+nl:il[0]=this.pos[0]+this.size[0]+1-nl,il[1]=this.pos[1]+(el+.7)*LiteGraph$9.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),il)},localToScreen(tl,el,il){return[(tl+this.pos[0])*il.scale+il.offset[0],(el+this.pos[1])*il.scale+il.offset[1]]}};let LiteGraph$8=null;function setCanvasIntegrationMethodsLiteGraph(tl){LiteGraph$8=tl}const canvasIntegrationMethods={trace(tl){var el,il,sl,nl;this.console||(this.console=[]),(il=(el=this.console).push)==null||il.call(el,tl),this.console.length>this.constructor.MAX_CONSOLE&&((nl=(sl=this.console).shift)==null||nl.call(sl)),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,tl)},setDirtyCanvas(tl,el){this.graph&&this.graph.sendActionToCanvas("setDirty",[tl,el])},loadImage(tl){var el=new Image;el.src=LiteGraph$8.node_images_path+tl,el.ready=!1;var il=this;return el.onload=function(){this.ready=!0,il.setDirtyCanvas(!0)},el},captureInput(tl){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var el=this.graph.list_of_graphcanvas,il=0;il<el.length;++il){var sl=el[il];!tl&&sl.node_capturing_input!=this||(sl.node_capturing_input=tl?this:null)}},collapse(tl){this.graph.onGraphChanged({action:"collapse"}),!(this.constructor.collapsable===!1&&!tl)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},pin(tl){this.graph.onGraphChanged({action:"pin"}),tl===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=tl}};let LiteGraph$7=null;function setAncestorRefreshMethodsLiteGraph(tl){LiteGraph$7=tl}const ancestorRefreshMethods={refreshAncestors(tl={}){var el={action:"",param:null,options:null,passParam:!0},il=Object.assign(el,tl);if(this.inputs&&!(LiteGraph$7.preventAncestorRecalculation&&this.graph.node_ancestorsCalculated&&this.graph.node_ancestorsCalculated[this.id])){(!il.action||il.action=="")&&(il.action=this.id+"_ancestors"),(!il.param||il.param=="")&&(il.param=this.id+"_ancestors"),il.options||(il.options={}),il.options=Object.assign({action_call:il.action},il.options),this.graph.ancestorsCall=!0;var sl={modesSkip:[LiteGraph$7.NEVER,LiteGraph$7.ON_EVENT,LiteGraph$7.ON_TRIGGER],modesOnly:[LiteGraph$7.ALWAYS,LiteGraph$7.ON_REQUEST],typesSkip:[LiteGraph$7.ACTION],typesOnly:[]},nl=this.graph.getAncestors(this,sl);for(iN in nl)nl[iN].doExecute(il.param,il.options),this.graph.node_ancestorsCalculated[nl[iN].id]=!0;return this.graph.ancestorsCall=!1,this.graph.node_ancestorsCalculated[this.id]=!0,!0}}};let LiteGraph$6=null;function setMiscMethodsLiteGraph(tl){LiteGraph$6=tl}const miscMethods={alignToGrid(){this.pos[0]=LiteGraph$6.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph$6.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph$6.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph$6.CANVAS_GRID_SIZE)}};function installLGraphNodeDelegates(tl,el){setLifecycleSerializationMethodsLiteGraph(el),setPropertiesWidgetsMethodsLiteGraph(el),setExecutionActionsMethodsLiteGraph(el),setSlotsMutationMethodsLiteGraph(el),setSlotsQueryMethodsLiteGraph(el),setConnectionsMethodsLiteGraph(el),setGeometryHitMethodsLiteGraph(el),setCanvasIntegrationMethodsLiteGraph(el),setAncestorRefreshMethodsLiteGraph(el),setMiscMethodsLiteGraph(el),[lifecycleSerializationMethods,propertiesWidgetsMethods,ioDataMethods,executionActionsMethods,slotsMutationMethods,slotsQueryMethods,connectionsMethods,geometryHitMethods,canvasIntegrationMethods,ancestorRefreshMethods,miscMethods].forEach(il=>{Object.entries(il).forEach(([sl,nl])=>{Object.defineProperty(tl.prototype,sl,{value:nl,writable:!0,configurable:!0})})})}class LGraphNode{constructor(el="Unnamed"){this.title=el,this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}}set pos(el){var il;!el||el.length<2||((il=this._pos)!=null||(this._pos=new Float32Array(10,10)),this._pos[0]=el[0],this._pos[1]=el[1])}get pos(){return this._pos}}function setupLGraphNodeDelegates(tl=LiteGraph){installLGraphNodeDelegates(LGraphNode,tl)}class LGraphGroup{constructor(el="Group"){gl(this,"isPointInside",LiteGraph.LGraphNode.prototype.isPointInside),gl(this,"setDirtyCanvas",LiteGraph.LGraphNode.prototype.setDirtyCanvas);var il,sl;this.title=el,this.font_size=24,this.color=(sl=(il=LiteGraph.LGraphCanvas.node_colors.pale_blue)==null?void 0:il.groupcolor)!=null?sl:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null}set pos(el){!el||el.length<2||(this._pos[0]=el[0],this._pos[1]=el[1])}get pos(){return this._pos}set size(el){!el||el.length<2||(this._size[0]=Math.max(140,el[0]),this._size[1]=Math.max(80,el[1]))}get size(){return this._size}configure(el){this.title=el.title,this._bounding.set(el.bounding),this.color=el.color,el.font_size&&(this.font_size=el.font_size)}serialize(){var el=this._bounding;return{title:this.title,bounding:el.map(il=>Math.round(il)),color:this.color,font_size:this.font_size}}move(el,il,sl){var nl,ol;isNaN(el)&&((nl=console.error)==null||nl.call(console,"LGraphGroup.move() deltax NaN")),isNaN(il)&&((ol=console.error)==null||ol.call(console,"LGraphGroup.move() deltay NaN")),this._pos[0]+=el,this._pos[1]+=il,!sl&&this._nodes.forEach(rl=>{rl.pos[0]+=el,rl.pos[1]+=il})}recomputeInsideNodes(){this._nodes.length=0;var el=this.graph._nodes,il=new Float32Array(4);this._nodes=el.filter(sl=>(sl.getBounding(il),LiteGraph.overlapBounding(this._bounding,il)))}}function applyRenderContextCompatAliases(tl){if(!tl||typeof tl!="object")return tl;const el="imageSmoothingEnabled"in tl,il="mozImageSmoothingEnabled"in tl;return el&&!il&&Object.defineProperty(tl,"mozImageSmoothingEnabled",{enumerable:!1,configurable:!0,get(){return tl.imageSmoothingEnabled},set(sl){tl.imageSmoothingEnabled=sl}}),tl}class Canvas2DSurface{constructor(el,il=null){this.canvas=el,this._context=il}getContextCompat(){var el;return!this._context&&(el=this.canvas)!=null&&el.getContext&&(this._context=this.canvas.getContext("2d")),applyRenderContextCompatAliases(this._context)}resize(el,il){this.canvas&&(this.canvas.width=el,this.canvas.height=il)}}class LeaferSurface{constructor(el){var il;this.leaferCanvas=el,this.canvas=(il=el==null?void 0:el.view)!=null?il:null}getContextCompat(){var el,il;const sl=(il=(el=this.leaferCanvas)==null?void 0:el.context)!=null?il:null;return applyRenderContextCompatAliases(sl)}resize(el,il){var sl,nl;if(this.leaferCanvas){if(typeof this.leaferCanvas.resize=="function"){const ol={width:el,height:il};typeof this.leaferCanvas.pixelRatio=="number"&&(ol.pixelRatio=this.leaferCanvas.pixelRatio),this.leaferCanvas.resize(ol)}else this.canvas&&(this.canvas.width=el,this.canvas.height=il);this.canvas=(nl=(sl=this.leaferCanvas)==null?void 0:sl.view)!=null?nl:this.canvas}}}class Canvas2DRendererAdapter{constructor(){this.ownerDocument=null,this.frontSurface=null,this.backSurface=null}init({canvas:el,ownerDocument:il}){var sl,nl;this.ownerDocument=(sl=il!=null?il:el==null?void 0:el.ownerDocument)!=null?sl:null,this.frontSurface=new Canvas2DSurface(el);const ol=(nl=this.ownerDocument)!=null&&nl.createElement?this.ownerDocument.createElement("canvas"):document.createElement("canvas");return ol.width=el.width,ol.height=el.height,this.backSurface=new Canvas2DSurface(ol),this.getFrontCtx(),this.getBackCtx(),this}destroy(){this.frontSurface=null,this.backSurface=null}resize(el,il){var sl,nl;(sl=this.frontSurface)==null||sl.resize(el,il),(nl=this.backSurface)==null||nl.resize(el,il)}beginFrame(el){}endFrame(el){}getFrontCtx(){var el,il;return(il=(el=this.frontSurface)==null?void 0:el.getContextCompat())!=null?il:null}getBackCtx(){var el,il;return(il=(el=this.backSurface)==null?void 0:el.getContextCompat())!=null?il:null}getFrontSurface(){return this.frontSurface}getBackSurface(){return this.backSurface}blitBackToFront(el=this.getFrontCtx()){var il,sl;const nl=(il=this.frontSurface)==null?void 0:il.canvas,ol=(sl=this.backSurface)==null?void 0:sl.canvas;!el||!nl||!ol||ol===nl||el.drawImage(ol,0,0)}adoptExternalContexts({frontCanvas:el,backCanvas:il,frontContext:sl,backContext:nl}){this.frontSurface=new Canvas2DSurface(el,sl),this.backSurface=new Canvas2DSurface(il,nl),this.getFrontCtx(),this.getBackCtx()}}function resolveRendererAdapter(tl){var el,il;const sl=(il=(el=tl.options)==null?void 0:el.rendererAdapter)!=null?il:tl.rendererAdapter;return sl?typeof sl=="function"?new sl:sl:new Canvas2DRendererAdapter}function clear(){var tl;this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.low_quality_rendering_counter=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),(tl=this.onClear)==null||tl.call(this)}function setGraph(tl,el){var il;if(this.graph!=tl){if(el||this.clear(),!tl){(il=this.graph)==null||il.detachCanvas(this);return}tl.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}}function getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}function openSubgraph(tl){if(!tl)throw new Error("graph cannot be null");if(this.graph==tl)throw new Error("graph cannot be the same");this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),tl.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)}function closeSubgraph(){if(!(!this._graph_stack||this._graph_stack.length==0)){var tl=this.graph._subgraph_node,el=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},el.attachCanvas(this),this.setDirty(!0,!0),tl&&(this.centerOnNode(tl),this.selectNodes([tl])),this.ds.offset=[0,0],this.ds.scale=1}}function getCurrentGraph(){return this.graph}function setCanvas(tl,el){var il,sl,nl,ol,rl,al,ll,cl,ul,dl,fl,hl,_l,yl,ml,Tl,bl,Gl,Il,Ml,zl,Fl,Bl,Wl,Hl;if(tl&&tl.constructor===String&&(tl=document.getElementById(tl),!tl))throw new Error("Error creating LiteGraph canvas: Canvas not found");if(tl!==this.canvas){if(!tl&&this.canvas&&(el||this.unbindEvents()),this.rendererAdapter&&this.canvas&&tl!==this.canvas&&((sl=(il=this.rendererAdapter).destroy)==null||sl.call(il)),this.canvas=tl,!tl){this.ctx=null,this.bgctx=null,this.bgcanvas=null,this.frontSurface=null,this.backSurface=null,this.ds.element=null;return}if(tl.className+=" lgraphcanvas",tl.data=this,tl.tabindex="1",tl.getContext==null)throw tl.localName!="canvas"?new Error("Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+tl.localName):new Error("This browser doesn't support Canvas");this.rendererAdapter=resolveRendererAdapter(this),(ol=(nl=this.rendererAdapter).init)==null||ol.call(nl,{canvas:tl,ownerDocument:tl.ownerDocument}),this.frontSurface=(ll=(al=(rl=this.rendererAdapter).getFrontSurface)==null?void 0:al.call(rl))!=null?ll:null,this.backSurface=(dl=(ul=(cl=this.rendererAdapter).getBackSurface)==null?void 0:ul.call(cl))!=null?dl:null,this.canvas=((fl=this.frontSurface)==null?void 0:fl.canvas)||tl,this.bgcanvas=((hl=this.backSurface)==null?void 0:hl.canvas)||this.canvas,this.ds.element=this.canvas;var $l=this.ctx=(Gl=(bl=(yl=(_l=this.rendererAdapter).getFrontCtx)==null?void 0:yl.call(_l))!=null?bl:(Tl=(ml=this.frontSurface)==null?void 0:ml.getContextCompat)==null?void 0:Tl.call(ml))!=null?Gl:null;this.bgctx=(Wl=(Bl=(Ml=(Il=this.rendererAdapter).getBackCtx)==null?void 0:Ml.call(Il))!=null?Bl:(Fl=(zl=this.backSurface)==null?void 0:zl.getContextCompat)==null?void 0:Fl.call(zl))!=null?Wl:$l,$l==null&&(tl.webgl_enabled||(Hl=LiteGraph.info)==null||Hl.call(LiteGraph,"This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),el||this.bindEvents()}}function _doNothing(tl){return tl.preventDefault(),!1}function _doReturnTrue(tl){return tl.preventDefault(),!0}function bindEvents(){var tl;if(this._events_binded){(tl=LiteGraph.warn)==null||tl.call(LiteGraph,"LGraphCanvas: events already binded");return}this._events_binded=!0;var el=this.canvas,il=this.getCanvasWindow(),sl=il.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),el.addEventListener("pointerdown",this._mousedown_callback,!0),el.addEventListener("pointermove",this._mousemove_callback),el.addEventListener("pointerup",this._mouseup_callback,!0),el.addEventListener("contextmenu",this._doNothing),el.addEventListener("wheel",this.processMouseWheel),el.addEventListener("keydown",this.processKey),sl.addEventListener("keyup",this.processKey),el.addEventListener("dragover",this._doNothing,!1),el.addEventListener("dragend",this._doNothing,!1),el.addEventListener("drop",this.processDrop),el.addEventListener("dragenter",this._doReturnTrue,!1)}function unbindEvents(){var tl;if(!this._events_binded){(tl=LiteGraph.warn)==null||tl.call(LiteGraph,"LGraphCanvas: no events binded");return}this._events_binded=!1;var el=this.canvas,il=this.getCanvasWindow(),sl=il.document;el.removeEventListener("pointerdown",this._mousedown_callback),el.removeEventListener("pointermove",this._mousemove_callback),el.removeEventListener("pointerup",this._mouseup_callback),el.removeEventListener("contextmenu",this._doNothing),el.removeEventListener("wheel",this.processMouseWheel),el.removeEventListener("keydown",this.processKey),sl.removeEventListener("keyup",this.processKey),el.removeEventListener("dragover",this._doNothing,!1),el.removeEventListener("dragend",this._doNothing,!1),el.removeEventListener("drop",this.processDrop),el.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null}function enableWebGL(){var tl,el;if(typeof GL=="undefined")throw new Error("litegl.js must be included to use a WebGL canvas");if(typeof enableWebGLCanvas=="undefined")throw new Error("webglCanvas.js must be included to use this feature");this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.frontSurface={canvas:this.canvas,getContextCompat:()=>this.ctx,resize:(il,sl)=>{this.canvas.width=il,this.canvas.height=sl}},this.backSurface=this.frontSurface,(el=(tl=this.rendererAdapter)==null?void 0:tl.adoptExternalContexts)==null||el.call(tl,{frontCanvas:this.canvas,backCanvas:this.canvas,frontContext:this.ctx,backContext:this.bgctx}),this.canvas.webgl_enabled=!0}function setDirty(tl,el){tl&&(this.dirty_canvas=!0),el&&(this.dirty_bgcanvas=!0)}function getCanvasWindow(){var tl;if(!this.canvas)return window;var el=this.canvas.ownerDocument;return(tl=el.defaultView)!=null?tl:el.parentWindow}function startRendering(){if(this.is_rendering)return;this.is_rendering=!0,tl.call(this);function tl(){this.pause_rendering||this.draw();var el=this.getCanvasWindow();this.is_rendering&&el.requestAnimationFrame(tl.bind(this))}}function stopRendering(){this.is_rendering=!1}function resize(tl,el){var il,sl,nl,ol,rl,al,ll,cl,ul,dl,fl,hl,_l,yl,ml,Tl,bl,Gl,Il,Ml,zl,Fl;if(!tl&&!el){var Bl=this.canvas.parentNode;tl=Bl.offsetWidth,el=Bl.offsetHeight}const Wl=((il=this.frontSurface)==null?void 0:il.canvas)||this.canvas;Wl.width==tl&&Wl.height==el||((sl=this.rendererAdapter)!=null&&sl.resize?(this.rendererAdapter.resize(tl,el),this.frontSurface=(rl=(ol=(nl=this.rendererAdapter).getFrontSurface)==null?void 0:ol.call(nl))!=null?rl:this.frontSurface,this.backSurface=(cl=(ll=(al=this.rendererAdapter).getBackSurface)==null?void 0:ll.call(al))!=null?cl:this.backSurface,this.canvas=((ul=this.frontSurface)==null?void 0:ul.canvas)||this.canvas,this.bgcanvas=((dl=this.backSurface)==null?void 0:dl.canvas)||this.bgcanvas,this.ctx=(Tl=(ml=(hl=(fl=this.rendererAdapter).getFrontCtx)==null?void 0:hl.call(fl))!=null?ml:(yl=(_l=this.frontSurface)==null?void 0:_l.getContextCompat)==null?void 0:yl.call(_l))!=null?Tl:this.ctx,this.bgctx=(Fl=(zl=(Gl=(bl=this.rendererAdapter).getBackCtx)==null?void 0:Gl.call(bl))!=null?zl:(Ml=(Il=this.backSurface)==null?void 0:Il.getContextCompat)==null?void 0:Ml.call(Il))!=null?Fl:this.bgctx,this.ds.element=this.canvas):(this.canvas.width=tl,this.canvas.height=el,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),this.setDirty(!0,!0))}function switchLiveMode(tl){if(!tl){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var el=this,il=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var sl=setInterval(function(){el.editor_alpha*=il,el.dirty_canvas=!0,el.dirty_bgcanvas=!0,il<1&&el.editor_alpha<.01&&(clearInterval(sl),il<1&&(el.live_mode=!0)),il>1&&el.editor_alpha>.99&&(clearInterval(sl),el.editor_alpha=1)},1)}function centerOnNode(tl){this.ds.offset[0]=-tl.pos[0]-tl.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-tl.pos[1]-tl.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)}function adjustMouseEvent(tl){var el=0,il=0;if(this.canvas){var sl=this.canvas.getBoundingClientRect();el=tl.clientX-sl.left,il=tl.clientY-sl.top}else el=tl.clientX,il=tl.clientY;this.last_mouse_position[0]=el,this.last_mouse_position[1]=il,tl.canvasX=el/this.ds.scale-this.ds.offset[0],tl.canvasY=il/this.ds.scale-this.ds.offset[1]}function setZoom(tl,el){this.ds.changeScale(tl,el),this.dirty_canvas=!0,this.dirty_bgcanvas=!0}function convertOffsetToCanvas(tl,el){return this.ds.convertOffsetToCanvas(tl,el)}function convertCanvasToOffset(tl,el){return this.ds.convertCanvasToOffset(tl,el)}function convertEventToCanvasOffset(tl){var el=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([tl.clientX-el.left,tl.clientY-el.top])}const temp=new Float32Array(4),temp_vec2=new Float32Array(2),tmp_area=new Float32Array(4),margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);function isOverNodeBox(tl,el,il){var sl=LiteGraph.NODE_TITLE_HEIGHT;return!!LiteGraph.isInsideRectangle(el,il,tl.pos[0]+2,tl.pos[1]+2-sl,sl-4,sl-4)}function isOverNodeInput(tl,el,il,sl){if(tl.inputs)for(let rl=0,al=tl.inputs.length;rl<al;++rl){var nl=tl.getConnectionPos(!0,rl),ol=!1;if(tl.horizontal?ol=LiteGraph.isInsideRectangle(el,il,nl[0]-5,nl[1]-10,10,20):ol=LiteGraph.isInsideRectangle(el,il,nl[0]-10,nl[1]-5,40,10),ol)return sl&&(sl[0]=nl[0],sl[1]=nl[1]),rl}return-1}function isOverNodeOutput(tl,el,il,sl){if(tl.outputs)for(let rl=0,al=tl.outputs.length;rl<al;++rl){var nl=tl.getConnectionPos(!1,rl),ol=!1;if(tl.horizontal?ol=LiteGraph.isInsideRectangle(el,il,nl[0]-5,nl[1]-10,10,20):ol=LiteGraph.isInsideRectangle(el,il,nl[0]-10,nl[1]-5,40,10),ol)return sl&&(sl[0]=nl[0],sl[1]=nl[1]),rl}return-1}function bringToFront(tl){var el=this.graph._nodes.indexOf(tl);el!=-1&&(this.graph._nodes.splice(el,1),this.graph._nodes.push(tl))}function sendToBack(tl){var el=this.graph._nodes.indexOf(tl);el!=-1&&(this.graph._nodes.splice(el,1),this.graph._nodes.unshift(tl))}function computeVisibleNodes(tl,el){var il=el||[];il.length=0,tl=tl||this.graph._nodes;for(var sl=0,nl=tl.length;sl<nl;++sl){var ol=tl[sl];this.live_mode&&!ol.onDrawBackground&&!ol.onDrawForeground||LiteGraph.overlapBounding(this.visible_area,ol.getBounding(temp,!0))&&il.push(ol)}return il}class CoreController{constructor(el){this.host=el}clear(...el){return clear.apply(this.host,el)}setGraph(...el){return setGraph.apply(this.host,el)}getTopGraph(...el){return getTopGraph.apply(this.host,el)}openSubgraph(...el){return openSubgraph.apply(this.host,el)}closeSubgraph(...el){return closeSubgraph.apply(this.host,el)}getCurrentGraph(...el){return getCurrentGraph.apply(this.host,el)}setCanvas(...el){return setCanvas.apply(this.host,el)}_doNothing(...el){return _doNothing.apply(this.host,el)}_doReturnTrue(...el){return _doReturnTrue.apply(this.host,el)}bindEvents(...el){return bindEvents.apply(this.host,el)}unbindEvents(...el){return unbindEvents.apply(this.host,el)}enableWebGL(...el){return enableWebGL.apply(this.host,el)}setDirty(...el){return setDirty.apply(this.host,el)}getCanvasWindow(...el){return getCanvasWindow.apply(this.host,el)}startRendering(...el){return startRendering.apply(this.host,el)}stopRendering(...el){return stopRendering.apply(this.host,el)}resize(...el){return resize.apply(this.host,el)}switchLiveMode(...el){return switchLiveMode.apply(this.host,el)}centerOnNode(...el){return centerOnNode.apply(this.host,el)}adjustMouseEvent(...el){return adjustMouseEvent.apply(this.host,el)}setZoom(...el){return setZoom.apply(this.host,el)}convertOffsetToCanvas(...el){return convertOffsetToCanvas.apply(this.host,el)}convertCanvasToOffset(...el){return convertCanvasToOffset.apply(this.host,el)}convertEventToCanvasOffset(...el){return convertEventToCanvasOffset.apply(this.host,el)}isOverNodeBox(...el){return isOverNodeBox.apply(this.host,el)}isOverNodeInput(...el){return isOverNodeInput.apply(this.host,el)}isOverNodeOutput(...el){return isOverNodeOutput.apply(this.host,el)}bringToFront(...el){return bringToFront.apply(this.host,el)}sendToBack(...el){return sendToBack.apply(this.host,el)}computeVisibleNodes(...el){return computeVisibleNodes.apply(this.host,el)}}function processUserInputDown(tl){var el,il;if(this.pointer_is_down&&tl.isPrimary!==void 0&&!tl.isPrimary?this.userInput_isNotPrimary=!0:this.userInput_isNotPrimary=!1,this.userInput_type=tl.pointerType?tl.pointerType:!1,this.userInput_id=tl.pointerId?tl.pointerId:!1,tl.pointerType)switch(tl.pointerType){case"mouse":break;case"pen":break;case"touch":break;default:(el=LiteGraph.log)==null||el.call(LiteGraph,"pointerType unknown "+ev.pointerType)}return tl.button!==void 0&&(this.userInput_button=tl.button,tl.button),tl.buttons!==void 0&&(this.userInput_button_s=tl.buttons),this.userInput_touches=tl.changedTouches!==void 0&&tl.changedTouches.length!==void 0?tl.changedTouches:!1,this.userInput_touches&&this.userInput_touches.length&&((il=LiteGraph.debug)==null||il.call(LiteGraph,"check multiTouches",tl.changedTouches)),this.processMouseDown(tl)}function processMouseDown(tl){var el,il,sl,nl,ol,rl,al,ll,cl;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(tl);var ul=this.getCanvasWindow();LGraphCanvas.active_canvas=this;var dl=tl.clientX,fl=tl.clientY;(el=LiteGraph.log)==null||el.call(LiteGraph,"pointerevents: processMouseDown pointerId:"+tl.pointerId+" which:"+tl.which+" isPrimary:"+tl.isPrimary+" :: x y "+dl+" "+fl,"previousClick",this.last_mouseclick,"diffTimeClick",this.last_mouseclick?LiteGraph.getTime()-this.last_mouseclick:"notlast"),this.ds.viewport=this.viewport;var hl=!this.viewport||this.viewport&&dl>=this.viewport[0]&&dl<this.viewport[0]+this.viewport[2]&&fl>=this.viewport[1]&&fl<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(this.canvas.removeEventListener("pointermove",this._mousemove_callback),ul.document.addEventListener("pointermove",this._mousemove_callback,!0),ul.document.addEventListener("pointerup",this._mouseup_callback,!0)),!!hl){var _l=this.graph.getNodeOnPos(tl.canvasX,tl.canvasY,this.visible_nodes,5),yl=!1,ml=LiteGraph.getTime(),Tl=tl.isPrimary===void 0||tl.isPrimary,bl=ml-this.last_mouseclick<300&&Tl;if(this.mouse[0]=tl.clientX,this.mouse[1]=tl.clientY,this.graph_mouse[0]=tl.canvasX,this.graph_mouse[1]=tl.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&Tl?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.ContextMenu.closeAll(ul),!((il=this.onMouse)!=null&&il.call(this,tl))){if(tl.which==1&&!this.userInput_isNotPrimary){if(tl.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=tl.canvasX,this.dragging_rectangle[1]=tl.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,yl=!0),LiteGraph.alt_drag_do_clone_nodes&&tl.altKey&&_l&&this.allow_interaction&&!yl&&!this.read_only){let Xl=_l,tc=_l.clone();if(tc){if(tc.pos[0]+=5,tc.pos[1]+=5,this.graph.add(tc,!1,{doCalcSize:!1}),_l=tc,LiteGraph.alt_shift_drag_connect_clone_with_input&&tl.shiftKey&&Xl.inputs&&Xl.inputs.length)for(var Gl=0;Gl<Xl.inputs.length;++Gl){var Il=Xl.inputs[Gl];if(!(!Il||Il.link==null)){var Ml=this.graph.links[Il.link];if(Ml&&Ml.type!==LiteGraph.EVENT){var zl;Ml.origin_id&&(zl=this.graph.getNodeById(Ml.origin_id));var Fl=_l;zl&&Fl&&zl.connect(Ml.origin_slot,Fl,Ml.target_slot)}}}yl=!0,Hl||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=_l),this.selected_nodes[_l.id]||this.processNodeSelected(_l,tl))}}var Bl=!1;if(_l&&(this.allow_interaction||_l.flags.allow_interaction)&&!yl&&!this.read_only){if(!this.live_mode&&!_l.flags.pinned&&this.bringToFront(_l),this.allow_interaction&&!this.connecting_node&&!_l.flags.collapsed&&!this.live_mode)if(!yl&&_l.resizable!==!1&&LiteGraph.isInsideRectangle(tl.canvasX,tl.canvasY,_l.pos[0]+_l.size[0]-5,_l.pos[1]+_l.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=_l,this.canvas.style.cursor="se-resize",yl=!0;else{if(_l.outputs)for(let Xl=0,tc=_l.outputs.length;Xl<tc;++Xl){let ic=_l.outputs[Xl],Ll=_l.getConnectionPos(!1,Xl);if(LiteGraph.isInsideRectangle(tl.canvasX,tl.canvasY,Ll[0]-15,Ll[1]-10,30,20)){this.connecting_node=_l,this.connecting_output=ic,this.connecting_output.slot_index=Xl,this.connecting_pos=_l.getConnectionPos(!1,Xl),this.connecting_slot=Xl,LiteGraph.shift_click_do_break_link_from&&tl.shiftKey&&_l.disconnectOutput(Xl),bl?(sl=_l.onOutputDblClick)==null||sl.call(_l,Xl,tl):(nl=_l.onOutputClick)==null||nl.call(_l,Xl,tl),yl=!0;break}}if(_l.inputs)for(let Xl=0,tc=_l.inputs.length;Xl<tc;++Xl){let ic=_l.inputs[Xl],Ll=_l.getConnectionPos(!0,Xl);if(LiteGraph.isInsideRectangle(tl.canvasX,tl.canvasY,Ll[0]-15,Ll[1]-10,30,20)){if(bl?(ol=_l.onInputDblClick)==null||ol.call(_l,Xl,tl):(rl=_l.onInputClick)==null||rl.call(_l,Xl,tl),ic.link!==null){var Wl=this.graph.links[ic.link];LiteGraph.click_do_break_link_to&&(_l.disconnectInput(Xl),this.dirty_bgcanvas=!0,yl=!0),tl.shiftKey&&(LiteGraph.click_do_break_link_to||_l.disconnectInput(Xl),this.connecting_node=this.graph._nodes_by_id[Wl.origin_id],this.connecting_slot=Wl.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,yl=!0)}yl||(this.connecting_node=_l,this.connecting_input=ic,this.connecting_input.slot_index=Xl,this.connecting_pos=_l.getConnectionPos(!0,Xl),this.connecting_slot=Xl,this.dirty_bgcanvas=!0,yl=!0)}}}if(!yl){var Hl=!1,$l=[tl.canvasX-_l.pos[0],tl.canvasY-_l.pos[1]],Ul=this.processNodeWidgets(_l,this.graph_mouse,tl);Ul&&(Hl=!0,this.node_widget=[_l,Ul]),this.allow_interaction&&bl&&this.selected_nodes[_l.id]&&((al=_l.onDblClick)==null||al.call(_l,tl,$l,this),this.processNodeDblClicked(_l),Hl=!0),_l.onMouseDown&&_l.onMouseDown(tl,$l,this)?Hl=!0:(_l.subgraph&&!_l.skip_subgraph_button&&!_l.flags.collapsed&&$l[0]>_l.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&$l[1]<0&&setTimeout(()=>{this.openSubgraph(_l.subgraph)},10),this.live_mode&&(Bl=!0,Hl=!0)),Hl?_l.is_selected||this.processNodeSelected(_l,tl):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=_l),this.processNodeSelected(_l,tl)),this.dirty_canvas=!0}}else if(!yl){if(!this.read_only)for(let Xl=0;Xl<this.visible_links.length;++Xl){var jl=this.visible_links[Xl],Vl=jl._pos;if(!(!Vl||tl.canvasX<Vl[0]-4||tl.canvasX>Vl[0]+4||tl.canvasY<Vl[1]-4||tl.canvasY>Vl[1]+4)){this.showLinkMenu(jl,tl),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(tl.canvasX,tl.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){tl.ctrlKey&&(this.dragging_rectangle=null);var Yl=LiteGraph.distance([tl.canvasX,tl.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);Yl*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}bl&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(tl),tl.preventDefault(),tl.stopPropagation()),(ll=LiteGraph.debug)==null||ll.call(LiteGraph,"DEBUG canvas click is_double_click,this.allow_searchbox",bl,this.allow_searchbox),Bl=!0}!yl&&Bl&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(tl.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(_l&&this.allow_interaction&&!yl&&!this.read_only&&!this.connecting_node&&!_l.flags.collapsed&&!this.live_mode){var Ql=!1,ql=!1,Kl=!1;if(_l.outputs)for(let Xl=0,tc=_l.outputs.length;Xl<tc;++Xl){var Jl=_l.outputs[Xl];let ic=_l.getConnectionPos(!1,Xl);if(LiteGraph.isInsideRectangle(tl.canvasX,tl.canvasY,ic[0]-15,ic[1]-10,30,20)){Ql=Jl,ql=Xl,Kl=!0;break}}if(_l.inputs)for(let Xl=0,tc=_l.inputs.length;Xl<tc;++Xl){var Il=_l.inputs[Xl];let Ll=_l.getConnectionPos(!0,Xl);if(LiteGraph.isInsideRectangle(tl.canvasX,tl.canvasY,Ll[0]-15,Ll[1]-10,30,20)){Ql=Il,ql=Xl,Kl=!1;break}}if(Ql&&ql!==!1){var Zl=.5-(ql+1)/(Kl?_l.outputs.length:_l.inputs.length),ec=_l.getBounding(),oc=[Kl?ec[0]+ec[2]:ec[0],tl.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:Kl?_l:null,slotFrom:Kl?ql:null,nodeTo:Kl?null:_l,slotTo:Kl?null:ql,position:oc,nodeType:"AUTO",posAdd:[Kl?30:-30,-Zl*130],posSizeFix:[Kl?0:-1,0]})}}}else!yl&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(tl.which==3||LiteGraph.two_fingers_opens_menu&&this.userInput_isNotPrimary)&&this.allow_interaction&&!yl&&!this.read_only&&(_l&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[_l.id]||tl.shiftKey||tl.ctrlKey||tl.metaKey)?this.selected_nodes[_l.id]||this.selectNodes([_l],!0):this.selectNodes([_l])),this.processContextMenu(_l,tl));return this.last_mouse[0]=tl.clientX,this.last_mouse[1]=tl.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!ul.document.activeElement||ul.document.activeElement.nodeName.toLowerCase()!="input"&&ul.document.activeElement.nodeName.toLowerCase()!="textarea")&&tl.preventDefault(),tl.stopPropagation(),(cl=this.onMouseDown)==null||cl.call(this,tl),!1}}}}function processMouseMove(tl){var el,il;if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(tl);var sl=[tl.clientX,tl.clientY];this.mouse[0]=sl[0],this.mouse[1]=sl[1];var nl=[sl[0]-this.last_mouse[0],sl[1]-this.last_mouse[1]];if(this.last_mouse=sl,this.graph_mouse[0]=tl.canvasX,this.graph_mouse[1]=tl.canvasY,this.block_click)return tl.preventDefault(),!1;tl.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,tl,this.node_widget[1]),this.dirty_canvas=!0);var ol=this.graph.getNodeOnPos(tl.canvasX,tl.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=tl.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=tl.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[tl.canvasX-this.selected_group.pos[0],tl.canvasY-this.selected_group.pos[1]];else{var rl=nl[0]/this.ds.scale,al=nl[1]/this.ds.scale;this.selected_group.move(rl,al,tl.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=nl[0]/this.ds.scale,this.ds.offset[1]+=nl[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||ol&&ol.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(let hl=0,_l=this.graph._nodes.length;hl<_l;++hl)this.graph._nodes[hl].mouseOver&&ol!=this.graph._nodes[hl]&&(this.graph._nodes[hl].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(tl),this.node_over=null,this.dirty_canvas=!0);if(ol){if(ol.redraw_on_mouse&&(this.dirty_canvas=!0),ol.mouseOver||(ol.mouseOver=!0,this.node_over=ol,this.dirty_canvas=!0,(el=ol.onMouseEnter)==null||el.call(ol,tl)),(il=ol.onMouseMove)==null||il.call(ol,tl,[tl.canvasX-ol.pos[0],tl.canvasY-ol.pos[1]],this),this.connecting_node){let hl;if(this.connecting_output){if(hl=this._highlight_input||[0,0],!this.isOverNodeBox(ol,tl.canvasX,tl.canvasY)){let _l=this.isOverNodeInput(ol,tl.canvasX,tl.canvasY,hl);if(_l!=-1&&ol.inputs[_l]){let yl=ol.inputs[_l].type;LiteGraph.isValidConnection(this.connecting_output.type,yl)&&(this._highlight_input=hl,this._highlight_input_slot=ol.inputs[_l])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input&&(hl=this._highlight_output||[0,0],this.isOverNodeBox(ol,tl.canvasX,tl.canvasY))){let _l=this.isOverNodeOutput(ol,tl.canvasX,tl.canvasY,hl);if(_l!=-1&&ol.outputs[_l]){let yl=ol.outputs[_l].type;LiteGraph.isValidConnection(this.connecting_input.type,yl)&&(this._highlight_output=hl)}else this._highlight_output=null}}this.canvas&&(LiteGraph.isInsideRectangle(tl.canvasX,tl.canvasY,ol.pos[0]+ol.size[0]-5,ol.pos[1]+ol.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var ll=null;for(let hl=0;hl<this.visible_links.length;++hl){var cl=this.visible_links[hl],ul=cl._pos;if(!(!ul||tl.canvasX<ul[0]-4||tl.canvasX>ul[0]+4||tl.canvasY<ul[1]-4||tl.canvasY>ul[1]+4)){ll=cl;break}}ll!=this.over_link_center&&(this.over_link_center=ll,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=ol&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(tl,[tl.canvasX-this.node_capturing_input.pos[0],tl.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(let hl in this.selected_nodes){let _l=this.selected_nodes[hl];_l.pos[0]+=nl[0]/this.ds.scale,_l.pos[1]+=nl[1]/this.ds.scale,_l.is_selected||this.processNodeSelected(_l,tl)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var dl=[tl.canvasX-this.resizing_node.pos[0],tl.canvasY-this.resizing_node.pos[1]],fl=this.resizing_node.computeSize();dl[0]=Math.max(fl[0],dl[0]),dl[1]=Math.max(fl[1],dl[1]),this.resizing_node.setSize(dl),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return tl.preventDefault(),!1}}function processMouseUp(tl){var el,il=tl.isPrimary===void 0||tl.isPrimary;if(!il)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var sl=this.getCanvasWindow(),nl=sl.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(nl.removeEventListener("pointermove",this._mousemove_callback,!0),this.canvas.addEventListener("pointermove",this._mousemove_callback,!0),nl.removeEventListener("pointerup",this._mouseup_callback,!0)),this.adjustMouseEvent(tl);var ol=LiteGraph.getTime();if(tl.click_time=ol-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),tl.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,tl),this.node_widget=null,this.selected_group){var rl=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),al=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(rl,al,tl.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var ll=this.graph.getNodeOnPos(tl.canvasX,tl.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var cl=this.graph._nodes,ul=new Float32Array(4),dl=Math.abs(this.dragging_rectangle[2]),fl=Math.abs(this.dragging_rectangle[3]),hl=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-dl:this.dragging_rectangle[0],_l=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-fl:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=hl,this.dragging_rectangle[1]=_l,this.dragging_rectangle[2]=dl,this.dragging_rectangle[3]=fl,!ll||dl>10&&fl>10){var yl=[];for(let Gl=0;Gl<cl.length;++Gl){var ml=cl[Gl];ml.getBounding(ul),LiteGraph.overlapBounding(this.dragging_rectangle,ul)&&yl.push(ml)}yl.length&&this.selectNodes(yl,tl.shiftKey)}else this.selectNodes([ll],tl.shiftKey||tl.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var Tl=this.connecting_output||this.connecting_input,bl=Tl.type;if(ll=this.graph.getNodeOnPos(tl.canvasX,tl.canvasY,this.visible_nodes),ll){let Gl;this.connecting_output?(Gl=this.isOverNodeInput(ll,tl.canvasX,tl.canvasY),Gl!=-1?this.connecting_node.connect(this.connecting_slot,ll,Gl):this.connecting_node.connectByType(this.connecting_slot,ll,bl)):this.connecting_input&&(Gl=this.isOverNodeOutput(ll,tl.canvasX,tl.canvasY),Gl!=-1?ll.connect(Gl,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,ll,bl))}else LiteGraph.release_link_on_empty_shows_menu&&(tl.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(tl,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(tl,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:tl}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:tl}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null):this.node_dragged?(ll=this.node_dragged,ll&&tl.click_time<300&&LiteGraph.isInsideRectangle(tl.canvasX,tl.canvasY,ll.pos[0],ll.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&ll.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),(el=this.onNodeMoved)==null||el.call(this,this.node_dragged),this.graph.onGraphChanged({action:"nodeDrag",doSave:!0}),this.graph.afterChange(this.node_dragged),this.node_dragged=null):(ll=this.graph.getNodeOnPos(tl.canvasX,tl.canvasY,this.visible_nodes),!ll&&tl.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(tl,[tl.canvasX-this.node_over.pos[0],tl.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(tl,[tl.canvasX-this.node_capturing_input.pos[0],tl.canvasY-this.node_capturing_input.pos[1]]))}else tl.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):tl.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return il&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),tl.stopPropagation(),tl.preventDefault(),!1}}function processMouseWheel(tl){if(!(!this.graph||!this.allow_dragcanvas)){var el=tl.wheelDeltaY!=null?tl.wheelDeltaY:tl.detail*-60;this.adjustMouseEvent(tl);var il=tl.clientX,sl=tl.clientY,nl=!this.viewport||this.viewport&&il>=this.viewport[0]&&il<this.viewport[0]+this.viewport[2]&&sl>=this.viewport[1]&&sl<this.viewport[1]+this.viewport[3];if(nl){var ol=this.ds.scale;return ol*=Math.pow(1.1,el*.01),this.ds.changeScale(ol,[tl.clientX,tl.clientY]),this.graph.change(),tl.preventDefault(),!1}}}function blockClick(){this.block_click=!0,this.last_mouseclick=0}function processKey(tl){var el,il,sl,nl,ol;if(this.graph){var rl=!1;if(tl.target.localName!="input"){if(tl.type=="keydown"){if(tl.keyCode==32&&(this.dragging_canvas=!0,rl=!0),tl.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),rl=!0),tl.keyCode==65&&tl.ctrlKey&&(this.selectNodes(),rl=!0),tl.keyCode===67&&(tl.metaKey||tl.ctrlKey)&&!tl.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),rl=!0),tl.keyCode===86&&(tl.metaKey||tl.ctrlKey)&&this.pasteFromClipboard(tl.shiftKey),(tl.keyCode==46||LiteGraph.backspace_delete&&tl.keyCode==8)&&tl.target.localName!="input"&&tl.target.localName!="textarea"&&(this.deleteSelectedNodes(),rl=!0),LiteGraph.actionHistory_enabled&&(tl.keyCode==89&&tl.ctrlKey||tl.keyCode==90&&tl.ctrlKey&&tl.shiftKey?this.graph.actionHistoryForward():tl.keyCode==90&&tl.ctrlKey&&this.graph.actionHistoryBack()),(el=LiteGraph.debug)==null||el.call(LiteGraph,"Canvas keydown "+tl.keyCode),this.selected_nodes)for(let al in this.selected_nodes)(sl=(il=this.selected_nodes[al]).onKeyDown)==null||sl.call(il,tl)}else if(tl.type=="keyup"&&(tl.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(let al in this.selected_nodes)(ol=(nl=this.selected_nodes[al]).onKeyUp)==null||ol.call(nl,tl);if(this.graph.change(),rl)return tl.preventDefault(),tl.stopImmediatePropagation(),!1}}}function processDrop(tl){tl.preventDefault(),this.adjustMouseEvent(tl);var el=tl.clientX,il=tl.clientY,sl=!this.viewport||this.viewport&&el>=this.viewport[0]&&el<this.viewport[0]+this.viewport[2]&&il>=this.viewport[1]&&il<this.viewport[1]+this.viewport[3];if(sl){el=tl.localX,il=tl.localY;var sl=!this.viewport||this.viewport&&el>=this.viewport[0]&&el<this.viewport[0]+this.viewport[2]&&il>=this.viewport[1]&&il<this.viewport[1]+this.viewport[3];if(sl){var nl=[tl.canvasX,tl.canvasY],ol=this.graph?this.graph.getNodeOnPos(nl[0],nl[1]):null;if(!ol){var rl=null;this.onDropItem&&(rl=this.onDropItem(event)),rl||this.checkDropItem(tl);return}if(ol.onDropFile||ol.onDropData){var al=tl.dataTransfer.files;if(al&&al.length)for(let hl=0;hl<al.length;hl++){var ll=tl.dataTransfer.files[0],cl=ll.name;if(ol.onDropFile&&ol.onDropFile(ll),ol.onDropData){var ul=new FileReader;ul.onload=function(_l){var yl=_l.target.result;ol.onDropData(yl,cl,ll)};var dl=ll.type.split("/")[0];dl=="text"||dl==""?ul.readAsText(ll):dl=="image"?ul.readAsDataURL(ll):ul.readAsArrayBuffer(ll)}}}return ol.onDropItem&&ol.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}}}function checkDropItem(tl){var el;if(tl.dataTransfer.files.length){var il=tl.dataTransfer.files[0],sl=LGraphCanvas.getFileExtension(il.name).toLowerCase(),nl=LiteGraph.node_types_by_file_extension[sl];if(nl){this.graph.beforeChange();var ol=LiteGraph.createNode(nl.type);ol.pos=[tl.canvasX,tl.canvasY],this.graph.add(ol,!1,{doProcessChange:!1}),(el=ol.onDropFile)==null||el.call(ol,il),this.graph.onGraphChanged({action:"fileDrop",doSave:!0}),this.graph.afterChange()}}}class EventsController{constructor(el){this.host=el}processUserInputDown(...el){return processUserInputDown.apply(this.host,el)}processMouseDown(...el){return processMouseDown.apply(this.host,el)}processMouseMove(...el){return processMouseMove.apply(this.host,el)}processMouseUp(...el){return processMouseUp.apply(this.host,el)}processMouseWheel(...el){return processMouseWheel.apply(this.host,el)}blockClick(...el){return blockClick.apply(this.host,el)}processKey(...el){return processKey.apply(this.host,el)}processDrop(...el){return processDrop.apply(this.host,el)}checkDropItem(...el){return checkDropItem.apply(this.host,el)}}function draw(tl,el){var il;const sl=((il=this.frontSurface)==null?void 0:il.canvas)||this.canvas;if(!(!sl||sl.width==0||sl.height==0)){var nl=LiteGraph.getTime();this.render_time=(nl-this.last_draw_time)*.001,this.last_draw_time=nl,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||el||this.always_render_background||this.graph&&this.graph._last_trigger_time&&nl-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas();var ol=this.dirty_canvas||tl;if(ol&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1,this.ds.scale<.7){if(ol){var rl=this.low_quality_rendering_threshold;const al=45;this.fps<al?(this.low_quality_rendering_counter+=al/this.fps,this.low_quality_rendering_counter=Math.min(this.low_quality_rendering_counter,2*rl)):(this.low_quality_rendering_counter-=this.fps/al*.01,this.low_quality_rendering_counter=Math.max(this.low_quality_rendering_counter,0))}}else this.low_quality_rendering_counter=0}}function drawFrontCanvas(){var tl,el,il,sl,nl,ol,rl,al,ll,cl,ul,dl,fl,hl,_l,yl,ml,Tl;this.dirty_canvas=!1;const bl=(tl=this.rendererAdapter)!=null?tl:null,Gl=((el=bl==null?void 0:bl.isLayerNative)==null?void 0:el.call(bl,"front"))===!0,Il=((il=bl==null?void 0:bl.isLayerNative)==null?void 0:il.call(bl,"back"))===!0;this.ctx||(this.ctx=(al=(rl=(sl=bl==null?void 0:bl.getFrontCtx)==null?void 0:sl.call(bl))!=null?rl:(ol=(nl=this.frontSurface)==null?void 0:nl.getContextCompat)==null?void 0:ol.call(nl))!=null?al:null);var Ml=this.ctx;if(!Ml)return;(ll=bl==null?void 0:bl.beginFrame)==null||ll.call(bl,"front");var zl=((cl=this.frontSurface)==null?void 0:cl.canvas)||this.canvas;Ml.start2D&&!this.viewport&&(Ml.start2D(),Ml.restore(),Ml.setTransform(1,0,0,1,0,0));var Fl=this.viewport||this.dirty_area;Fl&&(Ml.save(),Ml.beginPath(),Ml.rect(Fl[0],Fl[1],Fl[2],Fl[3]),Ml.clip()),this.clear_background&&(Fl?Ml.clearRect(Fl[0],Fl[1],Fl[2],Fl[3]):Ml.clearRect(0,0,zl.width,zl.height));const Bl=((ul=this.backSurface)==null?void 0:ul.canvas)||this.bgcanvas;if(Bl==zl?this.drawBackCanvas():Bl&&((Gl||Il)&&bl!=null&&bl.blitBackToFront?bl.blitBackToFront(Ml):Ml.drawImage(Bl,0,0)),(dl=this.onRender)==null||dl.call(this,zl,Ml),this.show_info&&this.renderInfo(Ml,Fl?Fl[0]:0,Fl?Fl[1]:0),this.graph){Ml.save(),this.ds.toCanvasContext(Ml);var Wl=this.computeVisibleNodes(null,this.visible_nodes);for(let Ql=0;Ql<Wl.length;++Ql){let ql=Wl[Ql];Ml.save(),Ml.translate(ql.pos[0],ql.pos[1]),this.drawNode(ql,Ml),Ml.restore()}if(this.render_execution_order&&this.drawExecutionOrder(Ml),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(Ml)),this.connecting_pos!=null){Ml.lineWidth=this.connections_width;var Hl=null,$l=this.connecting_output||this.connecting_input,Ul=$l.type,jl=$l.dir;jl==null&&(this.connecting_output?jl=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:jl=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var Vl=$l.shape;switch(Ul){case LiteGraph.EVENT:case LiteGraph.ACTION:Hl=LiteGraph.EVENT_LINK_COLOR;break;default:Hl=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(Ml,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,Hl,jl,LiteGraph.CENTER),Ml.beginPath(),Ul===LiteGraph.EVENT||Ul===LiteGraph.ACTION||Vl===LiteGraph.BOX_SHAPE?(Ml.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),Ml.fill(),Ml.beginPath(),Ml.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):Vl===LiteGraph.ARROW_SHAPE?(Ml.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),Ml.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),Ml.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),Ml.closePath()):(Ml.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),Ml.fill(),Ml.beginPath(),Ml.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),Ml.fill(),Ml.fillStyle="#ffcc00",this._highlight_input){Ml.beginPath();var Yl=this._highlight_input_slot.shape;Yl===LiteGraph.ARROW_SHAPE?(Ml.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),Ml.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),Ml.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),Ml.closePath()):Ml.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),Ml.fill()}this._highlight_output&&(Ml.beginPath(),Yl===LiteGraph.ARROW_SHAPE?(Ml.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),Ml.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),Ml.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),Ml.closePath()):Ml.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),Ml.fill())}this.dragging_rectangle&&(Ml.strokeStyle="#FFF",Ml.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(Ml,this.over_link_center):(fl=this.onDrawLinkTooltip)==null||fl.call(this,Ml,null),(hl=this.onDrawForeground)==null||hl.call(this,Ml,this.visible_rect),Ml.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(Ml),(_l=this.onDrawOverlay)==null||_l.call(this,Ml),Fl&&Ml.restore(),(yl=Ml.finish2D)==null||yl.call(Ml),(ml=bl==null?void 0:bl.syncLayer)==null||ml.call(bl,"front"),(Tl=bl==null?void 0:bl.endFrame)==null||Tl.call(bl,"front")}function lowQualityRenderingRequired(tl){return this.ds.scale<tl?this.low_quality_rendering_counter>this.low_quality_rendering_threshold:!1}const titleGradientCacheByContext=new WeakMap;function ensureRoundRectCompat(tl){if(!tl||typeof tl.roundRect=="function")return;const el=typeof tl.rect=="function"?function(il,sl,nl,ol){this.rect(il,sl,nl,ol)}:function(){};try{tl.roundRect=el}catch{}}function getTitleGradientCache(tl){let el=titleGradientCacheByContext.get(tl);return el||(el=new Map,titleGradientCacheByContext.set(tl,el)),el}function getTitleGradientForContext(tl,el){const il=el||LiteGraph.NODE_DEFAULT_COLOR;if(!tl||typeof tl.createLinearGradient!="function")return il;const sl=getTitleGradientCache(tl);let nl=sl.get(il);if(!nl){nl=tl.createLinearGradient(0,0,400,0);try{nl.addColorStop(0,il)}catch{nl.addColorStop(0,LiteGraph.NODE_DEFAULT_COLOR)}nl.addColorStop(1,"#000"),sl.set(il,nl)}return nl}function drawNode(tl,el){var il,sl,nl;ensureRoundRectCompat(el),this.current_node=tl;var ol=tl.color||tl.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,rl=tl.bgcolor||tl.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR,al=this.ds.scale<.6;if(this.live_mode){tl.flags.collapsed||(el.shadowColor="transparent",(il=tl.onDrawForeground)==null||il.call(tl,el,this,this.canvas));return}var ll=this.editor_alpha;if(el.globalAlpha=ll,this.render_shadows&&!al?(el.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,el.shadowOffsetX=2*this.ds.scale,el.shadowOffsetY=2*this.ds.scale,el.shadowBlur=3*this.ds.scale):el.shadowColor="transparent",!(tl.flags.collapsed&&(sl=tl.onDrawCollapsed)!=null&&sl.call(tl,el,this))){var cl=tl._shape||LiteGraph.BOX_SHAPE,ul=temp_vec2;temp_vec2.set(tl.size);var dl=tl.horizontal;if(tl.flags.collapsed){el.font=this.inner_text_font;var fl=tl.getTitle?tl.getTitle():tl.title;fl!=null&&(tl._collapsed_width=Math.min(tl.size[0],el.measureText(fl).width+LiteGraph.NODE_TITLE_HEIGHT*2),ul[0]=tl._collapsed_width,ul[1]=0)}(tl.clip_area||this.clip_all_nodes)&&(el.save(),el.beginPath(),cl==LiteGraph.BOX_SHAPE?el.rect(0,0,ul[0],ul[1]):cl==LiteGraph.ROUND_SHAPE?el.roundRect(0,0,ul[0],ul[1],[10]):cl==LiteGraph.CIRCLE_SHAPE&&el.arc(ul[0]*.5,ul[1]*.5,ul[0]*.5,0,Math.PI*2),el.clip()),tl.has_errors&&(rl="red"),this.drawNodeShape(tl,el,ul,ol,rl,tl.is_selected,tl.mouseOver),el.shadowColor="transparent",(nl=tl.onDrawForeground)==null||nl.call(tl,el,this,this.canvas),LiteGraph.show_node_tooltip&&tl.mouseOver&&tl.is_selected&&(!this.selected_nodes||Object.keys(this.selected_nodes).length<=1)&&this.drawNodeTooltip(el,tl),el.textAlign=dl?"center":"left",el.font=this.inner_text_font;var hl=!this.lowQualityRenderingRequired(.6),_l=this.connecting_output,yl=this.connecting_input;el.lineWidth=1;var ml=0,Tl=new Float32Array(2),bl;if(tl.flags.collapsed){if(this.render_collapsed_slots){var Gl=null,Il=null;if(tl.inputs)for(let Fl=0;Fl<tl.inputs.length;Fl++){var Ml=tl.inputs[Fl];if(Ml.link!=null){Gl=Ml;break}}if(tl.outputs)for(let Fl=0;Fl<tl.outputs.length;Fl++){var Ml=tl.outputs[Fl];!Ml.links||!Ml.links.length||(Il=Ml)}if(Gl){let Fl=0,Bl=LiteGraph.NODE_TITLE_HEIGHT*-.5;dl&&(Fl=tl._collapsed_width*.5,Bl=-LiteGraph.NODE_TITLE_HEIGHT),el.fillStyle="#686",el.beginPath(),Ml.type===LiteGraph.EVENT||Ml.type===LiteGraph.ACTION||Ml.shape===LiteGraph.BOX_SHAPE?el.rect(Fl-7+.5,Bl-4,14,8):Ml.shape===LiteGraph.ARROW_SHAPE?(el.moveTo(Fl+8,Bl),el.lineTo(Fl+-4,Bl-4),el.lineTo(Fl+-4,Bl+4),el.closePath()):el.arc(Fl,Bl,4,0,Math.PI*2),el.fill()}if(Il){let Fl=tl._collapsed_width,Bl=LiteGraph.NODE_TITLE_HEIGHT*-.5;dl&&(Fl=tl._collapsed_width*.5,Bl=0),el.fillStyle="#686",el.strokeStyle="black",el.beginPath(),Ml.type===LiteGraph.EVENT||Ml.type===LiteGraph.ACTION||Ml.shape===LiteGraph.BOX_SHAPE?el.rect(Fl-7+.5,Bl-4,14,8):Ml.shape===LiteGraph.ARROW_SHAPE?(el.moveTo(Fl+6,Bl),el.lineTo(Fl-6,Bl-4),el.lineTo(Fl-6,Bl+4),el.closePath()):el.arc(Fl,Bl,4,0,Math.PI*2),el.fill()}}}else{if(tl.inputs)for(let Fl=0;Fl<tl.inputs.length;Fl++){let Bl=tl.inputs[Fl],Wl=Bl.type,Hl=Bl.shape;el.globalAlpha=ll,this.connecting_output&&!LiteGraph.isValidConnection(Bl.type,_l.type)&&(el.globalAlpha=.4*ll),el.fillStyle=Bl.link!=null?Bl.color_on||this.default_connection_color_byType[Wl]||this.default_connection_color.input_on:Bl.color_off||this.default_connection_color_byTypeOff[Wl]||this.default_connection_color_byType[Wl]||this.default_connection_color.input_off;let $l=tl.getConnectionPos(!0,Fl,Tl);if($l[0]-=tl.pos[0],$l[1]-=tl.pos[1],ml<$l[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(ml=$l[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),el.beginPath(),Wl=="array"?Hl=LiteGraph.GRID_SHAPE:Bl.name=="onTrigger"||Bl.name=="onExecuted"?Hl=LiteGraph.ARROW_SHAPE:(Wl===LiteGraph.EVENT||Wl===LiteGraph.ACTION)&&(Hl=LiteGraph.BOX_SHAPE),bl=!0,Hl===LiteGraph.BOX_SHAPE?dl?el.rect($l[0]-5+.5,$l[1]-8+.5,10,14):el.rect($l[0]-6+.5,$l[1]-5+.5,14,10):Hl===LiteGraph.ARROW_SHAPE?(el.moveTo($l[0]+8,$l[1]+.5),el.lineTo($l[0]-4,$l[1]+6+.5),el.lineTo($l[0]-4,$l[1]-6+.5),el.closePath()):Hl===LiteGraph.GRID_SHAPE?(el.rect($l[0]-4,$l[1]-4,2,2),el.rect($l[0]-1,$l[1]-4,2,2),el.rect($l[0]+2,$l[1]-4,2,2),el.rect($l[0]-4,$l[1]-1,2,2),el.rect($l[0]-1,$l[1]-1,2,2),el.rect($l[0]+2,$l[1]-1,2,2),el.rect($l[0]-4,$l[1]+2,2,2),el.rect($l[0]-1,$l[1]+2,2,2),el.rect($l[0]+2,$l[1]+2,2,2),bl=!1):al?el.rect($l[0]-4,$l[1]-4,8,8):el.arc($l[0],$l[1],4,0,Math.PI*2),el.fill(),hl&&!(Bl.name=="onTrigger"||Bl.name=="onExecuted")){let Ul=Bl.label!=null?Bl.label:Bl.name;Ul&&(el.fillStyle=LiteGraph.NODE_TEXT_COLOR,dl||Bl.dir==LiteGraph.UP?el.fillText(Ul,$l[0],$l[1]-10):el.fillText(Ul,$l[0]+10,$l[1]+5))}}if(el.textAlign=dl?"center":"right",el.strokeStyle="black",tl.outputs)for(let Fl=0;Fl<tl.outputs.length;Fl++){let Bl=tl.outputs[Fl],Wl=Bl.type,Hl=Bl.shape;this.connecting_input&&!LiteGraph.isValidConnection(Wl,yl.type)&&(el.globalAlpha=.4*ll);let $l=tl.getConnectionPos(!1,Fl,Tl);if($l[0]-=tl.pos[0],$l[1]-=tl.pos[1],ml<$l[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(ml=$l[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),el.fillStyle=Bl.links&&Bl.links.length?Bl.color_on||this.default_connection_color_byType[Wl]||this.default_connection_color.output_on:Bl.color_off||this.default_connection_color_byTypeOff[Wl]||this.default_connection_color_byType[Wl]||this.default_connection_color.output_off,el.beginPath(),Wl=="array"?Hl=LiteGraph.GRID_SHAPE:Bl.name=="onTrigger"||Bl.name=="onExecuted"?Hl=LiteGraph.ARROW_SHAPE:(Wl===LiteGraph.EVENT||Wl===LiteGraph.ACTION)&&(Hl=LiteGraph.BOX_SHAPE),bl=!0,Hl===LiteGraph.BOX_SHAPE?dl?el.rect($l[0]-5+.5,$l[1]-8+.5,10,14):el.rect($l[0]-6+.5,$l[1]-5+.5,14,10):Hl===LiteGraph.ARROW_SHAPE?(el.moveTo($l[0]+8,$l[1]+.5),el.lineTo($l[0]-4,$l[1]+6+.5),el.lineTo($l[0]-4,$l[1]-6+.5),el.closePath()):Hl===LiteGraph.GRID_SHAPE?(el.rect($l[0]-4,$l[1]-4,2,2),el.rect($l[0]-1,$l[1]-4,2,2),el.rect($l[0]+2,$l[1]-4,2,2),el.rect($l[0]-4,$l[1]-1,2,2),el.rect($l[0]-1,$l[1]-1,2,2),el.rect($l[0]+2,$l[1]-1,2,2),el.rect($l[0]-4,$l[1]+2,2,2),el.rect($l[0]-1,$l[1]+2,2,2),el.rect($l[0]+2,$l[1]+2,2,2),bl=!1):al?el.rect($l[0]-4,$l[1]-4,8,8):el.arc($l[0],$l[1],4,0,Math.PI*2),el.fill(),!al&&bl&&el.stroke(),hl&&!(Bl.name=="onTrigger"||Bl.name=="onExecuted")){let Ul=Bl.label!=null?Bl.label:Bl.name;Ul&&(el.fillStyle=LiteGraph.NODE_TEXT_COLOR,dl||Bl.dir==LiteGraph.DOWN?el.fillText(Ul,$l[0],$l[1]-8):el.fillText(Ul,$l[0]-10,$l[1]+5))}}if(el.textAlign="left",el.globalAlpha=1,tl.widgets){var zl=ml;(dl||tl.widgets_up)&&(zl=2),tl.widgets_start_y!=null&&(zl=tl.widgets_start_y),this.drawNodeWidgets(tl,zl,el,this.node_widget&&this.node_widget[0]==tl?this.node_widget[1]:null)}}(tl.clip_area||this.clip_all_nodes)&&el.restore(),el.globalAlpha=1}}function drawNodeTooltip(tl,el){var il;if(!el||!tl){(il=LiteGraph.warn)==null||il.call(LiteGraph,"drawNodeTooltip: invalid node or ctx",el,tl);return}ensureRoundRectCompat(tl);var sl=el.properties.tooltip!=null?el.properties.tooltip:"";if((!sl||sl=="")&&LiteGraph.show_node_tooltip_use_descr_property&&el.constructor.desc&&(sl=el.constructor.desc),sl=(sl+"").trim(),!(!sl||sl=="")){var nl=[0,-LiteGraph.NODE_TITLE_HEIGHT],ol=el.flags.collapsed?[LiteGraph.NODE_COLLAPSED_WIDTH,LiteGraph.NODE_TITLE_HEIGHT]:el.size;tl.font="14px Courier New",tl.measureText(sl);var rl=Math.max(el.size[0],160)+20,al=el.ttip_oTMultiRet?el.ttip_oTMultiRet.height+15:21;tl.globalAlpha=.7*this.editor_alpha,tl.shadowColor=el.ttip_oTMultiRet?"black":"transparent",tl.shadowOffsetX=2,tl.shadowOffsetY=2,tl.shadowBlur=3,tl.fillStyle=el.ttip_oTMultiRet?"#454":"transparent",tl.beginPath(),tl.roundRect(nl[0]-rl*.5+ol[0]/2,nl[1]-15-al,rl,al,[3]),tl.moveTo(nl[0]-10+ol[0]/2,nl[1]-15),tl.lineTo(nl[0]+10+ol[0]/2,nl[1]-15),tl.lineTo(nl[0]+ol[0]/2,nl[1]-5),tl.fill(),tl.shadowColor="transparent",tl.textAlign="center",tl.fillStyle=el.ttip_oTMultiRet?"#CEC":"transparent",tl.globalAlpha=this.editor_alpha;var ll=LiteGraph.canvasFillTextMultiline(tl,sl,nl[0]+ol[0]/2,nl[1]-al,rl,14);el.ttip_oTMultiRet=ll,tl.closePath()}}function drawNodeShape(tl,el,il,sl,nl,ol,rl){var al;ensureRoundRectCompat(el),el.strokeStyle=sl,el.fillStyle=nl;var ll=LiteGraph.NODE_TITLE_HEIGHT,cl=this.lowQualityRenderingRequired(.5),ul=tl._shape||tl.constructor.shape||LiteGraph.ROUND_SHAPE,dl=tl.constructor.title_mode,fl=!0;dl==LiteGraph.TRANSPARENT_TITLE||dl==LiteGraph.NO_TITLE?fl=!1:dl==LiteGraph.AUTOHIDE_TITLE&&rl&&(fl=!0);var hl=tmp_area;hl[0]=0,hl[1]=fl?-ll:0,hl[2]=il[0]+1,hl[3]=fl?il[1]+ll:il[1];var _l=el.globalAlpha;if(el.beginPath(),ul==LiteGraph.BOX_SHAPE||cl?el.fillRect(hl[0],hl[1],hl[2],hl[3]):ul==LiteGraph.ROUND_SHAPE||ul==LiteGraph.CARD_SHAPE?el.roundRect(hl[0],hl[1],hl[2],hl[3],ul==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):ul==LiteGraph.CIRCLE_SHAPE&&el.arc(il[0]*.5,il[1]*.5,il[0]*.5,0,Math.PI*2),el.fill(),!tl.flags.collapsed&&fl&&(el.shadowColor="transparent",el.fillStyle="rgba(0,0,0,0.2)",el.fillRect(0,-1,hl[2],2)),el.shadowColor="transparent",(al=tl.onDrawBackground)==null||al.call(tl,el,this,this.canvas,this.graph_mouse),fl||dl==LiteGraph.TRANSPARENT_TITLE){if(tl.onDrawTitleBar)tl.onDrawTitleBar(el,ll,il,this.ds.scale,sl);else if(dl!=LiteGraph.TRANSPARENT_TITLE&&(tl.constructor.title_color||this.render_title_colored)){var yl=tl.constructor.title_color||sl;tl.flags.collapsed&&(el.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients?el.fillStyle=getTitleGradientForContext(el,yl):el.fillStyle=yl,el.beginPath(),ul==LiteGraph.BOX_SHAPE||cl?el.rect(0,-ll,il[0]+1,ll):(ul==LiteGraph.ROUND_SHAPE||ul==LiteGraph.CARD_SHAPE)&&el.roundRect(0,-ll,il[0]+1,ll,tl.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),el.fill(),el.shadowColor="transparent"}let Ml=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[tl.mode]&&(Ml=LiteGraph.NODE_MODES_COLORS[tl.mode]),LiteGraph.node_box_coloured_when_on&&(Ml=tl.action_triggered?"#FFF":tl.execute_triggered?"#AAA":Ml);var ml=10;if(tl.onDrawTitleBox?tl.onDrawTitleBox(el,ll,il,this.ds.scale):ul==LiteGraph.ROUND_SHAPE||ul==LiteGraph.CIRCLE_SHAPE||ul==LiteGraph.CARD_SHAPE?(cl&&(el.fillStyle="black",el.beginPath(),el.arc(ll*.5,ll*-.5,ml*.5+1,0,Math.PI*2),el.fill()),el.fillStyle=tl.boxcolor||Ml||LiteGraph.NODE_DEFAULT_BOXCOLOR,cl?el.fillRect(ll*.5-ml*.5,ll*-.5-ml*.5,ml,ml):(el.beginPath(),el.arc(ll*.5,ll*-.5,ml*.5,0,Math.PI*2),el.fill())):(cl&&(el.fillStyle="black",el.fillRect((ll-ml)*.5-1,(ll+ml)*-.5-1,ml+2,ml+2)),el.fillStyle=tl.boxcolor||Ml||LiteGraph.NODE_DEFAULT_BOXCOLOR,el.fillRect((ll-ml)*.5,(ll+ml)*-.5,ml,ml)),el.globalAlpha=_l,tl.onDrawTitleText&&tl.onDrawTitleText(el,ll,il,this.ds.scale,this.title_text_font,ol),!cl){el.font=this.title_text_font;var Tl=String(tl.getTitle());Tl&&(ol?el.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:el.fillStyle=tl.constructor.title_text_color||this.node_title_color,tl.flags.collapsed?(el.textAlign="left",el.fillText(Tl.substring(0,20),ll,LiteGraph.NODE_TITLE_TEXT_Y-ll),el.textAlign="left"):(el.textAlign="left",el.fillText(Tl,ll,LiteGraph.NODE_TITLE_TEXT_Y-ll)))}if(!tl.flags.collapsed&&tl.subgraph&&!tl.skip_subgraph_button){var bl=LiteGraph.NODE_TITLE_HEIGHT,Gl=tl.size[0]-bl,Il=LiteGraph.isInsideRectangle(this.graph_mouse[0]-tl.pos[0],this.graph_mouse[1]-tl.pos[1],Gl+2,-bl+2,bl-4,bl-4);el.fillStyle=Il?"#888":"#555",ul==LiteGraph.BOX_SHAPE||cl?el.fillRect(Gl+2,-bl+2,bl-4,bl-4):(el.beginPath(),el.roundRect(Gl+2,-bl+2,bl-4,bl-4,[4]),el.fill()),el.fillStyle="#333",el.beginPath(),el.moveTo(Gl+bl*.2,-bl*.6),el.lineTo(Gl+bl*.8,-bl*.6),el.lineTo(Gl+bl*.5,-bl*.3),el.fill()}tl.onDrawTitle&&tl.onDrawTitle(el)}ol&&(tl.onBounding&&tl.onBounding(hl),dl==LiteGraph.TRANSPARENT_TITLE&&(hl[1]-=ll,hl[3]+=ll),el.lineWidth=1,el.globalAlpha=.8,el.beginPath(),ul==LiteGraph.BOX_SHAPE?el.rect(-6+hl[0],-6+hl[1],12+hl[2],12+hl[3]):ul==LiteGraph.ROUND_SHAPE||ul==LiteGraph.CARD_SHAPE&&tl.flags.collapsed?el.roundRect(-6+hl[0],-6+hl[1],12+hl[2],12+hl[3],[this.round_radius*2]):ul==LiteGraph.CARD_SHAPE?el.roundRect(-6+hl[0],-6+hl[1],12+hl[2],12+hl[3],[this.round_radius*2,2,this.round_radius*2,2]):ul==LiteGraph.CIRCLE_SHAPE&&el.arc(il[0]*.5,il[1]*.5,il[0]*.5+6,0,Math.PI*2),el.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,el.stroke(),el.strokeStyle=sl,el.globalAlpha=1),tl.execute_triggered>0&&tl.execute_triggered--,tl.action_triggered>0&&tl.action_triggered--}function drawExecutionOrder(tl){tl.shadowColor="transparent",tl.globalAlpha=.25,tl.textAlign="center",tl.strokeStyle="white",tl.globalAlpha=.75;var el=this.visible_nodes;for(let sl=0;sl<el.length;++sl){var il=el[sl];tl.fillStyle="black",tl.fillRect(il.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,il.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),il.order==0&&tl.strokeRect(il.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,il.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),tl.fillStyle="#FFF",tl.fillText(il.order,il.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,il.pos[1]-6)}tl.globalAlpha=1}function drawNodeWidgets(tl,el,il,sl){if(!tl.widgets||!tl.widgets.length)return 0;ensureRoundRectCompat(il);var nl=tl.size[0],ol=tl.widgets;el+=2;var rl=LiteGraph.NODE_WIDGET_HEIGHT,al=!this.lowQualityRenderingRequired(.5);il.save(),il.globalAlpha=this.editor_alpha;var ll=LiteGraph.WIDGET_OUTLINE_COLOR,cl=LiteGraph.WIDGET_BGCOLOR,ul=LiteGraph.WIDGET_TEXT_COLOR,dl=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,fl=15;for(let Ml=0;Ml<ol.length;++Ml){var hl=ol[Ml],_l=el;hl.y&&(_l=hl.y),hl.last_y=_l,il.strokeStyle=ll,il.fillStyle="#222",il.textAlign="left",hl.disabled&&(il.globalAlpha*=.5);var yl=hl.width||nl;switch(hl.type){case"button":hl.clicked&&(il.fillStyle="#AAA",hl.clicked=!1,this.dirty_canvas=!0),il.fillRect(fl,_l,yl-fl*2,rl),al&&!hl.disabled&&il.strokeRect(fl,_l,yl-fl*2,rl),al&&(il.textAlign="center",il.fillStyle=ul,il.fillText(hl.label||hl.name,yl*.5,_l+rl*.7));break;case"toggle":if(il.textAlign="left",il.strokeStyle=ll,il.fillStyle=cl,il.beginPath(),al?il.roundRect(fl,_l,yl-fl*2,rl,[rl*.5]):il.rect(fl,_l,yl-fl*2,rl),il.fill(),al&&!hl.disabled&&il.stroke(),il.fillStyle=hl.value?"#89A":"#333",il.beginPath(),il.arc(yl-fl*2,_l+rl*.5,rl*.36,0,Math.PI*2),il.fill(),al){il.fillStyle=dl;const zl=hl.label||hl.name;zl!=null&&il.fillText(zl,fl*2,_l+rl*.7),il.fillStyle=hl.value?ul:dl,il.textAlign="right",il.fillText(hl.value?hl.options.on||"true":hl.options.off||"false",yl-40,_l+rl*.7)}break;case"slider":il.fillStyle=cl,il.fillRect(fl,_l,yl-fl*2,rl);var ml=hl.options.max-hl.options.min,Tl=(hl.value-hl.options.min)/ml;if(Tl<0&&(Tl=0),Tl>1&&(Tl=1),il.fillStyle=hl.options.hasOwnProperty("slider_color")?hl.options.slider_color:sl==hl?"#89A":"#678",il.fillRect(fl,_l,Tl*(yl-fl*2),rl),al&&!hl.disabled&&il.strokeRect(fl,_l,yl-fl*2,rl),hl.marker){var bl=(hl.marker-hl.options.min)/ml;bl<0&&(bl=0),bl>1&&(bl=1),il.fillStyle=hl.options.hasOwnProperty("marker_color")?hl.options.marker_color:"#AA9",il.fillRect(fl+bl*(yl-fl*2),_l,2,rl)}al&&(il.textAlign="center",il.fillStyle=ul,il.fillText(hl.label||hl.name+"  "+Number(hl.value).toFixed(hl.options.precision!=null?hl.options.precision:3),yl*.5,_l+rl*.7));break;case"number":case"combo":if(il.textAlign="left",il.strokeStyle=ll,il.fillStyle=cl,il.beginPath(),al?il.roundRect(fl,_l,yl-fl*2,rl,[rl*.5]):il.rect(fl,_l,yl-fl*2,rl),il.fill(),al)if(hl.disabled||il.stroke(),il.fillStyle=ul,hl.disabled||(il.beginPath(),il.moveTo(fl+16,_l+5),il.lineTo(fl+6,_l+rl*.5),il.lineTo(fl+16,_l+rl-5),il.fill(),il.beginPath(),il.moveTo(yl-fl-16,_l+5),il.lineTo(yl-fl-6,_l+rl*.5),il.lineTo(yl-fl-16,_l+rl-5),il.fill()),il.fillStyle=dl,il.fillText(hl.label||hl.name,fl*2+5,_l+rl*.7),il.fillStyle=ul,il.textAlign="right",hl.type=="number")il.fillText(Number(hl.value).toFixed(hl.options.precision!==void 0?hl.options.precision:3),yl-fl*2-20,_l+rl*.7);else{var Gl=hl.value;if(hl.options.values){var Il=hl.options.values;Il.constructor===Function&&(Il=Il()),Il&&Il.constructor!==Array&&(Gl=Il[hl.value])}il.fillText(Gl,yl-fl*2-20,_l+rl*.7)}break;case"string":case"text":if(il.textAlign="left",il.strokeStyle=ll,il.fillStyle=cl,il.beginPath(),al?il.roundRect(fl,_l,yl-fl*2,rl,[rl*.5]):il.rect(fl,_l,yl-fl*2,rl),il.fill(),al){hl.disabled||il.stroke(),il.save(),il.beginPath(),il.rect(fl,_l,yl-fl*2,rl),il.clip(),il.fillStyle=dl;const zl=hl.label||hl.name;zl!=null&&il.fillText(zl,fl*2,_l+rl*.7),il.fillStyle=ul,il.textAlign="right",il.fillText(String(hl.value).substr(0,30),yl-fl*2,_l+rl*.7),il.restore()}break;default:hl.draw&&hl.draw(il,tl,yl,_l,rl);break}el+=(hl.computeSize?hl.computeSize(yl)[1]:rl)+4,il.globalAlpha=this.editor_alpha}il.restore(),il.textAlign="left"}function processNodeWidgets(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow();for(let i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type==="pointerdown"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var nvalue=LiteGraph.clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value,old_value)},20),this.dirty_canvas=!0;break;case"number":case"combo":case"enum":if(event.type=="pointermove"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type=="pointerdown"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));let tl=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=tl*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(tl){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+tl:index=values_list.indexOf(w.value)+tl,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let el=function(il){return values!=values_list&&(il=text_values.indexOf(il)),this.value=il,inner_value_change(this,il,old_value),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:el.bind(w)},ref_window)}}else if(event.type=="pointerup"&&w.type=="number"){let delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,function(v){var Lh;if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(tl){(Lh=LiteGraph.warn)==null||Lh.call(LiteGraph,tl)}this.value=Number(v),inner_value_change(this,this.value,old_value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value,old_value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type=="pointerdown"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type=="pointerdown"&&this.prompt("Value",w.value,function(tl){inner_value_change(this,tl)}.bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return w}}}function inner_value_change(tl,el,il){var sl;(sl=LiteGraph.debug)==null||sl.call(LiteGraph,"inner_value_change for processNodeWidgets",tl,el),il!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,il,w),node.graph.onGraphChanged({action:"widgetChanged",doSave:!0})),tl.type=="number"&&(el=Number(el)),tl.value=el,tl.options&&tl.options.property&&node.properties[tl.options.property]!==void 0&&node.setProperty(tl.options.property,el),tl.callback&&tl.callback(tl.value,that,node,pos,event)}return null}function adjustNodesSize(){var tl=this.graph._nodes;for(let el=0;el<tl.length;++el)tl[el].size=tl[el].computeSize();this.setDirty(!0,!0)}function drawLinkTooltip(tl,el){var il,sl=el._pos;if(tl.fillStyle="black",tl.beginPath(),tl.arc(sl[0],sl[1],3,0,Math.PI*2),tl.fill(),el.data!=null&&!((il=this.onDrawLinkTooltip)!=null&&il.call(this,tl,el,this))){var nl=el.data,ol=null;if(nl.constructor===Number?ol=nl.toFixed(2):nl.constructor===String?ol='"'+nl+'"':nl.constructor===Boolean?ol=String(nl):nl.toToolTip?ol=nl.toToolTip():ol="["+nl.constructor.name+"]",ol!=null){ol=ol.substr(0,30),tl.font="14px Courier New";var rl=tl.measureText(ol),al=rl.width+20,ll=24;tl.shadowColor="black",tl.shadowOffsetX=2,tl.shadowOffsetY=2,tl.shadowBlur=3,tl.fillStyle="#454",tl.beginPath(),tl.roundRect(sl[0]-al*.5,sl[1]-15-ll,al,ll,[3]),tl.moveTo(sl[0]-10,sl[1]-15),tl.lineTo(sl[0]+10,sl[1]-15),tl.lineTo(sl[0],sl[1]-5),tl.fill(),tl.shadowColor="transparent",tl.textAlign="center",tl.fillStyle="#CEC",tl.fillText(ol,sl[0],sl[1]-15-ll*.3)}}}function drawConnections(tl){var el=LiteGraph.getTime(),il=this.visible_area;margin_area[0]=il[0]-20,margin_area[1]=il[1]-20,margin_area[2]=il[2]+40,margin_area[3]=il[3]+40,tl.lineWidth=this.connections_width,tl.fillStyle="#AAA",tl.strokeStyle="#AAA",tl.globalAlpha=this.editor_alpha;for(var sl=this.graph._nodes,nl=0,ol=sl.length;nl<ol;++nl){var rl=sl[nl];if(!(!rl.inputs||!rl.inputs.length))for(let Il=0;Il<rl.inputs.length;++Il){var al=rl.inputs[Il];if(!(!al||al.link==null)){var ll=al.link,cl=this.graph.links[ll];if(cl){var ul=this.graph.getNodeById(cl.origin_id);if(ul!=null){var dl=cl.origin_slot,fl=null;dl==-1?fl=[ul.pos[0]+10,ul.pos[1]+10]:fl=ul.getConnectionPos(!1,dl,tempA);var hl=rl.getConnectionPos(!0,Il,tempB);if(link_bounding[0]=fl[0],link_bounding[1]=fl[1],link_bounding[2]=hl[0]-fl[0],link_bounding[3]=hl[1]-fl[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!LiteGraph.overlapBounding(link_bounding,margin_area)){var _l=ul.outputs[dl],yl=rl.inputs[Il];if(!(!_l||!yl)){var ml=_l.dir||(ul.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),Tl=yl.dir||(rl.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(tl,fl,hl,cl,!1,0,null,ml,Tl),cl&&cl._last_time&&el-cl._last_time<1e3){var bl=2-(el-cl._last_time)*.002,Gl=tl.globalAlpha;tl.globalAlpha=Gl*bl,this.renderLink(tl,fl,hl,cl,!0,bl,"white",ml,Tl),tl.globalAlpha=Gl}}}}}}}}tl.globalAlpha=1}function renderLink(tl,el,il,sl,nl,ol,rl,al,ll,cl){sl&&this.visible_links.push(sl),!rl&&sl&&(rl=sl.color||LGraphCanvas.link_type_colors[sl.type]),rl||(rl=this.default_link_color),sl!=null&&this.highlighted_links[sl.id]&&(rl="#FFF"),al=al||LiteGraph.RIGHT,ll=ll||LiteGraph.LEFT;var ul=LiteGraph.distance(el,il);this.render_connections_border&&this.ds.scale>.6&&(tl.lineWidth=this.connections_width+4),tl.lineJoin="round",cl=cl||1,cl>1&&(tl.lineWidth=.5),tl.beginPath();for(let Wl=0;Wl<cl;Wl+=1){var dl=(Wl-(cl-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){tl.moveTo(el[0],el[1]+dl);let Hl=0,$l=0,Ul=0,jl=0;switch(al){case LiteGraph.LEFT:Hl=ul*-.25;break;case LiteGraph.RIGHT:Hl=ul*.25;break;case LiteGraph.UP:$l=ul*-.25;break;case LiteGraph.DOWN:$l=ul*.25;break}switch(ll){case LiteGraph.LEFT:Ul=ul*-.25;break;case LiteGraph.RIGHT:Ul=ul*.25;break;case LiteGraph.UP:jl=ul*-.25;break;case LiteGraph.DOWN:jl=ul*.25;break}tl.bezierCurveTo(el[0]+Hl,el[1]+$l+dl,il[0]+Ul,il[1]+jl+dl,il[0],il[1]+dl)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){tl.moveTo(el[0],el[1]+dl);let Hl=0,$l=0,Ul=0,jl=0;switch(al){case LiteGraph.LEFT:Hl=-1;break;case LiteGraph.RIGHT:Hl=1;break;case LiteGraph.UP:$l=-1;break;case LiteGraph.DOWN:$l=1;break}switch(ll){case LiteGraph.LEFT:Ul=-1;break;case LiteGraph.RIGHT:Ul=1;break;case LiteGraph.UP:jl=-1;break;case LiteGraph.DOWN:jl=1;break}var fl=15;tl.lineTo(el[0]+Hl*fl,el[1]+$l*fl+dl),tl.lineTo(il[0]+Ul*fl,il[1]+jl*fl+dl),tl.lineTo(il[0],il[1]+dl)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){tl.moveTo(el[0],el[1]);var hl=el[0],_l=el[1],yl=il[0],ml=il[1];al==LiteGraph.RIGHT?hl+=10:_l+=10,ll==LiteGraph.LEFT?yl-=10:ml-=10,tl.lineTo(hl,_l),tl.lineTo((hl+yl)*.5,_l),tl.lineTo((hl+yl)*.5,ml),tl.lineTo(yl,ml),tl.lineTo(il[0],il[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!nl&&(tl.strokeStyle="rgba(0,0,0,0.5)",tl.stroke()),tl.lineWidth=this.connections_width,tl.fillStyle=tl.strokeStyle=rl,tl.stroke();var Tl=this.computeConnectionPoint(el,il,.5,al,ll);if(sl&&sl._pos&&(sl._pos[0]=Tl[0],sl._pos[1]=Tl[1]),this.ds.scale>=.6&&this.highquality_render&&ll!=LiteGraph.CENTER){if(this.render_connection_arrows){var bl=this.computeConnectionPoint(el,il,.25,al,ll),Gl=this.computeConnectionPoint(el,il,.26,al,ll),Il=this.computeConnectionPoint(el,il,.75,al,ll),Ml=this.computeConnectionPoint(el,il,.76,al,ll),zl=0,Fl=0;this.render_curved_connections?(zl=-Math.atan2(Gl[0]-bl[0],Gl[1]-bl[1]),Fl=-Math.atan2(Ml[0]-Il[0],Ml[1]-Il[1])):Fl=zl=il[1]>el[1]?0:Math.PI,tl.save(),tl.translate(bl[0],bl[1]),tl.rotate(zl),tl.beginPath(),tl.moveTo(-5,-3),tl.lineTo(0,7),tl.lineTo(5,-3),tl.fill(),tl.restore(),tl.save(),tl.translate(Il[0],Il[1]),tl.rotate(Fl),tl.beginPath(),tl.moveTo(-5,-3),tl.lineTo(0,7),tl.lineTo(5,-3),tl.fill(),tl.restore()}tl.beginPath(),tl.arc(Tl[0],Tl[1],5,0,Math.PI*2),tl.fill()}if(ol){tl.fillStyle=rl;for(let Wl=0;Wl<5;++Wl){var Bl=(LiteGraph.getTime()*.001+Wl*.2)%1;Tl=this.computeConnectionPoint(el,il,Bl,al,ll),tl.beginPath(),tl.arc(Tl[0],Tl[1],5,0,2*Math.PI),tl.fill()}}}function computeConnectionPoint(tl,el,il,sl,nl){sl=sl||LiteGraph.RIGHT,nl=nl||LiteGraph.LEFT;var ol=LiteGraph.distance(tl,el),rl=tl,al=[tl[0],tl[1]],ll=[el[0],el[1]],cl=el;switch(sl){case LiteGraph.LEFT:al[0]+=ol*-.25;break;case LiteGraph.RIGHT:al[0]+=ol*.25;break;case LiteGraph.UP:al[1]+=ol*-.25;break;case LiteGraph.DOWN:al[1]+=ol*.25;break}switch(nl){case LiteGraph.LEFT:ll[0]+=ol*-.25;break;case LiteGraph.RIGHT:ll[0]+=ol*.25;break;case LiteGraph.UP:ll[1]+=ol*-.25;break;case LiteGraph.DOWN:ll[1]+=ol*.25;break}var ul=(1-il)*(1-il)*(1-il),dl=3*((1-il)*(1-il))*il,fl=3*(1-il)*(il*il),hl=il*il*il,_l=ul*rl[0]+dl*al[0]+fl*ll[0]+hl*cl[0],yl=ul*rl[1]+dl*al[1]+fl*ll[1]+hl*cl[1];return[_l,yl]}function drawSubgraphPanel(tl){var el,il=this.graph;if(il){var sl=il._subgraph_node;if(!sl){(el=LiteGraph.warn)==null||el.call(LiteGraph,"subgraph without subnode");return}this.drawSubgraphPanelLeft(il,sl,tl),this.drawSubgraphPanelRight(il,sl,tl)}}function drawSubgraphPanelLeft(tl,el,il){var sl,nl=el.inputs?el.inputs.length:0,ol=200,rl=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(il.fillStyle="#111",il.globalAlpha=.8,il.beginPath(),il.roundRect(10,10,ol,(nl+1)*rl+50,[8]),il.fill(),il.globalAlpha=1,il.fillStyle="#888",il.font="14px Arial",il.textAlign="left",il.fillText("Graph Inputs",20,34),this.drawButton(ol-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var al=50;if(il.font="14px Arial",el.inputs)for(var ll=0;ll<el.inputs.length;++ll){var cl=el.inputs[ll];if(!cl.not_subgraph_input){if(this.drawButton(20,al+2,ol-20,rl-2)){var ul=el.constructor.input_node_type||"graph/input";this.graph.beforeChange();var dl=LiteGraph.createNode(ul);dl?(tl.add(dl,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([dl]),this.node_dragged=dl,this.dragging_canvas=!1,dl.setProperty("name",cl.name),dl.setProperty("type",cl.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(sl=LiteGraph.error)==null||sl.call(LiteGraph,"graph input node not found:",ul)}il.fillStyle="#9C9",il.beginPath(),il.arc(ol-16,al+rl*.5,5,0,2*Math.PI),il.fill(),il.fillStyle="#AAA",il.fillText(cl.name,30,al+rl*.75),il.fillStyle="#777",il.fillText(cl.type,130,al+rl*.75),al+=rl}}this.drawButton(20,al+2,ol-20,rl-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(el)}function drawSubgraphPanelRight(tl,el,il){var sl,nl,ol=el.outputs?el.outputs.length:0,rl=(((sl=this.backSurface)==null?void 0:sl.canvas)||this.bgcanvas).width,al=200,ll=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);il.fillStyle="#111",il.globalAlpha=.8,il.beginPath(),il.roundRect(rl-al-10,10,al,(ol+1)*ll+50,[8]),il.fill(),il.globalAlpha=1,il.fillStyle="#888",il.font="14px Arial",il.textAlign="left";const cl="Graph Outputs";var ul=il.measureText(cl).width;if(il.fillText(cl,rl-ul-20,34),this.drawButton(rl-al,20,20,20,"X","#151515")){this.closeSubgraph();return}var dl=50;if(il.font="14px Arial",el.outputs)for(var fl=0;fl<el.outputs.length;++fl){var hl=el.outputs[fl];if(!hl.not_subgraph_input){if(this.drawButton(rl-al,dl+2,al-20,ll-2)){var _l=el.constructor.output_node_type||"graph/output";this.graph.beforeChange();var yl=LiteGraph.createNode(_l);yl?(tl.add(yl,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([yl]),this.node_dragged=yl,this.dragging_canvas=!1,yl.setProperty("name",hl.name),yl.setProperty("type",hl.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(nl=LiteGraph.error)==null||nl.call(LiteGraph,"graph input node not found:",_l)}il.fillStyle="#9C9",il.beginPath(),il.arc(rl-al+16,dl+ll*.5,5,0,2*Math.PI),il.fill(),il.fillStyle="#AAA",il.fillText(hl.name,rl-al+30,dl+ll*.75),il.fillStyle="#777",il.fillText(hl.type,rl-al+130,dl+ll*.75),dl+=ll}}this.drawButton(rl-al,dl+2,al-20,ll-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(el)}function drawButton(tl,el,il,sl,nl,ol,rl,al){var ll=this.ctx;ol=ol||LiteGraph.NODE_DEFAULT_COLOR,rl=rl||"#555",al=al||LiteGraph.NODE_TEXT_COLOR;var cl=this.ds.convertOffsetToCanvas(this.graph_mouse),ul=LiteGraph.isInsideRectangle(cl[0],cl[1],tl,el,il,sl);if(cl=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,cl){var dl=this.canvas.getBoundingClientRect();cl[0]-=dl.left,cl[1]-=dl.top}var fl=cl&&LiteGraph.isInsideRectangle(cl[0],cl[1],tl,el,il,sl);ll.fillStyle=ul?rl:ol,fl&&(ll.fillStyle="#AAA"),ll.beginPath(),ll.roundRect(tl,el,il,sl,[4]),ll.fill(),nl!=null&&nl.constructor==String&&(ll.fillStyle=al,ll.textAlign="center",ll.font=(sl*.65|0)+"px Arial",ll.fillText(nl,tl+il*.5,el+sl*.75),ll.textAlign="left");var hl=fl&&!this.block_click;return fl&&this.blockClick(),hl}function isAreaClicked(tl,el,il,sl,nl){var ol=this.last_click_position,rl=ol&&LiteGraph.isInsideRectangle(ol[0],ol[1],tl,el,il,sl),al=rl&&!this.block_click;return rl&&nl&&this.blockClick(),al}function renderInfo(tl,el,il){el=el||10,il=il||this.canvas.height-80,tl.save(),tl.translate(el,il),tl.font="10px Arial",tl.fillStyle="#888",tl.textAlign="left",this.graph?(tl.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),tl.fillText("I: "+this.graph.iteration,5,26),tl.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),tl.fillText("V: "+this.graph._version,5,52),tl.fillText("FPS:"+this.fps.toFixed(2),5,65)):tl.fillText("No graph selected",5,13),tl.restore()}function drawBackCanvas(){var tl,el,il,sl,nl,ol,rl,al,ll,cl,ul,dl,fl,hl,_l,yl=((tl=this.backSurface)==null?void 0:tl.canvas)||this.bgcanvas;this.bgctx||(this.bgctx=(rl=(ol=(il=(el=this.rendererAdapter)==null?void 0:el.getBackCtx)==null?void 0:il.call(el))!=null?ol:(nl=(sl=this.backSurface)==null?void 0:sl.getContextCompat)==null?void 0:nl.call(sl))!=null?rl:null);var ml=this.bgctx;if(ml){(ll=(al=this.rendererAdapter)==null?void 0:al.beginFrame)==null||ll.call(al,"back"),(cl=ml.start)==null||cl.call(ml);var Tl=this.viewport||[0,0,ml.canvas.width,ml.canvas.height];if(this.clear_background&&ml.clearRect(Tl[0],Tl[1],Tl[2],Tl[3]),this._graph_stack&&this._graph_stack.length){ml.save();var bl=this.graph._subgraph_node;ml.strokeStyle=bl.bgcolor,ml.lineWidth=10,ml.strokeRect(1,1,yl.width-2,yl.height-2),ml.lineWidth=1,ml.font="40px Arial",ml.textAlign="center",ml.fillStyle=bl.bgcolor||"#AAA";let zl="";this._graph_stack.slice(1).forEach((Fl,Bl)=>{zl+=`${Fl._subgraph_node.getTitle()} ${Bl<this._graph_stack.length-2?">> ":""}`}),ml.fillText(zl+bl.getTitle(),yl.width*.5,40),ml.restore()}var Gl=!1;if(this.onRenderBackground&&(Gl=this.onRenderBackground(yl,ml)),this.viewport||(ml.restore(),ml.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(ml.save(),this.ds.toCanvasContext(ml),this.ds.scale<1.5&&!Gl&&this.clear_background_color&&(ml.fillStyle=this.clear_background_color,ml.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!Gl){if(this.zoom_modify_alpha?ml.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:ml.globalAlpha=this.editor_alpha,ml.imageSmoothingEnabled=ml.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var Il=this;this._bg_img.onload=function(){Il.draw(!0,!0)}}var Ml=null;this._pattern==null&&this._bg_img.width>0?(Ml=ml.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=Ml):Ml=this._pattern,Ml&&(ml.fillStyle=Ml,ml.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),ml.fillStyle="transparent"),ml.globalAlpha=1,ml.imageSmoothingEnabled=ml.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(yl,ml),(ul=this.onDrawBackground)==null||ul.call(this,ml,this.visible_area),this.onBackgroundRender&&((dl=LiteGraph.error)==null||dl.call(LiteGraph,"WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(ml.strokeStyle="#235",ml.strokeRect(0,0,yl.width,yl.height)),this.render_connections_shadows?(ml.shadowColor="#000",ml.shadowOffsetX=0,ml.shadowOffsetY=0,ml.shadowBlur=6):ml.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(ml),ml.shadowColor="rgba(0,0,0,0)",ml.restore()}(fl=ml.finish)==null||fl.call(ml),(_l=(hl=this.rendererAdapter)==null?void 0:hl.endFrame)==null||_l.call(hl,"back"),this.dirty_bgcanvas=!1,this.dirty_canvas=!0}}function drawGroups(tl,el){if(this.graph){var il=this.graph._groups;el.save(),el.globalAlpha=.5*this.editor_alpha;for(let al=0;al<il.length;++al){var sl=il[al];if(LiteGraph.overlapBounding(this.visible_area,sl._bounding)){el.fillStyle=sl.color||"#335",el.strokeStyle=sl.color||"#335";var nl=sl._pos,ol=sl._size;el.globalAlpha=.25*this.editor_alpha,el.beginPath(),el.rect(nl[0]+.5,nl[1]+.5,ol[0],ol[1]),el.fill(),el.globalAlpha=this.editor_alpha,el.stroke(),el.beginPath(),el.moveTo(nl[0]+ol[0],nl[1]+ol[1]),el.lineTo(nl[0]+ol[0]-10,nl[1]+ol[1]),el.lineTo(nl[0]+ol[0],nl[1]+ol[1]-10),el.fill();var rl=sl.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;el.font=rl+"px Arial",el.textAlign="left",el.fillText(sl.title,nl[0]+4,nl[1]+rl)}}el.restore()}}class RenderController{constructor(el){this.host=el}draw(...el){return draw.apply(this.host,el)}drawFrontCanvas(...el){return drawFrontCanvas.apply(this.host,el)}lowQualityRenderingRequired(...el){return lowQualityRenderingRequired.apply(this.host,el)}drawNode(...el){return drawNode.apply(this.host,el)}drawNodeTooltip(...el){return drawNodeTooltip.apply(this.host,el)}drawNodeShape(...el){return drawNodeShape.apply(this.host,el)}drawExecutionOrder(...el){return drawExecutionOrder.apply(this.host,el)}drawNodeWidgets(...el){return drawNodeWidgets.apply(this.host,el)}processNodeWidgets(...el){return processNodeWidgets.apply(this.host,el)}adjustNodesSize(...el){return adjustNodesSize.apply(this.host,el)}drawConnections(...el){return drawConnections.apply(this.host,el)}renderLink(...el){return renderLink.apply(this.host,el)}computeConnectionPoint(...el){return computeConnectionPoint.apply(this.host,el)}drawLinkTooltip(...el){return drawLinkTooltip.apply(this.host,el)}drawBackCanvas(...el){return drawBackCanvas.apply(this.host,el)}drawSubgraphPanel(...el){return drawSubgraphPanel.apply(this.host,el)}drawSubgraphPanelLeft(...el){return drawSubgraphPanelLeft.apply(this.host,el)}drawSubgraphPanelRight(...el){return drawSubgraphPanelRight.apply(this.host,el)}drawButton(...el){return drawButton.apply(this.host,el)}isAreaClicked(...el){return isAreaClicked.apply(this.host,el)}renderInfo(...el){return renderInfo.apply(this.host,el)}drawGroups(...el){return drawGroups.apply(this.host,el)}}function copyToClipboard(){var tl,el={nodes:[],links:[]},il=0,sl=[];for(let cl in this.selected_nodes){let ul=this.selected_nodes[cl];ul.clonable!==!1&&(ul._relative_id=il,sl.push(ul),il+=1)}for(let cl=0;cl<sl.length;++cl){let ul=sl[cl];if(ul.clonable!==!1){var nl=ul.clone();if(!nl){(tl=LiteGraph.warn)==null||tl.call(LiteGraph,"node type not found: "+ul.type);continue}if(el.nodes.push(nl.serialize()),ul.inputs&&ul.inputs.length)for(var ol=0;ol<ul.inputs.length;++ol){var rl=ul.inputs[ol];if(!(!rl||rl.link==null)){var al=this.graph.links[rl.link];if(al){var ll=this.graph.getNodeById(al.origin_id);ll&&el.links.push([ll._relative_id,al.origin_slot,ul._relative_id,al.target_slot,ll.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(el))}function pasteFromClipboard(tl=!1){var el;if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&tl)){var il=localStorage.getItem("litegrapheditor_clipboard");if(il){this.graph.beforeChange();var sl=JSON.parse(il),nl=!1,ol=!1;for(let _l=0;_l<sl.nodes.length;++_l)nl?(nl[0]>sl.nodes[_l].pos[0]&&(nl[0]=sl.nodes[_l].pos[0],ol[0]=_l),nl[1]>sl.nodes[_l].pos[1]&&(nl[1]=sl.nodes[_l].pos[1],ol[1]=_l)):(nl=[sl.nodes[_l].pos[0],sl.nodes[_l].pos[1]],ol=[_l,_l]);var rl=[];for(let _l=0;_l<sl.nodes.length;++_l){var al=sl.nodes[_l],ll=LiteGraph.createNode(al.type);ll&&(ll.configure(al),ll.pos[0]+=this.graph_mouse[0]-nl[0],ll.pos[1]+=this.graph_mouse[1]-nl[1],this.graph.add(ll,{doProcessChange:!1}),rl.push(ll))}for(let _l=0;_l<sl.links.length;++_l){var cl=sl.links[_l],ul=void 0,dl=cl[0];if(dl!=null)ul=rl[dl];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&tl){var fl=cl[4];fl&&(ul=this.graph.getNodeById(fl))}var hl=rl[cl[2]];ul&&hl?ul.connect(cl[1],hl,cl[3]):(el=LiteGraph.warn)==null||el.call(LiteGraph,"Warning, nodes missing on pasting")}this.selectNodes(rl),this.graph.onGraphChanged({action:"paste",doSave:!0}),this.graph.afterChange()}}}function processNodeDblClicked(tl){var el;this.onShowNodePanel?this.onShowNodePanel(tl):this.showShowNodePanel(tl),(el=this.onNodeDblClicked)==null||el.call(this,tl),this.setDirty(!0)}function processNodeSelected(tl,el){var il;this.selectNode(tl,el&&(el.shiftKey||el.ctrlKey||this.multi_select)),(il=this.onNodeSelected)==null||il.call(this,tl)}function selectNode(tl,el){tl==null?this.deselectAllNodes():this.selectNodes([tl],el)}function selectNodes(tl,el){var il;el||this.deselectAllNodes(),tl=tl||this.graph._nodes,typeof tl=="string"&&(tl=[tl]),Object.values(tl).forEach(sl=>{var nl,ol,rl;if(sl.is_selected){this.deselectNode(sl);return}sl.is_selected=!0,this.selected_nodes[sl.id]=sl,(nl=sl.onSelected)==null||nl.call(sl),(ol=sl.inputs)==null||ol.forEach(al=>{this.highlighted_links[al.link]=!0}),(rl=sl.outputs)==null||rl.forEach(al=>{var ll;(ll=al.links)==null||ll.forEach(cl=>{this.highlighted_links[cl]=!0})})}),(il=this.onSelectionChange)==null||il.call(this,this.selected_nodes),this.setDirty(!0)}function deselectNode(tl){var el,il,sl,nl;tl.is_selected&&((el=tl.onDeselected)==null||el.call(tl),tl.is_selected=!1,(il=this.onNodeDeselected)==null||il.call(this,tl),(sl=tl.inputs)==null||sl.forEach(ol=>{var rl;(rl=this.highlighted_links)==null||delete rl[ol.link]}),(nl=tl.outputs)==null||nl.forEach(ol=>{var rl;(rl=ol.links)==null||rl.forEach(al=>{var ll;return(ll=this.highlighted_links)==null?!0:delete ll[al]})}))}function deselectAllNodes(){var tl,el;this.graph&&((tl=this.graph._nodes)==null||tl.forEach(il=>{var sl,nl;il.is_selected&&((sl=il.onDeselected)==null||sl.call(il),il.is_selected=!1,(nl=this.onNodeDeselected)==null||nl.call(this,il))}),this.selected_nodes={},this.current_node=null,this.highlighted_links={},(el=this.onSelectionChange)==null||el.call(this,this.selected_nodes),this.setDirty(!0))}function deleteSelectedNodes(){this.graph.beforeChange();for(let ol in this.selected_nodes){var tl=this.selected_nodes[ol];if(!tl.block_delete){if(tl.inputs&&tl.inputs.length&&tl.outputs&&tl.outputs.length&&LiteGraph.isValidConnection(tl.inputs[0].type,tl.outputs[0].type)&&tl.inputs[0].link&&tl.outputs[0].links&&tl.outputs[0].links.length){var el=tl.graph.links[tl.inputs[0].link],il=tl.graph.links[tl.outputs[0].links[0]],sl=tl.getInputNode(0),nl=tl.getOutputNodes(0)[0];sl&&nl&&sl.connect(el.origin_slot,nl,il.target_slot)}this.graph.remove(tl),this.onNodeDeselected&&this.onNodeDeselected(tl)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()}function onNodeSelectionChange(){}function boundaryNodesForSelection(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))}class SelectionController{constructor(el){this.host=el}copyToClipboard(...el){return copyToClipboard.apply(this.host,el)}pasteFromClipboard(...el){return pasteFromClipboard.apply(this.host,el)}processNodeDblClicked(...el){return processNodeDblClicked.apply(this.host,el)}processNodeSelected(...el){return processNodeSelected.apply(this.host,el)}selectNode(...el){return selectNode.apply(this.host,el)}selectNodes(...el){return selectNodes.apply(this.host,el)}deselectNode(...el){return deselectNode.apply(this.host,el)}deselectAllNodes(...el){return deselectAllNodes.apply(this.host,el)}deleteSelectedNodes(...el){return deleteSelectedNodes.apply(this.host,el)}onNodeSelectionChange(...el){return onNodeSelectionChange.apply(this.host,el)}boundaryNodesForSelection(...el){return boundaryNodesForSelection.apply(this.host,el)}}function showLinkMenu(tl,el){var il=this,sl=il.graph.getNodeById(tl.origin_id),nl=il.graph.getNodeById(tl.target_id),ol=!1;sl&&sl.outputs&&sl.outputs[tl.origin_slot]&&(ol=sl.outputs[tl.origin_slot].type);var rl=!1;nl&&nl.outputs&&nl.outputs[tl.target_slot]&&(rl=nl.inputs[tl.target_slot].type);var al=["Add Node",null,"Delete"],ll=new LiteGraph.ContextMenu(al,{event:el,title:tl.data!=null?tl.data.constructor.name:null,callback:cl});function cl(ul,dl,fl){switch(ul){case"Add Node":LGraphCanvas.onMenuAdd(null,null,fl,ll,function(hl){var _l;(_l=LiteGraph.debug)==null||_l.call(LiteGraph,"node autoconnect"),!(!hl.inputs||!hl.inputs.length||!hl.outputs||!hl.outputs.length)&&sl.connectByType(tl.origin_slot,hl,ol)&&(hl.connectByType(tl.target_slot,nl,rl),hl.pos[0]-=hl.size[0]*.5)});break;case"Delete":il.graph.removeLink(tl.id);break}}return!1}function createDefaultNodeForSlot(tl={}){var el,il,sl,nl,ol,rl=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},tl),al=this,ll=rl.nodeFrom&&rl.slotFrom!==null,cl=!ll&&rl.nodeTo&&rl.slotTo!==null;if(!ll&&!cl)return(el=LiteGraph.warn)==null||el.call(LiteGraph,"No data passed to createDefaultNodeForSlot "+rl.nodeFrom+" "+rl.slotFrom+" "+rl.nodeTo+" "+rl.slotTo),!1;if(!rl.nodeType)return(il=LiteGraph.warn)==null||il.call(LiteGraph,"No type to createDefaultNodeForSlot"),!1;var ul=ll?rl.nodeFrom:rl.nodeTo,dl=ll?rl.slotFrom:rl.slotTo,fl=!1;switch(typeof dl){case"string":fl=ll?ul.findOutputSlot(dl,!1):ul.findInputSlot(dl,!1),dl=ll?ul.outputs[dl]:ul.inputs[dl];break;case"object":fl=ll?ul.findOutputSlot(dl.name):ul.findInputSlot(dl.name);break;case"number":fl=dl,dl=ll?ul.outputs[dl]:ul.inputs[dl];break;default:return(sl=LiteGraph.warn)==null||sl.call(LiteGraph,"Cant get slot information "+dl),!1}(dl===!1||fl===!1)&&((nl=LiteGraph.warn)==null||nl.call(LiteGraph,"createDefaultNodeForSlot bad slotX "+dl+" "+fl));var hl=dl.type==LiteGraph.EVENT?"_event_":dl.type,_l=ll?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(_l&&_l[hl]){dl.link;var yl=!1;if(typeof _l[hl]=="object"){for(var ml in _l[hl])if(rl.nodeType==_l[hl][ml]||rl.nodeType=="AUTO"){yl=_l[hl][ml];break}}else(rl.nodeType==_l[hl]||rl.nodeType=="AUTO")&&(yl=_l[hl]);if(yl){var Tl=!1;typeof yl=="object"&&yl.node&&(Tl=yl,yl=yl.node);var bl=LiteGraph.createNode(yl);if(bl){if(Tl){if(Tl.properties)for(const[Gl,Il]of Object.entries(Tl.properties))bl.addProperty(Gl,Il);Tl.inputs&&(bl.inputs=[],Object.values(Tl.inputs).forEach(Gl=>{bl.addOutput(Gl[0],Gl[1])})),Tl.outputs&&(bl.outputs=[],Object.values(Tl.outputs).forEach(Gl=>{bl.addOutput(Gl[0],Gl[1])})),Tl.title&&(bl.title=Tl.title),Tl.json&&bl.configure(Tl.json)}return al.graph.add(bl),bl.pos=[rl.position[0]+rl.posAdd[0]+(rl.posSizeFix[0]?rl.posSizeFix[0]*bl.size[0]:0),rl.position[1]+rl.posAdd[1]+(rl.posSizeFix[1]?rl.posSizeFix[1]*bl.size[1]:0)],ll?rl.nodeFrom.connectByType(fl,bl,hl):rl.nodeTo.connectByTypeOutput(fl,bl,hl),!0}else(ol=LiteGraph.warn)==null||ol.call(LiteGraph,"failed creating "+yl)}}return!1}function showConnectionMenu(tl={}){var el,il,sl=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},tl),nl=this,ol=sl.nodeFrom&&sl.slotFrom,rl=!ol&&sl.nodeTo&&sl.slotTo;if(!ol&&!rl)return(el=LiteGraph.warn)==null||el.call(LiteGraph,"No data passed to showConnectionMenu"),!1;var al=ol?sl.nodeFrom:sl.nodeTo,ll=ol?sl.slotFrom:sl.slotTo,cl=!1;switch(typeof ll){case"string":cl=ol?al.findOutputSlot(ll,!1):al.findInputSlot(ll,!1),ll=ol?al.outputs[ll]:al.inputs[ll];break;case"object":cl=ol?al.findOutputSlot(ll.name):al.findInputSlot(ll.name);break;case"number":cl=ll,ll=ol?al.outputs[ll]:al.inputs[ll];break;default:return(il=LiteGraph.warn)==null||il.call(LiteGraph,"Cant get slot information "+ll),!1}var ul=["Add Node",null];nl.allow_searchbox&&(ul.push("Search"),ul.push(null));const dl=ll.type===LiteGraph.EVENT?"_event_":ll.type,fl=ol?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(fl&&fl[dl]){const _l=fl[dl];Array.isArray(_l)||typeof _l=="object"?Object.values(_l).forEach(yl=>{ul.push(yl)}):ul.push(_l)}var hl=new LiteGraph.ContextMenu(ul,{event:sl.e,title:(ll&&ll.name!=""?ll.name+(dl?" | ":""):"")+(ll&&dl?dl:""),callback:(_l,yl,ml)=>{const Tl={"Add Node":()=>{LGraphCanvas.onMenuAdd(null,null,ml,hl,bl=>{ol?sl.nodeFrom.connectByType(cl,bl,dl):sl.nodeTo.connectByTypeOutput(cl,bl,dl)})},Search:()=>{ol?nl.showSearchBox(ml,{node_from:sl.nodeFrom,slot_from:ll,type_filter_in:dl}):nl.showSearchBox(ml,{node_to:sl.nodeTo,slot_from:ll,type_filter_out:dl})},default:()=>{nl.createDefaultNodeForSlot(Object.assign(sl,{position:[sl.e.canvasX,sl.e.canvasY],nodeType:_l}))}};(Tl[_l]||Tl.default)()}});return!1}function getCanvasMenuOptions(){var tl=null;if(this.getMenuOptions?tl=this.getMenuOptions():(tl=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],LiteGraph.showCanvasOptions&&tl.push({content:"Options",callback:this.showShowGraphOptionsPanel}),Object.keys(this.selected_nodes).length>1&&tl.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&tl.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var el=this.getExtraMenuOptions(this,tl);el&&(tl=tl.concat(el))}return tl}function getNodeMenuOptions(tl){var el=null;if(tl.getMenuOptions?el=tl.getMenuOptions(this):(el=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],tl.resizable!==!1&&el.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),el.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),tl.onGetInputs){var il=tl.onGetInputs();il&&il.length&&(el[0].disabled=!1)}if(tl.onGetOutputs){var sl=tl.onGetOutputs();sl&&sl.length&&(el[1].disabled=!1)}if(LiteGraph.do_add_triggers_slots&&(el[1].disabled=!1),tl.getExtraMenuOptions){var nl=tl.getExtraMenuOptions(this,el);nl&&(nl.push(null),el=nl.concat(el))}return tl.clonable!==!1&&el.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&el.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),el.push(null,{content:"Remove",disabled:!(tl.removable!==!1&&!tl.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),tl.graph&&tl.graph.onGetNodeMenuOptions&&tl.graph.onGetNodeMenuOptions(el,tl),el}function getGroupMenuOptions(){var tl=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return tl}function processContextMenu(tl,el){var il,sl,nl,ol=this,rl=LGraphCanvas.active_canvas,al=rl.getCanvasWindow(),ll=null,cl={event:el,callback:_l,extra:tl};tl&&(cl.title=tl.type);var ul=null;if(tl&&(ul=tl.getSlotInPosition(el.canvasX,el.canvasY),LGraphCanvas.active_node=tl),ul){if(ll=[],tl.getSlotMenuOptions)ll=tl.getSlotMenuOptions(ul);else{((sl=(il=ul==null?void 0:ul.output)==null?void 0:il.links)!=null&&sl.length||(nl=ul.input)!=null&&nl.link)&&ll.push({content:"Disconnect Links",slot:ul});var dl=ul.input||ul.output;dl.removable&&LiteGraph.canRemoveSlots&&ll.push(dl.locked?"Cannot remove":{content:"Remove Slot",slot:ul}),!dl.nameLocked&&LiteGraph.canRenameSlots&&ll.push({content:"Rename Slot",slot:ul})}var fl=ul.input||ul.output;cl.title=fl.type||"*",fl.type==LiteGraph.ACTION?cl.title="Action":fl.type==LiteGraph.EVENT&&(cl.title="Event")}else if(tl)ll=this.getNodeMenuOptions(tl);else{ll=this.getCanvasMenuOptions();var hl=this.graph.getGroupOnPos(el.canvasX,el.canvasY);hl&&ll.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:hl,options:this.getGroupMenuOptions(hl)}})}if(!ll)return;new LiteGraph.ContextMenu(ll,cl,al);function _l(yl,ml){if(!yl)return;let Tl;if(yl.content=="Remove Slot"){Tl=yl.slot,tl.graph.beforeChange(),Tl.input?tl.removeInput(Tl.slot):Tl.output&&tl.removeOutput(Tl.slot),tl.graph.afterChange();return}else if(yl.content=="Disconnect Links"){Tl=yl.slot,tl.graph.beforeChange(),Tl.output?tl.disconnectOutput(Tl.slot):Tl.input&&tl.disconnectInput(Tl.slot),tl.graph.afterChange();return}else if(yl.content=="Rename Slot"){Tl=yl.slot;var bl=Tl.input?tl.getInputInfo(Tl.slot):tl.getOutputInfo(Tl.slot),Gl=ol.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",ml),Il=Gl.querySelector("input");Il&&bl&&(Il.value=bl.label||"");var Ml=function(){tl.graph.beforeChange(),Il.value&&(bl&&(bl.label=Il.value),ol.setDirty(!0)),Gl.close(),tl.graph.afterChange()};Gl.querySelector("button").addEventListener("click",Ml),Il.addEventListener("keydown",function(zl){if(Gl.is_modified=!0,zl.keyCode==27)Gl.close();else if(zl.keyCode==13)Ml();else if(zl.keyCode!=13&&zl.target.localName!="textarea")return;zl.preventDefault(),zl.stopPropagation()}),Il.focus()}}}function prompt(tl="",el,il,sl,nl){var ol,rl=document.createElement("div");rl.is_modified=!1,rl.className="graphdialog rounded",nl?rl.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":rl.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",rl.close=()=>{var bl;this.prompt_box=null,(bl=rl.parentNode)==null||bl.removeChild(rl)};var al=LGraphCanvas.active_canvas,ll=al.canvas;ll.parentNode.appendChild(rl),this.ds.scale>1&&(rl.style.transform=`scale(${this.ds.scale})`);var cl=null,ul=0;rl.addEventListener("pointerleave",bl=>{ul>0||LiteGraph.dialog_close_on_mouse_leave&&!rl.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(cl=setTimeout(rl.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),rl.addEventListener("pointerenter",bl=>{LiteGraph.dialog_close_on_mouse_leave&&cl&&clearTimeout(cl)});const dl=rl.querySelectorAll("select");dl&&(ul=0,dl.forEach(bl=>{bl.addEventListener("pointerdown",Gl=>{ul++}),bl.addEventListener("focus",Gl=>{ul++}),bl.addEventListener("blur",Gl=>{ul=Math.max(0,ul-1)}),bl.addEventListener("change",Gl=>{ul=0})})),(ol=this.prompt_box)==null||ol.close(),this.prompt_box=rl;var fl=rl.querySelector(".name");fl.innerText=tl;var hl=rl.querySelector(".value");hl.value=el;const _l=hl;_l.addEventListener("keydown",bl=>{var Gl;switch(rl.is_modified=!0,bl.key){case"Escape":rl.close();break;case"Enter":bl.target.localName!=="textarea"&&typeof il=="function"&&(il(_l.value),this.setDirty(!0)),(Gl=LiteGraph.debug)==null||Gl.call(LiteGraph,"prompt v2 ENTER",_l.value,bl.target.localName,il),rl.close();break;default:return}bl.preventDefault(),bl.stopPropagation()}),rl.querySelector("button").addEventListener("click",bl=>{var Gl;typeof il=="function"&&(il(_l.value),this.setDirty(!0)),(Gl=LiteGraph.debug)==null||Gl.call(LiteGraph,"prompt v2 OK",_l.value,il),rl.close()});var yl=ll.getBoundingClientRect(),ml=-20,Tl=-20;return yl&&(ml-=yl.left,Tl-=yl.top),sl?(rl.style.left=sl.clientX+ml+"px",rl.style.top=sl.clientY+Tl+"px"):(rl.style.left=ll.width*.5+ml+"px",rl.style.top=ll.height*.5+Tl+"px"),setTimeout(function(){_l.focus()},10),rl}function showSearchBox(tl,el){var il={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled&&(Object.keys(LiteGraph.registered_slot_in_types||{}).length>0||Object.keys(LiteGraph.registered_slot_out_types||{}).length>0),type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};el=Object.assign(il,el||{});var sl=this,nl=LGraphCanvas.active_canvas,ol=nl.canvas,rl=ol.ownerDocument||document,al=document.createElement("div");if(al.className="litegraph litesearchbox graphdialog rounded",al.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",el.do_type_filter&&(al.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",al.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),el.show_close_button&&(al.innerHTML+="<button class='close_searchbox close'>X</button>"),al.innerHTML+="<div class='helper'></div>",rl.fullscreenElement?rl.fullscreenElement.appendChild(al):(rl.body.appendChild(al),rl.body.style.overflow="hidden"),el.do_type_filter)var ll=al.querySelector(".slot_in_type_filter"),cl=al.querySelector(".slot_out_type_filter");if(al.close=function(){sl.search_box=null,this.blur(),ol.focus(),rl.body.style.overflow="",setTimeout(function(){sl.canvas.focus()},20),al.parentNode&&al.parentNode.removeChild(al)},this.ds.scale>1&&(al.style.transform=`scale(${this.ds.scale})`),el.hide_on_mouse_leave){var ul=0,dl=null;if(al.addEventListener("pointerenter",function(Bl){dl&&(clearTimeout(dl),dl=null)}),al.addEventListener("pointerleave",function(Bl){ul>0||(dl=setTimeout(function(){al.close()},500))}),el.do_type_filter){const Bl=function(Wl){Wl&&(Wl.addEventListener("pointerdown",function(Hl){ul++}),Wl.addEventListener("focus",function(Hl){ul++}),Wl.addEventListener("blur",function(Hl){ul=Math.max(0,ul-1)}),Wl.addEventListener("change",function(Hl){ul=0}))};Bl(ll),Bl(cl)}}sl.search_box&&sl.search_box.close(),sl.search_box=al;var fl=al.querySelector(".helper"),hl=null,_l=null,yl=null,ml=al.querySelector("input");if(ml&&(ml.addEventListener("blur",function(Bl){sl.search_box&&this.focus()}),ml.addEventListener("keydown",function(Bl){if(Bl.key==="ArrowUp")zl(!1);else if(Bl.key==="ArrowDown")zl(!0);else if(Bl.key==="Escape")al.close();else if(Bl.key==="Enter")Fl(),yl?Ml(yl.innerHTML):hl?Ml(hl):al.close();else{_l&&clearInterval(_l),_l=setTimeout(Fl,250);return}return Bl.preventDefault(),Bl.stopPropagation(),Bl.stopImmediatePropagation(),!0})),el.do_type_filter){if(ll){let Bl=LiteGraph.slot_types_in,Wl=Bl.length;(el.type_filter_in==LiteGraph.EVENT||el.type_filter_in==LiteGraph.ACTION)&&(el.type_filter_in="_event_");for(let Hl=0;Hl<Wl;Hl++){let $l=document.createElement("option");$l.value=Bl[Hl],$l.innerHTML=Bl[Hl],ll.appendChild($l),el.type_filter_in!==!1&&(el.type_filter_in+"").toLowerCase()==(Bl[Hl]+"").toLowerCase()&&($l.selected=!0)}ll.addEventListener("change",function(){Fl()})}if(cl){let Bl=LiteGraph.slot_types_out,Wl=Bl.length;(el.type_filter_out==LiteGraph.EVENT||el.type_filter_out==LiteGraph.ACTION)&&(el.type_filter_out="_event_");for(let Hl=0;Hl<Wl;Hl++){let $l=document.createElement("option");$l.value=Bl[Hl],$l.innerHTML=Bl[Hl],cl.appendChild($l),el.type_filter_out!==!1&&(el.type_filter_out+"").toLowerCase()==(Bl[Hl]+"").toLowerCase()&&($l.selected=!0)}cl.addEventListener("change",function(){Fl()})}}if(el.show_close_button){var Tl=al.querySelector(".close");Tl.addEventListener("click",al.close)}var bl=ol.getBoundingClientRect(),Gl=(tl?tl.clientX:bl.left+bl.width*.5)-80,Il=(tl?tl.clientY:bl.top+bl.height*.5)-20;bl.width-Gl<470&&(Gl=bl.width-470),bl.height-Il<220&&(Il=bl.height-220),Gl<bl.left+20&&(Gl=bl.left+20),Il<bl.top+20&&(Il=bl.top+20),al.style.left=Gl+"px",al.style.top=Il+"px",ml.focus(),el.show_all_on_open&&Fl();function Ml(Bl){if(Bl)if(sl.onSearchBoxSelection)sl.onSearchBoxSelection(Bl,tl,nl);else{var Wl=LiteGraph.searchbox_extras[Bl.toLowerCase()];Wl&&(Bl=Wl.type),nl.graph.beforeChange();var Hl=LiteGraph.createNode(Bl);if(Hl&&(Hl.pos=nl.convertEventToCanvasOffset(tl),nl.graph.add(Hl,!1,{doProcessChange:!1})),Wl&&Wl.data){if(Wl.data.properties)for(let Ul in Wl.data.properties)Hl.addProperty(Ul,Wl.data.properties[Ul]);if(Wl.data.inputs){Hl.inputs=[];for(let Ul in Wl.data.inputs)Hl.addOutput(Wl.data.inputs[Ul][0],Wl.data.inputs[Ul][1])}if(Wl.data.outputs){Hl.outputs=[];for(let Ul in Wl.data.outputs)Hl.addOutput(Wl.data.outputs[Ul][0],Wl.data.outputs[Ul][1])}Wl.data.title&&(Hl.title=Wl.data.title),Wl.data.json&&Hl.configure(Wl.data.json)}let $l;if(el.node_from){switch($l=!1,typeof el.slot_from){case"string":$l=el.node_from.findOutputSlot(el.slot_from);break;case"object":el.slot_from.name?$l=el.node_from.findOutputSlot(el.slot_from.name):$l=-1,$l==-1&&typeof el.slot_from.slot_index!="undefined"&&($l=el.slot_from.slot_index);break;case"number":$l=el.slot_from;break;default:$l=0}typeof el.node_from.outputs[$l]!="undefined"&&$l!==!1&&$l>-1&&el.node_from.connectByType($l,Hl,el.node_from.outputs[$l].type)}if(el.node_to){switch($l=!1,typeof el.slot_from){case"string":$l=el.node_to.findInputSlot(el.slot_from);break;case"object":el.slot_from.name?$l=el.node_to.findInputSlot(el.slot_from.name):$l=-1,$l==-1&&typeof el.slot_from.slot_index!="undefined"&&($l=el.slot_from.slot_index);break;case"number":$l=el.slot_from;break;default:$l=0}typeof el.node_to.inputs[$l]!="undefined"&&$l!==!1&&$l>-1&&el.node_to.connectByTypeOutput($l,Hl,el.node_to.inputs[$l].type)}nl.graph.afterChange()}al.close()}function zl(Bl){var Wl=yl;yl&&yl.classList.remove("selected"),yl?(yl=Bl?yl.nextSibling:yl.previousSibling,yl||(yl=Wl)):yl=Bl?fl.childNodes[0]:fl.childNodes[fl.childNodes.length],yl&&(yl.classList.add("selected"),yl.scrollIntoView({block:"end",behavior:"smooth"}))}function Fl(){_l=null;var Bl=ml.value;if(hl=null,fl.innerHTML="",!Bl&&!el.show_all_if_empty)return;if(sl.onSearchBox){var Wl=sl.onSearchBox(fl,Bl,nl);if(Wl)for(let ql=0;ql<Wl.length;++ql)Ql(Wl[ql])}else{let ql=function(Zl,ec={}){var oc={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},Xl=Object.assign(oc,ec),tc=LiteGraph.registered_node_types[Zl];if($l&&tc.filter!=$l||(!el.show_all_if_empty||Bl)&&Zl.toLowerCase().indexOf(Bl)===-1)return!1;if(el.do_type_filter&&!Xl.skipFilter){var ic=Zl;let sc;var Ll=Kl.value;if(Xl.inTypeOverride!==!1&&(Ll=Xl.inTypeOverride),Kl&&Ll&&LiteGraph.registered_slot_in_types[Ll]&&LiteGraph.registered_slot_in_types[Ll].nodes&&(sc=LiteGraph.registered_slot_in_types[Ll].nodes.includes(ic),sc===!1)||(Ll=Jl.value,Xl.outTypeOverride!==!1&&(Ll=Xl.outTypeOverride),Jl&&Ll&&LiteGraph.registered_slot_out_types[Ll]&&LiteGraph.registered_slot_out_types[Ll].nodes&&(sc=LiteGraph.registered_slot_out_types[Ll].nodes.includes(ic),sc===!1)))return!1}return!0};var Hl=0;Bl=Bl.toLowerCase();var $l=nl.filter||nl.graph.filter;let Kl,Jl;el.do_type_filter&&sl.search_box?(Kl=sl.search_box.querySelector(".slot_in_type_filter"),Jl=sl.search_box.querySelector(".slot_out_type_filter")):(Kl=!1,Jl=!1);for(let Zl in LiteGraph.searchbox_extras){var Ul=LiteGraph.searchbox_extras[Zl];if(!((!el.show_all_if_empty||Bl)&&Ul.desc.toLowerCase().indexOf(Bl)===-1)){var jl=LiteGraph.registered_node_types[Ul.type];if(!(jl&&jl.filter!=$l)&&ql(Ul.type)&&(Ql(Ul.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&Hl++>LGraphCanvas.search_limit))break}}var Vl=null;if(Array.prototype.filter)Vl=Object.keys(LiteGraph.registered_node_types).filter(ql);else{Vl=[];for(let Zl in LiteGraph.registered_node_types)ql(Zl)&&Vl.push(Zl)}for(let Zl=0;Zl<Vl.length&&(Ql(Vl[Zl]),!(LGraphCanvas.search_limit!==-1&&Hl++>LGraphCanvas.search_limit));Zl++);if(el.show_general_after_typefiltered&&(Kl.value||Jl.value)){var Yl=[];for(let Zl in LiteGraph.registered_node_types)ql(Zl,{inTypeOverride:Kl&&Kl.value?"*":!1,outTypeOverride:Jl&&Jl.value?"*":!1})&&Yl.push(Zl);for(let Zl=0;Zl<Yl.length&&(Ql(Yl[Zl],"generic_type"),!(LGraphCanvas.search_limit!==-1&&Hl++>LGraphCanvas.search_limit));Zl++);}if((Kl.value||Jl.value)&&fl.childNodes.length==0&&el.show_general_if_none_on_typefilter){var Yl=[];for(let ec in LiteGraph.registered_node_types)ql(ec,{skipFilter:!0})&&Yl.push(ec);for(let ec=0;ec<Yl.length&&(Ql(Yl[ec],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&Hl++>LGraphCanvas.search_limit));ec++);}}function Ql(ql,Kl){var Jl=document.createElement("div");hl||(hl=ql),Jl.innerText=ql,Jl.dataset.type=encodeURIComponent(ql),Jl.className="litegraph lite-search-item",Kl&&(Jl.className+=" "+Kl),Jl.addEventListener("click",function(Zl){Ml(decodeURIComponent(this.dataset.type))}),fl.appendChild(Jl)}}return al}function showEditPropertyValue(tl,el,il){var sl,nl,ol,rl,al;if(!tl||tl.properties[el]===void 0)return;il=il||{};var ll=tl.getPropertyInfo(el),cl=ll.type;let ul;if(cl=="string"||cl=="number"||cl=="array"||cl=="object")ul="<input autofocus type='text' class='value'/>";else if((cl=="enum"||cl=="combo")&&ll.values){(sl=LiteGraph.debug)==null||sl.call(LiteGraph,"CREATING showEditPropertyValue ENUM COMBO",hl,cl,fl),ul="<select autofocus type='text' class='value'>";for(let Tl in ll.values){var dl=Tl;ll.values.constructor===Array&&(dl=ll.values[Tl]),ul+="<option value='"+dl+"' "+(dl==tl.properties[el]?"selected":"")+">"+ll.values[Tl]+"</option>"}ul+="</select>"}else if(cl=="boolean"||cl=="toggle")ul="<input autofocus type='checkbox' class='value' "+(tl.properties[el]?"checked":"")+"/>";else{(nl=LiteGraph.warn)==null||nl.call(LiteGraph,"unknown type: "+cl);return}var fl=this.createDialog("<span class='name'>"+(ll.label?ll.label:el)+"</span>"+ul+"<button>OK</button>",il),hl=!1;(cl=="enum"||cl=="combo")&&ll.values?((ol=LiteGraph.debug)==null||ol.call(LiteGraph,"showEditPropertyValue ENUM COMBO",hl,cl,fl),hl=fl.querySelector("select"),hl.addEventListener("change",function(Tl){var bl;fl.modified(),(bl=LiteGraph.debug)==null||bl.call(LiteGraph,"Enum change",hl,ll,Tl.target),ml(Tl.target.value)})):cl=="boolean"||cl=="toggle"?((rl=LiteGraph.debug)==null||rl.call(LiteGraph,"showEditPropertyValue TOGGLE",hl,cl,fl),hl=fl.querySelector("input"),hl&&hl.addEventListener("click",function(Tl){fl.modified(),ml(!!hl.checked)})):(hl=fl.querySelector("input"),(al=LiteGraph.debug)==null||al.call(LiteGraph,"showEditPropertyValue",hl,cl,fl),hl&&(hl.addEventListener("blur",function(Tl){this.focus()}),dl=tl.properties[el]!==void 0?tl.properties[el]:"",cl!=="string"&&(dl=JSON.stringify(dl)),hl.value=dl,hl.addEventListener("keydown",function(Tl){if(Tl.keyCode==27)fl.close();else if(Tl.keyCode==13)yl();else if(Tl.keyCode!=13){fl.modified();return}Tl.preventDefault(),Tl.stopPropagation()}))),hl&&hl.focus();var _l=fl.querySelector("button");_l.addEventListener("click",yl);function yl(){ml(hl.value)}function ml(Tl){var bl;ll&&ll.values&&ll.values.constructor===Object&&ll.values[Tl]!=null&&(Tl=ll.values[Tl]),typeof tl.properties[el]=="number"&&(Tl=Number(Tl)),(cl=="array"||cl=="object")&&(Tl=JSON.parse(Tl)),tl.properties[el]=Tl,(bl=tl.graph)==null||bl.onGraphChanged({action:"propertyChanged",doSave:!0}),tl.onPropertyChanged&&tl.onPropertyChanged(el,Tl),il.onclose&&il.onclose(),fl.close(),tl.setDirtyCanvas(!0,!0)}return fl}function createDialog(tl,el){var il={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};el=Object.assign(il,el||{});var sl=document.createElement("div");sl.className="graphdialog",sl.innerHTML=tl,sl.is_modified=!1;var nl=this.canvas.getBoundingClientRect(),ol=-20,rl=-20;if(nl&&(ol-=nl.left,rl-=nl.top),el.position?(ol+=el.position[0],rl+=el.position[1]):el.event?(ol+=el.event.clientX,rl+=el.event.clientY):(ol+=this.canvas.width*.5,rl+=this.canvas.height*.5),sl.style.left=ol+"px",sl.style.top=rl+"px",this.canvas.parentNode.appendChild(sl),el.checkForInput){var al=[],ll=!1;al=sl.querySelectorAll("input"),al&&al.forEach(function(fl){fl.addEventListener("keydown",function(hl){if(sl.modified(),hl.keyCode==27)sl.close();else if(hl.keyCode!=13)return;hl.preventDefault(),hl.stopPropagation()}),ll||fl.focus()})}sl.modified=function(){sl.is_modified=!0},sl.close=function(){sl.parentNode&&sl.parentNode.removeChild(sl)};var cl=null,ul=0;sl.addEventListener("pointerleave",function(fl){ul>0||(el.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!sl.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(cl=setTimeout(sl.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),sl.addEventListener("pointerenter",function(fl){(el.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&cl&&clearTimeout(cl)});var dl=sl.querySelectorAll("select");return dl&&dl.forEach(function(fl){fl.addEventListener("pointerdown",function(hl){ul++}),fl.addEventListener("focus",function(hl){ul++}),fl.addEventListener("blur",function(hl){ul=Math.max(0,ul-1)}),fl.addEventListener("change",function(hl){ul=0})}),sl}function createPanel(tl,el){el=el||{};var il=el.window||window,sl=document.createElement("div");if(sl.className="litegraph dialog",sl.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",sl.header=sl.querySelector(".dialog-header"),el.width&&(sl.style.width=el.width+(el.width.constructor===Number?"px":"")),el.height&&(sl.style.height=el.height+(el.height.constructor===Number?"px":"")),el.closable){var nl=document.createElement("span");nl.innerHTML="&#10005;",nl.classList.add("close"),nl.addEventListener("click",function(){sl.close()}),sl.header.appendChild(nl)}return sl.title_element=sl.querySelector(".dialog-title"),sl.title_element.innerText=tl,sl.content=sl.querySelector(".dialog-content"),sl.alt_content=sl.querySelector(".dialog-alt-content"),sl.footer=sl.querySelector(".dialog-footer"),sl.close=function(){sl.onClose&&typeof sl.onClose=="function"&&sl.onClose(),sl.parentNode&&sl.parentNode.removeChild(sl)},sl.toggleAltContent=function(ol){let rl,al;typeof ol!="undefined"?(rl=ol?"block":"none",al=ol?"none":"block"):(rl=sl.alt_content.style.display!="block"?"block":"none",al=sl.alt_content.style.display!="block"?"none":"block"),sl.alt_content.style.display=rl,sl.content.style.display=al},sl.toggleFooterVisibility=function(ol){let rl;typeof ol!="undefined"?rl=ol?"block":"none":rl=sl.footer.style.display!="block"?"block":"none",sl.footer.style.display=rl},sl.clear=function(){this.content.innerHTML=""},sl.addHTML=function(ol,rl,al){var ll=document.createElement("div");return rl&&(ll.className=rl),ll.innerHTML=ol,al?sl.footer.appendChild(ll):sl.content.appendChild(ll),ll},sl.addButton=function(ol,rl,al){var ll=document.createElement("button");return ll.innerText=ol,ll.options=al,ll.classList.add("btn"),ll.addEventListener("click",rl),sl.footer.appendChild(ll),ll},sl.addSeparator=function(){var ol=document.createElement("div");ol.className="separator",sl.content.appendChild(ol)},sl.addWidget=function(ol,rl,al,ll,cl){var ul,dl;ll=ll||{};var fl=String(al);ol=ol.toLowerCase(),ol=="number"&&(fl=al.toFixed(3));var hl=document.createElement("div");hl.className="property",hl.innerHTML="<span class='property_name'></span><span class='property_value'></span>",hl.querySelector(".property_name").innerText=ll.label||rl;var _l=hl.querySelector(".property_value");_l.innerText=fl,hl.dataset.property=rl,hl.dataset.type=ll.type||ol,hl.options=ll,hl.value=al,(ul=LiteGraph.debug)==null||ul.call(LiteGraph,"addWidget",ol,al,_l,ll),ol=="code"?hl.addEventListener("click",function(ml){sl.inner_showCodePad(this.dataset.property)}):ol=="boolean"?(hl.classList.add("boolean"),al&&hl.classList.add("bool-on"),hl.addEventListener("click",function(){var ml=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",yl(ml,this.value)})):ol=="string"||ol=="number"?(_l.setAttribute("contenteditable",!0),_l.addEventListener("keydown",function(ml){ml.code=="Enter"&&(ol!="string"||!ml.shiftKey)&&(ml.preventDefault(),this.blur())}),_l.addEventListener("blur",function(){var ml=this.innerText,Tl=this.parentNode.dataset.property,bl=this.parentNode.dataset.type;bl=="number"&&(ml=Number(ml)),yl(Tl,ml)})):(ol=="enum"||ol=="combo")&&(fl=LGraphCanvas.getPropertyPrintableValue(al,ll.values),_l.innerText=fl,(dl=LiteGraph.debug)==null||dl.call(LiteGraph,"addWidget ENUM COMBO",ol,fl,_l,ll),_l.addEventListener("click",function(ml){var Tl=ll.values||[],bl=this.parentNode.dataset.property,Gl=this;new LiteGraph.ContextMenu(Tl,{event:ml,className:"dark",callback:Il},il);function Il(Ml){return Gl.innerText=Ml,yl(bl,Ml),!1}})),sl.content.appendChild(hl);function yl(ml,Tl){var bl;(bl=LiteGraph.debug)==null||bl.call(LiteGraph,"widgetInnerChange",ml,Tl,ll),ll.callback&&ll.callback(ml,Tl,ll),cl&&cl(ml,Tl,ll)}return hl},sl.onOpen&&typeof sl.onOpen=="function"&&sl.onOpen(),sl}function closePanels(){var tl=document.querySelector("#node-panel");tl&&tl.close(),tl=document.querySelector("#option-panel"),tl&&tl.close()}function showShowGraphOptionsPanel(tl,el){var il,sl,nl,ol;let rl;if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!((sl=(il=el==null?void 0:el.event)==null?void 0:il.target)!=null&&sl.lgraphcanvas)){(nl=LiteGraph.warn)==null||nl.call(LiteGraph,"References not found to add optionPanel",tl,el),LiteGraph.debug&&((ol=LiteGraph.debug)==null||ol.call(LiteGraph,"!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas",el,el.event,el.event.target,el.event.target.lgraphcanvas));return}rl=el.event.target.lgraphcanvas}else rl=this;rl.closePanels();var al=rl.getCanvasWindow();panel=rl.createPanel("Options",{closable:!0,window:al,onOpen:function(){rl.OPTIONPANEL_IS_OPEN=!0},onClose:function(){rl.OPTIONPANEL_IS_OPEN=!1,rl.options_panel=null}}),rl.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function ll(){panel.content.innerHTML="";const cl=(hl,_l,yl)=>{yl&&yl.key&&(hl=yl.key),yl.values&&(_l=Object.values(yl.values).indexOf(_l)),rl[hl]=_l};var ul=LiteGraph.availableCanvasOptions;ul.sort();for(var dl in ul){var fl=ul[dl];panel.addWidget("boolean",fl,rl[fl],{key:fl,on:"True",off:"False"},cl)}panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[rl.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},cl),panel.addSeparator(),panel.footer.innerHTML=""}ll(),rl.canvas.parentNode.appendChild(panel)}function showShowNodePanel(tl){this.SELECTED_NODE=tl,this.closePanels();var el=this.getCanvasWindow(),il=this,sl=this.createPanel(tl.title||"",{closable:!0,window:el,onOpen:function(){il.NODEPANEL_IS_OPEN=!0},onClose:function(){il.NODEPANEL_IS_OPEN=!1,il.node_panel=null}});il.node_panel=sl,sl.id="node-panel",sl.node=tl,sl.classList.add("settings");function nl(){sl.content.innerHTML="",sl.addHTML("<span class='node_type'>"+tl.type+"</span><span class='node_desc'>"+(tl.constructor.desc||"")+"</span><span class='separator'></span>"),sl.addHTML("<h3>Properties</h3>");const ol=(ul,dl)=>{var fl,hl;switch(il.graph.beforeChange(tl),ul){case"Title":tl.title=dl;break;case"Mode":var _l=Object.values(LiteGraph.NODE_MODES).indexOf(dl);_l>=0&&LiteGraph.NODE_MODES[_l]?tl.changeMode(_l):(fl=LiteGraph.warn)==null||fl.call(LiteGraph,"unexpected mode: "+dl);break;case"Color":LGraphCanvas.node_colors[dl]?(tl.color=LGraphCanvas.node_colors[dl].color,tl.bgcolor=LGraphCanvas.node_colors[dl].bgcolor):(hl=LiteGraph.warn)==null||hl.call(LiteGraph,"unexpected color: "+dl);break;default:tl.setProperty(ul,dl);break}il.graph.afterChange(),il.dirty_canvas=!0};sl.addWidget("string","Title",tl.title,{},ol),sl.addWidget("combo","Mode",LiteGraph.NODE_MODES[tl.mode],{values:LiteGraph.NODE_MODES},ol);var rl="";tl.color!==void 0&&(rl=Object.keys(LGraphCanvas.node_colors).filter(function(ul){return LGraphCanvas.node_colors[ul].color==tl.color})),sl.addWidget("combo","Color",rl,{values:Object.keys(LGraphCanvas.node_colors)},ol);for(var al in tl.properties){var ll=tl.properties[al],cl=tl.getPropertyInfo(al);tl.onAddPropertyToPanel&&tl.onAddPropertyToPanel(al,sl,ll,cl,ol)||sl.addWidget(cl.widget||cl.type,al,ll,cl,ol)}sl.addSeparator(),tl.onShowCustomPanelInfo&&tl.onShowCustomPanelInfo(sl),sl.footer.innerHTML="",sl.addButton("Delete",function(){tl.block_delete||(tl.graph.remove(tl),sl.close())}).classList.add("delete")}sl.inner_showCodePad=function(ol){sl.classList.remove("settings"),sl.classList.add("centered"),sl.alt_content.innerHTML="<textarea class='code'></textarea>";var rl=sl.alt_content.querySelector("textarea"),al=()=>{sl.toggleAltContent(!1),sl.toggleFooterVisibility(!0),rl.parentNode.removeChild(rl),sl.classList.add("settings"),sl.classList.remove("centered"),nl()};rl.value=tl.properties[ol],rl.addEventListener("keydown",function(ul){ul.code=="Enter"&&ul.ctrlKey&&(tl.setProperty(ol,rl.value),al())}),sl.toggleAltContent(!0),sl.toggleFooterVisibility(!1),rl.style.height="calc(100% - 40px)";var ll=sl.addButton("Assign",function(){tl.setProperty(ol,rl.value),al()});sl.alt_content.appendChild(ll);var cl=sl.addButton("Close",al);cl.style.float="right",sl.alt_content.appendChild(cl)},nl(),this.canvas.parentNode.appendChild(sl)}function showSubgraphPropertiesDialog(tl){var el;(el=LiteGraph.log)==null||el.call(LiteGraph,"showing subgraph properties dialog");var il=this.canvas.parentNode.querySelector(".subgraph_dialog");il&&il.close();var sl=this.createPanel("Subgraph Inputs",{closable:!0,width:500});sl.node=tl,sl.classList.add("subgraph_dialog");function nl(){if(sl.clear(),tl.inputs)for(let ul=0;ul<tl.inputs.length;++ul){var al=tl.inputs[ul];if(!al.not_subgraph_input){var ll="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",cl=sl.addHTML(ll,"subgraph_property");cl.dataset.name=al.name,cl.dataset.slot=ul,cl.querySelector(".name").innerText=al.name,cl.querySelector(".type").innerText=al.type,cl.querySelector("button").addEventListener("click",function(dl){tl.removeInput(Number(this.parentNode.dataset.slot)),nl()})}}}var ol=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",rl=sl.addHTML(ol,"subgraph_property extra",!0);return rl.querySelector("button").addEventListener("click",function(al){var ll=this.parentNode,cl=ll.querySelector(".name").value,ul=ll.querySelector(".type").value;!cl||tl.findInputSlot(cl)!=-1||(tl.addInput(cl,ul),ll.querySelector(".name").value="",ll.querySelector(".type").value="",nl())}),nl(),this.canvas.parentNode.appendChild(sl),sl}function showSubgraphPropertiesDialogRight(tl){var el=this.canvas.parentNode.querySelector(".subgraph_dialog");el&&el.close();var il=this.createPanel("Subgraph Outputs",{closable:!0,width:500});il.node=tl,il.classList.add("subgraph_dialog");function sl(){if(il.clear(),tl.outputs)for(let ul=0;ul<tl.outputs.length;++ul){var al=tl.outputs[ul];if(!al.not_subgraph_output){var ll="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",cl=il.addHTML(ll,"subgraph_property");cl.dataset.name=al.name,cl.dataset.slot=ul,cl.querySelector(".name").innerText=al.name,cl.querySelector(".type").innerText=al.type,cl.querySelector("button").addEventListener("click",function(dl){tl.removeOutput(Number(this.parentNode.dataset.slot)),sl()})}}}var nl=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",ol=il.addHTML(nl,"subgraph_property extra",!0);ol.querySelector(".name").addEventListener("keydown",function(al){e.keyCode==13&&rl.apply(this)}),ol.querySelector("button").addEventListener("click",function(al){rl.apply(this)});function rl(){var al=this.parentNode,ll=al.querySelector(".name").value,cl=al.querySelector(".type").value;!ll||tl.findOutputSlot(ll)!=-1||(tl.addOutput(ll,cl),al.querySelector(".name").value="",al.querySelector(".type").value="",sl())}return sl(),this.canvas.parentNode.appendChild(il),il}function checkPanels(){if(this.canvas){var tl=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(let il=0;il<tl.length;++il){var el=tl[il];el.node&&(!el.node.graph||el.graph!=this.graph)&&el.close()}}}class UiController{constructor(el){this.host=el}showLinkMenu(...el){return showLinkMenu.apply(this.host,el)}createDefaultNodeForSlot(...el){return createDefaultNodeForSlot.apply(this.host,el)}showConnectionMenu(...el){return showConnectionMenu.apply(this.host,el)}getCanvasMenuOptions(...el){return getCanvasMenuOptions.apply(this.host,el)}getNodeMenuOptions(...el){return getNodeMenuOptions.apply(this.host,el)}getGroupMenuOptions(...el){return getGroupMenuOptions.apply(this.host,el)}processContextMenu(...el){return processContextMenu.apply(this.host,el)}prompt(...el){return prompt.apply(this.host,el)}showSearchBox(...el){return showSearchBox.apply(this.host,el)}showEditPropertyValue(...el){return showEditPropertyValue.apply(this.host,el)}createDialog(...el){return createDialog.apply(this.host,el)}createPanel(...el){return createPanel.apply(this.host,el)}closePanels(...el){return closePanels.apply(this.host,el)}showShowGraphOptionsPanel(...el){return showShowGraphOptionsPanel.apply(this.host,el)}showShowNodePanel(...el){return showShowNodePanel.apply(this.host,el)}showSubgraphPropertiesDialog(...el){return showSubgraphPropertiesDialog.apply(this.host,el)}showSubgraphPropertiesDialogRight(...el){return showSubgraphPropertiesDialogRight.apply(this.host,el)}checkPanels(...el){return checkPanels.apply(this.host,el)}}function createLGraphCanvasControllers(tl){return{core:new CoreController(tl),events:new EventsController(tl),render:new RenderController(tl),selection:new SelectionController(tl),ui:new UiController(tl)}}const delegateMap={clear:"core",setGraph:"core",getTopGraph:"core",openSubgraph:"core",closeSubgraph:"core",getCurrentGraph:"core",setCanvas:"core",_doNothing:"core",_doReturnTrue:"core",bindEvents:"core",unbindEvents:"core",enableWebGL:"core",setDirty:"core",getCanvasWindow:"core",startRendering:"core",stopRendering:"core",blockClick:"events",processUserInputDown:"events",processMouseDown:"events",processMouseMove:"events",processMouseUp:"events",processMouseWheel:"events",isOverNodeBox:"core",isOverNodeInput:"core",isOverNodeOutput:"core",processKey:"events",copyToClipboard:"selection",pasteFromClipboard:"selection",processDrop:"events",checkDropItem:"events",processNodeDblClicked:"selection",processNodeSelected:"selection",selectNode:"selection",selectNodes:"selection",deselectNode:"selection",deselectAllNodes:"selection",deleteSelectedNodes:"selection",centerOnNode:"core",adjustMouseEvent:"core",setZoom:"core",convertOffsetToCanvas:"core",convertCanvasToOffset:"core",convertEventToCanvasOffset:"core",bringToFront:"core",sendToBack:"core",computeVisibleNodes:"core",draw:"render",drawFrontCanvas:"render",drawSubgraphPanel:"render",drawSubgraphPanelLeft:"render",drawSubgraphPanelRight:"render",drawButton:"render",isAreaClicked:"render",renderInfo:"render",drawBackCanvas:"render",drawNode:"render",drawNodeTooltip:"render",drawLinkTooltip:"render",drawNodeShape:"render",drawConnections:"render",renderLink:"render",computeConnectionPoint:"render",drawExecutionOrder:"render",drawNodeWidgets:"render",processNodeWidgets:"render",drawGroups:"render",adjustNodesSize:"render",resize:"core",switchLiveMode:"core",onNodeSelectionChange:"selection",boundaryNodesForSelection:"selection",showLinkMenu:"ui",createDefaultNodeForSlot:"ui",showConnectionMenu:"ui",prompt:"ui",showSearchBox:"ui",showEditPropertyValue:"ui",createDialog:"ui",createPanel:"ui",closePanels:"ui",showShowGraphOptionsPanel:"ui",showShowNodePanel:"ui",showSubgraphPropertiesDialog:"ui",showSubgraphPropertiesDialogRight:"ui",checkPanels:"ui",getCanvasMenuOptions:"ui",getNodeMenuOptions:"ui",getGroupMenuOptions:"ui",processContextMenu:"ui",lowQualityRenderingRequired:"render"};function ensureControllers(tl){return tl.controllers||(tl.controllers=createLGraphCanvasControllers(tl)),tl.controllers}function installLGraphCanvasDelegates(tl){for(const[el,il]of Object.entries(delegateMap))Object.defineProperty(tl.prototype,el,{value:function(...sl){return ensureControllers(this)[il][el](...sl)},writable:!0,configurable:!0})}function getFileExtension(tl){const el=new URL(tl).pathname,il=el.lastIndexOf(".");return il===-1?"":el.slice(il+1).toLowerCase()}function onGroupAdd(tl,el,il){var sl=LGraphCanvas.active_canvas,nl=new LiteGraph.LGraphGroup;nl.pos=sl.convertEventToCanvasOffset(il),sl.graph.add(nl)}function getBoundaryNodes(tl){let el=null,il=null,sl=null,nl=null;for(const ol in tl){const rl=tl[ol],[al,ll]=rl.pos,[cl,ul]=rl.size;(el===null||ll<el.pos[1])&&(el=rl),(il===null||al+cl>il.pos[0]+il.size[0])&&(il=rl),(sl===null||ll+ul>sl.pos[1]+sl.size[1])&&(sl=rl),(nl===null||al<nl.pos[0])&&(nl=rl)}return{top:el,right:il,bottom:sl,left:nl}}function alignNodes(tl,el,il){if(!tl)return;const sl=LGraphCanvas.active_canvas;let nl=[];il===void 0?nl=LGraphCanvas.getBoundaryNodes(tl):nl={top:il,right:il,bottom:il,left:il};for(const[ol,rl]of Object.entries(sl.selected_nodes))switch(el){case"right":rl.pos[0]=nl.right.pos[0]+nl.right.size[0]-rl.size[0];break;case"left":rl.pos[0]=nl.left.pos[0];break;case"top":rl.pos[1]=nl.top.pos[1];break;case"bottom":rl.pos[1]=nl.bottom.pos[1]+nl.bottom.size[1]-rl.size[1];break}sl.dirty_canvas=!0,sl.dirty_bgcanvas=!0}function onNodeAlign(tl,el,il,sl,nl){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:il,callback:ol,parentMenu:sl});function ol(rl){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,rl.toLowerCase(),nl)}}function onGroupAlign(tl,el,il,sl){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:il,callback:nl,parentMenu:sl});function nl(ol){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,ol.toLowerCase())}}function onMenuAdd(tl,el,il,sl,nl){var ol=LGraphCanvas.active_canvas,rl=ol.getCanvasWindow(),al=ol.graph;if(!al)return;function ll(cl,ul){var dl=LiteGraph.getNodeTypesCategories(ol.filter||al.filter).filter(function(_l){return _l.startsWith(cl)}),fl=[];dl.map(function(_l){if(_l){var yl=new RegExp("^("+cl+")"),ml=_l.replace(yl,"").split("/")[0],Tl=cl===""?ml+"/":cl+ml+"/",bl=ml;bl.indexOf("::")!=-1&&(bl=bl.split("::")[1]);var Gl=fl.findIndex(function(Il){return Il.value===Tl});Gl===-1&&fl.push({value:Tl,content:bl,has_submenu:!0,callback:function(Il,Ml,zl,Fl){ll(Il.value,Fl)}})}});var hl=LiteGraph.getNodeTypesInCategory(cl.slice(0,-1),ol.filter||al.filter);hl.map(function(_l){if(!_l.skip_list){var yl={value:_l.type,content:_l.title,has_submenu:!1,callback:function(ml,Tl,bl,Gl){var Il=Gl.getFirstEvent();ol.graph.beforeChange();var Ml=LiteGraph.createNode(ml.value);Ml&&(Ml.pos=ol.convertEventToCanvasOffset(Il),ol.graph.add(Ml)),nl&&nl(Ml),ol.graph.afterChange()}};fl.push(yl)}}),new LiteGraph.ContextMenu(fl,{event:il,parentMenu:ul},rl)}return ll("",sl),!1}function onMenuCollapseAll(){}function onMenuNodeEdit(){}function showMenuNodeOptionalInputs(tl,el,il,sl,nl){var ol;if(!nl)return;var rl=this,al=LGraphCanvas.active_canvas,ll=al.getCanvasWindow();el=nl.optional_inputs,nl.onGetInputs&&(el=nl.onGetInputs());var cl=[];if(el)for(let yl=0;yl<el.length;yl++){var ul=el[yl];if(!ul){cl.push(null);continue}var dl=ul[0];ul[2]||(ul[2]={}),ul[2].label&&(dl=ul[2].label),ul[2].removable=!0;var fl={content:dl,value:ul};ul[1]==LiteGraph.ACTION&&(fl.className="event"),cl.push(fl)}if(nl.onMenuNodeInputs){var hl=nl.onMenuNodeInputs(cl);hl&&(cl=hl)}if(LiteGraph.do_add_triggers_slots&&nl.findInputSlot("onTrigger")==-1&&cl.push({content:"On Trigger",value:["onTrigger",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),!cl.length){LiteGraph.debug&&((ol=LiteGraph.log)==null||ol.call(LiteGraph,"no input entries"));return}new LiteGraph.ContextMenu(cl,{event:il,callback:_l,parentMenu:sl,node:nl},ll);function _l(yl,ml,Tl){var bl;if(nl&&(yl.callback&&yl.callback.call(rl,nl,yl,ml,Tl),yl.value)){nl.graph.beforeChange();const Gl=yl.value[2]?Object.assign({},yl.value[2]):{};nl.addInput(yl.value[0],yl.value[1],Gl),(bl=nl.onNodeInputAdd)==null||bl.call(nl,yl.value),nl.setDirtyCanvas(!0,!0),nl.graph.afterChange()}}return!1}function showMenuNodeOptionalOutputs(tl,el,il,sl,nl){if(!nl)return;var ol=this,rl=LGraphCanvas.active_canvas,al=rl.getCanvasWindow();el=nl.optional_outputs,nl.onGetOutputs&&(el=nl.onGetOutputs());var ll=[];if(el)for(let _l=0;_l<el.length;_l++){var cl=el[_l];if(!cl){ll.push(null);continue}if(!(nl.flags&&nl.flags.skip_repeated_outputs&&nl.findOutputSlot(cl[0])!=-1)){var ul=cl[0];cl[2]||(cl[2]={}),cl[2].label&&(ul=cl[2].label),cl[2].removable=!0;var dl={content:ul,value:cl};cl[1]==LiteGraph.EVENT&&(dl.className="event"),ll.push(dl)}}if(this.onMenuNodeOutputs&&(ll=this.onMenuNodeOutputs(ll)),LiteGraph.do_add_triggers_slots&&nl.findOutputSlot("onExecuted")==-1&&ll.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),nl.onMenuNodeOutputs){var fl=nl.onMenuNodeOutputs(ll);fl&&(ll=fl)}if(!ll.length)return;new LiteGraph.ContextMenu(ll,{event:il,callback:hl,parentMenu:sl,node:nl},al);function hl(_l,yl,ml){var Tl;if(nl&&(_l.callback&&_l.callback.call(ol,nl,_l,yl,ml),!!_l.value)){var bl=_l.value[1];if(bl&&(bl.constructor===Object||bl.constructor===Array)){var Gl=[];for(let Il in bl)Gl.push({content:Il,value:bl[Il]});return new LiteGraph.ContextMenu(Gl,{event:yl,callback:hl,parentMenu:sl,node:nl}),!1}else{nl.graph.beforeChange();const Il=_l.value[2]?Object.assign({},_l.value[2]):{};nl.addOutput(_l.value[0],_l.value[1],Il),(Tl=nl.onNodeOutputAdd)==null||Tl.call(nl,_l.value),nl.setDirtyCanvas(!0,!0),nl.graph.afterChange()}}}return!1}function onShowMenuNodeProperties(tl,el,il,sl,nl){if(!nl||!nl.properties)return;var ol=LGraphCanvas.active_canvas,rl=ol.getCanvasWindow(),al=[];for(let ul in nl.properties){tl=nl.properties[ul]!==void 0?nl.properties[ul]:" ",typeof tl=="object"&&(tl=JSON.stringify(tl));var ll=nl.getPropertyInfo(ul);(ll.type=="enum"||ll.type=="combo")&&(tl=LGraphCanvas.getPropertyPrintableValue(tl,ll.values)),tl=LGraphCanvas.decodeHTML(tl),al.push({content:"<span class='property_name'>"+(ll.label?ll.label:ul)+"</span><span class='property_value'>"+tl+"</span>",value:ul})}if(!al.length)return;new LiteGraph.ContextMenu(al,{event:il,callback:cl,parentMenu:sl,allow_html:!0,node:nl},rl);function cl(ul){if(nl){var dl=this.getBoundingClientRect();ol.showEditPropertyValue(nl,ul.value,{position:[dl.left,dl.top]})}}return!1}function decodeHTML(tl){var el=document.createElement("div");return el.innerText=tl,el.innerHTML}function onMenuResizeNode(tl,el,il,sl,nl){if(!nl)return;const ol=al=>{al.size=al.computeSize(),al.onResize&&al.onResize(al.size)};var rl=LGraphCanvas.active_canvas;if(!rl.selected_nodes||Object.keys(rl.selected_nodes).length<=1)ol(nl);else for(let al in rl.selected_nodes)ol(rl.selected_nodes[al]);nl.setDirtyCanvas(!0,!0)}function onShowPropertyEditor(tl,el,il,sl,nl){var ol=tl.property||"title",rl=nl[ol],al=document.createElement("div");al.is_modified=!1,al.className="graphdialog",al.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",al.close=()=>{var Gl;(Gl=al.parentNode)==null||Gl.removeChild(al)};var ll=al.querySelector(".name");ll.innerText=ol;var cl=al.querySelector(".value");const ul=()=>{cl&&bl(cl.value)};cl&&(cl.value=rl,cl.addEventListener("blur",function(Gl){this.focus()}),cl.addEventListener("keydown",function(Gl){if(al.is_modified=!0,Gl.keyCode==27)al.close();else if(Gl.keyCode==13)ul();else if(Gl.keyCode!=13&&Gl.target.localName!="textarea")return;Gl.preventDefault(),Gl.stopPropagation()}));var dl=LGraphCanvas.active_canvas,fl=dl.canvas,hl=fl.getBoundingClientRect(),_l=-20,yl=-20;hl&&(_l-=hl.left,yl-=hl.top),il?(al.style.left=il.clientX+_l+"px",al.style.top=il.clientY+yl+"px"):(al.style.left=fl.width*.5+_l+"px",al.style.top=fl.height*.5+yl+"px");var ml=al.querySelector("button");ml.addEventListener("click",ul),fl.parentNode.appendChild(al),cl&&cl.focus();let Tl=null;al.addEventListener("pointerleave",Gl=>{LiteGraph.dialog_close_on_mouse_leave&&!al.is_modified&&(Tl=setTimeout(al.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),al.addEventListener("pointerenter",Gl=>{LiteGraph.dialog_close_on_mouse_leave&&Tl&&clearTimeout(Tl)});const bl=Gl=>{var Il;switch(tl.type){case"Number":Gl=Number(Gl);break;case"Boolean":Gl=!!Gl;break}nl[ol]=Gl,(Il=al.parentNode)==null||Il.removeChild(al),nl.setDirtyCanvas(!0,!0)}}function getPropertyPrintableValue(tl,el){if(!el||el.constructor===Array)return String(tl);if(el.constructor===Object){var il="";for(var sl in el)if(el[sl]==tl){il=sl;break}return String(tl)+" ("+il+")"}}function onMenuNodeCollapse(tl,el,il,sl,nl){nl.graph.beforeChange();var ol=function(al){al.collapse()},rl=LGraphCanvas.active_canvas;if(!rl.selected_nodes||Object.keys(rl.selected_nodes).length<=1)ol(nl);else for(let al in rl.selected_nodes)ol(rl.selected_nodes[al]);nl.graph.afterChange()}function onMenuNodePin(tl,el,il,sl,nl){nl.pin()}function onMenuNodeMode(tl,el,il,sl,nl){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:il,callback:ol,parentMenu:sl,node:nl});function ol(rl){if(!nl)return;var al=Object.values(LiteGraph.NODE_MODES).indexOf(rl);const ll=ul=>{var dl;al>=0&&LiteGraph.NODE_MODES[al]?ul.changeMode(al):((dl=LiteGraph.warn)==null||dl.call(LiteGraph,"unexpected mode: "+rl),ul.changeMode(LiteGraph.ALWAYS))};var cl=LGraphCanvas.active_canvas;if(!cl.selected_nodes||Object.keys(cl.selected_nodes).length<=1)ll(nl);else for(let ul in cl.selected_nodes)ll(cl.selected_nodes[ul])}return!1}function onMenuNodeColors(tl,el,il,sl,nl){if(!nl)throw new Error("no node for color");var ol=[];ol.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(let al in LGraphCanvas.node_colors){let ll=LGraphCanvas.node_colors[al];tl={value:al,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+ll.color+"; background-color:"+ll.bgcolor+"'>"+al+"</span>"},ol.push(tl)}new LiteGraph.ContextMenu(ol,{event:il,callback:rl,parentMenu:sl,node:nl});function rl(al){if(!nl)return;let ll=al.value?LGraphCanvas.node_colors[al.value]:null;const cl=dl=>{ll?dl.constructor===LiteGraph.LGraphGroup?dl.color=ll.groupcolor:(dl.color=ll.color,dl.bgcolor=ll.bgcolor):(delete dl.color,delete dl.bgcolor)};var ul=LGraphCanvas.active_canvas;if(!ul.selected_nodes||Object.keys(ul.selected_nodes).length<=1)cl(nl);else for(let dl in ul.selected_nodes)cl(ul.selected_nodes[dl]);nl.setDirtyCanvas(!0,!0)}return!1}function onMenuNodeShapes(tl,el,il,sl,nl){if(!nl)throw new Error("no node passed");new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:il,callback:ol,parentMenu:sl,node:nl});function ol(rl){if(!nl)return;nl.graph.beforeChange();const al=cl=>{cl.shape=rl};var ll=LGraphCanvas.active_canvas;if(!ll.selected_nodes||Object.keys(ll.selected_nodes).length<=1)al(nl);else for(let cl in ll.selected_nodes)al(ll.selected_nodes[cl]);nl.graph.afterChange(),nl.setDirtyCanvas(!0)}return!1}function onMenuNodeRemove(tl,el,il,sl,nl){if(!nl)throw new Error("no node passed");var ol=nl.graph;ol.beforeChange();const rl=ll=>{ll.removable!==!1&&ol.remove(ll)};var al=LGraphCanvas.active_canvas;if(!al.selected_nodes||Object.keys(al.selected_nodes).length<=1)rl(nl);else for(let ll in al.selected_nodes)rl(al.selected_nodes[ll]);ol.afterChange(),nl.setDirtyCanvas(!0,!0)}function onMenuNodeToSubgraph(tl,el,il,sl,nl){var ol=nl.graph,rl=LGraphCanvas.active_canvas;if(rl){var al=Object.values(rl.selected_nodes||{});al.length||(al=[nl]);var ll=LiteGraph.createNode("graph/subgraph");ll.pos=nl.pos.concat(),ol.add(ll),ll.buildFromNodes(al),rl.deselectAllNodes(),nl.setDirtyCanvas(!0,!0)}}function onMenuNodeClone(tl,el,il,sl,nl){nl.graph.beforeChange();var ol={};const rl=ll=>{if(ll.clonable!==!1){var cl=ll.clone();cl&&(cl.pos=[ll.pos[0]+5,ll.pos[1]+5],ll.graph.add(cl),ol[cl.id]=cl)}};var al=LGraphCanvas.active_canvas;if(!al.selected_nodes||Object.keys(al.selected_nodes).length<=1)rl(nl);else for(let ll in al.selected_nodes)rl(al.selected_nodes[ll]);Object.keys(ol).length&&al.selectNodes(ol),nl.graph.afterChange(),nl.setDirtyCanvas(!0,!0)}const DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",link_type_colors={"-1":"#A86",number:"#AAA",node:"#DCA",string:"#77F",boolean:"#F77"},gradients={},search_limit=-1,node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};function applyLGraphCanvasStatics(tl){Object.assign(tl,{getFileExtension,onGroupAdd,getBoundaryNodes,alignNodes,onNodeAlign,onGroupAlign,onMenuAdd,onMenuCollapseAll,onMenuNodeEdit,showMenuNodeOptionalInputs,showMenuNodeOptionalOutputs,onShowMenuNodeProperties,decodeHTML,onMenuResizeNode,onShowPropertyEditor,getPropertyPrintableValue,onMenuNodeCollapse,onMenuNodePin,onMenuNodeMode,onMenuNodeColors,onMenuNodeShapes,onMenuNodeRemove,onMenuNodeToSubgraph,onMenuNodeClone}),tl.DEFAULT_BACKGROUND_IMAGE=DEFAULT_BACKGROUND_IMAGE,tl.link_type_colors=link_type_colors,tl.gradients=gradients,tl.search_limit=search_limit,tl.node_colors=node_colors}class LGraphCanvas{constructor(el,il,sl){sl!=null||(sl={skip_render:!1,autoresize:!1,clip_all_nodes:!1,rendererAdapter:null}),this.options=sl,this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,el&&el.constructor===String&&(el=document.querySelector(el)),this.ds=new LiteGraph.DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=`${LiteGraph.NODE_TEXT_SIZE}px Arial`,this.inner_text_font=`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.move_destination_link_without_shift=!1,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.free_resize=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.autoresize=sl.autoresize,this.skip_render=sl.skip_render,this.clip_all_nodes=sl.clip_all_nodes,this.free_resize=sl.free_resize,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=sl.viewport||null,this.low_quality_rendering_threshold=5,this.controllers=createLGraphCanvasControllers(this),this.rendererAdapter=sl.rendererAdapter||new Canvas2DRendererAdapter,this.frontSurface=null,this.backSurface=null,this.processMouseWheel=this.processMouseWheel.bind(this),this.processKey=this.processKey.bind(this),this.processDrop=this.processDrop.bind(this),il==null||il.attachCanvas(this),this.setCanvas(el,sl.skip_events),this.clear(),!this.skip_render&&!sl.skip_render&&this.startRendering()}}installLGraphCanvasDelegates(LGraphCanvas),applyLGraphCanvasStatics(LGraphCanvas);class DragAndScale{constructor(el,il){gl(this,"onMouseDown",sl=>{if(!this.enabled)return;const nl=this.element.getBoundingClientRect();var ol=sl.clientX-nl.left,rl=sl.clientY-nl.top;sl.canvasx=ol,sl.canvasy=rl,sl.dragging=this.dragging;var al=!this.viewport||this.viewport&&ol>=this.viewport[0]&&ol<this.viewport[0]+this.viewport[2]&&rl>=this.viewport[1]&&rl<this.viewport[1]+this.viewport[3];al&&(this.dragging=!0,this.abortController=new AbortController,document.addEventListener("pointermove",this.onMouseMove,{signal:this.abortController.signal}),document.addEventListener("pointerup",this.onMouseUp,{signal:this.abortController.signal})),this.last_mouse[0]=ol,this.last_mouse[1]=rl}),gl(this,"onMouseMove",sl=>{if(!this.enabled)return;const nl=this.element.getBoundingClientRect();var ol=sl.clientX-nl.left,rl=sl.clientY-nl.top;sl.canvasx=ol,sl.canvasy=rl,sl.dragging=this.dragging;var al=ol-this.last_mouse[0],ll=rl-this.last_mouse[1];this.dragging&&this.mouseDrag(al,ll),this.last_mouse[0]=ol,this.last_mouse[1]=rl}),gl(this,"onMouseUp",sl=>{var nl;this.dragging=!1,(nl=this.abortController)==null||nl.abort()}),gl(this,"onWheel",sl=>{sl.wheel=-sl.deltaY,sl.delta=sl.wheelDelta?sl.wheelDelta/40:sl.deltaY?-sl.deltaY/3:0,this.changeDeltaScale(1+sl.delta*.05)}),this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),el&&(this.element=el,il||this.bindEvents(el))}bindEvents(el){this.last_mouse=new Float32Array(2),el.addEventListener("pointerdown",this.onMouseDown),el.addEventListener("wheel",this.onWheel)}computeVisibleArea(el){if(!this.element){this.visible_area.set([0,0,0,0]);return}let il=this.element.width,sl=this.element.height,nl=-this.offset[0],ol=-this.offset[1];if(el){nl+=el[0]/this.scale,ol+=el[1]/this.scale;const[ll,cl]=el.slice(2);il=ll,sl=cl}const rl=nl+il/this.scale,al=ol+sl/this.scale;this.visible_area.set([nl,ol,rl-nl,al-ol])}toCanvasContext(el){el.scale(this.scale,this.scale),el.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(el){return[(el[0]+this.offset[0])*this.scale,(el[1]+this.offset[1])*this.scale]}convertCanvasToOffset(el,il=[0,0]){return il[0]=el[0]/this.scale-this.offset[0],il[1]=el[1]/this.scale-this.offset[1],il}mouseDrag(el,il){var sl;this.offset[0]+=el/this.scale,this.offset[1]+=il/this.scale,(sl=this.onredraw)==null||sl.call(this,this)}changeScale(el,il){var sl;if(el=LiteGraph.clamp(el,this.min_scale,this.max_scale),el==this.scale||!this.element)return;const nl=this.element.getBoundingClientRect();if(nl){il=il||[nl.width*.5,nl.height*.5];var ol=this.convertCanvasToOffset(il);this.scale=el,Math.abs(this.scale-1)<.01&&(this.scale=1);var rl=this.convertCanvasToOffset(il),al=[rl[0]-ol[0],rl[1]-ol[1]];this.offset[0]+=al[0],this.offset[1]+=al[1],(sl=this.onredraw)==null||sl.call(this,this)}}changeDeltaScale(el,il){this.changeScale(this.scale*el,il)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}function normalizeContextMenuOptions(tl={}){var el;return(el=tl.scroll_speed)!=null||(tl.scroll_speed=.1),tl}function linkContextMenuToParent(tl,el){var il;const sl=tl.options.parentMenu;if(sl){if(sl.constructor!==tl.constructor){(il=el.error)==null||il.call(el,"parentMenu must be of class ContextMenu, ignoring it"),tl.options.parentMenu=null;return}tl.parentMenu=sl,tl.parentMenu.lock=!0,tl.parentMenu.current_submenu=tl}}function validateContextMenuEventClass(tl,el){var il;if(!tl.options.event)return;const sl=tl.options.event.constructor.name;sl!=="MouseEvent"&&sl!=="CustomEvent"&&sl!=="PointerEvent"&&((il=el.error)==null||il.call(el,`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${sl})`),tl.options.event=null)}function createContextMenuRoot(tl){const el=tl.root=document.createElement("div");return tl.options.className&&(el.className=tl.options.className),el.classList.add("litegraph","litecontextmenu","litemenubar-panel"),el.style.minWidth="80px",el.style.minHeight="10px",el}function setContextMenuTitle(tl,el){var il;if(!el)return;(il=tl.titleElement)!=null||(tl.titleElement=document.createElement("div"));const sl=tl.titleElement;sl.className="litemenu-title",sl.innerHTML=el,tl.root.parentElement||tl.root.appendChild(sl)}function addContextMenuItems(tl,el){for(let il=0;il<el.length;il++){let sl=el[il];typeof sl!="string"&&(sl=sl&&sl.content!==void 0?String(sl.content):String(sl));const nl=el[il];tl.menu_elements.push(tl.addItem(sl,nl,tl.options))}}function resolveContextMenuHost(tl){var el,il,sl;const nl=(il=(el=tl.options.event)==null?void 0:el.target.ownerDocument)!=null?il:document,ol=(sl=nl.fullscreenElement)!=null?sl:nl.body;return{doc:nl,parent:ol}}function appendContextMenuRoot(tl,el){el.appendChild(tl.root)}function bindContextMenuRootEvents(tl){const el=tl.root;el.style.pointerEvents="none",setTimeout(()=>{el.style.pointerEvents="auto"},100),el.addEventListener("pointerup",il=>(il.preventDefault(),!0)),el.addEventListener("contextmenu",il=>(il.button!=2||il.preventDefault(),!1)),el.addEventListener("pointerdown",il=>{if(il.button==2)return tl.close(),il.preventDefault(),!0}),el.addEventListener("wheel",il=>{const sl=parseInt(el.style.top);return el.style.top=(sl+il.deltaY*tl.options.scroll_speed).toFixed()+"px",il.preventDefault(),!0}),el.addEventListener("pointerenter",il=>{el.closing_timer&&clearTimeout(el.closing_timer)})}function setupContextMenuFiltering(tl,el,il,sl){var nl;if(!el){(nl=sl.warn)==null||nl.call(sl,"NO root document to add context menu and event",el,tl.options);return}il.f_textfilter&&(el.removeEventListener("keydown",il.f_textfilter,!1),el.removeEventListener("keydown",il.f_textfilter,!0),il.f_textfilter=!1),il.f_textfilter=function(ol){var rl,al,ll,cl,ul,dl,fl;if(tl.current_submenu){(rl=sl.debug)==null||rl.call(sl,"Prevent filtering on ParentMenu",tl);return}if(tl.allOptions||(tl.allOptions=tl.menu_elements,tl.selectedOption=!1),tl.currentOptions||(tl.currentOptions=tl.allOptions),tl.filteringText||(tl.filteringText=""),ol.key){let hl=!1;switch(ol.key){case"Backspace":tl.filteringText.length&&(tl.filteringText=tl.filteringText.substring(0,tl.filteringText.length-1),hl=!0);break;case"Escape":il.f_textfilter&&(el.removeEventListener("keydown",il.f_textfilter,!1),el.removeEventListener("keydown",il.f_textfilter,!0),il.f_textfilter=!1),tl.close();break;case"ArrowDown":do tl.selectedOption=tl.selectedOption!==!1?Math.min(Math.max(tl.selectedOption+1,0),tl.allOptions.length-1):0;while(tl.allOptions[tl.selectedOption]&&tl.allOptions[tl.selectedOption].hidden&&tl.selectedOption<tl.allOptions.length-1);tl.allOptions[tl.selectedOption]&&tl.allOptions[tl.selectedOption].hidden&&(tl.selectedOption=tl.currentOptions[tl.currentOptions.length-1].menu_index),hl=!0;break;case"ArrowUp":do tl.selectedOption=tl.selectedOption!==!1?Math.min(Math.max(tl.selectedOption-1,0),tl.allOptions.length-1):0;while(tl.allOptions[tl.selectedOption]&&tl.allOptions[tl.selectedOption].hidden&&tl.selectedOption>0);tl.allOptions[tl.selectedOption]&&tl.allOptions[tl.selectedOption].hidden&&(tl.currentOptions&&tl.currentOptions.length?tl.selectedOption=tl.currentOptions[0].menu_index:tl.selectedOption=!1),hl=!0;break;case"ArrowLeft":break;case"ArrowRight":case"Enter":if(tl.selectedOption!==!1)tl.allOptions[tl.selectedOption]?((al=sl.debug)==null||al.call(sl,"ContextElement simCLICK",tl.allOptions[tl.selectedOption]),tl.allOptions[tl.selectedOption].do_click&&tl.allOptions[tl.selectedOption].do_click(tl.options.event,ignore_parent_menu)):((ll=sl.debug)==null||ll.call(sl,"ContextElement selection wrong",tl.selectedOption),tl.selectedOption=tl.selectedOption!==!1?Math.min(Math.max(tl.selectedOption,0),tl.allOptions.length-1):0);else if(tl.filteringText.length){for(const _l in tl.allOptions)if(tl.allOptions[_l].style.display!=="none"&&!(tl.allOptions[_l].classList+"").includes("separator")&&tl.allOptions[_l].textContent!=="Search"){(cl=sl.debug)==null||cl.call(sl,"ContextElement simCLICK",tl.allOptions[_l]),il.f_textfilter&&el&&(el.removeEventListener("keydown",il.f_textfilter,!1),el.removeEventListener("keydown",il.f_textfilter,!0),(ul=sl.debug)==null||ul.call(sl,"Cleaned ParentContextMenu listener",el,tl)),tl.allOptions[_l].do_click(ol,!1);break}}hl=!0;break;default:(dl=sl.debug)==null||dl.call(sl,"ContextMenu filter: keyEvent",ol.key);break}!hl&&ol.key.length==1&&(tl.filteringText+=ol.key,tl.parentMenu)}if(tl.filteringText&&tl.filteringText!==""){const hl=[];tl.currentOptions=[];for(const _l in tl.allOptions){const yl=tl.allOptions[_l].textContent,ml=yl.toLocaleLowerCase().includes(tl.filteringText.toLocaleLowerCase()),Tl=yl.toLocaleLowerCase().startsWith(tl.filteringText.toLocaleLowerCase()),bl=yl.split("/"),Gl=bl.length>1&&bl[bl.length-1].toLocaleLowerCase().startsWith(tl.filteringText.toLocaleLowerCase())||bl.length==1&&Tl,Il=(tl.allOptions[_l].classList+"").includes("separator")||yl==="Search";tl.allOptions[_l].menu_index=_l,ml&&!Il?(hl.push(tl.allOptions[_l]),tl.allOptions[_l].style.display="block",tl.allOptions[_l].hidden=!1,tl.currentOptions.push(tl.allOptions[_l]),tl.allOptions[_l].filtered_index=tl.currentOptions.length-1):(tl.allOptions[_l].hidden=!0,tl.allOptions[_l].style.display="none",tl.allOptions[_l].filtered_index=!1),Gl?tl.allOptions[_l].style.fontWeight="bold":Tl&&(tl.allOptions[_l].style.fontStyle="italic")}tl.selectedOption=tl.selectedOption!==!1?Math.min(Math.max(tl.selectedOption,0),tl.allOptions.length-1):0,tl.allOptions[tl.selectedOption]&&tl.allOptions[tl.selectedOption].hidden&&tl.currentOptions.length&&(tl.selectedOption=tl.currentOptions[0].menu_index)}else{tl.currentOptions=tl.allOptions;for(const hl in tl.allOptions)tl.allOptions[hl].style.display="block",tl.allOptions[hl].style.fontStyle="inherit",tl.allOptions[hl].style.fontWeight="inherit",tl.allOptions[hl].hidden=!1,tl.allOptions[hl].filtered_index=!1,tl.allOptions[hl].menu_index=hl}if(tl.selectedOption!==!1){(fl=sl.debug)==null||fl.call(sl,"ContextMenu selection: ",tl.selectedOption);for(const hl in tl.allOptions)tl.selectedOption+""==hl+""?tl.allOptions[hl].classList.add("selected"):tl.allOptions[hl].classList.remove("selected")}document.body.getBoundingClientRect(),il.getBoundingClientRect(),il.style.top=tl.top_original+"px"},el.removeEventListener("keydown",il.f_textfilter,!0),el.addEventListener("keydown",il.f_textfilter,!0),tl._filterDoc=el}function calculateContextMenuBestPosition(tl,el){var il;const sl=tl.options,nl=tl.root;let ol=sl.left||0,rl=sl.top||0;if(tl.top_original=rl,sl.event){if(ol=sl.event.clientX-10,rl=sl.event.clientY-10,sl.title&&(rl-=20),tl.top_original=rl,sl.parentMenu){const cl=sl.parentMenu.root.getBoundingClientRect();ol=cl.left+cl.width}const al=document.body.getBoundingClientRect(),ll=nl.getBoundingClientRect();al.height===0&&((il=el.error)==null||il.call(el,"document.body height is 0. That is dangerous, set html,body { height: 100%; }")),al.width&&ol>al.width-ll.width-10&&(ol=al.width-ll.width-10),al.height&&rl>al.height-ll.height-10&&(rl=al.height-ll.height-10)}nl.style.left=`${ol}px`,nl.style.top=`${rl}px`,sl.scale&&(nl.style.transform=`scale(${sl.scale})`)}function createContextMenuItem(tl,el,il,sl={},nl){var ol;const rl=document.createElement("div");rl.className="litemenu-entry submenu";let al=!1;il===null?rl.classList.add("separator"):(rl.innerHTML=(ol=il==null?void 0:il.title)!=null?ol:el,rl.value=il,il&&(il.disabled&&(al=!0,rl.classList.add("disabled")),(il.submenu||il.has_submenu)&&rl.classList.add("has_submenu")),typeof il=="function"?(rl.dataset.value=el,rl.onclick_callback=il):rl.dataset.value=il,il.className&&(rl.className+=" "+il.className)),tl.root.appendChild(rl),al||rl.addEventListener("click",cl),!al&&sl.autoopen&&rl.addEventListener("pointerenter",ul=>{const dl=tl.value;!dl||!dl.has_submenu||cl.call(tl,ul)});const ll=tl;function cl(ul){var dl,fl,hl,_l,yl;const ml=this.value;let Tl=!0;if((dl=nl.debug)==null||dl.call(nl,"ContextMenu handleMenuItemClick",ml,sl,Tl,this.current_submenu,this),(fl=ll.current_submenu)==null||fl.close(ul),sl.callback&&((hl=nl.debug)==null||hl.call(nl,"ContextMenu handleMenuItemClick callback",this,ml,sl,ul,ll,sl.node),sl.callback.call(this,ml,sl,ul,ll,sl.node)===!0&&(Tl=!1)),ml&&(ml.callback&&!sl.ignore_item_callbacks&&ml.disabled!==!0&&((_l=nl.debug)==null||_l.call(nl,"ContextMenu using value callback and !ignore_item_callbacks",this,ml,sl,ul,ll,sl.node),ml.callback.call(this,ml,sl,ul,ll,sl.extra)===!0&&(Tl=!1)),ml.submenu)){if((yl=nl.debug)==null||yl.call(nl,"ContextMenu SUBMENU",this,ml,ml.submenu.options,ul,ll,sl),!ml.submenu.options)throw new Error("ContextMenu submenu needs options");new ll.constructor(ml.submenu.options,{callback:ml.submenu.callback,event:ul,parentMenu:ll,ignore_item_callbacks:ml.submenu.ignore_item_callbacks,title:ml.submenu.title,extra:ml.submenu.extra,autoopen:sl.autoopen}),Tl=!1}Tl&&!ll.lock&&ll.close()}return rl}function closeContextMenuInstance(tl,el,il,sl){var nl,ol;if(tl.root.f_textfilter){const rl=tl._filterDoc||((nl=el==null?void 0:el.target)==null?void 0:nl.ownerDocument)||document;rl.removeEventListener("keydown",tl.root.f_textfilter,!0),rl.removeEventListener("keydown",tl.root.f_textfilter,!1),tl._filterDoc=null}tl.parentMenu&&!il&&(tl.parentMenu.lock=!1,tl.parentMenu.current_submenu=null,el===void 0?tl.parentMenu.close():el&&!sl.isCursorOverElement(el,tl.parentMenu.root)&&sl.trigger(tl.parentMenu.root,"pointerleave",el)),(ol=tl.current_submenu)==null||ol.close(el,!0),tl.root.closing_timer&&clearTimeout(tl.root.closing_timer),tl.root.parentNode&&tl.root.parentNode.removeChild(tl.root)}function closeAllContextMenus(tl=window){const el=tl.document.querySelectorAll(".litecontextmenu");el.length&&el.forEach(il=>{var sl;il.close?il.close():(sl=il.parentNode)==null||sl.removeChild(il)})}function triggerContextMenuEvent(tl,el,il,sl){const nl=new CustomEvent(el,{bubbles:!0,cancelable:!0,detail:il});return sl&&Object.defineProperty(nl,"litegraphTarget",{value:sl}),tl.dispatchEvent?tl.dispatchEvent(nl):tl.__events&&tl.__events.dispatchEvent(nl),nl}function isCursorOverContextElement(tl,el,il){return il.isInsideRectangle(tl.clientX,tl.clientY,el.left,el.top,el.width,el.height)}var pl,El,kl,Ol,xl,Pl,Al;const wl=class cc{constructor(el,il={}){Sl(this,pl),this.options=normalizeContextMenuOptions(il),this.menu_elements=[],vl(this,pl,Ol).call(this),vl(this,pl,xl).call(this),vl(this,pl,El).call(this),vl(this,pl,kl).call(this),this.setTitle(this.options.title),this.addItems(el),vl(this,pl,Pl).call(this),vl(this,pl,Al).call(this)}setTitle(el){setContextMenuTitle(this,el)}addItems(el){addContextMenuItems(this,el)}addItem(el,il,sl={}){return createContextMenuItem(this,el,il,sl,LiteGraph)}close(el,il){closeContextMenuInstance(this,el,il,cc)}static trigger(el,il,sl,nl){return triggerContextMenuEvent(el,il,sl,nl)}getTopMenu(){var el,il;return(il=(el=this.options.parentMenu)==null?void 0:el.getTopMenu())!=null?il:this}getFirstEvent(){var el,il;return(il=(el=this.options.parentMenu)==null?void 0:el.getFirstEvent())!=null?il:this.options.event}static isCursorOverElement(el,il){return isCursorOverContextElement(el,il,LiteGraph)}};pl=new WeakSet,El=function(){return createContextMenuRoot(this)},kl=function(){bindContextMenuRootEvents(this)},Ol=function(){linkContextMenuToParent(this,LiteGraph)},xl=function(){validateContextMenuEventClass(this,LiteGraph)},Pl=function(){const{doc:tl,parent:el}=resolveContextMenuHost(this);LiteGraph.context_menu_filter_enabled&&!this.options.parentMenu&&setupContextMenuFiltering(this,tl,this.root,LiteGraph),appendContextMenuRoot(this,el)},Al=function(){calculateContextMenuBestPosition(this,LiteGraph)},gl(wl,"closeAll",(tl=window)=>closeAllContextMenus(tl));let ContextMenu=wl;function resolveLeaferRuntime(tl){var el,il;return(il=(el=tl==null?void 0:tl.leaferRuntime)!=null?el:globalThis.LeaferUI)!=null?il:null}function ensureLeaferCanvasRuntime(tl){const el=tl==null?void 0:tl.LeaferCanvas;if(typeof el!="function")throw new Error("LeaferUI runtime is not available. Provide options.leaferRuntime or set globalThis.LeaferUI.");return el}function createCanvasElement(tl,el){if(tl!=null&&tl.createElement)return tl.createElement("canvas");if(typeof document!="undefined"&&document.createElement)return document.createElement("canvas");if(el)return el;throw new Error("Unable to create canvas element for Leafer surface.")}function createLeaferCanvas(tl,el,il,sl,nl){return new tl({view:el,width:il,height:sl,hittable:nl})}class LeaferUIRendererAdapter{constructor(el={}){this.options={mode:"hybrid-back",enableLogs:!0,logPrefix:"[LiteGraph][LeaferAdapter]",...el},this.ownerDocument=null,this.mode=this.options.mode||"hybrid-back",this.frontSurface=null,this.backSurface=null,this._frontLeaferCanvas=null,this._backLeaferCanvas=null}_log(el,il,sl){var nl,ol;if(!((nl=this.options)!=null&&nl.enableLogs))return;const rl=(console==null?void 0:console[el])||(console==null?void 0:console.log);if(!rl)return;const al=((ol=this.options)==null?void 0:ol.logPrefix)||"[LiteGraph][LeaferAdapter]";if(sl!==void 0){rl(`${al} ${il}`,sl);return}rl(`${al} ${il}`)}init({canvas:el,ownerDocument:il}){var sl,nl,ol,rl;const al=(sl=this.options)!=null&&sl.leaferRuntime?"options.leaferRuntime":"globalThis.LeaferUI";this._log("info","init start",{mode:this.options.mode||"hybrid-back",runtimeSource:al}),this.destroy(),this.ownerDocument=(nl=il!=null?il:el==null?void 0:el.ownerDocument)!=null?nl:null,this.mode=this.options.mode||"hybrid-back";const ll=resolveLeaferRuntime(this.options),cl=ensureLeaferCanvasRuntime(ll),ul=el.width,dl=el.height;this.mode==="full-leafer"?(this._frontLeaferCanvas=createLeaferCanvas(cl,el,ul,dl,!0),this.frontSurface=new LeaferSurface(this._frontLeaferCanvas),this._log("info","front surface created with LeaferCanvas",{width:ul,height:dl})):(this.frontSurface=new Canvas2DSurface(el),this._log("info","front surface created with Canvas2D (hybrid mode)",{width:ul,height:dl}));const fl=createCanvasElement(this.ownerDocument,el);return fl.width=ul,fl.height=dl,this._backLeaferCanvas=createLeaferCanvas(cl,fl,ul,dl,!1),this.backSurface=new LeaferSurface(this._backLeaferCanvas),this._log("info","back surface created with LeaferCanvas",{width:ul,height:dl}),this.getFrontCtx(),this.getBackCtx(),this._log("info","init complete",{mode:this.mode,frontCanvasShared:((ol=this.frontSurface)==null?void 0:ol.canvas)===el,backCanvasShared:((rl=this.backSurface)==null?void 0:rl.canvas)===el}),this}destroy(){var el,il,sl,nl;const ol=!!this._frontLeaferCanvas,rl=!!this._backLeaferCanvas;(il=(el=this._frontLeaferCanvas)==null?void 0:el.destroy)==null||il.call(el),(nl=(sl=this._backLeaferCanvas)==null?void 0:sl.destroy)==null||nl.call(sl),this._frontLeaferCanvas=null,this._backLeaferCanvas=null,this.frontSurface=null,this.backSurface=null,(ol||rl)&&this._log("info","destroy complete",{destroyedFrontLeafer:ol,destroyedBackLeafer:rl})}resize(el,il){var sl,nl;(sl=this.frontSurface)==null||sl.resize(el,il),(nl=this.backSurface)==null||nl.resize(el,il),this._log("info","resize",{width:el,height:il,mode:this.mode})}beginFrame(el){}endFrame(el){}isLayerNative(el){return el==="front"?this.mode==="full-leafer":!0}syncLayer(el){}getFrontCtx(){var el,il,sl;return applyRenderContextCompatAliases((sl=(il=(el=this.frontSurface)==null?void 0:el.getContextCompat)==null?void 0:il.call(el))!=null?sl:null)}getBackCtx(){var el,il,sl;return applyRenderContextCompatAliases((sl=(il=(el=this.backSurface)==null?void 0:el.getContextCompat)==null?void 0:il.call(el))!=null?sl:null)}getFrontSurface(){return this.frontSurface}getBackSurface(){return this.backSurface}blitBackToFront(el=this.getFrontCtx()){var il,sl;const nl=(il=this.frontSurface)==null?void 0:il.canvas,ol=(sl=this.backSurface)==null?void 0:sl.canvas;!el||!nl||!ol||ol===nl||typeof el.drawImage=="function"&&el.drawImage(ol,0,0)}adoptExternalContexts({frontCanvas:el,backCanvas:il,frontContext:sl,backContext:nl}){this._log("warn","adopting external contexts (legacy/webgl interoperability path)"),this.destroy(),this.mode="external",this.frontSurface=new Canvas2DSurface(el,sl),this.backSurface=new Canvas2DSurface(il,nl),this.getFrontCtx(),this.getBackCtx(),this._log("info","external contexts adopted",{sharedCanvas:el===il})}}const loggingMethods={logging_set_level(tl){this.debug_level=Number(tl)},logging(tl){if(tl>this.debug_level)return;function el(sl){let nl=[];for(let ol=1;ol<sl.length;ol++)typeof sl[ol]!="undefined"&&nl.push(sl[ol]);return nl}let il="debug";if(tl>=0&&tl<=4&&(il=["error","warn","info","log","debug"][tl]),typeof console[il]!="function")throw console.warn("[LG-log] invalid console method",il,el(arguments)),new RangeError;console[il]("[LG]",...el(arguments))},error(){this.logging(0,...arguments)},warn(){this.logging(1,...arguments)},info(){this.logging(2,...arguments)},log(){this.logging(3,...arguments)},debug(){this.logging(4,...arguments)}};let LiteGraph$5=null;function setNodeRegistryMethodsLiteGraph(tl){LiteGraph$5=tl}const nodeRegistryMethods={registerNodeType(tl,el){var il,sl,nl,ol,rl,al,ll;if(!el.prototype)throw new Error("Cannot register a simple object, it must be a class with a prototype");el.type=tl,(il=this.debug)==null||il.call(this,"registerNodeType","start",tl);const cl=el.name,ul=tl.lastIndexOf("/");el.category=tl.substring(0,ul),el.title||(el.title=cl);const dl=Object.getOwnPropertyDescriptors(LiteGraph$5.LGraphNode.prototype);Object.keys(dl).forEach(yl=>{el.prototype.hasOwnProperty(yl)||Object.defineProperty(el.prototype,yl,dl[yl])});const fl=this.registered_node_types[tl];if(fl&&((sl=this.debug)==null||sl.call(this,"registerNodeType","replacing node type",tl,fl)),!Object.prototype.hasOwnProperty.call(el.prototype,"shape")&&(Object.defineProperty(el.prototype,"shape",{set:function(yl){switch(yl){case"default":delete this._shape;break;case"box":this._shape=LiteGraph$5.BOX_SHAPE;break;case"round":this._shape=LiteGraph$5.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph$5.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph$5.CARD_SHAPE;break;default:this._shape=yl}},get:function(){return this._shape},enumerable:!0,configurable:!0}),el.supported_extensions))for(let yl in el.supported_extensions){const ml=el.supported_extensions[yl];ml&&ml.constructor===String&&(this.node_types_by_file_extension[ml.toLowerCase()]=el)}if(this.registered_node_types[tl]=el,el.constructor.name&&(this.Nodes[cl]=el),(nl=LiteGraph$5.onNodeTypeRegistered)==null||nl.call(LiteGraph$5,tl,el),fl&&((ol=LiteGraph$5.onNodeTypeReplaced)==null||ol.call(LiteGraph$5,tl,el,fl)),el.prototype.onPropertyChange&&LiteGraph$5.warn("LiteGraph node class "+tl+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),el.supported_extensions)for(var hl=0;hl<el.supported_extensions.length;hl++){var _l=el.supported_extensions[hl];_l&&_l.constructor===String&&(this.node_types_by_file_extension[_l.toLowerCase()]=el)}(rl=this.debug)==null||rl.call(this,"registerNodeType","type registered",tl),this.auto_load_slot_types&&((al=this.debug)==null||al.call(this,"registerNodeType","do auto_load_slot_types",tl)),new el((ll=el.title)!=null?ll:"tmpnode")},unregisterNodeType(tl){const el=tl.constructor===String?this.registered_node_types[tl]:tl;if(!el)throw new Error("node type not found: "+tl);delete this.registered_node_types[el.type],el.constructor.name&&delete this.Nodes[el.constructor.name]},clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod(tl,el){LiteGraph$5.LGraphNode.prototype[tl]=el;for(var il in this.registered_node_types){var sl=this.registered_node_types[il];sl.prototype[tl]&&(sl.prototype["_"+tl]=sl.prototype[tl]),sl.prototype[tl]=el}},reloadNodes(tl){var el,il,sl,nl=document.getElementsByTagName("script"),ol=[];for(let cl=0;cl<nl.length;cl++)ol.push(nl[cl]);var rl=document.getElementsByTagName("head")[0];tl=document.location.href+tl;for(let cl=0;cl<ol.length;cl++){var al=ol[cl].src;if(!(!al||al.substr(0,tl.length)!=tl))try{(el=this.log)==null||el.call(this,"Reloading: "+al);var ll=document.createElement("script");ll.type="text/javascript",ll.src=al,rl.appendChild(ll),rl.removeChild(ol[cl])}catch(ul){if(LiteGraph$5.throw_errors)throw ul;(il=this.log)==null||il.call(this,"Error while reloading "+al)}}(sl=this.log)==null||sl.call(this,"Nodes reloaded")}};let LiteGraph$4=null;function setNodeFactoryMethodsLiteGraph(tl){LiteGraph$4=tl}const nodeFactoryMethods={buildNodeClassFromObject(tl,el){var il="";if(el.inputs)for(let nl=0;nl<el.inputs.length;++nl){let ol=el.inputs[nl][0],rl=el.inputs[nl][1];rl&&rl.constructor===String&&(rl='"'+rl+'"'),il+="this.addInput('"+ol+"',"+rl+`);
`}if(el.outputs)for(let nl=0;nl<el.outputs.length;++nl){let ol=el.outputs[nl][0],rl=el.outputs[nl][1];rl&&rl.constructor===String&&(rl='"'+rl+'"'),il+="this.addOutput('"+ol+"',"+rl+`);
`}if(el.properties)for(let nl in el.properties){let ol=el.properties[nl];ol&&ol.constructor===String&&(ol='"'+ol+'"'),il+="this.addProperty('"+nl+"',"+ol+`);
`}il+="if(this.onCreate)this.onCreate()";var sl=Function(il);for(let nl in el)nl!="inputs"&&nl!="outputs"&&nl!="properties"&&(sl.prototype[nl]=el[nl]);return sl.title=el.title||tl.split("/").pop(),sl.desc=el.desc||"Generated from object",this.registerNodeType(tl,sl),sl},wrapFunctionAsNode(tl,el,il,sl,nl){const ol=LiteGraph$4.getParameterNames(el),rl=ol.map((ul,dl)=>{const fl=il!=null&&il[dl]?`'${il[dl]}'`:"0";return`this.addInput('${ul}', ${fl});`}).join(`
`),al=sl?`'${sl}'`:0,ll=nl?`this.properties = ${JSON.stringify(nl)};`:"",cl=new Function(`
            ${rl}
            this.addOutput('out', ${al});
            ${ll}
        `);return cl.title=tl.split("/").pop(),cl.desc=`Generated from ${el.name}`,cl.prototype.onExecute=function(){const ul=ol.map((fl,hl)=>this.getInputData(hl)),dl=el.apply(this,ul);this.setOutputData(0,dl)},this.registerNodeType(tl,cl),cl},createNode(tl,el,il={}){var sl,nl,ol,rl,al,ll,cl,ul,dl,fl,hl,_l;const yl=(sl=this.registered_node_types[tl])!=null?sl:null;if(!yl)return(nl=this.log)==null||nl.call(this,`GraphNode type "${tl}" not registered.`),null;el=(ol=el!=null?el:yl.title)!=null?ol:tl;let ml=null;if(LiteGraph$4.catch_exceptions)try{ml=new yl(el)}catch(Tl){return(rl=this.error)==null||rl.call(this,Tl),null}else ml=new yl(el);return ml.type=tl,(al=ml.title)!=null||(ml.title=el),(ll=ml.properties)!=null||(ml.properties={}),(cl=ml.properties_info)!=null||(ml.properties_info=[]),(ul=ml.flags)!=null||(ml.flags={}),(dl=ml.size)!=null||(ml.size=ml.computeSize()),(fl=ml.pos)!=null||(ml.pos=LiteGraph$4.DEFAULT_POSITION.concat()),(hl=ml.mode)!=null||(ml.mode=LiteGraph$4.ALWAYS),Object.assign(ml,il),(_l=ml.onNodeCreated)==null||_l.call(ml),ml},getNodeType(tl){return this.registered_node_types[tl]},getNodeTypesInCategory(tl,el){const il=Object.values(this.registered_node_types).filter(sl=>sl.filter!==el?!1:tl===""?sl.category===null:sl.category===tl);return this.auto_sort_node_types&&il.sort((sl,nl)=>sl.title.localeCompare(nl.title)),il},getNodeTypesCategories(tl){const el={"":1};Object.values(this.registered_node_types).forEach(sl=>{sl.category&&!sl.skip_list&&sl.filter===tl&&(el[sl.category]=1)});const il=Object.keys(el);return this.auto_sort_node_types?il.sort():il}},slotTypesMethods={registerNodeAndSlotType(tl,el,il=!1){const sl=(tl.constructor===String&&this.registered_node_types[tl]!=="anonymous"?this.registered_node_types[tl]:tl).constructor.type;let nl=[];typeof el=="string"?nl=el.split(","):el==this.EVENT||el==this.ACTION?nl=["_event_"]:nl=["*"];for(let ol=0;ol<nl.length;++ol){let rl=nl[ol];rl===""&&(rl="*");const al=il?"registered_slot_out_types":"registered_slot_in_types";this[al][rl]===void 0&&(this[al][rl]={nodes:[]}),this[al][rl].nodes.includes(sl)||this[al][rl].nodes.push(sl),il?this.slot_types_out.includes(rl.toLowerCase())||(this.slot_types_out.push(rl.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(rl.toLowerCase())||(this.slot_types_in.push(rl.toLowerCase()),this.slot_types_in.sort())}},registerSearchboxExtra(tl,el,il){this.searchbox_extras[el.toLowerCase()]={type:tl,desc:el,data:il}}};let LiteGraph$3=null;function setTypeCompatMethodsLiteGraph(tl){LiteGraph$3=tl}const typeCompatMethods={isValidConnection(tl,el){if((tl===""||tl==="*")&&(tl=0),(el===""||el==="*")&&(el=0),!tl||!el||tl===el||tl===LiteGraph$3.EVENT&&el===LiteGraph$3.ACTION)return!0;if(tl=String(tl).toLowerCase(),el=String(el).toLowerCase(),!tl.includes(",")&&!el.includes(","))return tl===el;const il=tl.split(","),sl=el.split(",");for(const nl of il)for(const ol of sl)if(this.isValidConnection(nl,ol))return!0;return!1}};let LiteGraph$2=null;function setFileUtilsMethodsLiteGraph(tl){LiteGraph$2=tl}const fileUtilsMethods={fetchFile(tl,el,il,sl){if(!tl)return null;if(el=el||"text",tl.constructor===String)return tl.substr(0,4)=="http"&&LiteGraph$2.proxy&&(tl=LiteGraph$2.proxy+tl.substr(tl.indexOf(":")+3)),fetch(tl).then(ol=>{if(!ol.ok)throw new Error("File not found");if(el=="arraybuffer")return ol.arrayBuffer();if(el=="text"||el=="string")return ol.text();if(el=="json")return ol.json();if(el=="blob")return ol.blob()}).then(ol=>{il&&il(ol)}).catch(ol=>{var rl;(rl=this.error)==null||rl.call(this,"error fetching file:",tl),sl&&sl(ol)});if(tl.constructor===File||tl.constructor===Blob){var nl=new FileReader;if(nl.onload=ol=>{var rl=ol.target.result;el=="json"&&(rl=JSON.parse(rl)),il&&il(rl)},el=="arraybuffer")return nl.readAsArrayBuffer(tl);if(el=="text"||el=="json")return nl.readAsText(tl);if(el=="blob")return nl.readAsBinaryString(tl)}return null}},pointerEventsMethods={applyPointerDefaults(){typeof window=="undefined"||typeof window.matchMedia!="function"||window.matchMedia("(pointer: coarse)").matches&&(this.dialog_close_on_mouse_leave=!1,this.search_hide_on_mouse_leave=!1)},resolvePointerEventName(tl){if(typeof tl!="string")return tl;const el=tl.toLowerCase(),il=this.pointerevents_method;return il==="mouse"?this.pointer_to_mouse_events[el]||el:il==="pointer"&&this.mouse_to_pointer_events[el]||el},pointerAddListener(tl,el,il,sl){if(!(tl!=null&&tl.addEventListener)||typeof il!="function")return!1;const nl=this.resolvePointerEventName(el);return tl.addEventListener(nl,il,sl),!0},pointerRemoveListener(tl,el,il,sl){if(!(tl!=null&&tl.removeEventListener)||typeof il!="function")return!1;const nl=this.resolvePointerEventName(el);return tl.removeEventListener(nl,il,sl),!0},set pointerevents_method(tl){const el=typeof tl=="string"?tl.toLowerCase():"";if(el==="mouse"||el==="pointer"){this._pointerevents_method=el;return}this._pointerevents_method="pointer"},get pointerevents_method(){return this._pointerevents_method||"pointer"}},objectUtilsMethods={cloneObject(tl,el){if(tl==null)return null;const il=JSON.parse(JSON.stringify(tl));if(!el)return il;for(const sl in il)Object.prototype.hasOwnProperty.call(il,sl)&&(el[sl]=il[sl]);return el},uuidv4(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,tl=>(tl^Math.random()*16>>tl/4).toString(16))},compareObjects(tl,el){const il=Object.keys(tl);return il.length!==Object.keys(el).length?!1:il.every(sl=>tl[sl]===el[sl])}},mathColorUtilsMethods={distance(tl,el){const[il,sl]=tl,[nl,ol]=el;return Math.sqrt((nl-il)**2+(ol-sl)**2)},colorToString(tl){return"rgba("+Math.round(tl[0]*255).toFixed()+","+Math.round(tl[1]*255).toFixed()+","+Math.round(tl[2]*255).toFixed()+","+(tl.length==4?tl[3].toFixed(2):"1.0")+")"},isInsideRectangle(tl,el,il,sl,nl,ol){return tl>il&&tl<il+nl&&el>sl&&el<sl+ol},growBounding(tl,el,il){el<tl[0]?tl[0]=el:el>tl[2]&&(tl[2]=el),il<tl[1]?tl[1]=il:il>tl[3]&&(tl[3]=il)},isInsideBounding(tl,el){return tl[0]>=el[0][0]&&tl[1]>=el[0][1]&&tl[0]<=el[1][0]&&tl[1]<=el[1][1]},overlapBounding(tl,el){const il=tl[0]+tl[2],sl=tl[1]+tl[3],nl=el[0]+el[2],ol=el[1]+el[3];return!(tl[0]>nl||tl[1]>ol||il<el[0]||sl<el[1])},hex2num(tl){tl.charAt(0)=="#"&&(tl=tl.slice(1)),tl=tl.toUpperCase();for(var el="0123456789ABCDEF",il=new Array(3),sl=0,nl,ol,rl=0;rl<6;rl+=2)nl=el.indexOf(tl.charAt(rl)),ol=el.indexOf(tl.charAt(rl+1)),il[sl]=nl*16+ol,sl++;return il},num2hex(tl){for(var el="0123456789ABCDEF",il="#",sl,nl,ol=0;ol<3;ol++)sl=tl[ol]/16,nl=tl[ol]%16,il+=el.charAt(sl)+el.charAt(nl);return il},clamp:(tl,el,il)=>el>tl?el:il<tl?il:tl},canvasTextUtilsMethods={canvasFillTextMultiline(tl,el,il,sl,nl,ol){var rl=(el+"").trim().split(" "),al="",ll={lines:[],maxW:0,height:0};if(rl.length>1)for(var cl=0;cl<rl.length;cl++){var ul=al+rl[cl]+" ",dl=tl.measureText(ul),fl=dl.width;fl>nl&&cl>0?(tl.fillText(al,il,sl+ol*ll.lines.length),al=rl[cl]+" ",ll.max=fl,ll.lines.push(al)):al=ul}else al=rl[0];return tl.fillText(al,il,sl+ol*ll.lines.length),ll.lines.push(al),ll.height=ol*ll.lines.length||ol,ll}},classUtilsMethods={extendClass:(tl,el)=>{for(let il in el)tl.hasOwnProperty(il)||(tl[il]=el[il]);if(el.prototype)for(let il in el.prototype)el.prototype.hasOwnProperty(il)&&(tl.prototype.hasOwnProperty(il)||(el.prototype.__lookupGetter__(il)?tl.prototype.__defineGetter__(il,el.prototype.__lookupGetter__(il)):tl.prototype[il]=el.prototype[il],el.prototype.__lookupSetter__(il)&&tl.prototype.__defineSetter__(il,el.prototype.__lookupSetter__(il))))},getParameterNames:tl=>(tl+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)};let LiteGraph$1=null;function setLegacyCompatMethodsLiteGraph(tl){LiteGraph$1=tl}const legacyCompatMethods={closeAllContextMenus:()=>{LiteGraph$1.warn("LiteGraph.closeAllContextMenus is deprecated in favor of LiteGraph.ContextMenu.closeAll()"),LiteGraph$1.ContextMenu.closeAll()}};function installLiteGraphDelegates(tl){const el=Object.getPrototypeOf(tl);el.__litegraph_delegates_installed||(setNodeRegistryMethodsLiteGraph(tl),setNodeFactoryMethodsLiteGraph(tl),setTypeCompatMethodsLiteGraph(tl),setFileUtilsMethodsLiteGraph(tl),setLegacyCompatMethodsLiteGraph(tl),[loggingMethods,nodeRegistryMethods,nodeFactoryMethods,slotTypesMethods,typeCompatMethods,fileUtilsMethods,pointerEventsMethods,objectUtilsMethods,mathColorUtilsMethods,canvasTextUtilsMethods,classUtilsMethods,legacyCompatMethods].forEach(il=>{const sl=Object.getOwnPropertyDescriptors(il);delete sl.__proto__,Object.entries(sl).forEach(([nl,ol])=>{Object.defineProperty(el,nl,{...ol,configurable:!0})})}),Object.defineProperty(el,"__litegraph_delegates_installed",{value:!0,writable:!1,enumerable:!1,configurable:!1}))}function applyCoreDefaults(tl){tl.VERSION="0.10.2",tl.CANVAS_GRID_SIZE=10,tl.NODE_TITLE_HEIGHT=30,tl.NODE_TITLE_TEXT_Y=20,tl.NODE_SLOT_HEIGHT=20,tl.NODE_WIDGET_HEIGHT=20,tl.NODE_WIDTH=140,tl.NODE_MIN_WIDTH=50,tl.NODE_COLLAPSED_RADIUS=10,tl.NODE_COLLAPSED_WIDTH=80,tl.NODE_TITLE_COLOR="#999",tl.NODE_SELECTED_TITLE_COLOR="#FFF",tl.NODE_TEXT_SIZE=14,tl.NODE_TEXT_COLOR="#AAA",tl.NODE_SUBTEXT_SIZE=12,tl.NODE_DEFAULT_COLOR="#333",tl.NODE_DEFAULT_BGCOLOR="#353535",tl.NODE_DEFAULT_BOXCOLOR="#666",tl.NODE_DEFAULT_SHAPE="box",tl.NODE_BOX_OUTLINE_COLOR="#FFF",tl.DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)",tl.DEFAULT_GROUP_FONT=24,tl.WIDGET_BGCOLOR="#222",tl.WIDGET_OUTLINE_COLOR="#666",tl.WIDGET_TEXT_COLOR="#DDD",tl.WIDGET_SECONDARY_TEXT_COLOR="#999",tl.LINK_COLOR="#9A9",tl.EVENT_LINK_COLOR="#A86",tl.CONNECTING_LINK_COLOR="#AFA",tl.MAX_NUMBER_OF_NODES=1e3,tl.DEFAULT_POSITION=[100,100],tl.VALID_SHAPES=["default","box","round","card"],tl.BOX_SHAPE=1,tl.ROUND_SHAPE=2,tl.CIRCLE_SHAPE=3,tl.CARD_SHAPE=4,tl.ARROW_SHAPE=5,tl.GRID_SHAPE=6,tl.INPUT=1,tl.OUTPUT=2,tl.EVENT=-1,tl.ACTION=-1,tl.NODE_MODES=["Always","On Event","Never","On Trigger","On Request"],tl.NODE_MODES_COLORS=["#666","#422","#333","#224","#626"],tl.ALWAYS=0,tl.ON_EVENT=1,tl.NEVER=2,tl.ON_TRIGGER=3,tl.ON_REQUEST=4,tl.UP=1,tl.DOWN=2,tl.LEFT=3,tl.RIGHT=4,tl.CENTER=5,tl.LINK_RENDER_MODES=["Straight","Linear","Spline"],tl.STRAIGHT_LINK=0,tl.LINEAR_LINK=1,tl.SPLINE_LINK=2,tl.NORMAL_TITLE=0,tl.NO_TITLE=1,tl.TRANSPARENT_TITLE=2,tl.AUTOHIDE_TITLE=3,tl.VERTICAL_LAYOUT="vertical",tl.proxy=null,tl.node_images_path="",tl.catch_exceptions=!0,tl.throw_errors=!0,tl.allow_scripts=!1,tl.use_deferred_actions=!0,tl.registered_node_types={},tl.node_types_by_file_extension={},tl.Nodes={},tl.Globals={}}function applyUiDefaults(tl){tl.searchbox_extras={},tl.auto_sort_node_types=!1,tl.node_box_coloured_when_on=!1,tl.node_box_coloured_by_mode=!1,tl.dialog_close_on_mouse_leave=!0,tl.dialog_close_on_mouse_leave_delay=500,tl.search_hide_on_mouse_leave=!0,tl.search_filter_enabled=!1,tl.search_show_all_on_open=!0,tl.show_node_tooltip=!1,tl.show_node_tooltip_use_descr_property=!1,tl.showCanvasOptions=!1,tl.availableCanvasOptions=["allow_addOutSlot_onExecuted","free_resize","highquality_render","use_gradients","pause_rendering","clear_background","read_only","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","move_destination_link_without_shift","set_canvas_dirty_on_mouse_event","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip"]}function applyBehaviorDefaults(tl){tl.shift_click_do_break_link_from=!1,tl.click_do_break_link_to=!1,tl.pointer_to_mouse_events=Object.freeze({pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mouseup",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"}),tl.mouse_to_pointer_events=Object.freeze({mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseenter:"pointerenter",mouseleave:"pointerleave"}),tl.applyPointerDefaults(),tl.alt_drag_do_clone_nodes=!1,tl.alt_shift_drag_connect_clone_with_input=!0,tl.do_add_triggers_slots=!1,tl.allow_multi_output_for_events=!0,tl.middle_click_slot_add_default_node=!1,tl.release_link_on_empty_shows_menu=!1,tl.two_fingers_opens_menu=!1,tl.backspace_delete=!0,tl.ctrl_shift_v_paste_connect_unselected_outputs=!1,tl.actionHistory_enabled=!1,tl.actionHistoryMaxSave=40,tl.refreshAncestorsOnTriggers=!1,tl.refreshAncestorsOnActions=!1,tl.ensureUniqueExecutionAndActionCall=!1,tl.use_uuids=!1,tl.context_menu_filter_enabled=!1,tl.actionHistoryMaxSave=40,tl.canRemoveSlots=!0,tl.canRemoveSlots_onlyOptional=!0,tl.canRenameSlots=!0,tl.canRenameSlots_onlyOptional=!0,tl.ensureNodeSingleExecution=!1,tl.ensureNodeSingleAction=!1,tl.preventAncestorRecalculation=!1,tl.ensureUniqueExecutionAndActionCall=!0,tl.allowMultiOutputForEvents=!1,tl.log_methods=["error","warn","info","log","debug"]}function applySlotsDefaults(tl){tl.auto_load_slot_types=!1,tl.registered_slot_in_types={},tl.registered_slot_out_types={},tl.slot_types_in=[],tl.slot_types_out=[],tl.slot_types_default_in=[],tl.slot_types_default_out=[],tl.graphDefaultConfig={align_to_grid:!0,links_ontop:!1}}var LiteGraph=new class{constructor(){this.LLink=LLink,this.LGraph=LGraph,setupLGraphDelegates(this),this.LGraphNode=LGraphNode,setupLGraphNodeDelegates(this),this.LGraphGroup=LGraphGroup,this.LGraphCanvas=LGraphCanvas,this.Canvas2DRendererAdapter=Canvas2DRendererAdapter,this.LeaferUIRendererAdapter=LeaferUIRendererAdapter,this.DragAndScale=DragAndScale,this.ContextMenu=ContextMenu,installLiteGraphDelegates(this),applyCoreDefaults(this),applyUiDefaults(this),applyBehaviorDefaults(this),applySlotsDefaults(this),this.logging_set_level(2)}};typeof performance!="undefined"?LiteGraph.getTime=performance.now.bind(performance):typeof Date!="undefined"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process!="undefined"?LiteGraph.getTime=()=>{var tl=process.hrtime();return tl[0]*.001+tl[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()},typeof window!="undefined"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||(tl=>{window.setTimeout(tl,1e3/60)})),typeof globalThis!="undefined"&&!globalThis.LeaferUI&&(globalThis.LeaferUI=LeaferUIRuntime);export{ContextMenu,DragAndScale,LGraph,LGraphCanvas,LGraphGroup,LGraphNode,LLink,LiteGraph};
