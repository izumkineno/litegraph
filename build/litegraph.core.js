var Dh=Object.defineProperty,Lh=$h=>{throw TypeError($h)},Ih=($h,Th,Fh)=>Th in $h?Dh($h,Th,{enumerable:!0,configurable:!0,writable:!0,value:Fh}):$h[Th]=Fh,Yl=($h,Th,Fh)=>Ih($h,typeof Th!="symbol"?Th+"":Th,Fh),Mh=($h,Th,Fh)=>Th.has($h)||Lh("Cannot "+Fh),Sh=($h,Th,Fh)=>Th.has($h)?Lh("Cannot add the same private member more than once"):Th instanceof WeakSet?Th.add($h):Th.set($h,Fh),Vl=($h,Th,Fh)=>(Mh($h,Th,"access private method"),Fh),t;(function($h){$h[$h.No=0]="No",$h[$h.Yes=1]="Yes",$h[$h.NoAndSkip=2]="NoAndSkip",$h[$h.YesAndSkip=3]="YesAndSkip"})(t||(t={}));const e$1={};function s($h){return $h===void 0}function r($h){return $h==null}function i($h){return typeof $h=="string"}const{isFinite:n}=Number;function o($h){return typeof $h=="number"}const a=/^-?\d+(?:\.\d+)?$/;function h($h){return typeof $h=="string"&&a.test($h)?+$h:$h}const{isArray:l}=Array;function d($h){return $h&&typeof $h=="object"}function c($h){return d($h)&&!l($h)}function u($h){return JSON.stringify($h)==="{}"}const _={default:($h,Th)=>(p(Th,$h),p($h,Th),$h),assign($h,Th,Fh){let Wh;Object.keys(Th).forEach(zh=>{var Hh,Uh;if(Wh=Th[zh],(Wh==null?void 0:Wh.constructor)===Object&&((Hh=$h[zh])===null||Hh===void 0?void 0:Hh.constructor)===Object)return p($h[zh],Th[zh],Fh&&Fh[zh]);Fh&&zh in Fh?((Uh=Fh[zh])===null||Uh===void 0?void 0:Uh.constructor)===Object&&p($h[zh]={},Th[zh],Fh[zh]):$h[zh]=Th[zh]})},copyAttrs:($h,Th,Fh)=>(Fh.forEach(Wh=>{s(Th[Wh])||($h[Wh]=Th[Wh])}),$h),clone:$h=>JSON.parse(JSON.stringify($h)),toMap($h){const Th={};for(let Fh=0,Wh=$h.length;Fh<Wh;Fh++)Th[$h[Fh]]=!0;return Th},stintSet($h,Th,Fh){Fh||(Fh=void 0),$h[Th]!==Fh&&($h[Th]=Fh)}},{assign:p}=_;class f{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:Th}=this;return Th&&Th.length===6&&Th[0]===1}get __usePathBox(){return this.__pathInputed}get __blendMode(){if(this.eraser&&this.eraser!=="path")return"destination-out";const{blendMode:Th}=this;return Th==="pass-through"?null:Th}constructor(Th){this.__leaf=Th}__get(Th){if(this.__input){const Fh=this.__input[Th];if(!s(Fh))return Fh}return this[Th]}__getData(){const Th={tag:this.__leaf.tag},{__input:Fh}=this;let Wh;for(let zh in this)zh[0]!=="_"&&(Wh=Fh?Fh[zh]:void 0,Th[zh]=s(Wh)?this[zh]:Wh);return Th}__setInput(Th,Fh){this.__input||(this.__input={}),this.__input[Th]=Fh}__getInput(Th){if(this.__input){const Fh=this.__input[Th];if(!s(Fh))return Fh}if(Th!=="path"||this.__pathInputed)return this["_"+Th]}__removeInput(Th){this.__input&&!s(this.__input[Th])&&(this.__input[Th]=void 0)}__getInputData(Th,Fh){const Wh={};if(Th)if(l(Th))for(let zh of Th)Wh[zh]=this.__getInput(zh);else for(let zh in Th)Wh[zh]=this.__getInput(zh);else{let zh,Hh,{__input:Uh}=this;Wh.tag=this.__leaf.tag;for(let Yh in this)if(Yh[0]!=="_"&&(zh=this["_"+Yh],!s(zh))){if(Yh==="path"&&!this.__pathInputed)continue;Hh=Uh?Uh[Yh]:void 0,Wh[Yh]=s(Hh)?zh:Hh}}if(Fh&&Fh.matrix){const{a:zh,b:Hh,c:Uh,d:Yh,e:Xh,f:jh}=this.__leaf.__localMatrix;Wh.matrix={a:zh,b:Hh,c:Uh,d:Yh,e:Xh,f:jh}}return Wh}__setMiddle(Th,Fh){this.__middle||(this.__middle={}),this.__middle[Th]=Fh}__getMiddle(Th){return this.__middle&&this.__middle[Th]}__checkSingle(){const Th=this;if(Th.blendMode==="pass-through"){const Fh=this.__leaf;Th.opacity<1&&(Fh.isBranch||Th.__hasMultiPaint)||Fh.__hasEraser||Th.eraser||Th.filter?Th.__single=!0:Th.__single&&(Th.__single=!1)}else Th.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}const g={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create($h){const{types:Th}=y;return Th[$h]?Th[$h]++:(Th[$h]=1,0)}},y=g;let m,x,w;const{max:b}=Math,B=[0,0,0,0],v={zero:[...B],tempFour:B,set:($h,Th,Fh,Wh,zh)=>(Fh===void 0&&(Fh=Wh=zh=Th),$h[0]=Th,$h[1]=Fh,$h[2]=Wh,$h[3]=zh,$h),setTemp:($h,Th,Fh,Wh)=>k(B,$h,Th,Fh,Wh),toTempAB($h,Th,Fh){w=Fh?o($h)?Th:$h:[],o($h)?(m=O($h),x=Th):o(Th)?(m=$h,x=O(Th)):(m=$h,x=Th),m.length!==4&&(m=C(m)),x.length!==4&&(x=C(x))},get($h,Th){let Fh;if(!o($h))switch($h.length){case 4:Fh=s(Th)?$h:[...$h];break;case 2:Fh=[$h[0],$h[1],$h[0],$h[1]];break;case 3:Fh=[$h[0],$h[1],$h[2],$h[1]];break;case 1:$h=$h[0];break;default:$h=0}if(Fh||(Fh=[$h,$h,$h,$h]),!s(Th))for(let Wh=0;Wh<4;Wh++)Fh[Wh]>Th&&(Fh[Wh]=Th);return Fh},max:($h,Th,Fh)=>o($h)&&o(Th)?b($h,Th):(T($h,Th,Fh),k(w,b(m[0],x[0]),b(m[1],x[1]),b(m[2],x[2]),b(m[3],x[3]))),add:($h,Th,Fh)=>o($h)&&o(Th)?$h+Th:(T($h,Th,Fh),k(w,m[0]+x[0],m[1]+x[1],m[2]+x[2],m[3]+x[3])),swapAndScale($h,Th,Fh,Wh){if(o($h))return Th===Fh?$h*Th:[$h*Fh,$h*Th];const zh=Wh?$h:[],[Hh,Uh,Yh,Xh]=$h.length===4?$h:C($h);return k(zh,Yh*Fh,Xh*Th,Hh*Fh,Uh*Th)}},{set:k,get:C,setTemp:O,toTempAB:T}=v,{round:P,pow:S,max:L,floor:R,PI:E}=Math,I$1={within:($h,Th,Fh)=>(d(Th)&&(Fh=Th.max,Th=Th.min),!s(Th)&&$h<Th&&($h=Th),!s(Fh)&&$h>Fh&&($h=Fh),$h),fourNumber:v.get,formatRotation:($h,Th)=>($h%=360,Th?$h<0&&($h+=360):($h>180&&($h-=360),$h<-180&&($h+=360)),I$1.float($h)),getGapRotation($h,Th,Fh=0){let Wh=$h+Fh;if(Th>1){const zh=Math.abs(Wh%Th);(zh<1||zh>Th-1)&&(Wh=Math.round(Wh/Th)*Th)}return Wh-Fh},float($h,Th){const Fh=s(Th)?1e12:S(10,Th);return($h=P($h*Fh)/Fh)===-0?0:$h},sign:$h=>$h<0?-1:1,getScaleData($h,Th,Fh,Wh){if(Wh||(Wh={}),Th){const zh=(o(Th)?Th:Th.width||0)/Fh.width,Hh=(o(Th)?Th:Th.height||0)/Fh.height;Wh.scaleX=zh||Hh||1,Wh.scaleY=Hh||zh||1}else $h&&I$1.assignScale(Wh,$h);return Wh},assignScale($h,Th){o(Th)?$h.scaleX=$h.scaleY=Th:($h.scaleX=Th.x,$h.scaleY=Th.y)},getFloorScale:($h,Th=1)=>L(R($h),Th)/$h,randInt:M,randColor:$h=>`rgba(${M(255)},${M(255)},${M(255)},${$h||1})`};function M($h){return Math.round(Math.random()*$h)}const A=E/180,W$1=2*E,N$1=E/2;function Y$1(){return{x:0,y:0}}function D(){return{x:0,y:0,width:0,height:0}}function X$1(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:z$1,cos:F$1,acos:U$1,sqrt:j$1}=Math,{float:V$1}=I$1,H={};function G$1(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const q$1={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:G$1(),tempMatrix:{},set($h,Th=1,Fh=0,Wh=0,zh=1,Hh=0,Uh=0){$h.a=Th,$h.b=Fh,$h.c=Wh,$h.d=zh,$h.e=Hh,$h.f=Uh},get:X$1,getWorld:G$1,copy($h,Th){$h.a=Th.a,$h.b=Th.b,$h.c=Th.c,$h.d=Th.d,$h.e=Th.e,$h.f=Th.f},translate($h,Th,Fh){$h.e+=Th,$h.f+=Fh},translateInner($h,Th,Fh,Wh){$h.e+=$h.a*Th+$h.c*Fh,$h.f+=$h.b*Th+$h.d*Fh,Wh&&($h.e-=Th,$h.f-=Fh)},scale($h,Th,Fh=Th){$h.a*=Th,$h.b*=Th,$h.c*=Fh,$h.d*=Fh},pixelScale($h,Th,Fh){Fh||(Fh=$h),Fh.a=$h.a*Th,Fh.b=$h.b*Th,Fh.c=$h.c*Th,Fh.d=$h.d*Th,Fh.e=$h.e*Th,Fh.f=$h.f*Th},scaleOfOuter($h,Th,Fh,Wh){Q$1.toInnerPoint($h,Th,H),Q$1.scaleOfInner($h,H,Fh,Wh)},scaleOfInner($h,Th,Fh,Wh=Fh){Q$1.translateInner($h,Th.x,Th.y),Q$1.scale($h,Fh,Wh),Q$1.translateInner($h,-Th.x,-Th.y)},rotate($h,Th){const{a:Fh,b:Wh,c:zh,d:Hh}=$h,Uh=F$1(Th*=A),Yh=z$1(Th);$h.a=Fh*Uh-Wh*Yh,$h.b=Fh*Yh+Wh*Uh,$h.c=zh*Uh-Hh*Yh,$h.d=zh*Yh+Hh*Uh},rotateOfOuter($h,Th,Fh){Q$1.toInnerPoint($h,Th,H),Q$1.rotateOfInner($h,H,Fh)},rotateOfInner($h,Th,Fh){Q$1.translateInner($h,Th.x,Th.y),Q$1.rotate($h,Fh),Q$1.translateInner($h,-Th.x,-Th.y)},skew($h,Th,Fh){const{a:Wh,b:zh,c:Hh,d:Uh}=$h;Fh&&(Fh*=A,$h.a=Wh+Hh*Fh,$h.b=zh+Uh*Fh),Th&&(Th*=A,$h.c=Hh+Wh*Th,$h.d=Uh+zh*Th)},skewOfOuter($h,Th,Fh,Wh){Q$1.toInnerPoint($h,Th,H),Q$1.skewOfInner($h,H,Fh,Wh)},skewOfInner($h,Th,Fh,Wh=0){Q$1.translateInner($h,Th.x,Th.y),Q$1.skew($h,Fh,Wh),Q$1.translateInner($h,-Th.x,-Th.y)},multiply($h,Th){const{a:Fh,b:Wh,c:zh,d:Hh,e:Uh,f:Yh}=$h;$h.a=Th.a*Fh+Th.b*zh,$h.b=Th.a*Wh+Th.b*Hh,$h.c=Th.c*Fh+Th.d*zh,$h.d=Th.c*Wh+Th.d*Hh,$h.e=Th.e*Fh+Th.f*zh+Uh,$h.f=Th.e*Wh+Th.f*Hh+Yh},multiplyParent($h,Th,Fh,Wh,zh){const{e:Hh,f:Uh}=$h;if(Fh||(Fh=$h),s(Wh)&&(Wh=$h.a!==1||$h.b||$h.c||$h.d!==1),Wh){const{a:Yh,b:Xh,c:jh,d:qh}=$h;Fh.a=Yh*Th.a+Xh*Th.c,Fh.b=Yh*Th.b+Xh*Th.d,Fh.c=jh*Th.a+qh*Th.c,Fh.d=jh*Th.b+qh*Th.d,zh&&(Fh.scaleX=Th.scaleX*zh.scaleX,Fh.scaleY=Th.scaleY*zh.scaleY)}else Fh.a=Th.a,Fh.b=Th.b,Fh.c=Th.c,Fh.d=Th.d,zh&&(Fh.scaleX=Th.scaleX,Fh.scaleY=Th.scaleY);Fh.e=Hh*Th.a+Uh*Th.c+Th.e,Fh.f=Hh*Th.b+Uh*Th.d+Th.f},divide($h,Th){Q$1.multiply($h,Q$1.tempInvert(Th))},divideParent($h,Th){Q$1.multiplyParent($h,Q$1.tempInvert(Th))},tempInvert($h){const{tempMatrix:Th}=Q$1;return Q$1.copy(Th,$h),Q$1.invert(Th),Th},invert($h){const{a:Th,b:Fh,c:Wh,d:zh,e:Hh,f:Uh}=$h;if(Fh||Wh){const Yh=1/(Th*zh-Fh*Wh);$h.a=zh*Yh,$h.b=-Fh*Yh,$h.c=-Wh*Yh,$h.d=Th*Yh,$h.e=-(Hh*zh-Uh*Wh)*Yh,$h.f=-(Uh*Th-Hh*Fh)*Yh}else if(Th===1&&zh===1)$h.e=-Hh,$h.f=-Uh;else{const Yh=1/(Th*zh);$h.a=zh*Yh,$h.d=Th*Yh,$h.e=-Hh*zh*Yh,$h.f=-Uh*Th*Yh}},toOuterPoint($h,Th,Fh,Wh){const{x:zh,y:Hh}=Th;Fh||(Fh=Th),Fh.x=zh*$h.a+Hh*$h.c,Fh.y=zh*$h.b+Hh*$h.d,Wh||(Fh.x+=$h.e,Fh.y+=$h.f)},toInnerPoint($h,Th,Fh,Wh){const{a:zh,b:Hh,c:Uh,d:Yh}=$h,Xh=1/(zh*Yh-Hh*Uh),{x:jh,y:qh}=Th;if(Fh||(Fh=Th),Fh.x=(jh*Yh-qh*Uh)*Xh,Fh.y=(qh*zh-jh*Hh)*Xh,!Wh){const{e:Vh,f:Zh}=$h;Fh.x-=(Vh*Yh-Zh*Uh)*Xh,Fh.y-=(Zh*zh-Vh*Hh)*Xh}},setLayout($h,Th,Fh,Wh,zh){const{x:Hh,y:Uh,scaleX:Yh,scaleY:Xh}=Th;if(s(zh)&&(zh=Th.rotation||Th.skewX||Th.skewY),zh){const{rotation:jh,skewX:qh,skewY:Vh}=Th,Zh=jh*A,Kh=F$1(Zh),Qh=z$1(Zh);if(qh||Vh){const Jh=qh*A,td=Vh*A;$h.a=(Kh+td*-Qh)*Yh,$h.b=(Qh+td*Kh)*Yh,$h.c=(Jh*Kh-Qh)*Xh,$h.d=(Kh+Jh*Qh)*Xh}else $h.a=Kh*Yh,$h.b=Qh*Yh,$h.c=-Qh*Xh,$h.d=Kh*Xh}else $h.a=Yh,$h.b=0,$h.c=0,$h.d=Xh;$h.e=Hh,$h.f=Uh,(Fh=Fh||Wh)&&Q$1.translateInner($h,-Fh.x,-Fh.y,!Wh)},getLayout($h,Th,Fh,Wh){const{a:zh,b:Hh,c:Uh,d:Yh,e:Xh,f:jh}=$h;let qh,Vh,Zh,Kh,Qh,Jh=Xh,td=jh;if(Hh||Uh){const ed=zh*Yh-Hh*Uh;if(Uh&&!Wh){qh=j$1(zh*zh+Hh*Hh),Vh=ed/qh;const nd=zh/qh;Zh=Hh>0?U$1(nd):-U$1(nd)}else{Vh=j$1(Uh*Uh+Yh*Yh),qh=ed/Vh;const nd=Uh/Vh;Zh=N$1-(Yh>0?U$1(-nd):-U$1(nd))}const id=V$1(F$1(Zh)),sd=z$1(Zh);qh=V$1(qh),Vh=V$1(Vh),Kh=id?V$1((Uh/Vh+sd)/id/A,9):0,Qh=id?V$1((Hh/qh-sd)/id/A,9):0,Zh=V$1(Zh/A)}else qh=zh,Vh=Yh,Zh=Kh=Qh=0;return(Th=Fh||Th)&&(Jh+=Th.x*zh+Th.y*Uh,td+=Th.x*Hh+Th.y*Yh,Fh||(Jh-=Th.x,td-=Th.y)),{x:Jh,y:td,scaleX:qh,scaleY:Vh,rotation:Zh,skewX:Kh,skewY:Qh}},withScale($h,Th,Fh=Th){const Wh=$h;if(!Th||!Fh){const{a:zh,b:Hh,c:Uh,d:Yh}=$h;Hh||Uh?Fh=(zh*Yh-Hh*Uh)/(Th=j$1(zh*zh+Hh*Hh)):(Th=zh,Fh=Yh)}return Wh.scaleX=Th,Wh.scaleY=Fh,Wh},reset($h){Q$1.set($h)}},Q$1=q$1,{float:J$2}=I$1,{toInnerPoint:Z$2,toOuterPoint:$$1}=q$1,{sin:K$1,cos:tt$2,abs:et$2,sqrt:st$2,atan2:rt$2,min:it$2,round:nt$2}=Math,ot$2={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set($h,Th=0,Fh=0){$h.x=Th,$h.y=Fh},setRadius($h,Th,Fh){$h.radiusX=Th,$h.radiusY=s(Fh)?Th:Fh},copy($h,Th){$h.x=Th.x,$h.y=Th.y},copyFrom($h,Th,Fh){$h.x=Th,$h.y=Fh},round($h,Th){$h.x=Th?nt$2($h.x-.5)+.5:nt$2($h.x),$h.y=Th?nt$2($h.y-.5)+.5:nt$2($h.y)},move($h,Th,Fh){d(Th)?($h.x+=Th.x,$h.y+=Th.y):($h.x+=Th,$h.y+=Fh)},scale($h,Th,Fh=Th){$h.x&&($h.x*=Th),$h.y&&($h.y*=Fh)},scaleOf($h,Th,Fh,Wh=Fh){$h.x+=($h.x-Th.x)*(Fh-1),$h.y+=($h.y-Th.y)*(Wh-1)},rotate($h,Th,Fh){Fh||(Fh=at$2.defaultPoint);const Wh=tt$2(Th*=A),zh=K$1(Th),Hh=$h.x-Fh.x,Uh=$h.y-Fh.y;$h.x=Fh.x+Hh*Wh-Uh*zh,$h.y=Fh.y+Hh*zh+Uh*Wh},tempToInnerOf($h,Th){const{tempPoint:Fh}=at$2;return lt$2(Fh,$h),Z$2(Th,Fh,Fh),Fh},tempToOuterOf($h,Th){const{tempPoint:Fh}=at$2;return lt$2(Fh,$h),$$1(Th,Fh,Fh),Fh},tempToInnerRadiusPointOf($h,Th){const{tempRadiusPoint:Fh}=at$2;return lt$2(Fh,$h),at$2.toInnerRadiusPointOf($h,Th,Fh),Fh},copyRadiusPoint:($h,Th,Fh,Wh)=>(lt$2($h,Th),dt$2($h,Fh,Wh),$h),toInnerRadiusPointOf($h,Th,Fh){Fh||(Fh=$h),Z$2(Th,$h,Fh),Fh.radiusX=Math.abs($h.radiusX/Th.scaleX),Fh.radiusY=Math.abs($h.radiusY/Th.scaleY)},toInnerOf($h,Th,Fh){Z$2(Th,$h,Fh)},toOuterOf($h,Th,Fh){$$1(Th,$h,Fh)},getCenter:($h,Th)=>({x:$h.x+(Th.x-$h.x)/2,y:$h.y+(Th.y-$h.y)/2}),getCenterX:($h,Th)=>$h+(Th-$h)/2,getCenterY:($h,Th)=>$h+(Th-$h)/2,getDistance:($h,Th)=>ht$2($h.x,$h.y,Th.x,Th.y),getDistanceFrom($h,Th,Fh,Wh){const zh=et$2(Fh-$h),Hh=et$2(Wh-Th);return st$2(zh*zh+Hh*Hh)},getMinDistanceFrom:($h,Th,Fh,Wh,zh,Hh)=>it$2(ht$2($h,Th,Fh,Wh),ht$2(Fh,Wh,zh,Hh)),getAngle:($h,Th)=>ct$2($h,Th)/A,getRotation:($h,Th,Fh,Wh)=>(Wh||(Wh=Th),at$2.getRadianFrom($h.x,$h.y,Th.x,Th.y,Fh.x,Fh.y,Wh.x,Wh.y)/A),getRadianFrom($h,Th,Fh,Wh,zh,Hh,Uh,Yh){s(Uh)&&(Uh=Fh,Yh=Wh);const Xh=$h-Fh,jh=Th-Wh,qh=zh-Uh,Vh=Hh-Yh;return Math.atan2(Xh*Vh-jh*qh,Xh*qh+jh*Vh)},getAtan2:($h,Th)=>rt$2(Th.y-$h.y,Th.x-$h.x),getDistancePoint($h,Th,Fh,Wh,zh){const Hh=ct$2($h,Th);return zh&&($h=Th),Wh||(Th={}),Th.x=$h.x+tt$2(Hh)*Fh,Th.y=$h.y+K$1(Hh)*Fh,Th},toNumberPoints($h){let Th=$h;return d($h[0])&&(Th=[],$h.forEach(Fh=>Th.push(Fh.x,Fh.y))),Th},isSame:($h,Th)=>J$2($h.x)===J$2(Th.x)&&J$2($h.y)===J$2(Th.y),reset($h){at$2.reset($h)}},at$2=ot$2,{getDistanceFrom:ht$2,copy:lt$2,setRadius:dt$2,getAtan2:ct$2}=at$2;let ut$2=class Od{constructor(Th,Fh){this.set(Th,Fh)}set(Th,Fh){return d(Th)?ot$2.copy(this,Th):ot$2.set(this,Th,Fh),this}get(){const{x:Th,y:Fh}=this;return{x:Th,y:Fh}}clone(){return new Od(this)}move(Th,Fh){return ot$2.move(this,Th,Fh),this}scale(Th,Fh){return ot$2.scale(this,Th,Fh),this}scaleOf(Th,Fh,Wh){return ot$2.scaleOf(this,Th,Fh,Wh),this}rotate(Th,Fh){return ot$2.rotate(this,Th,Fh),this}rotateOf(Th,Fh){return ot$2.rotate(this,Fh,Th),this}getRotation(Th,Fh,Wh){return ot$2.getRotation(this,Th,Fh,Wh)}toInnerOf(Th,Fh){return ot$2.toInnerOf(this,Th,Fh),this}toOuterOf(Th,Fh){return ot$2.toOuterOf(this,Th,Fh),this}getCenter(Th){return new Od(ot$2.getCenter(this,Th))}getDistance(Th){return ot$2.getDistance(this,Th)}getDistancePoint(Th,Fh,Wh,zh){return new Od(ot$2.getDistancePoint(this,Th,Fh,Wh,zh))}getAngle(Th){return ot$2.getAngle(this,Th)}getAtan2(Th){return ot$2.getAtan2(this,Th)}isSame(Th){return ot$2.isSame(this,Th)}reset(){return ot$2.reset(this),this}};const _t$2=new ut$2;let pt$2=class Rd{constructor(Th,Fh,Wh,zh,Hh,Uh){this.set(Th,Fh,Wh,zh,Hh,Uh)}set(Th,Fh,Wh,zh,Hh,Uh){return d(Th)?q$1.copy(this,Th):q$1.set(this,Th,Fh,Wh,zh,Hh,Uh),this}setWith(Th){return q$1.copy(this,Th),this.scaleX=Th.scaleX,this.scaleY=Th.scaleY,this}get(){const{a:Th,b:Fh,c:Wh,d:zh,e:Hh,f:Uh}=this;return{a:Th,b:Fh,c:Wh,d:zh,e:Hh,f:Uh}}clone(){return new Rd(this)}translate(Th,Fh){return q$1.translate(this,Th,Fh),this}translateInner(Th,Fh){return q$1.translateInner(this,Th,Fh),this}scale(Th,Fh){return q$1.scale(this,Th,Fh),this}scaleWith(Th,Fh){return q$1.scale(this,Th,Fh),this.scaleX*=Th,this.scaleY*=Fh||Th,this}pixelScale(Th){return q$1.pixelScale(this,Th),this}scaleOfOuter(Th,Fh,Wh){return q$1.scaleOfOuter(this,Th,Fh,Wh),this}scaleOfInner(Th,Fh,Wh){return q$1.scaleOfInner(this,Th,Fh,Wh),this}rotate(Th){return q$1.rotate(this,Th),this}rotateOfOuter(Th,Fh){return q$1.rotateOfOuter(this,Th,Fh),this}rotateOfInner(Th,Fh){return q$1.rotateOfInner(this,Th,Fh),this}skew(Th,Fh){return q$1.skew(this,Th,Fh),this}skewOfOuter(Th,Fh,Wh){return q$1.skewOfOuter(this,Th,Fh,Wh),this}skewOfInner(Th,Fh,Wh){return q$1.skewOfInner(this,Th,Fh,Wh),this}multiply(Th){return q$1.multiply(this,Th),this}multiplyParent(Th){return q$1.multiplyParent(this,Th),this}divide(Th){return q$1.divide(this,Th),this}divideParent(Th){return q$1.divideParent(this,Th),this}invert(){return q$1.invert(this),this}invertWith(){return q$1.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(Th,Fh,Wh){q$1.toOuterPoint(this,Th,Fh,Wh)}toInnerPoint(Th,Fh,Wh){q$1.toInnerPoint(this,Th,Fh,Wh)}setLayout(Th,Fh,Wh){return q$1.setLayout(this,Th,Fh,Wh),this}getLayout(Th,Fh,Wh){return q$1.getLayout(this,Th,Fh,Wh)}withScale(Th,Fh){return q$1.withScale(this,Th,Fh)}reset(){q$1.reset(this)}};const ft$2=new pt$2,gt$2={tempPointBounds:{},setPoint($h,Th,Fh){$h.minX=$h.maxX=Th,$h.minY=$h.maxY=Fh},addPoint($h,Th,Fh){$h.minX=Th<$h.minX?Th:$h.minX,$h.minY=Fh<$h.minY?Fh:$h.minY,$h.maxX=Th>$h.maxX?Th:$h.maxX,$h.maxY=Fh>$h.maxY?Fh:$h.maxY},addBounds($h,Th,Fh,Wh,zh){yt$2($h,Th,Fh),yt$2($h,Th+Wh,Fh+zh)},copy($h,Th){$h.minX=Th.minX,$h.minY=Th.minY,$h.maxX=Th.maxX,$h.maxY=Th.maxY},addPointBounds($h,Th){$h.minX=Th.minX<$h.minX?Th.minX:$h.minX,$h.minY=Th.minY<$h.minY?Th.minY:$h.minY,$h.maxX=Th.maxX>$h.maxX?Th.maxX:$h.maxX,$h.maxY=Th.maxY>$h.maxY?Th.maxY:$h.maxY},toBounds($h,Th){Th.x=$h.minX,Th.y=$h.minY,Th.width=$h.maxX-$h.minX,Th.height=$h.maxY-$h.minY}},{addPoint:yt$2}=gt$2;var mt$3,xt$2;(function($h){$h[$h.top=0]="top",$h[$h.right=1]="right",$h[$h.bottom=2]="bottom",$h[$h.left=3]="left"})(mt$3||(mt$3={})),(function($h){$h[$h.topLeft=0]="topLeft",$h[$h.top=1]="top",$h[$h.topRight=2]="topRight",$h[$h.right=3]="right",$h[$h.bottomRight=4]="bottomRight",$h[$h.bottom=5]="bottom",$h[$h.bottomLeft=6]="bottomLeft",$h[$h.left=7]="left",$h[$h.center=8]="center",$h[$h["top-left"]=0]="top-left",$h[$h["top-right"]=2]="top-right",$h[$h["bottom-right"]=4]="bottom-right",$h[$h["bottom-left"]=6]="bottom-left"})(xt$2||(xt$2={}));const wt$2=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];wt$2.forEach($h=>$h.type="percent");const bt$3={directionData:wt$2,tempPoint:{},get:Bt$3,toPoint($h,Th,Fh,Wh,zh,Hh){const Uh=Bt$3($h);Fh.x=Uh.x,Fh.y=Uh.y,Uh.type==="percent"&&(Fh.x*=Th.width,Fh.y*=Th.height,zh&&(Hh||(Fh.x-=zh.x,Fh.y-=zh.y),Uh.x&&(Fh.x-=Uh.x===1?zh.width:Uh.x===.5?Uh.x*zh.width:0),Uh.y&&(Fh.y-=Uh.y===1?zh.height:Uh.y===.5?Uh.y*zh.height:0))),Wh||(Fh.x+=Th.x,Fh.y+=Th.y)},getPoint:($h,Th,Fh)=>(Fh||(Fh={}),bt$3.toPoint($h,Th,Fh,!0),Fh)};function Bt$3($h){return i($h)?wt$2[xt$2[$h]]:$h}const{toPoint:vt$2}=bt$3,kt$3={toPoint($h,Th,Fh,Wh,zh,Hh){vt$2($h,Fh,Wh,zh,Th,Hh)}},{tempPointBounds:Ct$3,setPoint:Ot$3,addPoint:Tt$3,toBounds:Pt$3}=gt$2,{toOuterPoint:St$3}=q$1,{float:Lt$3,fourNumber:Rt$3}=I$1,{floor:Et$3,ceil:It$3}=Math;let Mt$3,At$3,Wt$3,Nt$3;const Yt$3={},Dt$3={},Xt$3={},zt$2={tempBounds:Xt$3,set($h,Th=0,Fh=0,Wh=0,zh=0){$h.x=Th,$h.y=Fh,$h.width=Wh,$h.height=zh},copy($h,Th){$h.x=Th.x,$h.y=Th.y,$h.width=Th.width,$h.height=Th.height},copyAndSpread($h,Th,Fh,Wh,zh){const{x:Hh,y:Uh,width:Yh,height:Xh}=Th;if(l(Fh)){const jh=Rt$3(Fh);Wh?Ft$3.set($h,Hh+jh[3],Uh+jh[0],Yh-jh[1]-jh[3],Xh-jh[2]-jh[0]):Ft$3.set($h,Hh-jh[3],Uh-jh[0],Yh+jh[1]+jh[3],Xh+jh[2]+jh[0])}else Wh&&(Fh=-Fh),Ft$3.set($h,Hh-Fh,Uh-Fh,Yh+2*Fh,Xh+2*Fh);zh&&(zh==="width"?($h.y=Uh,$h.height=Xh):($h.x=Hh,$h.width=Yh))},minX:$h=>$h.width>0?$h.x:$h.x+$h.width,minY:$h=>$h.height>0?$h.y:$h.y+$h.height,maxX:$h=>$h.width>0?$h.x+$h.width:$h.x,maxY:$h=>$h.height>0?$h.y+$h.height:$h.y,move($h,Th,Fh){$h.x+=Th,$h.y+=Fh},scroll($h,Th){$h.x+=Th.scrollX,$h.y+=Th.scrollY},getByMove:($h,Th,Fh)=>($h=Object.assign({},$h),Ft$3.move($h,Th,Fh),$h),toOffsetOutBounds($h,Th,Fh){Th?jt$3(Th,$h):Th=$h,Fh||(Fh=$h),Th.offsetX=Ft$3.maxX(Fh),Th.offsetY=Ft$3.maxY(Fh),Ft$3.move(Th,-Th.offsetX,-Th.offsetY)},scale($h,Th,Fh=Th,Wh){Wh||ot$2.scale($h,Th,Fh),$h.width*=Th,$h.height*=Fh},scaleOf($h,Th,Fh,Wh=Fh){ot$2.scaleOf($h,Th,Fh,Wh),$h.width*=Fh,$h.height*=Wh},tempToOuterOf:($h,Th)=>(Ft$3.copy(Xt$3,$h),Ft$3.toOuterOf(Xt$3,Th),Xt$3),getOuterOf:($h,Th)=>($h=Object.assign({},$h),Ft$3.toOuterOf($h,Th),$h),toOuterOf($h,Th,Fh){if(Fh||(Fh=$h),Th.b===0&&Th.c===0){const{a:Wh,d:zh,e:Hh,f:Uh}=Th;Wh>0?(Fh.width=$h.width*Wh,Fh.x=Hh+$h.x*Wh):(Fh.width=$h.width*-Wh,Fh.x=Hh+$h.x*Wh-Fh.width),zh>0?(Fh.height=$h.height*zh,Fh.y=Uh+$h.y*zh):(Fh.height=$h.height*-zh,Fh.y=Uh+$h.y*zh-Fh.height)}else Yt$3.x=$h.x,Yt$3.y=$h.y,St$3(Th,Yt$3,Dt$3),Ot$3(Ct$3,Dt$3.x,Dt$3.y),Yt$3.x=$h.x+$h.width,St$3(Th,Yt$3,Dt$3),Tt$3(Ct$3,Dt$3.x,Dt$3.y),Yt$3.y=$h.y+$h.height,St$3(Th,Yt$3,Dt$3),Tt$3(Ct$3,Dt$3.x,Dt$3.y),Yt$3.x=$h.x,St$3(Th,Yt$3,Dt$3),Tt$3(Ct$3,Dt$3.x,Dt$3.y),Pt$3(Ct$3,Fh)},toInnerOf($h,Th,Fh){Fh||(Fh=$h),Ft$3.move(Fh,-Th.e,-Th.f),Ft$3.scale(Fh,1/Th.a,1/Th.d)},getFitMatrix($h,Th,Fh=1){const Wh=Math.min(Fh,Ft$3.getFitScale($h,Th));return new pt$2(Wh,0,0,Wh,-Th.x*Wh,-Th.y*Wh)},getFitScale($h,Th,Fh){const Wh=$h.width/Th.width,zh=$h.height/Th.height;return Fh?Math.max(Wh,zh):Math.min(Wh,zh)},put($h,Th,Fh="center",Wh=1,zh=!0,Hh){Hh||(Hh=Th),i(Wh)&&(Wh=Ft$3.getFitScale($h,Th,Wh==="cover")),Xt$3.width=zh?Th.width*=Wh:Th.width*Wh,Xt$3.height=zh?Th.height*=Wh:Th.height*Wh,kt$3.toPoint(Fh,Xt$3,$h,Hh,!0,!0)},getSpread($h,Th,Fh){const Wh={};return Ft$3.copyAndSpread(Wh,$h,Th,!1,Fh),Wh},spread($h,Th,Fh){Ft$3.copyAndSpread($h,$h,Th,!1,Fh)},shrink($h,Th,Fh){Ft$3.copyAndSpread($h,$h,Th,!0,Fh)},ceil($h){const{x:Th,y:Fh}=$h;$h.x=Et$3($h.x),$h.y=Et$3($h.y),$h.width=Th>$h.x?It$3($h.width+Th-$h.x):It$3($h.width),$h.height=Fh>$h.y?It$3($h.height+Fh-$h.y):It$3($h.height)},unsign($h){$h.width<0&&($h.x+=$h.width,$h.width=-$h.width),$h.height<0&&($h.y+=$h.height,$h.height=-$h.height)},float($h,Th){$h.x=Lt$3($h.x,Th),$h.y=Lt$3($h.y,Th),$h.width=Lt$3($h.width,Th),$h.height=Lt$3($h.height,Th)},add($h,Th,Fh){Mt$3=$h.x+$h.width,At$3=$h.y+$h.height,Wt$3=Th.x,Nt$3=Th.y,Fh||(Wt$3+=Th.width,Nt$3+=Th.height),Mt$3=Mt$3>Wt$3?Mt$3:Wt$3,At$3=At$3>Nt$3?At$3:Nt$3,$h.x=$h.x<Th.x?$h.x:Th.x,$h.y=$h.y<Th.y?$h.y:Th.y,$h.width=Mt$3-$h.x,$h.height=At$3-$h.y},addList($h,Th){Ft$3.setListWithFn($h,Th,void 0,!0)},setList($h,Th,Fh=!1){Ft$3.setListWithFn($h,Th,void 0,Fh)},addListWithFn($h,Th,Fh){Ft$3.setListWithFn($h,Th,Fh,!0)},setListWithFn($h,Th,Fh,Wh=!1){let zh,Hh=!0;for(let Uh=0,Yh=Th.length;Uh<Yh;Uh++)zh=Fh?Fh(Th[Uh],Uh):Th[Uh],zh&&(zh.width||zh.height)&&(Hh?(Hh=!1,Wh||jt$3($h,zh)):Ut$3($h,zh));Hh&&Ft$3.reset($h)},setPoints($h,Th){Th.forEach((Fh,Wh)=>Wh===0?Ot$3(Ct$3,Fh.x,Fh.y):Tt$3(Ct$3,Fh.x,Fh.y)),Pt$3(Ct$3,$h)},setPoint($h,Th){Ft$3.set($h,Th.x,Th.y)},addPoint($h,Th){Ut$3($h,Th,!0)},getPoints($h){const{x:Th,y:Fh,width:Wh,height:zh}=$h;return[{x:Th,y:Fh},{x:Th+Wh,y:Fh},{x:Th+Wh,y:Fh+zh},{x:Th,y:Fh+zh}]},hitRadiusPoint:($h,Th,Fh)=>(Fh&&(Th=ot$2.tempToInnerRadiusPointOf(Th,Fh)),Th.x>=$h.x-Th.radiusX&&Th.x<=$h.x+$h.width+Th.radiusX&&Th.y>=$h.y-Th.radiusY&&Th.y<=$h.y+$h.height+Th.radiusY),hitPoint:($h,Th,Fh)=>(Fh&&(Th=ot$2.tempToInnerOf(Th,Fh)),Th.x>=$h.x&&Th.x<=$h.x+$h.width&&Th.y>=$h.y&&Th.y<=$h.y+$h.height),hit:($h,Th,Fh)=>(Fh&&(Th=Ft$3.tempToOuterOf(Th,Fh)),!($h.y+$h.height<Th.y||Th.y+Th.height<$h.y||$h.x+$h.width<Th.x||Th.x+Th.width<$h.x)),includes:($h,Th,Fh)=>(Fh&&(Th=Ft$3.tempToOuterOf(Th,Fh)),$h.x<=Th.x&&$h.y<=Th.y&&$h.x+$h.width>=Th.x+Th.width&&$h.y+$h.height>=Th.y+Th.height),getIntersectData($h,Th,Fh){if(Fh&&(Th=Ft$3.tempToOuterOf(Th,Fh)),!Ft$3.hit($h,Th))return{x:0,y:0,width:0,height:0};let{x:Wh,y:zh,width:Hh,height:Uh}=Th;return Mt$3=Wh+Hh,At$3=zh+Uh,Wt$3=$h.x+$h.width,Nt$3=$h.y+$h.height,Wh=Wh>$h.x?Wh:$h.x,zh=zh>$h.y?zh:$h.y,Mt$3=Mt$3<Wt$3?Mt$3:Wt$3,At$3=At$3<Nt$3?At$3:Nt$3,Hh=Mt$3-Wh,Uh=At$3-zh,{x:Wh,y:zh,width:Hh,height:Uh}},intersect($h,Th,Fh){Ft$3.copy($h,Ft$3.getIntersectData($h,Th,Fh))},isSame:($h,Th)=>$h.x===Th.x&&$h.y===Th.y&&$h.width===Th.width&&$h.height===Th.height,isEmpty:$h=>$h.x===0&&$h.y===0&&$h.width===0&&$h.height===0,hasSize:$h=>$h.width&&$h.height,reset($h){Ft$3.set($h)}},Ft$3=zt$2,{add:Ut$3,copy:jt$3}=Ft$3;let Vt$3=class Ad{get minX(){return zt$2.minX(this)}get minY(){return zt$2.minY(this)}get maxX(){return zt$2.maxX(this)}get maxY(){return zt$2.maxY(this)}constructor(Th,Fh,Wh,zh){this.set(Th,Fh,Wh,zh)}set(Th,Fh,Wh,zh){return d(Th)?zt$2.copy(this,Th):zt$2.set(this,Th,Fh,Wh,zh),this}get(){const{x:Th,y:Fh,width:Wh,height:zh}=this;return{x:Th,y:Fh,width:Wh,height:zh}}clone(){return new Ad(this)}move(Th,Fh){return zt$2.move(this,Th,Fh),this}scale(Th,Fh,Wh){return zt$2.scale(this,Th,Fh,Wh),this}scaleOf(Th,Fh,Wh){return zt$2.scaleOf(this,Th,Fh,Wh),this}toOuterOf(Th,Fh){return zt$2.toOuterOf(this,Th,Fh),this}toInnerOf(Th,Fh){return zt$2.toInnerOf(this,Th,Fh),this}getFitMatrix(Th,Fh){return zt$2.getFitMatrix(this,Th,Fh)}put(Th,Fh,Wh){zt$2.put(this,Th,Fh,Wh)}spread(Th,Fh){return zt$2.spread(this,Th,Fh),this}shrink(Th,Fh){return zt$2.shrink(this,Th,Fh),this}ceil(){return zt$2.ceil(this),this}unsign(){return zt$2.unsign(this),this}float(Th){return zt$2.float(this,Th),this}add(Th){return zt$2.add(this,Th),this}addList(Th){return zt$2.setList(this,Th,!0),this}setList(Th){return zt$2.setList(this,Th),this}addListWithFn(Th,Fh){return zt$2.setListWithFn(this,Th,Fh,!0),this}setListWithFn(Th,Fh){return zt$2.setListWithFn(this,Th,Fh),this}setPoint(Th){return zt$2.setPoint(this,Th),this}setPoints(Th){return zt$2.setPoints(this,Th),this}addPoint(Th){return zt$2.addPoint(this,Th),this}getPoints(){return zt$2.getPoints(this)}hitPoint(Th,Fh){return zt$2.hitPoint(this,Th,Fh)}hitRadiusPoint(Th,Fh){return zt$2.hitRadiusPoint(this,Th,Fh)}hit(Th,Fh){return zt$2.hit(this,Th,Fh)}includes(Th,Fh){return zt$2.includes(this,Th,Fh)}intersect(Th,Fh){return zt$2.intersect(this,Th,Fh),this}getIntersect(Th,Fh){return new Ad(zt$2.getIntersectData(this,Th,Fh))}isSame(Th){return zt$2.isSame(this,Th)}isEmpty(){return zt$2.isEmpty(this)}reset(){zt$2.reset(this)}};const Ht$3=new Vt$3;let Gt$2=class{constructor($h,Th,Fh,Wh,zh,Hh){d($h)?this.copy($h):this.set($h,Th,Fh,Wh,zh,Hh)}set($h=0,Th=0,Fh=0,Wh=0,zh=0,Hh=0){this.top=$h,this.right=Th,this.bottom=Fh,this.left=Wh,this.width=zh,this.height=Hh}copy($h){const{top:Th,right:Fh,bottom:Wh,left:zh,width:Hh,height:Uh}=$h;this.set(Th,Fh,Wh,zh,Hh,Uh)}getBoundsFrom($h){const{top:Th,right:Fh,bottom:Wh,left:zh,width:Hh,height:Uh}=this;return new Vt$3(zh,Th,Hh||$h.width-zh-Fh,Uh||$h.height-Th-Wh)}};const qt$2={number:($h,Th)=>d($h)?$h.type==="percent"?$h.value*Th:$h.value:$h},Qt$2={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1},{floor:Jt$2,max:Zt$2}=Math,$t$2={toURL($h,Th){let Fh=encodeURIComponent($h);return Th==="text"?Fh="data:text/plain;charset=utf-8,"+Fh:Th==="svg"&&(Fh="data:image/svg+xml,"+Fh),Fh},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",isLarge:($h,Th,Fh,Wh)=>$h.width*$h.height*(Th?Th*Fh:1)>(Wh||Kt$3.maxCacheSize),isSuperLarge:($h,Th,Fh)=>Kt$3.isLarge($h,Th,Fh,Kt$3.maxPatternSize),getRealURL($h){const{prefix:Th,suffix:Fh}=Kt$3;return!Fh||$h.startsWith("data:")||$h.startsWith("blob:")||($h+=($h.includes("?")?"&":"?")+Fh),Th&&$h[0]==="/"&&($h=Th+$h),$h},resize($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh){const qh=Zt$2(Jt$2(Th+(Wh||0)),1),Vh=Zt$2(Jt$2(Fh+(zh||0)),1);let Zh,Kh,Qh;jh&&(Qh=qt$2.number(jh.offset,jh.type==="x"?Th:Fh))&&(jh.type==="x"?Zh=!0:Kh=!0);const Jh=$t$2.origin.createCanvas(Kh?2*qh:qh,Zh?2*Vh:Vh),td=Jh.getContext("2d");if(Yh&&(td.globalAlpha=Yh),td.imageSmoothingEnabled=Uh!==!1,Kt$3.canUse($h)){if(Hh){const ed=Th/Hh.width,id=Fh/Hh.height;td.setTransform(ed,0,0,id,-Hh.x*ed,-Hh.y*id),td.drawImage($h,0,0,$h.width,$h.height)}else td.drawImage($h,0,0,Th,Fh);Qh&&(td.drawImage(Jh,0,0,qh,Vh,Zh?Qh-qh:qh,Zh?Vh:Qh-Vh,qh,Vh),td.drawImage(Jh,0,0,qh,Vh,Zh?Qh:qh,Zh?Vh:Qh,qh,Vh))}return Jh},canUse:$h=>$h&&$h.width&&!$h.__closed,setPatternTransform($h,Th,Fh){try{Th&&$h.setTransform&&($h.setTransform(Th),Th=void 0)}catch{}Fh&&_.stintSet(Fh,"transform",Th)}}},{image:Kt$3}=$t$2,{randColor:te$2}=I$1;let ee$2=class Nd{constructor(Th){this.repeatMap={},this.name=Th}static get(Th){return new Nd(Th)}static set filter(Th){this.filterList=se$2(Th)}static set exclude(Th){this.excludeList=se$2(Th)}static drawRepaint(Th,Fh){const Wh=te$2();Th.fillWorld(Fh,Wh.replace("1)",".1)")),Th.strokeWorld(Fh,Wh)}static drawBounds(Th,Fh,Wh){const zh=Nd.showBounds==="hit",Hh=Th.__nowWorld,Uh=te$2();zh&&(Fh.setWorld(Hh),Th.__drawHitPath(Fh),Fh.fillStyle=Uh.replace("1)",".2)"),Fh.fill()),Fh.resetTransform(),Fh.setStroke(Uh,2),zh?Fh.stroke():Fh.strokeWorld(Hh,Uh)}log(...Th){if(re$2.enable){if(re$2.filterList.length&&re$2.filterList.every(Fh=>Fh!==this.name)||re$2.excludeList.length&&re$2.excludeList.some(Fh=>Fh===this.name))return;console.log("%c"+this.name,"color:#21ae62",...Th)}}tip(...Th){re$2.enable&&this.warn(...Th)}warn(...Th){re$2.showWarn&&console.warn(this.name,...Th)}repeat(Th,...Fh){this.repeatMap[Th]||(this.warn("repeat:"+Th,...Fh),this.repeatMap[Th]=!0)}error(...Th){try{throw new Error}catch(Fh){console.error(this.name,...Th,Fh)}}};function se$2($h){return $h?i($h)&&($h=[$h]):$h=[],$h}ee$2.filterList=[],ee$2.excludeList=[],ee$2.showWarn=!0;const re$2=ee$2,ie$2=ee$2.get("RunTime"),ne$2={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start($h,Th){const Fh=g.create(g.RUNTIME);return oe$2.currentId=oe$2.idMap[Fh]=Th?performance.now():Date.now(),oe$2.currentName=oe$2.nameMap[Fh]=$h,oe$2.nameToIdMap[$h]=Fh,Fh},end($h,Th){const Fh=oe$2.idMap[$h],Wh=oe$2.nameMap[$h],zh=Th?(performance.now()-Fh)/1e3:Date.now()-Fh;oe$2.idMap[$h]=oe$2.nameMap[$h]=oe$2.nameToIdMap[Wh]=void 0,ie$2.log(Wh,zh,"ms")},endOfName($h,Th){const Fh=oe$2.nameToIdMap[$h];s(Fh)||oe$2.end(Fh,Th)}},oe$2=ne$2,ae$2=[],he$2={list:{},add($h,...Th){this.list[$h]=!0,ae$2.push(...Th)},has($h,Th){const Fh=this.list[$h];return!Fh&&Th&&this.need($h),Fh},need($h){console.error("please install and import plugin: "+($h.includes("-x")?"":"@leafer-in/")+$h)}};setTimeout(()=>ae$2.forEach($h=>he$2.has($h,!0)));const le$2={editor:$h=>he$2.need("editor")},de$2=ee$2.get("UICreator"),ce$2={list:{},register($h){const{__tag:Th}=$h.prototype;ue$2[Th]&&de$2.repeat(Th),ue$2[Th]=$h},get($h,Th,Fh,Wh,zh,Hh){if(!ue$2[$h])return void de$2.warn("not register "+$h);const Uh=new ue$2[$h](Th);return s(Fh)||(Uh.x=Fh,Wh&&(Uh.y=Wh),zh&&(Uh.width=zh),Hh&&(Uh.height=Hh)),Uh}},{list:ue$2}=ce$2,_e$2=ee$2.get("EventCreator"),pe$2={nameList:{},register($h){let Th;Object.keys($h).forEach(Fh=>{Th=$h[Fh],i(Th)&&(fe$2[Th]&&_e$2.repeat(Th),fe$2[Th]=$h)})},changeName($h,Th){const Fh=fe$2[$h];if(Fh){const Wh=Object.keys(Fh).find(zh=>Fh[zh]===$h);Wh&&(Fh[Wh]=Th,fe$2[Th]=Fh)}},has($h){return!!this.nameList[$h]},get:($h,...Th)=>new fe$2[$h](...Th)},{nameList:fe$2}=pe$2;let ge$2=class{constructor(){this.list=[]}add($h){$h.manager=this,this.list.push($h)}get($h){let Th;const{list:Fh}=this;for(let zh=0,Hh=Fh.length;zh<Hh;zh++)if(Th=Fh[zh],Th.recycled&&Th.isSameSize($h))return Th.recycled=!1,Th.manager||(Th.manager=this),Th;const Wh=le$2.canvas($h);return this.add(Wh),Wh}recycle($h){$h.recycled=!0}clearRecycled(){let $h;const Th=[];for(let Fh=0,Wh=this.list.length;Fh<Wh;Fh++)$h=this.list[Fh],$h.recycled?$h.destroy():Th.push($h);this.list=Th}clear(){this.list.forEach($h=>{$h.destroy()}),this.list.length=0}destroy(){this.clear()}};function ye$2($h,Th,Fh,Wh){var zh,Hh=arguments.length,Uh=Hh<3?Th:Wh===null?Wh=Object.getOwnPropertyDescriptor(Th,Fh):Wh;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Uh=Reflect.decorate($h,Th,Fh,Wh);else for(var Yh=$h.length-1;Yh>=0;Yh--)(zh=$h[Yh])&&(Uh=(Hh<3?zh(Uh):Hh>3?zh(Th,Fh,Uh):zh(Th,Fh))||Uh);return Hh>3&&Uh&&Object.defineProperty(Th,Fh,Uh),Uh}function me$2($h,Th,Fh,Wh){return new(Fh||(Fh=Promise))(function(zh,Hh){function Uh(jh){try{Xh(Wh.next(jh))}catch(qh){Hh(qh)}}function Yh(jh){try{Xh(Wh.throw(jh))}catch(qh){Hh(qh)}}function Xh(jh){var qh;jh.done?zh(jh.value):(qh=jh.value,qh instanceof Fh?qh:new Fh(function(Vh){Vh(qh)})).then(Uh,Yh)}Xh((Wh=Wh.apply($h,[])).next())})}function xe$2($h){return(Th,Fh)=>{$h||($h=Fh);const Wh={get(){return this.context[$h]},set(zh){this.context[$h]=zh}};Fh==="strokeCap"&&(Wh.set=function(zh){this.context[$h]=zh==="none"?"butt":zh}),Object.defineProperty(Th,Fh,Wh)}}const we$2=[];function be$2(){return($h,Th)=>{we$2.push(Th)}}const Be$2=[];let ve$2=class{set blendMode($h){$h==="normal"&&($h="source-over"),this.context.globalCompositeOperation=$h}get blendMode(){return this.context.globalCompositeOperation}set dashPattern($h){this.context.setLineDash($h||Be$2)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let $h;we$2.forEach(Th=>{$h=this.context[Th],$h&&(this[Th]=$h.bind(this.context))}),this.textBaseline="alphabetic"}setTransform($h,Th,Fh,Wh,zh,Hh){}resetTransform(){}getTransform(){}save(){}restore(){}transform($h,Th,Fh,Wh,zh,Hh){d($h)?this.context.transform($h.a,$h.b,$h.c,$h.d,$h.e,$h.f):this.context.transform($h,Th,Fh,Wh,zh,Hh)}translate($h,Th){}scale($h,Th){}rotate($h){}fill($h,Th){}stroke($h){}clip($h,Th){}fillRect($h,Th,Fh,Wh){}strokeRect($h,Th,Fh,Wh){}clearRect($h,Th,Fh,Wh){}drawImage($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh){switch(arguments.length){case 9:if(Th<0){const jh=-Th/Wh*Yh;Wh+=Th,Th=0,Hh+=jh,Yh-=jh}if(Fh<0){const jh=-Fh/zh*Xh;zh+=Fh,Fh=0,Uh+=jh,Xh-=jh}this.context.drawImage($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh);break;case 5:this.context.drawImage($h,Th,Fh,Wh,zh);break;case 3:this.context.drawImage($h,Th,Fh)}}beginPath(){}moveTo($h,Th){}lineTo($h,Th){}bezierCurveTo($h,Th,Fh,Wh,zh,Hh){}quadraticCurveTo($h,Th,Fh,Wh){}closePath(){}arc($h,Th,Fh,Wh,zh,Hh){}arcTo($h,Th,Fh,Wh,zh){}ellipse($h,Th,Fh,Wh,zh,Hh,Uh,Yh){}rect($h,Th,Fh,Wh){}roundRect($h,Th,Fh,Wh,zh){}createConicGradient($h,Th,Fh){}createLinearGradient($h,Th,Fh,Wh){}createPattern($h,Th){}createRadialGradient($h,Th,Fh,Wh,zh,Hh){}fillText($h,Th,Fh,Wh){}measureText($h){}strokeText($h,Th,Fh,Wh){}destroy(){this.context=null}};ye$2([xe$2("imageSmoothingEnabled")],ve$2.prototype,"smooth",void 0),ye$2([xe$2("imageSmoothingQuality")],ve$2.prototype,"smoothLevel",void 0),ye$2([xe$2("globalAlpha")],ve$2.prototype,"opacity",void 0),ye$2([xe$2()],ve$2.prototype,"fillStyle",void 0),ye$2([xe$2()],ve$2.prototype,"strokeStyle",void 0),ye$2([xe$2("lineWidth")],ve$2.prototype,"strokeWidth",void 0),ye$2([xe$2("lineCap")],ve$2.prototype,"strokeCap",void 0),ye$2([xe$2("lineJoin")],ve$2.prototype,"strokeJoin",void 0),ye$2([xe$2("lineDashOffset")],ve$2.prototype,"dashOffset",void 0),ye$2([xe$2()],ve$2.prototype,"miterLimit",void 0),ye$2([xe$2()],ve$2.prototype,"shadowBlur",void 0),ye$2([xe$2()],ve$2.prototype,"shadowColor",void 0),ye$2([xe$2()],ve$2.prototype,"shadowOffsetX",void 0),ye$2([xe$2()],ve$2.prototype,"shadowOffsetY",void 0),ye$2([xe$2()],ve$2.prototype,"filter",void 0),ye$2([xe$2()],ve$2.prototype,"font",void 0),ye$2([xe$2()],ve$2.prototype,"fontKerning",void 0),ye$2([xe$2()],ve$2.prototype,"fontStretch",void 0),ye$2([xe$2()],ve$2.prototype,"fontVariantCaps",void 0),ye$2([xe$2()],ve$2.prototype,"textAlign",void 0),ye$2([xe$2()],ve$2.prototype,"textBaseline",void 0),ye$2([xe$2()],ve$2.prototype,"textRendering",void 0),ye$2([xe$2()],ve$2.prototype,"wordSpacing",void 0),ye$2([xe$2()],ve$2.prototype,"letterSpacing",void 0),ye$2([xe$2()],ve$2.prototype,"direction",void 0),ye$2([be$2()],ve$2.prototype,"setTransform",null),ye$2([be$2()],ve$2.prototype,"resetTransform",null),ye$2([be$2()],ve$2.prototype,"getTransform",null),ye$2([be$2()],ve$2.prototype,"save",null),ye$2([be$2()],ve$2.prototype,"restore",null),ye$2([be$2()],ve$2.prototype,"translate",null),ye$2([be$2()],ve$2.prototype,"scale",null),ye$2([be$2()],ve$2.prototype,"rotate",null),ye$2([be$2()],ve$2.prototype,"fill",null),ye$2([be$2()],ve$2.prototype,"stroke",null),ye$2([be$2()],ve$2.prototype,"clip",null),ye$2([be$2()],ve$2.prototype,"fillRect",null),ye$2([be$2()],ve$2.prototype,"strokeRect",null),ye$2([be$2()],ve$2.prototype,"clearRect",null),ye$2([be$2()],ve$2.prototype,"beginPath",null),ye$2([be$2()],ve$2.prototype,"moveTo",null),ye$2([be$2()],ve$2.prototype,"lineTo",null),ye$2([be$2()],ve$2.prototype,"bezierCurveTo",null),ye$2([be$2()],ve$2.prototype,"quadraticCurveTo",null),ye$2([be$2()],ve$2.prototype,"closePath",null),ye$2([be$2()],ve$2.prototype,"arc",null),ye$2([be$2()],ve$2.prototype,"arcTo",null),ye$2([be$2()],ve$2.prototype,"ellipse",null),ye$2([be$2()],ve$2.prototype,"rect",null),ye$2([be$2()],ve$2.prototype,"roundRect",null),ye$2([be$2()],ve$2.prototype,"createConicGradient",null),ye$2([be$2()],ve$2.prototype,"createLinearGradient",null),ye$2([be$2()],ve$2.prototype,"createPattern",null),ye$2([be$2()],ve$2.prototype,"createRadialGradient",null),ye$2([be$2()],ve$2.prototype,"fillText",null),ye$2([be$2()],ve$2.prototype,"measureText",null),ye$2([be$2()],ve$2.prototype,"strokeText",null);const{copy:ke$2,multiplyParent:Ce$2,pixelScale:Oe$2}=q$1,{round:Te$2}=Math,Pe$2=new Vt$3,Se$2=new Vt$3,Le$2={width:1,height:1,pixelRatio:1},Re$2=["width","height","pixelRatio"];let Ee$2=class extends ve$2{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio||0}get pixelHeight(){return this.height*this.pixelRatio||0}get pixelSnap(){return this.config.pixelSnap}set pixelSnap($h){this.config.pixelSnap=$h}get allowBackgroundColor(){return this.view&&this.parentView}constructor($h,Th){super(),this.size={},this.worldTransform={},$h||($h=Le$2),this.manager=Th,this.innerId=g.create(g.CNAVAS);const{width:Fh,height:Wh,pixelRatio:zh}=$h;this.autoLayout=!Fh||!Wh,this.size.pixelRatio=zh||$t$2.devicePixelRatio,this.config=$h,this.init()}init(){}__createContext(){const{view:$h}=this,{contextSettings:Th}=this.config;this.context=Th?$h.getContext("2d",Th):$h.getContext("2d"),this.__bindContext()}export($h,Th){}toBlob($h,Th){}toDataURL($h,Th){}saveAs($h,Th){}resize($h,Th=!0){if(this.isSameSize($h))return;let Fh;this.context&&!this.unreal&&Th&&this.width&&(Fh=this.getSameCanvas(),Fh.copyWorld(this));const Wh=this.size;_.copyAttrs(Wh,$h,Re$2),Re$2.forEach(zh=>Wh[zh]||(Wh[zh]=1)),this.bounds=new Vt$3(0,0,this.width,this.height),this.updateViewSize(),this.updateClientBounds(),this.context&&(this.smooth=this.config.smooth,!this.unreal&&Fh&&(this.clearWorld(Fh.bounds),this.copyWorld(Fh),Fh.recycle()))}updateViewSize(){}updateClientBounds(){}getClientBounds($h){return $h&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout($h,Th){}stopAutoLayout(){}setCursor($h){}setWorld($h,Th){const{pixelRatio:Fh,pixelSnap:Wh}=this,zh=this.worldTransform;Th&&Ce$2($h,Th,zh),Oe$2($h,Fh,zh),Wh&&!$h.ignorePixelSnap&&($h.half&&$h.half*Fh%2?(zh.e=Te$2(zh.e-.5)+.5,zh.f=Te$2(zh.f-.5)+.5):(zh.e=Te$2(zh.e),zh.f=Te$2(zh.f))),this.setTransform(zh.a,zh.b,zh.c,zh.d,zh.e,zh.f)}useWorldTransform($h){$h&&(this.worldTransform=$h);const Th=this.worldTransform;Th&&this.setTransform(Th.a,Th.b,Th.c,Th.d,Th.e,Th.f)}setStroke($h,Th,Fh,Wh){Th&&(this.strokeWidth=Th),$h&&(this.strokeStyle=$h),Fh&&this.setStrokeOptions(Fh,Wh)}setStrokeOptions($h,Th){let{strokeCap:Fh,strokeJoin:Wh,dashPattern:zh,dashOffset:Hh,miterLimit:Uh}=$h;Th&&(Th.strokeCap&&(Fh=Th.strokeCap),Th.strokeJoin&&(Wh=Th.strokeJoin),s(Th.dashPattern)||(zh=Th.dashPattern),s(Th.dashOffset)||(Hh=Th.dashOffset),Th.miterLimit&&(Uh=Th.miterLimit)),this.strokeCap=Fh,this.strokeJoin=Wh,this.dashPattern=zh,this.dashOffset=Hh,this.miterLimit=Uh}saveBlendMode($h){this.savedBlendMode=this.blendMode,this.blendMode=$h}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill($h,Th){return!0}hitStroke($h,Th){return!0}hitPixel($h,Th,Fh=1){return!0}setWorldShadow($h,Th,Fh,Wh){const{pixelRatio:zh}=this;this.shadowOffsetX=$h*zh,this.shadowOffsetY=Th*zh,this.shadowBlur=Fh*zh,this.shadowColor=Wh||"black"}setWorldBlur($h){const{pixelRatio:Th}=this;this.filter=`blur(${$h*Th}px)`}copyWorld($h,Th,Fh,Wh,zh){Wh&&(this.blendMode=Wh),Th?(this.setTempPixelBounds(Th,zh),Fh?(this.setTempPixelBounds2(Fh,zh),Fh=Se$2):Fh=Pe$2,this.drawImage($h.view,Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height,Fh.x,Fh.y,Fh.width,Fh.height)):this.drawImage($h.view,0,0),Wh&&(this.blendMode="source-over")}copyWorldToInner($h,Th,Fh,Wh,zh){Th.b||Th.c?(this.save(),this.resetTransform(),this.copyWorld($h,Th,zt$2.tempToOuterOf(Fh,Th),Wh,zh),this.restore()):(Wh&&(this.blendMode=Wh),this.setTempPixelBounds(Th,zh),this.drawImage($h.view,Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height,Fh.x,Fh.y,Fh.width,Fh.height),Wh&&(this.blendMode="source-over"))}copyWorldByReset($h,Th,Fh,Wh,zh,Hh){this.resetTransform(),this.copyWorld($h,Th,Fh,Wh,Hh),zh||this.useWorldTransform()}useGrayscaleAlpha($h){let Th,Fh;this.setTempPixelBounds($h,!0,!0);const{context:Wh}=this,zh=Wh.getImageData(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),{data:Hh}=zh;for(let Uh=0,Yh=Hh.length;Uh<Yh;Uh+=4)Fh=.299*Hh[Uh]+.587*Hh[Uh+1]+.114*Hh[Uh+2],(Th=Hh[Uh+3])&&(Hh[Uh+3]=Th===255?Fh:Th*(Fh/255));Wh.putImageData(zh,Pe$2.x,Pe$2.y)}useMask($h,Th,Fh){this.copyWorld($h,Th,Fh,"destination-in")}useEraser($h,Th,Fh){this.copyWorld($h,Th,Fh,"destination-out")}fillWorld($h,Th,Fh,Wh){Fh&&(this.blendMode=Fh),this.fillStyle=Th,this.setTempPixelBounds($h,Wh),this.fillRect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),Fh&&(this.blendMode="source-over")}strokeWorld($h,Th,Fh,Wh){Fh&&(this.blendMode=Fh),this.strokeStyle=Th,this.setTempPixelBounds($h,Wh),this.strokeRect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),Fh&&(this.blendMode="source-over")}clipWorld($h,Th=!0){this.beginPath(),this.setTempPixelBounds($h,Th),this.rect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height),this.clip()}clipUI($h){$h.windingRule?this.clip($h.windingRule):this.clip()}clearWorld($h,Th=!0){this.setTempPixelBounds($h,Th),this.clearRect(Pe$2.x,Pe$2.y,Pe$2.width,Pe$2.height)}clear(){const{pixelRatio:$h}=this;this.clearRect(0,0,this.width*$h+2,this.height*$h+2)}setTempPixelBounds($h,Th,Fh){this.copyToPixelBounds(Pe$2,$h,Th,Fh)}setTempPixelBounds2($h,Th,Fh){this.copyToPixelBounds(Se$2,$h,Th,Fh)}copyToPixelBounds($h,Th,Fh,Wh){$h.set(Th),Wh&&$h.intersect(this.bounds),$h.scale(this.pixelRatio),Fh&&$h.ceil()}isSameSize($h){return this.width===$h.width&&this.height===$h.height&&(!$h.pixelRatio||this.pixelRatio===$h.pixelRatio)}getSameCanvas($h,Th){const{size:Fh,pixelSnap:Wh}=this,zh=this.manager?this.manager.get(Fh):le$2.canvas(Object.assign({},Fh));return zh.save(),$h&&(ke$2(zh.worldTransform,this.worldTransform),zh.useWorldTransform()),Th&&(zh.smooth=this.smooth),zh.pixelSnap!==Wh&&(zh.pixelSnap=Wh),zh}recycle($h){this.recycled||(this.restore(),$h?this.clearWorld($h):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender($h){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}};const Ie$2={creator:{},parse($h,Th){},convertToCanvasData($h,Th){}},Me$2={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Ae$2=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Me$2),We$2={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},Ne$2={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},Ye$2=Object.assign(Object.assign({},Ne$2),Me$2),De$2=Ae$2,Xe$2={};for(let $h in De$2)Xe$2[De$2[$h]]=$h;const ze$2={};for(let $h in De$2)ze$2[De$2[$h]]=We$2[$h];const Fe$2={drawRoundRect($h,Th,Fh,Wh,zh,Hh){const Uh=I$1.fourNumber(Hh,Math.min(Wh/2,zh/2)),Yh=Th+Wh,Xh=Fh+zh;Uh[0]?$h.moveTo(Th+Uh[0],Fh):$h.moveTo(Th,Fh),Uh[1]?$h.arcTo(Yh,Fh,Yh,Xh,Uh[1]):$h.lineTo(Yh,Fh),Uh[2]?$h.arcTo(Yh,Xh,Th,Xh,Uh[2]):$h.lineTo(Yh,Xh),Uh[3]?$h.arcTo(Th,Xh,Th,Fh,Uh[3]):$h.lineTo(Th,Xh),Uh[0]?$h.arcTo(Th,Fh,Yh,Fh,Uh[0]):$h.lineTo(Th,Fh)}},{sin:Ue$2,cos:je$2,hypot:Ve$2,atan2:He$2,ceil:Ge$2,abs:qe$2,PI:Qe$2,sqrt:Je$2,pow:Ze$2}=Math,{setPoint:$e$2,addPoint:Ke$2}=gt$2,{set:ts$1,toNumberPoints:es$1}=ot$2,{M:ss$1,L:rs$1,C:is$1,Q:ns$1,Z:os$1}=Ae$2,as$1={},hs={points($h,Th,Fh,Wh){let zh=es$1(Th);if($h.push(ss$1,zh[0],zh[1]),Fh&&zh.length>5){let Hh,Uh,Yh,Xh,jh,qh,Vh,Zh,Kh,Qh,Jh,td,ed,id,sd,nd=zh.length;const hd=Fh===!0?.5:Fh;Wh&&(zh=[zh[nd-2],zh[nd-1],...zh,zh[0],zh[1],zh[2],zh[3]],nd=zh.length);for(let ud=2;ud<nd-2;ud+=2)Hh=zh[ud-2],Uh=zh[ud-1],Yh=zh[ud],Xh=zh[ud+1],jh=zh[ud+2],qh=zh[ud+3],Jh=Yh-Hh,td=Xh-Uh,ed=Je$2(Ze$2(Jh,2)+Ze$2(td,2)),id=Je$2(Ze$2(jh-Yh,2)+Ze$2(qh-Xh,2)),(ed||id)&&(sd=ed+id,ed=hd*ed/sd,id=hd*id/sd,jh-=Hh,qh-=Uh,Vh=Yh-ed*jh,Zh=Xh-ed*qh,ud===2?Wh||$h.push(ns$1,Vh,Zh,Yh,Xh):(Jh||td)&&$h.push(is$1,Kh,Qh,Vh,Zh,Yh,Xh),Kh=Yh+id*jh,Qh=Xh+id*qh);Wh||$h.push(ns$1,Kh,Qh,zh[nd-2],zh[nd-1])}else for(let Hh=2,Uh=zh.length;Hh<Uh;Hh+=2)$h.push(rs$1,zh[Hh],zh[Hh+1]);Wh&&$h.push(os$1)},rect($h,Th,Fh,Wh,zh){Ie$2.creator.path=$h,Ie$2.creator.moveTo(Th,Fh).lineTo(Th+Wh,Fh).lineTo(Th+Wh,Fh+zh).lineTo(Th,Fh+zh).lineTo(Th,Fh)},roundRect($h,Th,Fh,Wh,zh,Hh){Ie$2.creator.path=[],Fe$2.drawRoundRect(Ie$2.creator,Th,Fh,Wh,zh,Hh),$h.push(...Ie$2.convertToCanvasData(Ie$2.creator.path,!0))},arcTo($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh,qh){const Vh=Wh-Th,Zh=zh-Fh,Kh=Hh-Wh,Qh=Uh-zh;let Jh=He$2(Zh,Vh),td=He$2(Qh,Kh);const ed=Ve$2(Vh,Zh),id=Ve$2(Kh,Qh);let sd=td-Jh;if(sd<0&&(sd+=W$1),ed<1e-12||id<1e-12||sd<1e-12||qe$2(sd-Qe$2)<1e-12)return $h&&$h.push(rs$1,Wh,zh),Xh&&($e$2(Xh,Th,Fh),Ke$2(Xh,Wh,zh)),qh&&ts$1(qh,Th,Fh),void(jh&&ts$1(jh,Wh,zh));const nd=Vh*Qh-Kh*Zh<0,hd=nd?-1:1,ud=Yh/je$2(sd/2),rd=Wh+ud*je$2(Jh+sd/2+N$1*hd),ad=zh+ud*Ue$2(Jh+sd/2+N$1*hd);return Jh-=N$1*hd,td-=N$1*hd,cs($h,rd,ad,Yh,Yh,0,Jh/A,td/A,nd,Xh,jh,qh)},arc:($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh)=>cs($h,Th,Fh,Wh,Wh,0,zh,Hh,Uh,Yh,Xh,jh),ellipse($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh,qh,Vh){const Zh=Hh*A,Kh=Ue$2(Zh),Qh=je$2(Zh);let Jh=Uh*A,td=Yh*A;Jh>Qe$2&&(Jh-=W$1),td<0&&(td+=W$1);let ed=td-Jh;ed<0?ed+=W$1:ed>W$1&&(ed-=W$1),Xh&&(ed-=W$1);const id=Ge$2(qe$2(ed/N$1)),sd=ed/id,nd=Ue$2(sd/4),hd=8/3*nd*nd/Ue$2(sd/2);td=Jh+sd;let ud,rd,ad,dd,cd,od,ld,_d,md=je$2(Jh),gd=Ue$2(Jh),wd=ad=Qh*Wh*md-Kh*zh*gd,$d=dd=Kh*Wh*md+Qh*zh*gd,fd=Th+ad,vd=Fh+dd;$h&&$h.push($h.length?rs$1:ss$1,fd,vd),jh&&$e$2(jh,fd,vd),Vh&&ts$1(Vh,fd,vd);for(let yd=0;yd<id;yd++)ud=je$2(td),rd=Ue$2(td),ad=Qh*Wh*ud-Kh*zh*rd,dd=Kh*Wh*ud+Qh*zh*rd,cd=Th+wd-hd*(Qh*Wh*gd+Kh*zh*md),od=Fh+$d-hd*(Kh*Wh*gd-Qh*zh*md),ld=Th+ad+hd*(Qh*Wh*rd+Kh*zh*ud),_d=Fh+dd+hd*(Kh*Wh*rd-Qh*zh*ud),$h&&$h.push(is$1,cd,od,ld,_d,Th+ad,Fh+dd),jh&&ds(Th+wd,Fh+$d,cd,od,ld,_d,Th+ad,Fh+dd,jh,!0),wd=ad,$d=dd,md=ud,gd=rd,Jh=td,td+=sd;qh&&ts$1(qh,Th+ad,Fh+dd)},quadraticCurveTo($h,Th,Fh,Wh,zh,Hh,Uh){$h.push(is$1,(Th+2*Wh)/3,(Fh+2*zh)/3,(Hh+2*Wh)/3,(Uh+2*zh)/3,Hh,Uh)},toTwoPointBoundsByQuadraticCurve($h,Th,Fh,Wh,zh,Hh,Uh,Yh){ds($h,Th,($h+2*Fh)/3,(Th+2*Wh)/3,(zh+2*Fh)/3,(Hh+2*Wh)/3,zh,Hh,Uh,Yh)},toTwoPointBounds($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh){const qh=[];let Vh,Zh,Kh,Qh,Jh,td,ed,id,sd=$h,nd=Fh,hd=zh,ud=Uh;for(let rd=0;rd<2;++rd)if(rd==1&&(sd=Th,nd=Wh,hd=Hh,ud=Yh),Vh=-3*sd+9*nd-9*hd+3*ud,Zh=6*sd-12*nd+6*hd,Kh=3*nd-3*sd,Math.abs(Vh)<1e-12){if(Math.abs(Zh)<1e-12)continue;Qh=-Kh/Zh,0<Qh&&Qh<1&&qh.push(Qh)}else ed=Zh*Zh-4*Kh*Vh,id=Math.sqrt(ed),ed<0||(Jh=(-Zh+id)/(2*Vh),0<Jh&&Jh<1&&qh.push(Jh),td=(-Zh-id)/(2*Vh),0<td&&td<1&&qh.push(td));jh?Ke$2(Xh,$h,Th):$e$2(Xh,$h,Th),Ke$2(Xh,Uh,Yh);for(let rd=0,ad=qh.length;rd<ad;rd++)ls(qh[rd],$h,Th,Fh,Wh,zh,Hh,Uh,Yh,as$1),Ke$2(Xh,as$1.x,as$1.y)},getPointAndSet($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh){const qh=1-$h,Vh=qh*qh*qh,Zh=3*qh*qh*$h,Kh=3*qh*$h*$h,Qh=$h*$h*$h;jh.x=Vh*Th+Zh*Wh+Kh*Hh+Qh*Yh,jh.y=Vh*Fh+Zh*zh+Kh*Uh+Qh*Xh},getPoint($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh){const jh={};return ls($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh),jh},getDerivative($h,Th,Fh,Wh,zh){const Hh=1-$h;return 3*Hh*Hh*(Fh-Th)+6*Hh*$h*(Wh-Fh)+3*$h*$h*(zh-Wh)}},{getPointAndSet:ls,toTwoPointBounds:ds,ellipse:cs}=hs,{sin:us,cos:_s,sqrt:ps,atan2:fs}=Math,{ellipse:gs}=hs,ys={ellipticalArc($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh,qh){const Vh=(Xh-Th)/2,Zh=(jh-Fh)/2,Kh=Hh*A,Qh=us(Kh),Jh=_s(Kh),td=-Jh*Vh-Qh*Zh,ed=-Jh*Zh+Qh*Vh,id=Wh*Wh,sd=zh*zh,nd=ed*ed,hd=td*td,ud=id*sd-id*nd-sd*hd;let rd=0;if(ud<0){const wd=ps(1-ud/(id*sd));Wh*=wd,zh*=wd}else rd=(Uh===Yh?-1:1)*ps(ud/(id*nd+sd*hd));const ad=rd*Wh*ed/zh,dd=-rd*zh*td/Wh,cd=fs((ed-dd)/zh,(td-ad)/Wh),od=fs((-ed-dd)/zh,(-td-ad)/Wh);let ld=od-cd;Yh===0&&ld>0?ld-=W$1:Yh===1&&ld<0&&(ld+=W$1);const _d=Th+Vh+Jh*ad-Qh*dd,md=Fh+Zh+Qh*ad+Jh*dd,gd=ld<0?1:0;qh||$t$2.ellipseToCurve?gs($h,_d,md,Wh,zh,Hh,cd/A,od/A,gd):Wh!==zh||Hh?$h.push(Ae$2.G,_d,md,Wh,zh,Hh,cd/A,od/A,gd):$h.push(Ae$2.O,_d,md,Wh,cd/A,od/A,gd)}},ms={toCommand:$h=>[],toNode:$h=>[]},{M:xs,m:ws,L:bs,l:Bs,H:vs,h:ks,V:Cs,v:Os,C:Ts,c:Ps,S:Ss,s:Ls,Q:Rs,q:Es,T:Is,t:Ms,A:As,a:Ws,Z:Ns,z:Ys,N:Ds,D:Xs,X:zs,G:Fs,F:Us,O:js,P:Vs,U:Hs}=Ae$2,{rect:Gs,roundRect:qs,arcTo:Qs,arc:Js,ellipse:Zs,quadraticCurveTo:$s}=hs,{ellipticalArc:Ks}=ys,tr=ee$2.get("PathConvert"),er={},sr={current:{dot:0},stringify($h,Th){let Fh,Wh,zh,Hh=0,Uh=$h.length,Yh="";for(;Hh<Uh;){Wh=$h[Hh],Fh=ze$2[Wh],Yh+=Wh===zh?" ":Xe$2[Wh];for(let Xh=1;Xh<Fh;Xh++)Yh+=I$1.float($h[Hh+Xh],Th),Xh===Fh-1||(Yh+=" ");zh=Wh,Hh+=Fh}return Yh},parse($h,Th){let Fh,Wh,zh,Hh="";const Uh=[],Yh=Th?Ye$2:Ne$2;for(let Xh=0,jh=$h.length;Xh<jh;Xh++)Wh=$h[Xh],Qt$2[Wh]?(Wh==="."&&(rr.dot&&(ir(Uh,Hh),Hh=""),rr.dot++),Hh==="0"&&Wh!=="."&&(ir(Uh,Hh),Hh=""),Hh+=Wh):Ae$2[Wh]?(Hh&&(ir(Uh,Hh),Hh=""),rr.name=Ae$2[Wh],rr.length=We$2[Wh],rr.index=0,ir(Uh,rr.name),!Fh&&Yh[Wh]&&(Fh=!0)):Wh==="-"||Wh==="+"?zh==="e"||zh==="E"?Hh+=Wh:(Hh&&ir(Uh,Hh),Hh=Wh):Hh&&(ir(Uh,Hh),Hh=""),zh=Wh;return Hh&&ir(Uh,Hh),Fh?sr.toCanvasData(Uh,Th):Uh},toCanvasData($h,Th){let Fh,Wh,zh,Hh,Uh,Yh=0,Xh=0,jh=0,qh=0,Vh=0,Zh=$h.length;const Kh=[];for(;Vh<Zh;){switch(zh=$h[Vh],zh){case ws:$h[Vh+1]+=Yh,$h[Vh+2]+=Xh;case xs:Yh=$h[Vh+1],Xh=$h[Vh+2],Kh.push(xs,Yh,Xh),Vh+=3;break;case ks:$h[Vh+1]+=Yh;case vs:Yh=$h[Vh+1],Kh.push(bs,Yh,Xh),Vh+=2;break;case Os:$h[Vh+1]+=Xh;case Cs:Xh=$h[Vh+1],Kh.push(bs,Yh,Xh),Vh+=2;break;case Bs:$h[Vh+1]+=Yh,$h[Vh+2]+=Xh;case bs:Yh=$h[Vh+1],Xh=$h[Vh+2],Kh.push(bs,Yh,Xh),Vh+=3;break;case Ls:$h[Vh+1]+=Yh,$h[Vh+2]+=Xh,$h[Vh+3]+=Yh,$h[Vh+4]+=Xh,zh=Ss;case Ss:Uh=Hh===Ts||Hh===Ss,jh=Uh?2*Yh-Fh:$h[Vh+1],qh=Uh?2*Xh-Wh:$h[Vh+2],Fh=$h[Vh+1],Wh=$h[Vh+2],Yh=$h[Vh+3],Xh=$h[Vh+4],Kh.push(Ts,jh,qh,Fh,Wh,Yh,Xh),Vh+=5;break;case Ps:$h[Vh+1]+=Yh,$h[Vh+2]+=Xh,$h[Vh+3]+=Yh,$h[Vh+4]+=Xh,$h[Vh+5]+=Yh,$h[Vh+6]+=Xh,zh=Ts;case Ts:Fh=$h[Vh+3],Wh=$h[Vh+4],Yh=$h[Vh+5],Xh=$h[Vh+6],Kh.push(Ts,$h[Vh+1],$h[Vh+2],Fh,Wh,Yh,Xh),Vh+=7;break;case Ms:$h[Vh+1]+=Yh,$h[Vh+2]+=Xh,zh=Is;case Is:Uh=Hh===Rs||Hh===Is,Fh=Uh?2*Yh-Fh:$h[Vh+1],Wh=Uh?2*Xh-Wh:$h[Vh+2],Th?$s(Kh,Yh,Xh,Fh,Wh,$h[Vh+1],$h[Vh+2]):Kh.push(Rs,Fh,Wh,$h[Vh+1],$h[Vh+2]),Yh=$h[Vh+1],Xh=$h[Vh+2],Vh+=3;break;case Es:$h[Vh+1]+=Yh,$h[Vh+2]+=Xh,$h[Vh+3]+=Yh,$h[Vh+4]+=Xh,zh=Rs;case Rs:Fh=$h[Vh+1],Wh=$h[Vh+2],Th?$s(Kh,Yh,Xh,Fh,Wh,$h[Vh+3],$h[Vh+4]):Kh.push(Rs,Fh,Wh,$h[Vh+3],$h[Vh+4]),Yh=$h[Vh+3],Xh=$h[Vh+4],Vh+=5;break;case Ws:$h[Vh+6]+=Yh,$h[Vh+7]+=Xh;case As:Ks(Kh,Yh,Xh,$h[Vh+1],$h[Vh+2],$h[Vh+3],$h[Vh+4],$h[Vh+5],$h[Vh+6],$h[Vh+7],Th),Yh=$h[Vh+6],Xh=$h[Vh+7],Vh+=8;break;case Ys:case Ns:Kh.push(Ns),Vh++;break;case Ds:Yh=$h[Vh+1],Xh=$h[Vh+2],Th?Gs(Kh,Yh,Xh,$h[Vh+3],$h[Vh+4]):nr(Kh,$h,Vh,5),Vh+=5;break;case Xs:Yh=$h[Vh+1],Xh=$h[Vh+2],Th?qs(Kh,Yh,Xh,$h[Vh+3],$h[Vh+4],[$h[Vh+5],$h[Vh+6],$h[Vh+7],$h[Vh+8]]):nr(Kh,$h,Vh,9),Vh+=9;break;case zs:Yh=$h[Vh+1],Xh=$h[Vh+2],Th?qs(Kh,Yh,Xh,$h[Vh+3],$h[Vh+4],$h[Vh+5]):nr(Kh,$h,Vh,6),Vh+=6;break;case Fs:Zs(Th?Kh:nr(Kh,$h,Vh,9),$h[Vh+1],$h[Vh+2],$h[Vh+3],$h[Vh+4],$h[Vh+5],$h[Vh+6],$h[Vh+7],$h[Vh+8],null,er),Yh=er.x,Xh=er.y,Vh+=9;break;case Us:Th?Zs(Kh,$h[Vh+1],$h[Vh+2],$h[Vh+3],$h[Vh+4],0,0,360,!1):nr(Kh,$h,Vh,5),Yh=$h[Vh+1]+$h[Vh+3],Xh=$h[Vh+2],Vh+=5;break;case js:Js(Th?Kh:nr(Kh,$h,Vh,7),$h[Vh+1],$h[Vh+2],$h[Vh+3],$h[Vh+4],$h[Vh+5],$h[Vh+6],null,er),Yh=er.x,Xh=er.y,Vh+=7;break;case Vs:Th?Js(Kh,$h[Vh+1],$h[Vh+2],$h[Vh+3],0,360,!1):nr(Kh,$h,Vh,4),Yh=$h[Vh+1]+$h[Vh+3],Xh=$h[Vh+2],Vh+=4;break;case Hs:Qs(Th?Kh:nr(Kh,$h,Vh,6),Yh,Xh,$h[Vh+1],$h[Vh+2],$h[Vh+3],$h[Vh+4],$h[Vh+5],null,er),Yh=er.x,Xh=er.y,Vh+=6;break;default:return tr.error(`command: ${zh} [index:${Vh}]`,$h),Kh}Hh=zh}return Kh},objectToCanvasData($h){if($h[0].name.length>1)return ms.toCommand($h);{const Th=[];return $h.forEach(Fh=>{switch(Fh.name){case"M":Th.push(xs,Fh.x,Fh.y);break;case"L":Th.push(bs,Fh.x,Fh.y);break;case"C":Th.push(Ts,Fh.x1,Fh.y1,Fh.x2,Fh.y2,Fh.x,Fh.y);break;case"Q":Th.push(Rs,Fh.x1,Fh.y1,Fh.x,Fh.y);break;case"Z":Th.push(Ns)}}),Th}},copyData($h,Th,Fh,Wh){for(let zh=Fh,Hh=Fh+Wh;zh<Hh;zh++)$h.push(Th[zh])},pushData($h,Th){rr.index===rr.length&&(rr.index=1,$h.push(rr.name)),$h.push(Number(Th)),rr.index++,rr.dot=0}},{current:rr,pushData:ir,copyData:nr}=sr,{M:or,L:ar,C:hr,Q:lr,Z:dr,N:cr,D:ur,X:_r,G:pr,F:fr,O:gr,P:yr,U:mr}=Ae$2,{getMinDistanceFrom:xr,getRadianFrom:wr}=ot$2,{tan:br,min:Br,abs:vr}=Math,kr={},Cr={beginPath($h){$h.length=0},moveTo($h,Th,Fh){$h.push(or,Th,Fh)},lineTo($h,Th,Fh){$h.push(ar,Th,Fh)},bezierCurveTo($h,Th,Fh,Wh,zh,Hh,Uh){$h.push(hr,Th,Fh,Wh,zh,Hh,Uh)},quadraticCurveTo($h,Th,Fh,Wh,zh){$h.push(lr,Th,Fh,Wh,zh)},closePath($h){$h.push(dr)},rect($h,Th,Fh,Wh,zh){$h.push(cr,Th,Fh,Wh,zh)},roundRect($h,Th,Fh,Wh,zh,Hh){if(o(Hh))$h.push(_r,Th,Fh,Wh,zh,Hh);else{const Uh=I$1.fourNumber(Hh);Uh?$h.push(ur,Th,Fh,Wh,zh,...Uh):$h.push(cr,Th,Fh,Wh,zh)}},ellipse($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh){if(Wh===zh)return Tr($h,Th,Fh,Wh,Uh,Yh,Xh);r(Hh)?$h.push(fr,Th,Fh,Wh,zh):(r(Uh)&&(Uh=0),r(Yh)&&(Yh=360),$h.push(pr,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh?1:0))},arc($h,Th,Fh,Wh,zh,Hh,Uh){r(zh)?$h.push(yr,Th,Fh,Wh):(r(zh)&&(zh=0),r(Hh)&&(Hh=360),$h.push(gr,Th,Fh,Wh,zh,Hh,Uh?1:0))},arcTo($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh){if(!s(Uh)){const jh=xr(Uh,Yh,Th,Fh,Wh,zh)/(Xh?1:2);Hh=Br(Hh,Br(jh,jh*vr(br(wr(Uh,Yh,Th,Fh,Wh,zh)/2))))}$h.push(mr,Th,Fh,Wh,zh,Hh)},drawEllipse($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh){hs.ellipse(null,Th,Fh,Wh,zh,r(Hh)?0:Hh,r(Uh)?0:Uh,r(Yh)?360:Yh,Xh,null,null,kr),$h.push(or,kr.x,kr.y),Or($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh)},drawArc($h,Th,Fh,Wh,zh,Hh,Uh){hs.arc(null,Th,Fh,Wh,r(zh)?0:zh,r(Hh)?360:Hh,Uh,null,null,kr),$h.push(or,kr.x,kr.y),Tr($h,Th,Fh,Wh,zh,Hh,Uh)},drawPoints($h,Th,Fh,Wh){hs.points($h,Th,Fh,Wh)}},{ellipse:Or,arc:Tr}=Cr,{moveTo:Pr,lineTo:Sr,quadraticCurveTo:Lr,bezierCurveTo:Rr,closePath:Er,beginPath:Ir,rect:Mr,roundRect:Ar,ellipse:Wr,arc:Nr,arcTo:Yr,drawEllipse:Dr,drawArc:Xr,drawPoints:zr}=Cr;class Fr{set path(Th){this.__path=Th}get path(){return this.__path}constructor(Th){this.set(Th)}set(Th){return this.__path=Th?i(Th)?Ie$2.parse(Th):Th:[],this}beginPath(){return Ir(this.__path),this.paint(),this}moveTo(Th,Fh){return Pr(this.__path,Th,Fh),this.paint(),this}lineTo(Th,Fh){return Sr(this.__path,Th,Fh),this.paint(),this}bezierCurveTo(Th,Fh,Wh,zh,Hh,Uh){return Rr(this.__path,Th,Fh,Wh,zh,Hh,Uh),this.paint(),this}quadraticCurveTo(Th,Fh,Wh,zh){return Lr(this.__path,Th,Fh,Wh,zh),this.paint(),this}closePath(){return Er(this.__path),this.paint(),this}rect(Th,Fh,Wh,zh){return Mr(this.__path,Th,Fh,Wh,zh),this.paint(),this}roundRect(Th,Fh,Wh,zh,Hh){return Ar(this.__path,Th,Fh,Wh,zh,Hh),this.paint(),this}ellipse(Th,Fh,Wh,zh,Hh,Uh,Yh,Xh){return Wr(this.__path,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh),this.paint(),this}arc(Th,Fh,Wh,zh,Hh,Uh){return Nr(this.__path,Th,Fh,Wh,zh,Hh,Uh),this.paint(),this}arcTo(Th,Fh,Wh,zh,Hh){return Yr(this.__path,Th,Fh,Wh,zh,Hh),this.paint(),this}drawEllipse(Th,Fh,Wh,zh,Hh,Uh,Yh,Xh){return Dr(this.__path,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh),this.paint(),this}drawArc(Th,Fh,Wh,zh,Hh,Uh){return Xr(this.__path,Th,Fh,Wh,zh,Hh,Uh),this.paint(),this}drawPoints(Th,Fh,Wh){return zr(this.__path,Th,Fh,Wh),this.paint(),this}clearPath(){return this.beginPath()}paint(){}}const{M:Ur,L:jr,C:Vr,Q:Hr,Z:Gr,N:qr,D:Qr,X:Jr,G:Zr,F:$r,O:Kr,P:ti$2,U:ei$2}=Ae$2,si$2=ee$2.get("PathDrawer"),ri$2={drawPathByData($h,Th){if(!Th)return;let Fh,Wh=0,zh=Th.length;for(;Wh<zh;)switch(Fh=Th[Wh],Fh){case Ur:$h.moveTo(Th[Wh+1],Th[Wh+2]),Wh+=3;break;case jr:$h.lineTo(Th[Wh+1],Th[Wh+2]),Wh+=3;break;case Vr:$h.bezierCurveTo(Th[Wh+1],Th[Wh+2],Th[Wh+3],Th[Wh+4],Th[Wh+5],Th[Wh+6]),Wh+=7;break;case Hr:$h.quadraticCurveTo(Th[Wh+1],Th[Wh+2],Th[Wh+3],Th[Wh+4]),Wh+=5;break;case Gr:$h.closePath(),Wh+=1;break;case qr:$h.rect(Th[Wh+1],Th[Wh+2],Th[Wh+3],Th[Wh+4]),Wh+=5;break;case Qr:$h.roundRect(Th[Wh+1],Th[Wh+2],Th[Wh+3],Th[Wh+4],[Th[Wh+5],Th[Wh+6],Th[Wh+7],Th[Wh+8]]),Wh+=9;break;case Jr:$h.roundRect(Th[Wh+1],Th[Wh+2],Th[Wh+3],Th[Wh+4],Th[Wh+5]),Wh+=6;break;case Zr:$h.ellipse(Th[Wh+1],Th[Wh+2],Th[Wh+3],Th[Wh+4],Th[Wh+5]*A,Th[Wh+6]*A,Th[Wh+7]*A,Th[Wh+8]),Wh+=9;break;case $r:$h.ellipse(Th[Wh+1],Th[Wh+2],Th[Wh+3],Th[Wh+4],0,0,W$1,!1),Wh+=5;break;case Kr:$h.arc(Th[Wh+1],Th[Wh+2],Th[Wh+3],Th[Wh+4]*A,Th[Wh+5]*A,Th[Wh+6]),Wh+=7;break;case ti$2:$h.arc(Th[Wh+1],Th[Wh+2],Th[Wh+3],0,W$1,!1),Wh+=4;break;case ei$2:$h.arcTo(Th[Wh+1],Th[Wh+2],Th[Wh+3],Th[Wh+4],Th[Wh+5]),Wh+=6;break;default:return void si$2.error(`command: ${Fh} [index:${Wh}]`,Th)}}},{M:ii$2,L:ni$2,C:oi$2,Q:ai$2,Z:hi$2,N:li$2,D:di$2,X:ci$1,G:ui$1,F:_i$2,O:pi$1,P:fi$1,U:gi$1}=Ae$2,{toTwoPointBounds:yi$1,toTwoPointBoundsByQuadraticCurve:mi$1,arcTo:xi$1,arc:wi$1,ellipse:bi$1}=hs,{addPointBounds:Bi$1,copy:vi$1,addPoint:ki$1,setPoint:Ci$1,addBounds:Oi$1,toBounds:Ti$1}=gt$2,Pi$1=ee$2.get("PathBounds");let Si$1,Li$1,Ri$1;const Ei$1={},Ii$1={},Mi$1={},Ai$1={toBounds($h,Th){Ai$1.toTwoPointBounds($h,Ii$1),Ti$1(Ii$1,Th)},toTwoPointBounds($h,Th){if(!$h||!$h.length)return Ci$1(Th,0,0);let Fh,Wh,zh,Hh,Uh,Yh=0,Xh=0,jh=0;const qh=$h.length;for(;Yh<qh;)switch(Uh=$h[Yh],Yh===0&&(Uh===hi$2||Uh===oi$2||Uh===ai$2?Ci$1(Th,Xh,jh):Ci$1(Th,$h[Yh+1],$h[Yh+2])),Uh){case ii$2:case ni$2:Xh=$h[Yh+1],jh=$h[Yh+2],ki$1(Th,Xh,jh),Yh+=3;break;case oi$2:zh=$h[Yh+5],Hh=$h[Yh+6],yi$1(Xh,jh,$h[Yh+1],$h[Yh+2],$h[Yh+3],$h[Yh+4],zh,Hh,Ei$1),Bi$1(Th,Ei$1),Xh=zh,jh=Hh,Yh+=7;break;case ai$2:Fh=$h[Yh+1],Wh=$h[Yh+2],zh=$h[Yh+3],Hh=$h[Yh+4],mi$1(Xh,jh,Fh,Wh,zh,Hh,Ei$1),Bi$1(Th,Ei$1),Xh=zh,jh=Hh,Yh+=5;break;case hi$2:Yh+=1;break;case li$2:Xh=$h[Yh+1],jh=$h[Yh+2],Oi$1(Th,Xh,jh,$h[Yh+3],$h[Yh+4]),Yh+=5;break;case di$2:case ci$1:Xh=$h[Yh+1],jh=$h[Yh+2],Oi$1(Th,Xh,jh,$h[Yh+3],$h[Yh+4]),Yh+=Uh===di$2?9:6;break;case ui$1:bi$1(null,$h[Yh+1],$h[Yh+2],$h[Yh+3],$h[Yh+4],$h[Yh+5],$h[Yh+6],$h[Yh+7],$h[Yh+8],Ei$1,Mi$1),Yh===0?vi$1(Th,Ei$1):Bi$1(Th,Ei$1),Xh=Mi$1.x,jh=Mi$1.y,Yh+=9;break;case _i$2:Xh=$h[Yh+1],jh=$h[Yh+2],Li$1=$h[Yh+3],Ri$1=$h[Yh+4],Oi$1(Th,Xh-Li$1,jh-Ri$1,2*Li$1,2*Ri$1),Xh+=Li$1,Yh+=5;break;case pi$1:wi$1(null,$h[Yh+1],$h[Yh+2],$h[Yh+3],$h[Yh+4],$h[Yh+5],$h[Yh+6],Ei$1,Mi$1),Yh===0?vi$1(Th,Ei$1):Bi$1(Th,Ei$1),Xh=Mi$1.x,jh=Mi$1.y,Yh+=7;break;case fi$1:Xh=$h[Yh+1],jh=$h[Yh+2],Si$1=$h[Yh+3],Oi$1(Th,Xh-Si$1,jh-Si$1,2*Si$1,2*Si$1),Xh+=Si$1,Yh+=4;break;case gi$1:xi$1(null,Xh,jh,$h[Yh+1],$h[Yh+2],$h[Yh+3],$h[Yh+4],$h[Yh+5],Ei$1,Mi$1),Yh===0?vi$1(Th,Ei$1):Bi$1(Th,Ei$1),Xh=Mi$1.x,jh=Mi$1.y,Yh+=6;break;default:return void Pi$1.error(`command: ${Uh} [index:${Yh}]`,$h)}}},{M:Wi$1,L:Ni$1,Z:Yi$1}=Ae$2,{getCenterX:Di$1,getCenterY:Xi$1}=ot$2,{arcTo:zi$1}=Cr,Fi$1={smooth($h,Th,Fh){let Wh,zh,Hh,Uh=0,Yh=0,Xh=0,jh=0,qh=0,Vh=0,Zh=0,Kh=0,Qh=0;l(Th)&&(Th=Th[0]||0);const Jh=$h.length,td=Jh===9,ed=[];for(;Uh<Jh;){switch(Wh=$h[Uh],Wh){case Wi$1:jh=Kh=$h[Uh+1],qh=Qh=$h[Uh+2],Uh+=3,$h[Uh]===Ni$1?(Vh=$h[Uh+1],Zh=$h[Uh+2],td?ed.push(Wi$1,jh,qh):ed.push(Wi$1,Di$1(jh,Vh),Xi$1(qh,Zh))):ed.push(Wi$1,jh,qh);break;case Ni$1:switch(Yh=$h[Uh+1],Xh=$h[Uh+2],Uh+=3,$h[Uh]){case Ni$1:zi$1(ed,Yh,Xh,$h[Uh+1],$h[Uh+2],Th,Kh,Qh,td);break;case Yi$1:zi$1(ed,Yh,Xh,jh,qh,Th,Kh,Qh,td);break;default:ed.push(Ni$1,Yh,Xh)}Kh=Yh,Qh=Xh;break;case Yi$1:zh!==Yi$1&&(zi$1(ed,jh,qh,Vh,Zh,Th,Kh,Qh,td),ed.push(Yi$1)),Uh+=1;break;default:Hh=ze$2[Wh];for(let id=0;id<Hh;id++)ed.push($h[Uh+id]);Uh+=Hh}zh=Wh}return Wh!==Yi$1&&(ed[1]=jh,ed[2]=qh),ed}};function Ui$1($h){return new Fr($h)}const ji$1=Ui$1();Ie$2.creator=Ui$1(),Ie$2.parse=sr.parse,Ie$2.convertToCanvasData=sr.toCanvasData;const{drawRoundRect:Vi$1}=Fe$2;function Hi$1($h){(function(Th){Th&&!Th.roundRect&&(Th.roundRect=function(Fh,Wh,zh,Hh,Uh){Vi$1(this,Fh,Wh,zh,Hh,Uh)})})($h)}const Gi$1={alphaPixelTypes:["png","webp","svg"],upperCaseTypeMap:{},mimeType:($h,Th="image")=>!$h||$h.startsWith(Th)?$h:($h==="jpg"&&($h="jpeg"),Th+"/"+$h),fileType($h){const Th=$h.split(".");return Th[Th.length-1]},isOpaqueImage($h){const Th=qi$1.fileType($h);return["jpg","jpeg"].some(Fh=>Fh===Th)},getExportOptions($h){switch(typeof $h){case"object":return $h;case"number":return{quality:$h};case"boolean":return{blob:$h};default:return{}}}},qi$1=Gi$1;qi$1.mineType=qi$1.mimeType,qi$1.alphaPixelTypes.forEach($h=>qi$1.upperCaseTypeMap[$h]=$h.toUpperCase());const Qi$1=ee$2.get("TaskProcessor");let Ji$1=class{constructor($h){this.parallel=!0,this.time=1,this.id=g.create(g.TASK),this.task=$h}run(){return me$2(this,void 0,void 0,function*(){try{if(this.isComplete||this.runing)return;if(this.runing=!0,this.canUse&&!this.canUse())return this.cancel();this.task&&(yield this.task())}catch($h){Qi$1.error($h)}})}complete(){this.isComplete=!0,this.parent=this.task=this.canUse=null}cancel(){this.isCancel=!0,this.complete()}},Zi$1=class{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:$h}=this;let Th=0,Fh=0;for(let Wh=0;Wh<$h;Wh++)Wh<=this.finishedIndex?(Fh+=this.list[Wh].time,Wh===this.finishedIndex&&(Th=Fh)):Th+=this.list[Wh].time;return this.isComplete?1:Fh/Th}constructor($h){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,$h&&_.assign(this.config,$h),this.empty()}add($h,Th,Fh){let Wh,zh,Hh,Uh;const Yh=new Ji$1($h);return Yh.parent=this,o(Th)?Uh=Th:Th&&(zh=Th.parallel,Wh=Th.start,Hh=Th.time,Uh=Th.delay,Fh||(Fh=Th.canUse)),Hh&&(Yh.time=Hh),zh===!1&&(Yh.parallel=!1),Fh&&(Yh.canUse=Fh),s(Uh)?this.push(Yh,Wh):(this.delayNumber++,setTimeout(()=>{this.delayNumber&&(this.delayNumber--,this.push(Yh,Wh))},Uh)),this.isComplete=!1,Yh}push($h,Th){this.list.push($h),Th===!1||this.timer||(this.timer=setTimeout(()=>this.start()))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach($h=>{$h.isComplete||$h.run()}),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const $h=this.list[this.index];$h?$h.run().then(()=>{this.onTask($h),this.index++,$h.isCancel?this.runTask():this.nextTask()}).catch(Th=>{this.onError(Th)}):this.timer=setTimeout(()=>this.nextTask())}runParallelTasks(){this.parallelList.forEach($h=>this.runParallelTask($h))}runParallelTask($h){$h.run().then(()=>{this.onTask($h),this.fillParallelTask()}).catch(Th=>{this.onParallelError(Th)})}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout(()=>this.run())}setParallelList(){let $h;const{config:Th,list:Fh,index:Wh}=this;this.parallelList=[],this.parallelSuccessNumber=0;let zh=Wh+Th.parallel;if(zh>Fh.length&&(zh=Fh.length),Th.parallel>1)for(let Hh=Wh;Hh<zh&&($h=Fh[Hh],$h.parallel);Hh++)this.parallelList.push($h)}fillParallelTask(){let $h;const Th=this.parallelList;this.parallelSuccessNumber++,Th.pop();const Fh=Th.length,Wh=this.finishedIndex+Fh;if(Th.length){if(!this.running)return;Wh<this.total&&($h=this.list[Wh],$h&&$h.parallel&&(Th.push($h),this.runParallelTask($h)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask($h){$h.complete(),this.config.onTask&&this.config.onTask()}onParallelError($h){this.parallelList.forEach(Th=>{Th.parallel=!1}),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError($h)}onError($h){this.pause(),this.config.onError&&this.config.onError($h)}destroy(){this.stop()}};const $i$1=ee$2.get("Resource"),Ki$1={tasker:new Zi$1,queue:new Zi$1({parallel:1}),map:{},get isComplete(){return tn.tasker.isComplete},set($h,Th){tn.map[$h]&&$i$1.repeat($h),tn.map[$h]=Th},get:$h=>tn.map[$h],remove($h){const Th=tn.map[$h];Th&&(Th.destroy&&Th.destroy(),delete tn.map[$h])},loadImage($h,Th){return new Promise((Fh,Wh)=>{const zh=this.setImage($h,$h,Th);zh.load(()=>Fh(zh),Hh=>Wh(Hh))})},setImage($h,Th,Fh){let Wh;return i(Th)?Wh={url:Th}:Th.url||(Wh={url:$h,view:Th}),Wh&&(Fh&&(Wh.format=Fh),Th=le$2.image(Wh)),tn.set($h,Th),Th},loadFilm($h,Th){},loadVideo($h,Th){},destroy(){tn.map={}}},tn=Ki$1,en={maxRecycled:10,recycledList:[],patternTasker:Ki$1.queue,get($h,Th){let Fh=Ki$1.get($h.url);return Fh||Ki$1.set($h.url,Fh=Th==="film"?le$2.film($h):le$2.image($h)),Fh.use++,Fh},recycle($h){$h.use--,setTimeout(()=>{$h.use||($t$2.image.isLarge($h)?$h.url&&Ki$1.remove($h.url):($h.clearLevels(),sn.recycledList.push($h)))})},recyclePaint($h){sn.recycle($h.image)},clearRecycled($h){const Th=sn.recycledList;(Th.length>sn.maxRecycled||$h)&&(Th.forEach(Fh=>(!Fh.use||$h)&&Fh.url&&Ki$1.remove(Fh.url)),Th.length=0)},clearLevels(){},hasAlphaPixel:$h=>Gi$1.alphaPixelTypes.some(Th=>sn.isFormat(Th,$h)),isFormat($h,Th){if(Th.format)return Th.format===$h;const{url:Fh}=Th;if(Fh.startsWith("data:")){if(Fh.startsWith("data:"+Gi$1.mimeType($h)))return!0}else if(Fh.includes("."+$h)||Fh.includes("."+Gi$1.upperCaseTypeMap[$h])||$h==="png"&&!Fh.includes("."))return!0;return!1},destroy(){this.clearRecycled(!0)}},sn=en,{IMAGE:rn,create:nn}=g;class on{get tag(){return"Image"}get url(){return this.config.url}get crossOrigin(){const{crossOrigin:Th}=this.config;return s(Th)?$t$2.image.crossOrigin:Th}get completed(){return this.ready||!!this.error}constructor(Th){if(this.use=0,this.waitComplete=[],this.innerId=nn(rn),this.config=Th||(Th={url:""}),Th.view){const{view:Fh}=Th;this.setView(Fh.config?Fh.view:Fh)}en.isFormat("svg",Th)&&(this.isSVG=!0),en.hasAlphaPixel(Th)&&(this.hasAlphaPixel=!0)}load(Th,Fh,Wh){return this.loading||(this.loading=!0,Ki$1.tasker.add(()=>me$2(this,void 0,void 0,function*(){return yield $t$2.origin["load"+this.tag](this.getLoadUrl(Wh),this.crossOrigin,this).then(zh=>{Wh&&this.setThumbView(zh),this.setView(zh)}).catch(zh=>{this.error=zh,this.onComplete(!1)})}))),this.waitComplete.push(Th,Fh),this.waitComplete.length-2}unload(Th,Fh){const Wh=this.waitComplete;if(Fh){const zh=Wh[Th+1];zh&&zh({type:"stop"})}Wh[Th]=Wh[Th+1]=void 0}setView(Th){this.ready=!0,this.width||(this.width=Th.width,this.height=Th.height,this.view=Th),this.onComplete(!0)}onComplete(Th){let Fh;this.waitComplete.forEach((Wh,zh)=>{Fh=zh%2,Wh&&(Th?Fh||Wh(this):Fh&&Wh(this.error))}),this.waitComplete.length=0,this.loading=!1}getFull(Th){return this.view}getCanvas(Th,Fh,Wh,zh,Hh,Uh,Yh,Xh){if(Th||(Th=this.width),Fh||(Fh=this.height),this.cache){let{params:qh,data:Vh}=this.cache;for(let Zh in qh)if(qh[Zh]!==arguments[Zh]){Vh=null;break}if(Vh)return Vh}const jh=$t$2.image.resize(this.view,Th,Fh,Hh,Uh,void 0,Yh,Wh,zh,Xh);return this.cache=this.use>1?{data:jh,params:arguments}:null,jh}getPattern(Th,Fh,Wh,zh){const Hh=$t$2.canvas.createPattern(Th,Fh);return $t$2.image.setPatternTransform(Hh,Wh,zh),Hh}render(Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh){Th.drawImage(this.view,Fh,Wh,zh,Hh)}getLoadUrl(Th){return this.url}setThumbView(Th){}getThumbSize(Th){}getMinLevel(){}getLevelData(Th,Fh,Wh){}clearLevels(Th){}destroy(){this.clearLevels();const{view:Th}=this;Th&&Th.close&&Th.close(),this.config={url:""},this.cache=this.view=null,this.waitComplete.length=0}}class an extends on{get tag(){return"Film"}}class hn extends on{get tag(){return"Video"}}function ln($h,Th,Fh,Wh){Wh||(Fh.configurable=Fh.enumerable=!0),Object.defineProperty($h,Th,Fh)}function dn($h,Th){return Object.getOwnPropertyDescriptor($h,Th)}function cn($h,Th){const Fh="_"+$h;return{get(){const Wh=this[Fh];return Wh==null?Th:Wh},set(Wh){this[Fh]=Wh}}}function un($h,Th){return(Fh,Wh)=>pn(Fh,Wh,$h,Th&&Th(Wh))}function _n($h){return $h}function pn($h,Th,Fh,Wh){ln($h,Th,Object.assign({get(){return this.__getAttr(Th)},set(zh){this.__setAttr(Th,zh)}},Wh||{})),Un($h,Th,Fh)}function fn($h){return un($h)}function gn($h,Th){return un($h,Fh=>({set(Wh){this.__setAttr(Fh,Wh,Th)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}}))}function yn($h,Th){return un($h,Fh=>({set(Wh){this.__setAttr(Fh,Wh,Th)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__scrollWorld||(this.__scrollWorld={}))}}))}function mn($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh)&&(this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal(),vn(this))}}))}function xn($h,Th){return un($h,Fh=>({set(Wh){this.__setAttr(Fh,Wh,Th)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}}))}function wn($h,Th){return un($h,Fh=>({set(Wh){this.__setAttr(Fh,Wh,Th)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}}))}function bn($h,Th){return un($h,Fh=>({set(Wh){this.__setAttr(Fh,Wh,Th)&&vn(this)}}))}function Bn($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh)&&(vn(this),this.__.__removeNaturalSize())}}))}function vn($h){$h.__layout.boxChanged||$h.__layout.boxChange(),$h.__hasAutoLayout&&($h.__layout.matrixChanged||$h.__layout.matrixChange())}function kn($h){return un($h,Th=>({set(Fh){const Wh=this.__;Wh.__pathInputed!==2&&(Wh.__pathInputed=Fh?1:0),Fh||(Wh.__pathForRender=void 0),this.__setAttr(Th,Fh),vn(this)}}))}const Cn=bn;function On($h,Th){return un($h,Fh=>({set(Wh){this.__setAttr(Fh,Wh)&&(Tn(this),Th&&(this.__.__useStroke=!0))}}))}function Tn($h){$h.__layout.strokeChanged||$h.__layout.strokeChange(),$h.__.__useArrow&&vn($h)}const Pn=On;function Sn($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Ln($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}}))}function Rn($h){return un($h,Th=>({set(Fh){if(this.__setAttr(Th,Fh)){const Wh=this.__;_.stintSet(Wh,"__useDim",Wh.dim||Wh.bright||Wh.dimskip),this.__layout.surfaceChange()}}}))}function En($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh)&&(this.__layout.opacityChanged||this.__layout.opacityChange()),this.mask&&Mn(this)}}))}function In($h){return un($h,Th=>({set(Fh){const Wh=this.visible;if(Wh===!0&&Fh===0){if(this.animationOut)return this.__runAnimation("out",()=>An(this,Th,Fh,Wh))}else Wh===0&&Fh===!0&&this.animation&&this.__runAnimation("in");An(this,Th,Fh,Wh),this.mask&&Mn(this)}}))}function Mn($h){const{parent:Th}=$h;if(Th){const{__hasMask:Fh}=Th;Th.__updateMask(),Fh!==Th.__hasMask&&Th.forceUpdate()}}function An($h,Th,Fh,Wh){$h.__setAttr(Th,Fh)&&($h.__layout.opacityChanged||$h.__layout.opacityChange(),Wh!==0&&Fh!==0||vn($h))}function Wn($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh)&&(this.__layout.surfaceChange(),this.waitParent(()=>{this.parent.__layout.childrenSortChange()}))}}))}function Nn($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent(()=>{this.parent.__updateMask(Fh)}))}}))}function Yn($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh)&&this.waitParent(()=>{this.parent.__updateEraser(Fh)})}}))}function Dn($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh)&&(this.__layout.hitCanvasChanged=!0,ee$2.showBounds==="hit"&&this.__layout.surfaceChange(),this.leafer&&this.leafer.updateCursor())}}))}function Xn($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh),this.leafer&&this.leafer.updateCursor()}}))}function zn($h){return(Th,Fh)=>{ln(Th,"__DataProcessor",{get:()=>$h})}}function Fn($h){return(Th,Fh)=>{ln(Th,"__LayoutProcessor",{get:()=>$h})}}function Un($h,Th,Fh){const Wh=$h.__DataProcessor.prototype,zh="_"+Th,Hh=(function(qh){return"set"+qh.charAt(0).toUpperCase()+qh.slice(1)})(Th),Uh=cn(Th,Fh);if(s(Fh))Uh.get=function(){return this[zh]};else if(typeof Fh=="function")Uh.get=function(){const qh=this[zh];return qh==null?Fh(this.__leaf):qh};else if(d(Fh)){const qh=u(Fh);Uh.get=function(){const Vh=this[zh];return Vh==null?this[zh]=qh?{}:_.clone(Fh):Vh}}const Yh=$h.isBranchLeaf;Th==="width"?Uh.get=function(){const qh=this[zh];if(qh==null){const Vh=this,Zh=Vh.__naturalWidth,Kh=Vh.__leaf;return!Fh||Kh.pathInputed?Kh.boxBounds.width:Zh?Vh._height&&Vh.__useNaturalRatio?Vh._height*Zh/Vh.__naturalHeight:Zh:Yh&&Kh.children.length?Kh.boxBounds.width:Fh}return qh}:Th==="height"&&(Uh.get=function(){const qh=this[zh];if(qh==null){const Vh=this,Zh=Vh.__naturalHeight,Kh=Vh.__leaf;return!Fh||Kh.pathInputed?Kh.boxBounds.height:Zh?Vh._width&&Vh.__useNaturalRatio?Vh._width*Zh/Vh.__naturalWidth:Zh:Yh&&Kh.children.length?Kh.boxBounds.height:Fh}return qh});let Xh,jh=Wh;for(;!Xh&&jh;)Xh=dn(jh,Th),jh=jh.__proto__;Xh&&Xh.set&&(Uh.set=Xh.set),Wh[Hh]&&(Uh.set=Wh[Hh],delete Wh[Hh]),ln(Wh,Th,Uh)}const jn=new ee$2("rewrite"),Vn=[],Hn=["destroy","constructor"];function Gn($h){return(Th,Fh)=>{Vn.push({name:Th.constructor.name+"."+Fh,run:()=>{Th[Fh]=$h}})}}function qn(){return $h=>{Qn()}}function Qn($h){Vn.length&&(Vn.forEach(Th=>{$h&&jn.error(Th.name,"\u9700\u5728Class\u4E0A\u88C5\u9970@rewriteAble()"),Th.run()}),Vn.length=0)}function Jn($h,Th){return Fh=>{var Wh;($h.prototype?(Wh=$h.prototype,Object.getOwnPropertyNames(Wh)):Object.keys($h)).forEach(zh=>{Hn.includes(zh)||Th&&Th.includes(zh)||($h.prototype?dn($h.prototype,zh).writable&&(Fh.prototype[zh]=$h.prototype[zh]):Fh.prototype[zh]=$h[zh])})}}function Zn(){return $h=>{ce$2.register($h)}}function $n(){return $h=>{pe$2.register($h)}}setTimeout(()=>Qn(!0));const{copy:Kn,toInnerPoint:to,toOuterPoint:eo,scaleOfOuter:so,rotateOfOuter:ro,skewOfOuter:io,multiplyParent:no,divideParent:oo,getLayout:ao}=q$1,ho={},{round:lo}=Math,co={updateAllMatrix($h,Th,Fh){if(Th&&$h.__hasAutoLayout&&$h.__layout.matrixChanged&&(Fh=!0),po($h,Th,Fh),$h.isBranch){const{children:Wh}=$h;for(let zh=0,Hh=Wh.length;zh<Hh;zh++)_o(Wh[zh],Th,Fh)}},updateMatrix($h,Th,Fh){const Wh=$h.__layout;Th?Fh&&(Wh.waitAutoLayout=!0,$h.__hasAutoLayout&&(Wh.matrixChanged=!1)):Wh.waitAutoLayout&&(Wh.waitAutoLayout=!1),Wh.matrixChanged&&$h.__updateLocalMatrix(),Wh.waitAutoLayout||$h.__updateWorldMatrix()},updateBounds($h){const Th=$h.__layout;Th.boundsChanged&&$h.__updateLocalBounds(),Th.waitAutoLayout||$h.__updateWorldBounds()},updateAllWorldOpacity($h){if($h.__updateWorldOpacity(),$h.isBranch){const{children:Th}=$h;for(let Fh=0,Wh=Th.length;Fh<Wh;Fh++)fo(Th[Fh])}},updateChange($h){const Th=$h.__layout;Th.stateStyleChanged&&$h.updateState(),Th.opacityChanged&&fo($h),$h.__updateChange()},updateAllChange($h){if(yo($h),$h.isBranch){const{children:Th}=$h;for(let Fh=0,Wh=Th.length;Fh<Wh;Fh++)go(Th[Fh])}},worldHittable($h){for(;$h;){if(!$h.__.hittable)return!1;$h=$h.parent}return!0},draggable:$h=>($h.draggable||$h.editable)&&$h.hitSelf&&!$h.locked,copyCanvasByWorld($h,Th,Fh,Wh,zh,Hh){Wh||(Wh=$h.__nowWorld),$h.__worldFlipped||$t$2.fullImageShadow?Th.copyWorldByReset(Fh,Wh,$h.__nowWorld,zh,Hh):Th.copyWorldToInner(Fh,Wh,$h.__layout.renderBounds,zh)},moveWorld($h,Th,Fh=0,Wh,zh){const Hh=d(Th)?Object.assign({},Th):{x:Th,y:Fh};Wh?eo($h.localTransform,Hh,Hh,!0):$h.parent&&to($h.parent.scrollWorldTransform,Hh,Hh,!0),uo.moveLocal($h,Hh.x,Hh.y,zh)},moveLocal($h,Th,Fh=0,Wh){d(Th)&&(Fh=Th.y,Th=Th.x),Th+=$h.x,Fh+=$h.y,$h.leafer&&$h.leafer.config.pointSnap&&(Th=lo(Th),Fh=lo(Fh)),Wh?$h.animate({x:Th,y:Fh},Wh):($h.x=Th,$h.y=Fh)},zoomOfWorld($h,Th,Fh,Wh,zh,Hh){uo.zoomOfLocal($h,mo($h,Th),Fh,Wh,zh,Hh)},zoomOfLocal($h,Th,Fh,Wh=Fh,zh,Hh){const Uh=$h.__localMatrix;if(o(Wh)||(Wh&&(Hh=Wh),Wh=Fh),Kn(ho,Uh),so(ho,Th,Fh,Wh),uo.hasHighPosition($h))uo.setTransform($h,ho,zh,Hh);else{const Yh=$h.x+ho.e-Uh.e,Xh=$h.y+ho.f-Uh.f;Hh&&!zh?$h.animate({x:Yh,y:Xh,scaleX:$h.scaleX*Fh,scaleY:$h.scaleY*Wh},Hh):($h.x=Yh,$h.y=Xh,$h.scaleResize(Fh,Wh,zh!==!0))}},rotateOfWorld($h,Th,Fh,Wh){uo.rotateOfLocal($h,mo($h,Th),Fh,Wh)},rotateOfLocal($h,Th,Fh,Wh){const zh=$h.__localMatrix;Kn(ho,zh),ro(ho,Th,Fh),uo.hasHighPosition($h)?uo.setTransform($h,ho,!1,Wh):$h.set({x:$h.x+ho.e-zh.e,y:$h.y+ho.f-zh.f,rotation:I$1.formatRotation($h.rotation+Fh)},Wh)},skewOfWorld($h,Th,Fh,Wh,zh,Hh){uo.skewOfLocal($h,mo($h,Th),Fh,Wh,zh,Hh)},skewOfLocal($h,Th,Fh,Wh=0,zh,Hh){Kn(ho,$h.__localMatrix),io(ho,Th,Fh,Wh),uo.setTransform($h,ho,zh,Hh)},transformWorld($h,Th,Fh,Wh){Kn(ho,$h.worldTransform),no(ho,Th),$h.parent&&oo(ho,$h.parent.scrollWorldTransform),uo.setTransform($h,ho,Fh,Wh)},transform($h,Th,Fh,Wh){Kn(ho,$h.localTransform),no(ho,Th),uo.setTransform($h,ho,Fh,Wh)},setTransform($h,Th,Fh,Wh){const zh=$h.__,Hh=zh.origin&&uo.getInnerOrigin($h,zh.origin),Uh=ao(Th,Hh,zh.around&&uo.getInnerOrigin($h,zh.around));if(uo.hasOffset($h)&&(Uh.x-=zh.offsetX,Uh.y-=zh.offsetY),Fh){const Yh=Uh.scaleX/$h.scaleX,Xh=Uh.scaleY/$h.scaleY;if(delete Uh.scaleX,delete Uh.scaleY,Hh){zt$2.scale($h.boxBounds,Math.abs(Yh),Math.abs(Xh));const jh=uo.getInnerOrigin($h,zh.origin);ot$2.move(Uh,Hh.x-jh.x,Hh.y-jh.y)}$h.set(Uh),$h.scaleResize(Yh,Xh,!1)}else $h.set(Uh,Wh)},getFlipTransform($h,Th){const Fh={a:1,b:0,c:0,d:1,e:0,f:0},Wh=Th==="x"?1:-1;return so(Fh,uo.getLocalOrigin($h,"center"),-1*Wh,1*Wh),Fh},getLocalOrigin:($h,Th)=>ot$2.tempToOuterOf(uo.getInnerOrigin($h,Th),$h.localTransform),getInnerOrigin($h,Th){const Fh={};return bt$3.toPoint(Th,$h.boxBounds,Fh),Fh},getRelativeWorld:($h,Th,Fh)=>(Kn(ho,$h.worldTransform),oo(ho,Th.scrollWorldTransform),Fh?ho:Object.assign({},ho)),drop($h,Th,Fh,Wh){$h.setTransform(uo.getRelativeWorld($h,Th,!0),Wh),Th.add($h,Fh)},hasHighPosition:$h=>$h.origin||$h.around||uo.hasOffset($h),hasOffset:$h=>$h.offsetX||$h.offsetY,hasParent($h,Th){if(!Th)return!1;for(;$h;){if(Th===$h)return!0;$h=$h.parent}},animateMove($h,Th,Fh=.3){if(Th.x||Th.y)if(Math.abs(Th.x)<1&&Math.abs(Th.y)<1)$h.move(Th);else{const Wh=Th.x*Fh,zh=Th.y*Fh;Th.x-=Wh,Th.y-=zh,$h.move(Wh,zh),$t$2.requestRender(()=>uo.animateMove($h,Th,Fh))}}},uo=co,{updateAllMatrix:_o,updateMatrix:po,updateAllWorldOpacity:fo,updateAllChange:go,updateChange:yo}=uo;function mo($h,Th){return $h.updateLayout(),$h.parent?ot$2.tempToInnerOf(Th,$h.parent.scrollWorldTransform):Th}const xo={worldBounds:$h=>$h.__world,localBoxBounds:$h=>$h.__.eraser||$h.__.visible===0?null:$h.__local||$h.__layout,localStrokeBounds:$h=>$h.__.eraser||$h.__.visible===0?null:$h.__layout.localStrokeBounds,localRenderBounds:$h=>$h.__.eraser||$h.__.visible===0?null:$h.__layout.localRenderBounds,maskLocalBoxBounds:($h,Th)=>bo($h,Th)&&$h.__localBoxBounds,maskLocalStrokeBounds:($h,Th)=>bo($h,Th)&&$h.__layout.localStrokeBounds,maskLocalRenderBounds:($h,Th)=>bo($h,Th)&&$h.__layout.localRenderBounds,excludeRenderBounds:($h,Th)=>!(!Th.bounds||Th.bounds.hit($h.__world,Th.matrix))||!(!Th.hideBounds||!Th.hideBounds.includes($h.__world,Th.matrix))};let wo;function bo($h,Th){return Th||(wo=0),$h.__.mask&&(wo=1),wo<0?null:(wo&&(wo=-1),!0)}const{updateBounds:Bo}=co,vo={sort:($h,Th)=>$h.__.zIndex===Th.__.zIndex?$h.__tempNumber-Th.__tempNumber:$h.__.zIndex-Th.__.zIndex,pushAllChildBranch($h,Th){if($h.__tempNumber=1,$h.__.__childBranchNumber){const{children:Fh}=$h;for(let Wh=0,zh=Fh.length;Wh<zh;Wh++)($h=Fh[Wh]).isBranch&&($h.__tempNumber=1,Th.add($h),ko($h,Th))}},pushAllParent($h,Th){const{keys:Fh}=Th;if(Fh)for(;$h.parent&&s(Fh[$h.parent.innerId]);)Th.add($h.parent),$h=$h.parent;else for(;$h.parent;)Th.add($h.parent),$h=$h.parent},pushAllBranchStack($h,Th){let Fh=Th.length;const{children:Wh}=$h;for(let zh=0,Hh=Wh.length;zh<Hh;zh++)Wh[zh].isBranch&&Th.push(Wh[zh]);for(let zh=Fh,Hh=Th.length;zh<Hh;zh++)Co(Th[zh],Th)},updateBounds($h,Th){const Fh=[$h];Co($h,Fh),Oo(Fh,Th)},updateBoundsByBranchStack($h,Th){let Fh,Wh;for(let zh=$h.length-1;zh>-1;zh--){Fh=$h[zh],Wh=Fh.children;for(let Hh=0,Uh=Wh.length;Hh<Uh;Hh++)Bo(Wh[Hh]);Th&&Th===Fh||Bo(Fh)}},move($h,Th,Fh){let Wh;const{children:zh}=$h;for(let Hh=0,Uh=zh.length;Hh<Uh;Hh++)Wh=($h=zh[Hh]).__world,Wh.e+=Th,Wh.f+=Fh,Wh.x+=Th,Wh.y+=Fh,$h.isBranch&&To($h,Th,Fh)},scale($h,Th,Fh,Wh,zh,Hh,Uh){let Yh;const{children:Xh}=$h,jh=Wh-1,qh=zh-1;for(let Vh=0,Zh=Xh.length;Vh<Zh;Vh++)Yh=($h=Xh[Vh]).__world,Yh.a*=Wh,Yh.d*=zh,(Yh.b||Yh.c)&&(Yh.b*=Wh,Yh.c*=zh),Yh.e===Yh.x&&Yh.f===Yh.y?(Yh.x=Yh.e+=(Yh.e-Hh)*jh+Th,Yh.y=Yh.f+=(Yh.f-Uh)*qh+Fh):(Yh.e+=(Yh.e-Hh)*jh+Th,Yh.f+=(Yh.f-Uh)*qh+Fh,Yh.x+=(Yh.x-Hh)*jh+Th,Yh.y+=(Yh.y-Uh)*qh+Fh),Yh.width*=Wh,Yh.height*=zh,Yh.scaleX*=Wh,Yh.scaleY*=zh,$h.isBranch&&Po($h,Th,Fh,Wh,zh,Hh,Uh)}},{pushAllChildBranch:ko,pushAllBranchStack:Co,updateBoundsByBranchStack:Oo,move:To,scale:Po}=vo,So={run($h){if($h&&$h.length){const Th=$h.length;for(let Fh=0;Fh<Th;Fh++)$h[Fh]();$h.length===Th?$h.length=0:$h.splice(0,Th)}}},{getRelativeWorld:Lo,updateBounds:Ro}=co,{toOuterOf:Eo,getPoints:Io,copy:Mo}=zt$2,Ao="_localContentBounds",Wo="_worldContentBounds",No="_worldBoxBounds",Yo="_worldStrokeBounds";class Do{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(Th){this._contentBounds=Th}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}set renderBounds(Th){this._renderBounds=Th}get localContentBounds(){return Eo(this.contentBounds,this.leaf.__localMatrix,this[Ao]||(this[Ao]={})),this[Ao]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return Eo(this.contentBounds,this.leaf.__world,this[Wo]||(this[Wo]={})),this[Wo]}get worldBoxBounds(){return Eo(this.boxBounds,this.leaf.__world,this[No]||(this[No]={})),this[No]}get worldStrokeBounds(){return Eo(this.strokeBounds,this.leaf.__world,this[Yo]||(this[Yo]={})),this[Yo]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(Th){this.leaf=Th,this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),Th.__world&&(this.boxBounds={x:0,y:0,width:0,height:0},this.boxChange(),this.matrixChange())}createLocal(){const Th=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=Th),this._localRenderBounds||(this._localRenderBounds=Th)}update(){const{leaf:Th}=this,{leafer:Fh}=Th;if(Th.isApp)return Ro(Th);if(Fh)Fh.ready?Fh.watcher.changed&&Fh.layouter.layout():Fh.start();else{let Wh=Th;for(;Wh.parent&&!Wh.parent.leafer;)Wh=Wh.parent;const zh=Wh;if(zh.__fullLayouting)return;zh.__fullLayouting=!0,$t$2.layout(zh),delete zh.__fullLayouting}}getTransform(Th="world"){this.update();const{leaf:Fh}=this;switch(Th){case"world":return Fh.__world;case"local":return Fh.__localMatrix;case"inner":return q$1.defaultMatrix;case"page":Th=Fh.zoomLayer;default:return Lo(Fh,Th)}}getBounds(Th,Fh="world"){switch(this.update(),Fh){case"world":return this.getWorldBounds(Th);case"local":return this.getLocalBounds(Th);case"inner":return this.getInnerBounds(Th);case"page":Fh=this.leaf.zoomLayer;default:return new Vt$3(this.getInnerBounds(Th)).toOuterOf(this.getTransform(Fh))}}getInnerBounds(Th="box"){switch(Th){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(Th="box"){switch(Th){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(Th="box"){switch(Th){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(Th,Fh="world",Wh){const{leaf:zh}=this;let Hh,Uh,Yh,Xh=this.getInnerBounds(Th);switch(Fh){case"world":Hh=zh.getWorldPoint(Xh),Uh=zh.__world;break;case"local":const{scaleX:jh,scaleY:qh,rotation:Vh,skewX:Zh,skewY:Kh}=zh.__;Yh={scaleX:jh,scaleY:qh,rotation:Vh,skewX:Zh,skewY:Kh},Hh=zh.getLocalPointByInner(Xh);break;case"inner":Hh=Xh,Uh=q$1.defaultMatrix;break;case"page":Fh=zh.zoomLayer;default:Hh=zh.getWorldPoint(Xh,Fh),Uh=Lo(zh,Fh,!0)}if(Yh||(Yh=q$1.getLayout(Uh)),Mo(Yh,Xh),ot$2.copy(Yh,Hh),Wh){const{scaleX:jh,scaleY:qh}=Yh,Vh=Math.abs(jh),Zh=Math.abs(qh);Vh===1&&Zh===1||(Yh.scaleX/=Vh,Yh.scaleY/=Zh,Yh.width*=Vh,Yh.height*=Zh)}return Yh}getLayoutPoints(Th,Fh="world"){const{leaf:Wh}=this,zh=Io(this.getInnerBounds(Th));let Hh;switch(Fh){case"world":Hh=null;break;case"local":Hh=Wh.parent;break;case"inner":break;case"page":Fh=Wh.zoomLayer;default:Hh=Fh}return s(Hh)||zh.forEach(Uh=>Wh.innerToWorld(Uh,null,!1,Hh)),zh}shrinkContent(){const{x:Th,y:Fh,width:Wh,height:zh}=this.boxBounds;this._contentBounds={x:Th,y:Fh,width:Wh,height:zh}}spreadStroke(){const{x:Th,y:Fh,width:Wh,height:zh}=this.strokeBounds;this._strokeBounds={x:Th,y:Fh,width:Wh,height:zh},this._localStrokeBounds={x:Th,y:Fh,width:Wh,height:zh},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:Th,y:Fh,width:Wh,height:zh}=this.renderBounds;this._renderBounds={x:Th,y:Fh,width:Wh,height:zh},this._localRenderBounds={x:Th,y:Fh,width:Wh,height:zh}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const Th=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,Th&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged?this.boundsChanged||(this.boundsChanged=!0):this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=this.affectChildrenSort=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class Xo{constructor(Th,Fh){this.bubbles=!1,this.type=Th,Fh&&(this.target=Fh)}stopDefault(){this.isStopDefault=!0,this.origin&&$t$2.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&$t$2.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&$t$2.event.stop(this.origin)}}class zo extends Xo{constructor(Th,Fh,Wh){super(Th,Fh),this.parent=Wh,this.child=Fh}}zo.ADD="child.add",zo.REMOVE="child.remove",zo.CREATED="created",zo.MOUNTED="mounted",zo.UNMOUNTED="unmounted",zo.DESTROY="destroy";const Fo="property.scroll";class Uo extends Xo{constructor(Th,Fh,Wh,zh,Hh){super(Th,Fh),this.attrName=Wh,this.oldValue=zh,this.newValue=Hh}}Uo.CHANGE="property.change",Uo.LEAFER_CHANGE="property.leafer_change",Uo.SCROLL=Fo;const jo={scrollX:Fo,scrollY:Fo};class Vo extends Xo{constructor(Th,Fh){super(Th),Object.assign(this,Fh)}}Vo.LOAD="image.load",Vo.LOADED="image.loaded",Vo.ERROR="image.error";class Ho extends Xo{static checkHas(Th,Fh,Wh){Wh==="on"?Fh===Jo?Th.__hasWorldEvent=!0:Th.__hasLocalEvent=!0:(Th.__hasLocalEvent=Th.hasEvent(Go)||Th.hasEvent(qo)||Th.hasEvent(Qo),Th.__hasWorldEvent=Th.hasEvent(Jo))}static emitLocal(Th){if(Th.leaferIsReady){const{resized:Fh}=Th.__layout;Fh!=="local"&&(Th.emit(Go,Th),Fh==="inner"&&Th.emit(qo,Th)),Th.emit(Qo,Th)}}static emitWorld(Th){Th.leaferIsReady&&Th.emit(Jo,this)}}Ho.RESIZE="bounds.resize",Ho.INNER="bounds.inner",Ho.LOCAL="bounds.local",Ho.WORLD="bounds.world";const{RESIZE:Go,INNER:qo,LOCAL:Qo,WORLD:Jo}=Ho,Zo={};[Go,qo,Qo,Jo].forEach($h=>Zo[$h]=1);class $o extends Xo{get bigger(){if(!this.old)return!0;const{width:Th,height:Fh}=this.old;return this.width>=Th&&this.height>=Fh}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(Th,Fh){d(Th)?(super($o.RESIZE),Object.assign(this,Th)):super(Th),this.old=Fh}static isResizing(Th){return this.resizingKeys&&!s(this.resizingKeys[Th.innerId])}}$o.RESIZE="resize";class Ko extends Xo{constructor(Th,Fh){super(Th),this.data=Fh}}Ko.REQUEST="watch.request",Ko.DATA="watch.data";class ta extends Xo{constructor(Th,Fh,Wh){super(Th),Fh&&(this.data=Fh,this.times=Wh)}}ta.REQUEST="layout.request",ta.START="layout.start",ta.BEFORE="layout.before",ta.LAYOUT="layout",ta.AFTER="layout.after",ta.AGAIN="layout.again",ta.END="layout.end";class ea extends Xo{constructor(Th,Fh,Wh,zh){super(Th),Fh&&(this.times=Fh),Wh&&(this.renderBounds=Wh,this.renderOptions=zh)}}ea.REQUEST="render.request",ea.CHILD_START="render.child_start",ea.CHILD_END="render.child_end",ea.START="render.start",ea.BEFORE="render.before",ea.RENDER="render",ea.AFTER="render.after",ea.AGAIN="render.again",ea.END="render.end",ea.NEXT="render.next";class sa extends Xo{}sa.START="leafer.start",sa.BEFORE_READY="leafer.before_ready",sa.READY="leafer.ready",sa.AFTER_READY="leafer.after_ready",sa.VIEW_READY="leafer.view_ready",sa.VIEW_COMPLETED="leafer.view_completed",sa.STOP="leafer.stop",sa.RESTART="leafer.restart",sa.END="leafer.end",sa.UPDATE_MODE="leafer.update_mode",sa.TRANSFORM="leafer.transform",sa.MOVE="leafer.move",sa.SCALE="leafer.scale",sa.ROTATE="leafer.rotate",sa.SKEW="leafer.skew";const{MOVE:ra,SCALE:ia,ROTATE:na,SKEW:oa}=sa,aa={x:ra,y:ra,scaleX:ia,scaleY:ia,rotation:na,skewX:oa,skewY:oa},ha={};class la{set event(Th){this.on(Th)}on(Th,Fh,Wh){if(!Fh){let qh;if(l(Th))Th.forEach(Vh=>this.on(Vh[0],Vh[1],Vh[2]));else for(let Vh in Th)l(qh=Th[Vh])?this.on(Vh,qh[0],qh[1]):this.on(Vh,qh);return}let zh,Hh,Uh;Wh&&(Wh==="once"?Hh=!0:typeof Wh=="boolean"?zh=Wh:(zh=Wh.capture,Hh=Wh.once));const Yh=da(this,zh,!0),Xh=i(Th)?Th.split(" "):Th,jh=Hh?{listener:Fh,once:Hh}:{listener:Fh};Xh.forEach(qh=>{qh&&(Uh=Yh[qh],Uh?Uh.findIndex(Vh=>Vh.listener===Fh)===-1&&Uh.push(jh):Yh[qh]=[jh],Zo[qh]&&Ho.checkHas(this,qh,"on"))})}off(Th,Fh,Wh){if(Th){const zh=i(Th)?Th.split(" "):Th;if(Fh){let Hh,Uh,Yh;Wh&&(Hh=typeof Wh=="boolean"?Wh:Wh!=="once"&&Wh.capture);const Xh=da(this,Hh);zh.forEach(jh=>{jh&&(Uh=Xh[jh],Uh&&(Yh=Uh.findIndex(qh=>qh.listener===Fh),Yh>-1&&Uh.splice(Yh,1),Uh.length||delete Xh[jh],Zo[jh]&&Ho.checkHas(this,jh,"off")))})}else{const{__bubbleMap:Hh,__captureMap:Uh}=this;zh.forEach(Yh=>{Hh&&delete Hh[Yh],Uh&&delete Uh[Yh]})}}else this.__bubbleMap=this.__captureMap=void 0}on_(Th,Fh,Wh,zh){return Fh?this.on(Th,Wh?Fh=Fh.bind(Wh):Fh,zh):l(Th)&&Th.forEach(Hh=>this.on(Hh[0],Hh[2]?Hh[1]=Hh[1].bind(Hh[2]):Hh[1],Hh[3])),{type:Th,current:this,listener:Fh,options:zh}}off_(Th){if(!Th)return;const Fh=l(Th)?Th:[Th];Fh.forEach(Wh=>{Wh&&(Wh.listener?Wh.current.off(Wh.type,Wh.listener,Wh.options):l(Wh.type)&&Wh.type.forEach(zh=>Wh.current.off(zh[0],zh[1],zh[3])))}),Fh.length=0}once(Th,Fh,Wh,zh){if(!Fh)return l(Th)&&Th.forEach(Hh=>this.once(Hh[0],Hh[1],Hh[2],Hh[3]));d(Wh)?Fh=Fh.bind(Wh):zh=Wh,this.on(Th,Fh,{once:!0,capture:zh})}emit(Th,Fh,Wh){!Fh&&pe$2.has(Th)&&(Fh=pe$2.get(Th,{type:Th,target:this,current:this}));const zh=da(this,Wh)[Th];if(zh){let Hh;for(let Uh=0,Yh=zh.length;Uh<Yh&&!((Hh=zh[Uh])&&(Hh.listener(Fh),Hh.once&&(this.off(Th,Hh.listener,Wh),Uh--,Yh--),Fh&&Fh.isStopNow));Uh++);}this.syncEventer&&this.syncEventer.emitEvent(Fh,Wh)}emitEvent(Th,Fh){Th.current=this,this.emit(Th.type,Th,Fh)}hasEvent(Th,Fh){if(this.syncEventer&&this.syncEventer.hasEvent(Th,Fh))return!0;const{__bubbleMap:Wh,__captureMap:zh}=this,Hh=Wh&&Wh[Th],Uh=zh&&zh[Th];return!!(s(Fh)?Hh||Uh:Fh?Uh:Hh)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function da($h,Th,Fh){if(Th){const{__captureMap:Wh}=$h;return Wh||(Fh?$h.__captureMap={}:ha)}{const{__bubbleMap:Wh}=$h;return Wh||(Fh?$h.__bubbleMap={}:ha)}}const{on:ca,on_:ua,off:_a,off_:pa,once:fa,emit:ga,emitEvent:ya,hasEvent:ma,destroy:xa}=la.prototype,wa={on:ca,on_:ua,off:_a,off_:pa,once:fa,emit:ga,emitEvent:ya,hasEvent:ma,destroyEventer:xa},ba=ee$2.get("setAttr"),Ba={__setAttr($h,Th,Fh){if(this.leaferIsCreated){const Wh=this.__.__getInput($h);if(!Fh||n(Th)||s(Th)||(ba.warn(this.innerName,$h,Th),Th=void 0),d(Th)||Wh!==Th){if(this.__realSetAttr($h,Th),this.isLeafer){this.emitEvent(new Uo(Uo.LEAFER_CHANGE,this,$h,Wh,Th));const Hh=aa[$h];Hh&&(this.emitEvent(new sa(Hh,this)),this.emitEvent(new sa(sa.TRANSFORM,this)))}this.emitPropertyEvent(Uo.CHANGE,$h,Wh,Th);const zh=jo[$h];return zh&&this.emitPropertyEvent(zh,$h,Wh,Th),!0}return!1}return this.__realSetAttr($h,Th),!0},emitPropertyEvent($h,Th,Fh,Wh){const zh=new Uo($h,this,Th,Fh,Wh);this.isLeafer||this.hasEvent($h)&&this.emitEvent(zh),this.leafer.emitEvent(zh)},__realSetAttr($h,Th){const Fh=this.__;Fh[$h]=Th,this.__proxyData&&this.setProxyAttr($h,Th),Fh.normalStyle&&(this.lockNormalStyle||s(Fh.normalStyle[$h])||(Fh.normalStyle[$h]=Th))},__getAttr($h){return this.__proxyData?this.getProxyAttr($h):this.__.__get($h)}},{setLayout:va,multiplyParent:ka,translateInner:Ca,defaultWorld:Oa}=q$1,{toPoint:Ta,tempPoint:Pa}=bt$3,Sa={__updateWorldMatrix(){const{parent:$h,__layout:Th,__world:Fh,__scrollWorld:Wh,__:zh}=this;ka(this.__local||Th,$h?$h.__scrollWorld||$h.__world:Oa,Fh,!!Th.affectScaleOrRotation,zh),Wh&&Ca(Object.assign(Wh,Fh),zh.scrollX,zh.scrollY)},__updateLocalMatrix(){if(this.__local){const $h=this.__layout,Th=this.__local,Fh=this.__;$h.affectScaleOrRotation&&($h.scaleChanged&&($h.resized||($h.resized="scale"))||$h.rotationChanged)&&(va(Th,Fh,null,null,$h.affectRotation),$h.scaleChanged=$h.rotationChanged=void 0),Th.e=Fh.x+Fh.offsetX,Th.f=Fh.y+Fh.offsetY,(Fh.around||Fh.origin)&&(Ta(Fh.around||Fh.origin,$h.boxBounds,Pa),Ca(Th,-Pa.x,-Pa.y,!Fh.around))}this.__layout.matrixChanged=void 0}},{updateMatrix:La,updateAllMatrix:Ra}=co,{updateBounds:Ea}=vo,{toOuterOf:Ia,copyAndSpread:Ma,copy:Aa}=zt$2,{toBounds:Wa}=Ai$1,Na={__updateWorldBounds(){const{__layout:$h,__world:Th}=this;Ia($h.renderBounds,Th,Th),$h.resized&&($h.resized==="inner"&&this.__onUpdateSize(),this.__hasLocalEvent&&Ho.emitLocal(this),$h.resized=void 0),this.__hasWorldEvent&&Ho.emitWorld(this)},__updateLocalBounds(){const $h=this.__layout;$h.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),$h.resized="inner"),$h.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),$h.localBoxChanged=void 0,$h.strokeSpread&&($h.strokeChanged=!0),$h.renderSpread&&($h.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),$h.boxChanged=void 0,$h.strokeChanged&&($h.strokeSpread=this.__updateStrokeSpread(),$h.strokeSpread?($h.strokeBounds===$h.boxBounds&&$h.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):$h.spreadStrokeCancel(),$h.strokeChanged=void 0,($h.renderSpread||$h.strokeSpread!==$h.strokeBoxSpread)&&($h.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),$h.resized="inner"),$h.renderChanged&&($h.renderSpread=this.__updateRenderSpread(),$h.renderSpread?($h.renderBounds!==$h.boxBounds&&$h.renderBounds!==$h.strokeBounds||$h.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):$h.spreadRenderCancel(),$h.renderChanged=void 0,this.parent&&this.parent.__layout.renderChange()),$h.resized||($h.resized="local"),$h.boundsChanged=void 0},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),Ia(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){Ia(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){Ia(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds($h,Th){const Fh=this.__layout.boxBounds,Wh=this.__;Wh.__usePathBox?Wa(Wh.path,Fh):(Fh.x=0,Fh.y=0,Fh.width=Wh.width,Fh.height=Wh.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.__extraUpdate(),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),Ra(this),Ea(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(Ra(this),Ea(this,this))):La(this)},__updateNaturalSize(){const{__:$h,__layout:Th}=this;$h.__naturalWidth=Th.boxBounds.width,$h.__naturalHeight=Th.boxBounds.height},__updateStrokeBounds($h){const Th=this.__layout;Ma(Th.strokeBounds,Th.boxBounds,Th.strokeBoxSpread)},__updateRenderBounds($h){const Th=this.__layout,{renderSpread:Fh}=Th;o(Fh)&&Fh<=0?Aa(Th.renderBounds,Th.strokeBounds):Ma(Th.renderBounds,Th.boxBounds,Fh)}},Ya={__render($h,Th){if(Th.shape)return this.__renderShape($h,Th);if((!Th.cellList||Th.cellList.has(this))&&this.__worldOpacity){const Fh=this.__;if(Fh.bright&&!Th.topRendering)return Th.topList.add(this);if($h.setWorld(this.__nowWorld=this.__getNowWorld(Th)),$h.opacity=Th.dimOpacity&&!Fh.dimskip?Fh.opacity*Th.dimOpacity:Fh.opacity,this.__.__single){if(Fh.eraser==="path")return this.__renderEraser($h,Th);const Wh=$h.getSameCanvas(!0,!0);this.__draw(Wh,Th,$h),co.copyCanvasByWorld(this,$h,Wh,this.__nowWorld,Fh.__blendMode,!0),Wh.recycle(this.__nowWorld)}else this.__draw($h,Th);ee$2.showBounds&&ee$2.drawBounds(this,$h,Th)}},__renderShape($h,Th){this.__worldOpacity&&($h.setWorld(this.__nowWorld=this.__getNowWorld(Th)),this.__drawShape($h,Th))},__clip($h,Th){this.__worldOpacity&&($h.setWorld(this.__nowWorld=this.__getNowWorld(Th)),this.__drawRenderPath($h),$h.clipUI(this))},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:Da}=xo,{hasSize:Xa}=zt$2,za={__updateChange(){const{__layout:$h}=this;$h.childrenSortChanged&&(this.__updateSortChildren(),$h.childrenSortChanged=!1),this.__.__checkSingle()},__render($h,Th){const Fh=this.__nowWorld=this.__getNowWorld(Th);if(this.__worldOpacity&&Xa(Fh)){const Wh=this.__;if(Wh.__useDim)if(Wh.dim)Th.dimOpacity=Wh.dim===!0?.2:Wh.dim;else{if(Wh.bright&&!Th.topRendering)return Th.topList.add(this);Wh.dimskip&&Th.dimOpacity&&(Th.dimOpacity=0)}if(Wh.__single&&!this.isBranchLeaf){if(Wh.eraser==="path")return this.__renderEraser($h,Th);const zh=$h.getSameCanvas(!1,!0);this.__renderBranch(zh,Th),$h.opacity=Th.dimOpacity?Wh.opacity*Th.dimOpacity:Wh.opacity,$h.copyWorldByReset(zh,Fh,Fh,Wh.__blendMode,!0),zh.recycle(Fh)}else this.__renderBranch($h,Th)}},__renderBranch($h,Th){if(this.__hasMask)this.__renderMask($h,Th);else{let Fh;const{children:Wh}=this;for(let zh=0,Hh=Wh.length;zh<Hh;zh++)Fh=Wh[zh],Da(Fh,Th)||(Fh.__.complex?Fh.__renderComplex($h,Th):Fh.__render($h,Th))}},__clip($h,Th){if(this.__worldOpacity){const{children:Fh}=this;for(let Wh=0,zh=Fh.length;Wh<zh;Wh++)Da(Fh[Wh],Th)||Fh[Wh].__clip($h,Th)}}},Fa={},{LEAF:Ua,create:ja}=g,{stintSet:Va}=_,{toInnerPoint:Ha,toOuterPoint:Ga,multiplyParent:qa}=q$1,{toOuterOf:Qa}=zt$2,{copy:Ja,move:Za}=ot$2,{moveLocal:$a,zoomOfLocal:Ka,rotateOfLocal:th,skewOfLocal:eh,moveWorld:sh,zoomOfWorld:rh,rotateOfWorld:ih,skewOfWorld:nh,transform:oh,transformWorld:ah,setTransform:hh,getFlipTransform:lh,getLocalOrigin:dh,getRelativeWorld:ch,drop:uh}=co;let _h=class{get tag(){return this.__tag}set tag($h){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return f}get __LayoutProcessor(){return Do}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get scrollWorldTransform(){return this.updateLayout(),this.__scrollWorld||this.__world}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.updateLayout(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){return this.leaferIsCreated&&this.leafer.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event($h){this.on($h)}constructor($h){this.innerId=ja(Ua),this.reset($h),this.__bubbleMap&&this.__emitLifeEvent(zo.CREATED)}reset($h){this.leafer&&this.leafer.forceRender(this.__world),$h!==0&&(this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},$h!==null&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0})),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),$h&&($h.__&&($h=$h.toJSON()),$h.children?this.set($h):Object.assign(this,$h))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent($h,Th){Th&&($h=$h.bind(Th)),this.parent?$h():this.on(zo.ADD,$h,"once")}waitLeafer($h,Th){Th&&($h=$h.bind(Th)),this.leafer?$h():this.on(zo.MOUNTED,$h,"once")}nextRender($h,Th,Fh){this.leafer?this.leafer.nextRender($h,Th,Fh):this.waitLeafer(()=>this.leafer.nextRender($h,Th,Fh))}removeNextRender($h){this.nextRender($h,null,"off")}__bindLeafer($h){if(this.isLeafer&&$h!==null&&($h=this),this.leafer&&!$h&&this.leafer.leafs--,this.leafer=$h,$h?($h.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(zo.MOUNTED)):this.__emitLifeEvent(zo.UNMOUNTED),this.isBranch){const{children:Th}=this;for(let Fh=0,Wh=Th.length;Fh<Wh;Fh++)Th[Fh].__bindLeafer($h)}}set($h,Th){}get($h){}setAttr($h,Th){this[$h]=Th}getAttr($h){return this[$h]}getComputedAttr($h){return this.__[$h]}toJSON($h){return $h&&this.__layout.update(),this.__.__getInputData(null,$h)}toString($h){return JSON.stringify(this.toJSON($h))}toSVG(){}__SVG($h){}toHTML(){}__setAttr($h,Th){return!0}__getAttr($h){}setProxyAttr($h,Th){}getProxyAttr($h){}find($h,Th){}findTag($h){}findOne($h,Th){}findId($h){}focus($h){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate($h){s($h)?$h="width":$h==="surface"&&($h="blendMode");const Th=this.__.__getInput($h);this.__[$h]=s(Th)?null:void 0,this[$h]=Th}forceRender($h,Th){this.forceUpdate("surface")}__extraUpdate(){this.leaferIsReady&&this.leafer.layouter.addExtra(this)}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds($h,Th){}__updateContentBounds(){}__updateStrokeBounds($h){}__updateRenderBounds($h){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser($h){this.__hasEraser=!!$h||this.children.some(Th=>Th.__.eraser)}__renderEraser($h,Th){$h.save(),this.__clip($h,Th);const{renderBounds:Fh}=this.__layout;$h.clearRect(Fh.x,Fh.y,Fh.width,Fh.height),$h.restore()}__updateMask($h){this.__hasMask=this.children.some(Th=>Th.__.mask&&Th.__.visible&&Th.__.opacity)}__renderMask($h,Th){}__getNowWorld($h){if($h.matrix){this.__cameraWorld||(this.__cameraWorld={});const Th=this.__cameraWorld,Fh=this.__world;return qa(Fh,$h.matrix,Th,void 0,Fh),Qa(this.__layout.renderBounds,Th,Th),Va(Th,"half",Fh.half),Va(Th,"ignorePixelSnap",Fh.ignorePixelSnap),Th}return this.__world}getClampRenderScale(){let{scaleX:$h}=this.__nowWorld||this.__world;return $h<0&&($h=-$h),$h>1?$h:1}getRenderScaleData($h,Th){let{scaleX:Fh,scaleY:Wh}=en.patternLocked?this.__world:this.__nowWorld;return $h&&(Fh<0&&(Fh=-Fh),Wh<0&&(Wh=-Wh)),(Th===!0||Th==="zoom-in"&&Fh>1&&Wh>1)&&(Fh=Wh=1),Fa.scaleX=Fh,Fa.scaleY=Wh,Fa}getTransform($h){return this.__layout.getTransform($h||"local")}getBounds($h,Th){return this.__layout.getBounds($h,Th)}getLayoutBounds($h,Th,Fh){return this.__layout.getLayoutBounds($h,Th,Fh)}getLayoutPoints($h,Th){return this.__layout.getLayoutPoints($h,Th)}getWorldBounds($h,Th,Fh){const Wh=Th?ch(this,Th):this.worldTransform,zh=Fh?$h:{};return Qa($h,Wh,zh),zh}worldToLocal($h,Th,Fh,Wh){this.parent?this.parent.worldToInner($h,Th,Fh,Wh):Th&&Ja(Th,$h)}localToWorld($h,Th,Fh,Wh){this.parent?this.parent.innerToWorld($h,Th,Fh,Wh):Th&&Ja(Th,$h)}worldToInner($h,Th,Fh,Wh){Wh&&(Wh.innerToWorld($h,Th,Fh),$h=Th||$h),Ha(this.scrollWorldTransform,$h,Th,Fh)}innerToWorld($h,Th,Fh,Wh){Ga(this.scrollWorldTransform,$h,Th,Fh),Wh&&Wh.worldToInner(Th||$h,null,Fh)}getBoxPoint($h,Th,Fh,Wh){return this.getBoxPointByInner(this.getInnerPoint($h,Th,Fh,Wh),null,null,!0)}getBoxPointByInner($h,Th,Fh,Wh){const zh=Wh?$h:Object.assign({},$h),{x:Hh,y:Uh}=this.boxBounds;return Za(zh,-Hh,-Uh),zh}getInnerPoint($h,Th,Fh,Wh){const zh=Wh?$h:{};return this.worldToInner($h,zh,Fh,Th),zh}getInnerPointByBox($h,Th,Fh,Wh){const zh=Wh?$h:Object.assign({},$h),{x:Hh,y:Uh}=this.boxBounds;return Za(zh,Hh,Uh),zh}getInnerPointByLocal($h,Th,Fh,Wh){return this.getInnerPoint($h,this.parent,Fh,Wh)}getLocalPoint($h,Th,Fh,Wh){const zh=Wh?$h:{};return this.worldToLocal($h,zh,Fh,Th),zh}getLocalPointByInner($h,Th,Fh,Wh){return this.getWorldPoint($h,this.parent,Fh,Wh)}getPagePoint($h,Th,Fh,Wh){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint($h,Th,Fh,Wh)}getWorldPoint($h,Th,Fh,Wh){const zh=Wh?$h:{};return this.innerToWorld($h,zh,Fh,Th),zh}getWorldPointByBox($h,Th,Fh,Wh){return this.getWorldPoint(this.getInnerPointByBox($h,null,null,Wh),Th,Fh,!0)}getWorldPointByLocal($h,Th,Fh,Wh){const zh=Wh?$h:{};return this.localToWorld($h,zh,Fh,Th),zh}getWorldPointByPage($h,Th,Fh,Wh){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint($h,Th,Fh,Wh)}setTransform($h,Th,Fh){hh(this,$h,Th,Fh)}transform($h,Th,Fh){oh(this,$h,Th,Fh)}move($h,Th,Fh){$a(this,$h,Th,Fh)}moveInner($h,Th,Fh){sh(this,$h,Th,!0,Fh)}scaleOf($h,Th,Fh,Wh,zh){Ka(this,dh(this,$h),Th,Fh,Wh,zh)}rotateOf($h,Th,Fh){th(this,dh(this,$h),Th,Fh)}skewOf($h,Th,Fh,Wh,zh){eh(this,dh(this,$h),Th,Fh,Wh,zh)}transformWorld($h,Th,Fh){ah(this,$h,Th,Fh)}moveWorld($h,Th,Fh){sh(this,$h,Th,!1,Fh)}scaleOfWorld($h,Th,Fh,Wh,zh){rh(this,$h,Th,Fh,Wh,zh)}rotateOfWorld($h,Th){ih(this,$h,Th)}skewOfWorld($h,Th,Fh,Wh,zh){nh(this,$h,Th,Fh,Wh,zh)}flip($h,Th){oh(this,lh(this,$h),!1,Th)}scaleResize($h,Th=$h,Fh){this.scaleX*=$h,this.scaleY*=Th}__scaleResize($h,Th){}resizeWidth($h){}resizeHeight($h){}hit($h,Th){return!0}__hitWorld($h,Th){return!0}__hit($h,Th){return!0}__hitFill($h){return!0}__hitStroke($h,Th){return!0}__hitPixel($h){return!0}__drawHitPath($h){}__updateHitCanvas(){}__render($h,Th){}__renderComplex($h,Th){}__drawFast($h,Th){}__draw($h,Th,Fh){}__clip($h,Th){}__renderShape($h,Th){}__drawShape($h,Th){}__updateWorldOpacity(){}__updateChange(){}__drawPath($h){}__drawRenderPath($h){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return he$2.need("path")}getMotionPoint($h){return he$2.need("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation($h,Th){}__updateSortChildren(){}add($h,Th){}remove($h,Th){this.parent&&this.parent.remove(this,Th)}dropTo($h,Th,Fh){uh(this,$h,Th,Fh)}on($h,Th,Fh){}off($h,Th,Fh){}on_($h,Th,Fh,Wh){}off_($h){}once($h,Th,Fh,Wh){}emit($h,Th,Fh){}emitEvent($h,Th){}hasEvent($h,Th){return!1}static changeAttr($h,Th,Fh){Fh?this.addAttr($h,Th,Fh):Un(this.prototype,$h,Th)}static addAttr($h,Th,Fh,Wh){Fh||(Fh=bn),Fh(Th,Wh)(this.prototype,$h)}__emitLifeEvent($h){this.hasEvent($h)&&this.emitEvent(new zo($h,this,this.parent))}destroy(){this.destroyed||(this.parent&&this.remove(),this.children&&this.clear(),this.__emitLifeEvent(zo.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0)}};_h=ye$2([Jn(Ba),Jn(Sa),Jn(Na),Jn(wa),Jn(Ya)],_h);const{setListWithFn:ph}=zt$2,{sort:fh}=vo,{localBoxBounds:gh,localStrokeBounds:yh,localRenderBounds:mh,maskLocalBoxBounds:xh,maskLocalStrokeBounds:wh,maskLocalRenderBounds:bh}=xo,Bh=new ee$2("Branch");let vh=class extends _h{__updateStrokeSpread(){const{children:$h}=this;for(let Th=0,Fh=$h.length;Th<Fh;Th++)if($h[Th].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:$h}=this;for(let Th=0,Fh=$h.length;Th<Fh;Th++)if($h[Th].__layout.renderSpread)return 1;return 0}__updateBoxBounds($h,Th){ph(Th||this.__layout.boxBounds,this.children,this.__hasMask?xh:gh)}__updateStrokeBounds($h){ph($h||this.__layout.strokeBounds,this.children,this.__hasMask?wh:yh)}__updateRenderBounds($h){ph($h||this.__layout.renderBounds,this.children,this.__hasMask?bh:mh)}__updateSortChildren(){let $h;const{children:Th}=this;if(Th.length>1){for(let Fh=0,Wh=Th.length;Fh<Wh;Fh++)Th[Fh].__tempNumber=Fh,Th[Fh].__.zIndex&&($h=!0);Th.sort(fh),this.__layout.affectChildrenSort=$h}}add($h,Th){if($h===this||$h.destroyed)return Bh.warn("add self or destroyed");const Fh=s(Th);if(!$h.__){if(l($h))return $h.forEach(zh=>{this.add(zh,Th),Fh||Th++});if(!($h=ce$2.get($h.tag,$h)))return}$h.parent&&$h.parent.remove($h),$h.parent=this,Fh?this.children.push($h):this.children.splice(Th,0,$h),$h.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1);const Wh=$h.__layout;Wh.boxChanged||Wh.boxChange(),Wh.matrixChanged||Wh.matrixChange(),$h.__bubbleMap&&$h.__emitLifeEvent(zo.ADD),this.leafer&&($h.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(zo.ADD,$h)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...$h){this.add($h)}remove($h,Th){$h?$h.__?$h.animationOut?$h.__runAnimation("out",()=>this.__remove($h,Th)):this.__remove($h,Th):this.find($h).forEach(Fh=>this.remove(Fh,Th)):s($h)&&super.remove(null,Th)}removeAll($h){const{children:Th}=this;Th.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,Th.forEach(Fh=>{this.__realRemoveChild(Fh),$h&&Fh.destroy()}))}clear(){this.removeAll(!0)}__remove($h,Th){const Fh=this.children.indexOf($h);Fh>-1&&(this.children.splice(Fh,1),$h.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild($h),Th&&$h.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild($h){$h.__emitLifeEvent(zo.REMOVE),$h.parent=null,this.leafer&&($h.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(zo.REMOVE,$h),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent($h,Th){const Fh=new zo($h,Th,this);this.hasEvent($h)&&!this.isLeafer&&this.emitEvent(Fh),this.leafer.emitEvent(Fh)}};vh=ye$2([Jn(za)],vh);class kh{get length(){return this.list.length}constructor(Th){this.reset(),Th&&(l(Th)?this.addList(Th):this.add(Th))}has(Th){return Th&&!s(this.keys[Th.innerId])}indexAt(Th){return this.list[Th]}indexOf(Th){const Fh=this.keys[Th.innerId];return s(Fh)?-1:Fh}add(Th){const{list:Fh,keys:Wh}=this;s(Wh[Th.innerId])&&(Fh.push(Th),Wh[Th.innerId]=Fh.length-1)}addAt(Th,Fh=0){const{keys:Wh}=this;if(s(Wh[Th.innerId])){const{list:zh}=this;for(let Hh=Fh,Uh=zh.length;Hh<Uh;Hh++)Wh[zh[Hh].innerId]++;Fh===0?zh.unshift(Th):(Fh>zh.length&&(Fh=zh.length),zh.splice(Fh,0,Th)),Wh[Th.innerId]=Fh}}addList(Th){for(let Fh=0;Fh<Th.length;Fh++)this.add(Th[Fh])}remove(Th){const{list:Fh}=this;let Wh;for(let zh=0,Hh=Fh.length;zh<Hh;zh++)s(Wh)?Fh[zh].innerId===Th.innerId&&(Wh=zh,delete this.keys[Th.innerId]):this.keys[Fh[zh].innerId]=zh-1;s(Wh)||Fh.splice(Wh,1)}sort(Th){const{list:Fh}=this;Th?Fh.sort((Wh,zh)=>zh.__level-Wh.__level):Fh.sort((Wh,zh)=>Wh.__level-zh.__level)}forEach(Th){this.list.forEach(Th)}clone(){const Th=new kh;return Th.list=[...this.list],Th.keys=Object.assign({},this.keys),Th}update(){this.keys={};const{list:Th,keys:Fh}=this;for(let Wh=0,zh=Th.length;Wh<zh;Wh++)Fh[Th[Wh].innerId]=Wh}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class Ch{get length(){return this._length}constructor(Th){this._length=0,this.reset(),Th&&(l(Th)?this.addList(Th):this.add(Th))}has(Th){return!s(this.keys[Th.innerId])}without(Th){return s(this.keys[Th.innerId])}sort(Th){const{levels:Fh}=this;Th?Fh.sort((Wh,zh)=>zh-Wh):Fh.sort((Wh,zh)=>Wh-zh)}addList(Th){Th.forEach(Fh=>{this.add(Fh)})}add(Th){const{keys:Fh,levelMap:Wh}=this;Fh[Th.innerId]||(Fh[Th.innerId]=1,Wh[Th.__level]?Wh[Th.__level].push(Th):(Wh[Th.__level]=[Th],this.levels.push(Th.__level)),this._length++)}forEach(Th){let Fh;this.levels.forEach(Wh=>{Fh=this.levelMap[Wh];for(let zh=0,Hh=Fh.length;zh<Hh;zh++)Th(Fh[zh])})}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const Oh="2.0.2";function St$2($h,Th,Fh,Wh){var zh,Hh=arguments.length,Uh=Hh<3?Th:Wh===null?Wh=Object.getOwnPropertyDescriptor(Th,Fh):Wh;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Uh=Reflect.decorate($h,Th,Fh,Wh);else for(var Yh=$h.length-1;Yh>=0;Yh--)(zh=$h[Yh])&&(Uh=(Hh<3?zh(Uh):Hh>3?zh(Th,Fh,Uh):zh(Th,Fh))||Uh);return Hh>3&&Uh&&Object.defineProperty(Th,Fh,Uh),Uh}function mt$2($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh),Fh&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}}))}function Rt$2($h){return un($h,Th=>({set(Fh){this.__setAttr(Th,Fh),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}}))}function kt$2(){return($h,Th)=>{const Fh="_"+Th;ln($h,Th,{set(Wh){this.isLeafer&&(this[Fh]=Wh)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[Fh]||this:this.leafer&&this.leafer.zoomLayer}})}}function Bt$2($h){return(Th,Fh)=>{ln(Th,Fh,cn(Fh,$h))}}const At$2={},Ct$2={hasTransparent:function($h){if(!$h||$h.length===7||$h.length===4)return!1;if($h==="transparent")return!0;const Th=$h[0];if(Th==="#")switch($h.length){case 5:return $h[4]!=="f"&&$h[4]!=="F";case 9:return $h[7]!=="f"&&$h[7]!=="F"||$h[8]!=="f"&&$h[8]!=="F"}else if((Th==="r"||Th==="h")&&$h[3]==="a"){const Fh=$h.lastIndexOf(",");if(Fh>-1)return parseFloat($h.slice(Fh+1))<1}return!1}},bt$2=qt$2,Pt$2={},Ft$2={},Wt$2={},Et$2={},Tt$2={},Dt$2={apply(){he$2.need("filter")}},It$2={},Lt$2={setStyleName:()=>he$2.need("state"),set:()=>he$2.need("state")},zt$1={list:{},register($h,Th){zt$1.list[$h]=Th},get:$h=>zt$1.list[$h]},{parse:Mt$2,objectToCanvasData:Ot$2}=sr,{stintSet:Nt$2}=_,{hasTransparent:Vt$2}=Ct$2,Ht$2={originPaint:{}},Yt$2=ee$2.get("UIData");let Ut$2=class extends f{get scale(){const{scaleX:$h,scaleY:Th}=this;return $h!==Th?{x:$h,y:Th}:$h}get __strokeWidth(){return this.__getRealStrokeWidth()}get __maxStrokeWidth(){const $h=this;return $h.__hasMultiStrokeStyle?Math.max($h.__hasMultiStrokeStyle,$h.strokeWidth):$h.strokeWidth}get __hasMultiPaint(){const $h=this;return $h.fill&&this.__useStroke||$h.__isFills&&$h.fill.length>1||$h.__isStrokes&&$h.stroke.length>1||$h.__useEffect}get __clipAfterFill(){const $h=this;return $h.cornerRadius||$h.innerShadow||$h.__pathInputed}get __hasSurface(){return this.fill||this.stroke}get __autoWidth(){return this._width==null}get __autoHeight(){return this._height==null}get __autoSide(){return this._width==null||this._height==null}get __autoSize(){return this._width==null&&this._height==null}setVisible($h){this._visible=$h;const{leafer:Th}=this.__leaf;Th&&(Th.watcher.hasVisible=!0)}setWidth($h){$h<0?(this._width=-$h,this.__leaf.scaleX*=-1,Yt$2.warn("width < 0, instead -scaleX ",this)):this._width=$h}setHeight($h){$h<0?(this._height=-$h,this.__leaf.scaleY*=-1,Yt$2.warn("height < 0, instead -scaleY",this)):this._height=$h}setFill($h){this.__naturalWidth&&this.__removeNaturalSize(),i($h)||!$h?(Nt$2(this,"__isTransparentFill",Vt$2($h)),this.__isFills&&this.__removePaint("fill",!0),this._fill=$h):d($h)&&this.__setPaint("fill",$h)}setStroke($h){i($h)||!$h?(Nt$2(this,"__isTransparentStroke",Vt$2($h)),this.__isStrokes&&this.__removePaint("stroke",!0),this._stroke=$h):d($h)&&this.__setPaint("stroke",$h)}setPath($h){const Th=i($h);Th||$h&&d($h[0])?(this.__setInput("path",$h),this._path=Th?Mt$2($h):Ot$2($h)):(this.__input&&this.__removeInput("path"),this._path=$h)}setShadow($h){Xt$2(this,"shadow",$h)}setInnerShadow($h){Xt$2(this,"innerShadow",$h)}setFilter($h){Xt$2(this,"filter",$h)}__computePaint(){const{fill:$h,stroke:Th}=this.__input;$h&&Ft$2.compute("fill",this.__leaf),Th&&Ft$2.compute("stroke",this.__leaf),this.__needComputePaint=void 0}__getRealStrokeWidth($h){let{strokeWidth:Th,strokeWidthFixed:Fh}=this;if($h&&($h.strokeWidth&&(Th=$h.strokeWidth),s($h.strokeWidthFixed)||(Fh=$h.strokeWidthFixed)),Fh){const Wh=this.__leaf.getClampRenderScale();return Wh>1?Th/Wh:Th}return Th}__setPaint($h,Th){this.__setInput($h,Th);const Fh=this.__leaf.__layout;Fh.boxChanged||Fh.boxChange(),l(Th)&&!Th.length?this.__removePaint($h):$h==="fill"?(this.__isFills=!0,this._fill||(this._fill=Ht$2)):(this.__isStrokes=!0,this._stroke||(this._stroke=Ht$2))}__removePaint($h,Th){Th&&this.__removeInput($h),Wt$2.recycleImage($h,this),$h==="fill"?(Nt$2(this,"__isAlphaPixelFill",void 0),this._fill=this.__isFills=void 0):(Nt$2(this,"__isAlphaPixelStroke",void 0),Nt$2(this,"__hasMultiStrokeStyle",void 0),this._stroke=this.__isStrokes=void 0)}};function Xt$2($h,Th,Fh){$h.__setInput(Th,Fh),l(Fh)?(Fh.some(Wh=>Wh.visible===!1)&&(Fh=Fh.filter(Wh=>Wh.visible!==!1)),Fh.length||(Fh=void 0)):Fh=Fh&&Fh.visible!==!1?[Fh]:void 0,$h["_"+Th]=Fh}let jt$2=class extends Ut$2{},Jt$1=class extends jt$2{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return this.__single||this.__clipAfterFill}get __clipAfterFill(){const $h=this;return $h.overflow!=="show"&&$h.__leaf.children.length&&($h.__leaf.isOverflow||super.__clipAfterFill)}},qt$1=class extends jt$2{__getInputData($h,Th){const Fh=super.__getInputData($h,Th);return Re$2.forEach(Wh=>delete Fh[Wh]),Fh}},Gt$1=class extends Jt$1{},$t$1=class extends Ut$2{get __usePathBox(){return this.points||this.__pathInputed}},Kt$2=class extends Ut$2{get __boxStroke(){return!this.__pathInputed}},Qt$1=class extends Ut$2{get __boxStroke(){return!this.__pathInputed}},Zt$1=class extends $t$1{},te$1=class extends Ut$2{},ee$1=class extends Ut$2{get __pathInputed(){return 2}},ie$1=class extends jt$2{};const se$1={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};let oe$1=class extends Ut$2{get __useNaturalRatio(){return!1}setFontWeight($h){i($h)?(this.__setInput("fontWeight",$h),$h=se$1[$h]||400):this.__input&&this.__removeInput("fontWeight"),this._fontWeight=$h}setBoxStyle($h){let Th=this.__leaf,Fh=Th.__box;if($h){const{boxStyle:Wh}=this;if(Fh)for(let Uh in Wh)Fh[Uh]=void 0;else Fh=Th.__box=ce$2.get("Rect",0);const zh=Th.__layout,Hh=Fh.__layout;Wh||(Fh.parent=Th,Fh.__world=Th.__world,Hh.boxBounds=zh.boxBounds),Fh.set($h),Hh.strokeChanged&&zh.strokeChange()}else Fh&&(Th.__box=Fh.parent=null,Fh.destroy());this._boxStyle=$h}__getInputData($h,Th){const Fh=super.__getInputData($h,Th);return Fh.textEditing&&delete Fh.textEditing,Fh}},re$1=class extends Kt$2{get __urlType(){return"image"}setUrl($h){this.__setImageFill($h),this._url=$h}__setImageFill($h){this.fill=$h?{type:this.__urlType,mode:"stretch",url:$h}:void 0}__getData(){const $h=super.__getData();return $h.url&&delete $h.fill,$h}__getInputData($h,Th){const Fh=super.__getInputData($h,Th);return Fh.url&&delete Fh.fill,Fh}},ae$1=class extends Kt$2{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData($h,Th){const Fh=super.__getInputData($h,Th);return Fh.url=this.__leaf.canvas.toDataURL("image/png"),Fh}};const{max:ne$1,add:_e$1}=v,he$1={__updateStrokeSpread(){let $h=0,Th=0;const Fh=this.__,{strokeAlign:Wh,__maxStrokeWidth:zh}=Fh,Hh=this.__box;if((Fh.stroke||Fh.hitStroke==="all")&&zh&&Wh!=="inside"&&(Th=$h=Wh==="center"?zh/2:zh,!Fh.__boxStroke)){const Uh=Fh.__isLinePath?0:10*$h,Yh=Fh.strokeCap==="none"?0:zh;$h+=Math.max(Uh,Yh)}return Fh.__useArrow&&($h+=5*zh),Hh&&($h=ne$1($h,Hh.__layout.strokeSpread=Hh.__updateStrokeSpread()),Th=Math.max(Th,Hh.__layout.strokeBoxSpread)),this.__layout.strokeBoxSpread=Th,$h},__updateRenderSpread(){let $h=0;const{shadow:Th,innerShadow:Fh,blur:Wh,backgroundBlur:zh,filter:Hh,renderSpread:Uh}=this.__,{strokeSpread:Yh}=this.__layout,Xh=this.__box;Th&&($h=Tt$2.getShadowRenderSpread(this,Th)),Wh&&($h=ne$1($h,Wh)),Hh&&($h=_e$1($h,Dt$2.getSpread(Hh))),Uh&&($h=_e$1($h,Uh)),Yh&&($h=_e$1($h,Yh));let jh=$h;return Fh&&(jh=ne$1(jh,Tt$2.getInnerShadowSpread(this,Fh))),zh&&(jh=ne$1(jh,zh)),this.__layout.renderShapeSpread=jh,Xh?ne$1(Xh.__updateRenderSpread(),$h):$h}},{stintSet:de$1}=_,le$1={__updateChange(){const $h=this.__;if($h.__useStroke){const Th=$h.__useStroke=!(!$h.stroke||!$h.strokeWidth);de$1(this.__world,"half",Th&&$h.strokeAlign==="center"&&$h.strokeWidth%2),de$1($h,"__fillAfterStroke",Th&&$h.strokeAlign==="outside"&&$h.fill&&!$h.__isTransparentFill)}if($h.__useEffect){const{shadow:Th,fill:Fh,stroke:Wh}=$h,zh=$h.innerShadow||$h.blur||$h.backgroundBlur||$h.filter;de$1($h,"__isFastShadow",Th&&!zh&&Th.length<2&&!Th[0].spread&&!Tt$2.isTransformShadow(Th[0])&&Fh&&!$h.__isTransparentFill&&!(l(Fh)&&Fh.length>1)&&(this.useFastShadow||!Wh||Wh&&$h.strokeAlign==="inside")),$h.__useEffect=!(!Th&&!zh)}$h.__checkSingle(),de$1($h,"__complex",$h.__isFills||$h.__isStrokes||$h.cornerRadius||$h.__useEffect)},__drawFast($h,Th){pe$1(this,$h,Th)},__draw($h,Th,Fh){const Wh=this.__;if(Wh.__complex){Wh.__needComputePaint&&Wh.__computePaint();const{fill:zh,stroke:Hh,__drawAfterFill:Uh,__fillAfterStroke:Yh,__isFastShadow:Xh}=Wh;if(this.__drawRenderPath($h),Wh.__useEffect&&!Xh){const jh=Ft$2.shape(this,$h,Th);this.__nowWorld=this.__getNowWorld(Th);const{shadow:qh,innerShadow:Vh,filter:Zh}=Wh;qh&&Tt$2.shadow(this,$h,jh),Yh&&(Wh.__isStrokes?Ft$2.strokes(Hh,this,$h,Th):Ft$2.stroke(Hh,this,$h,Th)),zh&&(Wh.__isFills?Ft$2.fills(zh,this,$h,Th):Ft$2.fill(zh,this,$h,Th)),Uh&&this.__drawAfterFill($h,Th),Vh&&Tt$2.innerShadow(this,$h,jh),Hh&&!Yh&&(Wh.__isStrokes?Ft$2.strokes(Hh,this,$h,Th):Ft$2.stroke(Hh,this,$h,Th)),Zh&&Dt$2.apply(Zh,this,this.__nowWorld,$h,Fh,jh),jh.worldCanvas&&jh.worldCanvas.recycle(),jh.canvas.recycle()}else{if(Yh&&(Wh.__isStrokes?Ft$2.strokes(Hh,this,$h,Th):Ft$2.stroke(Hh,this,$h,Th)),Xh){const jh=Wh.shadow[0],{scaleX:qh,scaleY:Vh}=this.getRenderScaleData(!0,jh.scaleFixed);$h.save(),$h.setWorldShadow(jh.x*qh,jh.y*Vh,jh.blur*qh,Ct$2.string(jh.color))}zh&&(Wh.__isFills?Ft$2.fills(zh,this,$h,Th):Ft$2.fill(zh,this,$h,Th)),Xh&&$h.restore(),Uh&&this.__drawAfterFill($h,Th),Hh&&!Yh&&(Wh.__isStrokes?Ft$2.strokes(Hh,this,$h,Th):Ft$2.stroke(Hh,this,$h,Th))}}else Wh.__pathForRender?pe$1(this,$h,Th):this.__drawFast($h,Th)},__drawShape($h,Th){this.__drawRenderPath($h);const Fh=this.__,{fill:Wh,stroke:zh}=Fh;Wh&&!Th.ignoreFill&&(Fh.__isAlphaPixelFill?Ft$2.fills(Wh,this,$h,Th):Ft$2.fill("#000000",this,$h,Th)),Fh.__isCanvas&&this.__drawAfterFill($h,Th),zh&&!Th.ignoreStroke&&(Fh.__isAlphaPixelStroke?Ft$2.strokes(zh,this,$h,Th):Ft$2.stroke("#000000",this,$h,Th))},__drawAfterFill($h,Th){this.__.__clipAfterFill?($h.save(),$h.clipUI(this),this.__drawContent($h,Th),$h.restore()):this.__drawContent($h,Th)}};function pe$1($h,Th,Fh){const{fill:Wh,stroke:zh,__drawAfterFill:Hh,__fillAfterStroke:Uh}=$h.__;$h.__drawRenderPath(Th),Uh&&Ft$2.stroke(zh,$h,Th,Fh),Wh&&Ft$2.fill(Wh,$h,Th,Fh),Hh&&$h.__drawAfterFill(Th,Fh),zh&&!Uh&&Ft$2.stroke(zh,$h,Th,Fh)}const ue$1={__drawFast($h,Th){let{x:Fh,y:Wh,width:zh,height:Hh}=this.__layout.boxBounds;const{fill:Uh,stroke:Yh,__drawAfterFill:Xh}=this.__;if(Uh&&($h.fillStyle=Uh,$h.fillRect(Fh,Wh,zh,Hh)),Xh&&this.__drawAfterFill($h,Th),Yh){const{strokeAlign:jh,__strokeWidth:qh}=this.__;if(!qh)return;$h.setStroke(Yh,qh,this.__);const Vh=qh/2;switch(jh){case"center":$h.strokeRect(0,0,zh,Hh);break;case"inside":zh-=qh,Hh-=qh,zh<0||Hh<0?($h.save(),this.__clip($h,Th),$h.strokeRect(Fh+Vh,Wh+Vh,zh,Hh),$h.restore()):$h.strokeRect(Fh+Vh,Wh+Vh,zh,Hh);break;case"outside":$h.strokeRect(Fh-Vh,Wh-Vh,zh+qh,Hh+qh)}}}};var ce$1;let ge$1=ce$1=class extends _h{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale($h){I$1.assignScale(this,$h)}get scale(){return this.__.scale}get isAutoWidth(){const $h=this.__;return $h.__autoWidth||$h.autoWidth}get isAutoHeight(){const $h=this.__;return $h.__autoHeight||$h.autoHeight}get pen(){const{path:$h}=this.__;return ji$1.set(this.path=$h||[]),$h||this.__drawPathByBox(ji$1),ji$1}reset($h){}set($h,Th){$h&&Object.assign(this,$h)}get($h){return i($h)?this.__.__getInput($h):this.__.__getInputData($h)}createProxyData(){}find($h,Th){return he$2.need("find")}findTag($h){return this.find({tag:$h})}findOne($h,Th){return he$2.need("find")}findId($h){return this.findOne({id:$h})}getPath($h,Th){this.__layout.update();let Fh=Th?this.__.__pathForRender:this.__.path;return Fh||(ji$1.set(Fh=[]),this.__drawPathByBox(ji$1,!Th)),$h?sr.toCanvasData(Fh,!0):Fh}getPathString($h,Th,Fh){return sr.stringify(this.getPath($h,Th),Fh)}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const $h=this.__;!$h.lazy||this.__inLazyBounds||It$2.running?$h.__computePaint():$h.__needComputePaint=!0}}__updateRenderPath(){const $h=this.__;$h.path?($h.__pathForRender=$h.cornerRadius?Fi$1.smooth($h.path,$h.cornerRadius,$h.cornerSmoothing):$h.path,$h.__useArrow&&Pt$2.addArrows(this)):$h.__pathForRender&&($h.__pathForRender=void 0)}__drawRenderPath($h){$h.beginPath(),this.__drawPathByData($h,this.__.__pathForRender)}__drawPath($h){$h.beginPath(),this.__drawPathByData($h,this.__.path,!0)}__drawPathByData($h,Th,Fh){Th?ri$2.drawPathByData($h,Th):this.__drawPathByBox($h,Fh)}__drawPathByBox($h,Th){const{x:Fh,y:Wh,width:zh,height:Hh}=this.__layout.boxBounds;if(this.__.cornerRadius&&!Th){const{cornerRadius:Uh}=this.__;$h.roundRect(Fh,Wh,zh,Hh,o(Uh)?[Uh]:Uh)}else $h.rect(Fh,Wh,zh,Hh);$h.closePath()}drawImagePlaceholder($h,Th,Fh){Ft$2.fill(this.__.placeholderColor,this,Th,Fh)}animate($h,Th,Fh,Wh){return this.set($h),he$2.need("animate")}killAnimate($h,Th){}export($h,Th){return he$2.need("export")}syncExport($h,Th){return he$2.need("export")}clone($h){const Th=_.clone(this.toJSON());return $h&&Object.assign(Th,$h),ce$1.one(Th)}static one($h,Th,Fh,Wh,zh){return ce$2.get($h.tag||this.prototype.__tag,$h,Th,Fh,Wh,zh)}static registerUI(){Zn()(this)}static registerData($h){zn($h)(this.prototype)}static setEditConfig($h){}static setEditOuter($h){}static setEditInner($h){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}};St$2([zn(Ut$2)],ge$1.prototype,"__",void 0),St$2([kt$2()],ge$1.prototype,"zoomLayer",void 0),St$2([fn("")],ge$1.prototype,"id",void 0),St$2([fn("")],ge$1.prototype,"name",void 0),St$2([fn("")],ge$1.prototype,"className",void 0),St$2([Ln("pass-through")],ge$1.prototype,"blendMode",void 0),St$2([En(1)],ge$1.prototype,"opacity",void 0),St$2([In(!0)],ge$1.prototype,"visible",void 0),St$2([Ln(!1)],ge$1.prototype,"locked",void 0),St$2([Rn(!1)],ge$1.prototype,"dim",void 0),St$2([Rn(!1)],ge$1.prototype,"dimskip",void 0),St$2([Wn(0)],ge$1.prototype,"zIndex",void 0),St$2([Nn(!1)],ge$1.prototype,"mask",void 0),St$2([Yn(!1)],ge$1.prototype,"eraser",void 0),St$2([gn(0,!0)],ge$1.prototype,"x",void 0),St$2([gn(0,!0)],ge$1.prototype,"y",void 0),St$2([bn(100,!0)],ge$1.prototype,"width",void 0),St$2([bn(100,!0)],ge$1.prototype,"height",void 0),St$2([xn(1,!0)],ge$1.prototype,"scaleX",void 0),St$2([xn(1,!0)],ge$1.prototype,"scaleY",void 0),St$2([wn(0,!0)],ge$1.prototype,"rotation",void 0),St$2([wn(0,!0)],ge$1.prototype,"skewX",void 0),St$2([wn(0,!0)],ge$1.prototype,"skewY",void 0),St$2([gn(0,!0)],ge$1.prototype,"offsetX",void 0),St$2([gn(0,!0)],ge$1.prototype,"offsetY",void 0),St$2([yn(0,!0)],ge$1.prototype,"scrollX",void 0),St$2([yn(0,!0)],ge$1.prototype,"scrollY",void 0),St$2([mn()],ge$1.prototype,"origin",void 0),St$2([mn()],ge$1.prototype,"around",void 0),St$2([fn(!1)],ge$1.prototype,"lazy",void 0),St$2([Bn(1)],ge$1.prototype,"pixelRatio",void 0),St$2([Sn(0)],ge$1.prototype,"renderSpread",void 0),St$2([kn()],ge$1.prototype,"path",void 0),St$2([Cn()],ge$1.prototype,"windingRule",void 0),St$2([Cn(!0)],ge$1.prototype,"closed",void 0),St$2([bn(0)],ge$1.prototype,"padding",void 0),St$2([bn(!1)],ge$1.prototype,"lockRatio",void 0),St$2([bn()],ge$1.prototype,"widthRange",void 0),St$2([bn()],ge$1.prototype,"heightRange",void 0),St$2([fn(!1)],ge$1.prototype,"draggable",void 0),St$2([fn()],ge$1.prototype,"dragBounds",void 0),St$2([fn("auto")],ge$1.prototype,"dragBoundsType",void 0),St$2([fn(!1)],ge$1.prototype,"editable",void 0),St$2([Dn(!0)],ge$1.prototype,"hittable",void 0),St$2([Dn("path")],ge$1.prototype,"hitFill",void 0),St$2([Pn("path")],ge$1.prototype,"hitStroke",void 0),St$2([Dn(!1)],ge$1.prototype,"hitBox",void 0),St$2([Dn(!0)],ge$1.prototype,"hitChildren",void 0),St$2([Dn(!0)],ge$1.prototype,"hitSelf",void 0),St$2([Dn()],ge$1.prototype,"hitRadius",void 0),St$2([Xn("")],ge$1.prototype,"cursor",void 0),St$2([Ln()],ge$1.prototype,"fill",void 0),St$2([Pn(void 0,!0)],ge$1.prototype,"stroke",void 0),St$2([Pn("inside")],ge$1.prototype,"strokeAlign",void 0),St$2([Pn(1,!0)],ge$1.prototype,"strokeWidth",void 0),St$2([Pn(!1)],ge$1.prototype,"strokeWidthFixed",void 0),St$2([Pn("none")],ge$1.prototype,"strokeCap",void 0),St$2([Pn("miter")],ge$1.prototype,"strokeJoin",void 0),St$2([Pn()],ge$1.prototype,"dashPattern",void 0),St$2([Pn(0)],ge$1.prototype,"dashOffset",void 0),St$2([Pn(10)],ge$1.prototype,"miterLimit",void 0),St$2([Cn(0)],ge$1.prototype,"cornerRadius",void 0),St$2([Cn()],ge$1.prototype,"cornerSmoothing",void 0),St$2([mt$2()],ge$1.prototype,"shadow",void 0),St$2([mt$2()],ge$1.prototype,"innerShadow",void 0),St$2([mt$2()],ge$1.prototype,"blur",void 0),St$2([mt$2()],ge$1.prototype,"backgroundBlur",void 0),St$2([mt$2()],ge$1.prototype,"grayscale",void 0),St$2([mt$2()],ge$1.prototype,"filter",void 0),St$2([Ln()],ge$1.prototype,"placeholderColor",void 0),St$2([fn(100)],ge$1.prototype,"placeholderDelay",void 0),St$2([fn({})],ge$1.prototype,"data",void 0),St$2([Gn(_h.prototype.reset)],ge$1.prototype,"reset",null),ge$1=ce$1=St$2([Jn(he$1),Jn(le$1),qn()],ge$1);let ye$1=class extends ge$1{get __tag(){return"Group"}get isBranch(){return!0}reset($h){this.__setBranch(),super.reset($h)}__setBranch(){this.children||(this.children=[])}set($h,Th){if($h)if($h.children){const{children:Fh}=$h;delete $h.children,this.children?this.clear():this.__setBranch(),super.set($h,Th),Fh.forEach(Wh=>this.add(Wh)),$h.children=Fh}else super.set($h,Th)}toJSON($h){const Th=super.toJSON($h);if(!this.childlessJSON){const Fh=Th.children=[];this.children.forEach(Wh=>Wh.skipJSON||Fh.push(Wh.toJSON($h)))}return Th}pick($h,Th){}addAt($h,Th){this.add($h,Th)}addAfter($h,Th){this.add($h,this.children.indexOf(Th)+1)}addBefore($h,Th){this.add($h,this.children.indexOf(Th))}add($h,Th){}addMany(...$h){}remove($h,Th){}removeAll($h){}clear(){}};var ve$1;St$2([zn(jt$2)],ye$1.prototype,"__",void 0),St$2([bn(0)],ye$1.prototype,"width",void 0),St$2([bn(0)],ye$1.prototype,"height",void 0),ye$1=St$2([Jn(vh),Zn()],ye$1);const fe$1=ee$2.get("Leafer");let we$1=ve$1=class extends ye$1{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&Ki$1.isComplete}get layoutLocked(){return!this.layouter.running}get view(){return this.canvas&&this.canvas.view}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds(!0)||D()}constructor($h,Th){super(Th),this.config={start:!0,hittable:!0,smooth:!0,lazySpeard:100},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=$h,$h&&($h.view||$h.width)&&this.init($h),ve$1.list.add(this)}init($h,Th){if(this.canvas)return;let Fh;const{config:Wh}=this;this.__setLeafer(this),Th&&(this.parentApp=Th,this.__bindApp(Th),Fh=Th.running),$h&&(this.parent=Th,this.initType($h.type),this.parent=void 0,_.assign(Wh,$h));const zh=this.canvas=le$2.canvas(Wh);this.__controllers.push(this.renderer=le$2.renderer(this,zh,Wh),this.watcher=le$2.watcher(this,Wh),this.layouter=le$2.layouter(this,Wh)),this.isApp&&this.__setApp(),this.__checkAutoLayout(),Th||(this.selector=le$2.selector(this),this.interaction=le$2.interaction(this,zh,this.selector,Wh),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=le$2.hitCanvasManager()),this.canvasManager=new ge$2,Fh=Wh.start),this.hittable=Wh.hittable,this.fill=Wh.fill,this.canvasManager.add(zh),this.__listenEvents(),Fh&&(this.__startTimer=setTimeout(this.start.bind(this))),So.run(this.__initWait),this.onInit()}onInit(){}initType($h){}set($h,Th){this.waitInit(()=>{super.set($h,Th)})}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.running=!0,this.ready?this.emitLeafer(sa.RESTART):this.emitLeafer(sa.START),this.__controllers.forEach($h=>$h.start()),this.isApp||this.renderer.render())}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach($h=>$h.stop()),this.running=!1,this.emitLeafer(sa.STOP))}unlockLayout($h=!0){this.layouter.start(),$h&&this.updateLayout()}lockLayout($h=!0){$h&&this.updateLayout(),this.layouter.stop()}resize($h){const Th=_.copyAttrs({},$h,Re$2);Object.keys(Th).forEach(Fh=>this[Fh]=Th[Fh])}forceRender($h,Th){const{renderer:Fh}=this;Fh&&(Fh.addBlock($h?new Vt$3($h):this.canvas.bounds),this.viewReady&&(Th?Fh.render():Fh.update()))}requestRender($h=!1){this.renderer&&this.renderer.update($h)}updateCursor($h){const Th=this.interaction;Th&&($h?Th.setCursor($h):Th.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize($h){const{canvas:Th}=this;if(!Th||Th.isSameSize($h))return;const Fh=_.copyAttrs({},this.canvas,Re$2);Th.resize($h),this.updateLazyBounds(),this.__onResize(new $o($h,Fh))}__onResize($h){this.emitEvent($h),_.copyAttrs(this.__,$h,Re$2),setTimeout(()=>{this.canvasManager&&this.canvasManager.clearRecycled()},0)}__setApp(){}__bindApp($h){this.selector=$h.selector,this.interaction=$h.interaction,this.canvasManager=$h.canvasManager,this.hitCanvasManager=$h.hitCanvasManager}__setLeafer($h){this.leafer=$h,this.__level=1}__checkAutoLayout(){const{config:$h,parentApp:Th}=this;Th||($h.width&&$h.height||(this.autoLayout=new Gt$2($h)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr($h,Th){return this.canvas&&(Re$2.includes($h)?this.__changeCanvasSize($h,Th):$h==="fill"?this.__changeFill(Th):$h==="hittable"?this.parent||(this.canvas.hittable=Th):$h==="zIndex"?(this.canvas.zIndex=Th,setTimeout(()=>this.parent&&this.parent.__updateSortChildren())):$h==="mode"&&this.emit(sa.UPDATE_MODE,{mode:Th})),super.__setAttr($h,Th)}__getAttr($h){return this.canvas&&Re$2.includes($h)?this.canvas[$h]:super.__getAttr($h)}__changeCanvasSize($h,Th){const{config:Fh,canvas:Wh}=this,zh=_.copyAttrs({},Wh,Re$2);zh[$h]=Fh[$h]=Th,Fh.width&&Fh.height?Wh.stopAutoLayout():this.__checkAutoLayout(),this.__doResize(zh)}__changeFill($h){this.config.fill=$h,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=$h:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready=!0,this.emitLeafer(sa.BEFORE_READY),this.emitLeafer(sa.READY),this.emitLeafer(sa.AFTER_READY),So.run(this.__readyWait)}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(sa.VIEW_READY),So.run(this.__viewReadyWait))}__onLayoutEnd(){const{grow:$h,width:Th,height:Fh}=this.config;if($h){let{width:Wh,height:zh,pixelRatio:Hh}=this;const Uh=$h==="box"?this.worldBoxBounds:this.__world;Th||(Wh=Math.max(1,Uh.x+Uh.width)),Fh||(zh=Math.max(1,Uh.y+Uh.height)),this.__doResize({width:Wh,height:zh,pixelRatio:Hh})}this.ready||this.__onReady()}__onNextRender(){if(this.viewReady){So.run(this.__nextRenderWait);const{imageReady:$h}=this;$h&&!this.viewCompleted&&this.__checkViewCompleted(),$h||(this.viewCompleted=!1,this.requestRender())}else this.requestRender()}__checkViewCompleted($h=!0){this.nextRender(()=>{this.imageReady&&($h&&this.emitLeafer(sa.VIEW_COMPLETED),So.run(this.__viewCompletedWait),this.viewCompleted=!0)})}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender(()=>this.interaction.updateCursor())}waitInit($h,Th){Th&&($h=$h.bind(Th)),this.__initWait||(this.__initWait=[]),this.canvas?$h():this.__initWait.push($h)}waitReady($h,Th){Th&&($h=$h.bind(Th)),this.ready?$h():this.__readyWait.push($h)}waitViewReady($h,Th){Th&&($h=$h.bind(Th)),this.viewReady?$h():this.__viewReadyWait.push($h)}waitViewCompleted($h,Th){Th&&($h=$h.bind(Th)),this.__viewCompletedWait.push($h),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender($h,Th,Fh){Th&&($h=$h.bind(Th));const Wh=this.__nextRenderWait;if(Fh){for(let zh=0;zh<Wh.length;zh++)if(Wh[zh]===$h){Wh.splice(zh,1);break}}else Wh.push($h);this.requestRender()}zoom($h,Th,Fh,Wh){return he$2.need("view")}getValidMove($h,Th,Fh){return{x:$h,y:Th}}getValidScale($h){return $h}getWorldPointByClient($h,Th){return this.interaction&&this.interaction.getLocal($h,Th)}getPagePointByClient($h,Th){return this.getPagePoint(this.getWorldPointByClient($h,Th))}getClientPointByWorld($h){const{x:Th,y:Fh}=this.clientBounds;return{x:Th+$h.x,y:Fh+$h.y}}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent($h){}emitLeafer($h){this.emitEvent(new sa($h,this))}__listenEvents(){const $h=ne$2.start("FirstCreate "+this.innerName);this.once([[sa.START,()=>ne$2.end($h)],[ta.START,this.updateLazyBounds,this],[ea.START,this.__onCreated,this],[ea.END,this.__onViewReady,this]]),this.__eventIds.push(this.on_([[Ko.DATA,this.__onWatchData,this],[ta.END,this.__onLayoutEnd,this],[ea.NEXT,this.__onNextRender,this]]))}__removeListenEvents(){this.off_(this.__eventIds)}destroy($h){const Th=()=>{if(!this.destroyed){ve$1.list.remove(this);try{this.stop(),this.emitLeafer(sa.END),this.__removeListenEvents(),this.__controllers.forEach(Fh=>!(this.parent&&Fh===this.interaction)&&Fh.destroy()),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager&&this.canvasManager.destroy()),this.canvas&&this.canvas.destroy(),this.config.view=this.parentApp=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout(()=>{en.clearRecycled()},100)}catch(Fh){fe$1.error(Fh)}}};$h?Th():setTimeout(Th)}};we$1.list=new kh,St$2([zn(qt$1)],we$1.prototype,"__",void 0),St$2([bn()],we$1.prototype,"pixelRatio",void 0),St$2([fn("normal")],we$1.prototype,"mode",void 0),we$1=ve$1=St$2([Zn()],we$1);let xe$1=class extends ge$1{get __tag(){return"Rect"}};St$2([zn(Kt$2)],xe$1.prototype,"__",void 0),xe$1=St$2([Jn(ue$1),qn(),Zn()],xe$1);const{add:Se$1,includes:me$1,scroll:Re$1}=zt$2,ke$1=xe$1.prototype,Be$1=ye$1.prototype;let Ae$1=class extends ye$1{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor($h){super($h),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds($h){if(this.children.length&&!this.pathInputed){const Th=this.__;if(Th.__autoSide){Th.__hasSurface&&this.__extraUpdate(),super.__updateBoxBounds();const{boxBounds:Fh}=this.__layout;Th.__autoSize||(Th.__autoWidth?(Fh.width+=Fh.x,Fh.x=0,Fh.height=Th.height,Fh.y=0):(Fh.height+=Fh.y,Fh.y=0,Fh.width=Th.width,Fh.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds()}else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let $h,Th;if(this.children.length){const Fh=this.__,Wh=this.__layout,{renderBounds:zh,boxBounds:Hh}=Wh,{overflow:Uh}=Fh,Yh=Wh.childrenRenderBounds||(Wh.childrenRenderBounds=D());super.__updateRenderBounds(Yh),(Th=Uh&&Uh.includes("scroll"))&&(Se$1(Yh,Hh),Re$1(Yh,Fh)),this.__updateRectRenderBounds(),$h=!me$1(Hh,Yh),$h&&Uh==="show"&&Se$1(zh,Yh)}else this.__updateRectRenderBounds();_.stintSet(this,"isOverflow",$h),this.__checkScroll(Th)}__updateRectRenderBounds(){}__checkScroll($h){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect($h,Th){}__renderGroup($h,Th){}__render($h,Th){this.__.__drawAfterFill?this.__renderRect($h,Th):(this.__renderRect($h,Th),this.children.length&&this.__renderGroup($h,Th)),this.hasScroller&&this.scroller.__render($h,Th)}__drawContent($h,Th){this.__renderGroup($h,Th),(this.__.__useStroke||this.__.__useEffect)&&($h.setWorld(this.__nowWorld),this.__drawRenderPath($h))}};St$2([zn(Jt$1)],Ae$1.prototype,"__",void 0),St$2([bn(100)],Ae$1.prototype,"width",void 0),St$2([bn(100)],Ae$1.prototype,"height",void 0),St$2([fn(!1)],Ae$1.prototype,"resizeChildren",void 0),St$2([Sn("show")],Ae$1.prototype,"overflow",void 0),St$2([Gn(ke$1.__updateStrokeSpread)],Ae$1.prototype,"__updateStrokeSpread",null),St$2([Gn(ke$1.__updateRenderSpread)],Ae$1.prototype,"__updateRectRenderSpread",null),St$2([Gn(ke$1.__updateBoxBounds)],Ae$1.prototype,"__updateRectBoxBounds",null),St$2([Gn(ke$1.__updateStrokeBounds)],Ae$1.prototype,"__updateStrokeBounds",null),St$2([Gn(ke$1.__updateRenderBounds)],Ae$1.prototype,"__updateRectRenderBounds",null),St$2([Gn(ke$1.__updateChange)],Ae$1.prototype,"__updateRectChange",null),St$2([Gn(ke$1.__render)],Ae$1.prototype,"__renderRect",null),St$2([Gn(Be$1.__render)],Ae$1.prototype,"__renderGroup",null),Ae$1=St$2([qn(),Zn()],Ae$1);let Ce$1=class extends Ae$1{get __tag(){return"Frame"}get isFrame(){return!0}};St$2([zn(Gt$1)],Ce$1.prototype,"__",void 0),St$2([Ln("#FFFFFF")],Ce$1.prototype,"fill",void 0),St$2([Sn("hide")],Ce$1.prototype,"overflow",void 0),Ce$1=St$2([Zn()],Ce$1);const{moveTo:be$1,closePath:Pe$1,ellipse:Fe$1}=Cr;let We$1=class extends ge$1{get __tag(){return"Ellipse"}__updatePath(){const{width:$h,height:Th,innerRadius:Fh,startAngle:Wh,endAngle:zh}=this.__,Hh=$h/2,Uh=Th/2,Yh=this.__.path=[];let Xh;Fh?Wh||zh?(Fh<1?Fe$1(Yh,Hh,Uh,Hh*Fh,Uh*Fh,0,Wh,zh,!1):Xh=!0,Fe$1(Yh,Hh,Uh,Hh,Uh,0,zh,Wh,!0)):(Fh<1&&(Fe$1(Yh,Hh,Uh,Hh*Fh,Uh*Fh),be$1(Yh,$h,Uh)),Fe$1(Yh,Hh,Uh,Hh,Uh,0,360,0,!0)):Wh||zh?(be$1(Yh,Hh,Uh),Fe$1(Yh,Hh,Uh,Hh,Uh,0,Wh,zh,!1)):Fe$1(Yh,Hh,Uh,Hh,Uh),Xh||Pe$1(Yh),$t$2.ellipseToCurve&&(this.__.path=this.getPath(!0))}};St$2([zn(Qt$1)],We$1.prototype,"__",void 0),St$2([Cn(0)],We$1.prototype,"innerRadius",void 0),St$2([Cn(0)],We$1.prototype,"startAngle",void 0),St$2([Cn(0)],We$1.prototype,"endAngle",void 0),We$1=St$2([Zn()],We$1);const{sin:Ee$1,cos:Te$1,PI:De$1}=Math,{moveTo:Ie$1,lineTo:Le$1,closePath:ze$1,drawPoints:Me$1}=Cr;let Oe$1=class extends ge$1{get __tag(){return"Polygon"}__updatePath(){const $h=this.__,Th=$h.path=[];if($h.points)Me$1(Th,$h.points,$h.curve,!0);else{const{width:Fh,height:Wh,sides:zh}=$h,Hh=Fh/2,Uh=Wh/2;Ie$1(Th,Hh,0);for(let Yh=1;Yh<zh;Yh++)Le$1(Th,Hh+Hh*Ee$1(2*Yh*De$1/zh),Uh-Uh*Te$1(2*Yh*De$1/zh));ze$1(Th)}}};St$2([zn(Zt$1)],Oe$1.prototype,"__",void 0),St$2([Cn(3)],Oe$1.prototype,"sides",void 0),St$2([Cn()],Oe$1.prototype,"points",void 0),St$2([Cn(0)],Oe$1.prototype,"curve",void 0),Oe$1=St$2([qn(),Zn()],Oe$1);const{sin:Ne$1,cos:Ve$1,PI:He$1}=Math,{moveTo:Ye$1,lineTo:Ue$1,closePath:Xe$1}=Cr;let je$1=class extends ge$1{get __tag(){return"Star"}__updatePath(){const{width:$h,height:Th,corners:Fh,innerRadius:Wh}=this.__,zh=$h/2,Hh=Th/2,Uh=this.__.path=[];Ye$1(Uh,zh,0);for(let Yh=1;Yh<2*Fh;Yh++)Ue$1(Uh,zh+(Yh%2==0?zh:zh*Wh)*Ne$1(Yh*He$1/Fh),Hh-(Yh%2==0?Hh:Hh*Wh)*Ve$1(Yh*He$1/Fh));Xe$1(Uh)}};St$2([zn(te$1)],je$1.prototype,"__",void 0),St$2([Cn(5)],je$1.prototype,"corners",void 0),St$2([Cn(.382)],je$1.prototype,"innerRadius",void 0),je$1=St$2([Zn()],je$1);const{moveTo:Je$1,lineTo:qe$1,drawPoints:Ge$1}=Cr,{rotate:$e$1,getAngle:Ke$1,getDistance:Qe$1,defaultPoint:Ze$1}=ot$2;let ti$1=class extends ge$1{get __tag(){return"Line"}get toPoint(){const{width:$h,rotation:Th}=this.__,Fh=Y$1();return $h&&(Fh.x=$h),Th&&$e$1(Fh,Th),Fh}set toPoint($h){this.width=Qe$1(Ze$1,$h),this.rotation=Ke$1(Ze$1,$h),this.height&&(this.height=0)}__updatePath(){const $h=this.__,Th=$h.path=[];$h.points?Ge$1(Th,$h.points,$h.curve,$h.closed):(Je$1(Th,0,0),qe$1(Th,this.width,0))}};St$2([zn($t$1)],ti$1.prototype,"__",void 0),St$2([On("center")],ti$1.prototype,"strokeAlign",void 0),St$2([bn(0)],ti$1.prototype,"height",void 0),St$2([Cn()],ti$1.prototype,"points",void 0),St$2([Cn(0)],ti$1.prototype,"curve",void 0),St$2([Cn(!1)],ti$1.prototype,"closed",void 0),ti$1=St$2([Zn()],ti$1);let ei$1=class extends xe$1{get __tag(){return"Image"}get ready(){const{image:$h}=this;return $h&&$h.ready}get image(){const{fill:$h}=this.__;return l($h)&&$h[0].image}};St$2([zn(re$1)],ei$1.prototype,"__",void 0),St$2([bn("")],ei$1.prototype,"url",void 0),ei$1=St$2([Zn()],ei$1);const ii$1=ei$1;let si$1=class extends xe$1{get __tag(){return"Canvas"}get context(){return this.canvas.context}get ready(){return!this.url}constructor($h){super($h),this.canvas=le$2.canvas(this.__),$h&&$h.url&&this.drawImage($h.url)}drawImage($h){new on({url:$h}).load(Th=>{this.context.drawImage(Th.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new Vo(Vo.LOADED,{image:Th}))})}draw($h,Th,Fh,Wh){const zh=new pt$2($h.worldTransform).invert(),Hh=new pt$2;Th&&Hh.translate(Th.x,Th.y),Fh&&(o(Fh)?Hh.scale(Fh):Hh.scale(Fh.x,Fh.y)),Wh&&Hh.rotate(Wh),zh.multiplyParent(Hh),$h.__render(this.canvas,{matrix:zh.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent($h,Th){const{width:Fh,height:Wh}=this.__,{view:zh}=this.canvas;$h.drawImage(zh,0,0,zh.width,zh.height,0,0,Fh,Wh)}__updateSize(){const{canvas:$h}=this;if($h){const{smooth:Th,safeResize:Fh}=this.__;$h.resize(this.__,Fh),$h.smooth!==Th&&($h.smooth=Th)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=null),super.destroy()}};St$2([zn(ae$1)],si$1.prototype,"__",void 0),St$2([Rt$2(100)],si$1.prototype,"width",void 0),St$2([Rt$2(100)],si$1.prototype,"height",void 0),St$2([Rt$2(1)],si$1.prototype,"pixelRatio",void 0),St$2([Rt$2(!0)],si$1.prototype,"smooth",void 0),St$2([fn(!1)],si$1.prototype,"safeResize",void 0),St$2([Rt$2()],si$1.prototype,"contextSettings",void 0),si$1=St$2([Zn()],si$1);const{copyAndSpread:oi$1,includes:ri$1,spread:ai$1,setList:ni$1}=zt$2,{stintSet:_i$1}=_;let hi$1=class extends ge$1{get __tag(){return"Text"}get textDrawData(){return this.updateLayout(),this.__.__textDrawData}__updateTextDrawData(){const $h=this.__,{lineHeight:Th,letterSpacing:Fh,fontFamily:Wh,fontSize:zh,fontWeight:Hh,italic:Uh,textCase:Yh,textOverflow:Xh,padding:jh,width:qh,height:Vh}=$h;$h.__lineHeight=bt$2.number(Th,zh),$h.__letterSpacing=bt$2.number(Fh,zh),$h.__baseLine=$h.__lineHeight-($h.__lineHeight-.7*zh)/2,$h.__font=`${Uh?"italic ":""}${Yh==="small-caps"?"small-caps ":""}${Hh!=="normal"?Hh+" ":""}${zh||12}px ${Wh||"caption"}`,_i$1($h,"__padding",jh&&I$1.fourNumber(jh)),_i$1($h,"__clipText",Xh!=="show"&&!$h.__autoSize),_i$1($h,"__isCharMode",qh||Vh||$h.__letterSpacing||Yh!=="none"),$h.__textDrawData=At$2.getDrawData(($h.__isPlacehold=$h.placeholder&&$h.text==="")?$h.placeholder:$h.text,this.__)}__updateBoxBounds(){const $h=this.__,Th=this.__layout,{fontSize:Fh,italic:Wh,padding:zh,__autoWidth:Hh,__autoHeight:Uh}=$h;this.__updateTextDrawData();const{bounds:Yh}=$h.__textDrawData,Xh=Th.boxBounds;if(Th.contentBounds=Yh,$h.__lineHeight<Fh&&ai$1(Yh,Fh/2),Hh||Uh){if(Xh.x=Hh?Yh.x:0,Xh.y=Uh?Yh.y:0,Xh.width=Hh?Yh.width:$h.width,Xh.height=Uh?Yh.height:$h.height,zh){const[jh,qh,Vh,Zh]=$h.__padding;Hh&&(Xh.x-=Zh,Xh.width+=qh+Zh),Uh&&(Xh.y-=jh,Xh.height+=Vh+jh)}this.__updateNaturalSize()}else super.__updateBoxBounds();Wh&&(Xh.width+=.16*Fh),_.stintSet(this,"isOverflow",!ri$1(Xh,Yh)),this.isOverflow?(ni$1($h.__textBoxBounds={},[Xh,Yh]),Th.renderChanged=!0):$h.__textBoxBounds=Xh}__updateRenderSpread(){let $h=super.__updateRenderSpread();return $h||($h=this.isOverflow?1:0),$h}__updateRenderBounds(){const{renderBounds:$h,renderSpread:Th}=this.__layout;oi$1($h,this.__.__textBoxBounds,Th),this.__box&&(this.__box.__layout.renderBounds=$h)}__updateChange(){super.__updateChange();const $h=this.__box;$h&&($h.__onUpdateSize(),$h.__updateChange())}__drawRenderPath($h){$h.font=this.__.__font}__draw($h,Th,Fh){const Wh=this.__box;Wh&&(Wh.__nowWorld=this.__nowWorld,Wh.__draw($h,Th,Fh)),this.textEditing&&!Th.exporting||super.__draw($h,Th,Fh)}__drawShape($h,Th){Th.shape&&this.__box&&this.__box.__drawShape($h,Th),super.__drawShape($h,Th)}destroy(){this.boxStyle&&(this.boxStyle=null),super.destroy()}};St$2([zn(oe$1)],hi$1.prototype,"__",void 0),St$2([bn(0)],hi$1.prototype,"width",void 0),St$2([bn(0)],hi$1.prototype,"height",void 0),St$2([Ln()],hi$1.prototype,"boxStyle",void 0),St$2([fn(!1)],hi$1.prototype,"resizeFontSize",void 0),St$2([Ln("#000000")],hi$1.prototype,"fill",void 0),St$2([On("outside")],hi$1.prototype,"strokeAlign",void 0),St$2([Dn("all")],hi$1.prototype,"hitFill",void 0),St$2([bn("")],hi$1.prototype,"text",void 0),St$2([bn("")],hi$1.prototype,"placeholder",void 0),St$2([bn("caption")],hi$1.prototype,"fontFamily",void 0),St$2([bn(12)],hi$1.prototype,"fontSize",void 0),St$2([bn("normal")],hi$1.prototype,"fontWeight",void 0),St$2([bn(!1)],hi$1.prototype,"italic",void 0),St$2([bn("none")],hi$1.prototype,"textCase",void 0),St$2([bn("none")],hi$1.prototype,"textDecoration",void 0),St$2([bn(0)],hi$1.prototype,"letterSpacing",void 0),St$2([bn({type:"percent",value:1.5})],hi$1.prototype,"lineHeight",void 0),St$2([bn(0)],hi$1.prototype,"paraIndent",void 0),St$2([bn(0)],hi$1.prototype,"paraSpacing",void 0),St$2([bn("x")],hi$1.prototype,"writingMode",void 0),St$2([bn("left")],hi$1.prototype,"textAlign",void 0),St$2([bn("top")],hi$1.prototype,"verticalAlign",void 0),St$2([bn(!0)],hi$1.prototype,"autoSizeAlign",void 0),St$2([bn("normal")],hi$1.prototype,"textWrap",void 0),St$2([bn("show")],hi$1.prototype,"textOverflow",void 0),St$2([Ln(!1)],hi$1.prototype,"textEditing",void 0),hi$1=St$2([Zn()],hi$1);let di$1=class extends ge$1{get __tag(){return"Path"}};St$2([zn(ee$1)],di$1.prototype,"__",void 0),St$2([On("center")],di$1.prototype,"strokeAlign",void 0),di$1=St$2([Zn()],di$1);let li$1=class extends ye$1{get __tag(){return"Pen"}setStyle($h){const Th=this.pathElement=new di$1($h);return this.pathStyle=$h,this.__path=Th.path||(Th.path=[]),this.add(Th),this}beginPath(){return this}moveTo($h,Th){return this}lineTo($h,Th){return this}bezierCurveTo($h,Th,Fh,Wh,zh,Hh){return this}quadraticCurveTo($h,Th,Fh,Wh){return this}closePath(){return this}rect($h,Th,Fh,Wh){return this}roundRect($h,Th,Fh,Wh,zh){return this}ellipse($h,Th,Fh,Wh,zh,Hh,Uh,Yh){return this}arc($h,Th,Fh,Wh,zh,Hh){return this}arcTo($h,Th,Fh,Wh,zh){return this}drawEllipse($h,Th,Fh,Wh,zh,Hh,Uh,Yh){return this}drawArc($h,Th,Fh,Wh,zh,Hh){return this}drawPoints($h,Th,Fh){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}};St$2([zn(ie$1)],li$1.prototype,"__",void 0),St$2([($h,Th)=>{ln($h,Th,{get(){return this.__path}})}],li$1.prototype,"path",void 0),li$1=St$2([Jn(Fr,["set","path","paint"]),Zn()],li$1);function I($h,Th,Fh,Wh){var zh,Hh=arguments.length,Uh=Hh<3?Th:Wh===null?Wh=Object.getOwnPropertyDescriptor(Th,Fh):Wh;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Uh=Reflect.decorate($h,Th,Fh,Wh);else for(var Yh=$h.length-1;Yh>=0;Yh--)(zh=$h[Yh])&&(Uh=(Hh<3?zh(Uh):Hh>3?zh(Th,Fh,Uh):zh(Th,Fh))||Uh);return Hh>3&&Uh&&Object.defineProperty(Th,Fh,Uh),Uh}let N=class extends we$1{get __tag(){return"App"}get isApp(){return!0}constructor($h,Th){super($h,Th)}init($h,Th){if(super.init($h,Th),$h){const{ground:Fh,tree:Wh,sky:zh,editor:Hh}=$h;Fh&&(this.ground=this.addLeafer(Fh)),(Wh||Hh)&&(this.tree=this.addLeafer(Wh||{type:$h.type||"design"})),(zh||Hh)&&(this.sky=this.addLeafer(zh)),Hh&&le$2.editor(Hh,this)}}__setApp(){const{canvas:$h}=this,{realCanvas:Th,view:Fh}=this.config;Th||Fh===this.canvas.view||!$h.parentView?this.realCanvas=!0:$h.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable()}__updateLocalBounds(){this.forEach($h=>$h.updateLayout()),super.__updateLocalBounds()}start(){super.start(),this.forEach($h=>$h.start())}stop(){this.forEach($h=>$h.stop()),super.stop()}unlockLayout(){super.unlockLayout(),this.forEach($h=>$h.unlockLayout())}lockLayout(){super.lockLayout(),this.forEach($h=>$h.lockLayout())}forceRender($h,Th){this.forEach(Fh=>Fh.forceRender($h,Th))}addLeafer($h){const Th=new we$1($h);return this.add(Th),Th}add($h,Th){if(!$h.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout(()=>this.add($h,Th),10);$h.init(this.__getChildConfig($h.userConfig),this)}super.add($h,Th),s(Th)||($h.canvas.childIndex=Th),this.__listenChildEvents($h)}forEach($h){this.children.forEach($h)}__onCreated(){this.created=this.children.every($h=>$h.created)}__onReady(){this.children.every($h=>$h.ready)&&super.__onReady()}__onViewReady(){this.children.every($h=>$h.viewReady)&&super.__onViewReady()}__onChildRenderEnd($h){this.renderer.addBlock($h.renderBounds),this.viewReady&&this.renderer.update()}__render($h,Th){$h.context&&this.forEach(Fh=>Th.matrix?Fh.__render($h,Th):$h.copyWorld(Fh.canvas,Th.bounds))}__onResize($h){this.forEach(Th=>Th.resize($h)),super.__onResize($h)}updateLayout(){this.forEach($h=>$h.updateLayout())}__getChildConfig($h){const Th=Object.assign({},this.config);return Th.hittable=Th.realCanvas=void 0,$h&&_.assign(Th,$h),this.autoLayout&&_.copyAttrs(Th,this,Re$2),Th.view=this.realCanvas?void 0:this.view,Th.fill=void 0,Th}__listenChildEvents($h){$h.once([[ta.END,this.__onReady,this],[ea.START,this.__onCreated,this],[ea.END,this.__onViewReady,this]]),this.realCanvas&&this.__eventIds.push($h.on_(ea.END,this.__onChildRenderEnd,this))}};N=I([Zn()],N);const F={},W={isHoldSpaceKey:()=>W.isHold("Space"),isHold:$h=>F[$h],isHoldKeys:($h,Th)=>Th?$h(Th):void 0,setDownCode($h){F[$h]||(F[$h]=!0)},setUpCode($h){F[$h]=!1}},K={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft($h){$h.buttons||($h.buttons=1)},left:$h=>$h.buttons===1,right:$h=>$h.buttons===2,middle:$h=>$h.buttons===4};class V extends Xo{get spaceKey(){return W.isHoldSpaceKey()}get left(){return K.left(this)}get right(){return K.right(this)}get middle(){return K.middle(this)}constructor(Th){super(Th.type),this.bubbles=!0,Object.assign(this,Th)}isHoldKeys(Th){return W.isHoldKeys(Th,this)}getBoxPoint(Th){return(Th||this.current).getBoxPoint(this)}getInnerPoint(Th){return(Th||this.current).getInnerPoint(this)}getLocalPoint(Th){return(Th||this.current).getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}getInner(Th){return this.getInnerPoint(Th)}getLocal(Th){return this.getLocalPoint(Th)}getPage(){return this.getPagePoint()}static changeName(Th,Fh){pe$2.changeName(Th,Fh)}}const{min:U,max:j,abs:X}=Math,{float:Y,sign:z}=I$1,{minX:G,maxX:Z$1,minY:q,maxY:J$1}=zt$2,Q=new Vt$3,$=new Vt$3,tt$1={limitMove($h,Th){const{dragBounds:Fh,dragBoundsType:Wh}=$h;Fh&&et$1.getValidMove($h.__localBoxBounds,et$1.getDragBounds($h),Wh,Th,!0),et$1.axisMove($h,Th)},limitScaleOf($h,Th,Fh,Wh){const{dragBounds:zh,dragBoundsType:Hh}=$h;zh&&et$1.getValidScaleOf($h.__localBoxBounds,et$1.getDragBounds($h),Hh,$h.getLocalPointByInner($h.getInnerPointByBox(Th)),Fh,Wh,!0)},axisMove($h,Th){const{draggable:Fh}=$h;Fh==="x"&&(Th.y=0),Fh==="y"&&(Th.x=0)},getDragBounds($h){const{dragBounds:Th}=$h;return Th==="parent"?$h.parent.boxBounds:Th},isInnerMode:($h,Th,Fh,Wh)=>Fh==="inner"||Fh==="auto"&&$h[Wh]>Th[Wh],getValidMove($h,Th,Fh,Wh,zh){const Hh=$h.x+Wh.x,Uh=$h.y+Wh.y,Yh=Hh+$h.width,Xh=Uh+$h.height,jh=Th.x+Th.width,qh=Th.y+Th.height;return zh||(Wh=Object.assign({},Wh)),et$1.isInnerMode($h,Th,Fh,"width")?Hh>Th.x?Wh.x+=Th.x-Hh:Yh<jh&&(Wh.x+=jh-Yh):Hh<Th.x?Wh.x+=Th.x-Hh:Yh>jh&&(Wh.x+=jh-Yh),et$1.isInnerMode($h,Th,Fh,"height")?Uh>Th.y?Wh.y+=Th.y-Uh:Xh<qh&&(Wh.y+=qh-Xh):Uh<Th.y?Wh.y+=Th.y-Uh:Xh>qh&&(Wh.y+=qh-Xh),Wh.x=Y(Wh.x),Wh.y=Y(Wh.y),Wh},getValidScaleOf($h,Th,Fh,Wh,zh,Hh,Uh){Uh||(zh=Object.assign({},zh)),$.set(Th),Q.set($h).scaleOf(Wh,zh.x,zh.y);const Yh=(Wh.x-$h.x)/$h.width,Xh=1-Yh,jh=(Wh.y-$h.y)/$h.height,qh=1-jh;let Vh,Zh,Kh,Qh,Jh=1,td=1;return et$1.isInnerMode($h,Th,Fh,"width")?(zh.x<0&&Q.scaleOf(Wh,Jh=1/zh.x,1),Kh=Y(Q.minX-$.minX),Qh=Y($.maxX-Q.maxX),Vh=Yh&&Kh>0?1+Kh/(Yh*Q.width):1,Zh=Xh&&Qh>0?1+Qh/(Xh*Q.width):1,Jh*=j(Vh,Zh)):(zh.x<0&&((Y(G($h)-G(Th))<=0||Y(Z$1(Th)-Z$1($h))<=0)&&Q.scaleOf(Wh,Jh=1/zh.x,1),Q.unsign()),Kh=Y($.minX-Q.minX),Qh=Y(Q.maxX-$.maxX),Vh=Yh&&Kh>0?1-Kh/(Yh*Q.width):1,Zh=Xh&&Qh>0?1-Qh/(Xh*Q.width):1,Jh*=U(Vh,Zh)),et$1.isInnerMode($h,Th,Fh,"height")?(zh.y<0&&Q.scaleOf(Wh,1,td=1/zh.y),Kh=Y(Q.minY-$.minY),Qh=Y($.maxY-Q.maxY),Vh=jh&&Kh>0?1+Kh/(jh*Q.height):1,Zh=qh&&Qh>0?1+Qh/(qh*Q.height):1,td*=j(Vh,Zh),Hh&&(Vh=j(X(Jh),X(td)),Jh=z(Jh)*Vh,td=z(td)*Vh)):(zh.y<0&&((Y(q($h)-q(Th))<=0||Y(J$1(Th)-J$1($h))<=0)&&Q.scaleOf(Wh,1,td=1/zh.y),Q.unsign()),Kh=Y($.minY-Q.minY),Qh=Y(Q.maxY-$.maxY),Vh=jh&&Kh>0?1-Kh/(jh*Q.height):1,Zh=qh&&Qh>0?1-Qh/(qh*Q.height):1,td*=U(Vh,Zh)),zh.x*=n(Jh)?Jh:1,zh.y*=n(td)?td:1,zh}},et$1=tt$1;let it$1=class extends V{};it$1.POINTER="pointer",it$1.BEFORE_DOWN="pointer.before_down",it$1.BEFORE_MOVE="pointer.before_move",it$1.BEFORE_UP="pointer.before_up",it$1.DOWN="pointer.down",it$1.MOVE="pointer.move",it$1.UP="pointer.up",it$1.OVER="pointer.over",it$1.OUT="pointer.out",it$1.ENTER="pointer.enter",it$1.LEAVE="pointer.leave",it$1.TAP="tap",it$1.DOUBLE_TAP="double_tap",it$1.CLICK="click",it$1.DOUBLE_CLICK="double_click",it$1.LONG_PRESS="long_press",it$1.LONG_TAP="long_tap",it$1.MENU="pointer.menu",it$1.MENU_TAP="pointer.menu_tap",it$1=I([$n()],it$1);const st$1=it$1,at$1={};let nt$1=class extends it$1{static setList($h){this.list=$h instanceof kh?$h:new kh($h)}static setData($h){this.data=$h}static getValidMove($h,Th,Fh,Wh=!0){const zh=$h.getLocalPoint(Fh,null,!0);return ot$2.move(zh,Th.x-$h.x,Th.y-$h.y),Wh&&this.limitMove($h,zh),tt$1.axisMove($h,zh),zh}static limitMove($h,Th){tt$1.limitMove($h,Th)}getPageMove($h){return this.assignMove($h),this.current.getPagePoint(at$1,null,!0)}getInnerMove($h,Th){return $h||($h=this.current),this.assignMove(Th),$h.getInnerPoint(at$1,null,!0)}getLocalMove($h,Th){return $h||($h=this.current),this.assignMove(Th),$h.getLocalPoint(at$1,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal($h){return this.getInnerMove($h,!0)}getLocalTotal($h){return this.getLocalMove($h,!0)}getPageBounds(){const $h=this.getPageTotal(),Th=this.getPagePoint(),Fh={};return zt$2.set(Fh,Th.x-$h.x,Th.y-$h.y,$h.x,$h.y),zt$2.unsign(Fh),Fh}assignMove($h){at$1.x=$h?this.totalX:this.moveX,at$1.y=$h?this.totalY:this.moveY}};nt$1.BEFORE_DRAG="drag.before_drag",nt$1.START="drag.start",nt$1.DRAG="drag",nt$1.END="drag.end",nt$1.OVER="drag.over",nt$1.OUT="drag.out",nt$1.ENTER="drag.enter",nt$1.LEAVE="drag.leave",nt$1=I([$n()],nt$1);const rt$1=nt$1;let ht$1=class extends it$1{static setList($h){nt$1.setList($h)}static setData($h){nt$1.setData($h)}};ht$1.DROP="drop",ht$1=I([$n()],ht$1);let ot$1=class extends nt$1{};ot$1.BEFORE_MOVE="move.before_move",ot$1.START="move.start",ot$1.MOVE="move",ot$1.DRAG_ANIMATE="move.drag_animate",ot$1.END="move.end",ot$1.PULL_DOWN="move.pull_down",ot$1.REACH_BOTTOM="move.reach_bottom",ot$1=I([$n()],ot$1);let dt$1=class extends V{};dt$1=I([$n()],dt$1);const gt$1=dt$1;let lt$1=class extends it$1{};lt$1.BEFORE_ROTATE="rotate.before_rotate",lt$1.START="rotate.start",lt$1.ROTATE="rotate",lt$1.END="rotate.end",lt$1=I([$n()],lt$1);let ct$1=class extends nt$1{};ct$1.SWIPE="swipe",ct$1.LEFT="swipe.left",ct$1.RIGHT="swipe.right",ct$1.UP="swipe.up",ct$1.DOWN="swipe.down",ct$1=I([$n()],ct$1);let ut$1=class extends it$1{};ut$1.BEFORE_ZOOM="zoom.before_zoom",ut$1.START="zoom.start",ut$1.ZOOM="zoom",ut$1.END="zoom.end",ut$1=I([$n()],ut$1);let pt$1=class extends V{};pt$1.BEFORE_DOWN="key.before_down",pt$1.BEFORE_UP="key.before_up",pt$1.DOWN="key.down",pt$1.HOLD="key.hold",pt$1.UP="key.up",pt$1=I([$n()],pt$1);const _t$1={getDragEventData:($h,Th,Fh)=>Object.assign(Object.assign({},Fh),{x:Fh.x,y:Fh.y,moveX:Fh.x-Th.x,moveY:Fh.y-Th.y,totalX:Fh.x-$h.x,totalY:Fh.y-$h.y}),getDropEventData:($h,Th,Fh)=>Object.assign(Object.assign({},$h),{list:Th,data:Fh}),getSwipeDirection:$h=>$h<-45&&$h>-135?ct$1.UP:$h>45&&$h<135?ct$1.DOWN:$h<=45&&$h>=-45?ct$1.RIGHT:ct$1.LEFT,getSwipeEventData:($h,Th,Fh)=>Object.assign(Object.assign({},Fh),{moveX:Th.moveX,moveY:Th.moveY,totalX:Fh.x-$h.x,totalY:Fh.y-$h.y,type:mt$1.getSwipeDirection(ot$2.getAngle($h,Fh))}),getBase($h){const Th=$h.button===1?4:$h.button;return{altKey:$h.altKey,ctrlKey:$h.ctrlKey,shiftKey:$h.shiftKey,metaKey:$h.metaKey,time:Date.now(),buttons:s($h.buttons)?1:$h.buttons===0?Th:$h.buttons,origin:$h}},pathHasEventType($h,Th){const{list:Fh}=$h;for(let Wh=0,zh=Fh.length;Wh<zh;Wh++)if(Fh[Wh].hasEvent(Th))return!0;return!1},filterPathByEventType($h,Th){const Fh=new kh,{list:Wh}=$h;for(let zh=0,Hh=Wh.length;zh<Hh;zh++)Wh[zh].hasEvent(Th)&&Fh.add(Wh[zh]);return Fh},pathCanDrag:$h=>$h&&$h.list.some(Th=>co.draggable(Th)||!Th.isLeafer&&Th.hasEvent(nt$1.DRAG)),pathHasOutside:$h=>$h&&$h.list.some(Th=>Th.isOutside)},mt$1=_t$1,vt$1=new kh,{getDragEventData:ft$1,getDropEventData:yt$1,getSwipeEventData:Et$1}=_t$1;let Dt$1=class{constructor($h){this.dragDataList=[],this.interaction=$h}setDragData($h){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=ft$1($h,$h,$h),this.canAnimate=this.canDragOut=!0}getList($h,Th){const{proxy:Fh}=this.interaction.selector,Wh=Fh&&Fh.list.length,zh=nt$1.list||this.draggableList||vt$1;return this.dragging&&(Wh?$h?vt$1:new kh(Th?[...Fh.list,...Fh.dragHoverExclude]:Fh.list):zh)}checkDrag($h,Th){const{interaction:Fh}=this;if(this.moving&&$h.buttons<1)return this.canAnimate=!1,void Fh.pointerCancel();!this.moving&&Th&&(this.moving=Fh.canMove(this.downData)||Fh.isHoldRightKey||Fh.isMobileDragEmpty)&&(this.dragData.moveType="drag",Fh.emit(ot$1.START,this.dragData)),this.moving||this.dragStart($h,Th),this.drag($h)}dragStart($h,Th){this.dragging||(this.dragging=Th&&K.left($h),this.dragging&&(this.interaction.emit(nt$1.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints($h){this.dragStartPoints={},$h.forEach(Th=>this.dragStartPoints[Th.innerId]={x:Th.x,y:Th.y})}getDraggableList($h){let Th;for(let Fh=0,Wh=$h.length;Fh<Wh;Fh++)if(Th=$h.list[Fh],co.draggable(Th)){this.draggableList=new kh(Th);break}}drag($h){const{interaction:Th,dragData:Fh,downData:Wh}=this,{path:zh,throughPath:Hh}=Wh;this.dragData=ft$1(Wh,Fh,$h),Hh&&(this.dragData.throughPath=Hh),this.dragData.path=zh,this.dragDataList.push(this.dragData),this.moving?($h.moving=!0,this.dragData.moveType="drag",Th.emit(ot$1.BEFORE_MOVE,this.dragData),Th.emit(ot$1.MOVE,this.dragData)):this.dragging&&($h.dragging=!0,this.dragReal(),Th.emit(nt$1.BEFORE_DRAG,this.dragData),Th.emit(nt$1.DRAG,this.dragData))}dragReal($h){const{interaction:Th}=this,{running:Fh}=Th,Wh=this.realDraggableList;if(Wh.length&&Fh){const{totalX:zh,totalY:Hh}=this.dragData,{dragLimitAnimate:Uh}=Th.p,Yh=!Uh||!!$h;Wh.forEach(Xh=>{if(Xh.draggable){const jh=i(Xh.draggable),qh=nt$1.getValidMove(Xh,this.dragStartPoints[Xh.innerId],{x:zh,y:Hh},Yh||jh);Uh&&!jh&&$h?co.animateMove(Xh,qh,o(Uh)?Uh:.3):Xh.move(qh)}})}}dragOverOrOut($h){const{interaction:Th}=this,{dragOverPath:Fh}=this,{path:Wh}=$h;this.dragOverPath=Wh,Fh?Wh.indexAt(0)!==Fh.indexAt(0)&&(Th.emit(nt$1.OUT,$h,Fh),Th.emit(nt$1.OVER,$h,Wh)):Th.emit(nt$1.OVER,$h,Wh)}dragEnterOrLeave($h){const{interaction:Th}=this,{dragEnterPath:Fh}=this,{path:Wh}=$h;Th.emit(nt$1.LEAVE,$h,Fh,Wh),Th.emit(nt$1.ENTER,$h,Wh,Fh),this.dragEnterPath=Wh}dragEnd($h){(this.dragging||this.moving)&&(this.checkDragEndAnimate($h)||this.dragEndReal($h))}dragEndReal($h){const{interaction:Th,downData:Fh,dragData:Wh}=this;$h||($h=Wh);const{path:zh,throughPath:Hh}=Fh,Uh=ft$1(Fh,$h,$h);if(Hh&&(Uh.throughPath=Hh),Uh.path=zh,this.moving&&(this.moving=!1,Uh.moveType="drag",Th.emit(ot$1.END,Uh)),this.dragging){const Yh=this.getList();this.dragging=!1,Th.p.dragLimitAnimate&&this.dragReal(!0),Th.emit(nt$1.END,Uh),this.swipe($h,Fh,Wh,Uh),this.drop($h,Yh,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}swipe($h,Th,Fh,Wh){const{interaction:zh}=this;if(ot$2.getDistance(Th,$h)>zh.config.pointer.swipeDistance){const Hh=Et$1(Th,Fh,Wh);this.interaction.emit(Hh.type,Hh)}}drop($h,Th,Fh){const Wh=yt$1($h,Th,nt$1.data);Wh.path=Fh,this.interaction.emit(ht$1.DROP,Wh),this.interaction.emit(nt$1.LEAVE,$h,Fh)}dragReset(){nt$1.list=nt$1.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null,this.dragDataList=[]}checkDragEndAnimate($h,Th){return!1}animate($h,Th){}stopAnimate(){}checkDragOut($h){}autoMoveOnDragOut($h){}autoMoveCancel(){}destroy(){this.dragReset()}};const Pt$1=ee$2.get("emit"),xt$1=["move","zoom","rotate","key"];function wt$1($h,Th,Fh,Wh,zh){if(xt$1.some(Hh=>Th.startsWith(Hh))&&$h.__.hitChildren&&!Tt$1($h,zh)){let Hh;for(let Uh=0,Yh=$h.children.length;Uh<Yh;Uh++)Hh=$h.children[Uh],!Fh.path.has(Hh)&&Hh.__.hittable&&Ot$1(Hh,Th,Fh,Wh,zh)}}function Ot$1($h,Th,Fh,Wh,zh){if($h.destroyed)return!1;if($h.__.hitSelf&&!Tt$1($h,zh)&&(Lt$2.updateEventStyle&&!Wh&&Lt$2.updateEventStyle($h,Th),$h.hasEvent(Th,Wh))){Fh.phase=Wh?1:$h===Fh.target?2:3;const Hh=pe$2.get(Th,Fh);if($h.emitEvent(Hh,Wh),Hh.isStop)return!0}return!1}function Tt$1($h,Th){return Th&&Th.has($h)}const Lt$1={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8}},pointer:{type:"pointer",snap:!0,hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20},touch:{preventDefault:"auto"},multiTouch:{},move:{autoDistance:2},zoom:{},cursor:!0,keyEvent:!0},{pathHasEventType:Rt$1,pathCanDrag:Ct$1,pathHasOutside:bt$1}=_t$1;let Mt$1=class{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return this.m.drag===!0||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.p.hover&&!this.config.mobile}get isDragEmpty(){return this.m.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.m.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.m.holdMiddleKey&&this.downData&&K.middle(this.downData)}get isHoldRightKey(){return this.m.holdRightKey&&this.downData&&K.right(this.downData)}get isHoldSpaceKey(){return this.m.holdSpaceKey&&W.isHoldSpaceKey()}get m(){return this.config.move}get p(){return this.config.pointer}get hitRadius(){return this.p.hitRadius}constructor($h,Th,Fh,Wh){this.config=_.clone(Lt$1),this.tapCount=0,this.downKeyMap={},this.target=$h,this.canvas=Th,this.selector=Fh,this.defaultPath=new kh($h),this.createTransformer(),this.dragger=new Dt$1(this),Wh&&(this.config=_.default(Wh,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive($h){}pointerDown($h,Th){$h||($h=this.hoverData),$h&&(K.defaultLeft($h),this.updateDownData($h),this.checkPath($h,Th),this.downTime=Date.now(),this.emit(it$1.BEFORE_DOWN,$h),$h.path.needUpdate&&this.updateDownData($h),this.emit(it$1.DOWN,$h),K.left($h)&&(this.tapWait(),this.longPressWait($h)),this.waitRightTap=K.right($h),this.dragger.setDragData($h),this.isHoldRightKey||this.updateCursor($h))}pointerMove($h){if($h||($h=this.hoverData),!$h)return;const{downData:Th}=this;Th&&K.defaultLeft($h),(this.canvas.bounds.hitPoint($h)||Th)&&(this.pointerMoveReal($h),Th&&this.dragger.checkDragOut($h))}pointerMoveReal($h){if(this.emit(it$1.BEFORE_MOVE,$h,this.defaultPath),this.downData){const Th=ot$2.getDistance(this.downData,$h)>this.p.dragDistance;Th&&(this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag($h,Th)}this.dragger.moving||(this.updateHoverData($h),this.checkPath($h),this.emit(it$1.MOVE,$h),this.pointerHover($h),this.dragging&&(this.dragger.dragOverOrOut($h),this.dragger.dragEnterOrLeave($h))),this.updateCursor(this.downData||$h)}pointerUp($h){const{downData:Th}=this;if($h||($h=Th),!Th)return;K.defaultLeft($h),$h.multiTouch=Th.multiTouch,this.findPath($h);const Fh=Object.assign(Object.assign({},$h),{path:$h.path.clone()});$h.path.addList(Th.path.list),this.checkPath($h),this.downData=null,this.emit(it$1.BEFORE_UP,$h),this.emit(it$1.UP,$h),this.touchLeave($h),$h.isCancel||(this.tap($h),this.menuTap($h)),this.dragger.dragEnd($h),this.updateCursor(Fh)}pointerCancel(){const $h=Object.assign({},this.dragger.dragData);$h.isCancel=!0,this.pointerUp($h)}menu($h){this.findPath($h),this.emit(it$1.MENU,$h),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap($h)}menuTap($h){this.waitRightTap&&this.waitMenuTap&&(this.emit(it$1.MENU_TAP,$h),this.waitRightTap=this.waitMenuTap=!1)}createTransformer(){}move($h){}zoom($h){}rotate($h){}transformEnd(){}wheel($h){}multiTouch($h,Th){}keyDown($h){if(!this.config.keyEvent)return;this.emit(pt$1.BEFORE_DOWN,$h,this.defaultPath);const{code:Th}=$h;this.downKeyMap[Th]||(this.downKeyMap[Th]=!0,W.setDownCode(Th),this.emit(pt$1.HOLD,$h,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(pt$1.DOWN,$h,this.defaultPath)}keyUp($h){if(!this.config.keyEvent)return;this.emit(pt$1.BEFORE_UP,$h,this.defaultPath);const{code:Th}=$h;this.downKeyMap[Th]=!1,W.setUpCode(Th),this.emit(pt$1.UP,$h,this.defaultPath),this.cursor==="grab"&&this.updateCursor()}pointerHover($h){!this.canHover||this.dragging&&!this.p.dragHover||($h.path||($h.path=new kh),this.pointerOverOrOut($h),this.pointerEnterOrLeave($h))}pointerOverOrOut($h){const{path:Th}=$h,{overPath:Fh}=this;this.overPath=Th,Fh?Th.indexAt(0)!==Fh.indexAt(0)&&(this.emit(it$1.OUT,$h,Fh),this.emit(it$1.OVER,$h,Th)):this.emit(it$1.OVER,$h,Th)}pointerEnterOrLeave($h){let{path:Th}=$h;this.downData&&!this.moveMode&&(Th=Th.clone(),this.downData.path.forEach(Wh=>Th.add(Wh)));const{enterPath:Fh}=this;this.enterPath=Th,this.emit(it$1.LEAVE,$h,Fh,Th),this.emit(it$1.ENTER,$h,Th,Fh)}touchLeave($h){$h.pointerType==="touch"&&this.enterPath&&(this.emit(it$1.LEAVE,$h),this.dragger.dragging&&this.emit(ht$1.LEAVE,$h))}tap($h){const{pointer:Th}=this.config,Fh=this.longTap($h);if(!Th.tapMore&&Fh||!this.waitTap)return;Th.tapMore&&this.emitTap($h);const Wh=Date.now()-this.downTime,zh=[it$1.DOUBLE_TAP,it$1.DOUBLE_CLICK].some(Hh=>Rt$1($h.path,Hh));Wh<Th.tapTime+50&&zh?(this.tapCount++,this.tapCount===2?(this.tapWaitCancel(),this.emitDoubleTap($h)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout(()=>{Th.tapMore||(this.tapWaitCancel(),this.emitTap($h))},Th.tapTime))):Th.tapMore||(this.tapWaitCancel(),this.emitTap($h))}findPath($h,Th){const{hitRadius:Fh,through:Wh}=this.p,{bottomList:zh,target:Hh}=this;$t$2.backgrounder||$h.origin||Hh&&Hh.updateLayout();const Uh=this.selector.getByPoint($h,Fh,Object.assign({bottomList:zh,name:$h.type},Th||{through:Wh}));return Uh.throughPath&&($h.throughPath=Uh.throughPath),$h.path=Uh.path,Uh.path}isRootPath($h){return $h&&$h.path.list[0].isLeafer}isTreePath($h){const Th=this.target.app;return!(!Th||!Th.isApp)&&Th.editor&&!$h.path.has(Th.editor)&&$h.path.has(Th.tree)&&!$h.target.syncEventer}checkPath($h,Th){(Th||this.moveMode&&!bt$1($h.path))&&($h.path=this.defaultPath)}canMove($h){return $h&&(this.moveMode||this.m.drag==="auto"&&!Ct$1($h.path))&&!bt$1($h.path)}isDrag($h){return this.dragger.getList().has($h)}isPress($h){return this.downData&&this.downData.path.has($h)}isHover($h){return this.enterPath&&this.enterPath.has($h)}isFocus($h){return this.focusData===$h}cancelHover(){const{hoverData:$h}=this;$h&&($h.path=this.defaultPath,this.pointerHover($h))}stopDragAnimate(){this.dragger.stopAnimate()}updateDownData($h,Th,Fh){const{downData:Wh}=this;!$h&&Wh&&($h=Wh),$h&&(this.findPath($h,Th),Fh&&Wh&&$h.path.addList(Wh.path.list),this.downData=$h)}updateHoverData($h){$h||($h=this.hoverData),$h&&(this.findPath($h,{exclude:this.dragger.getList(!1,!0),name:it$1.MOVE}),this.hoverData=$h)}updateCursor($h){if(!this.config.cursor||!this.canHover)return;if($h||(this.updateHoverData(),$h=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove($h))return this.setCursor(this.downData?"grabbing":"grab");if(!$h)return;let Th,Fh;const{path:Wh}=$h;for(let zh=0,Hh=Wh.length;zh<Hh&&(Th=Wh.list[zh],Fh=Th.syncEventer&&Th.syncEventer.cursor||Th.cursor,!Fh);zh++);this.setCursor(Fh)}setCursor($h){this.cursor=$h}getLocal($h,Th){const Fh=this.canvas.getClientBounds(Th),Wh={x:$h.clientX-Fh.x,y:$h.clientY-Fh.y},{bounds:zh}=this.canvas;return Wh.x*=zh.width/Fh.width,Wh.y*=zh.height/Fh.height,this.p.snap&&ot$2.round(Wh),Wh}emitTap($h){this.emit(it$1.TAP,$h),this.emit(it$1.CLICK,$h)}emitDoubleTap($h){this.emit(it$1.DOUBLE_TAP,$h),this.emit(it$1.DOUBLE_CLICK,$h)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){this.waitTap&&(clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0)}longPressWait($h){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout(()=>{this.longPressed=!0,this.emit(it$1.LONG_PRESS,$h)},this.p.longPressTime)}longTap($h){let Th;return this.longPressed&&(this.emit(it$1.LONG_TAP,$h),(Rt$1($h.path,it$1.LONG_TAP)||Rt$1($h.path,it$1.LONG_PRESS))&&(Th=!0)),this.longPressWaitCancel(),Th}longPressWaitCancel(){this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressed=!1)}__onResize(){const{dragOut:$h}=this.m;this.shrinkCanvasBounds=new Vt$3(this.canvas.bounds),this.shrinkCanvasBounds.spread(-(o($h)?$h:2))}__listenEvents(){const{target:$h}=this;this.__eventIds=[$h.on_($o.RESIZE,this.__onResize,this)],$h.once(sa.READY,()=>this.__onResize())}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit($h,Th,Fh,Wh){this.running&&(function(zh,Hh,Uh,Yh){if(!Uh&&!Hh.path)return;let Xh;Hh.type=zh,Uh?Hh=Object.assign(Object.assign({},Hh),{path:Uh}):Uh=Hh.path,Hh.target=Uh.indexAt(0);try{for(let jh=Uh.length-1;jh>-1;jh--){if(Xh=Uh.list[jh],Ot$1(Xh,zh,Hh,!0,Yh))return;Xh.isApp&&wt$1(Xh,zh,Hh,!0,Yh)}for(let jh=0,qh=Uh.length;jh<qh;jh++)if(Xh=Uh.list[jh],Xh.isApp&&wt$1(Xh,zh,Hh,!1,Yh),Ot$1(Xh,zh,Hh,!1,Yh))return}catch(jh){Pt$1.error(jh)}})($h,Th,Fh,Wh)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer&&this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}},St$1=class{static set($h,Th){this.custom[$h]=Th}static get($h){return this.custom[$h]}};St$1.custom={};let At$1=class extends ge$2{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new kh,this.pixelList=new kh}getPixelType($h,Th){return this.__autoClear(),this.pixelList.add($h),le$2.hitCanvas(Th)}getPathType($h){return this.__autoClear(),this.pathList.add($h),le$2.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList($h){$h.length&&($h.forEach(Th=>{Th.__hitCanvas&&(Th.__hitCanvas.destroy(),Th.__hitCanvas=null)}),$h.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}};$t$2.getSelector=function($h){return $h.leafer?$h.leafer.selector:$t$2.selector||($t$2.selector=le$2.selector())};const{toInnerRadiusPointOf:Bt$1,copyRadiusPoint:kt$1}=ot$2,{hitRadiusPoint:Ht$1,hitPoint:It$1}=zt$2,Nt$1={},Ft$1={},Wt$1=_h.prototype;Wt$1.hit=function($h,Th=0){this.updateLayout(),kt$1(Ft$1,$h,Th);const Fh=this.__world;return!!(Th?Ht$1(Fh,Ft$1):It$1(Fh,Ft$1))&&(this.isBranch?$t$2.getSelector(this).hitPoint(Object.assign({},Ft$1),Th,{target:this}):this.__hitWorld(Ft$1))},Wt$1.__hitWorld=function($h,Th){const Fh=this.__;if(!Fh.hitSelf)return!1;const Wh=this.__world,zh=this.__layout,Hh=Wh.width<10&&Wh.height<10;if(Fh.hitRadius&&(kt$1(Nt$1,$h,Fh.hitRadius),$h=Nt$1),Bt$1($h,Wh,Nt$1),Fh.hitBox||Hh){if(zt$2.hitRadiusPoint(zh.boxBounds,Nt$1))return!0;if(Hh)return!1}return!zh.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),zh.boundsChanged||(zh.hitCanvasChanged=!1)),this.__hit(Nt$1,Th)},Wt$1.__hitFill=function($h){const Th=this.__hitCanvas;return Th&&Th.hitFill($h,this.__.windingRule)},Wt$1.__hitStroke=function($h,Th){const Fh=this.__hitCanvas;return Fh&&Fh.hitStroke($h,Th)},Wt$1.__hitPixel=function($h){const Th=this.__hitCanvas;return Th&&Th.hitPixel($h,this.__layout.renderBounds,Th.hitScale)},Wt$1.__drawHitPath=function($h){$h&&this.__drawRenderPath($h)};const Kt$1=new pt$2,Vt$1=ge$1.prototype;Vt$1.__updateHitCanvas=function(){this.__box&&this.__box.__updateHitCanvas();const{hitCanvasManager:$h}=this.leafer||this.parent&&this.parent.leafer||{};if(!$h)return;const Th=this.__,Fh=(Th.__isAlphaPixelFill||Th.__isCanvas)&&Th.hitFill==="pixel",Wh=Th.__isAlphaPixelStroke&&Th.hitStroke==="pixel",zh=Fh||Wh;this.__hitCanvas||(this.__hitCanvas=zh?$h.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):$h.getPathType(this));const Hh=this.__hitCanvas;if(zh){const{renderBounds:Uh}=this.__layout,Yh=$t$2.image.hitCanvasSize,Xh=Hh.hitScale=Ht$3.set(0,0,Yh,Yh).getFitMatrix(Uh).a,{x:jh,y:qh,width:Vh,height:Zh}=Ht$3.set(Uh).scale(Xh);Hh.resize({width:Vh,height:Zh,pixelRatio:1}),Hh.clear(),en.patternLocked=!0,this.__renderShape(Hh,{matrix:Kt$1.setWith(this.__world).scaleWith(1/Xh).invertWith().translate(-jh,-qh),snapshot:!0,ignoreFill:!Fh,ignoreStroke:!Wh}),en.patternLocked=!1,Hh.resetTransform(),Th.__isHitPixel=!0}else Th.__isHitPixel&&(Th.__isHitPixel=!1);this.__drawHitPath(Hh),Hh.setStrokeOptions(Th)},Vt$1.__hit=function($h,Th){if(this.__box&&this.__box.__hit($h))return!0;const Fh=this.__;if(Fh.__isHitPixel&&this.__hitPixel($h))return!0;const{hitFill:Wh}=Fh,zh=(Fh.fill||Fh.__isCanvas)&&(Wh==="path"||Wh==="pixel"&&!(Fh.__isAlphaPixelFill||Fh.__isCanvas))||Wh==="all"||Th;if(zh&&this.__hitFill($h))return!0;const{hitStroke:Hh,__maxStrokeWidth:Uh}=Fh,Yh=Fh.stroke&&(Hh==="path"||Hh==="pixel"&&!Fh.__isAlphaPixelStroke)||Hh==="all";if(!zh&&!Yh)return!1;const Xh=2*$h.radiusX;let jh=Xh;if(Yh)switch(Fh.strokeAlign){case"inside":if(jh+=2*Uh,!zh&&this.__hitFill($h)&&this.__hitStroke($h,jh))return!0;jh=Xh;break;case"center":jh+=Uh;break;case"outside":if(jh+=2*Uh,!zh){if(!this.__hitFill($h)&&this.__hitStroke($h,jh))return!0;jh=Xh}}return!!jh&&this.__hitStroke($h,jh)};const Ut$1=ge$1.prototype,jt$1=xe$1.prototype,Xt$1=Ae$1.prototype;jt$1.__updateHitCanvas=Xt$1.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&this.hitFill==="pixel"||this.hitStroke==="all"?Ut$1.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},jt$1.__hitFill=Xt$1.__hitFill=function($h){return this.__hitCanvas?Ut$1.__hitFill.call(this,$h):zt$2.hitRadiusPoint(this.__layout.boxBounds,$h)},hi$1.prototype.__drawHitPath=function($h){const{__lineHeight:Th,fontSize:Fh,__baseLine:Wh,__letterSpacing:zh,__textDrawData:Hh}=this.__;$h.beginPath(),zh<0?this.__drawPathByBox($h):Hh.rows.forEach(Uh=>$h.rect(Uh.x,Uh.y-Wh,Uh.width,Th<Fh?Fh:Th))},ye$1.prototype.pick=function($h,Th){return Th||(Th=e$1),this.updateLayout(),$t$2.getSelector(this).getByPoint($h,Th.hitRadius||0,Object.assign(Object.assign({},Th),{target:this}))};const Yt$1=Ee$2.prototype;Yt$1.hitFill=function($h,Th){return Th?this.context.isPointInPath($h.x,$h.y,Th):this.context.isPointInPath($h.x,$h.y)},Yt$1.hitStroke=function($h,Th){return this.strokeWidth=Th,this.context.isPointInStroke($h.x,$h.y)},Yt$1.hitPixel=function($h,Th,Fh=1){let{x:Wh,y:zh,radiusX:Hh,radiusY:Uh}=$h;Th&&(Wh-=Th.x,zh-=Th.y),Ht$3.set(Wh-Hh,zh-Uh,2*Hh,2*Uh).scale(Fh).ceil();const{data:Yh}=this.context.getImageData(Ht$3.x,Ht$3.y,Ht$3.width||1,Ht$3.height||1);for(let Xh=0,jh=Yh.length;Xh<jh;Xh+=4)if(Yh[Xh+3]>0)return!0;return Yh[3]>0};var Z;function J($h,Th,Fh,Wh){return new(Fh||(Fh=Promise))(function(zh,Hh){function Uh(jh){try{Xh(Wh.next(jh))}catch(qh){Hh(qh)}}function Yh(jh){try{Xh(Wh.throw(jh))}catch(qh){Hh(qh)}}function Xh(jh){var qh;jh.done?zh(jh.value):(qh=jh.value,qh instanceof Fh?qh:new Fh(function(Vh){Vh(qh)})).then(Uh,Yh)}Xh((Wh=Wh.apply($h,Th||[])).next())})}(function($h){$h[$h.none=1]="none",$h[$h.free=2]="free",$h[$h.mirrorAngle=3]="mirrorAngle",$h[$h.mirror=4]="mirror"})(Z||(Z={})),typeof SuppressedError=="function"&&SuppressedError;const tt=ee$2.get("LeaferCanvas");class et extends Ee$2{set zIndex(Th){const{style:Fh}=this.view;Fh.zIndex=Th,this.setAbsolute(this.view)}set childIndex(Th){const{view:Fh,parentView:Wh}=this;if(Fh&&Wh){const zh=Wh.children[Th];zh?(this.setAbsolute(zh),Wh.insertBefore(Fh,zh)):Wh.appendChild(zh)}}init(){const{config:Th}=this,Fh=Th.view||Th.canvas;Fh?this.__createViewFrom(Fh):this.__createView();const{style:Wh}=this.view;if(Wh.display||(Wh.display="block"),this.parentView=this.view.parentElement,this.parentView){const zh=this.parentView.style;zh.webkitUserSelect=zh.userSelect="none",this.view.classList.add("leafer-canvas-view")}$t$2.syncDomFont&&!this.parentView&&(Wh.display="none",document.body&&document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(Th)}set backgroundColor(Th){this.view.style.backgroundColor=Th}get backgroundColor(){return this.view.style.backgroundColor}set hittable(Th){this.view.style.pointerEvents=Th?"auto":"none"}get hittable(){return this.view.style.pointerEvents!=="none"}__createView(){this.view=document.createElement("canvas")}__createViewFrom(Th){let Fh=i(Th)?document.getElementById(Th):Th;if(Fh)if(Fh instanceof HTMLCanvasElement)this.view=Fh;else{let Wh=Fh;if(Fh===window||Fh===document){const Hh=document.createElement("div"),{style:Uh}=Hh;Uh.position="absolute",Uh.top=Uh.bottom=Uh.left=Uh.right="0px",document.body.appendChild(Hh),Wh=Hh}this.__createView();const zh=this.view;Wh.hasChildNodes()&&(this.setAbsolute(zh),Wh.style.position||(Wh.style.position="relative")),Wh.appendChild(zh)}else tt.error(`no id: ${Th}`),this.__createView()}setAbsolute(Th){const{style:Fh}=Th;Fh.position="absolute",Fh.top=Fh.left="0px"}updateViewSize(){const{width:Th,height:Fh,pixelRatio:Wh}=this,{style:zh}=this.view;zh.width=Th+"px",zh.height=Fh+"px",this.unreal||(this.view.width=Math.ceil(Th*Wh),this.view.height=Math.ceil(Fh*Wh))}updateClientBounds(){this.view.parentElement&&(this.clientBounds=this.view.getBoundingClientRect())}startAutoLayout(Th,Fh){if(this.resizeListener=Fh,Th){if(this.autoBounds=Th,this.resizeObserver)return;try{this.resizeObserver=new ResizeObserver(zh=>{this.updateClientBounds();for(const Hh of zh)this.checkAutoBounds(Hh.contentRect)});const Wh=this.parentView;Wh?(this.resizeObserver.observe(Wh),this.checkAutoBounds(Wh.getBoundingClientRect())):(this.checkAutoBounds(this.view),tt.warn("no parent"))}catch{this.imitateResizeObserver()}this.stopListenPixelRatio()}else this.listenPixelRatio(),this.unreal&&this.updateViewSize()}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),$t$2.requestRender(this.imitateResizeObserver.bind(this)))}listenPixelRatio(){this.windowListener||window.addEventListener("resize",this.windowListener=()=>{const Th=$t$2.devicePixelRatio;if(!this.config.pixelRatio&&this.pixelRatio!==Th){const{width:Fh,height:Wh}=this;this.emitResize({width:Fh,height:Wh,pixelRatio:Th})}})}stopListenPixelRatio(){this.windowListener&&(window.removeEventListener("resize",this.windowListener),this.windowListener=null)}checkAutoBounds(Th){const Fh=this.view,{x:Wh,y:zh,width:Hh,height:Uh}=this.autoBounds.getBoundsFrom(Th),Yh={width:Hh,height:Uh,pixelRatio:this.config.pixelRatio?this.pixelRatio:$t$2.devicePixelRatio};if(!this.isSameSize(Yh)){const{style:Xh}=Fh;Xh.marginLeft=Wh+"px",Xh.marginTop=zh+"px",this.emitResize(Yh)}}stopAutoLayout(){this.autoLayout=!1,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeListener=this.resizeObserver=null}emitResize(Th){const Fh={};_.copyAttrs(Fh,this,Re$2),this.resize(Th),this.resizeListener&&!s(this.width)&&this.resizeListener(new $o(Th,Fh))}unrealCanvas(){if(!this.unreal&&this.parentView){let Th=this.view;Th&&Th.remove(),Th=this.view=document.createElement("div"),this.parentView.appendChild(this.view),Th.classList.add("leafer-app-view"),this.unreal=!0}}destroy(){const{view:Th}=this;Th&&(this.stopAutoLayout(),this.stopListenPixelRatio(),Th.parentElement&&Th.remove(),super.destroy())}}function it($h,Th){$t$2.origin={createCanvas(Fh,Wh){const zh=document.createElement("canvas");return zh.width=Fh,zh.height=Wh,zh},canvasToDataURL:(Fh,Wh,zh)=>{const Hh=Gi$1.mimeType(Wh),Uh=Fh.toDataURL(Hh,zh);return Hh==="image/bmp"?Uh.replace("image/png;","image/bmp;"):Uh},canvasToBolb:(Fh,Wh,zh)=>new Promise(Hh=>Fh.toBlob(Hh,Gi$1.mimeType(Wh),zh)),canvasSaveAs:(Fh,Wh,zh)=>{const Hh=Fh.toDataURL(Gi$1.mimeType(Gi$1.fileType(Wh)),zh);return $t$2.origin.download(Hh,Wh)},download(Fh,Wh){return J(this,void 0,void 0,function*(){let zh=document.createElement("a");zh.href=Fh,zh.download=Wh,document.body.appendChild(zh),zh.click(),document.body.removeChild(zh)})},loadImage:(Fh,Wh,zh)=>new Promise((Hh,Uh)=>{const Yh=new $t$2.origin.Image;Wh&&(Yh.setAttribute("crossOrigin",Wh),Yh.crossOrigin=Wh),Yh.onload=()=>{Hh(Yh)},Yh.onerror=Xh=>{Uh(Xh)},Yh.src=$t$2.image.getRealURL(Fh)}),loadContent(Fh){return J(this,arguments,void 0,function*(Wh,zh="text"){const Hh=yield fetch(Wh);if(!Hh.ok)throw new Error(`${Hh.status}`);return yield Hh[zh]()})},Image,PointerEvent,DragEvent},$t$2.event={stopDefault(Fh){Fh.preventDefault()},stopNow(Fh){Fh.stopImmediatePropagation()},stop(Fh){Fh.stopPropagation()}},$t$2.canvas=le$2.canvas(),$t$2.conicGradientSupport=!!$t$2.canvas.context.createConicGradient}Hi$1(CanvasRenderingContext2D.prototype),Hi$1(Path2D.prototype),Object.assign(le$2,{canvas:($h,Th)=>new et($h,Th),image:$h=>new on($h)}),$t$2.name="web",$t$2.isMobile="ontouchstart"in window,$t$2.requestRender=function($h){window.requestAnimationFrame($h)},ln($t$2,"devicePixelRatio",{get:()=>devicePixelRatio});const{userAgent:st}=navigator;st.indexOf("Firefox")>-1?($t$2.conicGradientRotate90=!0,$t$2.intWheelDeltaY=!0,$t$2.syncDomFont=!0):(/iPhone|iPad|iPod/.test(navigator.userAgent)||/Macintosh/.test(navigator.userAgent)&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent))&&($t$2.fullImageShadow=!0),st.indexOf("Windows")>-1?($t$2.os="Windows",$t$2.intWheelDeltaY=!0):st.indexOf("Mac")>-1?$t$2.os="Mac":st.indexOf("Linux")>-1&&($t$2.os="Linux");class nt{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove&&this.config.usePartLayout){const Th=new kh;return this.__updatedList.list.forEach(Fh=>{Fh.leafer&&Th.add(Fh)}),Th}return this.__updatedList}constructor(Th,Fh){this.totalTimes=0,this.config={},this.__updatedList=new kh,this.target=Th,Fh&&(this.config=_.default(Fh,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(ea.REQUEST)}__onAttrChange(Th){this.config.usePartLayout&&this.__updatedList.add(Th.target),this.update()}__onChildEvent(Th){this.config.usePartLayout&&(Th.type===zo.ADD?(this.hasAdd=!0,this.__pushChild(Th.child)):(this.hasRemove=!0,this.__updatedList.add(Th.parent))),this.update()}__pushChild(Th){this.__updatedList.add(Th),Th.isBranch&&this.__loopChildren(Th)}__loopChildren(Th){const{children:Fh}=Th;for(let Wh=0,zh=Fh.length;Wh<zh;Wh++)this.__pushChild(Fh[Wh])}__onRquestData(){this.target.emitEvent(new Ko(Ko.DATA,{updatedList:this.updatedList})),this.__updatedList=new kh,this.totalTimes++,this.changed=this.hasVisible=this.hasRemove=this.hasAdd=!1}__listenEvents(){this.__eventIds=[this.target.on_([[Uo.CHANGE,this.__onAttrChange,this],[[zo.ADD,zo.REMOVE],this.__onChildEvent,this],[Ko.REQUEST,this.__onRquestData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.__updatedList=null)}}const{updateAllMatrix:ot,updateBounds:rt,updateChange:at}=co,{pushAllChildBranch:ht,pushAllParent:lt}=vo,{worldBounds:ct}=xo;class dt{constructor(Th){this.updatedBounds=new Vt$3,this.beforeBounds=new Vt$3,this.afterBounds=new Vt$3,l(Th)&&(Th=new kh(Th)),this.updatedList=Th}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,ct)}setAfter(){this.afterBounds.setListWithFn(this.updatedList.list,ct),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(Th){this.updatedList.addList(Th.updatedList.list),this.beforeBounds.add(Th.beforeBounds),this.afterBounds.add(Th.afterBounds),this.updatedBounds.add(Th.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:ut,updateAllChange:ft}=co,pt=ee$2.get("Layouter");class gt{constructor(Th,Fh){this.totalTimes=0,this.config={usePartLayout:!0},this.__levelList=new Ch,this.target=Th,Fh&&(this.config=_.default(Fh,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(this.layouting||!this.running)return;const{target:Th}=this;this.times=0;try{Th.emit(ta.START),this.layoutOnce(),Th.emitEvent(new ta(ta.END,this.layoutedBlocks,this.times))}catch(Fh){pt.error(Fh)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?pt.warn("layouting"):this.times>3?pt.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Ko.REQUEST),this.totalTimes>1&&this.config.usePartLayout?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var Th;if(!(!((Th=this.__updatedList)===null||Th===void 0)&&Th.length))return;const Fh=ne$2.start("PartLayout"),{target:Wh,__updatedList:zh}=this,{BEFORE:Hh,LAYOUT:Uh,AFTER:Yh}=ta,Xh=this.getBlocks(zh);Xh.forEach(jh=>jh.setBefore()),Wh.emitEvent(new ta(Hh,Xh,this.times)),this.extraBlock=null,zh.sort(),(function(jh,qh){let Vh;jh.list.forEach(Zh=>{Vh=Zh.__layout,qh.without(Zh)&&!Vh.proxyZoom&&(Vh.matrixChanged?(ot(Zh,!0),qh.add(Zh),Zh.isBranch&&ht(Zh,qh),lt(Zh,qh)):Vh.boundsChanged&&(qh.add(Zh),Zh.isBranch&&(Zh.__tempNumber=0),lt(Zh,qh)))})})(zh,this.__levelList),(function(jh){let qh,Vh,Zh;jh.sort(!0),jh.levels.forEach(Kh=>{qh=jh.levelMap[Kh];for(let Qh=0,Jh=qh.length;Qh<Jh;Qh++){if(Vh=qh[Qh],Vh.isBranch&&Vh.__tempNumber){Zh=Vh.children;for(let td=0,ed=Zh.length;td<ed;td++)Zh[td].isBranch||rt(Zh[td])}rt(Vh)}})})(this.__levelList),(function(jh){jh.list.forEach(at)})(zh),this.extraBlock&&Xh.push(this.extraBlock),Xh.forEach(jh=>jh.setAfter()),Wh.emitEvent(new ta(Uh,Xh,this.times)),Wh.emitEvent(new ta(Yh,Xh,this.times)),this.addBlocks(Xh),this.__levelList.reset(),this.__updatedList=null,ne$2.end(Fh)}fullLayout(){const Th=ne$2.start("FullLayout"),{target:Fh}=this,{BEFORE:Wh,LAYOUT:zh,AFTER:Hh}=ta,Uh=this.getBlocks(new kh(Fh));Fh.emitEvent(new ta(Wh,Uh,this.times)),gt.fullLayout(Fh),Uh.forEach(Yh=>{Yh.setAfter()}),Fh.emitEvent(new ta(zh,Uh,this.times)),Fh.emitEvent(new ta(Hh,Uh,this.times)),this.addBlocks(Uh),ne$2.end(Th)}static fullLayout(Th){ut(Th,!0),Th.isBranch?vo.updateBounds(Th):co.updateBounds(Th),ft(Th)}addExtra(Th){if(!this.__updatedList.has(Th)){const{updatedList:Fh,beforeBounds:Wh}=this.extraBlock||(this.extraBlock=new dt([]));Fh.length?Wh.add(Th.__world):Wh.set(Th.__world),Fh.add(Th)}}createBlock(Th){return new dt(Th)}getBlocks(Th){return[this.createBlock(Th)]}addBlocks(Th){this.layoutedBlocks?this.layoutedBlocks.push(...Th):this.layoutedBlocks=Th}__onReceiveWatchData(Th){this.__updatedList=Th.data.updatedList}__listenEvents(){this.__eventIds=[this.target.on_([[ta.REQUEST,this.layout,this],[ta.AGAIN,this.layoutAgain,this],[Ko.DATA,this.__onReceiveWatchData,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const wt=ee$2.get("Renderer");class _t{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(Th,Fh,Wh){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,ceilPartPixel:!0,maxFPS:120},this.frames=[],this.target=Th,this.canvas=Fh,Wh&&(this.config=_.default(Wh,this.config)),this.__listenEvents()}start(){this.running=!0,this.update(!1)}stop(){this.running=!1}update(Th=!0){this.changed||(this.changed=Th),this.requestTime||this.__requestRender()}requestLayout(){this.target.emit(ta.REQUEST)}checkRender(){if(this.running){const{target:Th}=this;Th.isApp&&(Th.emit(ea.CHILD_START,Th),Th.children.forEach(Fh=>{Fh.renderer.FPS=this.FPS,Fh.renderer.checkRender()}),Th.emit(ea.CHILD_END,Th)),this.changed&&this.canvas.view&&this.render(),this.target.emit(ea.NEXT)}}render(Th){if(!this.running||!this.canvas.view)return this.update();const{target:Fh}=this;this.times=0,this.totalBounds=new Vt$3,wt.log(Fh.innerName,"--->");try{this.emitRender(ea.START),this.renderOnce(Th),this.emitRender(ea.END,this.totalBounds),en.clearRecycled()}catch(Wh){this.rendering=!1,wt.error(Wh)}wt.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(Th){if(this.rendering)return wt.warn("rendering");if(this.times>3)return wt.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new Vt$3,this.renderOptions={},Th)this.emitRender(ea.BEFORE),Th();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(ea.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(ea.RENDER,this.renderBounds,this.renderOptions),this.emitRender(ea.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:Th,updateBlocks:Fh}=this;Fh&&(this.mergeBlocks(),Fh.forEach(Wh=>{Th.bounds.hit(Wh)&&!Wh.isEmpty()&&this.clipRender(Wh)}))}clipRender(Th){const Fh=ne$2.start("PartRender"),{canvas:Wh}=this,zh=Th.getIntersect(Wh.bounds),Hh=new Vt$3(zh);Wh.save(),zh.spread(_t.clipSpread).ceil();const{ceilPartPixel:Uh}=this.config;Wh.clipWorld(zh,Uh),Wh.clearWorld(zh,Uh),this.__render(zh,Hh),Wh.restore(),ne$2.end(Fh)}fullRender(){const Th=ne$2.start("FullRender"),{canvas:Fh}=this;Fh.save(),Fh.clear(),this.__render(Fh.bounds),Fh.restore(),ne$2.end(Th)}__render(Th,Fh){const{canvas:Wh,target:zh}=this,Hh=Th.includes(zh.__world),Uh=Hh?{includes:Hh}:{bounds:Th,includes:Hh};this.needFill&&Wh.fillWorld(Th,this.config.fill),ee$2.showRepaint&&ee$2.drawRepaint(Wh,Th),this.config.useCellRender&&(Uh.cellList=this.getCellList()),$t$2.render(zh,Wh,Uh),this.renderBounds=Fh=Fh||Th,this.renderOptions=Uh,this.totalBounds.isEmpty()?this.totalBounds=Fh:this.totalBounds.add(Fh),Wh.updateRender(Fh)}getCellList(){}addBlock(Th,Fh){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(Th)}mergeBlocks(){const{updateBlocks:Th}=this;if(Th){const Fh=new Vt$3;Fh.setList(Th),Th.length=0,Th.push(Fh)}}__requestRender(){const Th=this.target;if(this.requestTime||!Th)return;if(Th.parentApp)return Th.parentApp.requestRender(!1);this.requestTime=this.frameTime||Date.now();const Fh=()=>{const Wh=1e3/((this.frameTime=Date.now())-this.requestTime),{maxFPS:zh}=this.config;if(zh&&Wh>zh)return $t$2.requestRender(Fh);const{frames:Hh}=this;Hh.length>30&&Hh.shift(),Hh.push(Wh),this.FPS=Math.round(Hh.reduce((Uh,Yh)=>Uh+Yh,0)/Hh.length),this.requestTime=0,this.checkRender()};$t$2.requestRender(Fh)}__onResize(Th){if(!this.canvas.unreal){if(Th.bigger||!Th.samePixelRatio){const{width:Fh,height:Wh}=Th.old;if(!new Vt$3(0,0,Fh,Wh).includes(this.target.__world)||this.needFill||!Th.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new Vt$3(0,0,1,1)),this.update()}}__onLayoutEnd(Th){Th.data&&Th.data.map(Fh=>{let Wh;const{updatedList:zh}=Fh;zh&&zh.list.some(Hh=>(Wh=!Hh.__world.width||!Hh.__world.height,Wh&&(Hh.isLeafer||wt.tip(Hh.innerName,": empty"),Wh=!Hh.isBranch||Hh.isBranchLeaf),Wh)),this.addBlock(Wh?this.canvas.bounds:Fh.updatedBounds,zh)})}emitRender(Th,Fh,Wh){this.target.emitEvent(new ea(Th,this.times,Fh,Wh))}__listenEvents(){this.__eventIds=[this.target.on_([[ea.REQUEST,this.update,this],[ta.END,this.__onLayoutEnd,this],[ea.AGAIN,this.renderAgain,this],[$o.RESIZE,this.__onResize,this]])]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.config={},this.target=this.canvas=null)}}_t.clipSpread=10;const mt={},{copyRadiusPoint:vt}=ot$2,{hitRadiusPoint:yt}=zt$2;class xt{constructor(Th,Fh){this.target=Th,this.selector=Fh}getByPoint(Th,Fh,Wh){Fh||(Fh=0),Wh||(Wh={});const zh=Wh.through||!1,Hh=Wh.ignoreHittable||!1,Uh=Wh.target||this.target;this.exclude=Wh.exclude||null,this.point={x:Th.x,y:Th.y,radiusX:Fh,radiusY:Fh},this.findList=new kh(Wh.findList),Wh.findList||this.hitBranch(Uh.isBranchLeaf?{children:[Uh]}:Uh);const{list:Yh}=this.findList,Xh=this.getBestMatchLeaf(Yh,Wh.bottomList,Hh,!!Wh.findList),jh=Hh?this.getPath(Xh):this.getHitablePath(Xh);return this.clear(),zh?{path:jh,target:Xh,throughPath:Yh.length?this.getThroughPath(Yh):jh}:{path:jh,target:Xh}}hitPoint(Th,Fh,Wh){return!!this.getByPoint(Th,Fh,Wh).target}getBestMatchLeaf(Th,Fh,Wh,zh){const Hh=this.findList=new kh;if(Th.length){let Uh;const{x:Yh,y:Xh}=this.point,jh={x:Yh,y:Xh,radiusX:0,radiusY:0};for(let qh=0,Vh=Th.length;qh<Vh;qh++)if(Uh=Th[qh],(Wh||co.worldHittable(Uh))&&(this.hitChild(Uh,jh),Hh.length)){if(Uh.isBranchLeaf&&Th.some(Zh=>Zh!==Uh&&co.hasParent(Zh,Uh))){Hh.reset();break}return Hh.list[0]}}if(Fh){for(let Uh=0,Yh=Fh.length;Uh<Yh;Uh++)if(this.hitChild(Fh[Uh].target,this.point,Fh[Uh].proxy),Hh.length)return Hh.list[0]}return zh?null:Wh?Th[0]:Th.find(Uh=>co.worldHittable(Uh))}getPath(Th){const Fh=new kh,Wh=[],{target:zh}=this;for(;Th&&(Th.syncEventer&&Wh.push(Th.syncEventer),Fh.add(Th),(Th=Th.parent)!==zh););return Wh.length&&Wh.forEach(Hh=>{for(;Hh&&(Hh.__.hittable&&Fh.add(Hh),(Hh=Hh.parent)!==zh););}),zh&&Fh.add(zh),Fh}getHitablePath(Th){const Fh=this.getPath(Th&&Th.hittable?Th:null);let Wh,zh=new kh;for(let Hh=Fh.list.length-1;Hh>-1&&(Wh=Fh.list[Hh],Wh.__.hittable)&&(zh.addAt(Wh,0),Wh.__.hitChildren&&(!Wh.isLeafer||Wh.mode!=="draw"));Hh--);return zh}getThroughPath(Th){const Fh=new kh,Wh=[];for(let Yh=Th.length-1;Yh>-1;Yh--)Wh.push(this.getPath(Th[Yh]));let zh,Hh,Uh;for(let Yh=0,Xh=Wh.length;Yh<Xh;Yh++){zh=Wh[Yh],Hh=Wh[Yh+1];for(let jh=0,qh=zh.length;jh<qh&&(Uh=zh.list[jh],!Hh||!Hh.has(Uh));jh++)Fh.add(Uh)}return Fh}hitBranch(Th){this.eachFind(Th.children,Th.__onlyHitMask)}eachFind(Th,Fh){let Wh,zh,Hh;const{point:Uh}=this;for(let Yh=Th.length-1;Yh>-1;Yh--)if(Wh=Th[Yh],Hh=Wh.__,Hh.visible&&(!Fh||Hh.mask))if(zh=yt(Wh.__world,Hh.hitRadius?vt(mt,Uh,Hh.hitRadius):Uh),Wh.isBranch){if(zh||Wh.__ignoreHitWorld){if(Wh.isBranchLeaf&&Hh.__clipAfterFill&&!Wh.__hitWorld(Uh,!0))continue;Wh.topChildren&&this.eachFind(Wh.topChildren,!1),this.eachFind(Wh.children,Wh.__onlyHitMask),Wh.isBranchLeaf&&this.hitChild(Wh,Uh)}}else zh&&this.hitChild(Wh,Uh)}hitChild(Th,Fh,Wh){if((!this.exclude||!this.exclude.has(Th))&&Th.__hitWorld(Fh)){const{parent:zh}=Th;if(zh&&zh.__hasMask&&!Th.__.mask){let Hh,Uh=[];const{children:Yh}=zh;for(let Xh=0,jh=Yh.length;Xh<jh;Xh++)if(Hh=Yh[Xh],Hh.__.mask&&Uh.push(Hh),Hh===Th){if(Uh&&!Uh.every(qh=>qh.__hitWorld(Fh)))return;break}}this.findList.add(Wh||Th)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}class bt{constructor(Th,Fh){this.config={},Fh&&(this.config=_.default(Fh,this.config)),this.picker=new xt(this.target=Th,this),this.finder=le$2.finder&&le$2.finder()}getByPoint(Th,Fh,Wh){const{target:zh,picker:Hh}=this;return $t$2.backgrounder&&zh&&zh.updateLayout(),Hh.getByPoint(Th,Fh,Wh)}hitPoint(Th,Fh,Wh){return this.picker.hitPoint(Th,Fh,Wh)}getBy(Th,Fh,Wh,zh){return this.finder?this.finder.getBy(Th,Fh,Wh,zh):he$2.need("find")}destroy(){this.picker.destroy(),this.finder&&this.finder.destroy()}}Object.assign(le$2,{watcher:($h,Th)=>new nt($h,Th),layouter:($h,Th)=>new gt($h,Th),renderer:($h,Th,Fh)=>new _t($h,Th,Fh),selector:($h,Th)=>new bt($h,Th)}),$t$2.layout=gt.fullLayout,$t$2.render=function($h,Th,Fh){const Wh=Object.assign(Object.assign({},Fh),{topRendering:!0});Fh.topList=new kh,$h.__render(Th,Fh),Fh.topList.length&&Fh.topList.forEach(zh=>zh.__render(Th,Wh))};const St={convert($h,Th){const Fh=_t$1.getBase($h),{x:Wh,y:zh}=Th,Hh=Object.assign(Object.assign({},Fh),{x:Wh,y:zh,width:$h.width,height:$h.height,pointerType:$h.pointerType,pressure:$h.pressure});return Hh.pointerType==="pen"&&(Hh.tangentialPressure=$h.tangentialPressure,Hh.tiltX=$h.tiltX,Hh.tiltY=$h.tiltY,Hh.twist=$h.twist),Hh},convertMouse($h,Th){const Fh=_t$1.getBase($h),{x:Wh,y:zh}=Th;return Object.assign(Object.assign({},Fh),{x:Wh,y:zh,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch($h,Th){const Fh=St.getTouch($h),Wh=_t$1.getBase($h),{x:zh,y:Hh}=Th;return Object.assign(Object.assign({},Wh),{x:zh,y:Hh,width:1,height:1,pointerType:"touch",multiTouch:$h.touches.length>1,pressure:Fh.force})},getTouch:$h=>$h.targetTouches[0]||$h.changedTouches[0]},Lt={convert($h){const Th=_t$1.getBase($h);return Object.assign(Object.assign({},Th),{code:$h.code,key:$h.key})}},{pathCanDrag:kt}=_t$1;class Tt extends Mt$1{get notPointer(){const{p:Th}=this;return Th.type!=="pointer"||Th.touch||this.useMultiTouch}get notTouch(){const{p:Th}=this;return Th.type==="mouse"||this.usePointer}get notMouse(){return this.usePointer||this.useTouch}__listenEvents(){super.__listenEvents();const Th=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,pointerleave:this.onPointerLeave,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:Fh,windowEvents:Wh}=this;for(let zh in Fh)Fh[zh]=Fh[zh].bind(this),Th.addEventListener(zh,Fh[zh]);for(let zh in Wh)Wh[zh]=Wh[zh].bind(this),window.addEventListener(zh,Wh[zh])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:Th,windowEvents:Fh}=this;for(let Wh in Th)this.view.removeEventListener(Wh,Th[Wh]),this.viewEvents={};for(let Wh in Fh)window.removeEventListener(Wh,Fh[Wh]),this.windowEvents={}}getTouches(Th){const Fh=[];for(let Wh=0,zh=Th.length;Wh<zh;Wh++)Fh.push(Th[Wh]);return Fh}preventDefaultPointer(Th){const{pointer:Fh}=this.config;Fh.preventDefault&&Th.preventDefault()}preventDefaultWheel(Th){const{wheel:Fh}=this.config;Fh.preventDefault&&Th.preventDefault()}preventWindowPointer(Th){return!this.downData&&Th.target!==this.view}onKeyDown(Th){this.keyDown(Lt.convert(Th))}onKeyUp(Th){this.keyUp(Lt.convert(Th))}onContextMenu(Th){this.config.pointer.preventDefaultMenu&&Th.preventDefault(),this.menu(St.convert(Th,this.getLocal(Th)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(Th){this.preventDefaultPointer(Th),this.notPointer||(this.usePointer||(this.usePointer=!0),this.pointerDown(St.convert(Th,this.getLocal(Th))))}onPointerMove(Th,Fh){if(this.notPointer||this.preventWindowPointer(Th))return;this.usePointer||(this.usePointer=!0);const Wh=St.convert(Th,this.getLocal(Th,!0));Fh?this.pointerHover(Wh):this.pointerMove(Wh)}onPointerLeave(Th){this.onPointerMove(Th,!0)}onPointerUp(Th){this.downData&&this.preventDefaultPointer(Th),this.notPointer||this.preventWindowPointer(Th)||this.pointerUp(St.convert(Th,this.getLocal(Th)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(Th){this.preventDefaultPointer(Th),this.notMouse||this.pointerDown(St.convertMouse(Th,this.getLocal(Th)))}onMouseMove(Th){this.notMouse||this.preventWindowPointer(Th)||this.pointerMove(St.convertMouse(Th,this.getLocal(Th,!0)))}onMouseUp(Th){this.downData&&this.preventDefaultPointer(Th),this.notMouse||this.preventWindowPointer(Th)||this.pointerUp(St.convertMouse(Th,this.getLocal(Th)))}onMouseCancel(){this.notMouse||this.pointerCancel()}onTouchStart(Th){const Fh=St.getTouch(Th),Wh=this.getLocal(Fh,!0),{preventDefault:zh}=this.config.touch;(zh===!0||zh==="auto"&&kt(this.findPath(Wh)))&&Th.preventDefault(),this.multiTouchStart(Th),this.notTouch||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(St.convertTouch(Th,Wh)))}onTouchMove(Th){if(this.multiTouchMove(Th),this.notTouch||this.preventWindowPointer(Th))return;const Fh=St.getTouch(Th);this.pointerMove(St.convertTouch(Th,this.getLocal(Fh)))}onTouchEnd(Th){if(this.multiTouchEnd(),this.notTouch||this.preventWindowPointer(Th))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout(()=>{this.useTouch=!1},500);const Fh=St.getTouch(Th);this.pointerUp(St.convertTouch(Th,this.getLocal(Fh)))}onTouchCancel(){this.notTouch||this.pointerCancel()}multiTouchStart(Th){this.useMultiTouch=Th.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(Th.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(Th){if(this.useMultiTouch&&Th.touches.length>1){const Fh=this.getTouches(Th.touches),Wh=this.getKeepTouchList(this.touches,Fh);Wh.length>1&&(this.multiTouch(_t$1.getBase(Th),Wh),this.touches=Fh)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(Th,Fh){let Wh;const zh=[];return Th.forEach(Hh=>{Wh=Fh.find(Uh=>Uh.identifier===Hh.identifier),Wh&&zh.push({from:this.getLocal(Hh),to:this.getLocal(Wh)})}),zh}getLocalTouchs(Th){return Th.map(Fh=>this.getLocal(Fh))}onWheel(Th){this.preventDefaultWheel(Th),this.wheel(Object.assign(Object.assign(Object.assign({},_t$1.getBase(Th)),this.getLocal(Th)),{deltaX:Th.deltaX,deltaY:Th.deltaY}))}onGesturestart(Th){this.useMultiTouch||(this.preventDefaultWheel(Th),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(Th){if(this.useMultiTouch)return;this.preventDefaultWheel(Th);const Fh=_t$1.getBase(Th);Object.assign(Fh,this.getLocal(Th));const Wh=Th.scale/this.lastGestureScale,zh=(Th.rotation-this.lastGestureRotation)/Math.PI*180*(I$1.within(this.config.wheel.rotateSpeed,0,1)/4+.1);this.zoom(Object.assign(Object.assign({},Fh),{scale:Wh*Wh})),this.rotate(Object.assign(Object.assign({},Fh),{rotation:zh})),this.lastGestureScale=Th.scale,this.lastGestureRotation=Th.rotation}onGestureend(Th){this.useMultiTouch||(this.preventDefaultWheel(Th),this.transformEnd())}setCursor(Th){super.setCursor(Th);const Fh=[];this.eachCursor(Th,Fh),d(Fh[Fh.length-1])&&Fh.push("default"),this.canvas.view.style.cursor=Fh.map(Wh=>d(Wh)?`url(${Wh.url}) ${Wh.x||0} ${Wh.y||0}`:Wh).join(",")}eachCursor(Th,Fh,Wh=0){if(Wh++,l(Th))Th.forEach(zh=>this.eachCursor(zh,Fh,Wh));else{const zh=i(Th)&&St$1.get(Th);zh&&Wh<2?this.eachCursor(zh,Fh,Wh):Fh.push(Th)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function Bt($h,Th,Fh){$h.__.__font?Ft$2.fillText($h,Th,Fh):$h.__.windingRule?Th.fill($h.__.windingRule):Th.fill()}function Et($h,Th,Fh,Wh,zh){const Hh=Fh.__;d($h)?Ft$2.drawStrokesStyle($h,Th,!1,Fh,Wh,zh):(Wh.setStroke($h,Hh.__strokeWidth*Th,Hh),Wh.stroke()),Hh.__useArrow&&Ft$2.strokeArrow($h,Fh,Wh,zh)}function Pt($h,Th,Fh,Wh,zh){const Hh=Fh.__;d($h)?Ft$2.drawStrokesStyle($h,Th,!0,Fh,Wh,zh):(Wh.setStroke($h,Hh.__strokeWidth*Th,Hh),Ft$2.drawTextStroke(Fh,Wh,zh))}function Rt($h,Th,Fh,Wh,zh){const Hh=Wh.getSameCanvas(!0,!0);Hh.font=Fh.__.__font,Pt($h,2,Fh,Hh,zh),Hh.blendMode=Th==="outside"?"destination-out":"destination-in",Ft$2.fillText(Fh,Hh,zh),Hh.blendMode="normal",co.copyCanvasByWorld(Fh,Wh,Hh),Hh.recycle(Fh.__nowWorld)}const{getSpread:Mt,copyAndSpread:Ct,toOuterOf:At,getOuterOf:Ot,getByMove:Dt,move:Wt,getIntersectData:It}=zt$2,Ft={};let zt;const{stintSet:jt}=_,{hasTransparent:Ut}=Ct$2;function Gt($h,Th,Fh){if(!d(Th)||Th.visible===!1||Th.opacity===0)return;let Wh;const{boxBounds:zh}=Fh.__layout,{type:Hh}=Th;switch(Hh){case"image":case"film":case"video":if(!Th.url)return;Wh=Wt$2.image(Fh,$h,Th,zh,!zt||!zt[Th.url]),Hh!=="image"&&Wt$2[Hh](Wh);break;case"linear":Wh=Et$2.linearGradient(Th,zh);break;case"radial":Wh=Et$2.radialGradient(Th,zh);break;case"angular":Wh=Et$2.conicGradient(Th,zh);break;case"solid":const{color:Uh,opacity:Yh}=Th;Wh={type:Hh,style:Ct$2.string(Uh,Yh)};break;default:s(Th.r)||(Wh={type:"solid",style:Ct$2.string(Th)})}if(Wh&&(Wh.originPaint=Th,i(Wh.style)&&Ut(Wh.style)&&(Wh.isTransparent=!0),Th.style)){if(Th.style.strokeWidth===0)return;Wh.strokeStyle=Th.style}return Wh}const Yt={compute:function($h,Th){const Fh=Th.__,Wh=[];let zh,Hh,Uh,Yh=Fh.__input[$h];l(Yh)||(Yh=[Yh]),zt=Wt$2.recycleImage($h,Fh);for(let Xh,jh=0,qh=Yh.length;jh<qh;jh++)(Xh=Gt($h,Yh[jh],Th))&&(Wh.push(Xh),Xh.strokeStyle&&(Uh||(Uh=1),Xh.strokeStyle.strokeWidth&&(Uh=Math.max(Uh,Xh.strokeStyle.strokeWidth))));Fh["_"+$h]=Wh.length?Wh:void 0,Wh.length?(Wh.every(Xh=>Xh.isTransparent)&&(Wh.some(Xh=>Xh.image)&&(zh=!0),Hh=!0),$h==="fill"?(jt(Fh,"__isAlphaPixelFill",zh),jt(Fh,"__isTransparentFill",Hh)):(jt(Fh,"__isAlphaPixelStroke",zh),jt(Fh,"__isTransparentStroke",Hh),jt(Fh,"__hasMultiStrokeStyle",Uh))):Fh.__removePaint($h,!1)},fill:function($h,Th,Fh,Wh){Fh.fillStyle=$h,Bt(Th,Fh,Wh)},fills:function($h,Th,Fh,Wh){let zh,Hh,Uh;for(let Yh=0,Xh=$h.length;Yh<Xh;Yh++){if(zh=$h[Yh],Hh=zh.originPaint,zh.image){if(Uh?Uh++:Uh=1,Wt$2.checkImage(zh,!Th.__.__font,Th,Fh,Wh))continue;if(!zh.style){Uh===1&&zh.image.isPlacehold&&Th.drawImagePlaceholder(zh,Fh,Wh);continue}}if(Fh.fillStyle=zh.style,zh.transform||Hh.scaleFixed){if(Fh.save(),zh.transform&&Fh.transform(zh.transform),Hh.scaleFixed){const{scaleX:jh,scaleY:qh}=Th.getRenderScaleData(!0);(Hh.scaleFixed===!0||Hh.scaleFixed==="zoom-in"&&jh>1&&qh>1)&&Fh.scale(1/jh,1/qh)}Hh.blendMode&&(Fh.blendMode=Hh.blendMode),Bt(Th,Fh,Wh),Fh.restore()}else Hh.blendMode?(Fh.saveBlendMode(Hh.blendMode),Bt(Th,Fh,Wh),Fh.restoreBlendMode()):Bt(Th,Fh,Wh)}},fillPathOrText:Bt,fillText:function($h,Th,Fh){const Wh=$h.__,{rows:zh,decorationY:Hh}=Wh.__textDrawData;let Uh;Wh.__isPlacehold&&Wh.placeholderColor&&(Th.fillStyle=Wh.placeholderColor);for(let Yh=0,Xh=zh.length;Yh<Xh;Yh++)Uh=zh[Yh],Uh.text?Th.fillText(Uh.text,Uh.x,Uh.y):Uh.data&&Uh.data.forEach(jh=>{Th.fillText(jh.char,jh.x,Uh.y)});if(Hh){const{decorationColor:Yh,decorationHeight:Xh}=Wh.__textDrawData;Yh&&(Th.fillStyle=Yh),zh.forEach(jh=>Hh.forEach(qh=>Th.fillRect(jh.x,jh.y+qh,jh.width,Xh)))}},stroke:function($h,Th,Fh,Wh){const zh=Th.__;if(zh.__strokeWidth)if(zh.__font)Ft$2.strokeText($h,Th,Fh,Wh);else switch(zh.strokeAlign){case"center":Et($h,1,Th,Fh,Wh);break;case"inside":(function(Hh,Uh,Yh,Xh){Yh.save(),Yh.clipUI(Uh),Et(Hh,2,Uh,Yh,Xh),Yh.restore()})($h,Th,Fh,Wh);break;case"outside":(function(Hh,Uh,Yh,Xh){const jh=Uh.__;if(jh.__fillAfterStroke)Et(Hh,2,Uh,Yh,Xh);else{const{renderBounds:qh}=Uh.__layout,Vh=Yh.getSameCanvas(!0,!0);Uh.__drawRenderPath(Vh),Et(Hh,2,Uh,Vh,Xh),Vh.clipUI(jh),Vh.clearWorld(qh),co.copyCanvasByWorld(Uh,Yh,Vh),Vh.recycle(Uh.__nowWorld)}})($h,Th,Fh,Wh)}},strokes:function($h,Th,Fh,Wh){Ft$2.stroke($h,Th,Fh,Wh)},strokeText:function($h,Th,Fh,Wh){switch(Th.__.strokeAlign){case"center":Pt($h,1,Th,Fh,Wh);break;case"inside":Rt($h,"inside",Th,Fh,Wh);break;case"outside":Th.__.__fillAfterStroke?Pt($h,2,Th,Fh,Wh):Rt($h,"outside",Th,Fh,Wh)}},drawTextStroke:function($h,Th,Fh){let Wh,zh=$h.__.__textDrawData;const{rows:Hh,decorationY:Uh}=zh;for(let Yh=0,Xh=Hh.length;Yh<Xh;Yh++)Wh=Hh[Yh],Wh.text?Th.strokeText(Wh.text,Wh.x,Wh.y):Wh.data&&Wh.data.forEach(jh=>{Th.strokeText(jh.char,jh.x,Wh.y)});if(Uh){const{decorationHeight:Yh}=zh;Hh.forEach(Xh=>Uh.forEach(jh=>Th.strokeRect(Xh.x,Xh.y+jh,Xh.width,Yh)))}},drawStrokesStyle:function($h,Th,Fh,Wh,zh,Hh){let Uh;const Yh=Wh.__,{__hasMultiStrokeStyle:Xh}=Yh;Xh||zh.setStroke(void 0,Yh.__strokeWidth*Th,Yh);for(let jh=0,qh=$h.length;jh<qh;jh++)if(Uh=$h[jh],(!Uh.image||!Wt$2.checkImage(Uh,!1,Wh,zh,Hh))&&Uh.style){if(Xh){const{strokeStyle:Vh}=Uh;Vh?zh.setStroke(Uh.style,Yh.__getRealStrokeWidth(Vh)*Th,Yh,Vh):zh.setStroke(Uh.style,Yh.__strokeWidth*Th,Yh)}else zh.strokeStyle=Uh.style;Uh.originPaint.blendMode?(zh.saveBlendMode(Uh.originPaint.blendMode),Fh?Ft$2.drawTextStroke(Wh,zh,Hh):zh.stroke(),zh.restoreBlendMode()):Fh?Ft$2.drawTextStroke(Wh,zh,Hh):zh.stroke()}},shape:function($h,Th,Fh){const Wh=Th.getSameCanvas(),zh=Th.bounds,Hh=$h.__nowWorld,Uh=$h.__layout,Yh=$h.__nowWorldShapeBounds||($h.__nowWorldShapeBounds={});let Xh,jh,qh,Vh,Zh,Kh;At(Uh.strokeSpread?(Ct(Ft,Uh.boxBounds,Uh.strokeSpread),Ft):Uh.boxBounds,Hh,Yh);let{scaleX:Qh,scaleY:Jh}=$h.getRenderScaleData(!0);if(zh.includes(Yh))Kh=Wh,Xh=Zh=Yh,jh=Hh;else{let td;if($t$2.fullImageShadow)td=Yh;else{const nd=Uh.renderShapeSpread?Mt(zh,v.swapAndScale(Uh.renderShapeSpread,Qh,Jh)):zh;td=It(nd,Yh)}Vh=zh.getFitMatrix(td);let{a:ed,d:id}=Vh;Vh.a<1&&(Kh=Th.getSameCanvas(),$h.__renderShape(Kh,Fh),Qh*=ed,Jh*=id),Zh=Ot(Yh,Vh),Xh=Dt(Zh,-Vh.e,-Vh.f),jh=Ot(Hh,Vh),Wt(jh,-Vh.e,-Vh.f);const sd=Fh.matrix;sd?(qh=new pt$2(Vh),qh.multiply(sd),ed*=sd.scaleX,id*=sd.scaleY):qh=Vh,qh.withScale(ed,id),Fh=Object.assign(Object.assign({},Fh),{matrix:qh})}return $h.__renderShape(Wh,Fh),{canvas:Wh,matrix:qh,fitMatrix:Vh,bounds:Xh,renderBounds:jh,worldCanvas:Kh,shapeBounds:Zh,scaleX:Qh,scaleY:Jh}}};let Xt,Vt=new Vt$3;const{isSame:Nt}=zt$2;function Ht($h,Th,Fh,Wh,zh,Hh){const Uh=$h.__;if(Th==="fill"&&!Uh.__naturalWidth&&(Uh.__naturalWidth=Wh.width/Uh.pixelRatio,Uh.__naturalHeight=Wh.height/Uh.pixelRatio,Uh.__autoSide))return $h.forceUpdate("width"),$h.__proxyData&&($h.setProxyAttr("width",Uh.width),$h.setProxyAttr("height",Uh.height)),!1;if(!zh.data){Wt$2.createData(zh,Wh,Fh,Hh);const{transform:Yh}=zh.data,{opacity:Xh,blendMode:jh}=Fh,qh=Yh&&!Yh.onlyScale||Uh.path||Uh.cornerRadius;(qh||Xh&&Xh<1||jh)&&(zh.complex=!qh||2)}return!0}function qt($h,Th){$t($h,Vo.LOAD,Th)}function Kt($h,Th){$t($h,Vo.LOADED,Th)}function Qt($h,Th,Fh){Th.error=Fh,$h.forceUpdate("surface"),$t($h,Vo.ERROR,Th)}function $t($h,Th,Fh){$h.hasEvent(Th)&&$h.emitEvent(new Vo(Th,Fh))}function Zt($h,Th){const{leafer:Fh}=$h;Fh&&Fh.viewReady&&(Fh.renderer.ignore=Th)}const{get:Jt,translate:te}=q$1,ee=new Vt$3,ie={},se={};function ne($h,Th,Fh,Wh){const zh=i($h)||Wh?(Wh?Fh-Wh*Th:Fh%Th)/((Wh||Math.floor(Fh/Th))-1):$h;return $h==="auto"&&zh<0?0:zh}let oe={},re=X$1();const{get:ae,set:he,rotateOfOuter:le,translate:ce,scaleOfOuter:de,multiplyParent:ue,scale:fe,rotate:pe,skew:ge}=q$1;function we($h,Th,Fh,Wh,zh,Hh,Uh,Yh){Uh&&pe($h,Uh),Yh&&ge($h,Yh.x,Yh.y),zh&&fe($h,zh,Hh),ce($h,Th.x+Fh,Th.y+Wh)}const{get:_e,scale:me,copy:ve}=q$1,{getFloorScale:ye}=I$1,{abs:xe}=Math,be={image:function($h,Th,Fh,Wh,zh){let Hh,Uh;const Yh=en.get(Fh,Fh.type);return Xt&&Fh===Xt.paint&&Nt(Wh,Xt.boxBounds)?Hh=Xt.leafPaint:(Hh={type:Fh.type,image:Yh},Yh.hasAlphaPixel&&(Hh.isTransparent=!0),Xt=Yh.use>1?{leafPaint:Hh,paint:Fh,boxBounds:Vt.set(Wh)}:null),(zh||Yh.loading)&&(Uh={image:Yh,attrName:Th,attrValue:Fh}),Yh.ready?(Ht($h,Th,Fh,Yh,Hh,Wh),zh&&(qt($h,Uh),Kt($h,Uh))):Yh.error?zh&&Qt($h,Uh,Yh.error):(zh&&(Zt($h,!0),qt($h,Uh)),Hh.loadId=Yh.load(()=>{Zt($h,!1),$h.destroyed||(Ht($h,Th,Fh,Yh,Hh,Wh)&&(Yh.hasAlphaPixel&&($h.__layout.hitCanvasChanged=!0),$h.forceUpdate("surface")),Kt($h,Uh)),Hh.loadId=void 0},Xh=>{Zt($h,!1),Qt($h,Uh,Xh),Hh.loadId=void 0},Fh.lod&&Yh.getThumbSize(Fh.lod)),$h.placeholderColor&&($h.placeholderDelay?setTimeout(()=>{Yh.ready||(Yh.isPlacehold=!0,$h.forceUpdate("surface"))},$h.placeholderDelay):Yh.isPlacehold=!0)),Hh},checkImage:function($h,Th,Fh,Wh,zh){const{scaleX:Hh,scaleY:Uh}=Wt$2.getImageRenderScaleData($h,Fh,Wh,zh),Yh=$h.film?$h.nowIndex:Hh+"-"+Uh,{image:Xh,data:jh,originPaint:qh}=$h,{exporting:Vh,snapshot:Zh}=zh;return!(!jh||$h.patternId===Yh&&!Vh||Zh)&&(Th&&(jh.repeat?Th=!1:qh.changeful||$h.film||$t$2.name==="miniapp"&&$o.isResizing(Fh)||Vh||(Th=$t$2.image.isLarge(Xh,Hh,Uh)||Xh.width*Hh>8096||Xh.height*Uh>8096)),Th?(Fh.__.__isFastShadow&&(Wh.fillStyle=$h.style||"#000",Wh.fill()),Wt$2.drawImage($h,Hh,Uh,Fh,Wh,zh),!0):(!$h.style||qh.sync||Vh?Wt$2.createPattern($h,Fh,Wh,zh):Wt$2.createPatternTask($h,Fh,Wh,zh),!1))},drawImage:function($h,Th,Fh,Wh,zh,Hh){const{data:Uh,image:Yh,complex:Xh}=$h;let{width:jh,height:qh}=Yh;if(Xh){const{blendMode:Vh,opacity:Zh}=$h.originPaint,{transform:Kh}=Uh;zh.save(),Xh===2&&zh.clipUI(Wh),Vh&&(zh.blendMode=Vh),Zh&&(zh.opacity*=Zh),Kh&&zh.transform(Kh),Yh.render(zh,0,0,jh,qh,Wh,$h,Th,Fh),zh.restore()}else Uh.scaleX&&(jh*=Uh.scaleX,qh*=Uh.scaleY),Yh.render(zh,0,0,jh,qh,Wh,$h,Th,Fh)},getImageRenderScaleData:function($h,Th,Fh,Wh){const zh=Th.getRenderScaleData(!0,$h.originPaint.scaleFixed),{data:Hh}=$h;if(Fh){const{pixelRatio:Uh}=Fh;zh.scaleX*=Uh,zh.scaleY*=Uh}return Hh&&Hh.scaleX&&(zh.scaleX*=Math.abs(Hh.scaleX),zh.scaleY*=Math.abs(Hh.scaleY)),zh},recycleImage:function($h,Th){const Fh=Th["_"+$h];if(l(Fh)){let Wh,zh,Hh,Uh,Yh;for(let Xh=0,jh=Fh.length;Xh<jh;Xh++)Wh=Fh[Xh],zh=Wh.image,Yh=zh&&zh.url,Yh&&(Hh||(Hh={}),Hh[Yh]=!0,en.recyclePaint(Wh),zh.loading&&(Uh||(Uh=Th.__input&&Th.__input[$h]||[],l(Uh)||(Uh=[Uh])),zh.unload(Fh[Xh].loadId,!Uh.some(qh=>qh.url===Yh))));return Hh}return null},createPatternTask:function($h,Th,Fh,Wh){$h.patternTask||($h.patternTask=en.patternTasker.add(()=>J(this,void 0,void 0,function*(){Wt$2.createPattern($h,Th,Fh,Wh),Th.forceUpdate("surface")}),0,()=>($h.patternTask=null,Fh.bounds.hit(Th.__nowWorld))))},createPattern:function($h,Th,Fh,Wh){let{scaleX:zh,scaleY:Hh}=Wt$2.getImageRenderScaleData($h,Th,Fh,Wh),Uh=$h.film?$h.nowIndex:zh+"-"+Hh;if($h.patternId!==Uh&&!Th.destroyed&&(!$t$2.image.isLarge($h.image,zh,Hh)||$h.data.repeat)){const{image:Yh,data:Xh}=$h,{opacity:jh,filters:qh}=$h.originPaint,{transform:Vh,gap:Zh}=Xh,Kh=Wt$2.getPatternFixScale($h,zh,Hh);let Qh,Jh,td,{width:ed,height:id}=Yh;Kh&&(zh*=Kh,Hh*=Kh),ed*=zh,id*=Hh,Zh&&(Jh=Zh.x*zh/xe(Xh.scaleX||1),td=Zh.y*Hh/xe(Xh.scaleY||1)),(Vh||zh!==1||Hh!==1)&&(zh*=ye(ed+(Jh||0)),Hh*=ye(id+(td||0)),Qh=_e(),Vh&&ve(Qh,Vh),me(Qh,1/zh,1/Hh));const sd=Yh.getCanvas(ed,id,jh,qh,Jh,td,Th.leafer&&Th.leafer.config.smooth,Xh.interlace),nd=Yh.getPattern(sd,Xh.repeat||$t$2.origin.noRepeat||"no-repeat",Qh,$h);$h.style=nd,$h.patternId=Uh}},getPatternFixScale:function($h,Th,Fh){const{image:Wh}=$h;let zh,Hh=$t$2.image.maxPatternSize,Uh=Wh.width*Wh.height;return Wh.isSVG?Th>1&&(zh=Math.ceil(Th)/Th):Hh>Uh&&(Hh=Uh),(Uh*=Th*Fh)>Hh&&(zh=Math.sqrt(Hh/Uh)),zh},createData:function($h,Th,Fh,Wh){$h.data=Wt$2.getPatternData(Fh,Wh,Th)},getPatternData:function($h,Th,Fh){$h.padding&&(Th=ee.set(Th).shrink($h.padding)),$h.mode==="strench"&&($h.mode="stretch");const{width:Wh,height:zh}=Fh,{mode:Hh,align:Uh,offset:Yh,scale:Xh,size:jh,rotation:qh,skew:Vh,clipSize:Zh,repeat:Kh,gap:Qh,interlace:Jh}=$h,td=Th.width===Wh&&Th.height===zh,ed={mode:Hh},id=Uh!=="center"&&(qh||0)%180==90;let sd,nd;switch(zt$2.set(se,0,0,id?zh:Wh,id?Wh:zh),Hh&&Hh!=="cover"&&Hh!=="fit"?((Xh||jh)&&(I$1.getScaleData(Xh,jh,Fh,ie),sd=ie.scaleX,nd=ie.scaleY),(Uh||Qh||Kh)&&(sd&&zt$2.scale(se,sd,nd,!0),Uh&&kt$3.toPoint(Uh,se,Th,se,!0,!0))):td&&!qh||(sd=nd=zt$2.getFitScale(Th,se,Hh!=="fit"),zt$2.put(Th,Fh,Uh,sd,!1,se),zt$2.scale(se,sd,nd,!0)),Yh&&ot$2.move(se,Yh),Hh){case"stretch":td?sd&&(sd=nd=void 0):(sd=Th.width/Wh,nd=Th.height/zh,Wt$2.stretchMode(ed,Th,sd,nd));break;case"normal":case"clip":if(se.x||se.y||sd||Zh||qh||Vh){let ud,rd;Zh&&(ud=Th.width/Zh.width,rd=Th.height/Zh.height),Wt$2.clipMode(ed,Th,se.x,se.y,sd,nd,qh,Vh,ud,rd),ud&&(sd=sd?sd*ud:ud,nd=nd?nd*rd:rd)}break;case"repeat":(!td||sd||qh||Vh)&&Wt$2.repeatMode(ed,Th,Wh,zh,se.x,se.y,sd,nd,qh,Vh,Uh,$h.freeTransform),Kh||(ed.repeat="repeat");const hd=d(Kh);(Qh||hd)&&(ed.gap=(function(ud,rd,ad,dd,cd){let od,ld;return d(ud)?(od=ud.x,ld=ud.y):od=ld=ud,{x:ne(od,ad,cd.width,rd&&rd.x),y:ne(ld,dd,cd.height,rd&&rd.y)}})(Qh,hd&&Kh,se.width,se.height,Th));break;default:sd&&Wt$2.fillOrFitMode(ed,Th,se.x,se.y,sd,nd,qh)}return ed.transform||(Th.x||Th.y)&&te(ed.transform=Jt(),Th.x,Th.y),sd&&(ed.scaleX=sd,ed.scaleY=nd),Kh&&(ed.repeat=i(Kh)?Kh==="x"?"repeat-x":"repeat-y":"repeat"),Jh&&(ed.interlace=o(Jh)||Jh.type==="percent"?{type:"x",offset:Jh}:Jh),ed},stretchMode:function($h,Th,Fh,Wh){const zh=ae(),{x:Hh,y:Uh}=Th;Hh||Uh?ce(zh,Hh,Uh):Fh>0&&Wh>0&&(zh.onlyScale=!0),fe(zh,Fh,Wh),$h.transform=zh},fillOrFitMode:function($h,Th,Fh,Wh,zh,Hh,Uh){const Yh=ae();ce(Yh,Th.x+Fh,Th.y+Wh),fe(Yh,zh,Hh),Uh&&le(Yh,{x:Th.x+Th.width/2,y:Th.y+Th.height/2},Uh),$h.transform=Yh},clipMode:function($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh){const qh=ae();we(qh,Th,Fh,Wh,zh,Hh,Uh,Yh),Xh&&(Uh||Yh?(he(re),de(re,Th,Xh,jh),ue(qh,re)):de(qh,Th,Xh,jh)),$h.transform=qh},repeatMode:function($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh,qh,Vh){const Zh=ae();if(Vh)we(Zh,Th,zh,Hh,Uh,Yh,Xh,jh);else{if(Xh)if(qh==="center")le(Zh,{x:Fh/2,y:Wh/2},Xh);else switch(pe(Zh,Xh),Xh){case 90:ce(Zh,Wh,0);break;case 180:ce(Zh,Fh,Wh);break;case 270:ce(Zh,0,Fh)}oe.x=Th.x+zh,oe.y=Th.y+Hh,ce(Zh,oe.x,oe.y),Uh&&de(Zh,oe,Uh,Yh)}$h.transform=Zh}},{toPoint:Se}=bt$3,{hasTransparent:Le}=Ct$2,ke={},Te={};function Be($h,Th,Fh,Wh){if(Fh){let zh,Hh,Uh,Yh;for(let Xh=0,jh=Fh.length;Xh<jh;Xh++)zh=Fh[Xh],i(zh)?(Uh=Xh/(jh-1),Hh=Ct$2.string(zh,Wh)):(Uh=zh.offset,Hh=Ct$2.string(zh.color,Wh)),Th.addColorStop(Uh,Hh),!Yh&&Le(Hh)&&(Yh=!0);Yh&&($h.isTransparent=!0)}}const{getAngle:Ee,getDistance:Pe}=ot$2,{get:Re,rotateOfOuter:Me,scaleOfOuter:Ce}=q$1,{toPoint:Ae}=bt$3,Oe={},De={};function We($h,Th,Fh,Wh,zh){let Hh;const{width:Uh,height:Yh}=$h;if(Uh!==Yh||Wh){const Xh=Ee(Th,Fh);Hh=Re(),zh?(Ce(Hh,Th,Uh/Yh*(Wh||1),1),Me(Hh,Th,Xh+90)):(Ce(Hh,Th,1,Uh/Yh*(Wh||1)),Me(Hh,Th,Xh))}return Hh}const{getDistance:Ie}=ot$2,{toPoint:Fe}=bt$3,ze={},je={},Ue={linearGradient:function($h,Th){let{from:Fh,to:Wh,type:zh,opacity:Hh}=$h;Se(Fh||"top",Th,ke),Se(Wh||"bottom",Th,Te);const Uh=$t$2.canvas.createLinearGradient(ke.x,ke.y,Te.x,Te.y),Yh={type:zh,style:Uh};return Be(Yh,Uh,$h.stops,Hh),Yh},radialGradient:function($h,Th){let{from:Fh,to:Wh,type:zh,opacity:Hh,stretch:Uh}=$h;Ae(Fh||"center",Th,Oe),Ae(Wh||"bottom",Th,De);const Yh=$t$2.canvas.createRadialGradient(Oe.x,Oe.y,0,Oe.x,Oe.y,Pe(Oe,De)),Xh={type:zh,style:Yh};Be(Xh,Yh,$h.stops,Hh);const jh=We(Th,Oe,De,Uh,!0);return jh&&(Xh.transform=jh),Xh},conicGradient:function($h,Th){let{from:Fh,to:Wh,type:zh,opacity:Hh,stretch:Uh}=$h;Fe(Fh||"center",Th,ze),Fe(Wh||"bottom",Th,je);const Yh=$t$2.conicGradientSupport?$t$2.canvas.createConicGradient(0,ze.x,ze.y):$t$2.canvas.createRadialGradient(ze.x,ze.y,0,ze.x,ze.y,Ie(ze,je)),Xh={type:zh,style:Yh};Be(Xh,Yh,$h.stops,Hh);const jh=We(Th,ze,je,Uh||1,$t$2.conicGradientRotate90);return jh&&(Xh.transform=jh),Xh},getTransform:We},{copy:Ge,move:Ye,toOffsetOutBounds:Xe}=zt$2,{max:Ve,abs:Ne}=Math,He={},qe=new pt$2,Ke={};function Qe($h,Th){let Fh,Wh,zh,Hh,Uh=0,Yh=0,Xh=0,jh=0;return Th.forEach(qh=>{Fh=qh.x||0,Wh=qh.y||0,Hh=1.5*(qh.blur||0),zh=Ne(qh.spread||0),Uh=Ve(Uh,zh+Hh-Wh),Yh=Ve(Yh,zh+Hh+Fh),Xh=Ve(Xh,zh+Hh+Wh),jh=Ve(jh,zh+Hh-Fh)}),Uh===Yh&&Yh===Xh&&Xh===jh?Uh:[Uh,Yh,Xh,jh]}function $e($h,Th,Fh){const{shapeBounds:Wh}=Fh;let zh,Hh;$t$2.fullImageShadow?(Ge(He,$h.bounds),Ye(He,Th.x-Wh.x,Th.y-Wh.y),zh=$h.bounds,Hh=He):(zh=Wh,Hh=Th),$h.copyWorld(Fh.canvas,zh,Hh)}const{toOffsetOutBounds:Ze}=zt$2,Je={},ti=Qe,ei={shadow:function($h,Th,Fh){let Wh,zh;const{__nowWorld:Hh}=$h,{shadow:Uh}=$h.__,{worldCanvas:Yh,bounds:Xh,renderBounds:jh,shapeBounds:qh,scaleX:Vh,scaleY:Zh}=Fh,Kh=Th.getSameCanvas(),Qh=Uh.length-1;Xe(Xh,Ke,jh),Uh.forEach((Jh,td)=>{let ed=1;if(Jh.scaleFixed){const id=Math.abs(Hh.scaleX);id>1&&(ed=1/id)}Kh.setWorldShadow(Ke.offsetX+(Jh.x||0)*Vh*ed,Ke.offsetY+(Jh.y||0)*Zh*ed,(Jh.blur||0)*Vh*ed,Ct$2.string(Jh.color)),zh=Tt$2.getShadowTransform($h,Kh,Fh,Jh,Ke,ed),zh&&Kh.setTransform(zh),$e(Kh,Ke,Fh),zh&&Kh.resetTransform(),Wh=jh,Jh.box&&(Kh.restore(),Kh.save(),Yh&&(Kh.copyWorld(Kh,jh,Hh,"copy"),Wh=Hh),Yh?Kh.copyWorld(Yh,Hh,Hh,"destination-out"):Kh.copyWorld(Fh.canvas,qh,Xh,"destination-out")),co.copyCanvasByWorld($h,Th,Kh,Wh,Jh.blendMode),Qh&&td<Qh&&Kh.clearWorld(Wh)}),Kh.recycle(Wh)},innerShadow:function($h,Th,Fh){let Wh,zh;const{__nowWorld:Hh}=$h,{innerShadow:Uh}=$h.__,{worldCanvas:Yh,bounds:Xh,renderBounds:jh,shapeBounds:qh,scaleX:Vh,scaleY:Zh}=Fh,Kh=Th.getSameCanvas(),Qh=Uh.length-1;Ze(Xh,Je,jh),Uh.forEach((Jh,td)=>{let ed=1;if(Jh.scaleFixed){const id=Math.abs(Hh.scaleX);id>1&&(ed=1/id)}Kh.save(),Kh.setWorldShadow(Je.offsetX+(Jh.x||0)*Vh*ed,Je.offsetY+(Jh.y||0)*Zh*ed,(Jh.blur||0)*Vh*ed),zh=Tt$2.getShadowTransform($h,Kh,Fh,Jh,Je,ed,!0),zh&&Kh.setTransform(zh),$e(Kh,Je,Fh),Kh.restore(),Yh?(Kh.copyWorld(Kh,jh,Hh,"copy"),Kh.copyWorld(Yh,Hh,Hh,"source-out"),Wh=Hh):(Kh.copyWorld(Fh.canvas,qh,Xh,"source-out"),Wh=jh),Kh.fillWorld(Wh,Ct$2.string(Jh.color),"source-in"),co.copyCanvasByWorld($h,Th,Kh,Wh,Jh.blendMode),Qh&&td<Qh&&Kh.clearWorld(Wh)}),Kh.recycle(Wh)},blur:function($h,Th,Fh){const{blur:Wh}=$h.__;Fh.setWorldBlur(Wh*$h.__nowWorld.a),Fh.copyWorldToInner(Th,$h.__nowWorld,$h.__layout.renderBounds),Fh.filter="none"},backgroundBlur:function($h,Th,Fh){},getShadowRenderSpread:Qe,getShadowTransform:function($h,Th,Fh,Wh,zh,Hh,Uh){if(Wh.spread){const Yh=2*Wh.spread*Hh*(Uh?-1:1),{width:Xh,height:jh}=$h.__layout.strokeBounds;return qe.set().scaleOfOuter({x:(zh.x+zh.width/2)*Th.pixelRatio,y:(zh.y+zh.height/2)*Th.pixelRatio},1+Yh/Xh,1+Yh/jh),qe}},isTransformShadow($h){},getInnerShadowSpread:ti},{excludeRenderBounds:ii}=xo;let si;function ni($h,Th,Fh,Wh,zh,Hh,Uh,Yh){switch(Th){case"grayscale":si||(si=!0,zh.useGrayscaleAlpha($h.__nowWorld));case"alpha":(function(Xh,jh,qh,Vh,Zh,Kh){const Qh=Xh.__nowWorld;qh.resetTransform(),qh.opacity=1,qh.useMask(Vh,Qh),Kh&&Vh.recycle(Qh),ri(Xh,jh,qh,1,Zh,Kh)})($h,Fh,Wh,zh,Uh,Yh);break;case"opacity-path":ri($h,Fh,Wh,Hh,Uh,Yh);break;case"path":Yh&&Fh.restore()}}function oi($h){return $h.getSameCanvas(!1,!0)}function ri($h,Th,Fh,Wh,zh,Hh){const Uh=$h.__nowWorld;Th.resetTransform(),Th.opacity=Wh,Th.copyWorld(Fh,Uh,void 0,zh),Hh?Fh.recycle(Uh):Fh.clearWorld(Uh)}ye$1.prototype.__renderMask=function($h,Th){let Fh,Wh,zh,Hh,Uh,Yh;const{children:Xh}=this;for(let jh=0,qh=Xh.length;jh<qh;jh++){if(Fh=Xh[jh],Yh=Fh.__.mask,Yh){Uh&&(ni(this,Uh,$h,zh,Wh,Hh,void 0,!0),Wh=zh=null),Yh!=="clipping"&&Yh!=="clipping-path"||ii(Fh,Th)||Fh.__render($h,Th),Hh=Fh.__.opacity,si=!1,Yh==="path"||Yh==="clipping-path"?(Hh<1?(Uh="opacity-path",zh||(zh=oi($h))):(Uh="path",$h.save()),Fh.__clip(zh||$h,Th)):(Uh=Yh==="grayscale"?"grayscale":"alpha",Wh||(Wh=oi($h)),zh||(zh=oi($h)),Fh.__render(Wh,Th));continue}const Vh=Hh===1&&Fh.__.__blendMode;Vh&&ni(this,Uh,$h,zh,Wh,Hh,void 0,!1),ii(Fh,Th)||Fh.__render(zh||$h,Th),Vh&&ni(this,Uh,$h,zh,Wh,Hh,Vh,!1)}ni(this,Uh,$h,zh,Wh,Hh,void 0,!0)};const ai=`>)]}%!?,.:;'"\u300B\uFF09\u300D\u3009\u300F\u3017\u3011\u3015\uFF5D\u2510\uFF1E\u2019\u201D\uFF01\uFF1F\uFF0C\u3001\u3002\uFF1A\uFF1B\u2030`,hi=ai+"_#~&*+\\=|\u226E\u226F\u2248\u2260\uFF1D\u2026",li=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map(([$h,Th])=>`[\\u${$h.toString(16)}-\\u${Th.toString(16)}]`).join("|"));function ci($h){const Th={};return $h.split("").forEach(Fh=>Th[Fh]=!0),Th}const di=ci("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),ui=ci(`{[(<'"\u300A\uFF08\u300C\u3008\u300E\u3016\u3010\u3014\uFF5B\u250C\uFF1C\u2018\u201C\uFF1D\xA5\uFFE5\uFF04\u20AC\xA3\uFFE1\xA2\uFFE0`),fi=ci(ai),pi=ci(hi),gi=ci("- \u2014\uFF0F\uFF5E\uFF5C\u2506\xB7");var wi;(function($h){$h[$h.Letter=0]="Letter",$h[$h.Single=1]="Single",$h[$h.Before=2]="Before",$h[$h.After=3]="After",$h[$h.Symbol=4]="Symbol",$h[$h.Break=5]="Break"})(wi||(wi={}));const{Letter:_i,Single:mi,Before:vi,After:yi,Symbol:xi,Break:bi}=wi;function Si($h){return di[$h]?_i:gi[$h]?bi:ui[$h]?vi:fi[$h]?yi:pi[$h]?xi:li.test($h)?mi:_i}const Li={trimRight($h){const{words:Th}=$h;let Fh,Wh=0,zh=Th.length;for(let Hh=zh-1;Hh>-1&&(Fh=Th[Hh].data[0],Fh.char===" ");Hh--)Wh++,$h.width-=Fh.width;Wh&&Th.splice(zh-Wh,Wh)}};function ki($h,Th,Fh){switch(Th){case"title":return Fh?$h.toUpperCase():$h;case"upper":return $h.toUpperCase();case"lower":return $h.toLowerCase();default:return $h}}const{trimRight:Ti}=Li,{Letter:Bi,Single:Ei,Before:Pi,After:Ri,Symbol:Mi,Break:Ci}=wi;let Ai,Oi,Di,Wi,Ii,Fi,zi,ji,Ui,Gi,Yi,Xi,Vi,Ni,Hi,qi,Ki,Qi=[];function $i($h,Th){Ui&&!ji&&(ji=Ui),Ai.data.push({char:$h,width:Th}),Di+=Th}function Zi(){Wi+=Di,Ai.width=Di,Oi.words.push(Ai),Ai={data:[]},Di=0}function Ji(){Ni&&(Hi.paraNumber++,Oi.paraStart=!0,Ni=!1),Ui&&(Oi.startCharSize=ji,Oi.endCharSize=Ui,ji=0),Oi.width=Wi,qi.width?Ti(Oi):Ki&&ts(),Qi.push(Oi),Oi={words:[]},Wi=0}function ts(){Wi>(Hi.maxWidth||0)&&(Hi.maxWidth=Wi)}const{top:es,right:is,bottom:ss,left:ns}=mt$3;function os($h,Th,Fh){const{bounds:Wh,rows:zh}=$h;Wh[Th]+=Fh;for(let Hh=0;Hh<zh.length;Hh++)zh[Hh][Th]+=Fh}const rs={getDrawData:function($h,Th){i($h)||($h=String($h));let Fh=0,Wh=0,zh=Th.__getInput("width")||0,Hh=Th.__getInput("height")||0;const{__padding:Uh}=Th;Uh&&(zh?(Fh=Uh[ns],zh-=Uh[is]+Uh[ns],!zh&&(zh=.01)):Th.autoSizeAlign||(Fh=Uh[ns]),Hh?(Wh=Uh[es],Hh-=Uh[es]+Uh[ss],!Hh&&(Hh=.01)):Th.autoSizeAlign||(Wh=Uh[es]));const Yh={bounds:{x:Fh,y:Wh,width:zh,height:Hh},rows:[],paraNumber:0,font:$t$2.canvas.font=Th.__font};return(function(Xh,jh,qh){Hi=Xh,Qi=Xh.rows,qi=Xh.bounds,Ki=!qi.width&&!qh.autoSizeAlign;const{__letterSpacing:Vh,paraIndent:Zh,textCase:Kh}=qh,{canvas:Qh}=$t$2,{width:Jh}=qi;if(qh.__isCharMode){const td=qh.textWrap!=="none",ed=qh.textWrap==="break";Ni=!0,Yi=null,ji=zi=Ui=Di=Wi=0,Ai={data:[]},Oi={words:[]},Vh&&(jh=[...jh]);for(let id=0,sd=jh.length;id<sd;id++)Fi=jh[id],Fi===`
`?(Di&&Zi(),Oi.paraEnd=!0,Ji(),Ni=!0):(Gi=Si(Fi),Gi===Bi&&Kh!=="none"&&(Fi=ki(Fi,Kh,!Di)),zi=Qh.measureText(Fi).width,Vh&&(Vh<0&&(Ui=zi),zi+=Vh),Xi=Gi===Ei&&(Yi===Ei||Yi===Bi)||Yi===Ei&&Gi!==Ri,Vi=!(Gi!==Pi&&Gi!==Ei||Yi!==Mi&&Yi!==Ri),Ii=Ni&&Zh?Jh-Zh:Jh,td&&Jh&&Wi+Di+zi>Ii&&(ed?(Di&&Zi(),Wi&&Ji()):(Vi||(Vi=Gi===Bi&&Yi==Ri),(Xi||Vi||Gi===Ci||Gi===Pi||Gi===Ei||Di+zi>Ii)&&Di&&Zi(),Wi&&Ji())),Fi===" "&&Ni!==!0&&Wi+Di===0||(Gi===Ci?(Fi===" "&&Di&&Zi(),$i(Fi,zi),Zi()):((Xi||Vi)&&Di&&Zi(),$i(Fi,zi))),Yi=Gi);Di&&Zi(),Wi&&Ji(),Qi.length>0&&(Qi[Qi.length-1].paraEnd=!0)}else jh.split(`
`).forEach(td=>{Hi.paraNumber++,Wi=Qh.measureText(td).width,Qi.push({x:Zh||0,text:td,width:Wi,paraStart:!0}),Ki&&ts()})})(Yh,$h,Th),Uh&&(function(Xh,jh,qh,Vh,Zh){if(!Vh&&qh.autoSizeAlign)switch(qh.textAlign){case"left":os(jh,"x",Xh[ns]);break;case"right":os(jh,"x",-Xh[is])}if(!Zh&&qh.autoSizeAlign)switch(qh.verticalAlign){case"top":os(jh,"y",Xh[es]);break;case"bottom":os(jh,"y",-Xh[ss])}})(Uh,Yh,Th,zh,Hh),(function(Xh,jh){const{rows:qh,bounds:Vh}=Xh,Zh=qh.length,{__lineHeight:Kh,__baseLine:Qh,__letterSpacing:Jh,__clipText:td,textAlign:ed,verticalAlign:id,paraSpacing:sd,autoSizeAlign:nd}=jh;let{x:hd,y:ud,width:rd,height:ad}=Vh,dd=Kh*Zh+(sd?sd*(Xh.paraNumber-1):0),cd=Qh;if(td&&dd>ad)dd=Math.max(jh.__autoHeight?dd:ad,Kh),Zh>1&&(Xh.overflow=Zh);else if(ad||nd)switch(id){case"middle":ud+=(ad-dd)/2;break;case"bottom":ud+=ad-dd}cd+=ud;let od,ld,_d,md=rd||nd?rd:Xh.maxWidth;for(let gd=0,wd=Zh;gd<wd;gd++){if(od=qh[gd],od.x=hd,od.width<rd||od.width>rd&&!td)switch(ed){case"center":od.x+=(md-od.width)/2;break;case"right":od.x+=md-od.width}od.paraStart&&sd&&gd>0&&(cd+=sd),od.y=cd,cd+=Kh,Xh.overflow>gd&&cd>dd&&(od.isOverflow=!0,Xh.overflow=gd+1),ld=od.x,_d=od.width,Jh<0&&(od.width<0?(_d=-od.width+jh.fontSize+Jh,ld-=_d,_d+=jh.fontSize):_d-=Jh),ld<Vh.x&&(Vh.x=ld),_d>Vh.width&&(Vh.width=_d),td&&rd&&rd<_d&&(od.isOverflow=!0,Xh.overflow||(Xh.overflow=qh.length))}Vh.y=ud,Vh.height=dd})(Yh,Th),Th.__isCharMode&&(function(Xh,jh,qh){const{rows:Vh}=Xh,{textAlign:Zh,paraIndent:Kh,__letterSpacing:Qh}=jh,Jh=qh&&Zh.includes("both"),td=Jh||qh&&Zh.includes("justify"),ed=td&&Zh.includes("letter");let id,sd,nd,hd,ud,rd,ad,dd,cd,od;Vh.forEach(ld=>{ld.words&&(ud=Kh&&ld.paraStart?Kh:0,dd=ld.words.length,td&&(od=!ld.paraEnd||Jh,sd=qh-ld.width-ud,ed?hd=sd/(ld.words.reduce((_d,md)=>_d+md.data.length,0)-1):nd=dd>1?sd/(dd-1):0),rd=Qh||ld.isOverflow||ed?0:nd?1:2,ld.isOverflow&&!Qh&&(ld.textMode=!0),rd===2?(ld.x+=ud,(function(_d){_d.text="",_d.words.forEach(md=>{md.data.forEach(gd=>{_d.text+=gd.char})})})(ld)):(ld.x+=ud,id=ld.x,ld.data=[],ld.words.forEach((_d,md)=>{rd===1?(ad={char:"",x:id},id=(function(gd,wd,$d){return gd.forEach(fd=>{$d.char+=fd.char,wd+=fd.width}),wd})(_d.data,id,ad),(ld.isOverflow||ad.char!==" ")&&ld.data.push(ad)):id=(function(gd,wd,$d,fd,vd){return gd.forEach(yd=>{(fd||yd.char!==" ")&&(yd.x=wd,$d.push(yd)),wd+=yd.width,vd&&(wd+=vd)}),wd})(_d.data,id,ld.data,ld.isOverflow,od&&hd),od&&(cd=md===dd-1,nd?cd||(id+=nd,ld.width+=nd):hd&&(ld.width+=hd*(_d.data.length-(cd?1:0))))})),ld.words=null)})})(Yh,Th,zh),Yh.overflow&&(function(Xh,jh,qh,Vh){const{rows:Zh,overflow:Kh}=Xh;let{textOverflow:Qh}=jh;if(Kh&&Zh.splice(Kh),Vh&&Qh&&Qh!=="show"){let Jh,td;Qh==="hide"?Qh="":Qh==="ellipsis"&&(Qh="...");const ed=Qh?$t$2.canvas.measureText(Qh).width:0,id=qh+Vh-ed;(jh.textWrap==="none"?Zh:[Zh[Kh-1]]).forEach(sd=>{if(sd.isOverflow&&sd.data){let nd=sd.data.length-1;for(let hd=nd;hd>-1&&(Jh=sd.data[hd],td=Jh.x+Jh.width,!(hd===nd&&td<id));hd--){if(td<id&&Jh.char!==" "||!hd){sd.data.splice(hd+1),sd.width-=Jh.width;break}sd.width-=Jh.width}sd.width+=ed,sd.data.push({char:Qh,x:td}),sd.textMode&&(function(hd){hd.text="",hd.data.forEach(ud=>{hd.text+=ud.char}),hd.data=null})(sd)}})}})(Yh,Th,Fh,zh),Th.textDecoration!=="none"&&(function(Xh,jh){let qh,Vh=0;const{fontSize:Zh,textDecoration:Kh}=jh;switch(Xh.decorationHeight=Zh/11,d(Kh)?(qh=Kh.type,Kh.color&&(Xh.decorationColor=Ct$2.string(Kh.color)),Kh.offset&&(Vh=Math.min(.3*Zh,Math.max(Kh.offset,.15*-Zh)))):qh=Kh,qh){case"under":Xh.decorationY=[.15*Zh+Vh];break;case"delete":Xh.decorationY=[.35*-Zh];break;case"under-delete":Xh.decorationY=[.15*Zh+Vh,.35*-Zh]}})(Yh,Th),Yh}},as={string:function($h,Th){if(!$h)return"#000";const Fh=o(Th)&&Th<1;if(i($h)){if(!Fh||!Ct$2.object)return $h;$h=Ct$2.object($h)}let Wh=s($h.a)?1:$h.a;Fh&&(Wh*=Th);const zh=$h.r+","+$h.g+","+$h.b;return Wh===1?"rgb("+zh+")":"rgba("+zh+","+Wh+")"}};Object.assign(At$2,rs),Object.assign(Ct$2,as),Object.assign(Ft$2,Yt),Object.assign(Wt$2,be),Object.assign(Et$2,Ue),Object.assign(Tt$2,ei),Object.assign(le$2,{interaction:($h,Th,Fh,Wh)=>new Tt($h,Th,Fh,Wh),hitCanvas:($h,Th)=>new et($h,Th),hitCanvasManager:()=>new At$1}),it();const LeaferUIRuntime=Object.freeze(Object.defineProperty({__proto__:null,AlignHelper:kt$3,get Answer(){return t},get App(){return N},AroundHelper:bt$3,AutoBounds:Gt$2,BezierHelper:hs,Bounds:Vt$3,BoundsEvent:Ho,BoundsHelper:zt$2,get Box(){return Ae$1},BoxData:Jt$1,get Branch(){return vh},BranchHelper:vo,BranchRender:za,get Canvas(){return si$1},CanvasData:ae$1,CanvasManager:ge$2,ChildEvent:zo,ColorConvert:Ct$2,Creator:le$2,Cursor:St$1,DataHelper:_,Debug:ee$2,get Direction4(){return mt$3},get Direction9(){return xt$2},DragBoundsHelper:tt$1,get DragEvent(){return nt$1},Dragger:Dt$1,get DropEvent(){return ht$1},Effect:Tt$2,get Ellipse(){return We$1},EllipseData:Qt$1,EllipseHelper:ys,Event:Xo,EventCreator:pe$2,Eventer:la,Export:It$2,FileHelper:Gi$1,Filter:Dt$2,FourNumberHelper:v,get Frame(){return Ce$1},FrameData:Gt$1,get Group(){return ye$1},GroupData:jt$2,HitCanvasManager:At$1,get Image(){return ei$1},ImageData:re$1,ImageEvent:Vo,ImageManager:en,IncrementId:g,Interaction:Tt,InteractionBase:Mt$1,InteractionHelper:_t$1,get KeyEvent(){return pt$1},Keyboard:W,LayoutEvent:ta,Layouter:gt,get Leaf(){return _h},LeafBounds:Na,LeafBoundsHelper:xo,LeafData:f,LeafDataProxy:Ba,LeafEventer:wa,LeafHelper:co,LeafLayout:Do,LeafLevelList:Ch,LeafList:kh,LeafMatrix:Sa,LeafRender:Ya,get Leafer(){return we$1},LeaferCanvas:et,LeaferCanvasBase:Ee$2,LeaferData:qt$1,LeaferEvent:sa,LeaferFilm:an,LeaferImage:on,LeaferVideo:hn,get Line(){return ti$1},LineData:$t$1,MathHelper:I$1,Matrix:pt$2,MatrixHelper:q$1,get MoveEvent(){return ot$1},MyDragEvent:rt$1,MyImage:ii$1,MyPointerEvent:st$1,MyTouchEvent:gt$1,NeedConvertToCanvasCommandMap:Ne$2,OneRadian:A,PI2:W$1,PI_2:N$1,Paint:Ft$2,PaintGradient:Et$2,PaintImage:Wt$2,get Path(){return di$1},PathArrow:Pt$2,PathBounds:Ai$1,PathCommandDataHelper:Cr,PathCommandMap:Ae$2,PathCommandNodeHelper:ms,PathConvert:sr,PathCorner:Fi$1,PathCreator:Fr,PathData:ee$1,PathDrawer:ri$2,PathHelper:Ie$2,get PathNodeHandleType(){return Z},PathNumberCommandLengthMap:ze$2,PathNumberCommandMap:Xe$2,get Pen(){return li$1},PenData:ie$1,Picker:xt,Platform:$t$2,Plugin:he$2,Point:ut$2,PointHelper:ot$2,PointerButton:K,get PointerEvent(){return it$1},get Polygon(){return Oe$1},PolygonData:Zt$1,PropertyEvent:Uo,get Rect(){return xe$1},RectData:Kt$2,RectHelper:Fe$2,RectRender:ue$1,RenderEvent:ea,Renderer:_t,ResizeEvent:$o,Resource:Ki$1,get RotateEvent(){return lt$1},Run:ne$2,Selector:bt,get Star(){return je$1},StarData:te$1,State:Lt$2,StringNumberMap:Qt$2,get SwipeEvent(){return ct$1},TaskItem:Ji$1,TaskProcessor:Zi$1,get Text(){return hi$1},TextConvert:At$2,TextData:oe$1,get TouchEvent(){return dt$1},Transition:zt$1,TwoPointBoundsHelper:gt$2,get UI(){return ge$1},UIBounds:he$1,UICreator:ce$2,UIData:Ut$2,UIEvent:V,UIRender:le$1,UnitConvert:bt$2,UnitConvertHelper:qt$2,WaitHelper:So,WatchEvent:Ko,Watcher:nt,get ZoomEvent(){return ut$1},affectRenderBoundsType:Sn,affectStrokeBoundsType:On,attr:_n,autoLayoutType:mn,boundsType:bn,canvasPatch:Hi$1,canvasSizeAttrs:Re$2,createAttr:Bt$2,createDescriptor:cn,cursorType:Xn,dataProcessor:zn,dataType:fn,decorateLeafAttr:un,defineDataProcessor:Un,defineKey:ln,defineLeafAttr:pn,dimType:Rn,doBoundsType:vn,doStrokeType:Tn,effectType:mt$2,emptyData:e$1,eraserType:Yn,extraPropertyEventMap:jo,getBoundsData:D,getDescriptor:dn,getMatrixData:X$1,getPointData:Y$1,hitType:Dn,isArray:l,isData:c,isEmptyData:u,isFinite:n,isNull:r,isNumber:o,isObject:d,isString:i,isUndefined:s,layoutProcessor:Fn,leaferTransformAttrMap:aa,maskType:Nn,naturalBoundsType:Bn,opacityType:En,path:Ui$1,pathInputType:kn,pathType:Cn,pen:ji$1,positionType:gn,registerUI:Zn,registerUIEvent:$n,resizeType:Rt$2,rewrite:Gn,rewriteAble:qn,rotationType:wn,scaleType:xn,scrollType:yn,sortType:Wn,strokeType:Pn,surfaceType:Ln,tempBounds:Ht$3,tempMatrix:ft$2,tempPoint:_t$2,tryToNumber:h,useCanvas:it,useModule:Jn,version:Oh,visibleType:In,zoomLayerType:kt$2},Symbol.toStringTag,{value:"Module"}));class LLink{constructor(Th,Fh,Wh,zh,Hh,Uh){this.id=Th,this.type=Fh,this.origin_id=Wh,this.origin_slot=zh,this.target_id=Hh,this.target_slot=Uh,this._data=null,this._pos=new Float32Array(2)}configure(Th){Th.constructor===Array?(this.id=Th[0],this.origin_id=Th[1],this.origin_slot=Th[2],this.target_id=Th[3],this.target_slot=Th[4],this.type=Th[5]):(this.id=Th.id,this.type=Th.type,this.origin_id=Th.origin_id,this.origin_slot=Th.origin_slot,this.target_id=Th.target_id,this.target_slot=Th.target_slot)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}}function initializeGraphState($h){$h.last_node_id=0,$h.last_link_id=0,$h._version=-1,$h._nodes=[],$h._nodes_by_id={},$h._nodes_in_order=[],$h._nodes_executable=null,$h._groups=[],$h.links={},$h.iteration=0,$h.config={},$h.vars={},$h.extra={},$h.globaltime=0,$h.runningtime=0,$h.fixedtime=0,$h.fixedtime_lapse=.01,$h.elapsed_time=.01,$h.last_update_time=0,$h.starttime=0,$h.catch_errors=!0,$h.history={actionHistory:[],actionHistoryVersions:[],actionHistoryPtr:0},$h.nodes_executing=[],$h.nodes_actioning=[],$h.node_ancestorsCalculated=[],$h.nodes_executedAction=[],$h._configuring=!1,$h.inputs={},$h.outputs={}}function mergeOptions($h,Th){return Object.assign({},$h,Th)}let LiteGraph$o=null;function setLifecycleMethodsLiteGraph($h){LiteGraph$o=$h}const lifecycleMethods={getSupportedTypes(){var $h;return($h=this.supported_types)!=null?$h:this.constructor.supported_types},clear(){var $h;this.stop(),this.status=this.constructor.STATUS_STOPPED,($h=this._nodes)==null||$h.forEach(Th=>{var Fh;(Fh=Th.onRemoved)==null||Fh.call(Th)}),initializeGraphState(this),this.configApplyDefaults(),this.change(),this.sendActionToCanvas("clear")},configApply($h){this.config=mergeOptions(this.config,$h)},configApplyDefaults(){var $h=LiteGraph$o.graphDefaultConfig;this.configApply($h)}};let LiteGraph$n=null;function setCanvasBindingMethodsLiteGraph($h){LiteGraph$n=$h}const canvasBindingMethods={attachCanvas($h){var Th;if(!$h instanceof LiteGraph$n.LGraphCanvas)throw new Error("attachCanvas expects a LiteGraph.LGraphCanvas instance");$h.graph&&$h.graph!=this&&$h.graph.detachCanvas($h),$h.graph=this,(Th=this.list_of_graphcanvas)!=null||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push($h)},detachCanvas($h){if(this.list_of_graphcanvas){var Th=this.list_of_graphcanvas.indexOf($h);Th!=-1&&($h.graph=null,this.list_of_graphcanvas.splice(Th,1))}},sendActionToCanvas($h,Th){if(this.list_of_graphcanvas)for(const Fh of this.list_of_graphcanvas)Fh[$h]&&Th&&Fh[$h](...Th)},change(){var $h,Th;($h=LiteGraph$n.log)==null||$h.call(LiteGraph$n,"Graph visually changed"),this.sendActionToCanvas("setDirty",[!0,!0]),(Th=this.on_change)==null||Th.call(this,this)},setDirtyCanvas($h,Th){this.sendActionToCanvas("setDirty",[$h,Th])},isLive(){if(!this.list_of_graphcanvas)return!1;for(var $h=0;$h<this.list_of_graphcanvas.length;++$h){var Th=this.list_of_graphcanvas[$h];if(Th.live_mode)return!0}return!1}};let LiteGraph$m=null;function setRuntimeLoopMethodsLiteGraph($h){LiteGraph$m=$h}const runtimeLoopMethods={start($h=0){var Th;if(this.status===this.constructor.STATUS_RUNNING)return;this.status=this.constructor.STATUS_RUNNING,(Th=this.onPlayEvent)==null||Th.call(this),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph$m.getTime(),this.last_update_time=this.starttime;const Fh=()=>{var Wh,zh;this.execution_timer_id===-1&&(window.requestAnimationFrame(Fh),(Wh=this.onBeforeStep)==null||Wh.call(this),this.runStep(1,!this.catch_errors),(zh=this.onAfterStep)==null||zh.call(this))};$h===0&&typeof window=="object"&&window.requestAnimationFrame?(this.execution_timer_id=-1,Fh()):this.execution_timer_id=setInterval(()=>{var Wh,zh;(Wh=this.onBeforeStep)==null||Wh.call(this),this.runStep(1,!this.catch_errors),(zh=this.onAfterStep)==null||zh.call(this)},$h)},stop(){var $h;this.status!=this.constructor.STATUS_STOPPED&&(this.status=this.constructor.STATUS_STOPPED,($h=this.onStopEvent)==null||$h.call(this),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},runStep($h=1,Th,Fh){var Wh,zh,Hh,Uh,Yh,Xh,jh=LiteGraph$m.getTime();this.globaltime=.001*(jh-this.starttime);var qh=(Wh=this._nodes_executable)!=null?Wh:this._nodes;if(qh){if(Fh||(Fh=qh.length),Th){for(let Kh=0;Kh<$h;Kh++)qh.forEach(Qh=>{var Jh,td;LiteGraph$m.use_deferred_actions&&(Jh=Qh._waiting_actions)!=null&&Jh.length&&Qh.executePendingActions(),Qh.mode===LiteGraph$m.ALWAYS&&((td=Qh.doExecute)==null||td.call(Qh))}),this.fixedtime+=this.fixedtime_lapse,(zh=this.onExecuteStep)==null||zh.call(this);(Hh=this.onAfterExecute)==null||Hh.call(this)}else try{for(let Kh=0;Kh<$h;Kh++)qh.forEach(Qh=>{var Jh,td;LiteGraph$m.use_deferred_actions&&(Jh=Qh._waiting_actions)!=null&&Jh.length&&Qh.executePendingActions(),Qh.mode===LiteGraph$m.ALWAYS&&((td=Qh.doExecute)==null||td.call(Qh))}),this.fixedtime+=this.fixedtime_lapse,(Uh=this.onExecuteStep)==null||Uh.call(this);(Yh=this.onAfterExecute)==null||Yh.call(this),this.errors_in_execution=!1}catch(Kh){if(this.errors_in_execution=!0,LiteGraph$m.throw_errors)throw Kh;(Xh=LiteGraph$m.log)==null||Xh.call(LiteGraph$m,`Error during execution: ${Kh}`),this.stop()}var Vh=LiteGraph$m.getTime(),Zh=Vh-jh;Zh==0&&(Zh=1),this.execution_time=.001*Zh,this.globaltime+=.001*Zh,this.iteration+=1,this.elapsed_time=(Vh-this.last_update_time)*.001,this.last_update_time=Vh,this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[]}},getTime(){return this.globaltime},getFixedTime(){return this.fixedtime},getElapsedTime(){return this.elapsed_time},clearTriggeredSlots(){for(var $h in this.links){var Th=this.links[$h];Th&&Th._last_time&&(Th._last_time=0)}}};let LiteGraph$l=null;function setExecutionOrderMethodsLiteGraph($h){LiteGraph$l=$h}const executionOrderMethods={updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var $h=0;$h<this._nodes_in_order.length;++$h)this._nodes_in_order[$h].onExecute&&this._nodes_executable.push(this._nodes_in_order[$h])},computeExecutionOrder($h,Th){var Fh,Wh=[],zh=[],Hh={},Uh={},Yh={};for(let Kh=0,Qh=this._nodes.length;Kh<Qh;++Kh){let Jh=this._nodes[Kh];if(!($h&&!Jh.onExecute)){Hh[Jh.id]=Jh;var Xh=0;if(Jh.inputs)for(var jh=0,qh=Jh.inputs.length;jh<qh;jh++)Jh.inputs[jh]&&Jh.inputs[jh].link!=null&&(Xh+=1);Xh==0?(zh.push(Jh),Th&&(Jh._level=1)):(Th&&(Jh._level=0),Yh[Jh.id]=Xh)}}for(;zh.length!=0;){var Vh=zh.shift();if(Wh.push(Vh),delete Hh[Vh.id],!!Vh.outputs)for(let Kh=0;Kh<Vh.outputs.length;Kh++){let Qh=Vh.outputs[Kh];if(!(Qh==null||Qh.links==null||Qh.links.length==0))for(let Jh=0;Jh<Qh.links.length;Jh++){let td=Qh.links[Jh],ed=this.links[td];if(!ed||Uh[ed.id])continue;let id=this.getNodeById(ed.target_id);if(id==null){Uh[ed.id]=!0;continue}Th&&(!id._level||id._level<=Vh._level)&&(id._level=Vh._level+1),Uh[ed.id]=!0,Yh[id.id]-=1,Yh[id.id]==0&&zh.push(id)}}}for(let Kh in Hh)Wh.push(Hh[Kh]);Wh.length!=this._nodes.length&&LiteGraph$l.debug&&((Fh=LiteGraph$l.warn)==null||Fh.call(LiteGraph$l,"something went wrong, nodes missing"));var Zh=Wh.length;for(let Kh=0;Kh<Zh;++Kh)Wh[Kh].order=Kh;Wh=Wh.sort((Kh,Qh)=>{let Jh=Kh.constructor.priority||Kh.priority||0,td=Qh.constructor.priority||Qh.priority||0;return Jh==td?Kh.order-Qh.order:Jh-td});for(let Kh=0;Kh<Zh;++Kh)Wh[Kh].order=Kh;return Wh},getAncestors($h,Th={}){for(var Fh={modesSkip:[],modesOnly:[],typesSkip:[],typesOnly:[]},Wh=Object.assign(Fh,Th),zh=[],Hh=[],Uh=[$h],Yh={};Uh.length;){var Xh=Uh.shift();if(Xh&&!Yh[Xh.id]){if(Yh[Xh.id]=!0,Xh.id!=$h.id){if(Wh.modesSkip&&Wh.modesSkip.length&&Wh.modesSkip.indexOf(Xh.mode)!=-1||Wh.modesOnly&&Wh.modesOnly.length&&Wh.modesOnly.indexOf(Xh.mode)==-1)continue;Hh.indexOf(Xh.id)==-1&&(zh.push(Xh),Hh.push(Xh.id))}if(Xh.inputs)for(var jh=0;jh<Xh.inputs.length;++jh){var qh=Xh.getInputNode(jh);if(qh){var Vh=Xh.inputs[jh].type;Wh.typesSkip&&Wh.typesSkip.length&&Wh.typesSkip.indexOf(Vh)!=-1||Wh.typesOnly&&Wh.typesOnly.length&&Wh.typesOnly.indexOf(qh.mode)==-1||Hh.indexOf(qh.id)==-1&&(Yh[qh.id]||Uh.push(qh))}}}}return zh.sort((Zh,Kh)=>Zh.order-Kh.order),zh},arrange($h=100,Th){var Fh;const Wh=this.computeExecutionOrder(!1,!0),zh=[];for(let Uh=0;Uh<Wh.length;++Uh){const Yh=Wh[Uh],Xh=Yh._level||1;(Fh=zh[Xh])!=null||(zh[Xh]=[]),zh[Xh].push(Yh)}let Hh=$h;for(let Uh=0;Uh<zh.length;++Uh){const Yh=zh[Uh];if(!Yh)continue;let Xh=100,jh=$h+LiteGraph$l.NODE_TITLE_HEIGHT;for(let qh=0;qh<Yh.length;++qh){const Vh=Yh[qh];Vh.pos[0]=Th==LiteGraph$l.VERTICAL_LAYOUT?jh:Hh,Vh.pos[1]=Th==LiteGraph$l.VERTICAL_LAYOUT?Hh:jh;const Zh=Th==LiteGraph$l.VERTICAL_LAYOUT?1:0;Vh.size[Zh]>Xh&&(Xh=Vh.size[Zh]);const Kh=Th==LiteGraph$l.VERTICAL_LAYOUT?0:1;jh+=Vh.size[Kh]+$h+LiteGraph$l.NODE_TITLE_HEIGHT}Hh+=Xh+$h}this.setDirtyCanvas(!0,!0)}};let LiteGraph$k=null;function setNodeMutationMethodsLiteGraph($h){LiteGraph$k=$h}const nodeMutationMethods={add($h,Th,Fh={}){var Wh,zh,Hh,Uh={doProcessChange:!0,doCalcSize:!0},Yh=Object.assign(Uh,Fh);if($h){if($h.constructor===LiteGraph$k.LGraphGroup){this._groups.push($h),this.setDirtyCanvas(!0),this.change(),$h.graph=this,this.onGraphChanged({action:"groupAdd",doSave:Yh.doProcessChange});return}if($h.id!=-1&&this._nodes_by_id[$h.id]!=null&&((Wh=LiteGraph$k.warn)==null||Wh.call(LiteGraph$k,"LiteGraph: there is already a node with this ID, changing it"),LiteGraph$k.use_uuids?$h.id=LiteGraph$k.uuidv4():$h.id=++this.last_node_id),this._nodes.length>=LiteGraph$k.MAX_NUMBER_OF_NODES)throw new Error("LiteGraph: max number of nodes in a graph reached");return LiteGraph$k.use_uuids?($h.id==null||$h.id==-1)&&($h.id=LiteGraph$k.uuidv4()):$h.id==null||$h.id==-1?$h.id=++this.last_node_id:this.last_node_id<$h.id&&(this.last_node_id=$h.id),$h.graph=this,this.onGraphChanged({action:"nodeAdd",doSave:Yh.doProcessChange}),this._nodes.push($h),this._nodes_by_id[$h.id]=$h,(zh=$h.onAdded)==null||zh.call($h,this),this.config.align_to_grid&&$h.alignToGrid(),Th||this.updateExecutionOrder(),(Hh=this.onNodeAdded)==null||Hh.call(this,$h),Yh.doCalcSize&&$h.setSize($h.computeSize()),this.setDirtyCanvas(!0),this.change(),$h}},remove($h){var Th,Fh;if($h.constructor===LiteGraph$k.LGraphGroup){var Wh=this._groups.indexOf($h);Wh!=-1&&this._groups.splice(Wh,1),$h.graph=null,this.onGraphChanged({action:"groupRemove"}),this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[$h.id]!=null&&!$h.ignore_remove){if($h.inputs)for(let Hh=0;Hh<$h.inputs.length;Hh++)$h.inputs[Hh].link!=null&&$h.disconnectInput(Hh,{doProcessChange:!1});if($h.outputs)for(let Hh=0;Hh<$h.outputs.length;Hh++){let Uh=$h.outputs[Hh];Uh.links!=null&&Uh.links.length&&$h.disconnectOutput(Hh,!1,{doProcessChange:!1})}if((Th=$h.onRemoved)==null||Th.call($h),$h.graph=null,this.onGraphChanged({action:"nodeRemove"}),this.list_of_graphcanvas)for(let Hh=0;Hh<this.list_of_graphcanvas.length;++Hh){let Uh=this.list_of_graphcanvas[Hh];Uh.selected_nodes[$h.id]&&delete Uh.selected_nodes[$h.id],Uh.node_dragged==$h&&(Uh.node_dragged=null)}var zh=this._nodes.indexOf($h);zh!=-1&&this._nodes.splice(zh,1),delete this._nodes_by_id[$h.id],(Fh=this.onNodeRemoved)==null||Fh.call(this,$h),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},removeLink($h){var Th=this.links[$h];if(Th){var Fh=this.getNodeById(Th.target_id);Fh&&(this.beforeChange(),Fh.disconnectInput(Th.target_slot),this.afterChange())}},checkNodeTypes(){for(var $h,Th=0;Th<this._nodes.length;Th++){var Fh=this._nodes[Th],Wh=LiteGraph$k.registered_node_types[Fh.type];if(Fh.constructor!=Wh){LiteGraph$k.debug&&(($h=LiteGraph$k.log)==null||$h.call(LiteGraph$k,`node being replaced by newer version: ${Fh.type}`));var zh=LiteGraph$k.createNode(Fh.type);this._nodes[Th]=zh,zh.configure(Fh.serialize()),zh.graph=this,this._nodes_by_id[zh.id]=zh,Fh.inputs&&(zh.inputs=Fh.inputs.concat()),Fh.outputs&&(zh.outputs=Fh.outputs.concat())}}this.updateExecutionOrder()}},nodeQueryMethods={getNodeById($h){return $h==null?null:this._nodes_by_id[$h]},findNodesByClass($h,Th=[]){return Th=this._nodes.filter(Fh=>Fh.constructor===$h),Th},findNodesByType($h,Th=[]){const Fh=$h.toLowerCase();return Th=this._nodes.filter(Wh=>Wh.type.toLowerCase()===Fh),Th},findNodeByTitle($h){var Th;return(Th=this._nodes.find(Fh=>Fh.title===$h))!=null?Th:null},findNodesByTitle($h){return this._nodes.filter(Th=>Th.title===$h)},getNodeOnPos($h,Th,Fh=this._nodes,Wh=0){var zh;return(zh=Fh.reverse().find(Hh=>Hh.isPointInside($h,Th,Wh)))!=null?zh:null},getGroupOnPos($h,Th){var Fh;return(Fh=this._groups.find(Wh=>Wh.isPointInside($h,Th,2,!0)))!=null?Fh:null}};let LiteGraph$j=null;function setGraphPortsMethodsLiteGraph($h){LiteGraph$j=$h}const graphPortsMethods={addInput($h,Th,Fh){var Wh,zh,Hh=this.inputs[$h];Hh||(this.beforeChange(),this.inputs[$h]={name:$h,type:Th,value:Fh},this.onGraphChanged({action:"addInput"}),this.afterChange(),(Wh=this.onInputAdded)==null||Wh.call(this,$h,Th),(zh=this.onInputsOutputsChange)==null||zh.call(this))},setInputData($h,Th){var Fh=this.inputs[$h];Fh&&(Fh.value=Th)},getInputData($h){var Th=this.inputs[$h];return Th?Th.value:null},renameInput($h,Th){var Fh,Wh,zh;if(Th!=$h){if(!this.inputs[$h])return!1;if(this.inputs[Th])return(Fh=LiteGraph$j.error)==null||Fh.call(LiteGraph$j,"there is already one input with that name"),!1;this.inputs[Th]=this.inputs[$h],delete this.inputs[$h],this.onGraphChanged({action:"renameInput"}),(Wh=this.onInputRenamed)==null||Wh.call(this,$h,Th),(zh=this.onInputsOutputsChange)==null||zh.call(this)}},changeInputType($h,Th){var Fh;if(!this.inputs[$h])return!1;this.inputs[$h].type&&String(this.inputs[$h].type).toLowerCase()==String(Th).toLowerCase()||(this.inputs[$h].type=Th,this.onGraphChanged({action:"changeInputType"}),(Fh=this.onInputTypeChanged)==null||Fh.call(this,$h,Th))},removeInput($h){var Th,Fh;return this.inputs[$h]?(delete this.inputs[$h],this.onGraphChanged({action:"graphRemoveInput"}),(Th=this.onInputRemoved)==null||Th.call(this,$h),(Fh=this.onInputsOutputsChange)==null||Fh.call(this),!0):!1},addOutput($h,Th,Fh){var Wh,zh;this.outputs[$h]={name:$h,type:Th,value:Fh},this.onGraphChanged({action:"addOutput"}),(Wh=this.onOutputAdded)==null||Wh.call(this,$h,Th),(zh=this.onInputsOutputsChange)==null||zh.call(this)},setOutputData($h,Th){var Fh=this.outputs[$h];Fh&&(Fh.value=Th)},getOutputData($h){var Th=this.outputs[$h];return Th?Th.value:null},renameOutput($h,Th){var Fh,Wh,zh;if(!this.outputs[$h])return!1;if(this.outputs[Th])return(Fh=LiteGraph$j.error)==null||Fh.call(LiteGraph$j,"there is already one output with that name"),!1;this.outputs[Th]=this.outputs[$h],delete this.outputs[$h],this._version++,(Wh=this.onOutputRenamed)==null||Wh.call(this,$h,Th),(zh=this.onInputsOutputsChange)==null||zh.call(this)},changeOutputType($h,Th){var Fh;if(!this.outputs[$h])return!1;this.outputs[$h].type&&String(this.outputs[$h].type).toLowerCase()==String(Th).toLowerCase()||(this.outputs[$h].type=Th,this.onGraphChanged({action:"changeOutputType"}),(Fh=this.onOutputTypeChanged)==null||Fh.call(this,$h,Th))},removeOutput($h){var Th,Fh;return this.outputs[$h]?(delete this.outputs[$h],this.onGraphChanged({action:"removeOutput"}),(Th=this.onOutputRemoved)==null||Th.call(this,$h),(Fh=this.onInputsOutputsChange)==null||Fh.call(this),!0):!1},triggerInput($h,Th){for(var Fh=this.findNodesByTitle($h),Wh=0;Wh<Fh.length;++Wh)Fh[Wh].onTrigger(Th)},setCallback($h,Th){for(var Fh=this.findNodesByTitle($h),Wh=0;Wh<Fh.length;++Wh)Fh[Wh].setTrigger(Th)}};let LiteGraph$i=null;function setGraphEventsMethodsLiteGraph($h){LiteGraph$i=$h}const graphEventsMethods={sendEventToAllNodes($h,Th,Fh=LiteGraph$i.ALWAYS){var Wh=this._nodes_in_order?this._nodes_in_order:this._nodes;if(Wh)for(let zh=0,Hh=Wh.length;zh<Hh;++zh){const Uh=Wh[zh];if(Uh.constructor===LiteGraph$i.Subgraph&&$h!=="onExecute"){Uh.mode==Fh&&Uh.sendEventToAllNodes($h,Th,Fh);continue}!Uh[$h]||Uh.mode!==Fh||(Th===void 0?Uh[$h]():Array.isArray(Th)?Uh[$h].apply(Uh,Th):Uh[$h](Th))}},onAction($h,Th,Fh){this._input_nodes=this.findNodesByClass(LiteGraph$i.GraphInput,this._input_nodes);for(var Wh=0;Wh<this._input_nodes.length;++Wh){var zh=this._input_nodes[Wh];if(zh.properties.name==$h){zh.actionDo($h,Th,Fh);break}}},trigger($h,Th){var Fh;(Fh=this.onTrigger)==null||Fh.call(this,$h,Th)},beforeChange($h){var Th;(Th=this.onBeforeChange)==null||Th.call(this,this,$h),this.sendActionToCanvas("onBeforeChange",this)},afterChange($h){var Th;(Th=this.onAfterChange)==null||Th.call(this,this,$h),this.sendActionToCanvas("onAfterChange",this)},connectionChange($h){var Th;this.updateExecutionOrder(),(Th=this.onConnectionChange)==null||Th.call(this,$h),this.onGraphChanged({action:"connectionChange",doSave:!1}),this.sendActionToCanvas("onConnectionChange")}};let LiteGraph$h=null;function setSerializationLoadMethodsLiteGraph($h){LiteGraph$h=$h}const serializationLoadMethods={serialize(){var $h,Th;const Fh=this._nodes.map(qh=>qh.serialize());var Wh=[];for(var zh in this.links){var Hh=this.links[zh];if(!Hh.serialize){($h=LiteGraph$h.warn)==null||$h.call(LiteGraph$h,"weird LLink bug, link info is not a LLink but a regular object");var Uh=new LiteGraph$h.LLink;for(var Yh in Hh)Uh[Yh]=Hh[Yh];this.links[zh]=Uh,Hh=Uh}Wh.push(Hh.serialize())}const Xh=this._groups.map(qh=>qh.serialize());var jh={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:Fh,links:Wh,groups:Xh,config:this.config,extra:this.extra,version:LiteGraph$h.VERSION};return(Th=this.onSerialize)==null||Th.call(this,jh),jh},configure($h,Th){var Fh,Wh,zh,Hh,Uh;if($h){Th||this.clear();var Yh=$h.nodes;if($h.links&&$h.links.constructor===Array){for(var Xh=[],jh=0;jh<$h.links.length;++jh){var qh=$h.links[jh];if(!qh){(Fh=LiteGraph$h.warn)==null||Fh.call(LiteGraph$h,"serialized graph link data contains errors, skipping.");continue}var Vh=new LiteGraph$h.LLink;Vh.configure(qh),Xh[Vh.id]=Vh}$h.links=Xh}for(let Jh in $h)["nodes","groups"].includes(Jh)||(this[Jh]=$h[Jh]);var Zh=!1;this._configuring=!0;try{if(this._nodes=[],Yh){for(let Jh=0,td=Yh.length;Jh<td;++Jh){var Kh=Yh[Jh],Qh=LiteGraph$h.createNode(Kh.type,Kh.title);Qh||((Wh=LiteGraph$h.log)==null||Wh.call(LiteGraph$h,`Node not found or has errors: ${Kh.type}`),Qh=new LiteGraph$h.LGraphNode,Qh.last_serialization=Kh,Qh.has_errors=!0,Zh=!0),Qh.id=Kh.id,this.add(Qh,!0,{doProcessChange:!1})}Yh.forEach(Jh=>{const td=this.getNodeById(Jh.id);td==null||td.configure(Jh)})}this._groups.length=0,$h.groups&&$h.groups.forEach(Jh=>{const td=new LiteGraph$h.LGraphGroup;td.configure(Jh),this.add(td,!0,{doProcessChange:!1})})}finally{this._configuring=!1}return this.updateExecutionOrder(),this.extra=(zh=$h.extra)!=null?zh:{},(Hh=this.onConfigure)==null||Hh.call(this,$h),$h._version?(Uh=LiteGraph$h.debug)==null||Uh.call(LiteGraph$h,"skip onGraphChanged when configure passing version too!"):this.onGraphChanged({action:"graphConfigure",doSave:!1}),this.setDirtyCanvas(!0,!0),Zh}},load($h,Th){var Fh=this;if($h.constructor===File||$h.constructor===Blob){var Wh=new FileReader;Wh.addEventListener("load",Hh=>{var Uh=JSON.parse(Hh.target.result);Fh.configure(Uh),Th==null||Th()}),Wh.readAsText($h);return}var zh=new XMLHttpRequest;zh.open("GET",$h,!0),zh.send(null),zh.onload=Hh=>{var Uh;if(zh.status!==200){(Uh=LiteGraph$h.error)==null||Uh.call(LiteGraph$h,"Error loading graph:",zh.status,zh.response);return}var Yh=JSON.parse(zh.response);Fh.configure(Yh),Th==null||Th()},zh.onerror=Hh=>{var Uh;(Uh=LiteGraph$h.error)==null||Uh.call(LiteGraph$h,"Error loading graph:",Hh)}}};let LiteGraph$g=null;function setHistoryMethodsLiteGraph($h){LiteGraph$g=$h}const historyMethods={onGraphSaved($h={}){var Th={};Object.assign(Th,$h),this.savedVersion=this._version},onGraphLoaded($h={}){var Th={};Object.assign(Th,$h),this.savedVersion=this._version},onGraphChanged($h={}){var Th,Fh,Wh,zh,Hh,Uh,Yh={action:"",doSave:!0,doSaveGraph:!0},Xh=Object.assign(Yh,$h);if(!(this._configuring&&Xh.action!=="graphConfigure")&&(this._version++,Xh.action?(Th=LiteGraph$g.debug)==null||Th.call(LiteGraph$g,"Graph change",Xh.action):(Fh=LiteGraph$g.debug)==null||Fh.call(LiteGraph$g,"Graph change, no action",Xh),Xh.doSave&&LiteGraph$g.actionHistory_enabled)){(Wh=LiteGraph$g.debug)==null||Wh.call(LiteGraph$g,"onGraphChanged SAVE :: "+Xh.action);var jh={actionName:Xh.action};Xh.doSaveGraph&&(jh=Object.assign(jh,{graphSave:this.serialize()}));for(var qh=this.history;qh.actionHistoryPtr<qh.actionHistoryVersions.length-1;)(zh=LiteGraph$g.debug)==null||zh.call(LiteGraph$g,"popping: gone back? "+(qh.actionHistoryPtr+" < "+(qh.actionHistoryVersions.length-1))),qh.actionHistoryVersions.pop();if(qh.actionHistoryVersions.length>=LiteGraph$g.actionHistoryMaxSave){var Vh=qh.actionHistoryVersions.shift();(Hh=LiteGraph$g.debug)==null||Hh.call(LiteGraph$g,"maximum saves reached: "+qh.actionHistoryVersions.length+", remove older: "+Vh),qh.actionHistory[Vh]=!1}qh.actionHistoryPtr=qh.actionHistoryVersions.length,qh.actionHistoryVersions.push(qh.actionHistoryPtr),qh.actionHistory[qh.actionHistoryPtr]=jh,(Uh=LiteGraph$g.debug)==null||Uh.call(LiteGraph$g,"history saved: "+qh.actionHistoryPtr,jh.actionName)}},actionHistoryBack($h={}){var Th,Fh,Wh,zh,Hh,Uh={};Object.assign(Uh,$h);var Yh=this.history;return Yh.actionHistoryPtr!=null&&Yh.actionHistoryPtr>=0?(Yh.actionHistoryPtr--,(Th=LiteGraph$g.debug)==null||Th.call(LiteGraph$g,"history step back: "+Yh.actionHistoryPtr),this.actionHistoryLoad({iVersion:Yh.actionHistoryPtr})?((Wh=LiteGraph$g.debug)==null||Wh.call(LiteGraph$g,"history loaded back: "+Yh.actionHistoryPtr),(zh=LiteGraph$g.debug)==null||zh.call(LiteGraph$g,this.history),!0):((Fh=LiteGraph$g.warn)==null||Fh.call(LiteGraph$g,"historyLoad failed, restore pointer? "+Yh.actionHistoryPtr),Yh.actionHistoryPtr++,!1)):((Hh=LiteGraph$g.debug)==null||Hh.call(LiteGraph$g,"history is already at older state"),!1)},actionHistoryForward($h={}){var Th,Fh,Wh,zh,Hh={};Object.assign(Hh,$h);var Uh=this.history;return Uh.actionHistoryPtr<Uh.actionHistoryVersions.length?(Uh.actionHistoryPtr++,(Th=LiteGraph$g.debug)==null||Th.call(LiteGraph$g,"history step forward: "+Uh.actionHistoryPtr),this.actionHistoryLoad({iVersion:Uh.actionHistoryPtr})?((Wh=LiteGraph$g.debug)==null||Wh.call(LiteGraph$g,"history loaded forward: "+Uh.actionHistoryPtr),!0):((Fh=LiteGraph$g.warn)==null||Fh.call(LiteGraph$g,"historyLoad failed, restore pointer? "+Uh.actionHistoryPtr),Uh.actionHistoryPtr--,!1)):((zh=LiteGraph$g.debug)==null||zh.call(LiteGraph$g,"history is already at newer state"),!1)},actionHistoryLoad($h={}){var Th,Fh={iVersion:!1,backStep:!1},Wh=Object.assign(Fh,$h),zh=this.history;if(zh.actionHistory[Wh.iVersion]&&zh.actionHistory[Wh.iVersion].graphSave){var Hh=JSON.stringify(this.history);return this.configure(zh.actionHistory[Wh.iVersion].graphSave),this.history=JSON.parse(Hh),(Th=LiteGraph$g.debug)==null||Th.call(LiteGraph$g,"history loaded: "+Wh.iVersion,zh.actionHistory[Wh.iVersion].actionName),!0}else return!1}};function installLGraphDelegates($h,Th){$h.__delegates_installed||(setLifecycleMethodsLiteGraph(Th),setCanvasBindingMethodsLiteGraph(Th),setRuntimeLoopMethodsLiteGraph(Th),setExecutionOrderMethodsLiteGraph(Th),setNodeMutationMethodsLiteGraph(Th),setGraphPortsMethodsLiteGraph(Th),setGraphEventsMethodsLiteGraph(Th),setSerializationLoadMethodsLiteGraph(Th),setHistoryMethodsLiteGraph(Th),[lifecycleMethods,canvasBindingMethods,runtimeLoopMethods,executionOrderMethods,nodeMutationMethods,nodeQueryMethods,graphPortsMethods,graphEventsMethods,serializationLoadMethods,historyMethods].forEach(Fh=>{Object.entries(Fh).forEach(([Wh,zh])=>{Object.defineProperty($h.prototype,Wh,{value:zh,writable:!0,configurable:!0})})}),Object.defineProperty($h,"__delegates_installed",{value:!0,writable:!1,configurable:!1}))}class LGraph{constructor(Th){var Fh;(Fh=LiteGraph.log)==null||Fh.call(LiteGraph,"Graph created"),this.list_of_graphcanvas=null,this.clear(),Th&&this.configure(Th)}}Yl(LGraph,"supported_types",["number","string","boolean"]),Yl(LGraph,"STATUS_STOPPED",1),Yl(LGraph,"STATUS_RUNNING",2);function setupLGraphDelegates($h=LiteGraph){installLGraphDelegates(LGraph,$h)}let LiteGraph$f=null;function setLifecycleSerializationMethodsLiteGraph($h){LiteGraph$f=$h}const lifecycleSerializationMethods={configure($h){var Th,Fh,Wh,zh,Hh;Object.entries($h).forEach(([Uh,Yh])=>{var Xh;if(Uh==="properties"){for(var jh in Yh)this.properties[jh]=Yh[jh],(Xh=this.onPropertyChanged)==null||Xh.call(this,jh,Yh[jh]);return}Yh!==null&&(typeof Yh=="object"?this[Uh]&&this[Uh].configure?this[Uh].configure(Yh):this[Uh]=LiteGraph$f.cloneObject(Yh,this[Uh]):this[Uh]=Yh)}),$h.title||(this.title=this.constructor.title),(Th=this.inputs)==null||Th.forEach((Uh,Yh)=>{var Xh,jh;if(!Uh.link)return;const qh=this.graph?this.graph.links[Uh.link]:null;(Xh=this.onConnectionsChange)==null||Xh.call(this,LiteGraph$f.INPUT,Yh,!0,qh,Uh),(jh=this.onInputAdded)==null||jh.call(this,Uh)}),(Fh=this.outputs)==null||Fh.forEach((Uh,Yh)=>{var Xh;Uh.links&&(Uh.links.forEach(()=>{var jh;const qh=this.graph;(jh=this.onConnectionsChange)==null||jh.call(this,LiteGraph$f.OUTPUT,Yh,!0,qh,Uh)}),(Xh=this.onOutputAdded)==null||Xh.call(this,Uh))}),this.widgets&&(this.widgets.forEach(Uh=>{Uh&&Uh.options&&Uh.options.property&&this.properties[Uh.options.property]!==void 0&&(Uh.value=JSON.parse(JSON.stringify(this.properties[Uh.options.property])))}),(Wh=$h.widgets_values)==null||Wh.forEach((Uh,Yh)=>{this.widgets[Yh]&&(this.widgets[Yh].value=Uh)})),(zh=this.onConfigure)==null||zh.call(this,$h),(Hh=this.graph)==null||Hh.onGraphChanged({action:"nodeConfigure",doSave:!1})},serialize(){var $h,Th,Fh,Wh={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph$f.cloneObject(this.flags),order:this.order,mode:this.mode};return this.constructor===LiteGraph$f.LGraphNode&&this.last_serialization?this.last_serialization:(this.inputs&&(Wh.inputs=LiteGraph$f.cloneObject(this.inputs)),this.outputs&&(this.outputs.forEach(zh=>{delete zh._data}),Wh.outputs=LiteGraph$f.cloneObject(this.outputs)),this.title&&this.title!=this.constructor.title&&(Wh.title=this.title),this.properties&&(Wh.properties=LiteGraph$f.cloneObject(this.properties)),this.widgets&&this.serialize_widgets&&(Wh.widgets_values=this.widgets.map(zh=>{var Hh;return(Hh=zh==null?void 0:zh.value)!=null?Hh:null})),($h=Wh.type)!=null||(Wh.type=this.constructor.type),this.color&&(Wh.color=this.color),this.bgcolor&&(Wh.bgcolor=this.bgcolor),this.boxcolor&&(Wh.boxcolor=this.boxcolor),this.shape&&(Wh.shape=this.shape),(Th=this.onSerialize)!=null&&Th.call(this,Wh)&&((Fh=LiteGraph$f.warn)==null||Fh.call(LiteGraph$f,"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter")),Wh)},clone(){var $h,Th,Fh=LiteGraph$f.createNode(this.type);if(!Fh)return null;var Wh=LiteGraph$f.cloneObject(this.serialize());return($h=Wh.inputs)==null||$h.forEach(zh=>{zh.link=null}),(Th=Wh.outputs)==null||Th.forEach(zh=>{zh.links&&(zh.links.length=0)}),delete Wh.id,LiteGraph$f.use_uuids&&(Wh.id=LiteGraph$f.uuidv4()),Fh.configure(Wh),Fh},toString(){return JSON.stringify(this.serialize())},getTitle(){var $h;return($h=this.title)!=null?$h:this.constructor.title}};let LiteGraph$e=null;function setPropertiesWidgetsMethodsLiteGraph($h){LiteGraph$e=$h}const propertiesWidgetsMethods={setProperty($h,Th){var Fh,Wh;if(this.properties||(this.properties={}),Th===this.properties[$h])return;const zh=this.properties[$h];this.properties[$h]=Th,((Fh=this.onPropertyChanged)==null?void 0:Fh.call(this,$h,Th,zh))===!1&&(this.properties[$h]=zh);const Hh=(Wh=this.widgets)==null?void 0:Wh.find(Uh=>{var Yh;return Uh&&((Yh=Uh.options)==null?void 0:Yh.property)===$h});Hh&&(Hh.value=Th)},addProperty($h,Th,Fh,Wh){var zh,Hh;const Uh={name:$h,type:Fh,default_value:Th,...Wh};return this.properties_info=(zh=this.properties_info)!=null?zh:[],this.properties_info.push(Uh),this.properties=(Hh=this.properties)!=null?Hh:{},this.properties[$h]=Th,Uh},getPropertyInfo($h){var Th=null;if(this.properties_info){for(var Fh=0;Fh<this.properties_info.length;++Fh)if(this.properties_info[Fh].name==$h){Th=this.properties_info[Fh];break}}return this.constructor[`@${$h}`]&&(Th=this.constructor[`@${$h}`]),this.constructor.widgets_info&&this.constructor.widgets_info[$h]&&(Th=this.constructor.widgets_info[$h]),!Th&&this.onGetPropertyInfo&&(Th=this.onGetPropertyInfo($h)),Th||(Th={}),Th.type||(Th.type=typeof this.properties[$h]),Th.widget=="combo"&&(Th.type="enum"),Th},addWidget($h,Th,Fh,Wh,zh){var Hh,Uh,Yh;(Hh=this.widgets)!=null||(this.widgets=[]),!zh&&Wh&&Wh.constructor===Object&&(zh=Wh,Wh=null),zh&&zh.constructor===String&&(zh={property:zh}),Wh&&Wh.constructor===String&&(zh!=null||(zh={}),zh.property=Wh,Wh=null),Wh&&Wh.constructor!==Function&&((Uh=LiteGraph$e.warn)==null||Uh.call(LiteGraph$e,"addWidget: callback must be a function"),Wh=null);var Xh={type:$h.toLowerCase(),name:Th,value:Fh,callback:Wh,options:zh||{}};if(Xh.options.y!==void 0&&(Xh.y=Xh.options.y),!Wh&&!Xh.options.callback&&!Xh.options.property&&((Yh=LiteGraph$e.warn)==null||Yh.call(LiteGraph$e,"LiteGraph addWidget(...) without a callback or property assigned")),$h=="combo"&&!Xh.options.values)throw Error("LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }");return this.widgets.push(Xh),this.setSize(this.computeSize()),Xh},addCustomWidget($h){var Th;return(Th=this.widgets)!=null||(this.widgets=[]),this.widgets.push($h),$h}},ioDataMethods={setOutputData($h,Th){var Fh;if(this.outputs){if(($h==null?void 0:$h.constructor)===String)$h=this.findOutputSlot($h);else if($h==-1||$h>=this.outputs.length)return;var Wh=this.outputs[$h];Wh&&(Wh._data=Th,(Fh=this.outputs[$h].links)==null||Fh.forEach(zh=>{const Hh=this.graph.links[zh];Hh&&(Hh.data=Th)}))}},setOutputDataType($h,Th){var Fh,Wh;if(this.outputs&&!($h==-1||$h>=this.outputs.length)){var zh=this.outputs[$h];zh&&(zh.type=Th,(Wh=(Fh=this.outputs[$h])==null?void 0:Fh.links)==null||Wh.forEach(Hh=>{this.graph.links[Hh]&&(this.graph.links[Hh].type=Th)}))}},getInputData($h,Th,Fh){var Wh;if(this.inputs&&!($h>=this.inputs.length||this.inputs[$h].link==null)){var zh=this.inputs[$h].link,Hh=this.graph.links[zh];if(!Hh)return null;if(!Th)return Hh.data;var Uh=this.graph.getNodeById(Hh.origin_id);if(!Uh)return Hh.data;if(Fh){var Yh=this.id+"_getInputData_forced_"+Math.floor(Math.random()*9999),Xh={action:Yh,options:{action_call:Yh}};this.refreshAncestors(Xh)}return Uh.updateOutputData?Uh.updateOutputData(Hh.origin_slot):(Wh=Uh.doExecute)==null||Wh.call(Uh),Hh.data}},getInputDataType($h){if(!this.inputs||$h>=this.inputs.length||this.inputs[$h].link==null)return null;var Th=this.inputs[$h].link,Fh=this.graph.links[Th];if(!Fh)return null;var Wh=this.graph.getNodeById(Fh.origin_id);if(!Wh)return Fh.type;var zh=Wh.outputs[Fh.origin_slot];return zh?zh.type:null},getInputDataByName($h,Th){var Fh=this.findInputSlot($h);return Fh==-1?null:this.getInputData(Fh,Th)},isInputConnected($h){return this.inputs?$h<this.inputs.length&&this.inputs[$h].link!=null:!1},getInputInfo($h){return this.inputs&&$h<this.inputs.length?this.inputs[$h]:null},getInputLink($h){if(!this.inputs)return null;if($h<this.inputs.length){var Th=this.inputs[$h];return this.graph.links[Th.link]}return null},getInputNode($h){if(!this.inputs||$h>=this.inputs.length)return null;var Th=this.inputs[$h];if(!Th||Th.link===null)return null;var Fh=this.graph.links[Th.link];return Fh?this.graph.getNodeById(Fh.origin_id):null},getInputOrProperty($h){if(this.inputs)for(var Th=0,Fh=this.inputs.length;Th<Fh;++Th){var Wh=this.inputs[Th];if($h==Wh.name&&Wh.link!=null){var zh=this.graph.links[Wh.link];if(zh)return zh.data}}return this.properties?this.properties[$h]:null},getOutputData($h){if(!this.outputs||$h>=this.outputs.length)return null;var Th=this.outputs[$h];return Th._data},getOutputInfo($h){return this.outputs&&$h<this.outputs.length?this.outputs[$h]:null},isOutputConnected($h){return this.outputs?$h<this.outputs.length&&this.outputs[$h].links&&this.outputs[$h].links.length:!1},isAnyOutputConnected(){return this.outputs?this.outputs.some($h=>$h.links&&$h.links.length):!1},getOutputNodes($h){if(!this.outputs||$h>=this.outputs.length)return null;const Th=this.outputs[$h];return!Th.links||Th.links.length===0?null:Th.links.map(Fh=>this.graph.links[Fh]).filter(Fh=>Fh).map(Fh=>this.graph.getNodeById(Fh.target_id)).filter(Fh=>Fh)}};let LiteGraph$d=null;function setExecutionActionsMethodsLiteGraph($h){LiteGraph$d=$h}const executionActionsMethods={addOnTriggerInput(){var $h=this.findInputSlot("onTrigger");return $h==-1?(this.addInput("onTrigger",LiteGraph$d.EVENT,{removable:!0,nameLocked:!0}),this.findInputSlot("onTrigger")):$h},addOnExecutedOutput(){var $h=this.findOutputSlot("onExecuted");return $h==-1?(this.addOutput("onExecuted",LiteGraph$d.ACTION,{removable:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")):$h},onAfterExecuteNode($h,Th){var Fh,Wh=this.findOutputSlot("onExecuted");Wh!=-1&&((Fh=LiteGraph$d.debug)==null||Fh.call(LiteGraph$d,this.id+":"+this.order+" triggering slot onAfterExecute",$h,Th),this.triggerSlot(Wh,$h,null,Th))},changeMode($h){switch($h){case LiteGraph$d.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph$d.ON_EVENT:break;case LiteGraph$d.NEVER:break;case LiteGraph$d.ALWAYS:break;case LiteGraph$d.ON_REQUEST:break;default:return!1}return this.mode=$h,!0},executePendingActions(){!this._waiting_actions||!this._waiting_actions.length||(this._waiting_actions.forEach($h=>{this.onAction($h[0],$h[1],$h[2],$h[3],$h[4])}),this._waiting_actions.length=0)},doExecute($h,Th={}){var Fh,Wh,zh,Hh,Uh;if(this.onExecute){if((Fh=Th.action_call)!=null||(Th.action_call=`${this.id}_exec_${Math.floor(Math.random()*9999)}`),this.graph.nodes_executing&&this.graph.nodes_executing[this.id]){(Wh=LiteGraph$d.debug)==null||Wh.call(LiteGraph$d,"NODE already executing! Prevent! "+this.id+":"+this.order);return}if(LiteGraph$d.ensureNodeSingleExecution&&this.exec_version&&this.exec_version>=this.graph.iteration&&this.exec_version!==void 0){(zh=LiteGraph$d.debug)==null||zh.call(LiteGraph$d,"!! NODE already EXECUTED THIS STEP !! "+this.exec_version);return}if(LiteGraph$d.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&Th&&Th.action_call&&this.graph.nodes_executedAction[this.id]==Th.action_call){(Hh=LiteGraph$d.debug)==null||Hh.call(LiteGraph$d,"!! NODE already ACTION THIS STEP !! "+Th.action_call);return}this.graph.nodes_executing[this.id]=!0,this.onExecute($h,Th),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,Th&&Th.action_call&&(this.action_call=Th.action_call,this.graph.nodes_executedAction[this.id]=Th.action_call)}this.execute_triggered=2,(Uh=this.onAfterExecuteNode)==null||Uh.call(this,$h,Th)},execute($h,Th={}){return this.doExecute($h,Th)},actionDo($h,Th,Fh={},Wh){var zh,Hh,Uh,Yh;if(this.onAction){if((zh=Fh.action_call)!=null||(Fh.action_call=`${this.id}_${$h||"action"}_${Math.floor(Math.random()*9999)}`),LiteGraph$d.ensureNodeSingleAction&&this.graph.nodes_actioning&&this.graph.nodes_actioning[this.id]==Fh.action_call)return;if((Hh=LiteGraph$d.debug)==null||Hh.call(LiteGraph$d,"CheckActioned ? "+this.id+":"+this.order+" :: "+this.action_call),LiteGraph$d.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&Fh&&Fh.action_call&&this.graph.nodes_executedAction[this.id]==Fh.action_call){(Uh=LiteGraph$d.debug)==null||Uh.call(LiteGraph$d,"!! NODE already ACTION THIS STEP !! "+Fh.action_call),\u00E7;return}this.graph.nodes_actioning[this.id]=$h||"actioning",this.onAction($h,Th,Fh,Wh),this.graph.nodes_actioning[this.id]=!1,Fh&&Fh.action_call&&(this.action_call=Fh.action_call,this.graph.nodes_executedAction[this.id]=Fh.action_call)}this.action_triggered=2,(Yh=this.onAfterExecuteNode)==null||Yh.call(this,Th,Fh)},trigger($h,Th,Fh){!this.outputs||this.outputs.length===0||(this.graph&&(this.graph._last_trigger_time=LiteGraph$d.getTime()),this.outputs.forEach((Wh,zh)=>{Wh&&Wh.type===LiteGraph$d.EVENT&&(!$h||Wh.name===$h)&&this.triggerSlot(zh,Th,null,Fh)}))},triggerSlot($h,Th,Fh,Wh={}){var zh,Hh,Uh,Yh;if(this.outputs){if($h==null){(zh=LiteGraph$d.error)==null||zh.call(LiteGraph$d,"triggerSlot","slot must be a number");return}$h.constructor!==Number&&((Hh=LiteGraph$d.warn)==null||Hh.call(LiteGraph$d,"triggerSlot","slot must be a number, use node.trigger('name') if you want to use a string"));var Xh=this.outputs[$h];if(Xh){var jh=Xh.links;if(!(!jh||!jh.length)&&!(this.graph&&this.graph.ancestorsCall)){this.graph&&(this.graph._last_trigger_time=LiteGraph$d.getTime());for(var qh=0;qh<jh.length;++qh){var Vh=jh[qh];if(!(Fh!=null&&Fh!=Vh)){var Zh=this.graph.links[jh[qh]];if(Zh){Zh._last_time=LiteGraph$d.getTime();var Kh=this.graph.getNodeById(Zh.target_id);if(Kh){if(Kh.mode===LiteGraph$d.ON_TRIGGER)Wh.action_call||(Wh.action_call=`${this.id}_trigg_${Math.floor(Math.random()*9999)}`),LiteGraph$d.refreshAncestorsOnTriggers&&Kh.refreshAncestors({action:"trigger",param:Th,options:Wh}),Kh.onExecute&&Kh.doExecute(Th,Wh);else if(Kh.onAction){Wh.action_call||(Wh.action_call=`${this.id}_act_${Math.floor(Math.random()*9999)}`);let Qh=Kh.inputs[Zh.target_slot];(Uh=LiteGraph$d.debug)==null||Uh.call(LiteGraph$d,"triggerSlot","will call onACTION: "+this.id+":"+this.order+" :: "+Qh.name),LiteGraph$d.refreshAncestorsOnActions&&Kh.refreshAncestors({action:Qh.name,param:Th,options:Wh}),LiteGraph$d.use_deferred_actions&&Kh.onExecute?((Yh=Kh._waiting_actions)!=null||(Kh._waiting_actions=[]),Kh._waiting_actions.push([Qh.name,Th,Wh,Zh.target_slot])):Kh.actionDo(Qh.name,Th,Wh,Zh.target_slot)}}}}}}}}},clearTriggeredSlot($h,Th){!this.outputs||!this.outputs[$h]||!this.outputs[$h].links||this.outputs[$h].links.forEach(Fh=>{if(Th!==null&&Th!==Fh)return;const Wh=this.graph.links[Fh];Wh&&(Wh._last_time=0)})}};let LiteGraph$c=null;function setSlotsMutationMethodsLiteGraph($h){LiteGraph$c=$h}const slotsMutationMethods={setSize($h){var Th;this.size=$h,(Th=this.onResize)==null||Th.call(this,this.size)},addInput($h,Th,Fh){return this.addSlot($h,Th,Fh,!0)},addOutput($h,Th,Fh){return this.addSlot($h,Th,Fh,!1)},addSlot($h,Th,Fh,Wh){var zh,Hh,Uh,Yh;const Xh=Wh?{name:$h,type:Th,link:null,...Fh}:{name:$h,type:Th,links:null,...Fh};return Wh?(this.inputs=(zh=this.inputs)!=null?zh:[],this.inputs.push(Xh),(Hh=this.onInputAdded)==null||Hh.call(this,Xh),LiteGraph$c.registerNodeAndSlotType(this,Th)):(this.outputs=(Uh=this.outputs)!=null?Uh:[],this.outputs.push(Xh),(Yh=this.onOutputAdded)==null||Yh.call(this,Xh),LiteGraph$c.auto_load_slot_types&&LiteGraph$c.registerNodeAndSlotType(this,Th,!0)),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),Xh},addInputs($h){this.addSlots($h,!0)},addOutputs($h){this.addSlots($h,!1)},addSlots($h,Th){var Fh;typeof $h=="string"&&($h=[$h]),$h.forEach(Wh=>{var zh,Hh,Uh,Yh,Xh,jh;const qh=Th?{name:Wh[0],type:Wh[1],link:null,...(zh=Wh[2])!=null?zh:{}}:{name:Wh[0],type:Wh[1],links:null,...(Hh=Wh[2])!=null?Hh:{}};Th?(this.inputs=(Uh=this.inputs)!=null?Uh:[],this.inputs.push(qh),(Yh=this.onInputAdded)==null||Yh.call(this,qh),LiteGraph$c.registerNodeAndSlotType(this,Wh[1])):(this.outputs=(Xh=this.outputs)!=null?Xh:[],this.outputs.push(qh),(jh=this.onOutputAdded)==null||jh.call(this,qh),LiteGraph$c.auto_load_slot_types&&LiteGraph$c.registerNodeAndSlotType(this,Wh[1],!0))}),this.setSize(this.computeSize()),(Fh=this.setDirtyCanvas)==null||Fh.call(this,!0,!0)},removeInput($h){var Th;this.disconnectInput($h);const Fh=this.inputs.splice($h,1)[0];this.inputs.slice($h).filter(Wh=>!!Wh).forEach(Wh=>{const zh=this.graph.links[Wh.link];zh!=null&&zh.target_slot&&zh.target_slot--}),this.setSize(this.computeSize()),(Th=this.onInputRemoved)==null||Th.call(this,$h,Fh),this.setDirtyCanvas(!0,!0)},removeOutput($h){var Th;this.disconnectOutput($h),this.outputs=this.outputs.filter((Fh,Wh)=>Wh!==$h),this.outputs.slice($h).forEach(Fh=>{!Fh||!Fh.links||Fh.links.forEach(Wh=>{const zh=this.graph.links[Wh];zh&&(zh.origin_slot-=1)})}),this.setSize(this.computeSize()),(Th=this.onOutputRemoved)==null||Th.call(this,$h),this.setDirtyCanvas(!0,!0)},addConnection($h,Th,Fh,Wh){var zh={name:$h,type:Th,pos:Fh,direction:Wh,links:null};return this.connections.push(zh),zh}};let LiteGraph$b=null;function setSlotsQueryMethodsLiteGraph($h){LiteGraph$b=$h}const slotsQueryMethods={findInputSlot($h,Th){if(!this.inputs)return-1;for(var Fh=0,Wh=this.inputs.length;Fh<Wh;++Fh)if($h==this.inputs[Fh].name)return Th?this.inputs[Fh]:Fh;return-1},findOutputSlot($h,Th=!1){if(!this.outputs)return-1;for(var Fh=0,Wh=this.outputs.length;Fh<Wh;++Fh)if($h==this.outputs[Fh].name)return Th?this.outputs[Fh]:Fh;return-1},findInputSlotFree($h={}){var Th={returnObj:!1,typesNotAccepted:[]},Fh=Object.assign(Th,$h);if(!this.inputs)return-1;for(var Wh=0,zh=this.inputs.length;Wh<zh;++Wh)if(!(this.inputs[Wh].link&&this.inputs[Wh].link!=null)&&!(Fh.typesNotAccepted&&Fh.typesNotAccepted.includes&&Fh.typesNotAccepted.includes(this.inputs[Wh].type)))return Fh.returnObj?this.inputs[Wh]:Wh;return-1},findOutputSlotFree($h={}){var Th={returnObj:!1,typesNotAccepted:[]},Fh=Object.assign(Th,$h);if(!this.outputs)return-1;for(let Wh=0,zh=this.outputs.length;Wh<zh;++Wh)if(!(this.outputs[Wh].links&&this.outputs[Wh].links!=null)&&!(Fh.typesNotAccepted&&Fh.typesNotAccepted.includes&&Fh.typesNotAccepted.includes(this.outputs[Wh].type)))return Fh.returnObj?this.outputs[Wh]:Wh;return-1},findInputSlotByType($h,Th,Fh,Wh){return this.findSlotByType(!0,$h,Th,Fh,Wh)},findOutputSlotByType($h,Th,Fh,Wh){return this.findSlotByType(!1,$h,Th,Fh,Wh)},findSlotByType($h=!1,Th,Fh=!1,Wh=!1,zh=!1){var Hh=$h?this.inputs:this.outputs;if(!Hh)return-1;(Th==""||Th=="*")&&(Th=0);for(let Uh=0,Yh=Hh.length;Uh<Yh;++Uh){let Xh=(Th+"").toLowerCase().split(","),jh=Hh[Uh].type=="0"||Hh[Uh].type=="*"?"0":Hh[Uh].type;jh=(jh+"").toLowerCase().split(",");for(let qh=0;qh<Xh.length;qh++)for(let Vh=0;Vh<jh.length;Vh++)if(Xh[qh]=="_event_"&&(Xh[qh]=LiteGraph$b.EVENT),jh[qh]=="_event_"&&(jh[qh]=LiteGraph$b.EVENT),Xh[qh]=="*"&&(Xh[qh]=0),jh[qh]=="*"&&(jh[qh]=0),Xh[qh]==jh[Vh]){if(Wh&&Hh[Uh].links&&Hh[Uh].links!==null)continue;return Fh?Hh[Uh]:Uh}}if(Wh&&!zh)for(let Uh=0,Yh=Hh.length;Uh<Yh;++Uh){let Xh=(Th+"").toLowerCase().split(","),jh=Hh[Uh].type=="0"||Hh[Uh].type=="*"?"0":Hh[Uh].type;jh=(jh+"").toLowerCase().split(",");for(let qh=0;qh<Xh.length;qh++)for(let Vh=0;Vh<jh.length;Vh++)if(Xh[qh]=="*"&&(Xh[qh]=0),jh[qh]=="*"&&(jh[qh]=0),Xh[qh]==jh[Vh])return Fh?Hh[Uh]:Uh}return-1},getSlotInPosition($h,Th){var Fh=new Float32Array(2);if(this.inputs)for(let Wh=0,zh=this.inputs.length;Wh<zh;++Wh){let Hh=this.inputs[Wh];if(this.getConnectionPos(!0,Wh,Fh),LiteGraph$b.isInsideRectangle($h,Th,Fh[0]-10,Fh[1]-5,20,10))return{input:Hh,slot:Wh,link_pos:Fh}}if(this.outputs)for(let Wh=0,zh=this.outputs.length;Wh<zh;++Wh){let Hh=this.outputs[Wh];if(this.getConnectionPos(!1,Wh,Fh),LiteGraph$b.isInsideRectangle($h,Th,Fh[0]-10,Fh[1]-5,20,10))return{output:Hh,slot:Wh,link_pos:Fh}}return null}};let LiteGraph$a=null;function setConnectionsMethodsLiteGraph($h){LiteGraph$a=$h}const connectionsMethods={connectByType($h,Th,Fh="*",Wh={}){var zh,Hh,Uh,Yh,Xh,jh={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},qh=Object.assign(jh,Wh);Th&&Th.constructor===Number&&(Th=this.graph.getNodeById(Th));var Vh=Th.findInputSlotByType(Fh,!1,!0);return Vh>=0&&Vh!==null?((zh=LiteGraph$a.debug)==null||zh.call(LiteGraph$a,"CONNbyTYPE type "+Fh+" for "+Vh),this.connect($h,Th,Vh)):qh.createEventInCase&&Fh==LiteGraph$a.EVENT?((Hh=LiteGraph$a.debug)==null||Hh.call(LiteGraph$a,"connect WILL CREATE THE onTrigger "+Fh+" to "+Th),this.connect($h,Th,-1)):qh.generalTypeInCase&&(Vh=Th.findInputSlotByType(0,!1,!0,!0),(Uh=LiteGraph$a.debug)==null||Uh.call(LiteGraph$a,"connect TO a general type (*, 0), if not found the specific type ",Fh," to ",Th,"RES_SLOT:",Vh),Vh>=0)?this.connect($h,Th,Vh):qh.firstFreeIfOutputGeneralInCase&&(Fh==0||Fh=="*"||Fh=="")&&(Vh=Th.findInputSlotFree({typesNotAccepted:[LiteGraph$a.EVENT]}),(Yh=LiteGraph$a.debug)==null||Yh.call(LiteGraph$a,"connect TO TheFirstFREE ",Fh," to ",Th,"RES_SLOT:",Vh),Vh>=0)?this.connect($h,Th,Vh):((Xh=LiteGraph$a.debug)==null||Xh.call(LiteGraph$a,"no way to connect type: ",Fh," to targetNODE ",Th),null)},connectByTypeOutput($h,Th,Fh="*",Wh={}){var zh,Hh,Uh,Yh={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},Xh=Object.assign(Yh,Wh);Th&&Th.constructor===Number&&(Th=this.graph.getNodeById(Th));var jh=Th.findOutputSlotByType(Fh,!1,!0);return jh>=0&&jh!==null?((zh=LiteGraph$a.debug)==null||zh.call(LiteGraph$a,"CONNbyTYPE OUT! type "+Fh+" for "+jh),Th.connect(jh,this,$h)):Xh.generalTypeInCase&&(jh=Th.findOutputSlotByType(0,!1,!0,!0),jh>=0)?Th.connect(jh,this,$h):Xh.createEventInCase&&Fh==LiteGraph$a.EVENT&&LiteGraph$a.do_add_triggers_slots?(jh=Th.addOnExecutedOutput(),Th.connect(jh,this,$h)):Xh.firstFreeIfInputGeneralInCase&&(Fh==0||Fh=="*"||Fh==""||Fh=="undefined")&&(jh=Th.findOutputSlotFree({typesNotAccepted:[LiteGraph$a.EVENT]}),jh>=0)?Th.connect(jh,this,$h):((Hh=LiteGraph$a.debug)==null||Hh.call(LiteGraph$a,"no way to connect byOUT type: ",Fh," to sourceNODE ",Th),(Uh=LiteGraph$a.log)==null||Uh.call(LiteGraph$a,"type OUT! "+Fh+" not found or not free?"),null)},connect($h,Th,Fh=0){var Wh,zh,Hh,Uh,Yh,Xh,jh,qh,Vh,Zh,Kh,Qh,Jh,td;if(!this.graph)return(Wh=LiteGraph$a.log)==null||Wh.call(LiteGraph$a,"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if($h.constructor===String){if($h=this.findOutputSlot($h),$h==-1)return(zh=LiteGraph$a.log)==null||zh.call(LiteGraph$a,`Connect: Error, no slot of name ${$h}`),null}else if(!this.outputs||$h>=this.outputs.length)return(Hh=LiteGraph$a.log)==null||Hh.call(LiteGraph$a,"Connect: Error, slot number not found"),null;if(Th&&Th.constructor===Number&&(Th=this.graph.getNodeById(Th)),!Th)throw new Error("target node is null");if(Th==this)return null;if(Fh.constructor===String){if(Fh=Th.findInputSlot(Fh),Fh==-1)return(Uh=LiteGraph$a.log)==null||Uh.call(LiteGraph$a,`Connect: Error, no slot of name ${Fh}`),null}else if(Fh===LiteGraph$a.EVENT)if(LiteGraph$a.do_add_triggers_slots)Th.changeMode(LiteGraph$a.ON_TRIGGER),Fh=Th.findInputSlot("onTrigger");else return null;else if(!Th.inputs||Fh>=Th.inputs.length)return(Yh=LiteGraph$a.log)==null||Yh.call(LiteGraph$a,"Connect: Error, slot number not found"),null;var ed=!1,id=Th.inputs[Fh],sd=null,nd=this.outputs[$h];if(!this.outputs[$h])return(Xh=LiteGraph$a.log)==null||Xh.call(LiteGraph$a,"Invalid slot passed: ",$h,this.outputs),null;if(Th.onBeforeConnectInput&&(Fh=Th.onBeforeConnectInput(Th)),((jh=this.onConnectOutput)==null?void 0:jh.call(this,$h,id.type,id,Th,Fh))===!1)return null;if(Fh===!1||Fh===null||!LiteGraph$a.isValidConnection(nd.type,id.type))return this.setDirtyCanvas(!1,!0),ed&&this.graph.connectionChange(this,sd),null;if((qh=LiteGraph$a.debug)==null||qh.call(LiteGraph$a,"DBG targetSlot",Fh),((Vh=Th.onConnectInput)==null?void 0:Vh.call(Th,Fh,nd.type,nd,this,$h))===!1||((Zh=this.onConnectOutput)==null?void 0:Zh.call(this,$h,id.type,id,Th,Fh))===!1)return null;Th.inputs[Fh]&&Th.inputs[Fh].link!=null&&(this.graph.beforeChange(),Th.disconnectInput(Fh,{doProcessChange:!1}),ed=!0),(Kh=nd.links)!=null&&Kh.length&&nd.type===LiteGraph$a.EVENT&&(LiteGraph$a.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput($h,!1,{doProcessChange:!1}),ed=!0));var hd;return LiteGraph$a.use_uuids?hd=LiteGraph$a.uuidv4():hd=++this.graph.last_link_id,sd=new LiteGraph$a.LLink(hd,id.type||nd.type,this.id,$h,Th.id,Fh),this.graph.links[sd.id]=sd,nd.links==null&&(nd.links=[]),nd.links.push(sd.id),!Th.inputs||typeof Th.inputs[Fh]=="undefined"?((Qh=LiteGraph$a.warn)==null||Qh.call(LiteGraph$a,"connect aborted: target slot does not exist on target node",Th,Fh),nd.links.pop(),delete this.graph.links[sd.id],null):(Th.inputs[Fh].link=sd.id,(Jh=this.onConnectionsChange)==null||Jh.call(this,LiteGraph$a.OUTPUT,$h,!0,sd,nd),(td=Th.onConnectionsChange)==null||td.call(Th,LiteGraph$a.INPUT,Fh,!0,sd,id),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,Th,Fh,this,$h),this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,$h,Th,Fh)),this.graph.onGraphChanged({action:"connect"}),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,sd),sd)},disconnectOutput($h,Th,Fh={}){var Wh,zh,Hh,Uh,Yh,Xh,jh={doProcessChange:!0},qh=Object.assign(jh,Fh);if($h.constructor===String){if($h=this.findOutputSlot($h),$h==-1)return(Wh=LiteGraph$a.log)==null||Wh.call(LiteGraph$a,`Connect: Error, no slot of name ${$h}`),!1}else if(!this.outputs||$h>=this.outputs.length)return(zh=LiteGraph$a.log)==null||zh.call(LiteGraph$a,"Connect: Error, slot number not found"),!1;var Vh=this.outputs[$h];if(!Vh||!Vh.links||Vh.links.length==0)return!1;if(Th){if(Th.constructor===Number&&(Th=this.graph.getNodeById(Th)),!Th)throw new Error("Target Node not found");for(let Kh=0,Qh=Vh.links.length;Kh<Qh;Kh++){let Jh=Vh.links[Kh],td=this.graph.links[Jh];if(td.target_id==Th.id){Vh.links.splice(Kh,1);var Zh=Th.inputs[td.target_slot];Zh.link=null,delete this.graph.links[Jh],(Hh=this.graph)==null||Hh.onGraphChanged({action:"disconnectOutput",doSave:qh.doProcessChange}),(Uh=Th.onConnectionsChange)==null||Uh.call(Th,LiteGraph$a.INPUT,td.target_slot,!1,td,Zh),(Yh=this.onConnectionsChange)==null||Yh.call(this,LiteGraph$a.OUTPUT,$h,!1,td,Vh),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,$h),this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,$h),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,Th,td.target_slot));break}}}else{for(let Kh=0,Qh=Vh.links.length;Kh<Qh;Kh++){let Jh=Vh.links[Kh],td=this.graph.links[Jh];td&&(Th=this.graph.getNodeById(td.target_id),Zh=null,(Xh=this.graph)==null||Xh.onGraphChanged({action:"disconnectOutput",doSave:qh.doProcessChange}),Th&&(Zh=Th.inputs[td.target_slot],Zh.link=null,Th.onConnectionsChange&&Th.onConnectionsChange(LiteGraph$a.INPUT,td.target_slot,!1,td,Zh),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,Th,td.target_slot)),delete this.graph.links[Jh],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$a.OUTPUT,$h,!1,td,Vh),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,this,$h),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,Th,td.target_slot)))}Vh.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},disconnectInput($h,Th={}){var Fh,Wh,zh,Hh={doProcessChange:!0},Uh=Object.assign(Hh,Th);if($h.constructor===String){if($h=this.findInputSlot($h),$h==-1)return(Fh=LiteGraph$a.log)==null||Fh.call(LiteGraph$a,`Connect: Error, no slot of name ${$h}`),!1}else if(!this.inputs||$h>=this.inputs.length)return(Wh=LiteGraph$a.log)==null||Wh.call(LiteGraph$a,"Connect: Error, slot number not found"),!1;var Yh=this.inputs[$h];if(!Yh)return!1;var Xh=this.inputs[$h].link;if(Xh!=null){this.inputs[$h].link=null;var jh=this.graph.links[Xh];if(jh){var qh=this.graph.getNodeById(jh.origin_id);if(!qh)return!1;var Vh=qh.outputs[jh.origin_slot];if(!Vh||!Vh.links||Vh.links.length==0)return!1;for(var Zh=0,Kh=Vh.links.length;Zh<Kh;Zh++)if(Vh.links[Zh]==Xh){Vh.links.splice(Zh,1);break}delete this.graph.links[Xh],(zh=this.graph)==null||zh.onGraphChanged({action:"disconnectInput",doSave:Uh.doProcessChange}),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$a.INPUT,$h,!1,jh,Yh),qh.onConnectionsChange&&qh.onConnectionsChange(LiteGraph$a.OUTPUT,Zh,!1,jh,Vh),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$a.OUTPUT,qh,Zh),this.graph.onNodeConnectionChange(LiteGraph$a.INPUT,this,$h))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0}};let LiteGraph$9=null;function setGeometryHitMethodsLiteGraph($h){LiteGraph$9=$h}const geometryHitMethods={computeSize($h){if(this.constructor.size)return this.constructor.size.concat();var Th=$h||new Float32Array([0,0]),Fh=LiteGraph$9.NODE_TEXT_SIZE;const Wh=Vh=>Vh?Fh*Vh.length*.6:0;var zh=Wh(this.title),Hh=0,Uh=0;this.inputs&&(Hh=this.inputs.reduce((Vh,Zh)=>{const Kh=Zh.label||Zh.name||"",Qh=Wh(Kh);return Math.max(Vh,Qh)},0)),this.outputs&&(Uh=this.outputs.reduce((Vh,Zh)=>{const Kh=Zh.label||Zh.name||"",Qh=Wh(Kh);return Math.max(Vh,Qh)},0)),Th[0]=Math.max(Hh+Uh+10,zh),Th[0]=Math.max(Th[0],LiteGraph$9.NODE_WIDTH),this.widgets&&this.widgets.length&&(Th[0]=Math.max(Th[0],LiteGraph$9.NODE_WIDTH*1.5));const Yh=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1,1)*LiteGraph$9.NODE_SLOT_HEIGHT;Th[1]=Yh+(this.constructor.slot_start_y||0);let Xh=0;if(this.widgets&&this.widgets.length){for(var jh=0,qh=this.widgets.length;jh<qh;++jh)this.widgets[jh].computeSize?Xh+=this.widgets[jh].computeSize(Th[0])[1]+4:Xh+=LiteGraph$9.NODE_WIDGET_HEIGHT+4;Xh+=8}return this.widgets_up?Th[1]=Math.max(Th[1],Xh):this.widgets_start_y!=null?Th[1]=Math.max(Th[1],Xh+this.widgets_start_y):Th[1]+=Xh,this.constructor.min_height&&Th[1]<this.constructor.min_height&&(Th[1]=this.constructor.min_height),Th[1]+=6,Th},getBounding($h=new Float32Array(4),Th){const Fh=this.pos,Wh=this.flags.collapsed,zh=this.size;let Hh=0,Uh=1,Yh=0,Xh=0;return Th&&(Hh=4,Uh=6+Hh,Yh=4,Xh=5+Yh),$h[0]=Fh[0]-Hh,$h[1]=Fh[1]-LiteGraph$9.NODE_TITLE_HEIGHT-Yh,$h[2]=Wh?(this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH)+Uh:zh[0]+Uh,$h[3]=Wh?LiteGraph$9.NODE_TITLE_HEIGHT+Xh:zh[1]+LiteGraph$9.NODE_TITLE_HEIGHT+Xh,this.onBounding&&this.onBounding($h),$h},isPointInside($h,Th,Fh=0,Wh){var zh=this.graph&&this.graph.isLive()?0:LiteGraph$9.NODE_TITLE_HEIGHT;if(Wh&&(zh=0),this.flags&&this.flags.collapsed){if(LiteGraph$9.isInsideRectangle($h,Th,this.pos[0]-Fh,this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT-Fh,(this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH)+2*Fh,LiteGraph$9.NODE_TITLE_HEIGHT+2*Fh))return!0}else if(this.pos[0]-4-Fh<$h&&this.pos[0]+this.size[0]+4+Fh>$h&&this.pos[1]-zh-Fh<Th&&this.pos[1]+this.size[1]+Fh>Th)return!0;return!1},getConnectionPos($h,Th,Fh=new Float32Array(2)){var Wh=0;$h&&this.inputs&&(Wh=this.inputs.length),!$h&&this.outputs&&(Wh=this.outputs.length);var zh=LiteGraph$9.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var Hh=this._collapsed_width||LiteGraph$9.NODE_COLLAPSED_WIDTH;return this.horizontal?(Fh[0]=this.pos[0]+Hh*.5,$h?Fh[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT:Fh[1]=this.pos[1]):($h?Fh[0]=this.pos[0]:Fh[0]=this.pos[0]+Hh,Fh[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT*.5),Fh}return $h&&Th==-1?(Fh[0]=this.pos[0]+LiteGraph$9.NODE_TITLE_HEIGHT*.5,Fh[1]=this.pos[1]+LiteGraph$9.NODE_TITLE_HEIGHT*.5,Fh):$h&&Wh>Th&&this.inputs[Th].pos?(Fh[0]=this.pos[0]+this.inputs[Th].pos[0],Fh[1]=this.pos[1]+this.inputs[Th].pos[1],Fh):!$h&&Wh>Th&&this.outputs[Th].pos?(Fh[0]=this.pos[0]+this.outputs[Th].pos[0],Fh[1]=this.pos[1]+this.outputs[Th].pos[1],Fh):this.horizontal?(Fh[0]=this.pos[0]+(Th+.5)*(this.size[0]/Wh),$h?Fh[1]=this.pos[1]-LiteGraph$9.NODE_TITLE_HEIGHT:Fh[1]=this.pos[1]+this.size[1],Fh):($h?Fh[0]=this.pos[0]+zh:Fh[0]=this.pos[0]+this.size[0]+1-zh,Fh[1]=this.pos[1]+(Th+.7)*LiteGraph$9.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),Fh)},localToScreen($h,Th,Fh){return[($h+this.pos[0])*Fh.scale+Fh.offset[0],(Th+this.pos[1])*Fh.scale+Fh.offset[1]]}};let LiteGraph$8=null;function setCanvasIntegrationMethodsLiteGraph($h){LiteGraph$8=$h}const canvasIntegrationMethods={trace($h){var Th,Fh,Wh,zh;this.console||(this.console=[]),(Fh=(Th=this.console).push)==null||Fh.call(Th,$h),this.console.length>this.constructor.MAX_CONSOLE&&((zh=(Wh=this.console).shift)==null||zh.call(Wh)),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,$h)},setDirtyCanvas($h,Th){this.graph&&this.graph.sendActionToCanvas("setDirty",[$h,Th])},loadImage($h){var Th=new Image;Th.src=LiteGraph$8.node_images_path+$h,Th.ready=!1;var Fh=this;return Th.onload=function(){this.ready=!0,Fh.setDirtyCanvas(!0)},Th},captureInput($h){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var Th=this.graph.list_of_graphcanvas,Fh=0;Fh<Th.length;++Fh){var Wh=Th[Fh];!$h&&Wh.node_capturing_input!=this||(Wh.node_capturing_input=$h?this:null)}},collapse($h){this.graph.onGraphChanged({action:"collapse"}),!(this.constructor.collapsable===!1&&!$h)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},pin($h){this.graph.onGraphChanged({action:"pin"}),$h===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=$h}};let LiteGraph$7=null;function setAncestorRefreshMethodsLiteGraph($h){LiteGraph$7=$h}const ancestorRefreshMethods={refreshAncestors($h={}){var Th={action:"",param:null,options:null,passParam:!0},Fh=Object.assign(Th,$h);if(this.inputs&&!(LiteGraph$7.preventAncestorRecalculation&&this.graph.node_ancestorsCalculated&&this.graph.node_ancestorsCalculated[this.id])){(!Fh.action||Fh.action=="")&&(Fh.action=this.id+"_ancestors"),(!Fh.param||Fh.param=="")&&(Fh.param=this.id+"_ancestors"),Fh.options||(Fh.options={}),Fh.options=Object.assign({action_call:Fh.action},Fh.options),this.graph.ancestorsCall=!0;var Wh={modesSkip:[LiteGraph$7.NEVER,LiteGraph$7.ON_EVENT,LiteGraph$7.ON_TRIGGER],modesOnly:[LiteGraph$7.ALWAYS,LiteGraph$7.ON_REQUEST],typesSkip:[LiteGraph$7.ACTION],typesOnly:[]},zh=this.graph.getAncestors(this,Wh);for(iN in zh)zh[iN].doExecute(Fh.param,Fh.options),this.graph.node_ancestorsCalculated[zh[iN].id]=!0;return this.graph.ancestorsCall=!1,this.graph.node_ancestorsCalculated[this.id]=!0,!0}}};let LiteGraph$6=null;function setMiscMethodsLiteGraph($h){LiteGraph$6=$h}const miscMethods={alignToGrid(){this.pos[0]=LiteGraph$6.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph$6.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph$6.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph$6.CANVAS_GRID_SIZE)}};function installLGraphNodeDelegates($h,Th){setLifecycleSerializationMethodsLiteGraph(Th),setPropertiesWidgetsMethodsLiteGraph(Th),setExecutionActionsMethodsLiteGraph(Th),setSlotsMutationMethodsLiteGraph(Th),setSlotsQueryMethodsLiteGraph(Th),setConnectionsMethodsLiteGraph(Th),setGeometryHitMethodsLiteGraph(Th),setCanvasIntegrationMethodsLiteGraph(Th),setAncestorRefreshMethodsLiteGraph(Th),setMiscMethodsLiteGraph(Th),[lifecycleSerializationMethods,propertiesWidgetsMethods,ioDataMethods,executionActionsMethods,slotsMutationMethods,slotsQueryMethods,connectionsMethods,geometryHitMethods,canvasIntegrationMethods,ancestorRefreshMethods,miscMethods].forEach(Fh=>{Object.entries(Fh).forEach(([Wh,zh])=>{Object.defineProperty($h.prototype,Wh,{value:zh,writable:!0,configurable:!0})})})}class LGraphNode{constructor(Th="Unnamed"){this.title=Th,this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}}set pos(Th){var Fh;!Th||Th.length<2||((Fh=this._pos)!=null||(this._pos=new Float32Array(10,10)),this._pos[0]=Th[0],this._pos[1]=Th[1])}get pos(){return this._pos}}function setupLGraphNodeDelegates($h=LiteGraph){installLGraphNodeDelegates(LGraphNode,$h)}class LGraphGroup{constructor(Th="Group"){Yl(this,"isPointInside",LiteGraph.LGraphNode.prototype.isPointInside),Yl(this,"setDirtyCanvas",LiteGraph.LGraphNode.prototype.setDirtyCanvas);var Fh,Wh;this.title=Th,this.font_size=24,this.color=(Wh=(Fh=LiteGraph.LGraphCanvas.node_colors.pale_blue)==null?void 0:Fh.groupcolor)!=null?Wh:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null}set pos(Th){!Th||Th.length<2||(this._pos[0]=Th[0],this._pos[1]=Th[1])}get pos(){return this._pos}set size(Th){!Th||Th.length<2||(this._size[0]=Math.max(140,Th[0]),this._size[1]=Math.max(80,Th[1]))}get size(){return this._size}configure(Th){this.title=Th.title,this._bounding.set(Th.bounding),this.color=Th.color,Th.font_size&&(this.font_size=Th.font_size)}serialize(){var Th=this._bounding;return{title:this.title,bounding:Th.map(Fh=>Math.round(Fh)),color:this.color,font_size:this.font_size}}move(Th,Fh,Wh){var zh,Hh;isNaN(Th)&&((zh=console.error)==null||zh.call(console,"LGraphGroup.move() deltax NaN")),isNaN(Fh)&&((Hh=console.error)==null||Hh.call(console,"LGraphGroup.move() deltay NaN")),this._pos[0]+=Th,this._pos[1]+=Fh,!Wh&&this._nodes.forEach(Uh=>{Uh.pos[0]+=Th,Uh.pos[1]+=Fh})}recomputeInsideNodes(){this._nodes.length=0;var Th=this.graph._nodes,Fh=new Float32Array(4);this._nodes=Th.filter(Wh=>(Wh.getBounding(Fh),LiteGraph.overlapBounding(this._bounding,Fh)))}}function applyRenderContextCompatAliases($h){if(!$h||typeof $h!="object")return $h;const Th="imageSmoothingEnabled"in $h,Fh="mozImageSmoothingEnabled"in $h;return Th&&!Fh&&Object.defineProperty($h,"mozImageSmoothingEnabled",{enumerable:!1,configurable:!0,get(){return $h.imageSmoothingEnabled},set(Wh){$h.imageSmoothingEnabled=Wh}}),$h}class Canvas2DSurface{constructor(Th,Fh=null){this.canvas=Th,this._context=Fh}getContextCompat(){var Th;return!this._context&&(Th=this.canvas)!=null&&Th.getContext&&(this._context=this.canvas.getContext("2d")),applyRenderContextCompatAliases(this._context)}resize(Th,Fh){this.canvas&&(this.canvas.width=Th,this.canvas.height=Fh)}}class LeaferSurface{constructor(Th){var Fh;this.leaferCanvas=Th,this.canvas=(Fh=Th==null?void 0:Th.view)!=null?Fh:null}getContextCompat(){var Th,Fh;const Wh=(Fh=(Th=this.leaferCanvas)==null?void 0:Th.context)!=null?Fh:null;return applyRenderContextCompatAliases(Wh)}resize(Th,Fh){var Wh,zh;if(this.leaferCanvas){if(typeof this.leaferCanvas.resize=="function"){const Hh={width:Th,height:Fh};typeof this.leaferCanvas.pixelRatio=="number"&&(Hh.pixelRatio=this.leaferCanvas.pixelRatio),this.leaferCanvas.resize(Hh)}else this.canvas&&(this.canvas.width=Th,this.canvas.height=Fh);this.canvas=(zh=(Wh=this.leaferCanvas)==null?void 0:Wh.view)!=null?zh:this.canvas}}}class Canvas2DRendererAdapter{constructor(){this.ownerDocument=null,this.frontSurface=null,this.backSurface=null}init({canvas:Th,ownerDocument:Fh}){var Wh,zh;this.ownerDocument=(Wh=Fh!=null?Fh:Th==null?void 0:Th.ownerDocument)!=null?Wh:null,this.frontSurface=new Canvas2DSurface(Th);const Hh=(zh=this.ownerDocument)!=null&&zh.createElement?this.ownerDocument.createElement("canvas"):document.createElement("canvas");return Hh.width=Th.width,Hh.height=Th.height,this.backSurface=new Canvas2DSurface(Hh),this.getFrontCtx(),this.getBackCtx(),this}destroy(){this.frontSurface=null,this.backSurface=null}resize(Th,Fh){var Wh,zh;(Wh=this.frontSurface)==null||Wh.resize(Th,Fh),(zh=this.backSurface)==null||zh.resize(Th,Fh)}beginFrame(Th){}endFrame(Th){}getFrontCtx(){var Th,Fh;return(Fh=(Th=this.frontSurface)==null?void 0:Th.getContextCompat())!=null?Fh:null}getBackCtx(){var Th,Fh;return(Fh=(Th=this.backSurface)==null?void 0:Th.getContextCompat())!=null?Fh:null}getFrontSurface(){return this.frontSurface}getBackSurface(){return this.backSurface}blitBackToFront(Th=this.getFrontCtx()){var Fh,Wh;const zh=(Fh=this.frontSurface)==null?void 0:Fh.canvas,Hh=(Wh=this.backSurface)==null?void 0:Wh.canvas;!Th||!zh||!Hh||Hh===zh||Th.drawImage(Hh,0,0)}adoptExternalContexts({frontCanvas:Th,backCanvas:Fh,frontContext:Wh,backContext:zh}){this.frontSurface=new Canvas2DSurface(Th,Wh),this.backSurface=new Canvas2DSurface(Fh,zh),this.getFrontCtx(),this.getBackCtx()}}function resolveRendererAdapter($h){var Th,Fh;const Wh=(Fh=(Th=$h.options)==null?void 0:Th.rendererAdapter)!=null?Fh:$h.rendererAdapter;return Wh?typeof Wh=="function"?new Wh:Wh:new Canvas2DRendererAdapter}function clear(){var $h;this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.low_quality_rendering_counter=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),($h=this.onClear)==null||$h.call(this)}function setGraph($h,Th){var Fh;if(this.graph!=$h){if(Th||this.clear(),!$h){(Fh=this.graph)==null||Fh.detachCanvas(this);return}$h.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}}function getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}function openSubgraph($h){if(!$h)throw new Error("graph cannot be null");if(this.graph==$h)throw new Error("graph cannot be the same");this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),$h.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)}function closeSubgraph(){if(!(!this._graph_stack||this._graph_stack.length==0)){var $h=this.graph._subgraph_node,Th=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},Th.attachCanvas(this),this.setDirty(!0,!0),$h&&(this.centerOnNode($h),this.selectNodes([$h])),this.ds.offset=[0,0],this.ds.scale=1}}function getCurrentGraph(){return this.graph}function setCanvas($h,Th){var Fh,Wh,zh,Hh,Uh,Yh,Xh,jh,qh,Vh,Zh,Kh,Qh,Jh,td,ed,id,sd,nd,hd,ud,rd,ad,dd,cd;if($h&&$h.constructor===String&&($h=document.getElementById($h),!$h))throw new Error("Error creating LiteGraph canvas: Canvas not found");if($h!==this.canvas){if(!$h&&this.canvas&&(Th||this.unbindEvents()),this.rendererAdapter&&this.canvas&&$h!==this.canvas&&((Wh=(Fh=this.rendererAdapter).destroy)==null||Wh.call(Fh)),this.canvas=$h,!$h){this.ctx=null,this.bgctx=null,this.bgcanvas=null,this.frontSurface=null,this.backSurface=null,this.ds.element=null;return}if($h.className+=" lgraphcanvas",$h.data=this,$h.tabindex="1",$h.getContext==null)throw $h.localName!="canvas"?new Error("Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+$h.localName):new Error("This browser doesn't support Canvas");this.rendererAdapter=resolveRendererAdapter(this),(Hh=(zh=this.rendererAdapter).init)==null||Hh.call(zh,{canvas:$h,ownerDocument:$h.ownerDocument}),this.frontSurface=(Xh=(Yh=(Uh=this.rendererAdapter).getFrontSurface)==null?void 0:Yh.call(Uh))!=null?Xh:null,this.backSurface=(Vh=(qh=(jh=this.rendererAdapter).getBackSurface)==null?void 0:qh.call(jh))!=null?Vh:null,this.canvas=((Zh=this.frontSurface)==null?void 0:Zh.canvas)||$h,this.bgcanvas=((Kh=this.backSurface)==null?void 0:Kh.canvas)||this.canvas,this.ds.element=this.canvas;var od=this.ctx=(sd=(id=(Jh=(Qh=this.rendererAdapter).getFrontCtx)==null?void 0:Jh.call(Qh))!=null?id:(ed=(td=this.frontSurface)==null?void 0:td.getContextCompat)==null?void 0:ed.call(td))!=null?sd:null;this.bgctx=(dd=(ad=(hd=(nd=this.rendererAdapter).getBackCtx)==null?void 0:hd.call(nd))!=null?ad:(rd=(ud=this.backSurface)==null?void 0:ud.getContextCompat)==null?void 0:rd.call(ud))!=null?dd:od,od==null&&($h.webgl_enabled||(cd=LiteGraph.info)==null||cd.call(LiteGraph,"This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),Th||this.bindEvents()}}function _doNothing($h){return $h.preventDefault(),!1}function _doReturnTrue($h){return $h.preventDefault(),!0}function bindEvents(){var $h;if(this._events_binded){($h=LiteGraph.warn)==null||$h.call(LiteGraph,"LGraphCanvas: events already binded");return}this._events_binded=!0;var Th=this.canvas,Fh=this.getCanvasWindow(),Wh=Fh.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),Th.addEventListener("pointerdown",this._mousedown_callback,!0),Th.addEventListener("pointermove",this._mousemove_callback),Th.addEventListener("pointerup",this._mouseup_callback,!0),Th.addEventListener("contextmenu",this._doNothing),Th.addEventListener("wheel",this.processMouseWheel),Th.addEventListener("keydown",this.processKey),Wh.addEventListener("keyup",this.processKey),Th.addEventListener("dragover",this._doNothing,!1),Th.addEventListener("dragend",this._doNothing,!1),Th.addEventListener("drop",this.processDrop),Th.addEventListener("dragenter",this._doReturnTrue,!1)}function unbindEvents(){var $h;if(!this._events_binded){($h=LiteGraph.warn)==null||$h.call(LiteGraph,"LGraphCanvas: no events binded");return}this._events_binded=!1;var Th=this.canvas,Fh=this.getCanvasWindow(),Wh=Fh.document;Th.removeEventListener("pointerdown",this._mousedown_callback),Th.removeEventListener("pointermove",this._mousemove_callback),Th.removeEventListener("pointerup",this._mouseup_callback),Th.removeEventListener("contextmenu",this._doNothing),Th.removeEventListener("wheel",this.processMouseWheel),Th.removeEventListener("keydown",this.processKey),Wh.removeEventListener("keyup",this.processKey),Th.removeEventListener("dragover",this._doNothing,!1),Th.removeEventListener("dragend",this._doNothing,!1),Th.removeEventListener("drop",this.processDrop),Th.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null}function enableWebGL(){var $h,Th;if(typeof GL=="undefined")throw new Error("litegl.js must be included to use a WebGL canvas");if(typeof enableWebGLCanvas=="undefined")throw new Error("webglCanvas.js must be included to use this feature");this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.frontSurface={canvas:this.canvas,getContextCompat:()=>this.ctx,resize:(Fh,Wh)=>{this.canvas.width=Fh,this.canvas.height=Wh}},this.backSurface=this.frontSurface,(Th=($h=this.rendererAdapter)==null?void 0:$h.adoptExternalContexts)==null||Th.call($h,{frontCanvas:this.canvas,backCanvas:this.canvas,frontContext:this.ctx,backContext:this.bgctx}),this.canvas.webgl_enabled=!0}function setDirty($h,Th){$h&&(this.dirty_canvas=!0),Th&&(this.dirty_bgcanvas=!0)}function getCanvasWindow(){var $h;if(!this.canvas)return window;var Th=this.canvas.ownerDocument;return($h=Th.defaultView)!=null?$h:Th.parentWindow}function startRendering(){if(this.is_rendering)return;this.is_rendering=!0,$h.call(this);function $h(){this.pause_rendering||this.draw();var Th=this.getCanvasWindow();this.is_rendering&&Th.requestAnimationFrame($h.bind(this))}}function stopRendering(){this.is_rendering=!1}function resize($h,Th){var Fh,Wh,zh,Hh,Uh,Yh,Xh,jh,qh,Vh,Zh,Kh,Qh,Jh,td,ed,id,sd,nd,hd,ud,rd;if(!$h&&!Th){var ad=this.canvas.parentNode;$h=ad.offsetWidth,Th=ad.offsetHeight}const dd=((Fh=this.frontSurface)==null?void 0:Fh.canvas)||this.canvas;dd.width==$h&&dd.height==Th||((Wh=this.rendererAdapter)!=null&&Wh.resize?(this.rendererAdapter.resize($h,Th),this.frontSurface=(Uh=(Hh=(zh=this.rendererAdapter).getFrontSurface)==null?void 0:Hh.call(zh))!=null?Uh:this.frontSurface,this.backSurface=(jh=(Xh=(Yh=this.rendererAdapter).getBackSurface)==null?void 0:Xh.call(Yh))!=null?jh:this.backSurface,this.canvas=((qh=this.frontSurface)==null?void 0:qh.canvas)||this.canvas,this.bgcanvas=((Vh=this.backSurface)==null?void 0:Vh.canvas)||this.bgcanvas,this.ctx=(ed=(td=(Kh=(Zh=this.rendererAdapter).getFrontCtx)==null?void 0:Kh.call(Zh))!=null?td:(Jh=(Qh=this.frontSurface)==null?void 0:Qh.getContextCompat)==null?void 0:Jh.call(Qh))!=null?ed:this.ctx,this.bgctx=(rd=(ud=(sd=(id=this.rendererAdapter).getBackCtx)==null?void 0:sd.call(id))!=null?ud:(hd=(nd=this.backSurface)==null?void 0:nd.getContextCompat)==null?void 0:hd.call(nd))!=null?rd:this.bgctx,this.ds.element=this.canvas):(this.canvas.width=$h,this.canvas.height=Th,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height),this.setDirty(!0,!0))}function switchLiveMode($h){if(!$h){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var Th=this,Fh=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var Wh=setInterval(function(){Th.editor_alpha*=Fh,Th.dirty_canvas=!0,Th.dirty_bgcanvas=!0,Fh<1&&Th.editor_alpha<.01&&(clearInterval(Wh),Fh<1&&(Th.live_mode=!0)),Fh>1&&Th.editor_alpha>.99&&(clearInterval(Wh),Th.editor_alpha=1)},1)}function centerOnNode($h){this.ds.offset[0]=-$h.pos[0]-$h.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-$h.pos[1]-$h.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)}function adjustMouseEvent($h){var Th=0,Fh=0;if(this.canvas){var Wh=this.canvas.getBoundingClientRect();Th=$h.clientX-Wh.left,Fh=$h.clientY-Wh.top}else Th=$h.clientX,Fh=$h.clientY;this.last_mouse_position[0]=Th,this.last_mouse_position[1]=Fh,$h.canvasX=Th/this.ds.scale-this.ds.offset[0],$h.canvasY=Fh/this.ds.scale-this.ds.offset[1]}function setZoom($h,Th){this.ds.changeScale($h,Th),this.dirty_canvas=!0,this.dirty_bgcanvas=!0}function convertOffsetToCanvas($h,Th){return this.ds.convertOffsetToCanvas($h,Th)}function convertCanvasToOffset($h,Th){return this.ds.convertCanvasToOffset($h,Th)}function convertEventToCanvasOffset($h){var Th=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([$h.clientX-Th.left,$h.clientY-Th.top])}const temp=new Float32Array(4),temp_vec2=new Float32Array(2),tmp_area=new Float32Array(4),margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);function isOverNodeBox($h,Th,Fh){var Wh=LiteGraph.NODE_TITLE_HEIGHT;return!!LiteGraph.isInsideRectangle(Th,Fh,$h.pos[0]+2,$h.pos[1]+2-Wh,Wh-4,Wh-4)}function isOverNodeInput($h,Th,Fh,Wh){if($h.inputs)for(let Uh=0,Yh=$h.inputs.length;Uh<Yh;++Uh){var zh=$h.getConnectionPos(!0,Uh),Hh=!1;if($h.horizontal?Hh=LiteGraph.isInsideRectangle(Th,Fh,zh[0]-5,zh[1]-10,10,20):Hh=LiteGraph.isInsideRectangle(Th,Fh,zh[0]-10,zh[1]-5,40,10),Hh)return Wh&&(Wh[0]=zh[0],Wh[1]=zh[1]),Uh}return-1}function isOverNodeOutput($h,Th,Fh,Wh){if($h.outputs)for(let Uh=0,Yh=$h.outputs.length;Uh<Yh;++Uh){var zh=$h.getConnectionPos(!1,Uh),Hh=!1;if($h.horizontal?Hh=LiteGraph.isInsideRectangle(Th,Fh,zh[0]-5,zh[1]-10,10,20):Hh=LiteGraph.isInsideRectangle(Th,Fh,zh[0]-10,zh[1]-5,40,10),Hh)return Wh&&(Wh[0]=zh[0],Wh[1]=zh[1]),Uh}return-1}function bringToFront($h){var Th=this.graph._nodes.indexOf($h);Th!=-1&&(this.graph._nodes.splice(Th,1),this.graph._nodes.push($h))}function sendToBack($h){var Th=this.graph._nodes.indexOf($h);Th!=-1&&(this.graph._nodes.splice(Th,1),this.graph._nodes.unshift($h))}function computeVisibleNodes($h,Th){var Fh=Th||[];Fh.length=0,$h=$h||this.graph._nodes;for(var Wh=0,zh=$h.length;Wh<zh;++Wh){var Hh=$h[Wh];this.live_mode&&!Hh.onDrawBackground&&!Hh.onDrawForeground||LiteGraph.overlapBounding(this.visible_area,Hh.getBounding(temp,!0))&&Fh.push(Hh)}return Fh}class CoreController{constructor(Th){this.host=Th}clear(...Th){return clear.apply(this.host,Th)}setGraph(...Th){return setGraph.apply(this.host,Th)}getTopGraph(...Th){return getTopGraph.apply(this.host,Th)}openSubgraph(...Th){return openSubgraph.apply(this.host,Th)}closeSubgraph(...Th){return closeSubgraph.apply(this.host,Th)}getCurrentGraph(...Th){return getCurrentGraph.apply(this.host,Th)}setCanvas(...Th){return setCanvas.apply(this.host,Th)}_doNothing(...Th){return _doNothing.apply(this.host,Th)}_doReturnTrue(...Th){return _doReturnTrue.apply(this.host,Th)}bindEvents(...Th){return bindEvents.apply(this.host,Th)}unbindEvents(...Th){return unbindEvents.apply(this.host,Th)}enableWebGL(...Th){return enableWebGL.apply(this.host,Th)}setDirty(...Th){return setDirty.apply(this.host,Th)}getCanvasWindow(...Th){return getCanvasWindow.apply(this.host,Th)}startRendering(...Th){return startRendering.apply(this.host,Th)}stopRendering(...Th){return stopRendering.apply(this.host,Th)}resize(...Th){return resize.apply(this.host,Th)}switchLiveMode(...Th){return switchLiveMode.apply(this.host,Th)}centerOnNode(...Th){return centerOnNode.apply(this.host,Th)}adjustMouseEvent(...Th){return adjustMouseEvent.apply(this.host,Th)}setZoom(...Th){return setZoom.apply(this.host,Th)}convertOffsetToCanvas(...Th){return convertOffsetToCanvas.apply(this.host,Th)}convertCanvasToOffset(...Th){return convertCanvasToOffset.apply(this.host,Th)}convertEventToCanvasOffset(...Th){return convertEventToCanvasOffset.apply(this.host,Th)}isOverNodeBox(...Th){return isOverNodeBox.apply(this.host,Th)}isOverNodeInput(...Th){return isOverNodeInput.apply(this.host,Th)}isOverNodeOutput(...Th){return isOverNodeOutput.apply(this.host,Th)}bringToFront(...Th){return bringToFront.apply(this.host,Th)}sendToBack(...Th){return sendToBack.apply(this.host,Th)}computeVisibleNodes(...Th){return computeVisibleNodes.apply(this.host,Th)}}function processUserInputDown($h){var Th,Fh;if(this.pointer_is_down&&$h.isPrimary!==void 0&&!$h.isPrimary?this.userInput_isNotPrimary=!0:this.userInput_isNotPrimary=!1,this.userInput_type=$h.pointerType?$h.pointerType:!1,this.userInput_id=$h.pointerId?$h.pointerId:!1,$h.pointerType)switch($h.pointerType){case"mouse":break;case"pen":break;case"touch":break;default:(Th=LiteGraph.log)==null||Th.call(LiteGraph,"pointerType unknown "+ev.pointerType)}return $h.button!==void 0&&(this.userInput_button=$h.button,$h.button),$h.buttons!==void 0&&(this.userInput_button_s=$h.buttons),this.userInput_touches=$h.changedTouches!==void 0&&$h.changedTouches.length!==void 0?$h.changedTouches:!1,this.userInput_touches&&this.userInput_touches.length&&((Fh=LiteGraph.debug)==null||Fh.call(LiteGraph,"check multiTouches",$h.changedTouches)),this.processMouseDown($h)}function processMouseDown($h){var Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent($h);var qh=this.getCanvasWindow();LGraphCanvas.active_canvas=this;var Vh=$h.clientX,Zh=$h.clientY;(Th=LiteGraph.log)==null||Th.call(LiteGraph,"pointerevents: processMouseDown pointerId:"+$h.pointerId+" which:"+$h.which+" isPrimary:"+$h.isPrimary+" :: x y "+Vh+" "+Zh,"previousClick",this.last_mouseclick,"diffTimeClick",this.last_mouseclick?LiteGraph.getTime()-this.last_mouseclick:"notlast"),this.ds.viewport=this.viewport;var Kh=!this.viewport||this.viewport&&Vh>=this.viewport[0]&&Vh<this.viewport[0]+this.viewport[2]&&Zh>=this.viewport[1]&&Zh<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(this.canvas.removeEventListener("pointermove",this._mousemove_callback),qh.document.addEventListener("pointermove",this._mousemove_callback,!0),qh.document.addEventListener("pointerup",this._mouseup_callback,!0)),!!Kh){var Qh=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes,5),Jh=!1,td=LiteGraph.getTime(),ed=$h.isPrimary===void 0||$h.isPrimary,id=td-this.last_mouseclick<300&&ed;if(this.mouse[0]=$h.clientX,this.mouse[1]=$h.clientY,this.graph_mouse[0]=$h.canvasX,this.graph_mouse[1]=$h.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&ed?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.ContextMenu.closeAll(qh),!((Fh=this.onMouse)!=null&&Fh.call(this,$h))){if($h.which==1&&!this.userInput_isNotPrimary){if($h.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=$h.canvasX,this.dragging_rectangle[1]=$h.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,Jh=!0),LiteGraph.alt_drag_do_clone_nodes&&$h.altKey&&Qh&&this.allow_interaction&&!Jh&&!this.read_only){let pd=Qh,bd=Qh.clone();if(bd){if(bd.pos[0]+=5,bd.pos[1]+=5,this.graph.add(bd,!1,{doCalcSize:!1}),Qh=bd,LiteGraph.alt_shift_drag_connect_clone_with_input&&$h.shiftKey&&pd.inputs&&pd.inputs.length)for(var sd=0;sd<pd.inputs.length;++sd){var nd=pd.inputs[sd];if(!(!nd||nd.link==null)){var hd=this.graph.links[nd.link];if(hd&&hd.type!==LiteGraph.EVENT){var ud;hd.origin_id&&(ud=this.graph.getNodeById(hd.origin_id));var rd=Qh;ud&&rd&&ud.connect(hd.origin_slot,rd,hd.target_slot)}}}Jh=!0,cd||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=Qh),this.selected_nodes[Qh.id]||this.processNodeSelected(Qh,$h))}}var ad=!1;if(Qh&&(this.allow_interaction||Qh.flags.allow_interaction)&&!Jh&&!this.read_only){if(!this.live_mode&&!Qh.flags.pinned&&this.bringToFront(Qh),this.allow_interaction&&!this.connecting_node&&!Qh.flags.collapsed&&!this.live_mode)if(!Jh&&Qh.resizable!==!1&&LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,Qh.pos[0]+Qh.size[0]-5,Qh.pos[1]+Qh.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=Qh,this.canvas.style.cursor="se-resize",Jh=!0;else{if(Qh.outputs)for(let pd=0,bd=Qh.outputs.length;pd<bd;++pd){let Cd=Qh.outputs[pd],Ld=Qh.getConnectionPos(!1,pd);if(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,Ld[0]-15,Ld[1]-10,30,20)){this.connecting_node=Qh,this.connecting_output=Cd,this.connecting_output.slot_index=pd,this.connecting_pos=Qh.getConnectionPos(!1,pd),this.connecting_slot=pd,LiteGraph.shift_click_do_break_link_from&&$h.shiftKey&&Qh.disconnectOutput(pd),id?(Wh=Qh.onOutputDblClick)==null||Wh.call(Qh,pd,$h):(zh=Qh.onOutputClick)==null||zh.call(Qh,pd,$h),Jh=!0;break}}if(Qh.inputs)for(let pd=0,bd=Qh.inputs.length;pd<bd;++pd){let Cd=Qh.inputs[pd],Ld=Qh.getConnectionPos(!0,pd);if(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,Ld[0]-15,Ld[1]-10,30,20)){if(id?(Hh=Qh.onInputDblClick)==null||Hh.call(Qh,pd,$h):(Uh=Qh.onInputClick)==null||Uh.call(Qh,pd,$h),Cd.link!==null){var dd=this.graph.links[Cd.link];LiteGraph.click_do_break_link_to&&(Qh.disconnectInput(pd),this.dirty_bgcanvas=!0,Jh=!0),$h.shiftKey&&(LiteGraph.click_do_break_link_to||Qh.disconnectInput(pd),this.connecting_node=this.graph._nodes_by_id[dd.origin_id],this.connecting_slot=dd.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,Jh=!0)}Jh||(this.connecting_node=Qh,this.connecting_input=Cd,this.connecting_input.slot_index=pd,this.connecting_pos=Qh.getConnectionPos(!0,pd),this.connecting_slot=pd,this.dirty_bgcanvas=!0,Jh=!0)}}}if(!Jh){var cd=!1,od=[$h.canvasX-Qh.pos[0],$h.canvasY-Qh.pos[1]],ld=this.processNodeWidgets(Qh,this.graph_mouse,$h);ld&&(cd=!0,this.node_widget=[Qh,ld]),this.allow_interaction&&id&&this.selected_nodes[Qh.id]&&((Yh=Qh.onDblClick)==null||Yh.call(Qh,$h,od,this),this.processNodeDblClicked(Qh),cd=!0),Qh.onMouseDown&&Qh.onMouseDown($h,od,this)?cd=!0:(Qh.subgraph&&!Qh.skip_subgraph_button&&!Qh.flags.collapsed&&od[0]>Qh.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&od[1]<0&&setTimeout(()=>{this.openSubgraph(Qh.subgraph)},10),this.live_mode&&(ad=!0,cd=!0)),cd?Qh.is_selected||this.processNodeSelected(Qh,$h):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=Qh),this.processNodeSelected(Qh,$h)),this.dirty_canvas=!0}}else if(!Jh){if(!this.read_only)for(let pd=0;pd<this.visible_links.length;++pd){var _d=this.visible_links[pd],md=_d._pos;if(!(!md||$h.canvasX<md[0]-4||$h.canvasX>md[0]+4||$h.canvasY<md[1]-4||$h.canvasY>md[1]+4)){this.showLinkMenu(_d,$h),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos($h.canvasX,$h.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){$h.ctrlKey&&(this.dragging_rectangle=null);var gd=LiteGraph.distance([$h.canvasX,$h.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);gd*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}id&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox($h),$h.preventDefault(),$h.stopPropagation()),(Xh=LiteGraph.debug)==null||Xh.call(LiteGraph,"DEBUG canvas click is_double_click,this.allow_searchbox",id,this.allow_searchbox),ad=!0}!Jh&&ad&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if($h.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(Qh&&this.allow_interaction&&!Jh&&!this.read_only&&!this.connecting_node&&!Qh.flags.collapsed&&!this.live_mode){var wd=!1,$d=!1,fd=!1;if(Qh.outputs)for(let pd=0,bd=Qh.outputs.length;pd<bd;++pd){var vd=Qh.outputs[pd];let Cd=Qh.getConnectionPos(!1,pd);if(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,Cd[0]-15,Cd[1]-10,30,20)){wd=vd,$d=pd,fd=!0;break}}if(Qh.inputs)for(let pd=0,bd=Qh.inputs.length;pd<bd;++pd){var nd=Qh.inputs[pd];let Ld=Qh.getConnectionPos(!0,pd);if(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,Ld[0]-15,Ld[1]-10,30,20)){wd=nd,$d=pd,fd=!1;break}}if(wd&&$d!==!1){var yd=.5-($d+1)/(fd?Qh.outputs.length:Qh.inputs.length),xd=Qh.getBounding(),Td=[fd?xd[0]+xd[2]:xd[0],$h.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:fd?Qh:null,slotFrom:fd?$d:null,nodeTo:fd?null:Qh,slotTo:fd?null:$d,position:Td,nodeType:"AUTO",posAdd:[fd?30:-30,-yd*130],posSizeFix:[fd?0:-1,0]})}}}else!Jh&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else($h.which==3||LiteGraph.two_fingers_opens_menu&&this.userInput_isNotPrimary)&&this.allow_interaction&&!Jh&&!this.read_only&&(Qh&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[Qh.id]||$h.shiftKey||$h.ctrlKey||$h.metaKey)?this.selected_nodes[Qh.id]||this.selectNodes([Qh],!0):this.selectNodes([Qh])),this.processContextMenu(Qh,$h));return this.last_mouse[0]=$h.clientX,this.last_mouse[1]=$h.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!qh.document.activeElement||qh.document.activeElement.nodeName.toLowerCase()!="input"&&qh.document.activeElement.nodeName.toLowerCase()!="textarea")&&$h.preventDefault(),$h.stopPropagation(),(jh=this.onMouseDown)==null||jh.call(this,$h),!1}}}}function processMouseMove($h){var Th,Fh;if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent($h);var Wh=[$h.clientX,$h.clientY];this.mouse[0]=Wh[0],this.mouse[1]=Wh[1];var zh=[Wh[0]-this.last_mouse[0],Wh[1]-this.last_mouse[1]];if(this.last_mouse=Wh,this.graph_mouse[0]=$h.canvasX,this.graph_mouse[1]=$h.canvasY,this.block_click)return $h.preventDefault(),!1;$h.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,$h,this.node_widget[1]),this.dirty_canvas=!0);var Hh=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=$h.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=$h.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[$h.canvasX-this.selected_group.pos[0],$h.canvasY-this.selected_group.pos[1]];else{var Uh=zh[0]/this.ds.scale,Yh=zh[1]/this.ds.scale;this.selected_group.move(Uh,Yh,$h.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=zh[0]/this.ds.scale,this.ds.offset[1]+=zh[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||Hh&&Hh.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(let Kh=0,Qh=this.graph._nodes.length;Kh<Qh;++Kh)this.graph._nodes[Kh].mouseOver&&Hh!=this.graph._nodes[Kh]&&(this.graph._nodes[Kh].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave($h),this.node_over=null,this.dirty_canvas=!0);if(Hh){if(Hh.redraw_on_mouse&&(this.dirty_canvas=!0),Hh.mouseOver||(Hh.mouseOver=!0,this.node_over=Hh,this.dirty_canvas=!0,(Th=Hh.onMouseEnter)==null||Th.call(Hh,$h)),(Fh=Hh.onMouseMove)==null||Fh.call(Hh,$h,[$h.canvasX-Hh.pos[0],$h.canvasY-Hh.pos[1]],this),this.connecting_node){let Kh;if(this.connecting_output){if(Kh=this._highlight_input||[0,0],!this.isOverNodeBox(Hh,$h.canvasX,$h.canvasY)){let Qh=this.isOverNodeInput(Hh,$h.canvasX,$h.canvasY,Kh);if(Qh!=-1&&Hh.inputs[Qh]){let Jh=Hh.inputs[Qh].type;LiteGraph.isValidConnection(this.connecting_output.type,Jh)&&(this._highlight_input=Kh,this._highlight_input_slot=Hh.inputs[Qh])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input&&(Kh=this._highlight_output||[0,0],this.isOverNodeBox(Hh,$h.canvasX,$h.canvasY))){let Qh=this.isOverNodeOutput(Hh,$h.canvasX,$h.canvasY,Kh);if(Qh!=-1&&Hh.outputs[Qh]){let Jh=Hh.outputs[Qh].type;LiteGraph.isValidConnection(this.connecting_input.type,Jh)&&(this._highlight_output=Kh)}else this._highlight_output=null}}this.canvas&&(LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,Hh.pos[0]+Hh.size[0]-5,Hh.pos[1]+Hh.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var Xh=null;for(let Kh=0;Kh<this.visible_links.length;++Kh){var jh=this.visible_links[Kh],qh=jh._pos;if(!(!qh||$h.canvasX<qh[0]-4||$h.canvasX>qh[0]+4||$h.canvasY<qh[1]-4||$h.canvasY>qh[1]+4)){Xh=jh;break}}Xh!=this.over_link_center&&(this.over_link_center=Xh,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=Hh&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove($h,[$h.canvasX-this.node_capturing_input.pos[0],$h.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(let Kh in this.selected_nodes){let Qh=this.selected_nodes[Kh];Qh.pos[0]+=zh[0]/this.ds.scale,Qh.pos[1]+=zh[1]/this.ds.scale,Qh.is_selected||this.processNodeSelected(Qh,$h)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var Vh=[$h.canvasX-this.resizing_node.pos[0],$h.canvasY-this.resizing_node.pos[1]],Zh=this.resizing_node.computeSize();Vh[0]=Math.max(Zh[0],Vh[0]),Vh[1]=Math.max(Zh[1],Vh[1]),this.resizing_node.setSize(Vh),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return $h.preventDefault(),!1}}function processMouseUp($h){var Th,Fh=$h.isPrimary===void 0||$h.isPrimary;if(!Fh)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var Wh=this.getCanvasWindow(),zh=Wh.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(zh.removeEventListener("pointermove",this._mousemove_callback,!0),this.canvas.addEventListener("pointermove",this._mousemove_callback,!0),zh.removeEventListener("pointerup",this._mouseup_callback,!0)),this.adjustMouseEvent($h);var Hh=LiteGraph.getTime();if($h.click_time=Hh-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),$h.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,$h),this.node_widget=null,this.selected_group){var Uh=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),Yh=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(Uh,Yh,$h.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var Xh=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var jh=this.graph._nodes,qh=new Float32Array(4),Vh=Math.abs(this.dragging_rectangle[2]),Zh=Math.abs(this.dragging_rectangle[3]),Kh=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-Vh:this.dragging_rectangle[0],Qh=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-Zh:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=Kh,this.dragging_rectangle[1]=Qh,this.dragging_rectangle[2]=Vh,this.dragging_rectangle[3]=Zh,!Xh||Vh>10&&Zh>10){var Jh=[];for(let sd=0;sd<jh.length;++sd){var td=jh[sd];td.getBounding(qh),LiteGraph.overlapBounding(this.dragging_rectangle,qh)&&Jh.push(td)}Jh.length&&this.selectNodes(Jh,$h.shiftKey)}else this.selectNodes([Xh],$h.shiftKey||$h.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var ed=this.connecting_output||this.connecting_input,id=ed.type;if(Xh=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes),Xh){let sd;this.connecting_output?(sd=this.isOverNodeInput(Xh,$h.canvasX,$h.canvasY),sd!=-1?this.connecting_node.connect(this.connecting_slot,Xh,sd):this.connecting_node.connectByType(this.connecting_slot,Xh,id)):this.connecting_input&&(sd=this.isOverNodeOutput(Xh,$h.canvasX,$h.canvasY),sd!=-1?Xh.connect(sd,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,Xh,id))}else LiteGraph.release_link_on_empty_shows_menu&&($h.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox($h,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox($h,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:$h}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:$h}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null):this.node_dragged?(Xh=this.node_dragged,Xh&&$h.click_time<300&&LiteGraph.isInsideRectangle($h.canvasX,$h.canvasY,Xh.pos[0],Xh.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&Xh.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),(Th=this.onNodeMoved)==null||Th.call(this,this.node_dragged),this.graph.onGraphChanged({action:"nodeDrag",doSave:!0}),this.graph.afterChange(this.node_dragged),this.node_dragged=null):(Xh=this.graph.getNodeOnPos($h.canvasX,$h.canvasY,this.visible_nodes),!Xh&&$h.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp($h,[$h.canvasX-this.node_over.pos[0],$h.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp($h,[$h.canvasX-this.node_capturing_input.pos[0],$h.canvasY-this.node_capturing_input.pos[1]]))}else $h.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):$h.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return Fh&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),$h.stopPropagation(),$h.preventDefault(),!1}}function processMouseWheel($h){if(!(!this.graph||!this.allow_dragcanvas)){var Th=$h.wheelDeltaY!=null?$h.wheelDeltaY:$h.detail*-60;this.adjustMouseEvent($h);var Fh=$h.clientX,Wh=$h.clientY,zh=!this.viewport||this.viewport&&Fh>=this.viewport[0]&&Fh<this.viewport[0]+this.viewport[2]&&Wh>=this.viewport[1]&&Wh<this.viewport[1]+this.viewport[3];if(zh){var Hh=this.ds.scale;return Hh*=Math.pow(1.1,Th*.01),this.ds.changeScale(Hh,[$h.clientX,$h.clientY]),this.graph.change(),$h.preventDefault(),!1}}}function blockClick(){this.block_click=!0,this.last_mouseclick=0}function processKey($h){var Th,Fh,Wh,zh,Hh;if(this.graph){var Uh=!1;if($h.target.localName!="input"){if($h.type=="keydown"){if($h.keyCode==32&&(this.dragging_canvas=!0,Uh=!0),$h.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),Uh=!0),$h.keyCode==65&&$h.ctrlKey&&(this.selectNodes(),Uh=!0),$h.keyCode===67&&($h.metaKey||$h.ctrlKey)&&!$h.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),Uh=!0),$h.keyCode===86&&($h.metaKey||$h.ctrlKey)&&this.pasteFromClipboard($h.shiftKey),($h.keyCode==46||LiteGraph.backspace_delete&&$h.keyCode==8)&&$h.target.localName!="input"&&$h.target.localName!="textarea"&&(this.deleteSelectedNodes(),Uh=!0),LiteGraph.actionHistory_enabled&&($h.keyCode==89&&$h.ctrlKey||$h.keyCode==90&&$h.ctrlKey&&$h.shiftKey?this.graph.actionHistoryForward():$h.keyCode==90&&$h.ctrlKey&&this.graph.actionHistoryBack()),(Th=LiteGraph.debug)==null||Th.call(LiteGraph,"Canvas keydown "+$h.keyCode),this.selected_nodes)for(let Yh in this.selected_nodes)(Wh=(Fh=this.selected_nodes[Yh]).onKeyDown)==null||Wh.call(Fh,$h)}else if($h.type=="keyup"&&($h.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(let Yh in this.selected_nodes)(Hh=(zh=this.selected_nodes[Yh]).onKeyUp)==null||Hh.call(zh,$h);if(this.graph.change(),Uh)return $h.preventDefault(),$h.stopImmediatePropagation(),!1}}}function processDrop($h){$h.preventDefault(),this.adjustMouseEvent($h);var Th=$h.clientX,Fh=$h.clientY,Wh=!this.viewport||this.viewport&&Th>=this.viewport[0]&&Th<this.viewport[0]+this.viewport[2]&&Fh>=this.viewport[1]&&Fh<this.viewport[1]+this.viewport[3];if(Wh){Th=$h.localX,Fh=$h.localY;var Wh=!this.viewport||this.viewport&&Th>=this.viewport[0]&&Th<this.viewport[0]+this.viewport[2]&&Fh>=this.viewport[1]&&Fh<this.viewport[1]+this.viewport[3];if(Wh){var zh=[$h.canvasX,$h.canvasY],Hh=this.graph?this.graph.getNodeOnPos(zh[0],zh[1]):null;if(!Hh){var Uh=null;this.onDropItem&&(Uh=this.onDropItem(event)),Uh||this.checkDropItem($h);return}if(Hh.onDropFile||Hh.onDropData){var Yh=$h.dataTransfer.files;if(Yh&&Yh.length)for(let Kh=0;Kh<Yh.length;Kh++){var Xh=$h.dataTransfer.files[0],jh=Xh.name;if(Hh.onDropFile&&Hh.onDropFile(Xh),Hh.onDropData){var qh=new FileReader;qh.onload=function(Qh){var Jh=Qh.target.result;Hh.onDropData(Jh,jh,Xh)};var Vh=Xh.type.split("/")[0];Vh=="text"||Vh==""?qh.readAsText(Xh):Vh=="image"?qh.readAsDataURL(Xh):qh.readAsArrayBuffer(Xh)}}}return Hh.onDropItem&&Hh.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}}}function checkDropItem($h){var Th;if($h.dataTransfer.files.length){var Fh=$h.dataTransfer.files[0],Wh=LGraphCanvas.getFileExtension(Fh.name).toLowerCase(),zh=LiteGraph.node_types_by_file_extension[Wh];if(zh){this.graph.beforeChange();var Hh=LiteGraph.createNode(zh.type);Hh.pos=[$h.canvasX,$h.canvasY],this.graph.add(Hh,!1,{doProcessChange:!1}),(Th=Hh.onDropFile)==null||Th.call(Hh,Fh),this.graph.onGraphChanged({action:"fileDrop",doSave:!0}),this.graph.afterChange()}}}class EventsController{constructor(Th){this.host=Th}processUserInputDown(...Th){return processUserInputDown.apply(this.host,Th)}processMouseDown(...Th){return processMouseDown.apply(this.host,Th)}processMouseMove(...Th){return processMouseMove.apply(this.host,Th)}processMouseUp(...Th){return processMouseUp.apply(this.host,Th)}processMouseWheel(...Th){return processMouseWheel.apply(this.host,Th)}blockClick(...Th){return blockClick.apply(this.host,Th)}processKey(...Th){return processKey.apply(this.host,Th)}processDrop(...Th){return processDrop.apply(this.host,Th)}checkDropItem(...Th){return checkDropItem.apply(this.host,Th)}}function draw($h,Th){var Fh;const Wh=((Fh=this.frontSurface)==null?void 0:Fh.canvas)||this.canvas;if(!(!Wh||Wh.width==0||Wh.height==0)){var zh=LiteGraph.getTime();this.render_time=(zh-this.last_draw_time)*.001,this.last_draw_time=zh,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||Th||this.always_render_background||this.graph&&this.graph._last_trigger_time&&zh-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas();var Hh=this.dirty_canvas||$h;if(Hh&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1,this.ds.scale<.7){if(Hh){var Uh=this.low_quality_rendering_threshold;const Yh=45;this.fps<Yh?(this.low_quality_rendering_counter+=Yh/this.fps,this.low_quality_rendering_counter=Math.min(this.low_quality_rendering_counter,2*Uh)):(this.low_quality_rendering_counter-=this.fps/Yh*.01,this.low_quality_rendering_counter=Math.max(this.low_quality_rendering_counter,0))}}else this.low_quality_rendering_counter=0}}function drawFrontCanvas(){var $h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh,qh,Vh,Zh,Kh,Qh,Jh,td,ed,id,sd;this.dirty_canvas=!1;const nd=($h=this.rendererAdapter)!=null?$h:null,hd=((Th=nd==null?void 0:nd.isLayerNative)==null?void 0:Th.call(nd,"front"))===!0,ud=((Fh=nd==null?void 0:nd.isLayerNative)==null?void 0:Fh.call(nd,"back"))===!0;this.ctx||(this.ctx=(Yh=(Uh=(Wh=nd==null?void 0:nd.getFrontCtx)==null?void 0:Wh.call(nd))!=null?Uh:(Hh=(zh=this.frontSurface)==null?void 0:zh.getContextCompat)==null?void 0:Hh.call(zh))!=null?Yh:null);var rd=this.ctx;if(!rd)return;(Xh=nd==null?void 0:nd.beginFrame)==null||Xh.call(nd,"front");var ad=((jh=this.frontSurface)==null?void 0:jh.canvas)||this.canvas;rd.start2D&&!this.viewport&&(rd.start2D(),rd.restore(),rd.setTransform(1,0,0,1,0,0));var dd=this.viewport||this.dirty_area;dd&&(rd.save(),rd.beginPath(),rd.rect(dd[0],dd[1],dd[2],dd[3]),rd.clip()),this.clear_background&&(dd?rd.clearRect(dd[0],dd[1],dd[2],dd[3]):rd.clearRect(0,0,ad.width,ad.height));const cd=((qh=this.backSurface)==null?void 0:qh.canvas)||this.bgcanvas;if(cd==ad?this.drawBackCanvas():cd&&((hd||ud)&&nd!=null&&nd.blitBackToFront?nd.blitBackToFront(rd):rd.drawImage(cd,0,0)),(Vh=this.onRender)==null||Vh.call(this,ad,rd),this.show_info&&this.renderInfo(rd,dd?dd[0]:0,dd?dd[1]:0),this.graph){rd.save(),this.ds.toCanvasContext(rd);var od=this.computeVisibleNodes(null,this.visible_nodes);const fd=((Zh=this.beginNodeFrameLeafer)==null?void 0:Zh.call(this,rd,od))===!0;for(let vd=0;vd<od.length;++vd){let yd=od[vd];fd?this.drawNode(yd,rd):(rd.save(),rd.translate(yd.pos[0],yd.pos[1]),this.drawNode(yd,rd),rd.restore())}if(fd&&(rd.save(),rd.setTransform(1,0,0,1,0,0),(Kh=this.endNodeFrameLeafer)==null||Kh.call(this,rd,od),rd.restore()),this.render_execution_order&&this.drawExecutionOrder(rd),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(rd)),this.connecting_pos!=null){rd.lineWidth=this.connections_width;var ld=null,_d=this.connecting_output||this.connecting_input,md=_d.type,gd=_d.dir;gd==null&&(this.connecting_output?gd=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:gd=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var wd=_d.shape;switch(md){case LiteGraph.EVENT:case LiteGraph.ACTION:ld=LiteGraph.EVENT_LINK_COLOR;break;default:ld=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(rd,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,ld,gd,LiteGraph.CENTER),rd.beginPath(),md===LiteGraph.EVENT||md===LiteGraph.ACTION||wd===LiteGraph.BOX_SHAPE?(rd.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),rd.fill(),rd.beginPath(),rd.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):wd===LiteGraph.ARROW_SHAPE?(rd.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),rd.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),rd.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),rd.closePath()):(rd.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),rd.fill(),rd.beginPath(),rd.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),rd.fill(),rd.fillStyle="#ffcc00",this._highlight_input){rd.beginPath();var $d=this._highlight_input_slot.shape;$d===LiteGraph.ARROW_SHAPE?(rd.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),rd.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),rd.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),rd.closePath()):rd.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),rd.fill()}this._highlight_output&&(rd.beginPath(),$d===LiteGraph.ARROW_SHAPE?(rd.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),rd.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),rd.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),rd.closePath()):rd.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),rd.fill())}this.dragging_rectangle&&(rd.strokeStyle="#FFF",rd.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(rd,this.over_link_center):(Qh=this.onDrawLinkTooltip)==null||Qh.call(this,rd,null),(Jh=this.onDrawForeground)==null||Jh.call(this,rd,this.visible_rect),rd.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(rd),(td=this.onDrawOverlay)==null||td.call(this,rd),dd&&rd.restore(),(ed=rd.finish2D)==null||ed.call(rd),(id=nd==null?void 0:nd.syncLayer)==null||id.call(nd,"front"),(sd=nd==null?void 0:nd.endFrame)==null||sd.call(nd,"front")}function lowQualityRenderingRequired($h){return this.ds.scale<$h?this.low_quality_rendering_counter>this.low_quality_rendering_threshold:!1}function createCompatGroup($h="Group"){return{__tag:$h,children:[],add(...Th){this.children.push(...Th.filter(Boolean))},clear(){this.children.length=0},remove(Th){const Fh=this.children.indexOf(Th);Fh>=0&&this.children.splice(Fh,1)},set(Th){Object.assign(this,Th)}}}function clearChildren($h){if($h){if(typeof $h.clear=="function"){$h.clear();return}if(typeof $h.removeAll=="function"){$h.removeAll();return}Array.isArray($h.children)&&($h.children.length=0)}}function addChildren($h,...Th){if(!(!$h||!Th.length)){if(typeof $h.add=="function"){for(const Fh of Th)Fh&&$h.add(Fh);return}Array.isArray($h.children)&&$h.children.push(...Th.filter(Boolean))}}function removeChild($h,Th){if(!(!$h||!Th)){if(typeof $h.remove=="function"){$h.remove(Th);return}if(Array.isArray($h.children)){const Fh=$h.children.indexOf(Th);Fh>=0&&$h.children.splice(Fh,1)}}}function setUiData($h,Th){if(!(!$h||!Th)){if(typeof $h.set=="function"){$h.set(Th);return}Object.assign($h,Th)}}function ensureRoundRectCompat$1($h){if(!(!$h||typeof $h.roundRect=="function")){if(typeof $h.rect=="function"){$h.roundRect=function(Th,Fh,Wh,zh){this.rect(Th,Fh,Wh,zh)};return}$h.roundRect=function(){}}}function sanitizeText($h){return $h==null?"":String($h)}function getTitleText($h){var Th,Fh,Wh,zh;try{return sanitizeText((Wh=(Fh=(Th=$h.getTitle)==null?void 0:Th.call($h))!=null?Fh:$h.title)!=null?Wh:"")}catch{return sanitizeText((zh=$h.title)!=null?zh:"")}}function getNodeTooltipText($h){var Th,Fh;let Wh=(Th=$h==null?void 0:$h.properties)==null?void 0:Th.tooltip;return(!Wh||Wh==="")&&LiteGraph.show_node_tooltip_use_descr_property&&(Wh=(Fh=$h==null?void 0:$h.constructor)==null?void 0:Fh.desc),sanitizeText(Wh).trim()}function hashWidgets($h=[]){return $h.length?$h.map(Th=>{var Fh,Wh,zh;return`${(Fh=Th==null?void 0:Th.name)!=null?Fh:""}:${(Wh=Th==null?void 0:Th.type)!=null?Wh:""}:${(zh=Th==null?void 0:Th.value)!=null?zh:""}:${Th!=null&&Th.disabled?1:0}`}).join("|"):"widgets:none"}function getFallbackCanvas($h,Th,Fh){var Wh,zh;const Hh=(zh=(Wh=$h==null?void 0:$h.createElement)==null?void 0:Wh.call($h,"canvas"))!=null?zh:typeof document!="undefined"?document.createElement("canvas"):null;return Hh?(Hh.width=Th,Hh.height=Fh,Hh):null}class LeaferNodeUiLayer{constructor(){this.runtime=null,this.ownerDocument=null,this.enableLogs=!1,this._bridgeCanvas=null,this._leafer=null,this._rootGroup=null,this._nodeViews=new Map,this._visibleNodeKeys=new Set,this._active=!1,this._nodeRenderMode="uiapi-experimental",this._parityContext=null}_log(Th,Fh){if(this.enableLogs){if(Fh!==void 0){console.info("[LiteGraph][LeaferNodeUI]",Th,Fh);return}console.info("[LiteGraph][LeaferNodeUI]",Th)}}_createUi(Th,Fh={}){var Wh;const zh=(Wh=this.runtime)==null?void 0:Wh[Th];if(typeof zh=="function")return new zh(Fh);const Hh=createCompatGroup(Th);return Object.assign(Hh,Fh),Hh}_createLeaferSurface(Th,Fh){var Wh,zh;const Hh=getFallbackCanvas(this.ownerDocument,Th,Fh);if(!Hh)throw new Error("Failed to create Leafer node bridge canvas.");const Uh=((Wh=this.runtime)==null?void 0:Wh.Leafer)||((zh=this.runtime)==null?void 0:zh.App);if(typeof Uh!="function")throw new Error("Leafer runtime missing Leafer/App constructor for node UI mode.");const Yh=new Uh({view:Hh,width:Th,height:Fh,hittable:!1}),Xh=this._createUi("Group",{x:0,y:0,hittable:!1});addChildren(Yh,Xh),this._bridgeCanvas=Hh,this._leafer=Yh,this._rootGroup=Xh}init({runtime:Th,ownerDocument:Fh,width:Wh,height:zh,enableLogs:Hh=!1}){return this.destroy(),this.runtime=Th,this.ownerDocument=Fh!=null?Fh:null,this.enableLogs=!!Hh,this._createLeaferSurface(Wh,zh),this._log("init",{width:Wh,height:zh}),this}destroy(){var Th,Fh;this._active=!1,this._visibleNodeKeys.clear(),this._nodeViews.clear(),this._parityContext=null,this._rootGroup=null,(Fh=(Th=this._leafer)==null?void 0:Th.destroy)==null||Fh.call(Th),this._leafer=null,this._bridgeCanvas=null}resize(Th,Fh){var Wh;if(this._bridgeCanvas){if(this._bridgeCanvas.width=Th,this._bridgeCanvas.height=Fh,typeof((Wh=this._leafer)==null?void 0:Wh.resize)=="function")try{this._leafer.resize({width:Th,height:Fh})}catch{this._leafer.resize(Th,Fh)}this._log("resize",{width:Th,height:Fh})}}beginFrame({nodeRenderMode:Th="uiapi-experimental"}={}){var Fh,Wh,zh,Hh;this._nodeRenderMode=Th,this._active=!0,this._visibleNodeKeys.clear(),Th==="uiapi-parity"&&this._bridgeCanvas&&(this._parityContext||(this._parityContext=this._bridgeCanvas.getContext("2d")),this._parityContext&&((Wh=(Fh=this._parityContext).setTransform)==null||Wh.call(Fh,1,0,0,1,0,0),(Hh=(zh=this._parityContext).clearRect)==null||Hh.call(zh,0,0,this._bridgeCanvas.width,this._bridgeCanvas.height)))}endFrame(){if(this._active){if(this._nodeRenderMode==="uiapi-parity"){this._active=!1;return}for(const[Th,Fh]of this._nodeViews.entries())this._visibleNodeKeys.has(Th)||(removeChild(this._rootGroup,Fh.group),this._nodeViews.delete(Th));this._active=!1}}renderTo(Th){var Fh,Wh;!this._bridgeCanvas||!Th||typeof Th.drawImage!="function"||(this._nodeRenderMode!=="uiapi-parity"&&((Wh=(Fh=this._leafer)==null?void 0:Fh.forceRender)==null||Wh.call(Fh,void 0,!0)),Th.drawImage(this._bridgeCanvas,0,0))}drawLegacyNode(Th,Fh,Wh){var zh,Hh,Uh,Yh,Xh,jh,qh,Vh,Zh,Kh;if(this._nodeRenderMode!=="uiapi-parity"||typeof Wh!="function")return;const Qh=this._parityContext||((Hh=(zh=this._bridgeCanvas)==null?void 0:zh.getContext)==null?void 0:Hh.call(zh,"2d"));if(!Qh||!Th||!Fh)return;this._parityContext=Qh;const Jh=((Uh=Fh==null?void 0:Fh.ds)==null?void 0:Uh.scale)||1,td=((Yh=Fh==null?void 0:Fh.ds)==null?void 0:Yh.offset)||[0,0],ed=((Xh=Th==null?void 0:Th.pos)==null?void 0:Xh[0])||0,id=((jh=Th==null?void 0:Th.pos)==null?void 0:jh[1])||0;(qh=Qh.save)==null||qh.call(Qh),(Vh=Qh.scale)==null||Vh.call(Qh,Jh,Jh),(Zh=Qh.translate)==null||Zh.call(Qh,ed+td[0],id+td[1]),Wh(Qh),(Kh=Qh.restore)==null||Kh.call(Qh)}_getNodeKey(Th){var Fh;return(Fh=Th==null?void 0:Th.id)!=null?Fh:Th}_createCallbackCanvas(Th,Fh,Wh){return this._createUi("Canvas",{x:0,y:Wh,width:Th,height:Fh,hittable:!1})}_ensureCallbackLayer(Th,Fh,Wh,zh,Hh,Uh){const Yh=Fh==="bg"?"callbackBgCanvas":"callbackFgCanvas";return Wh?(Th[Yh]?setUiData(Th[Yh],{y:-Uh,width:zh,height:Hh}):(Th[Yh]=this._createCallbackCanvas(zh,Hh,-Uh),Fh==="bg"?addChildren(Th.group,Th[Yh],Th.bodyGroup,Th.titleGroup,Th.slotsGroup,Th.widgetsGroup,Th.tooltipGroup):addChildren(Th.group,Th[Yh])),Th[Yh]):(Th[Yh]&&removeChild(Th.group,Th[Yh]),Th[Yh]=null,null)}_runCallbackLayer(Th,Fh,Wh,zh,Hh,Uh){var Yh,Xh,jh,qh,Vh,Zh,Kh,Qh,Jh,td,ed,id,sd;if(!Th||typeof Fh!="function")return;const nd=Th.context;if(!nd)return;ensureRoundRectCompat$1(nd);const hd=(jh=(Xh=Th.width)!=null?Xh:(Yh=nd.canvas)==null?void 0:Yh.width)!=null?jh:0,ud=(Zh=(Vh=Th.height)!=null?Vh:(qh=nd.canvas)==null?void 0:qh.height)!=null?Zh:0;(Kh=nd.save)==null||Kh.call(nd),(Qh=nd.setTransform)==null||Qh.call(nd,1,0,0,1,0,0),(Jh=nd.clearRect)==null||Jh.call(nd,0,0,hd,ud),(td=nd.scale)==null||td.call(nd,Hh,Hh),(ed=nd.translate)==null||ed.call(nd,0,Uh);const rd=Fh.apply(Wh!=null?Wh:null,zh);return(id=nd.restore)==null||id.call(nd),(sd=Th.paint)==null||sd.call(Th),rd}_computeHashes(Th,Fh){var Wh,zh,Hh,Uh,Yh,Xh,jh,qh,Vh,Zh;const Kh=(Th==null?void 0:Th.size)||[0,0],Qh=getTitleText(Th),Jh=getNodeTooltipText(Th);return{styleHash:[(Th==null?void 0:Th.color)||((Wh=Th==null?void 0:Th.constructor)==null?void 0:Wh.color)||LiteGraph.NODE_DEFAULT_COLOR,(Th==null?void 0:Th.bgcolor)||((zh=Th==null?void 0:Th.constructor)==null?void 0:zh.bgcolor)||LiteGraph.NODE_DEFAULT_BGCOLOR,Th!=null&&Th.is_selected?1:0,Th!=null&&Th.mouseOver?1:0].join("|"),layoutHash:[((Hh=Th==null?void 0:Th.pos)==null?void 0:Hh[0])||0,((Uh=Th==null?void 0:Th.pos)==null?void 0:Uh[1])||0,Kh[0],Kh[1],((Yh=Fh==null?void 0:Fh.ds)==null?void 0:Yh.scale)||1,((jh=(Xh=Fh==null?void 0:Fh.ds)==null?void 0:Xh.offset)==null?void 0:jh[0])||0,((Vh=(qh=Fh==null?void 0:Fh.ds)==null?void 0:qh.offset)==null?void 0:Vh[1])||0,(Zh=Th==null?void 0:Th.flags)!=null&&Zh.collapsed?1:0,Th!=null&&Th.horizontal?1:0,Qh].join("|"),widgetHash:hashWidgets((Th==null?void 0:Th.widgets)||[]),tooltipHash:`${Jh}|${Th!=null&&Th.mouseOver?1:0}|${Th!=null&&Th.is_selected?1:0}`,title:Qh,tooltip:Jh}}_getOrCreateView(Th){let Fh=this._nodeViews.get(Th);if(Fh)return Fh;const Wh=this._createUi("Group",{x:0,y:0,hittable:!1}),zh=this._createUi("Group",{hittable:!1}),Hh=this._createUi("Group",{hittable:!1}),Uh=this._createUi("Group",{hittable:!1}),Yh=this._createUi("Group",{hittable:!1}),Xh=this._createUi("Group",{hittable:!1});return addChildren(Wh,zh,Hh,Uh,Yh,Xh),addChildren(this._rootGroup,Wh),Fh={group:Wh,bodyGroup:zh,titleGroup:Hh,slotsGroup:Uh,widgetsGroup:Yh,tooltipGroup:Xh,callbackBgCanvas:null,callbackFgCanvas:null,styleHash:"",layoutHash:"",widgetHash:"",tooltipHash:""},this._nodeViews.set(Th,Fh),Fh}_updateNodeVisuals(Th,Fh,Wh,zh){var Hh,Uh,Yh,Xh,jh,qh,Vh,Zh,Kh,Qh,Jh,td,ed,id,sd;const nd=((Hh=Fh==null?void 0:Fh.ds)==null?void 0:Hh.scale)||1,hd=((Uh=Fh==null?void 0:Fh.ds)==null?void 0:Uh.offset)||[0,0],ud=LiteGraph.NODE_TITLE_HEIGHT,rd=(Th==null?void 0:Th.size)||[0,0],ad=Math.max(1,rd[0]*nd),dd=Math.max(1,rd[1]*nd),cd=ud*nd,od=(((Yh=Th==null?void 0:Th.pos)==null?void 0:Yh[0])+hd[0])*nd,ld=(((Xh=Th==null?void 0:Th.pos)==null?void 0:Xh[1])+hd[1])*nd;setUiData(Wh.group,{x:od,y:ld});const _d=!!((jh=Th==null?void 0:Th.flags)!=null&&jh.collapsed),md=typeof(Th==null?void 0:Th.onDrawBackground)=="function",gd=typeof(Th==null?void 0:Th.onDrawForeground)=="function"||typeof(Th==null?void 0:Th.onDrawTitle)=="function"||typeof(Th==null?void 0:Th.onDrawCollapsed)=="function",wd=Math.max(1,Math.ceil(ad+4)),$d=Math.max(1,Math.ceil(dd+cd+4)),fd=this._ensureCallbackLayer(Wh,"bg",md,wd,$d,cd),vd=this._ensureCallbackLayer(Wh,"fg",gd,wd,$d,cd),yd=_d?this._runCallbackLayer(vd,Th==null?void 0:Th.onDrawCollapsed,Th,[vd==null?void 0:vd.context,Fh],nd,ud)===!0:!1;if(yd)clearChildren(Wh.bodyGroup),clearChildren(Wh.titleGroup),clearChildren(Wh.slotsGroup),clearChildren(Wh.widgetsGroup),clearChildren(Wh.tooltipGroup);else{if(zh.styleHash!==Wh.styleHash||zh.layoutHash!==Wh.layoutHash){clearChildren(Wh.bodyGroup),clearChildren(Wh.titleGroup),clearChildren(Wh.slotsGroup);const xd=(Th==null?void 0:Th.color)||((qh=Th==null?void 0:Th.constructor)==null?void 0:qh.color)||LiteGraph.NODE_DEFAULT_COLOR,Td=(Th==null?void 0:Th.bgcolor)||((Vh=Th==null?void 0:Th.constructor)==null?void 0:Vh.bgcolor)||LiteGraph.NODE_DEFAULT_BGCOLOR,pd=this._createUi("Rect",{x:0,y:0,width:ad,height:dd,fill:Td,stroke:xd,strokeWidth:Math.max(1,nd),cornerRadius:((Fh==null?void 0:Fh.round_radius)||8)*nd,hittable:!1});if(addChildren(Wh.bodyGroup,pd),!_d){const Sd=this._createUi("Rect",{x:0,y:-cd,width:ad,height:cd,fill:xd,cornerRadius:[(Fh==null?void 0:Fh.round_radius)||8,(Fh==null?void 0:Fh.round_radius)||8,0,0].map(kd=>kd*nd),hittable:!1}),Ed=this._createUi("Text",{x:cd,y:-cd+(cd-14*nd)*.5,text:zh.title,fill:Th!=null&&Th.is_selected?LiteGraph.NODE_SELECTED_TITLE_COLOR:((Zh=Th==null?void 0:Th.constructor)==null?void 0:Zh.title_text_color)||(Fh==null?void 0:Fh.node_title_color)||LiteGraph.NODE_TEXT_COLOR,fontSize:Math.max(10,14*nd),hittable:!1});addChildren(Wh.titleGroup,Sd,Ed)}const bd=Math.max(3,4*nd),Cd=bd*2,Ld=new Float32Array(2);if(!_d&&Array.isArray(Th==null?void 0:Th.inputs))for(let Sd=0;Sd<Th.inputs.length;Sd+=1){const Ed=((Kh=Th.getConnectionPos)==null?void 0:Kh.call(Th,!0,Sd,Ld))||[Th.pos[0],Th.pos[1]],kd=(Ed[0]-Th.pos[0])*nd,Gd=(Ed[1]-Th.pos[1])*nd,Pd=this._createUi("Ellipse",{x:kd-bd,y:Gd-bd,width:Cd,height:Cd,fill:((Qh=Th.inputs[Sd])==null?void 0:Qh.color_on)||((Jh=Fh==null?void 0:Fh.default_connection_color)==null?void 0:Jh.input_off)||"#666",hittable:!1});addChildren(Wh.slotsGroup,Pd)}if(!_d&&Array.isArray(Th==null?void 0:Th.outputs))for(let Sd=0;Sd<Th.outputs.length;Sd+=1){const Ed=((td=Th.getConnectionPos)==null?void 0:td.call(Th,!1,Sd,Ld))||[Th.pos[0]+Th.size[0],Th.pos[1]],kd=(Ed[0]-Th.pos[0])*nd,Gd=(Ed[1]-Th.pos[1])*nd,Pd=this._createUi("Ellipse",{x:kd-bd,y:Gd-bd,width:Cd,height:Cd,fill:((ed=Th.outputs[Sd])==null?void 0:ed.color_on)||((id=Fh==null?void 0:Fh.default_connection_color)==null?void 0:id.output_off)||"#666",hittable:!1});addChildren(Wh.slotsGroup,Pd)}}if(zh.widgetHash!==Wh.widgetHash){clearChildren(Wh.widgetsGroup);const xd=(Th==null?void 0:Th.widgets)||[],Td=LiteGraph.NODE_WIDGET_HEIGHT;let pd=2;for(const bd of xd){const Cd=bd.y!=null?bd.y:pd;bd.last_y=Cd;const Ld=Cd*nd,Sd=Td*nd,Ed=this._createUi("Rect",{x:12*nd,y:Ld,width:Math.max(1,ad-24*nd),height:Sd,fill:LiteGraph.WIDGET_BGCOLOR||"#2A2A2A",stroke:LiteGraph.WIDGET_OUTLINE_COLOR||"#555",strokeWidth:Math.max(1,nd),cornerRadius:Math.max(2,4*nd),hittable:!1}),kd=this._createUi("Text",{x:18*nd,y:Ld+Sd*.2,text:`${bd.label||bd.name||"widget"}: ${(sd=bd.value)!=null?sd:""}`,fontSize:Math.max(10,12*nd),fill:LiteGraph.WIDGET_TEXT_COLOR||LiteGraph.NODE_TEXT_COLOR,hittable:!1});addChildren(Wh.widgetsGroup,Ed,kd),pd=Cd+Td+4}}if(zh.tooltipHash!==Wh.tooltipHash&&(clearChildren(Wh.tooltipGroup),LiteGraph.show_node_tooltip&&!!(Th!=null&&Th.mouseOver)&&!!(Th!=null&&Th.is_selected)&&zh.tooltip!=="")){const xd=Math.max(160*nd,Math.min(ad*1.2,320*nd)),Td=26*nd,pd=this._createUi("Rect",{x:(ad-xd)*.5,y:-(cd+Td+8*nd),width:xd,height:Td,fill:"#454",stroke:"#222",strokeWidth:Math.max(1,nd),cornerRadius:Math.max(3,4*nd),hittable:!1}),bd=this._createUi("Text",{x:ad*.5,y:pd.y+Td*.22,text:zh.tooltip.slice(0,120),fill:"#CEC",fontSize:Math.max(10,12*nd),textAlign:"center",hittable:!1});addChildren(Wh.tooltipGroup,pd,bd)}}this._runCallbackLayer(fd,Th==null?void 0:Th.onDrawBackground,Th,[fd==null?void 0:fd.context,Fh,Fh==null?void 0:Fh.canvas,Fh==null?void 0:Fh.graph_mouse],nd,ud),yd||(this._runCallbackLayer(vd,Th==null?void 0:Th.onDrawTitle,Th,[vd==null?void 0:vd.context],nd,ud),this._runCallbackLayer(vd,Th==null?void 0:Th.onDrawForeground,Th,[vd==null?void 0:vd.context,Fh,Fh==null?void 0:Fh.canvas],nd,ud)),Wh.styleHash=zh.styleHash,Wh.layoutHash=zh.layoutHash,Wh.widgetHash=zh.widgetHash,Wh.tooltipHash=zh.tooltipHash}upsertNode(Th,Fh){if(!this._rootGroup||!Th||!Fh)return;const Wh=this._getNodeKey(Th);this._visibleNodeKeys.add(Wh);const zh=this._getOrCreateView(Wh),Hh=this._computeHashes(Th,Fh);this._updateNodeVisuals(Th,Fh,zh,Hh)}}const titleGradientCacheByContext=new WeakMap;function ensureRoundRectCompat($h){if(!$h||typeof $h.roundRect=="function")return;const Th=typeof $h.rect=="function"?function(Fh,Wh,zh,Hh){this.rect(Fh,Wh,zh,Hh)}:function(){};try{$h.roundRect=Th}catch{}}function getTitleGradientCache($h){let Th=titleGradientCacheByContext.get($h);return Th||(Th=new Map,titleGradientCacheByContext.set($h,Th)),Th}function getTitleGradientForContext($h,Th){const Fh=Th||LiteGraph.NODE_DEFAULT_COLOR;if(!$h||typeof $h.createLinearGradient!="function")return Fh;const Wh=getTitleGradientCache($h);let zh=Wh.get(Fh);if(!zh){zh=$h.createLinearGradient(0,0,400,0);try{zh.addColorStop(0,Fh)}catch{zh.addColorStop(0,LiteGraph.NODE_DEFAULT_COLOR)}zh.addColorStop(1,"#000"),Wh.set(Fh,zh)}return zh}function shouldUseLeaferNodeUiMode($h){var Th,Fh;const Wh=$h==null?void 0:$h.rendererAdapter,zh=(Th=Wh==null?void 0:Wh.options)==null?void 0:Th.nodeRenderMode;return!Wh||zh!=="uiapi-experimental"&&zh!=="uiapi-parity"||((Fh=Wh.isLayerNative)==null?void 0:Fh.call(Wh,"front"))!==!0||typeof Wh.getLeaferRuntime!="function"?!1:!!Wh.getLeaferRuntime()}function isLeaferNodeUiParityMode($h){var Th,Fh;return((Fh=(Th=$h==null?void 0:$h.rendererAdapter)==null?void 0:Th.options)==null?void 0:Fh.nodeRenderMode)==="uiapi-parity"}function warnLeaferNodeUiFallback($h,Th,Fh){var Wh;$h!=null&&$h._leaferNodeUiWarned||($h._leaferNodeUiWarned=!0,(Wh=LiteGraph.warn)==null||Wh.call(LiteGraph,`[LeaferNodeUI] ${Th}`,Fh))}function ensureLeaferNodeUiLayer($h,Th){var Fh,Wh,zh,Hh,Uh,Yh,Xh;const jh=$h==null?void 0:$h.rendererAdapter,qh=(Fh=jh==null?void 0:jh.getLeaferRuntime)==null?void 0:Fh.call(jh);if(!qh)return warnLeaferNodeUiFallback($h,"runtime unavailable, fallback to legacy Canvas2D node rendering."),null;const Vh=((Wh=$h==null?void 0:$h.frontSurface)==null?void 0:Wh.canvas)||($h==null?void 0:$h.canvas)||(Th==null?void 0:Th.canvas);if(!Vh)return warnLeaferNodeUiFallback($h,"front canvas unavailable, fallback to legacy Canvas2D node rendering."),null;try{$h._leaferNodeUiLayer||($h._leaferNodeUiLayer=new LeaferNodeUiLayer),$h._leaferNodeUiLayer.runtime?(((Hh=$h._leaferNodeUiLayer._bridgeCanvas)==null?void 0:Hh.width)!==Vh.width||((Uh=$h._leaferNodeUiLayer._bridgeCanvas)==null?void 0:Uh.height)!==Vh.height)&&$h._leaferNodeUiLayer.resize(Vh.width,Vh.height):$h._leaferNodeUiLayer.init({runtime:qh,ownerDocument:Vh.ownerDocument,width:Vh.width,height:Vh.height,enableLogs:!!((zh=jh==null?void 0:jh.options)!=null&&zh.nodeRenderLogs)})}catch(Zh){return warnLeaferNodeUiFallback($h,"initialization failed, fallback to legacy Canvas2D node rendering.",Zh),(Xh=(Yh=$h._leaferNodeUiLayer)==null?void 0:Yh.destroy)==null||Xh.call(Yh),$h._leaferNodeUiLayer=null,null}return $h._leaferNodeUiLayer}function beginNodeFrameLeafer($h,Th){var Fh,Wh;if(!shouldUseLeaferNodeUiMode(this))return this._leaferNodeUiFrameActive=!1,!1;const zh=ensureLeaferNodeUiLayer(this,$h);if(!zh)return this._leaferNodeUiFrameActive=!1,!1;const Hh=((Wh=(Fh=this==null?void 0:this.rendererAdapter)==null?void 0:Fh.options)==null?void 0:Wh.nodeRenderMode)||"uiapi-experimental";return zh.beginFrame({nodeRenderMode:Hh}),this._leaferNodeUiFrameActive=!0,!0}function endNodeFrameLeafer($h,Th){!this._leaferNodeUiFrameActive||!this._leaferNodeUiLayer||(this._leaferNodeUiLayer.endFrame(),this._leaferNodeUiLayer.renderTo($h),this._leaferNodeUiFrameActive=!1)}function drawNode($h,Th){var Fh,Wh,zh;if(ensureRoundRectCompat(Th),shouldUseLeaferNodeUiMode(this)&&this._leaferNodeUiFrameActive&&this._leaferNodeUiLayer){if(isLeaferNodeUiParityMode(this)){const rd=this._leaferNodeUiFrameActive;this.current_node=$h,this._leaferNodeUiFrameActive=!1;try{this._leaferNodeUiLayer.drawLegacyNode($h,this,ad=>{drawNode.call(this,$h,ad)})}finally{this._leaferNodeUiFrameActive=rd}return}this.current_node=$h,this._leaferNodeUiLayer.upsertNode($h,this);return}this.current_node=$h;var Hh=$h.color||$h.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,Uh=$h.bgcolor||$h.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR,Yh=this.ds.scale<.6;if(this.live_mode){$h.flags.collapsed||(Th.shadowColor="transparent",(Fh=$h.onDrawForeground)==null||Fh.call($h,Th,this,this.canvas));return}var Xh=this.editor_alpha;if(Th.globalAlpha=Xh,this.render_shadows&&!Yh?(Th.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,Th.shadowOffsetX=2*this.ds.scale,Th.shadowOffsetY=2*this.ds.scale,Th.shadowBlur=3*this.ds.scale):Th.shadowColor="transparent",!($h.flags.collapsed&&(Wh=$h.onDrawCollapsed)!=null&&Wh.call($h,Th,this))){var jh=$h._shape||LiteGraph.BOX_SHAPE,qh=temp_vec2;temp_vec2.set($h.size);var Vh=$h.horizontal;if($h.flags.collapsed){Th.font=this.inner_text_font;var Zh=$h.getTitle?$h.getTitle():$h.title;Zh!=null&&($h._collapsed_width=Math.min($h.size[0],Th.measureText(Zh).width+LiteGraph.NODE_TITLE_HEIGHT*2),qh[0]=$h._collapsed_width,qh[1]=0)}($h.clip_area||this.clip_all_nodes)&&(Th.save(),Th.beginPath(),jh==LiteGraph.BOX_SHAPE?Th.rect(0,0,qh[0],qh[1]):jh==LiteGraph.ROUND_SHAPE?Th.roundRect(0,0,qh[0],qh[1],[10]):jh==LiteGraph.CIRCLE_SHAPE&&Th.arc(qh[0]*.5,qh[1]*.5,qh[0]*.5,0,Math.PI*2),Th.clip()),$h.has_errors&&(Uh="red"),this.drawNodeShape($h,Th,qh,Hh,Uh,$h.is_selected,$h.mouseOver),Th.shadowColor="transparent",(zh=$h.onDrawForeground)==null||zh.call($h,Th,this,this.canvas),LiteGraph.show_node_tooltip&&$h.mouseOver&&$h.is_selected&&(!this.selected_nodes||Object.keys(this.selected_nodes).length<=1)&&this.drawNodeTooltip(Th,$h),Th.textAlign=Vh?"center":"left",Th.font=this.inner_text_font;var Kh=!this.lowQualityRenderingRequired(.6),Qh=this.connecting_output,Jh=this.connecting_input;Th.lineWidth=1;var td=0,ed=new Float32Array(2),id;if($h.flags.collapsed){if(this.render_collapsed_slots){var sd=null,nd=null;if($h.inputs)for(let rd=0;rd<$h.inputs.length;rd++){var hd=$h.inputs[rd];if(hd.link!=null){sd=hd;break}}if($h.outputs)for(let rd=0;rd<$h.outputs.length;rd++){var hd=$h.outputs[rd];!hd.links||!hd.links.length||(nd=hd)}if(sd){let rd=0,ad=LiteGraph.NODE_TITLE_HEIGHT*-.5;Vh&&(rd=$h._collapsed_width*.5,ad=-LiteGraph.NODE_TITLE_HEIGHT),Th.fillStyle="#686",Th.beginPath(),hd.type===LiteGraph.EVENT||hd.type===LiteGraph.ACTION||hd.shape===LiteGraph.BOX_SHAPE?Th.rect(rd-7+.5,ad-4,14,8):hd.shape===LiteGraph.ARROW_SHAPE?(Th.moveTo(rd+8,ad),Th.lineTo(rd+-4,ad-4),Th.lineTo(rd+-4,ad+4),Th.closePath()):Th.arc(rd,ad,4,0,Math.PI*2),Th.fill()}if(nd){let rd=$h._collapsed_width,ad=LiteGraph.NODE_TITLE_HEIGHT*-.5;Vh&&(rd=$h._collapsed_width*.5,ad=0),Th.fillStyle="#686",Th.strokeStyle="black",Th.beginPath(),hd.type===LiteGraph.EVENT||hd.type===LiteGraph.ACTION||hd.shape===LiteGraph.BOX_SHAPE?Th.rect(rd-7+.5,ad-4,14,8):hd.shape===LiteGraph.ARROW_SHAPE?(Th.moveTo(rd+6,ad),Th.lineTo(rd-6,ad-4),Th.lineTo(rd-6,ad+4),Th.closePath()):Th.arc(rd,ad,4,0,Math.PI*2),Th.fill()}}}else{if($h.inputs)for(let rd=0;rd<$h.inputs.length;rd++){let ad=$h.inputs[rd],dd=ad.type,cd=ad.shape;Th.globalAlpha=Xh,this.connecting_output&&!LiteGraph.isValidConnection(ad.type,Qh.type)&&(Th.globalAlpha=.4*Xh),Th.fillStyle=ad.link!=null?ad.color_on||this.default_connection_color_byType[dd]||this.default_connection_color.input_on:ad.color_off||this.default_connection_color_byTypeOff[dd]||this.default_connection_color_byType[dd]||this.default_connection_color.input_off;let od=$h.getConnectionPos(!0,rd,ed);if(od[0]-=$h.pos[0],od[1]-=$h.pos[1],td<od[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(td=od[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),Th.beginPath(),dd=="array"?cd=LiteGraph.GRID_SHAPE:ad.name=="onTrigger"||ad.name=="onExecuted"?cd=LiteGraph.ARROW_SHAPE:(dd===LiteGraph.EVENT||dd===LiteGraph.ACTION)&&(cd=LiteGraph.BOX_SHAPE),id=!0,cd===LiteGraph.BOX_SHAPE?Vh?Th.rect(od[0]-5+.5,od[1]-8+.5,10,14):Th.rect(od[0]-6+.5,od[1]-5+.5,14,10):cd===LiteGraph.ARROW_SHAPE?(Th.moveTo(od[0]+8,od[1]+.5),Th.lineTo(od[0]-4,od[1]+6+.5),Th.lineTo(od[0]-4,od[1]-6+.5),Th.closePath()):cd===LiteGraph.GRID_SHAPE?(Th.rect(od[0]-4,od[1]-4,2,2),Th.rect(od[0]-1,od[1]-4,2,2),Th.rect(od[0]+2,od[1]-4,2,2),Th.rect(od[0]-4,od[1]-1,2,2),Th.rect(od[0]-1,od[1]-1,2,2),Th.rect(od[0]+2,od[1]-1,2,2),Th.rect(od[0]-4,od[1]+2,2,2),Th.rect(od[0]-1,od[1]+2,2,2),Th.rect(od[0]+2,od[1]+2,2,2),id=!1):Yh?Th.rect(od[0]-4,od[1]-4,8,8):Th.arc(od[0],od[1],4,0,Math.PI*2),Th.fill(),Kh&&!(ad.name=="onTrigger"||ad.name=="onExecuted")){let ld=ad.label!=null?ad.label:ad.name;ld&&(Th.fillStyle=LiteGraph.NODE_TEXT_COLOR,Vh||ad.dir==LiteGraph.UP?Th.fillText(ld,od[0],od[1]-10):Th.fillText(ld,od[0]+10,od[1]+5))}}if(Th.textAlign=Vh?"center":"right",Th.strokeStyle="black",$h.outputs)for(let rd=0;rd<$h.outputs.length;rd++){let ad=$h.outputs[rd],dd=ad.type,cd=ad.shape;this.connecting_input&&!LiteGraph.isValidConnection(dd,Jh.type)&&(Th.globalAlpha=.4*Xh);let od=$h.getConnectionPos(!1,rd,ed);if(od[0]-=$h.pos[0],od[1]-=$h.pos[1],td<od[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(td=od[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),Th.fillStyle=ad.links&&ad.links.length?ad.color_on||this.default_connection_color_byType[dd]||this.default_connection_color.output_on:ad.color_off||this.default_connection_color_byTypeOff[dd]||this.default_connection_color_byType[dd]||this.default_connection_color.output_off,Th.beginPath(),dd=="array"?cd=LiteGraph.GRID_SHAPE:ad.name=="onTrigger"||ad.name=="onExecuted"?cd=LiteGraph.ARROW_SHAPE:(dd===LiteGraph.EVENT||dd===LiteGraph.ACTION)&&(cd=LiteGraph.BOX_SHAPE),id=!0,cd===LiteGraph.BOX_SHAPE?Vh?Th.rect(od[0]-5+.5,od[1]-8+.5,10,14):Th.rect(od[0]-6+.5,od[1]-5+.5,14,10):cd===LiteGraph.ARROW_SHAPE?(Th.moveTo(od[0]+8,od[1]+.5),Th.lineTo(od[0]-4,od[1]+6+.5),Th.lineTo(od[0]-4,od[1]-6+.5),Th.closePath()):cd===LiteGraph.GRID_SHAPE?(Th.rect(od[0]-4,od[1]-4,2,2),Th.rect(od[0]-1,od[1]-4,2,2),Th.rect(od[0]+2,od[1]-4,2,2),Th.rect(od[0]-4,od[1]-1,2,2),Th.rect(od[0]-1,od[1]-1,2,2),Th.rect(od[0]+2,od[1]-1,2,2),Th.rect(od[0]-4,od[1]+2,2,2),Th.rect(od[0]-1,od[1]+2,2,2),Th.rect(od[0]+2,od[1]+2,2,2),id=!1):Yh?Th.rect(od[0]-4,od[1]-4,8,8):Th.arc(od[0],od[1],4,0,Math.PI*2),Th.fill(),!Yh&&id&&Th.stroke(),Kh&&!(ad.name=="onTrigger"||ad.name=="onExecuted")){let ld=ad.label!=null?ad.label:ad.name;ld&&(Th.fillStyle=LiteGraph.NODE_TEXT_COLOR,Vh||ad.dir==LiteGraph.DOWN?Th.fillText(ld,od[0],od[1]-8):Th.fillText(ld,od[0]-10,od[1]+5))}}if(Th.textAlign="left",Th.globalAlpha=1,$h.widgets){var ud=td;(Vh||$h.widgets_up)&&(ud=2),$h.widgets_start_y!=null&&(ud=$h.widgets_start_y),this.drawNodeWidgets($h,ud,Th,this.node_widget&&this.node_widget[0]==$h?this.node_widget[1]:null)}}($h.clip_area||this.clip_all_nodes)&&Th.restore(),Th.globalAlpha=1}}function drawNodeTooltip($h,Th){var Fh;if(!Th||!$h){(Fh=LiteGraph.warn)==null||Fh.call(LiteGraph,"drawNodeTooltip: invalid node or ctx",Th,$h);return}ensureRoundRectCompat($h);var Wh=Th.properties.tooltip!=null?Th.properties.tooltip:"";if((!Wh||Wh=="")&&LiteGraph.show_node_tooltip_use_descr_property&&Th.constructor.desc&&(Wh=Th.constructor.desc),Wh=(Wh+"").trim(),!(!Wh||Wh=="")){var zh=[0,-LiteGraph.NODE_TITLE_HEIGHT],Hh=Th.flags.collapsed?[LiteGraph.NODE_COLLAPSED_WIDTH,LiteGraph.NODE_TITLE_HEIGHT]:Th.size;$h.font="14px Courier New",$h.measureText(Wh);var Uh=Math.max(Th.size[0],160)+20,Yh=Th.ttip_oTMultiRet?Th.ttip_oTMultiRet.height+15:21;$h.globalAlpha=.7*this.editor_alpha,$h.shadowColor=Th.ttip_oTMultiRet?"black":"transparent",$h.shadowOffsetX=2,$h.shadowOffsetY=2,$h.shadowBlur=3,$h.fillStyle=Th.ttip_oTMultiRet?"#454":"transparent",$h.beginPath(),$h.roundRect(zh[0]-Uh*.5+Hh[0]/2,zh[1]-15-Yh,Uh,Yh,[3]),$h.moveTo(zh[0]-10+Hh[0]/2,zh[1]-15),$h.lineTo(zh[0]+10+Hh[0]/2,zh[1]-15),$h.lineTo(zh[0]+Hh[0]/2,zh[1]-5),$h.fill(),$h.shadowColor="transparent",$h.textAlign="center",$h.fillStyle=Th.ttip_oTMultiRet?"#CEC":"transparent",$h.globalAlpha=this.editor_alpha;var Xh=LiteGraph.canvasFillTextMultiline($h,Wh,zh[0]+Hh[0]/2,zh[1]-Yh,Uh,14);Th.ttip_oTMultiRet=Xh,$h.closePath()}}function drawNodeShape($h,Th,Fh,Wh,zh,Hh,Uh){var Yh;ensureRoundRectCompat(Th),Th.strokeStyle=Wh,Th.fillStyle=zh;var Xh=LiteGraph.NODE_TITLE_HEIGHT,jh=this.lowQualityRenderingRequired(.5),qh=$h._shape||$h.constructor.shape||LiteGraph.ROUND_SHAPE,Vh=$h.constructor.title_mode,Zh=!0;Vh==LiteGraph.TRANSPARENT_TITLE||Vh==LiteGraph.NO_TITLE?Zh=!1:Vh==LiteGraph.AUTOHIDE_TITLE&&Uh&&(Zh=!0);var Kh=tmp_area;Kh[0]=0,Kh[1]=Zh?-Xh:0,Kh[2]=Fh[0]+1,Kh[3]=Zh?Fh[1]+Xh:Fh[1];var Qh=Th.globalAlpha;if(Th.beginPath(),qh==LiteGraph.BOX_SHAPE||jh?Th.fillRect(Kh[0],Kh[1],Kh[2],Kh[3]):qh==LiteGraph.ROUND_SHAPE||qh==LiteGraph.CARD_SHAPE?Th.roundRect(Kh[0],Kh[1],Kh[2],Kh[3],qh==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):qh==LiteGraph.CIRCLE_SHAPE&&Th.arc(Fh[0]*.5,Fh[1]*.5,Fh[0]*.5,0,Math.PI*2),Th.fill(),!$h.flags.collapsed&&Zh&&(Th.shadowColor="transparent",Th.fillStyle="rgba(0,0,0,0.2)",Th.fillRect(0,-1,Kh[2],2)),Th.shadowColor="transparent",(Yh=$h.onDrawBackground)==null||Yh.call($h,Th,this,this.canvas,this.graph_mouse),Zh||Vh==LiteGraph.TRANSPARENT_TITLE){if($h.onDrawTitleBar)$h.onDrawTitleBar(Th,Xh,Fh,this.ds.scale,Wh);else if(Vh!=LiteGraph.TRANSPARENT_TITLE&&($h.constructor.title_color||this.render_title_colored)){var Jh=$h.constructor.title_color||Wh;$h.flags.collapsed&&(Th.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients?Th.fillStyle=getTitleGradientForContext(Th,Jh):Th.fillStyle=Jh,Th.beginPath(),qh==LiteGraph.BOX_SHAPE||jh?Th.rect(0,-Xh,Fh[0]+1,Xh):(qh==LiteGraph.ROUND_SHAPE||qh==LiteGraph.CARD_SHAPE)&&Th.roundRect(0,-Xh,Fh[0]+1,Xh,$h.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),Th.fill(),Th.shadowColor="transparent"}let hd=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[$h.mode]&&(hd=LiteGraph.NODE_MODES_COLORS[$h.mode]),LiteGraph.node_box_coloured_when_on&&(hd=$h.action_triggered?"#FFF":$h.execute_triggered?"#AAA":hd);var td=10;if($h.onDrawTitleBox?$h.onDrawTitleBox(Th,Xh,Fh,this.ds.scale):qh==LiteGraph.ROUND_SHAPE||qh==LiteGraph.CIRCLE_SHAPE||qh==LiteGraph.CARD_SHAPE?(jh&&(Th.fillStyle="black",Th.beginPath(),Th.arc(Xh*.5,Xh*-.5,td*.5+1,0,Math.PI*2),Th.fill()),Th.fillStyle=$h.boxcolor||hd||LiteGraph.NODE_DEFAULT_BOXCOLOR,jh?Th.fillRect(Xh*.5-td*.5,Xh*-.5-td*.5,td,td):(Th.beginPath(),Th.arc(Xh*.5,Xh*-.5,td*.5,0,Math.PI*2),Th.fill())):(jh&&(Th.fillStyle="black",Th.fillRect((Xh-td)*.5-1,(Xh+td)*-.5-1,td+2,td+2)),Th.fillStyle=$h.boxcolor||hd||LiteGraph.NODE_DEFAULT_BOXCOLOR,Th.fillRect((Xh-td)*.5,(Xh+td)*-.5,td,td)),Th.globalAlpha=Qh,$h.onDrawTitleText&&$h.onDrawTitleText(Th,Xh,Fh,this.ds.scale,this.title_text_font,Hh),!jh){Th.font=this.title_text_font;var ed=String($h.getTitle());ed&&(Hh?Th.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:Th.fillStyle=$h.constructor.title_text_color||this.node_title_color,$h.flags.collapsed?(Th.textAlign="left",Th.fillText(ed.substring(0,20),Xh,LiteGraph.NODE_TITLE_TEXT_Y-Xh),Th.textAlign="left"):(Th.textAlign="left",Th.fillText(ed,Xh,LiteGraph.NODE_TITLE_TEXT_Y-Xh)))}if(!$h.flags.collapsed&&$h.subgraph&&!$h.skip_subgraph_button){var id=LiteGraph.NODE_TITLE_HEIGHT,sd=$h.size[0]-id,nd=LiteGraph.isInsideRectangle(this.graph_mouse[0]-$h.pos[0],this.graph_mouse[1]-$h.pos[1],sd+2,-id+2,id-4,id-4);Th.fillStyle=nd?"#888":"#555",qh==LiteGraph.BOX_SHAPE||jh?Th.fillRect(sd+2,-id+2,id-4,id-4):(Th.beginPath(),Th.roundRect(sd+2,-id+2,id-4,id-4,[4]),Th.fill()),Th.fillStyle="#333",Th.beginPath(),Th.moveTo(sd+id*.2,-id*.6),Th.lineTo(sd+id*.8,-id*.6),Th.lineTo(sd+id*.5,-id*.3),Th.fill()}$h.onDrawTitle&&$h.onDrawTitle(Th)}Hh&&($h.onBounding&&$h.onBounding(Kh),Vh==LiteGraph.TRANSPARENT_TITLE&&(Kh[1]-=Xh,Kh[3]+=Xh),Th.lineWidth=1,Th.globalAlpha=.8,Th.beginPath(),qh==LiteGraph.BOX_SHAPE?Th.rect(-6+Kh[0],-6+Kh[1],12+Kh[2],12+Kh[3]):qh==LiteGraph.ROUND_SHAPE||qh==LiteGraph.CARD_SHAPE&&$h.flags.collapsed?Th.roundRect(-6+Kh[0],-6+Kh[1],12+Kh[2],12+Kh[3],[this.round_radius*2]):qh==LiteGraph.CARD_SHAPE?Th.roundRect(-6+Kh[0],-6+Kh[1],12+Kh[2],12+Kh[3],[this.round_radius*2,2,this.round_radius*2,2]):qh==LiteGraph.CIRCLE_SHAPE&&Th.arc(Fh[0]*.5,Fh[1]*.5,Fh[0]*.5+6,0,Math.PI*2),Th.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,Th.stroke(),Th.strokeStyle=Wh,Th.globalAlpha=1),$h.execute_triggered>0&&$h.execute_triggered--,$h.action_triggered>0&&$h.action_triggered--}function drawExecutionOrder($h){$h.shadowColor="transparent",$h.globalAlpha=.25,$h.textAlign="center",$h.strokeStyle="white",$h.globalAlpha=.75;var Th=this.visible_nodes;for(let Wh=0;Wh<Th.length;++Wh){var Fh=Th[Wh];$h.fillStyle="black",$h.fillRect(Fh.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,Fh.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),Fh.order==0&&$h.strokeRect(Fh.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,Fh.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),$h.fillStyle="#FFF",$h.fillText(Fh.order,Fh.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,Fh.pos[1]-6)}$h.globalAlpha=1}function drawNodeWidgets($h,Th,Fh,Wh){if(!$h.widgets||!$h.widgets.length)return 0;ensureRoundRectCompat(Fh);var zh=$h.size[0],Hh=$h.widgets;Th+=2;var Uh=LiteGraph.NODE_WIDGET_HEIGHT,Yh=!this.lowQualityRenderingRequired(.5);Fh.save(),Fh.globalAlpha=this.editor_alpha;var Xh=LiteGraph.WIDGET_OUTLINE_COLOR,jh=LiteGraph.WIDGET_BGCOLOR,qh=LiteGraph.WIDGET_TEXT_COLOR,Vh=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,Zh=15;for(let hd=0;hd<Hh.length;++hd){var Kh=Hh[hd],Qh=Th;Kh.y&&(Qh=Kh.y),Kh.last_y=Qh,Fh.strokeStyle=Xh,Fh.fillStyle="#222",Fh.textAlign="left",Kh.disabled&&(Fh.globalAlpha*=.5);var Jh=Kh.width||zh;switch(Kh.type){case"button":Kh.clicked&&(Fh.fillStyle="#AAA",Kh.clicked=!1,this.dirty_canvas=!0),Fh.fillRect(Zh,Qh,Jh-Zh*2,Uh),Yh&&!Kh.disabled&&Fh.strokeRect(Zh,Qh,Jh-Zh*2,Uh),Yh&&(Fh.textAlign="center",Fh.fillStyle=qh,Fh.fillText(Kh.label||Kh.name,Jh*.5,Qh+Uh*.7));break;case"toggle":if(Fh.textAlign="left",Fh.strokeStyle=Xh,Fh.fillStyle=jh,Fh.beginPath(),Yh?Fh.roundRect(Zh,Qh,Jh-Zh*2,Uh,[Uh*.5]):Fh.rect(Zh,Qh,Jh-Zh*2,Uh),Fh.fill(),Yh&&!Kh.disabled&&Fh.stroke(),Fh.fillStyle=Kh.value?"#89A":"#333",Fh.beginPath(),Fh.arc(Jh-Zh*2,Qh+Uh*.5,Uh*.36,0,Math.PI*2),Fh.fill(),Yh){Fh.fillStyle=Vh;const ud=Kh.label||Kh.name;ud!=null&&Fh.fillText(ud,Zh*2,Qh+Uh*.7),Fh.fillStyle=Kh.value?qh:Vh,Fh.textAlign="right",Fh.fillText(Kh.value?Kh.options.on||"true":Kh.options.off||"false",Jh-40,Qh+Uh*.7)}break;case"slider":Fh.fillStyle=jh,Fh.fillRect(Zh,Qh,Jh-Zh*2,Uh);var td=Kh.options.max-Kh.options.min,ed=(Kh.value-Kh.options.min)/td;if(ed<0&&(ed=0),ed>1&&(ed=1),Fh.fillStyle=Kh.options.hasOwnProperty("slider_color")?Kh.options.slider_color:Wh==Kh?"#89A":"#678",Fh.fillRect(Zh,Qh,ed*(Jh-Zh*2),Uh),Yh&&!Kh.disabled&&Fh.strokeRect(Zh,Qh,Jh-Zh*2,Uh),Kh.marker){var id=(Kh.marker-Kh.options.min)/td;id<0&&(id=0),id>1&&(id=1),Fh.fillStyle=Kh.options.hasOwnProperty("marker_color")?Kh.options.marker_color:"#AA9",Fh.fillRect(Zh+id*(Jh-Zh*2),Qh,2,Uh)}Yh&&(Fh.textAlign="center",Fh.fillStyle=qh,Fh.fillText(Kh.label||Kh.name+"  "+Number(Kh.value).toFixed(Kh.options.precision!=null?Kh.options.precision:3),Jh*.5,Qh+Uh*.7));break;case"number":case"combo":if(Fh.textAlign="left",Fh.strokeStyle=Xh,Fh.fillStyle=jh,Fh.beginPath(),Yh?Fh.roundRect(Zh,Qh,Jh-Zh*2,Uh,[Uh*.5]):Fh.rect(Zh,Qh,Jh-Zh*2,Uh),Fh.fill(),Yh)if(Kh.disabled||Fh.stroke(),Fh.fillStyle=qh,Kh.disabled||(Fh.beginPath(),Fh.moveTo(Zh+16,Qh+5),Fh.lineTo(Zh+6,Qh+Uh*.5),Fh.lineTo(Zh+16,Qh+Uh-5),Fh.fill(),Fh.beginPath(),Fh.moveTo(Jh-Zh-16,Qh+5),Fh.lineTo(Jh-Zh-6,Qh+Uh*.5),Fh.lineTo(Jh-Zh-16,Qh+Uh-5),Fh.fill()),Fh.fillStyle=Vh,Fh.fillText(Kh.label||Kh.name,Zh*2+5,Qh+Uh*.7),Fh.fillStyle=qh,Fh.textAlign="right",Kh.type=="number")Fh.fillText(Number(Kh.value).toFixed(Kh.options.precision!==void 0?Kh.options.precision:3),Jh-Zh*2-20,Qh+Uh*.7);else{var sd=Kh.value;if(Kh.options.values){var nd=Kh.options.values;nd.constructor===Function&&(nd=nd()),nd&&nd.constructor!==Array&&(sd=nd[Kh.value])}Fh.fillText(sd,Jh-Zh*2-20,Qh+Uh*.7)}break;case"string":case"text":if(Fh.textAlign="left",Fh.strokeStyle=Xh,Fh.fillStyle=jh,Fh.beginPath(),Yh?Fh.roundRect(Zh,Qh,Jh-Zh*2,Uh,[Uh*.5]):Fh.rect(Zh,Qh,Jh-Zh*2,Uh),Fh.fill(),Yh){Kh.disabled||Fh.stroke(),Fh.save(),Fh.beginPath(),Fh.rect(Zh,Qh,Jh-Zh*2,Uh),Fh.clip(),Fh.fillStyle=Vh;const ud=Kh.label||Kh.name;ud!=null&&Fh.fillText(ud,Zh*2,Qh+Uh*.7),Fh.fillStyle=qh,Fh.textAlign="right",Fh.fillText(String(Kh.value).substr(0,30),Jh-Zh*2,Qh+Uh*.7),Fh.restore()}break;default:Kh.draw&&Kh.draw(Fh,$h,Jh,Qh,Uh);break}Th+=(Kh.computeSize?Kh.computeSize(Jh)[1]:Uh)+4,Fh.globalAlpha=this.editor_alpha}Fh.restore(),Fh.textAlign="left"}function processNodeWidgets(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow();for(let i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type==="pointerdown"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var nvalue=LiteGraph.clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value,old_value)},20),this.dirty_canvas=!0;break;case"number":case"combo":case"enum":if(event.type=="pointermove"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type=="pointerdown"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));let $h=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=$h*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if($h){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+$h:index=values_list.indexOf(w.value)+$h,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let Th=function(Fh){return values!=values_list&&(Fh=text_values.indexOf(Fh)),this.value=Fh,inner_value_change(this,Fh,old_value),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:Th.bind(w)},ref_window)}}else if(event.type=="pointerup"&&w.type=="number"){let delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,function(v){var el;if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch($h){(el=LiteGraph.warn)==null||el.call(LiteGraph,$h)}this.value=Number(v),inner_value_change(this,this.value,old_value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value,old_value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type=="pointerdown"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type=="pointerdown"&&this.prompt("Value",w.value,function($h){inner_value_change(this,$h)}.bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return w}}}function inner_value_change($h,Th,Fh){var Wh;(Wh=LiteGraph.debug)==null||Wh.call(LiteGraph,"inner_value_change for processNodeWidgets",$h,Th),Fh!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,Fh,w),node.graph.onGraphChanged({action:"widgetChanged",doSave:!0})),$h.type=="number"&&(Th=Number(Th)),$h.value=Th,$h.options&&$h.options.property&&node.properties[$h.options.property]!==void 0&&node.setProperty($h.options.property,Th),$h.callback&&$h.callback($h.value,that,node,pos,event)}return null}function adjustNodesSize(){var $h=this.graph._nodes;for(let Th=0;Th<$h.length;++Th)$h[Th].size=$h[Th].computeSize();this.setDirty(!0,!0)}function drawLinkTooltip($h,Th){var Fh,Wh=Th._pos;if($h.fillStyle="black",$h.beginPath(),$h.arc(Wh[0],Wh[1],3,0,Math.PI*2),$h.fill(),Th.data!=null&&!((Fh=this.onDrawLinkTooltip)!=null&&Fh.call(this,$h,Th,this))){var zh=Th.data,Hh=null;if(zh.constructor===Number?Hh=zh.toFixed(2):zh.constructor===String?Hh='"'+zh+'"':zh.constructor===Boolean?Hh=String(zh):zh.toToolTip?Hh=zh.toToolTip():Hh="["+zh.constructor.name+"]",Hh!=null){Hh=Hh.substr(0,30),$h.font="14px Courier New";var Uh=$h.measureText(Hh),Yh=Uh.width+20,Xh=24;$h.shadowColor="black",$h.shadowOffsetX=2,$h.shadowOffsetY=2,$h.shadowBlur=3,$h.fillStyle="#454",$h.beginPath(),$h.roundRect(Wh[0]-Yh*.5,Wh[1]-15-Xh,Yh,Xh,[3]),$h.moveTo(Wh[0]-10,Wh[1]-15),$h.lineTo(Wh[0]+10,Wh[1]-15),$h.lineTo(Wh[0],Wh[1]-5),$h.fill(),$h.shadowColor="transparent",$h.textAlign="center",$h.fillStyle="#CEC",$h.fillText(Hh,Wh[0],Wh[1]-15-Xh*.3)}}}function drawConnections($h){var Th=LiteGraph.getTime(),Fh=this.visible_area;margin_area[0]=Fh[0]-20,margin_area[1]=Fh[1]-20,margin_area[2]=Fh[2]+40,margin_area[3]=Fh[3]+40,$h.lineWidth=this.connections_width,$h.fillStyle="#AAA",$h.strokeStyle="#AAA",$h.globalAlpha=this.editor_alpha;for(var Wh=this.graph._nodes,zh=0,Hh=Wh.length;zh<Hh;++zh){var Uh=Wh[zh];if(!(!Uh.inputs||!Uh.inputs.length))for(let nd=0;nd<Uh.inputs.length;++nd){var Yh=Uh.inputs[nd];if(!(!Yh||Yh.link==null)){var Xh=Yh.link,jh=this.graph.links[Xh];if(jh){var qh=this.graph.getNodeById(jh.origin_id);if(qh!=null){var Vh=jh.origin_slot,Zh=null;Vh==-1?Zh=[qh.pos[0]+10,qh.pos[1]+10]:Zh=qh.getConnectionPos(!1,Vh,tempA);var Kh=Uh.getConnectionPos(!0,nd,tempB);if(link_bounding[0]=Zh[0],link_bounding[1]=Zh[1],link_bounding[2]=Kh[0]-Zh[0],link_bounding[3]=Kh[1]-Zh[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!LiteGraph.overlapBounding(link_bounding,margin_area)){var Qh=qh.outputs[Vh],Jh=Uh.inputs[nd];if(!(!Qh||!Jh)){var td=Qh.dir||(qh.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),ed=Jh.dir||(Uh.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink($h,Zh,Kh,jh,!1,0,null,td,ed),jh&&jh._last_time&&Th-jh._last_time<1e3){var id=2-(Th-jh._last_time)*.002,sd=$h.globalAlpha;$h.globalAlpha=sd*id,this.renderLink($h,Zh,Kh,jh,!0,id,"white",td,ed),$h.globalAlpha=sd}}}}}}}}$h.globalAlpha=1}function renderLink($h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh){Wh&&this.visible_links.push(Wh),!Uh&&Wh&&(Uh=Wh.color||LGraphCanvas.link_type_colors[Wh.type]),Uh||(Uh=this.default_link_color),Wh!=null&&this.highlighted_links[Wh.id]&&(Uh="#FFF"),Yh=Yh||LiteGraph.RIGHT,Xh=Xh||LiteGraph.LEFT;var qh=LiteGraph.distance(Th,Fh);this.render_connections_border&&this.ds.scale>.6&&($h.lineWidth=this.connections_width+4),$h.lineJoin="round",jh=jh||1,jh>1&&($h.lineWidth=.5),$h.beginPath();for(let dd=0;dd<jh;dd+=1){var Vh=(dd-(jh-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){$h.moveTo(Th[0],Th[1]+Vh);let cd=0,od=0,ld=0,_d=0;switch(Yh){case LiteGraph.LEFT:cd=qh*-.25;break;case LiteGraph.RIGHT:cd=qh*.25;break;case LiteGraph.UP:od=qh*-.25;break;case LiteGraph.DOWN:od=qh*.25;break}switch(Xh){case LiteGraph.LEFT:ld=qh*-.25;break;case LiteGraph.RIGHT:ld=qh*.25;break;case LiteGraph.UP:_d=qh*-.25;break;case LiteGraph.DOWN:_d=qh*.25;break}$h.bezierCurveTo(Th[0]+cd,Th[1]+od+Vh,Fh[0]+ld,Fh[1]+_d+Vh,Fh[0],Fh[1]+Vh)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){$h.moveTo(Th[0],Th[1]+Vh);let cd=0,od=0,ld=0,_d=0;switch(Yh){case LiteGraph.LEFT:cd=-1;break;case LiteGraph.RIGHT:cd=1;break;case LiteGraph.UP:od=-1;break;case LiteGraph.DOWN:od=1;break}switch(Xh){case LiteGraph.LEFT:ld=-1;break;case LiteGraph.RIGHT:ld=1;break;case LiteGraph.UP:_d=-1;break;case LiteGraph.DOWN:_d=1;break}var Zh=15;$h.lineTo(Th[0]+cd*Zh,Th[1]+od*Zh+Vh),$h.lineTo(Fh[0]+ld*Zh,Fh[1]+_d*Zh+Vh),$h.lineTo(Fh[0],Fh[1]+Vh)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){$h.moveTo(Th[0],Th[1]);var Kh=Th[0],Qh=Th[1],Jh=Fh[0],td=Fh[1];Yh==LiteGraph.RIGHT?Kh+=10:Qh+=10,Xh==LiteGraph.LEFT?Jh-=10:td-=10,$h.lineTo(Kh,Qh),$h.lineTo((Kh+Jh)*.5,Qh),$h.lineTo((Kh+Jh)*.5,td),$h.lineTo(Jh,td),$h.lineTo(Fh[0],Fh[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!zh&&($h.strokeStyle="rgba(0,0,0,0.5)",$h.stroke()),$h.lineWidth=this.connections_width,$h.fillStyle=$h.strokeStyle=Uh,$h.stroke();var ed=this.computeConnectionPoint(Th,Fh,.5,Yh,Xh);if(Wh&&Wh._pos&&(Wh._pos[0]=ed[0],Wh._pos[1]=ed[1]),this.ds.scale>=.6&&this.highquality_render&&Xh!=LiteGraph.CENTER){if(this.render_connection_arrows){var id=this.computeConnectionPoint(Th,Fh,.25,Yh,Xh),sd=this.computeConnectionPoint(Th,Fh,.26,Yh,Xh),nd=this.computeConnectionPoint(Th,Fh,.75,Yh,Xh),hd=this.computeConnectionPoint(Th,Fh,.76,Yh,Xh),ud=0,rd=0;this.render_curved_connections?(ud=-Math.atan2(sd[0]-id[0],sd[1]-id[1]),rd=-Math.atan2(hd[0]-nd[0],hd[1]-nd[1])):rd=ud=Fh[1]>Th[1]?0:Math.PI,$h.save(),$h.translate(id[0],id[1]),$h.rotate(ud),$h.beginPath(),$h.moveTo(-5,-3),$h.lineTo(0,7),$h.lineTo(5,-3),$h.fill(),$h.restore(),$h.save(),$h.translate(nd[0],nd[1]),$h.rotate(rd),$h.beginPath(),$h.moveTo(-5,-3),$h.lineTo(0,7),$h.lineTo(5,-3),$h.fill(),$h.restore()}$h.beginPath(),$h.arc(ed[0],ed[1],5,0,Math.PI*2),$h.fill()}if(Hh){$h.fillStyle=Uh;for(let dd=0;dd<5;++dd){var ad=(LiteGraph.getTime()*.001+dd*.2)%1;ed=this.computeConnectionPoint(Th,Fh,ad,Yh,Xh),$h.beginPath(),$h.arc(ed[0],ed[1],5,0,2*Math.PI),$h.fill()}}}function computeConnectionPoint($h,Th,Fh,Wh,zh){Wh=Wh||LiteGraph.RIGHT,zh=zh||LiteGraph.LEFT;var Hh=LiteGraph.distance($h,Th),Uh=$h,Yh=[$h[0],$h[1]],Xh=[Th[0],Th[1]],jh=Th;switch(Wh){case LiteGraph.LEFT:Yh[0]+=Hh*-.25;break;case LiteGraph.RIGHT:Yh[0]+=Hh*.25;break;case LiteGraph.UP:Yh[1]+=Hh*-.25;break;case LiteGraph.DOWN:Yh[1]+=Hh*.25;break}switch(zh){case LiteGraph.LEFT:Xh[0]+=Hh*-.25;break;case LiteGraph.RIGHT:Xh[0]+=Hh*.25;break;case LiteGraph.UP:Xh[1]+=Hh*-.25;break;case LiteGraph.DOWN:Xh[1]+=Hh*.25;break}var qh=(1-Fh)*(1-Fh)*(1-Fh),Vh=3*((1-Fh)*(1-Fh))*Fh,Zh=3*(1-Fh)*(Fh*Fh),Kh=Fh*Fh*Fh,Qh=qh*Uh[0]+Vh*Yh[0]+Zh*Xh[0]+Kh*jh[0],Jh=qh*Uh[1]+Vh*Yh[1]+Zh*Xh[1]+Kh*jh[1];return[Qh,Jh]}function drawSubgraphPanel($h){var Th,Fh=this.graph;if(Fh){var Wh=Fh._subgraph_node;if(!Wh){(Th=LiteGraph.warn)==null||Th.call(LiteGraph,"subgraph without subnode");return}this.drawSubgraphPanelLeft(Fh,Wh,$h),this.drawSubgraphPanelRight(Fh,Wh,$h)}}function drawSubgraphPanelLeft($h,Th,Fh){var Wh,zh=Th.inputs?Th.inputs.length:0,Hh=200,Uh=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(Fh.fillStyle="#111",Fh.globalAlpha=.8,Fh.beginPath(),Fh.roundRect(10,10,Hh,(zh+1)*Uh+50,[8]),Fh.fill(),Fh.globalAlpha=1,Fh.fillStyle="#888",Fh.font="14px Arial",Fh.textAlign="left",Fh.fillText("Graph Inputs",20,34),this.drawButton(Hh-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var Yh=50;if(Fh.font="14px Arial",Th.inputs)for(var Xh=0;Xh<Th.inputs.length;++Xh){var jh=Th.inputs[Xh];if(!jh.not_subgraph_input){if(this.drawButton(20,Yh+2,Hh-20,Uh-2)){var qh=Th.constructor.input_node_type||"graph/input";this.graph.beforeChange();var Vh=LiteGraph.createNode(qh);Vh?($h.add(Vh,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([Vh]),this.node_dragged=Vh,this.dragging_canvas=!1,Vh.setProperty("name",jh.name),Vh.setProperty("type",jh.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(Wh=LiteGraph.error)==null||Wh.call(LiteGraph,"graph input node not found:",qh)}Fh.fillStyle="#9C9",Fh.beginPath(),Fh.arc(Hh-16,Yh+Uh*.5,5,0,2*Math.PI),Fh.fill(),Fh.fillStyle="#AAA",Fh.fillText(jh.name,30,Yh+Uh*.75),Fh.fillStyle="#777",Fh.fillText(jh.type,130,Yh+Uh*.75),Yh+=Uh}}this.drawButton(20,Yh+2,Hh-20,Uh-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(Th)}function drawSubgraphPanelRight($h,Th,Fh){var Wh,zh,Hh=Th.outputs?Th.outputs.length:0,Uh=(((Wh=this.backSurface)==null?void 0:Wh.canvas)||this.bgcanvas).width,Yh=200,Xh=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);Fh.fillStyle="#111",Fh.globalAlpha=.8,Fh.beginPath(),Fh.roundRect(Uh-Yh-10,10,Yh,(Hh+1)*Xh+50,[8]),Fh.fill(),Fh.globalAlpha=1,Fh.fillStyle="#888",Fh.font="14px Arial",Fh.textAlign="left";const jh="Graph Outputs";var qh=Fh.measureText(jh).width;if(Fh.fillText(jh,Uh-qh-20,34),this.drawButton(Uh-Yh,20,20,20,"X","#151515")){this.closeSubgraph();return}var Vh=50;if(Fh.font="14px Arial",Th.outputs)for(var Zh=0;Zh<Th.outputs.length;++Zh){var Kh=Th.outputs[Zh];if(!Kh.not_subgraph_input){if(this.drawButton(Uh-Yh,Vh+2,Yh-20,Xh-2)){var Qh=Th.constructor.output_node_type||"graph/output";this.graph.beforeChange();var Jh=LiteGraph.createNode(Qh);Jh?($h.add(Jh,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([Jh]),this.node_dragged=Jh,this.dragging_canvas=!1,Jh.setProperty("name",Kh.name),Jh.setProperty("type",Kh.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(zh=LiteGraph.error)==null||zh.call(LiteGraph,"graph input node not found:",Qh)}Fh.fillStyle="#9C9",Fh.beginPath(),Fh.arc(Uh-Yh+16,Vh+Xh*.5,5,0,2*Math.PI),Fh.fill(),Fh.fillStyle="#AAA",Fh.fillText(Kh.name,Uh-Yh+30,Vh+Xh*.75),Fh.fillStyle="#777",Fh.fillText(Kh.type,Uh-Yh+130,Vh+Xh*.75),Vh+=Xh}}this.drawButton(Uh-Yh,Vh+2,Yh-20,Xh-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(Th)}function drawButton($h,Th,Fh,Wh,zh,Hh,Uh,Yh){var Xh=this.ctx;Hh=Hh||LiteGraph.NODE_DEFAULT_COLOR,Uh=Uh||"#555",Yh=Yh||LiteGraph.NODE_TEXT_COLOR;var jh=this.ds.convertOffsetToCanvas(this.graph_mouse),qh=LiteGraph.isInsideRectangle(jh[0],jh[1],$h,Th,Fh,Wh);if(jh=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,jh){var Vh=this.canvas.getBoundingClientRect();jh[0]-=Vh.left,jh[1]-=Vh.top}var Zh=jh&&LiteGraph.isInsideRectangle(jh[0],jh[1],$h,Th,Fh,Wh);Xh.fillStyle=qh?Uh:Hh,Zh&&(Xh.fillStyle="#AAA"),Xh.beginPath(),Xh.roundRect($h,Th,Fh,Wh,[4]),Xh.fill(),zh!=null&&zh.constructor==String&&(Xh.fillStyle=Yh,Xh.textAlign="center",Xh.font=(Wh*.65|0)+"px Arial",Xh.fillText(zh,$h+Fh*.5,Th+Wh*.75),Xh.textAlign="left");var Kh=Zh&&!this.block_click;return Zh&&this.blockClick(),Kh}function isAreaClicked($h,Th,Fh,Wh,zh){var Hh=this.last_click_position,Uh=Hh&&LiteGraph.isInsideRectangle(Hh[0],Hh[1],$h,Th,Fh,Wh),Yh=Uh&&!this.block_click;return Uh&&zh&&this.blockClick(),Yh}function renderInfo($h,Th,Fh){Th=Th||10,Fh=Fh||this.canvas.height-80,$h.save(),$h.translate(Th,Fh),$h.font="10px Arial",$h.fillStyle="#888",$h.textAlign="left",this.graph?($h.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),$h.fillText("I: "+this.graph.iteration,5,26),$h.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),$h.fillText("V: "+this.graph._version,5,52),$h.fillText("FPS:"+this.fps.toFixed(2),5,65)):$h.fillText("No graph selected",5,13),$h.restore()}function drawBackCanvas(){var $h,Th,Fh,Wh,zh,Hh,Uh,Yh,Xh,jh,qh,Vh,Zh,Kh,Qh,Jh=(($h=this.backSurface)==null?void 0:$h.canvas)||this.bgcanvas;this.bgctx||(this.bgctx=(Uh=(Hh=(Fh=(Th=this.rendererAdapter)==null?void 0:Th.getBackCtx)==null?void 0:Fh.call(Th))!=null?Hh:(zh=(Wh=this.backSurface)==null?void 0:Wh.getContextCompat)==null?void 0:zh.call(Wh))!=null?Uh:null);var td=this.bgctx;if(td){(Xh=(Yh=this.rendererAdapter)==null?void 0:Yh.beginFrame)==null||Xh.call(Yh,"back"),(jh=td.start)==null||jh.call(td);var ed=this.viewport||[0,0,td.canvas.width,td.canvas.height];if(this.clear_background&&td.clearRect(ed[0],ed[1],ed[2],ed[3]),this._graph_stack&&this._graph_stack.length){td.save();var id=this.graph._subgraph_node;td.strokeStyle=id.bgcolor,td.lineWidth=10,td.strokeRect(1,1,Jh.width-2,Jh.height-2),td.lineWidth=1,td.font="40px Arial",td.textAlign="center",td.fillStyle=id.bgcolor||"#AAA";let ud="";this._graph_stack.slice(1).forEach((rd,ad)=>{ud+=`${rd._subgraph_node.getTitle()} ${ad<this._graph_stack.length-2?">> ":""}`}),td.fillText(ud+id.getTitle(),Jh.width*.5,40),td.restore()}var sd=!1;if(this.onRenderBackground&&(sd=this.onRenderBackground(Jh,td)),this.viewport||(td.restore(),td.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(td.save(),this.ds.toCanvasContext(td),this.ds.scale<1.5&&!sd&&this.clear_background_color&&(td.fillStyle=this.clear_background_color,td.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!sd){if(this.zoom_modify_alpha?td.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:td.globalAlpha=this.editor_alpha,td.imageSmoothingEnabled=td.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var nd=this;this._bg_img.onload=function(){nd.draw(!0,!0)}}var hd=null;this._pattern==null&&this._bg_img.width>0?(hd=td.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=hd):hd=this._pattern,hd&&(td.fillStyle=hd,td.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),td.fillStyle="transparent"),td.globalAlpha=1,td.imageSmoothingEnabled=td.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(Jh,td),(qh=this.onDrawBackground)==null||qh.call(this,td,this.visible_area),this.onBackgroundRender&&((Vh=LiteGraph.error)==null||Vh.call(LiteGraph,"WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(td.strokeStyle="#235",td.strokeRect(0,0,Jh.width,Jh.height)),this.render_connections_shadows?(td.shadowColor="#000",td.shadowOffsetX=0,td.shadowOffsetY=0,td.shadowBlur=6):td.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(td),td.shadowColor="rgba(0,0,0,0)",td.restore()}(Zh=td.finish)==null||Zh.call(td),(Qh=(Kh=this.rendererAdapter)==null?void 0:Kh.endFrame)==null||Qh.call(Kh,"back"),this.dirty_bgcanvas=!1,this.dirty_canvas=!0}}function drawGroups($h,Th){if(this.graph){var Fh=this.graph._groups;Th.save(),Th.globalAlpha=.5*this.editor_alpha;for(let Yh=0;Yh<Fh.length;++Yh){var Wh=Fh[Yh];if(LiteGraph.overlapBounding(this.visible_area,Wh._bounding)){Th.fillStyle=Wh.color||"#335",Th.strokeStyle=Wh.color||"#335";var zh=Wh._pos,Hh=Wh._size;Th.globalAlpha=.25*this.editor_alpha,Th.beginPath(),Th.rect(zh[0]+.5,zh[1]+.5,Hh[0],Hh[1]),Th.fill(),Th.globalAlpha=this.editor_alpha,Th.stroke(),Th.beginPath(),Th.moveTo(zh[0]+Hh[0],zh[1]+Hh[1]),Th.lineTo(zh[0]+Hh[0]-10,zh[1]+Hh[1]),Th.lineTo(zh[0]+Hh[0],zh[1]+Hh[1]-10),Th.fill();var Uh=Wh.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;Th.font=Uh+"px Arial",Th.textAlign="left",Th.fillText(Wh.title,zh[0]+4,zh[1]+Uh)}}Th.restore()}}class RenderController{constructor(Th){this.host=Th}draw(...Th){return draw.apply(this.host,Th)}drawFrontCanvas(...Th){return drawFrontCanvas.apply(this.host,Th)}lowQualityRenderingRequired(...Th){return lowQualityRenderingRequired.apply(this.host,Th)}beginNodeFrameLeafer(...Th){return beginNodeFrameLeafer.apply(this.host,Th)}endNodeFrameLeafer(...Th){return endNodeFrameLeafer.apply(this.host,Th)}drawNode(...Th){return drawNode.apply(this.host,Th)}drawNodeTooltip(...Th){return drawNodeTooltip.apply(this.host,Th)}drawNodeShape(...Th){return drawNodeShape.apply(this.host,Th)}drawExecutionOrder(...Th){return drawExecutionOrder.apply(this.host,Th)}drawNodeWidgets(...Th){return drawNodeWidgets.apply(this.host,Th)}processNodeWidgets(...Th){return processNodeWidgets.apply(this.host,Th)}adjustNodesSize(...Th){return adjustNodesSize.apply(this.host,Th)}drawConnections(...Th){return drawConnections.apply(this.host,Th)}renderLink(...Th){return renderLink.apply(this.host,Th)}computeConnectionPoint(...Th){return computeConnectionPoint.apply(this.host,Th)}drawLinkTooltip(...Th){return drawLinkTooltip.apply(this.host,Th)}drawBackCanvas(...Th){return drawBackCanvas.apply(this.host,Th)}drawSubgraphPanel(...Th){return drawSubgraphPanel.apply(this.host,Th)}drawSubgraphPanelLeft(...Th){return drawSubgraphPanelLeft.apply(this.host,Th)}drawSubgraphPanelRight(...Th){return drawSubgraphPanelRight.apply(this.host,Th)}drawButton(...Th){return drawButton.apply(this.host,Th)}isAreaClicked(...Th){return isAreaClicked.apply(this.host,Th)}renderInfo(...Th){return renderInfo.apply(this.host,Th)}drawGroups(...Th){return drawGroups.apply(this.host,Th)}}function copyToClipboard(){var $h,Th={nodes:[],links:[]},Fh=0,Wh=[];for(let jh in this.selected_nodes){let qh=this.selected_nodes[jh];qh.clonable!==!1&&(qh._relative_id=Fh,Wh.push(qh),Fh+=1)}for(let jh=0;jh<Wh.length;++jh){let qh=Wh[jh];if(qh.clonable!==!1){var zh=qh.clone();if(!zh){($h=LiteGraph.warn)==null||$h.call(LiteGraph,"node type not found: "+qh.type);continue}if(Th.nodes.push(zh.serialize()),qh.inputs&&qh.inputs.length)for(var Hh=0;Hh<qh.inputs.length;++Hh){var Uh=qh.inputs[Hh];if(!(!Uh||Uh.link==null)){var Yh=this.graph.links[Uh.link];if(Yh){var Xh=this.graph.getNodeById(Yh.origin_id);Xh&&Th.links.push([Xh._relative_id,Yh.origin_slot,qh._relative_id,Yh.target_slot,Xh.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(Th))}function pasteFromClipboard($h=!1){var Th;if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&$h)){var Fh=localStorage.getItem("litegrapheditor_clipboard");if(Fh){this.graph.beforeChange();var Wh=JSON.parse(Fh),zh=!1,Hh=!1;for(let Qh=0;Qh<Wh.nodes.length;++Qh)zh?(zh[0]>Wh.nodes[Qh].pos[0]&&(zh[0]=Wh.nodes[Qh].pos[0],Hh[0]=Qh),zh[1]>Wh.nodes[Qh].pos[1]&&(zh[1]=Wh.nodes[Qh].pos[1],Hh[1]=Qh)):(zh=[Wh.nodes[Qh].pos[0],Wh.nodes[Qh].pos[1]],Hh=[Qh,Qh]);var Uh=[];for(let Qh=0;Qh<Wh.nodes.length;++Qh){var Yh=Wh.nodes[Qh],Xh=LiteGraph.createNode(Yh.type);Xh&&(Xh.configure(Yh),Xh.pos[0]+=this.graph_mouse[0]-zh[0],Xh.pos[1]+=this.graph_mouse[1]-zh[1],this.graph.add(Xh,{doProcessChange:!1}),Uh.push(Xh))}for(let Qh=0;Qh<Wh.links.length;++Qh){var jh=Wh.links[Qh],qh=void 0,Vh=jh[0];if(Vh!=null)qh=Uh[Vh];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&$h){var Zh=jh[4];Zh&&(qh=this.graph.getNodeById(Zh))}var Kh=Uh[jh[2]];qh&&Kh?qh.connect(jh[1],Kh,jh[3]):(Th=LiteGraph.warn)==null||Th.call(LiteGraph,"Warning, nodes missing on pasting")}this.selectNodes(Uh),this.graph.onGraphChanged({action:"paste",doSave:!0}),this.graph.afterChange()}}}function processNodeDblClicked($h){var Th;this.onShowNodePanel?this.onShowNodePanel($h):this.showShowNodePanel($h),(Th=this.onNodeDblClicked)==null||Th.call(this,$h),this.setDirty(!0)}function processNodeSelected($h,Th){var Fh;this.selectNode($h,Th&&(Th.shiftKey||Th.ctrlKey||this.multi_select)),(Fh=this.onNodeSelected)==null||Fh.call(this,$h)}function selectNode($h,Th){$h==null?this.deselectAllNodes():this.selectNodes([$h],Th)}function selectNodes($h,Th){var Fh;Th||this.deselectAllNodes(),$h=$h||this.graph._nodes,typeof $h=="string"&&($h=[$h]),Object.values($h).forEach(Wh=>{var zh,Hh,Uh;if(Wh.is_selected){this.deselectNode(Wh);return}Wh.is_selected=!0,this.selected_nodes[Wh.id]=Wh,(zh=Wh.onSelected)==null||zh.call(Wh),(Hh=Wh.inputs)==null||Hh.forEach(Yh=>{this.highlighted_links[Yh.link]=!0}),(Uh=Wh.outputs)==null||Uh.forEach(Yh=>{var Xh;(Xh=Yh.links)==null||Xh.forEach(jh=>{this.highlighted_links[jh]=!0})})}),(Fh=this.onSelectionChange)==null||Fh.call(this,this.selected_nodes),this.setDirty(!0)}function deselectNode($h){var Th,Fh,Wh,zh;$h.is_selected&&((Th=$h.onDeselected)==null||Th.call($h),$h.is_selected=!1,(Fh=this.onNodeDeselected)==null||Fh.call(this,$h),(Wh=$h.inputs)==null||Wh.forEach(Hh=>{var Uh;(Uh=this.highlighted_links)==null||delete Uh[Hh.link]}),(zh=$h.outputs)==null||zh.forEach(Hh=>{var Uh;(Uh=Hh.links)==null||Uh.forEach(Yh=>{var Xh;return(Xh=this.highlighted_links)==null?!0:delete Xh[Yh]})}))}function deselectAllNodes(){var $h,Th;this.graph&&(($h=this.graph._nodes)==null||$h.forEach(Fh=>{var Wh,zh;Fh.is_selected&&((Wh=Fh.onDeselected)==null||Wh.call(Fh),Fh.is_selected=!1,(zh=this.onNodeDeselected)==null||zh.call(this,Fh))}),this.selected_nodes={},this.current_node=null,this.highlighted_links={},(Th=this.onSelectionChange)==null||Th.call(this,this.selected_nodes),this.setDirty(!0))}function deleteSelectedNodes(){this.graph.beforeChange();for(let Hh in this.selected_nodes){var $h=this.selected_nodes[Hh];if(!$h.block_delete){if($h.inputs&&$h.inputs.length&&$h.outputs&&$h.outputs.length&&LiteGraph.isValidConnection($h.inputs[0].type,$h.outputs[0].type)&&$h.inputs[0].link&&$h.outputs[0].links&&$h.outputs[0].links.length){var Th=$h.graph.links[$h.inputs[0].link],Fh=$h.graph.links[$h.outputs[0].links[0]],Wh=$h.getInputNode(0),zh=$h.getOutputNodes(0)[0];Wh&&zh&&Wh.connect(Th.origin_slot,zh,Fh.target_slot)}this.graph.remove($h),this.onNodeDeselected&&this.onNodeDeselected($h)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()}function onNodeSelectionChange(){}function boundaryNodesForSelection(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))}class SelectionController{constructor(Th){this.host=Th}copyToClipboard(...Th){return copyToClipboard.apply(this.host,Th)}pasteFromClipboard(...Th){return pasteFromClipboard.apply(this.host,Th)}processNodeDblClicked(...Th){return processNodeDblClicked.apply(this.host,Th)}processNodeSelected(...Th){return processNodeSelected.apply(this.host,Th)}selectNode(...Th){return selectNode.apply(this.host,Th)}selectNodes(...Th){return selectNodes.apply(this.host,Th)}deselectNode(...Th){return deselectNode.apply(this.host,Th)}deselectAllNodes(...Th){return deselectAllNodes.apply(this.host,Th)}deleteSelectedNodes(...Th){return deleteSelectedNodes.apply(this.host,Th)}onNodeSelectionChange(...Th){return onNodeSelectionChange.apply(this.host,Th)}boundaryNodesForSelection(...Th){return boundaryNodesForSelection.apply(this.host,Th)}}function showLinkMenu($h,Th){var Fh=this,Wh=Fh.graph.getNodeById($h.origin_id),zh=Fh.graph.getNodeById($h.target_id),Hh=!1;Wh&&Wh.outputs&&Wh.outputs[$h.origin_slot]&&(Hh=Wh.outputs[$h.origin_slot].type);var Uh=!1;zh&&zh.outputs&&zh.outputs[$h.target_slot]&&(Uh=zh.inputs[$h.target_slot].type);var Yh=["Add Node",null,"Delete"],Xh=new LiteGraph.ContextMenu(Yh,{event:Th,title:$h.data!=null?$h.data.constructor.name:null,callback:jh});function jh(qh,Vh,Zh){switch(qh){case"Add Node":LGraphCanvas.onMenuAdd(null,null,Zh,Xh,function(Kh){var Qh;(Qh=LiteGraph.debug)==null||Qh.call(LiteGraph,"node autoconnect"),!(!Kh.inputs||!Kh.inputs.length||!Kh.outputs||!Kh.outputs.length)&&Wh.connectByType($h.origin_slot,Kh,Hh)&&(Kh.connectByType($h.target_slot,zh,Uh),Kh.pos[0]-=Kh.size[0]*.5)});break;case"Delete":Fh.graph.removeLink($h.id);break}}return!1}function createDefaultNodeForSlot($h={}){var Th,Fh,Wh,zh,Hh,Uh=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},$h),Yh=this,Xh=Uh.nodeFrom&&Uh.slotFrom!==null,jh=!Xh&&Uh.nodeTo&&Uh.slotTo!==null;if(!Xh&&!jh)return(Th=LiteGraph.warn)==null||Th.call(LiteGraph,"No data passed to createDefaultNodeForSlot "+Uh.nodeFrom+" "+Uh.slotFrom+" "+Uh.nodeTo+" "+Uh.slotTo),!1;if(!Uh.nodeType)return(Fh=LiteGraph.warn)==null||Fh.call(LiteGraph,"No type to createDefaultNodeForSlot"),!1;var qh=Xh?Uh.nodeFrom:Uh.nodeTo,Vh=Xh?Uh.slotFrom:Uh.slotTo,Zh=!1;switch(typeof Vh){case"string":Zh=Xh?qh.findOutputSlot(Vh,!1):qh.findInputSlot(Vh,!1),Vh=Xh?qh.outputs[Vh]:qh.inputs[Vh];break;case"object":Zh=Xh?qh.findOutputSlot(Vh.name):qh.findInputSlot(Vh.name);break;case"number":Zh=Vh,Vh=Xh?qh.outputs[Vh]:qh.inputs[Vh];break;default:return(Wh=LiteGraph.warn)==null||Wh.call(LiteGraph,"Cant get slot information "+Vh),!1}(Vh===!1||Zh===!1)&&((zh=LiteGraph.warn)==null||zh.call(LiteGraph,"createDefaultNodeForSlot bad slotX "+Vh+" "+Zh));var Kh=Vh.type==LiteGraph.EVENT?"_event_":Vh.type,Qh=Xh?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(Qh&&Qh[Kh]){Vh.link;var Jh=!1;if(typeof Qh[Kh]=="object"){for(var td in Qh[Kh])if(Uh.nodeType==Qh[Kh][td]||Uh.nodeType=="AUTO"){Jh=Qh[Kh][td];break}}else(Uh.nodeType==Qh[Kh]||Uh.nodeType=="AUTO")&&(Jh=Qh[Kh]);if(Jh){var ed=!1;typeof Jh=="object"&&Jh.node&&(ed=Jh,Jh=Jh.node);var id=LiteGraph.createNode(Jh);if(id){if(ed){if(ed.properties)for(const[sd,nd]of Object.entries(ed.properties))id.addProperty(sd,nd);ed.inputs&&(id.inputs=[],Object.values(ed.inputs).forEach(sd=>{id.addOutput(sd[0],sd[1])})),ed.outputs&&(id.outputs=[],Object.values(ed.outputs).forEach(sd=>{id.addOutput(sd[0],sd[1])})),ed.title&&(id.title=ed.title),ed.json&&id.configure(ed.json)}return Yh.graph.add(id),id.pos=[Uh.position[0]+Uh.posAdd[0]+(Uh.posSizeFix[0]?Uh.posSizeFix[0]*id.size[0]:0),Uh.position[1]+Uh.posAdd[1]+(Uh.posSizeFix[1]?Uh.posSizeFix[1]*id.size[1]:0)],Xh?Uh.nodeFrom.connectByType(Zh,id,Kh):Uh.nodeTo.connectByTypeOutput(Zh,id,Kh),!0}else(Hh=LiteGraph.warn)==null||Hh.call(LiteGraph,"failed creating "+Jh)}}return!1}function showConnectionMenu($h={}){var Th,Fh,Wh=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},$h),zh=this,Hh=Wh.nodeFrom&&Wh.slotFrom,Uh=!Hh&&Wh.nodeTo&&Wh.slotTo;if(!Hh&&!Uh)return(Th=LiteGraph.warn)==null||Th.call(LiteGraph,"No data passed to showConnectionMenu"),!1;var Yh=Hh?Wh.nodeFrom:Wh.nodeTo,Xh=Hh?Wh.slotFrom:Wh.slotTo,jh=!1;switch(typeof Xh){case"string":jh=Hh?Yh.findOutputSlot(Xh,!1):Yh.findInputSlot(Xh,!1),Xh=Hh?Yh.outputs[Xh]:Yh.inputs[Xh];break;case"object":jh=Hh?Yh.findOutputSlot(Xh.name):Yh.findInputSlot(Xh.name);break;case"number":jh=Xh,Xh=Hh?Yh.outputs[Xh]:Yh.inputs[Xh];break;default:return(Fh=LiteGraph.warn)==null||Fh.call(LiteGraph,"Cant get slot information "+Xh),!1}var qh=["Add Node",null];zh.allow_searchbox&&(qh.push("Search"),qh.push(null));const Vh=Xh.type===LiteGraph.EVENT?"_event_":Xh.type,Zh=Hh?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(Zh&&Zh[Vh]){const Qh=Zh[Vh];Array.isArray(Qh)||typeof Qh=="object"?Object.values(Qh).forEach(Jh=>{qh.push(Jh)}):qh.push(Qh)}var Kh=new LiteGraph.ContextMenu(qh,{event:Wh.e,title:(Xh&&Xh.name!=""?Xh.name+(Vh?" | ":""):"")+(Xh&&Vh?Vh:""),callback:(Qh,Jh,td)=>{const ed={"Add Node":()=>{LGraphCanvas.onMenuAdd(null,null,td,Kh,id=>{Hh?Wh.nodeFrom.connectByType(jh,id,Vh):Wh.nodeTo.connectByTypeOutput(jh,id,Vh)})},Search:()=>{Hh?zh.showSearchBox(td,{node_from:Wh.nodeFrom,slot_from:Xh,type_filter_in:Vh}):zh.showSearchBox(td,{node_to:Wh.nodeTo,slot_from:Xh,type_filter_out:Vh})},default:()=>{zh.createDefaultNodeForSlot(Object.assign(Wh,{position:[Wh.e.canvasX,Wh.e.canvasY],nodeType:Qh}))}};(ed[Qh]||ed.default)()}});return!1}function getCanvasMenuOptions(){var $h=null;if(this.getMenuOptions?$h=this.getMenuOptions():($h=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],LiteGraph.showCanvasOptions&&$h.push({content:"Options",callback:this.showShowGraphOptionsPanel}),Object.keys(this.selected_nodes).length>1&&$h.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&$h.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var Th=this.getExtraMenuOptions(this,$h);Th&&($h=$h.concat(Th))}return $h}function getNodeMenuOptions($h){var Th=null;if($h.getMenuOptions?Th=$h.getMenuOptions(this):(Th=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],$h.resizable!==!1&&Th.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),Th.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),$h.onGetInputs){var Fh=$h.onGetInputs();Fh&&Fh.length&&(Th[0].disabled=!1)}if($h.onGetOutputs){var Wh=$h.onGetOutputs();Wh&&Wh.length&&(Th[1].disabled=!1)}if(LiteGraph.do_add_triggers_slots&&(Th[1].disabled=!1),$h.getExtraMenuOptions){var zh=$h.getExtraMenuOptions(this,Th);zh&&(zh.push(null),Th=zh.concat(Th))}return $h.clonable!==!1&&Th.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&Th.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),Th.push(null,{content:"Remove",disabled:!($h.removable!==!1&&!$h.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),$h.graph&&$h.graph.onGetNodeMenuOptions&&$h.graph.onGetNodeMenuOptions(Th,$h),Th}function getGroupMenuOptions(){var $h=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return $h}function processContextMenu($h,Th){var Fh,Wh,zh,Hh=this,Uh=LGraphCanvas.active_canvas,Yh=Uh.getCanvasWindow(),Xh=null,jh={event:Th,callback:Qh,extra:$h};$h&&(jh.title=$h.type);var qh=null;if($h&&(qh=$h.getSlotInPosition(Th.canvasX,Th.canvasY),LGraphCanvas.active_node=$h),qh){if(Xh=[],$h.getSlotMenuOptions)Xh=$h.getSlotMenuOptions(qh);else{((Wh=(Fh=qh==null?void 0:qh.output)==null?void 0:Fh.links)!=null&&Wh.length||(zh=qh.input)!=null&&zh.link)&&Xh.push({content:"Disconnect Links",slot:qh});var Vh=qh.input||qh.output;Vh.removable&&LiteGraph.canRemoveSlots&&Xh.push(Vh.locked?"Cannot remove":{content:"Remove Slot",slot:qh}),!Vh.nameLocked&&LiteGraph.canRenameSlots&&Xh.push({content:"Rename Slot",slot:qh})}var Zh=qh.input||qh.output;jh.title=Zh.type||"*",Zh.type==LiteGraph.ACTION?jh.title="Action":Zh.type==LiteGraph.EVENT&&(jh.title="Event")}else if($h)Xh=this.getNodeMenuOptions($h);else{Xh=this.getCanvasMenuOptions();var Kh=this.graph.getGroupOnPos(Th.canvasX,Th.canvasY);Kh&&Xh.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:Kh,options:this.getGroupMenuOptions(Kh)}})}if(!Xh)return;new LiteGraph.ContextMenu(Xh,jh,Yh);function Qh(Jh,td){if(!Jh)return;let ed;if(Jh.content=="Remove Slot"){ed=Jh.slot,$h.graph.beforeChange(),ed.input?$h.removeInput(ed.slot):ed.output&&$h.removeOutput(ed.slot),$h.graph.afterChange();return}else if(Jh.content=="Disconnect Links"){ed=Jh.slot,$h.graph.beforeChange(),ed.output?$h.disconnectOutput(ed.slot):ed.input&&$h.disconnectInput(ed.slot),$h.graph.afterChange();return}else if(Jh.content=="Rename Slot"){ed=Jh.slot;var id=ed.input?$h.getInputInfo(ed.slot):$h.getOutputInfo(ed.slot),sd=Hh.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",td),nd=sd.querySelector("input");nd&&id&&(nd.value=id.label||"");var hd=function(){$h.graph.beforeChange(),nd.value&&(id&&(id.label=nd.value),Hh.setDirty(!0)),sd.close(),$h.graph.afterChange()};sd.querySelector("button").addEventListener("click",hd),nd.addEventListener("keydown",function(ud){if(sd.is_modified=!0,ud.keyCode==27)sd.close();else if(ud.keyCode==13)hd();else if(ud.keyCode!=13&&ud.target.localName!="textarea")return;ud.preventDefault(),ud.stopPropagation()}),nd.focus()}}}function prompt($h="",Th,Fh,Wh,zh){var Hh,Uh=document.createElement("div");Uh.is_modified=!1,Uh.className="graphdialog rounded",zh?Uh.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":Uh.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",Uh.close=()=>{var id;this.prompt_box=null,(id=Uh.parentNode)==null||id.removeChild(Uh)};var Yh=LGraphCanvas.active_canvas,Xh=Yh.canvas;Xh.parentNode.appendChild(Uh),this.ds.scale>1&&(Uh.style.transform=`scale(${this.ds.scale})`);var jh=null,qh=0;Uh.addEventListener("pointerleave",id=>{qh>0||LiteGraph.dialog_close_on_mouse_leave&&!Uh.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(jh=setTimeout(Uh.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),Uh.addEventListener("pointerenter",id=>{LiteGraph.dialog_close_on_mouse_leave&&jh&&clearTimeout(jh)});const Vh=Uh.querySelectorAll("select");Vh&&(qh=0,Vh.forEach(id=>{id.addEventListener("pointerdown",sd=>{qh++}),id.addEventListener("focus",sd=>{qh++}),id.addEventListener("blur",sd=>{qh=Math.max(0,qh-1)}),id.addEventListener("change",sd=>{qh=0})})),(Hh=this.prompt_box)==null||Hh.close(),this.prompt_box=Uh;var Zh=Uh.querySelector(".name");Zh.innerText=$h;var Kh=Uh.querySelector(".value");Kh.value=Th;const Qh=Kh;Qh.addEventListener("keydown",id=>{var sd;switch(Uh.is_modified=!0,id.key){case"Escape":Uh.close();break;case"Enter":id.target.localName!=="textarea"&&typeof Fh=="function"&&(Fh(Qh.value),this.setDirty(!0)),(sd=LiteGraph.debug)==null||sd.call(LiteGraph,"prompt v2 ENTER",Qh.value,id.target.localName,Fh),Uh.close();break;default:return}id.preventDefault(),id.stopPropagation()}),Uh.querySelector("button").addEventListener("click",id=>{var sd;typeof Fh=="function"&&(Fh(Qh.value),this.setDirty(!0)),(sd=LiteGraph.debug)==null||sd.call(LiteGraph,"prompt v2 OK",Qh.value,Fh),Uh.close()});var Jh=Xh.getBoundingClientRect(),td=-20,ed=-20;return Jh&&(td-=Jh.left,ed-=Jh.top),Wh?(Uh.style.left=Wh.clientX+td+"px",Uh.style.top=Wh.clientY+ed+"px"):(Uh.style.left=Xh.width*.5+td+"px",Uh.style.top=Xh.height*.5+ed+"px"),setTimeout(function(){Qh.focus()},10),Uh}function showSearchBox($h,Th){var Fh={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled&&(Object.keys(LiteGraph.registered_slot_in_types||{}).length>0||Object.keys(LiteGraph.registered_slot_out_types||{}).length>0),type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};Th=Object.assign(Fh,Th||{});var Wh=this,zh=LGraphCanvas.active_canvas,Hh=zh.canvas,Uh=Hh.ownerDocument||document,Yh=document.createElement("div");if(Yh.className="litegraph litesearchbox graphdialog rounded",Yh.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",Th.do_type_filter&&(Yh.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",Yh.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),Th.show_close_button&&(Yh.innerHTML+="<button class='close_searchbox close'>X</button>"),Yh.innerHTML+="<div class='helper'></div>",Uh.fullscreenElement?Uh.fullscreenElement.appendChild(Yh):(Uh.body.appendChild(Yh),Uh.body.style.overflow="hidden"),Th.do_type_filter)var Xh=Yh.querySelector(".slot_in_type_filter"),jh=Yh.querySelector(".slot_out_type_filter");if(Yh.close=function(){Wh.search_box=null,this.blur(),Hh.focus(),Uh.body.style.overflow="",setTimeout(function(){Wh.canvas.focus()},20),Yh.parentNode&&Yh.parentNode.removeChild(Yh)},this.ds.scale>1&&(Yh.style.transform=`scale(${this.ds.scale})`),Th.hide_on_mouse_leave){var qh=0,Vh=null;if(Yh.addEventListener("pointerenter",function(ad){Vh&&(clearTimeout(Vh),Vh=null)}),Yh.addEventListener("pointerleave",function(ad){qh>0||(Vh=setTimeout(function(){Yh.close()},500))}),Th.do_type_filter){const ad=function(dd){dd&&(dd.addEventListener("pointerdown",function(cd){qh++}),dd.addEventListener("focus",function(cd){qh++}),dd.addEventListener("blur",function(cd){qh=Math.max(0,qh-1)}),dd.addEventListener("change",function(cd){qh=0}))};ad(Xh),ad(jh)}}Wh.search_box&&Wh.search_box.close(),Wh.search_box=Yh;var Zh=Yh.querySelector(".helper"),Kh=null,Qh=null,Jh=null,td=Yh.querySelector("input");if(td&&(td.addEventListener("blur",function(ad){Wh.search_box&&this.focus()}),td.addEventListener("keydown",function(ad){if(ad.key==="ArrowUp")ud(!1);else if(ad.key==="ArrowDown")ud(!0);else if(ad.key==="Escape")Yh.close();else if(ad.key==="Enter")rd(),Jh?hd(Jh.innerHTML):Kh?hd(Kh):Yh.close();else{Qh&&clearInterval(Qh),Qh=setTimeout(rd,250);return}return ad.preventDefault(),ad.stopPropagation(),ad.stopImmediatePropagation(),!0})),Th.do_type_filter){if(Xh){let ad=LiteGraph.slot_types_in,dd=ad.length;(Th.type_filter_in==LiteGraph.EVENT||Th.type_filter_in==LiteGraph.ACTION)&&(Th.type_filter_in="_event_");for(let cd=0;cd<dd;cd++){let od=document.createElement("option");od.value=ad[cd],od.innerHTML=ad[cd],Xh.appendChild(od),Th.type_filter_in!==!1&&(Th.type_filter_in+"").toLowerCase()==(ad[cd]+"").toLowerCase()&&(od.selected=!0)}Xh.addEventListener("change",function(){rd()})}if(jh){let ad=LiteGraph.slot_types_out,dd=ad.length;(Th.type_filter_out==LiteGraph.EVENT||Th.type_filter_out==LiteGraph.ACTION)&&(Th.type_filter_out="_event_");for(let cd=0;cd<dd;cd++){let od=document.createElement("option");od.value=ad[cd],od.innerHTML=ad[cd],jh.appendChild(od),Th.type_filter_out!==!1&&(Th.type_filter_out+"").toLowerCase()==(ad[cd]+"").toLowerCase()&&(od.selected=!0)}jh.addEventListener("change",function(){rd()})}}if(Th.show_close_button){var ed=Yh.querySelector(".close");ed.addEventListener("click",Yh.close)}var id=Hh.getBoundingClientRect(),sd=($h?$h.clientX:id.left+id.width*.5)-80,nd=($h?$h.clientY:id.top+id.height*.5)-20;id.width-sd<470&&(sd=id.width-470),id.height-nd<220&&(nd=id.height-220),sd<id.left+20&&(sd=id.left+20),nd<id.top+20&&(nd=id.top+20),Yh.style.left=sd+"px",Yh.style.top=nd+"px",td.focus(),Th.show_all_on_open&&rd();function hd(ad){if(ad)if(Wh.onSearchBoxSelection)Wh.onSearchBoxSelection(ad,$h,zh);else{var dd=LiteGraph.searchbox_extras[ad.toLowerCase()];dd&&(ad=dd.type),zh.graph.beforeChange();var cd=LiteGraph.createNode(ad);if(cd&&(cd.pos=zh.convertEventToCanvasOffset($h),zh.graph.add(cd,!1,{doProcessChange:!1})),dd&&dd.data){if(dd.data.properties)for(let ld in dd.data.properties)cd.addProperty(ld,dd.data.properties[ld]);if(dd.data.inputs){cd.inputs=[];for(let ld in dd.data.inputs)cd.addOutput(dd.data.inputs[ld][0],dd.data.inputs[ld][1])}if(dd.data.outputs){cd.outputs=[];for(let ld in dd.data.outputs)cd.addOutput(dd.data.outputs[ld][0],dd.data.outputs[ld][1])}dd.data.title&&(cd.title=dd.data.title),dd.data.json&&cd.configure(dd.data.json)}let od;if(Th.node_from){switch(od=!1,typeof Th.slot_from){case"string":od=Th.node_from.findOutputSlot(Th.slot_from);break;case"object":Th.slot_from.name?od=Th.node_from.findOutputSlot(Th.slot_from.name):od=-1,od==-1&&typeof Th.slot_from.slot_index!="undefined"&&(od=Th.slot_from.slot_index);break;case"number":od=Th.slot_from;break;default:od=0}typeof Th.node_from.outputs[od]!="undefined"&&od!==!1&&od>-1&&Th.node_from.connectByType(od,cd,Th.node_from.outputs[od].type)}if(Th.node_to){switch(od=!1,typeof Th.slot_from){case"string":od=Th.node_to.findInputSlot(Th.slot_from);break;case"object":Th.slot_from.name?od=Th.node_to.findInputSlot(Th.slot_from.name):od=-1,od==-1&&typeof Th.slot_from.slot_index!="undefined"&&(od=Th.slot_from.slot_index);break;case"number":od=Th.slot_from;break;default:od=0}typeof Th.node_to.inputs[od]!="undefined"&&od!==!1&&od>-1&&Th.node_to.connectByTypeOutput(od,cd,Th.node_to.inputs[od].type)}zh.graph.afterChange()}Yh.close()}function ud(ad){var dd=Jh;Jh&&Jh.classList.remove("selected"),Jh?(Jh=ad?Jh.nextSibling:Jh.previousSibling,Jh||(Jh=dd)):Jh=ad?Zh.childNodes[0]:Zh.childNodes[Zh.childNodes.length],Jh&&(Jh.classList.add("selected"),Jh.scrollIntoView({block:"end",behavior:"smooth"}))}function rd(){Qh=null;var ad=td.value;if(Kh=null,Zh.innerHTML="",!ad&&!Th.show_all_if_empty)return;if(Wh.onSearchBox){var dd=Wh.onSearchBox(Zh,ad,zh);if(dd)for(let $d=0;$d<dd.length;++$d)wd(dd[$d])}else{let $d=function(yd,xd={}){var Td={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},pd=Object.assign(Td,xd),bd=LiteGraph.registered_node_types[yd];if(od&&bd.filter!=od||(!Th.show_all_if_empty||ad)&&yd.toLowerCase().indexOf(ad)===-1)return!1;if(Th.do_type_filter&&!pd.skipFilter){var Cd=yd;let Sd;var Ld=fd.value;if(pd.inTypeOverride!==!1&&(Ld=pd.inTypeOverride),fd&&Ld&&LiteGraph.registered_slot_in_types[Ld]&&LiteGraph.registered_slot_in_types[Ld].nodes&&(Sd=LiteGraph.registered_slot_in_types[Ld].nodes.includes(Cd),Sd===!1)||(Ld=vd.value,pd.outTypeOverride!==!1&&(Ld=pd.outTypeOverride),vd&&Ld&&LiteGraph.registered_slot_out_types[Ld]&&LiteGraph.registered_slot_out_types[Ld].nodes&&(Sd=LiteGraph.registered_slot_out_types[Ld].nodes.includes(Cd),Sd===!1)))return!1}return!0};var cd=0;ad=ad.toLowerCase();var od=zh.filter||zh.graph.filter;let fd,vd;Th.do_type_filter&&Wh.search_box?(fd=Wh.search_box.querySelector(".slot_in_type_filter"),vd=Wh.search_box.querySelector(".slot_out_type_filter")):(fd=!1,vd=!1);for(let yd in LiteGraph.searchbox_extras){var ld=LiteGraph.searchbox_extras[yd];if(!((!Th.show_all_if_empty||ad)&&ld.desc.toLowerCase().indexOf(ad)===-1)){var _d=LiteGraph.registered_node_types[ld.type];if(!(_d&&_d.filter!=od)&&$d(ld.type)&&(wd(ld.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&cd++>LGraphCanvas.search_limit))break}}var md=null;if(Array.prototype.filter)md=Object.keys(LiteGraph.registered_node_types).filter($d);else{md=[];for(let yd in LiteGraph.registered_node_types)$d(yd)&&md.push(yd)}for(let yd=0;yd<md.length&&(wd(md[yd]),!(LGraphCanvas.search_limit!==-1&&cd++>LGraphCanvas.search_limit));yd++);if(Th.show_general_after_typefiltered&&(fd.value||vd.value)){var gd=[];for(let yd in LiteGraph.registered_node_types)$d(yd,{inTypeOverride:fd&&fd.value?"*":!1,outTypeOverride:vd&&vd.value?"*":!1})&&gd.push(yd);for(let yd=0;yd<gd.length&&(wd(gd[yd],"generic_type"),!(LGraphCanvas.search_limit!==-1&&cd++>LGraphCanvas.search_limit));yd++);}if((fd.value||vd.value)&&Zh.childNodes.length==0&&Th.show_general_if_none_on_typefilter){var gd=[];for(let xd in LiteGraph.registered_node_types)$d(xd,{skipFilter:!0})&&gd.push(xd);for(let xd=0;xd<gd.length&&(wd(gd[xd],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&cd++>LGraphCanvas.search_limit));xd++);}}function wd($d,fd){var vd=document.createElement("div");Kh||(Kh=$d),vd.innerText=$d,vd.dataset.type=encodeURIComponent($d),vd.className="litegraph lite-search-item",fd&&(vd.className+=" "+fd),vd.addEventListener("click",function(yd){hd(decodeURIComponent(this.dataset.type))}),Zh.appendChild(vd)}}return Yh}function showEditPropertyValue($h,Th,Fh){var Wh,zh,Hh,Uh,Yh;if(!$h||$h.properties[Th]===void 0)return;Fh=Fh||{};var Xh=$h.getPropertyInfo(Th),jh=Xh.type;let qh;if(jh=="string"||jh=="number"||jh=="array"||jh=="object")qh="<input autofocus type='text' class='value'/>";else if((jh=="enum"||jh=="combo")&&Xh.values){(Wh=LiteGraph.debug)==null||Wh.call(LiteGraph,"CREATING showEditPropertyValue ENUM COMBO",Kh,jh,Zh),qh="<select autofocus type='text' class='value'>";for(let ed in Xh.values){var Vh=ed;Xh.values.constructor===Array&&(Vh=Xh.values[ed]),qh+="<option value='"+Vh+"' "+(Vh==$h.properties[Th]?"selected":"")+">"+Xh.values[ed]+"</option>"}qh+="</select>"}else if(jh=="boolean"||jh=="toggle")qh="<input autofocus type='checkbox' class='value' "+($h.properties[Th]?"checked":"")+"/>";else{(zh=LiteGraph.warn)==null||zh.call(LiteGraph,"unknown type: "+jh);return}var Zh=this.createDialog("<span class='name'>"+(Xh.label?Xh.label:Th)+"</span>"+qh+"<button>OK</button>",Fh),Kh=!1;(jh=="enum"||jh=="combo")&&Xh.values?((Hh=LiteGraph.debug)==null||Hh.call(LiteGraph,"showEditPropertyValue ENUM COMBO",Kh,jh,Zh),Kh=Zh.querySelector("select"),Kh.addEventListener("change",function(ed){var id;Zh.modified(),(id=LiteGraph.debug)==null||id.call(LiteGraph,"Enum change",Kh,Xh,ed.target),td(ed.target.value)})):jh=="boolean"||jh=="toggle"?((Uh=LiteGraph.debug)==null||Uh.call(LiteGraph,"showEditPropertyValue TOGGLE",Kh,jh,Zh),Kh=Zh.querySelector("input"),Kh&&Kh.addEventListener("click",function(ed){Zh.modified(),td(!!Kh.checked)})):(Kh=Zh.querySelector("input"),(Yh=LiteGraph.debug)==null||Yh.call(LiteGraph,"showEditPropertyValue",Kh,jh,Zh),Kh&&(Kh.addEventListener("blur",function(ed){this.focus()}),Vh=$h.properties[Th]!==void 0?$h.properties[Th]:"",jh!=="string"&&(Vh=JSON.stringify(Vh)),Kh.value=Vh,Kh.addEventListener("keydown",function(ed){if(ed.keyCode==27)Zh.close();else if(ed.keyCode==13)Jh();else if(ed.keyCode!=13){Zh.modified();return}ed.preventDefault(),ed.stopPropagation()}))),Kh&&Kh.focus();var Qh=Zh.querySelector("button");Qh.addEventListener("click",Jh);function Jh(){td(Kh.value)}function td(ed){var id;Xh&&Xh.values&&Xh.values.constructor===Object&&Xh.values[ed]!=null&&(ed=Xh.values[ed]),typeof $h.properties[Th]=="number"&&(ed=Number(ed)),(jh=="array"||jh=="object")&&(ed=JSON.parse(ed)),$h.properties[Th]=ed,(id=$h.graph)==null||id.onGraphChanged({action:"propertyChanged",doSave:!0}),$h.onPropertyChanged&&$h.onPropertyChanged(Th,ed),Fh.onclose&&Fh.onclose(),Zh.close(),$h.setDirtyCanvas(!0,!0)}return Zh}function createDialog($h,Th){var Fh={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};Th=Object.assign(Fh,Th||{});var Wh=document.createElement("div");Wh.className="graphdialog",Wh.innerHTML=$h,Wh.is_modified=!1;var zh=this.canvas.getBoundingClientRect(),Hh=-20,Uh=-20;if(zh&&(Hh-=zh.left,Uh-=zh.top),Th.position?(Hh+=Th.position[0],Uh+=Th.position[1]):Th.event?(Hh+=Th.event.clientX,Uh+=Th.event.clientY):(Hh+=this.canvas.width*.5,Uh+=this.canvas.height*.5),Wh.style.left=Hh+"px",Wh.style.top=Uh+"px",this.canvas.parentNode.appendChild(Wh),Th.checkForInput){var Yh=[],Xh=!1;Yh=Wh.querySelectorAll("input"),Yh&&Yh.forEach(function(Zh){Zh.addEventListener("keydown",function(Kh){if(Wh.modified(),Kh.keyCode==27)Wh.close();else if(Kh.keyCode!=13)return;Kh.preventDefault(),Kh.stopPropagation()}),Xh||Zh.focus()})}Wh.modified=function(){Wh.is_modified=!0},Wh.close=function(){Wh.parentNode&&Wh.parentNode.removeChild(Wh)};var jh=null,qh=0;Wh.addEventListener("pointerleave",function(Zh){qh>0||(Th.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!Wh.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(jh=setTimeout(Wh.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),Wh.addEventListener("pointerenter",function(Zh){(Th.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&jh&&clearTimeout(jh)});var Vh=Wh.querySelectorAll("select");return Vh&&Vh.forEach(function(Zh){Zh.addEventListener("pointerdown",function(Kh){qh++}),Zh.addEventListener("focus",function(Kh){qh++}),Zh.addEventListener("blur",function(Kh){qh=Math.max(0,qh-1)}),Zh.addEventListener("change",function(Kh){qh=0})}),Wh}function createPanel($h,Th){Th=Th||{};var Fh=Th.window||window,Wh=document.createElement("div");if(Wh.className="litegraph dialog",Wh.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",Wh.header=Wh.querySelector(".dialog-header"),Th.width&&(Wh.style.width=Th.width+(Th.width.constructor===Number?"px":"")),Th.height&&(Wh.style.height=Th.height+(Th.height.constructor===Number?"px":"")),Th.closable){var zh=document.createElement("span");zh.innerHTML="&#10005;",zh.classList.add("close"),zh.addEventListener("click",function(){Wh.close()}),Wh.header.appendChild(zh)}return Wh.title_element=Wh.querySelector(".dialog-title"),Wh.title_element.innerText=$h,Wh.content=Wh.querySelector(".dialog-content"),Wh.alt_content=Wh.querySelector(".dialog-alt-content"),Wh.footer=Wh.querySelector(".dialog-footer"),Wh.close=function(){Wh.onClose&&typeof Wh.onClose=="function"&&Wh.onClose(),Wh.parentNode&&Wh.parentNode.removeChild(Wh)},Wh.toggleAltContent=function(Hh){let Uh,Yh;typeof Hh!="undefined"?(Uh=Hh?"block":"none",Yh=Hh?"none":"block"):(Uh=Wh.alt_content.style.display!="block"?"block":"none",Yh=Wh.alt_content.style.display!="block"?"none":"block"),Wh.alt_content.style.display=Uh,Wh.content.style.display=Yh},Wh.toggleFooterVisibility=function(Hh){let Uh;typeof Hh!="undefined"?Uh=Hh?"block":"none":Uh=Wh.footer.style.display!="block"?"block":"none",Wh.footer.style.display=Uh},Wh.clear=function(){this.content.innerHTML=""},Wh.addHTML=function(Hh,Uh,Yh){var Xh=document.createElement("div");return Uh&&(Xh.className=Uh),Xh.innerHTML=Hh,Yh?Wh.footer.appendChild(Xh):Wh.content.appendChild(Xh),Xh},Wh.addButton=function(Hh,Uh,Yh){var Xh=document.createElement("button");return Xh.innerText=Hh,Xh.options=Yh,Xh.classList.add("btn"),Xh.addEventListener("click",Uh),Wh.footer.appendChild(Xh),Xh},Wh.addSeparator=function(){var Hh=document.createElement("div");Hh.className="separator",Wh.content.appendChild(Hh)},Wh.addWidget=function(Hh,Uh,Yh,Xh,jh){var qh,Vh;Xh=Xh||{};var Zh=String(Yh);Hh=Hh.toLowerCase(),Hh=="number"&&(Zh=Yh.toFixed(3));var Kh=document.createElement("div");Kh.className="property",Kh.innerHTML="<span class='property_name'></span><span class='property_value'></span>",Kh.querySelector(".property_name").innerText=Xh.label||Uh;var Qh=Kh.querySelector(".property_value");Qh.innerText=Zh,Kh.dataset.property=Uh,Kh.dataset.type=Xh.type||Hh,Kh.options=Xh,Kh.value=Yh,(qh=LiteGraph.debug)==null||qh.call(LiteGraph,"addWidget",Hh,Yh,Qh,Xh),Hh=="code"?Kh.addEventListener("click",function(td){Wh.inner_showCodePad(this.dataset.property)}):Hh=="boolean"?(Kh.classList.add("boolean"),Yh&&Kh.classList.add("bool-on"),Kh.addEventListener("click",function(){var td=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",Jh(td,this.value)})):Hh=="string"||Hh=="number"?(Qh.setAttribute("contenteditable",!0),Qh.addEventListener("keydown",function(td){td.code=="Enter"&&(Hh!="string"||!td.shiftKey)&&(td.preventDefault(),this.blur())}),Qh.addEventListener("blur",function(){var td=this.innerText,ed=this.parentNode.dataset.property,id=this.parentNode.dataset.type;id=="number"&&(td=Number(td)),Jh(ed,td)})):(Hh=="enum"||Hh=="combo")&&(Zh=LGraphCanvas.getPropertyPrintableValue(Yh,Xh.values),Qh.innerText=Zh,(Vh=LiteGraph.debug)==null||Vh.call(LiteGraph,"addWidget ENUM COMBO",Hh,Zh,Qh,Xh),Qh.addEventListener("click",function(td){var ed=Xh.values||[],id=this.parentNode.dataset.property,sd=this;new LiteGraph.ContextMenu(ed,{event:td,className:"dark",callback:nd},Fh);function nd(hd){return sd.innerText=hd,Jh(id,hd),!1}})),Wh.content.appendChild(Kh);function Jh(td,ed){var id;(id=LiteGraph.debug)==null||id.call(LiteGraph,"widgetInnerChange",td,ed,Xh),Xh.callback&&Xh.callback(td,ed,Xh),jh&&jh(td,ed,Xh)}return Kh},Wh.onOpen&&typeof Wh.onOpen=="function"&&Wh.onOpen(),Wh}function closePanels(){var $h=document.querySelector("#node-panel");$h&&$h.close(),$h=document.querySelector("#option-panel"),$h&&$h.close()}function showShowGraphOptionsPanel($h,Th){var Fh,Wh,zh,Hh;let Uh;if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!((Wh=(Fh=Th==null?void 0:Th.event)==null?void 0:Fh.target)!=null&&Wh.lgraphcanvas)){(zh=LiteGraph.warn)==null||zh.call(LiteGraph,"References not found to add optionPanel",$h,Th),LiteGraph.debug&&((Hh=LiteGraph.debug)==null||Hh.call(LiteGraph,"!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas",Th,Th.event,Th.event.target,Th.event.target.lgraphcanvas));return}Uh=Th.event.target.lgraphcanvas}else Uh=this;Uh.closePanels();var Yh=Uh.getCanvasWindow();panel=Uh.createPanel("Options",{closable:!0,window:Yh,onOpen:function(){Uh.OPTIONPANEL_IS_OPEN=!0},onClose:function(){Uh.OPTIONPANEL_IS_OPEN=!1,Uh.options_panel=null}}),Uh.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function Xh(){panel.content.innerHTML="";const jh=(Kh,Qh,Jh)=>{Jh&&Jh.key&&(Kh=Jh.key),Jh.values&&(Qh=Object.values(Jh.values).indexOf(Qh)),Uh[Kh]=Qh};var qh=LiteGraph.availableCanvasOptions;qh.sort();for(var Vh in qh){var Zh=qh[Vh];panel.addWidget("boolean",Zh,Uh[Zh],{key:Zh,on:"True",off:"False"},jh)}panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[Uh.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},jh),panel.addSeparator(),panel.footer.innerHTML=""}Xh(),Uh.canvas.parentNode.appendChild(panel)}function showShowNodePanel($h){this.SELECTED_NODE=$h,this.closePanels();var Th=this.getCanvasWindow(),Fh=this,Wh=this.createPanel($h.title||"",{closable:!0,window:Th,onOpen:function(){Fh.NODEPANEL_IS_OPEN=!0},onClose:function(){Fh.NODEPANEL_IS_OPEN=!1,Fh.node_panel=null}});Fh.node_panel=Wh,Wh.id="node-panel",Wh.node=$h,Wh.classList.add("settings");function zh(){Wh.content.innerHTML="",Wh.addHTML("<span class='node_type'>"+$h.type+"</span><span class='node_desc'>"+($h.constructor.desc||"")+"</span><span class='separator'></span>"),Wh.addHTML("<h3>Properties</h3>");const Hh=(qh,Vh)=>{var Zh,Kh;switch(Fh.graph.beforeChange($h),qh){case"Title":$h.title=Vh;break;case"Mode":var Qh=Object.values(LiteGraph.NODE_MODES).indexOf(Vh);Qh>=0&&LiteGraph.NODE_MODES[Qh]?$h.changeMode(Qh):(Zh=LiteGraph.warn)==null||Zh.call(LiteGraph,"unexpected mode: "+Vh);break;case"Color":LGraphCanvas.node_colors[Vh]?($h.color=LGraphCanvas.node_colors[Vh].color,$h.bgcolor=LGraphCanvas.node_colors[Vh].bgcolor):(Kh=LiteGraph.warn)==null||Kh.call(LiteGraph,"unexpected color: "+Vh);break;default:$h.setProperty(qh,Vh);break}Fh.graph.afterChange(),Fh.dirty_canvas=!0};Wh.addWidget("string","Title",$h.title,{},Hh),Wh.addWidget("combo","Mode",LiteGraph.NODE_MODES[$h.mode],{values:LiteGraph.NODE_MODES},Hh);var Uh="";$h.color!==void 0&&(Uh=Object.keys(LGraphCanvas.node_colors).filter(function(qh){return LGraphCanvas.node_colors[qh].color==$h.color})),Wh.addWidget("combo","Color",Uh,{values:Object.keys(LGraphCanvas.node_colors)},Hh);for(var Yh in $h.properties){var Xh=$h.properties[Yh],jh=$h.getPropertyInfo(Yh);$h.onAddPropertyToPanel&&$h.onAddPropertyToPanel(Yh,Wh,Xh,jh,Hh)||Wh.addWidget(jh.widget||jh.type,Yh,Xh,jh,Hh)}Wh.addSeparator(),$h.onShowCustomPanelInfo&&$h.onShowCustomPanelInfo(Wh),Wh.footer.innerHTML="",Wh.addButton("Delete",function(){$h.block_delete||($h.graph.remove($h),Wh.close())}).classList.add("delete")}Wh.inner_showCodePad=function(Hh){Wh.classList.remove("settings"),Wh.classList.add("centered"),Wh.alt_content.innerHTML="<textarea class='code'></textarea>";var Uh=Wh.alt_content.querySelector("textarea"),Yh=()=>{Wh.toggleAltContent(!1),Wh.toggleFooterVisibility(!0),Uh.parentNode.removeChild(Uh),Wh.classList.add("settings"),Wh.classList.remove("centered"),zh()};Uh.value=$h.properties[Hh],Uh.addEventListener("keydown",function(qh){qh.code=="Enter"&&qh.ctrlKey&&($h.setProperty(Hh,Uh.value),Yh())}),Wh.toggleAltContent(!0),Wh.toggleFooterVisibility(!1),Uh.style.height="calc(100% - 40px)";var Xh=Wh.addButton("Assign",function(){$h.setProperty(Hh,Uh.value),Yh()});Wh.alt_content.appendChild(Xh);var jh=Wh.addButton("Close",Yh);jh.style.float="right",Wh.alt_content.appendChild(jh)},zh(),this.canvas.parentNode.appendChild(Wh)}function showSubgraphPropertiesDialog($h){var Th;(Th=LiteGraph.log)==null||Th.call(LiteGraph,"showing subgraph properties dialog");var Fh=this.canvas.parentNode.querySelector(".subgraph_dialog");Fh&&Fh.close();var Wh=this.createPanel("Subgraph Inputs",{closable:!0,width:500});Wh.node=$h,Wh.classList.add("subgraph_dialog");function zh(){if(Wh.clear(),$h.inputs)for(let qh=0;qh<$h.inputs.length;++qh){var Yh=$h.inputs[qh];if(!Yh.not_subgraph_input){var Xh="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",jh=Wh.addHTML(Xh,"subgraph_property");jh.dataset.name=Yh.name,jh.dataset.slot=qh,jh.querySelector(".name").innerText=Yh.name,jh.querySelector(".type").innerText=Yh.type,jh.querySelector("button").addEventListener("click",function(Vh){$h.removeInput(Number(this.parentNode.dataset.slot)),zh()})}}}var Hh=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",Uh=Wh.addHTML(Hh,"subgraph_property extra",!0);return Uh.querySelector("button").addEventListener("click",function(Yh){var Xh=this.parentNode,jh=Xh.querySelector(".name").value,qh=Xh.querySelector(".type").value;!jh||$h.findInputSlot(jh)!=-1||($h.addInput(jh,qh),Xh.querySelector(".name").value="",Xh.querySelector(".type").value="",zh())}),zh(),this.canvas.parentNode.appendChild(Wh),Wh}function showSubgraphPropertiesDialogRight($h){var Th=this.canvas.parentNode.querySelector(".subgraph_dialog");Th&&Th.close();var Fh=this.createPanel("Subgraph Outputs",{closable:!0,width:500});Fh.node=$h,Fh.classList.add("subgraph_dialog");function Wh(){if(Fh.clear(),$h.outputs)for(let qh=0;qh<$h.outputs.length;++qh){var Yh=$h.outputs[qh];if(!Yh.not_subgraph_output){var Xh="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",jh=Fh.addHTML(Xh,"subgraph_property");jh.dataset.name=Yh.name,jh.dataset.slot=qh,jh.querySelector(".name").innerText=Yh.name,jh.querySelector(".type").innerText=Yh.type,jh.querySelector("button").addEventListener("click",function(Vh){$h.removeOutput(Number(this.parentNode.dataset.slot)),Wh()})}}}var zh=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",Hh=Fh.addHTML(zh,"subgraph_property extra",!0);Hh.querySelector(".name").addEventListener("keydown",function(Yh){e.keyCode==13&&Uh.apply(this)}),Hh.querySelector("button").addEventListener("click",function(Yh){Uh.apply(this)});function Uh(){var Yh=this.parentNode,Xh=Yh.querySelector(".name").value,jh=Yh.querySelector(".type").value;!Xh||$h.findOutputSlot(Xh)!=-1||($h.addOutput(Xh,jh),Yh.querySelector(".name").value="",Yh.querySelector(".type").value="",Wh())}return Wh(),this.canvas.parentNode.appendChild(Fh),Fh}function checkPanels(){if(this.canvas){var $h=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(let Fh=0;Fh<$h.length;++Fh){var Th=$h[Fh];Th.node&&(!Th.node.graph||Th.graph!=this.graph)&&Th.close()}}}class UiController{constructor(Th){this.host=Th}showLinkMenu(...Th){return showLinkMenu.apply(this.host,Th)}createDefaultNodeForSlot(...Th){return createDefaultNodeForSlot.apply(this.host,Th)}showConnectionMenu(...Th){return showConnectionMenu.apply(this.host,Th)}getCanvasMenuOptions(...Th){return getCanvasMenuOptions.apply(this.host,Th)}getNodeMenuOptions(...Th){return getNodeMenuOptions.apply(this.host,Th)}getGroupMenuOptions(...Th){return getGroupMenuOptions.apply(this.host,Th)}processContextMenu(...Th){return processContextMenu.apply(this.host,Th)}prompt(...Th){return prompt.apply(this.host,Th)}showSearchBox(...Th){return showSearchBox.apply(this.host,Th)}showEditPropertyValue(...Th){return showEditPropertyValue.apply(this.host,Th)}createDialog(...Th){return createDialog.apply(this.host,Th)}createPanel(...Th){return createPanel.apply(this.host,Th)}closePanels(...Th){return closePanels.apply(this.host,Th)}showShowGraphOptionsPanel(...Th){return showShowGraphOptionsPanel.apply(this.host,Th)}showShowNodePanel(...Th){return showShowNodePanel.apply(this.host,Th)}showSubgraphPropertiesDialog(...Th){return showSubgraphPropertiesDialog.apply(this.host,Th)}showSubgraphPropertiesDialogRight(...Th){return showSubgraphPropertiesDialogRight.apply(this.host,Th)}checkPanels(...Th){return checkPanels.apply(this.host,Th)}}function createLGraphCanvasControllers($h){return{core:new CoreController($h),events:new EventsController($h),render:new RenderController($h),selection:new SelectionController($h),ui:new UiController($h)}}const delegateMap={clear:"core",setGraph:"core",getTopGraph:"core",openSubgraph:"core",closeSubgraph:"core",getCurrentGraph:"core",setCanvas:"core",_doNothing:"core",_doReturnTrue:"core",bindEvents:"core",unbindEvents:"core",enableWebGL:"core",setDirty:"core",getCanvasWindow:"core",startRendering:"core",stopRendering:"core",blockClick:"events",processUserInputDown:"events",processMouseDown:"events",processMouseMove:"events",processMouseUp:"events",processMouseWheel:"events",isOverNodeBox:"core",isOverNodeInput:"core",isOverNodeOutput:"core",processKey:"events",copyToClipboard:"selection",pasteFromClipboard:"selection",processDrop:"events",checkDropItem:"events",processNodeDblClicked:"selection",processNodeSelected:"selection",selectNode:"selection",selectNodes:"selection",deselectNode:"selection",deselectAllNodes:"selection",deleteSelectedNodes:"selection",centerOnNode:"core",adjustMouseEvent:"core",setZoom:"core",convertOffsetToCanvas:"core",convertCanvasToOffset:"core",convertEventToCanvasOffset:"core",bringToFront:"core",sendToBack:"core",computeVisibleNodes:"core",draw:"render",drawFrontCanvas:"render",beginNodeFrameLeafer:"render",endNodeFrameLeafer:"render",drawSubgraphPanel:"render",drawSubgraphPanelLeft:"render",drawSubgraphPanelRight:"render",drawButton:"render",isAreaClicked:"render",renderInfo:"render",drawBackCanvas:"render",drawNode:"render",drawNodeTooltip:"render",drawLinkTooltip:"render",drawNodeShape:"render",drawConnections:"render",renderLink:"render",computeConnectionPoint:"render",drawExecutionOrder:"render",drawNodeWidgets:"render",processNodeWidgets:"render",drawGroups:"render",adjustNodesSize:"render",resize:"core",switchLiveMode:"core",onNodeSelectionChange:"selection",boundaryNodesForSelection:"selection",showLinkMenu:"ui",createDefaultNodeForSlot:"ui",showConnectionMenu:"ui",prompt:"ui",showSearchBox:"ui",showEditPropertyValue:"ui",createDialog:"ui",createPanel:"ui",closePanels:"ui",showShowGraphOptionsPanel:"ui",showShowNodePanel:"ui",showSubgraphPropertiesDialog:"ui",showSubgraphPropertiesDialogRight:"ui",checkPanels:"ui",getCanvasMenuOptions:"ui",getNodeMenuOptions:"ui",getGroupMenuOptions:"ui",processContextMenu:"ui",lowQualityRenderingRequired:"render"};function ensureControllers($h){return $h.controllers||($h.controllers=createLGraphCanvasControllers($h)),$h.controllers}function installLGraphCanvasDelegates($h){for(const[Th,Fh]of Object.entries(delegateMap))Object.defineProperty($h.prototype,Th,{value:function(...Wh){return ensureControllers(this)[Fh][Th](...Wh)},writable:!0,configurable:!0})}function getFileExtension($h){const Th=new URL($h).pathname,Fh=Th.lastIndexOf(".");return Fh===-1?"":Th.slice(Fh+1).toLowerCase()}function onGroupAdd($h,Th,Fh){var Wh=LGraphCanvas.active_canvas,zh=new LiteGraph.LGraphGroup;zh.pos=Wh.convertEventToCanvasOffset(Fh),Wh.graph.add(zh)}function getBoundaryNodes($h){let Th=null,Fh=null,Wh=null,zh=null;for(const Hh in $h){const Uh=$h[Hh],[Yh,Xh]=Uh.pos,[jh,qh]=Uh.size;(Th===null||Xh<Th.pos[1])&&(Th=Uh),(Fh===null||Yh+jh>Fh.pos[0]+Fh.size[0])&&(Fh=Uh),(Wh===null||Xh+qh>Wh.pos[1]+Wh.size[1])&&(Wh=Uh),(zh===null||Yh<zh.pos[0])&&(zh=Uh)}return{top:Th,right:Fh,bottom:Wh,left:zh}}function alignNodes($h,Th,Fh){if(!$h)return;const Wh=LGraphCanvas.active_canvas;let zh=[];Fh===void 0?zh=LGraphCanvas.getBoundaryNodes($h):zh={top:Fh,right:Fh,bottom:Fh,left:Fh};for(const[Hh,Uh]of Object.entries(Wh.selected_nodes))switch(Th){case"right":Uh.pos[0]=zh.right.pos[0]+zh.right.size[0]-Uh.size[0];break;case"left":Uh.pos[0]=zh.left.pos[0];break;case"top":Uh.pos[1]=zh.top.pos[1];break;case"bottom":Uh.pos[1]=zh.bottom.pos[1]+zh.bottom.size[1]-Uh.size[1];break}Wh.dirty_canvas=!0,Wh.dirty_bgcanvas=!0}function onNodeAlign($h,Th,Fh,Wh,zh){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:Fh,callback:Hh,parentMenu:Wh});function Hh(Uh){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,Uh.toLowerCase(),zh)}}function onGroupAlign($h,Th,Fh,Wh){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:Fh,callback:zh,parentMenu:Wh});function zh(Hh){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,Hh.toLowerCase())}}function onMenuAdd($h,Th,Fh,Wh,zh){var Hh=LGraphCanvas.active_canvas,Uh=Hh.getCanvasWindow(),Yh=Hh.graph;if(!Yh)return;function Xh(jh,qh){var Vh=LiteGraph.getNodeTypesCategories(Hh.filter||Yh.filter).filter(function(Qh){return Qh.startsWith(jh)}),Zh=[];Vh.map(function(Qh){if(Qh){var Jh=new RegExp("^("+jh+")"),td=Qh.replace(Jh,"").split("/")[0],ed=jh===""?td+"/":jh+td+"/",id=td;id.indexOf("::")!=-1&&(id=id.split("::")[1]);var sd=Zh.findIndex(function(nd){return nd.value===ed});sd===-1&&Zh.push({value:ed,content:id,has_submenu:!0,callback:function(nd,hd,ud,rd){Xh(nd.value,rd)}})}});var Kh=LiteGraph.getNodeTypesInCategory(jh.slice(0,-1),Hh.filter||Yh.filter);Kh.map(function(Qh){if(!Qh.skip_list){var Jh={value:Qh.type,content:Qh.title,has_submenu:!1,callback:function(td,ed,id,sd){var nd=sd.getFirstEvent();Hh.graph.beforeChange();var hd=LiteGraph.createNode(td.value);hd&&(hd.pos=Hh.convertEventToCanvasOffset(nd),Hh.graph.add(hd)),zh&&zh(hd),Hh.graph.afterChange()}};Zh.push(Jh)}}),new LiteGraph.ContextMenu(Zh,{event:Fh,parentMenu:qh},Uh)}return Xh("",Wh),!1}function onMenuCollapseAll(){}function onMenuNodeEdit(){}function showMenuNodeOptionalInputs($h,Th,Fh,Wh,zh){var Hh;if(!zh)return;var Uh=this,Yh=LGraphCanvas.active_canvas,Xh=Yh.getCanvasWindow();Th=zh.optional_inputs,zh.onGetInputs&&(Th=zh.onGetInputs());var jh=[];if(Th)for(let Jh=0;Jh<Th.length;Jh++){var qh=Th[Jh];if(!qh){jh.push(null);continue}var Vh=qh[0];qh[2]||(qh[2]={}),qh[2].label&&(Vh=qh[2].label),qh[2].removable=!0;var Zh={content:Vh,value:qh};qh[1]==LiteGraph.ACTION&&(Zh.className="event"),jh.push(Zh)}if(zh.onMenuNodeInputs){var Kh=zh.onMenuNodeInputs(jh);Kh&&(jh=Kh)}if(LiteGraph.do_add_triggers_slots&&zh.findInputSlot("onTrigger")==-1&&jh.push({content:"On Trigger",value:["onTrigger",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),!jh.length){LiteGraph.debug&&((Hh=LiteGraph.log)==null||Hh.call(LiteGraph,"no input entries"));return}new LiteGraph.ContextMenu(jh,{event:Fh,callback:Qh,parentMenu:Wh,node:zh},Xh);function Qh(Jh,td,ed){var id;if(zh&&(Jh.callback&&Jh.callback.call(Uh,zh,Jh,td,ed),Jh.value)){zh.graph.beforeChange();const sd=Jh.value[2]?Object.assign({},Jh.value[2]):{};zh.addInput(Jh.value[0],Jh.value[1],sd),(id=zh.onNodeInputAdd)==null||id.call(zh,Jh.value),zh.setDirtyCanvas(!0,!0),zh.graph.afterChange()}}return!1}function showMenuNodeOptionalOutputs($h,Th,Fh,Wh,zh){if(!zh)return;var Hh=this,Uh=LGraphCanvas.active_canvas,Yh=Uh.getCanvasWindow();Th=zh.optional_outputs,zh.onGetOutputs&&(Th=zh.onGetOutputs());var Xh=[];if(Th)for(let Qh=0;Qh<Th.length;Qh++){var jh=Th[Qh];if(!jh){Xh.push(null);continue}if(!(zh.flags&&zh.flags.skip_repeated_outputs&&zh.findOutputSlot(jh[0])!=-1)){var qh=jh[0];jh[2]||(jh[2]={}),jh[2].label&&(qh=jh[2].label),jh[2].removable=!0;var Vh={content:qh,value:jh};jh[1]==LiteGraph.EVENT&&(Vh.className="event"),Xh.push(Vh)}}if(this.onMenuNodeOutputs&&(Xh=this.onMenuNodeOutputs(Xh)),LiteGraph.do_add_triggers_slots&&zh.findOutputSlot("onExecuted")==-1&&Xh.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),zh.onMenuNodeOutputs){var Zh=zh.onMenuNodeOutputs(Xh);Zh&&(Xh=Zh)}if(!Xh.length)return;new LiteGraph.ContextMenu(Xh,{event:Fh,callback:Kh,parentMenu:Wh,node:zh},Yh);function Kh(Qh,Jh,td){var ed;if(zh&&(Qh.callback&&Qh.callback.call(Hh,zh,Qh,Jh,td),!!Qh.value)){var id=Qh.value[1];if(id&&(id.constructor===Object||id.constructor===Array)){var sd=[];for(let nd in id)sd.push({content:nd,value:id[nd]});return new LiteGraph.ContextMenu(sd,{event:Jh,callback:Kh,parentMenu:Wh,node:zh}),!1}else{zh.graph.beforeChange();const nd=Qh.value[2]?Object.assign({},Qh.value[2]):{};zh.addOutput(Qh.value[0],Qh.value[1],nd),(ed=zh.onNodeOutputAdd)==null||ed.call(zh,Qh.value),zh.setDirtyCanvas(!0,!0),zh.graph.afterChange()}}}return!1}function onShowMenuNodeProperties($h,Th,Fh,Wh,zh){if(!zh||!zh.properties)return;var Hh=LGraphCanvas.active_canvas,Uh=Hh.getCanvasWindow(),Yh=[];for(let qh in zh.properties){$h=zh.properties[qh]!==void 0?zh.properties[qh]:" ",typeof $h=="object"&&($h=JSON.stringify($h));var Xh=zh.getPropertyInfo(qh);(Xh.type=="enum"||Xh.type=="combo")&&($h=LGraphCanvas.getPropertyPrintableValue($h,Xh.values)),$h=LGraphCanvas.decodeHTML($h),Yh.push({content:"<span class='property_name'>"+(Xh.label?Xh.label:qh)+"</span><span class='property_value'>"+$h+"</span>",value:qh})}if(!Yh.length)return;new LiteGraph.ContextMenu(Yh,{event:Fh,callback:jh,parentMenu:Wh,allow_html:!0,node:zh},Uh);function jh(qh){if(zh){var Vh=this.getBoundingClientRect();Hh.showEditPropertyValue(zh,qh.value,{position:[Vh.left,Vh.top]})}}return!1}function decodeHTML($h){var Th=document.createElement("div");return Th.innerText=$h,Th.innerHTML}function onMenuResizeNode($h,Th,Fh,Wh,zh){if(!zh)return;const Hh=Yh=>{Yh.size=Yh.computeSize(),Yh.onResize&&Yh.onResize(Yh.size)};var Uh=LGraphCanvas.active_canvas;if(!Uh.selected_nodes||Object.keys(Uh.selected_nodes).length<=1)Hh(zh);else for(let Yh in Uh.selected_nodes)Hh(Uh.selected_nodes[Yh]);zh.setDirtyCanvas(!0,!0)}function onShowPropertyEditor($h,Th,Fh,Wh,zh){var Hh=$h.property||"title",Uh=zh[Hh],Yh=document.createElement("div");Yh.is_modified=!1,Yh.className="graphdialog",Yh.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",Yh.close=()=>{var sd;(sd=Yh.parentNode)==null||sd.removeChild(Yh)};var Xh=Yh.querySelector(".name");Xh.innerText=Hh;var jh=Yh.querySelector(".value");const qh=()=>{jh&&id(jh.value)};jh&&(jh.value=Uh,jh.addEventListener("blur",function(sd){this.focus()}),jh.addEventListener("keydown",function(sd){if(Yh.is_modified=!0,sd.keyCode==27)Yh.close();else if(sd.keyCode==13)qh();else if(sd.keyCode!=13&&sd.target.localName!="textarea")return;sd.preventDefault(),sd.stopPropagation()}));var Vh=LGraphCanvas.active_canvas,Zh=Vh.canvas,Kh=Zh.getBoundingClientRect(),Qh=-20,Jh=-20;Kh&&(Qh-=Kh.left,Jh-=Kh.top),Fh?(Yh.style.left=Fh.clientX+Qh+"px",Yh.style.top=Fh.clientY+Jh+"px"):(Yh.style.left=Zh.width*.5+Qh+"px",Yh.style.top=Zh.height*.5+Jh+"px");var td=Yh.querySelector("button");td.addEventListener("click",qh),Zh.parentNode.appendChild(Yh),jh&&jh.focus();let ed=null;Yh.addEventListener("pointerleave",sd=>{LiteGraph.dialog_close_on_mouse_leave&&!Yh.is_modified&&(ed=setTimeout(Yh.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),Yh.addEventListener("pointerenter",sd=>{LiteGraph.dialog_close_on_mouse_leave&&ed&&clearTimeout(ed)});const id=sd=>{var nd;switch($h.type){case"Number":sd=Number(sd);break;case"Boolean":sd=!!sd;break}zh[Hh]=sd,(nd=Yh.parentNode)==null||nd.removeChild(Yh),zh.setDirtyCanvas(!0,!0)}}function getPropertyPrintableValue($h,Th){if(!Th||Th.constructor===Array)return String($h);if(Th.constructor===Object){var Fh="";for(var Wh in Th)if(Th[Wh]==$h){Fh=Wh;break}return String($h)+" ("+Fh+")"}}function onMenuNodeCollapse($h,Th,Fh,Wh,zh){zh.graph.beforeChange();var Hh=function(Yh){Yh.collapse()},Uh=LGraphCanvas.active_canvas;if(!Uh.selected_nodes||Object.keys(Uh.selected_nodes).length<=1)Hh(zh);else for(let Yh in Uh.selected_nodes)Hh(Uh.selected_nodes[Yh]);zh.graph.afterChange()}function onMenuNodePin($h,Th,Fh,Wh,zh){zh.pin()}function onMenuNodeMode($h,Th,Fh,Wh,zh){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:Fh,callback:Hh,parentMenu:Wh,node:zh});function Hh(Uh){if(!zh)return;var Yh=Object.values(LiteGraph.NODE_MODES).indexOf(Uh);const Xh=qh=>{var Vh;Yh>=0&&LiteGraph.NODE_MODES[Yh]?qh.changeMode(Yh):((Vh=LiteGraph.warn)==null||Vh.call(LiteGraph,"unexpected mode: "+Uh),qh.changeMode(LiteGraph.ALWAYS))};var jh=LGraphCanvas.active_canvas;if(!jh.selected_nodes||Object.keys(jh.selected_nodes).length<=1)Xh(zh);else for(let qh in jh.selected_nodes)Xh(jh.selected_nodes[qh])}return!1}function onMenuNodeColors($h,Th,Fh,Wh,zh){if(!zh)throw new Error("no node for color");var Hh=[];Hh.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(let Yh in LGraphCanvas.node_colors){let Xh=LGraphCanvas.node_colors[Yh];$h={value:Yh,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+Xh.color+"; background-color:"+Xh.bgcolor+"'>"+Yh+"</span>"},Hh.push($h)}new LiteGraph.ContextMenu(Hh,{event:Fh,callback:Uh,parentMenu:Wh,node:zh});function Uh(Yh){if(!zh)return;let Xh=Yh.value?LGraphCanvas.node_colors[Yh.value]:null;const jh=Vh=>{Xh?Vh.constructor===LiteGraph.LGraphGroup?Vh.color=Xh.groupcolor:(Vh.color=Xh.color,Vh.bgcolor=Xh.bgcolor):(delete Vh.color,delete Vh.bgcolor)};var qh=LGraphCanvas.active_canvas;if(!qh.selected_nodes||Object.keys(qh.selected_nodes).length<=1)jh(zh);else for(let Vh in qh.selected_nodes)jh(qh.selected_nodes[Vh]);zh.setDirtyCanvas(!0,!0)}return!1}function onMenuNodeShapes($h,Th,Fh,Wh,zh){if(!zh)throw new Error("no node passed");new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:Fh,callback:Hh,parentMenu:Wh,node:zh});function Hh(Uh){if(!zh)return;zh.graph.beforeChange();const Yh=jh=>{jh.shape=Uh};var Xh=LGraphCanvas.active_canvas;if(!Xh.selected_nodes||Object.keys(Xh.selected_nodes).length<=1)Yh(zh);else for(let jh in Xh.selected_nodes)Yh(Xh.selected_nodes[jh]);zh.graph.afterChange(),zh.setDirtyCanvas(!0)}return!1}function onMenuNodeRemove($h,Th,Fh,Wh,zh){if(!zh)throw new Error("no node passed");var Hh=zh.graph;Hh.beforeChange();const Uh=Xh=>{Xh.removable!==!1&&Hh.remove(Xh)};var Yh=LGraphCanvas.active_canvas;if(!Yh.selected_nodes||Object.keys(Yh.selected_nodes).length<=1)Uh(zh);else for(let Xh in Yh.selected_nodes)Uh(Yh.selected_nodes[Xh]);Hh.afterChange(),zh.setDirtyCanvas(!0,!0)}function onMenuNodeToSubgraph($h,Th,Fh,Wh,zh){var Hh=zh.graph,Uh=LGraphCanvas.active_canvas;if(Uh){var Yh=Object.values(Uh.selected_nodes||{});Yh.length||(Yh=[zh]);var Xh=LiteGraph.createNode("graph/subgraph");Xh.pos=zh.pos.concat(),Hh.add(Xh),Xh.buildFromNodes(Yh),Uh.deselectAllNodes(),zh.setDirtyCanvas(!0,!0)}}function onMenuNodeClone($h,Th,Fh,Wh,zh){zh.graph.beforeChange();var Hh={};const Uh=Xh=>{if(Xh.clonable!==!1){var jh=Xh.clone();jh&&(jh.pos=[Xh.pos[0]+5,Xh.pos[1]+5],Xh.graph.add(jh),Hh[jh.id]=jh)}};var Yh=LGraphCanvas.active_canvas;if(!Yh.selected_nodes||Object.keys(Yh.selected_nodes).length<=1)Uh(zh);else for(let Xh in Yh.selected_nodes)Uh(Yh.selected_nodes[Xh]);Object.keys(Hh).length&&Yh.selectNodes(Hh),zh.graph.afterChange(),zh.setDirtyCanvas(!0,!0)}const DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",link_type_colors={"-1":"#A86",number:"#AAA",node:"#DCA",string:"#77F",boolean:"#F77"},gradients={},search_limit=-1,node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};function applyLGraphCanvasStatics($h){Object.assign($h,{getFileExtension,onGroupAdd,getBoundaryNodes,alignNodes,onNodeAlign,onGroupAlign,onMenuAdd,onMenuCollapseAll,onMenuNodeEdit,showMenuNodeOptionalInputs,showMenuNodeOptionalOutputs,onShowMenuNodeProperties,decodeHTML,onMenuResizeNode,onShowPropertyEditor,getPropertyPrintableValue,onMenuNodeCollapse,onMenuNodePin,onMenuNodeMode,onMenuNodeColors,onMenuNodeShapes,onMenuNodeRemove,onMenuNodeToSubgraph,onMenuNodeClone}),$h.DEFAULT_BACKGROUND_IMAGE=DEFAULT_BACKGROUND_IMAGE,$h.link_type_colors=link_type_colors,$h.gradients=gradients,$h.search_limit=search_limit,$h.node_colors=node_colors}class LGraphCanvas{constructor(Th,Fh,Wh){Wh!=null||(Wh={skip_render:!1,autoresize:!1,clip_all_nodes:!1,rendererAdapter:null}),this.options=Wh,this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,Th&&Th.constructor===String&&(Th=document.querySelector(Th)),this.ds=new LiteGraph.DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=`${LiteGraph.NODE_TEXT_SIZE}px Arial`,this.inner_text_font=`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.move_destination_link_without_shift=!1,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.free_resize=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.autoresize=Wh.autoresize,this.skip_render=Wh.skip_render,this.clip_all_nodes=Wh.clip_all_nodes,this.free_resize=Wh.free_resize,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=Wh.viewport||null,this.low_quality_rendering_threshold=5,this.controllers=createLGraphCanvasControllers(this),this.rendererAdapter=Wh.rendererAdapter||new Canvas2DRendererAdapter,this.frontSurface=null,this.backSurface=null,this.processMouseWheel=this.processMouseWheel.bind(this),this.processKey=this.processKey.bind(this),this.processDrop=this.processDrop.bind(this),Fh==null||Fh.attachCanvas(this),this.setCanvas(Th,Wh.skip_events),this.clear(),!this.skip_render&&!Wh.skip_render&&this.startRendering()}}installLGraphCanvasDelegates(LGraphCanvas),applyLGraphCanvasStatics(LGraphCanvas);class DragAndScale{constructor(Th,Fh){Yl(this,"onMouseDown",Wh=>{if(!this.enabled)return;const zh=this.element.getBoundingClientRect();var Hh=Wh.clientX-zh.left,Uh=Wh.clientY-zh.top;Wh.canvasx=Hh,Wh.canvasy=Uh,Wh.dragging=this.dragging;var Yh=!this.viewport||this.viewport&&Hh>=this.viewport[0]&&Hh<this.viewport[0]+this.viewport[2]&&Uh>=this.viewport[1]&&Uh<this.viewport[1]+this.viewport[3];Yh&&(this.dragging=!0,this.abortController=new AbortController,document.addEventListener("pointermove",this.onMouseMove,{signal:this.abortController.signal}),document.addEventListener("pointerup",this.onMouseUp,{signal:this.abortController.signal})),this.last_mouse[0]=Hh,this.last_mouse[1]=Uh}),Yl(this,"onMouseMove",Wh=>{if(!this.enabled)return;const zh=this.element.getBoundingClientRect();var Hh=Wh.clientX-zh.left,Uh=Wh.clientY-zh.top;Wh.canvasx=Hh,Wh.canvasy=Uh,Wh.dragging=this.dragging;var Yh=Hh-this.last_mouse[0],Xh=Uh-this.last_mouse[1];this.dragging&&this.mouseDrag(Yh,Xh),this.last_mouse[0]=Hh,this.last_mouse[1]=Uh}),Yl(this,"onMouseUp",Wh=>{var zh;this.dragging=!1,(zh=this.abortController)==null||zh.abort()}),Yl(this,"onWheel",Wh=>{Wh.wheel=-Wh.deltaY,Wh.delta=Wh.wheelDelta?Wh.wheelDelta/40:Wh.deltaY?-Wh.deltaY/3:0,this.changeDeltaScale(1+Wh.delta*.05)}),this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),Th&&(this.element=Th,Fh||this.bindEvents(Th))}bindEvents(Th){this.last_mouse=new Float32Array(2),Th.addEventListener("pointerdown",this.onMouseDown),Th.addEventListener("wheel",this.onWheel)}computeVisibleArea(Th){if(!this.element){this.visible_area.set([0,0,0,0]);return}let Fh=this.element.width,Wh=this.element.height,zh=-this.offset[0],Hh=-this.offset[1];if(Th){zh+=Th[0]/this.scale,Hh+=Th[1]/this.scale;const[Xh,jh]=Th.slice(2);Fh=Xh,Wh=jh}const Uh=zh+Fh/this.scale,Yh=Hh+Wh/this.scale;this.visible_area.set([zh,Hh,Uh-zh,Yh-Hh])}toCanvasContext(Th){Th.scale(this.scale,this.scale),Th.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(Th){return[(Th[0]+this.offset[0])*this.scale,(Th[1]+this.offset[1])*this.scale]}convertCanvasToOffset(Th,Fh=[0,0]){return Fh[0]=Th[0]/this.scale-this.offset[0],Fh[1]=Th[1]/this.scale-this.offset[1],Fh}mouseDrag(Th,Fh){var Wh;this.offset[0]+=Th/this.scale,this.offset[1]+=Fh/this.scale,(Wh=this.onredraw)==null||Wh.call(this,this)}changeScale(Th,Fh){var Wh;if(Th=LiteGraph.clamp(Th,this.min_scale,this.max_scale),Th==this.scale||!this.element)return;const zh=this.element.getBoundingClientRect();if(zh){Fh=Fh||[zh.width*.5,zh.height*.5];var Hh=this.convertCanvasToOffset(Fh);this.scale=Th,Math.abs(this.scale-1)<.01&&(this.scale=1);var Uh=this.convertCanvasToOffset(Fh),Yh=[Uh[0]-Hh[0],Uh[1]-Hh[1]];this.offset[0]+=Yh[0],this.offset[1]+=Yh[1],(Wh=this.onredraw)==null||Wh.call(this,this)}}changeDeltaScale(Th,Fh){this.changeScale(this.scale*Th,Fh)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}function normalizeContextMenuOptions($h={}){var Th;return(Th=$h.scroll_speed)!=null||($h.scroll_speed=.1),$h}function linkContextMenuToParent($h,Th){var Fh;const Wh=$h.options.parentMenu;if(Wh){if(Wh.constructor!==$h.constructor){(Fh=Th.error)==null||Fh.call(Th,"parentMenu must be of class ContextMenu, ignoring it"),$h.options.parentMenu=null;return}$h.parentMenu=Wh,$h.parentMenu.lock=!0,$h.parentMenu.current_submenu=$h}}function validateContextMenuEventClass($h,Th){var Fh;if(!$h.options.event)return;const Wh=$h.options.event.constructor.name;Wh!=="MouseEvent"&&Wh!=="CustomEvent"&&Wh!=="PointerEvent"&&((Fh=Th.error)==null||Fh.call(Th,`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${Wh})`),$h.options.event=null)}function createContextMenuRoot($h){const Th=$h.root=document.createElement("div");return $h.options.className&&(Th.className=$h.options.className),Th.classList.add("litegraph","litecontextmenu","litemenubar-panel"),Th.style.minWidth="80px",Th.style.minHeight="10px",Th}function setContextMenuTitle($h,Th){var Fh;if(!Th)return;(Fh=$h.titleElement)!=null||($h.titleElement=document.createElement("div"));const Wh=$h.titleElement;Wh.className="litemenu-title",Wh.innerHTML=Th,$h.root.parentElement||$h.root.appendChild(Wh)}function addContextMenuItems($h,Th){for(let Fh=0;Fh<Th.length;Fh++){let Wh=Th[Fh];typeof Wh!="string"&&(Wh=Wh&&Wh.content!==void 0?String(Wh.content):String(Wh));const zh=Th[Fh];$h.menu_elements.push($h.addItem(Wh,zh,$h.options))}}function resolveContextMenuHost($h){var Th,Fh,Wh;const zh=(Fh=(Th=$h.options.event)==null?void 0:Th.target.ownerDocument)!=null?Fh:document,Hh=(Wh=zh.fullscreenElement)!=null?Wh:zh.body;return{doc:zh,parent:Hh}}function appendContextMenuRoot($h,Th){Th.appendChild($h.root)}function bindContextMenuRootEvents($h){const Th=$h.root;Th.style.pointerEvents="none",setTimeout(()=>{Th.style.pointerEvents="auto"},100),Th.addEventListener("pointerup",Fh=>(Fh.preventDefault(),!0)),Th.addEventListener("contextmenu",Fh=>(Fh.button!=2||Fh.preventDefault(),!1)),Th.addEventListener("pointerdown",Fh=>{if(Fh.button==2)return $h.close(),Fh.preventDefault(),!0}),Th.addEventListener("wheel",Fh=>{const Wh=parseInt(Th.style.top);return Th.style.top=(Wh+Fh.deltaY*$h.options.scroll_speed).toFixed()+"px",Fh.preventDefault(),!0}),Th.addEventListener("pointerenter",Fh=>{Th.closing_timer&&clearTimeout(Th.closing_timer)})}function setupContextMenuFiltering($h,Th,Fh,Wh){var zh;if(!Th){(zh=Wh.warn)==null||zh.call(Wh,"NO root document to add context menu and event",Th,$h.options);return}Fh.f_textfilter&&(Th.removeEventListener("keydown",Fh.f_textfilter,!1),Th.removeEventListener("keydown",Fh.f_textfilter,!0),Fh.f_textfilter=!1),Fh.f_textfilter=function(Hh){var Uh,Yh,Xh,jh,qh,Vh,Zh;if($h.current_submenu){(Uh=Wh.debug)==null||Uh.call(Wh,"Prevent filtering on ParentMenu",$h);return}if($h.allOptions||($h.allOptions=$h.menu_elements,$h.selectedOption=!1),$h.currentOptions||($h.currentOptions=$h.allOptions),$h.filteringText||($h.filteringText=""),Hh.key){let Kh=!1;switch(Hh.key){case"Backspace":$h.filteringText.length&&($h.filteringText=$h.filteringText.substring(0,$h.filteringText.length-1),Kh=!0);break;case"Escape":Fh.f_textfilter&&(Th.removeEventListener("keydown",Fh.f_textfilter,!1),Th.removeEventListener("keydown",Fh.f_textfilter,!0),Fh.f_textfilter=!1),$h.close();break;case"ArrowDown":do $h.selectedOption=$h.selectedOption!==!1?Math.min(Math.max($h.selectedOption+1,0),$h.allOptions.length-1):0;while($h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&$h.selectedOption<$h.allOptions.length-1);$h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&($h.selectedOption=$h.currentOptions[$h.currentOptions.length-1].menu_index),Kh=!0;break;case"ArrowUp":do $h.selectedOption=$h.selectedOption!==!1?Math.min(Math.max($h.selectedOption-1,0),$h.allOptions.length-1):0;while($h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&$h.selectedOption>0);$h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&($h.currentOptions&&$h.currentOptions.length?$h.selectedOption=$h.currentOptions[0].menu_index:$h.selectedOption=!1),Kh=!0;break;case"ArrowLeft":break;case"ArrowRight":case"Enter":if($h.selectedOption!==!1)$h.allOptions[$h.selectedOption]?((Yh=Wh.debug)==null||Yh.call(Wh,"ContextElement simCLICK",$h.allOptions[$h.selectedOption]),$h.allOptions[$h.selectedOption].do_click&&$h.allOptions[$h.selectedOption].do_click($h.options.event,ignore_parent_menu)):((Xh=Wh.debug)==null||Xh.call(Wh,"ContextElement selection wrong",$h.selectedOption),$h.selectedOption=$h.selectedOption!==!1?Math.min(Math.max($h.selectedOption,0),$h.allOptions.length-1):0);else if($h.filteringText.length){for(const Qh in $h.allOptions)if($h.allOptions[Qh].style.display!=="none"&&!($h.allOptions[Qh].classList+"").includes("separator")&&$h.allOptions[Qh].textContent!=="Search"){(jh=Wh.debug)==null||jh.call(Wh,"ContextElement simCLICK",$h.allOptions[Qh]),Fh.f_textfilter&&Th&&(Th.removeEventListener("keydown",Fh.f_textfilter,!1),Th.removeEventListener("keydown",Fh.f_textfilter,!0),(qh=Wh.debug)==null||qh.call(Wh,"Cleaned ParentContextMenu listener",Th,$h)),$h.allOptions[Qh].do_click(Hh,!1);break}}Kh=!0;break;default:(Vh=Wh.debug)==null||Vh.call(Wh,"ContextMenu filter: keyEvent",Hh.key);break}!Kh&&Hh.key.length==1&&($h.filteringText+=Hh.key,$h.parentMenu)}if($h.filteringText&&$h.filteringText!==""){const Kh=[];$h.currentOptions=[];for(const Qh in $h.allOptions){const Jh=$h.allOptions[Qh].textContent,td=Jh.toLocaleLowerCase().includes($h.filteringText.toLocaleLowerCase()),ed=Jh.toLocaleLowerCase().startsWith($h.filteringText.toLocaleLowerCase()),id=Jh.split("/"),sd=id.length>1&&id[id.length-1].toLocaleLowerCase().startsWith($h.filteringText.toLocaleLowerCase())||id.length==1&&ed,nd=($h.allOptions[Qh].classList+"").includes("separator")||Jh==="Search";$h.allOptions[Qh].menu_index=Qh,td&&!nd?(Kh.push($h.allOptions[Qh]),$h.allOptions[Qh].style.display="block",$h.allOptions[Qh].hidden=!1,$h.currentOptions.push($h.allOptions[Qh]),$h.allOptions[Qh].filtered_index=$h.currentOptions.length-1):($h.allOptions[Qh].hidden=!0,$h.allOptions[Qh].style.display="none",$h.allOptions[Qh].filtered_index=!1),sd?$h.allOptions[Qh].style.fontWeight="bold":ed&&($h.allOptions[Qh].style.fontStyle="italic")}$h.selectedOption=$h.selectedOption!==!1?Math.min(Math.max($h.selectedOption,0),$h.allOptions.length-1):0,$h.allOptions[$h.selectedOption]&&$h.allOptions[$h.selectedOption].hidden&&$h.currentOptions.length&&($h.selectedOption=$h.currentOptions[0].menu_index)}else{$h.currentOptions=$h.allOptions;for(const Kh in $h.allOptions)$h.allOptions[Kh].style.display="block",$h.allOptions[Kh].style.fontStyle="inherit",$h.allOptions[Kh].style.fontWeight="inherit",$h.allOptions[Kh].hidden=!1,$h.allOptions[Kh].filtered_index=!1,$h.allOptions[Kh].menu_index=Kh}if($h.selectedOption!==!1){(Zh=Wh.debug)==null||Zh.call(Wh,"ContextMenu selection: ",$h.selectedOption);for(const Kh in $h.allOptions)$h.selectedOption+""==Kh+""?$h.allOptions[Kh].classList.add("selected"):$h.allOptions[Kh].classList.remove("selected")}document.body.getBoundingClientRect(),Fh.getBoundingClientRect(),Fh.style.top=$h.top_original+"px"},Th.removeEventListener("keydown",Fh.f_textfilter,!0),Th.addEventListener("keydown",Fh.f_textfilter,!0),$h._filterDoc=Th}function calculateContextMenuBestPosition($h,Th){var Fh;const Wh=$h.options,zh=$h.root;let Hh=Wh.left||0,Uh=Wh.top||0;if($h.top_original=Uh,Wh.event){if(Hh=Wh.event.clientX-10,Uh=Wh.event.clientY-10,Wh.title&&(Uh-=20),$h.top_original=Uh,Wh.parentMenu){const jh=Wh.parentMenu.root.getBoundingClientRect();Hh=jh.left+jh.width}const Yh=document.body.getBoundingClientRect(),Xh=zh.getBoundingClientRect();Yh.height===0&&((Fh=Th.error)==null||Fh.call(Th,"document.body height is 0. That is dangerous, set html,body { height: 100%; }")),Yh.width&&Hh>Yh.width-Xh.width-10&&(Hh=Yh.width-Xh.width-10),Yh.height&&Uh>Yh.height-Xh.height-10&&(Uh=Yh.height-Xh.height-10)}zh.style.left=`${Hh}px`,zh.style.top=`${Uh}px`,Wh.scale&&(zh.style.transform=`scale(${Wh.scale})`)}function createContextMenuItem($h,Th,Fh,Wh={},zh){var Hh;const Uh=document.createElement("div");Uh.className="litemenu-entry submenu";let Yh=!1;Fh===null?Uh.classList.add("separator"):(Uh.innerHTML=(Hh=Fh==null?void 0:Fh.title)!=null?Hh:Th,Uh.value=Fh,Fh&&(Fh.disabled&&(Yh=!0,Uh.classList.add("disabled")),(Fh.submenu||Fh.has_submenu)&&Uh.classList.add("has_submenu")),typeof Fh=="function"?(Uh.dataset.value=Th,Uh.onclick_callback=Fh):Uh.dataset.value=Fh,Fh.className&&(Uh.className+=" "+Fh.className)),$h.root.appendChild(Uh),Yh||Uh.addEventListener("click",jh),!Yh&&Wh.autoopen&&Uh.addEventListener("pointerenter",qh=>{const Vh=$h.value;!Vh||!Vh.has_submenu||jh.call($h,qh)});const Xh=$h;function jh(qh){var Vh,Zh,Kh,Qh,Jh;const td=this.value;let ed=!0;if((Vh=zh.debug)==null||Vh.call(zh,"ContextMenu handleMenuItemClick",td,Wh,ed,this.current_submenu,this),(Zh=Xh.current_submenu)==null||Zh.close(qh),Wh.callback&&((Kh=zh.debug)==null||Kh.call(zh,"ContextMenu handleMenuItemClick callback",this,td,Wh,qh,Xh,Wh.node),Wh.callback.call(this,td,Wh,qh,Xh,Wh.node)===!0&&(ed=!1)),td&&(td.callback&&!Wh.ignore_item_callbacks&&td.disabled!==!0&&((Qh=zh.debug)==null||Qh.call(zh,"ContextMenu using value callback and !ignore_item_callbacks",this,td,Wh,qh,Xh,Wh.node),td.callback.call(this,td,Wh,qh,Xh,Wh.extra)===!0&&(ed=!1)),td.submenu)){if((Jh=zh.debug)==null||Jh.call(zh,"ContextMenu SUBMENU",this,td,td.submenu.options,qh,Xh,Wh),!td.submenu.options)throw new Error("ContextMenu submenu needs options");new Xh.constructor(td.submenu.options,{callback:td.submenu.callback,event:qh,parentMenu:Xh,ignore_item_callbacks:td.submenu.ignore_item_callbacks,title:td.submenu.title,extra:td.submenu.extra,autoopen:Wh.autoopen}),ed=!1}ed&&!Xh.lock&&Xh.close()}return Uh}function closeContextMenuInstance($h,Th,Fh,Wh){var zh,Hh;if($h.root.f_textfilter){const Uh=$h._filterDoc||((zh=Th==null?void 0:Th.target)==null?void 0:zh.ownerDocument)||document;Uh.removeEventListener("keydown",$h.root.f_textfilter,!0),Uh.removeEventListener("keydown",$h.root.f_textfilter,!1),$h._filterDoc=null}$h.parentMenu&&!Fh&&($h.parentMenu.lock=!1,$h.parentMenu.current_submenu=null,Th===void 0?$h.parentMenu.close():Th&&!Wh.isCursorOverElement(Th,$h.parentMenu.root)&&Wh.trigger($h.parentMenu.root,"pointerleave",Th)),(Hh=$h.current_submenu)==null||Hh.close(Th,!0),$h.root.closing_timer&&clearTimeout($h.root.closing_timer),$h.root.parentNode&&$h.root.parentNode.removeChild($h.root)}function closeAllContextMenus($h=window){const Th=$h.document.querySelectorAll(".litecontextmenu");Th.length&&Th.forEach(Fh=>{var Wh;Fh.close?Fh.close():(Wh=Fh.parentNode)==null||Wh.removeChild(Fh)})}function triggerContextMenuEvent($h,Th,Fh,Wh){const zh=new CustomEvent(Th,{bubbles:!0,cancelable:!0,detail:Fh});return Wh&&Object.defineProperty(zh,"litegraphTarget",{value:Wh}),$h.dispatchEvent?$h.dispatchEvent(zh):$h.__events&&$h.__events.dispatchEvent(zh),zh}function isCursorOverContextElement($h,Th,Fh){return Fh.isInsideRectangle($h.clientX,$h.clientY,Th.left,Th.top,Th.width,Th.height)}var Hl,Eh,Ph,Ah,Rh,Nh,Gh;const Kl=class Dd{constructor(Th,Fh={}){Sh(this,Hl),this.options=normalizeContextMenuOptions(Fh),this.menu_elements=[],Vl(this,Hl,Ah).call(this),Vl(this,Hl,Rh).call(this),Vl(this,Hl,Eh).call(this),Vl(this,Hl,Ph).call(this),this.setTitle(this.options.title),this.addItems(Th),Vl(this,Hl,Nh).call(this),Vl(this,Hl,Gh).call(this)}setTitle(Th){setContextMenuTitle(this,Th)}addItems(Th){addContextMenuItems(this,Th)}addItem(Th,Fh,Wh={}){return createContextMenuItem(this,Th,Fh,Wh,LiteGraph)}close(Th,Fh){closeContextMenuInstance(this,Th,Fh,Dd)}static trigger(Th,Fh,Wh,zh){return triggerContextMenuEvent(Th,Fh,Wh,zh)}getTopMenu(){var Th,Fh;return(Fh=(Th=this.options.parentMenu)==null?void 0:Th.getTopMenu())!=null?Fh:this}getFirstEvent(){var Th,Fh;return(Fh=(Th=this.options.parentMenu)==null?void 0:Th.getFirstEvent())!=null?Fh:this.options.event}static isCursorOverElement(Th,Fh){return isCursorOverContextElement(Th,Fh,LiteGraph)}};Hl=new WeakSet,Eh=function(){return createContextMenuRoot(this)},Ph=function(){bindContextMenuRootEvents(this)},Ah=function(){linkContextMenuToParent(this,LiteGraph)},Rh=function(){validateContextMenuEventClass(this,LiteGraph)},Nh=function(){const{doc:$h,parent:Th}=resolveContextMenuHost(this);LiteGraph.context_menu_filter_enabled&&!this.options.parentMenu&&setupContextMenuFiltering(this,$h,this.root,LiteGraph),appendContextMenuRoot(this,Th)},Gh=function(){calculateContextMenuBestPosition(this,LiteGraph)},Yl(Kl,"closeAll",($h=window)=>closeAllContextMenus($h));let ContextMenu=Kl;function resolveLeaferRuntime($h){var Th,Fh;return(Fh=(Th=$h==null?void 0:$h.leaferRuntime)!=null?Th:globalThis.LeaferUI)!=null?Fh:null}function ensureLeaferCanvasRuntime($h){const Th=$h==null?void 0:$h.LeaferCanvas;if(typeof Th!="function")throw new Error("LeaferUI runtime is not available. Provide options.leaferRuntime or set globalThis.LeaferUI.");return Th}function createCanvasElement($h,Th){if($h!=null&&$h.createElement)return $h.createElement("canvas");if(typeof document!="undefined"&&document.createElement)return document.createElement("canvas");if(Th)return Th;throw new Error("Unable to create canvas element for Leafer surface.")}function createLeaferCanvas($h,Th,Fh,Wh,zh){return new $h({view:Th,width:Fh,height:Wh,hittable:zh})}class LeaferUIRendererAdapter{constructor(Th={}){this.options={mode:"hybrid-back",nodeRenderMode:"legacy-ctx",nodeRenderLogs:!1,enableLogs:!0,logPrefix:"[LiteGraph][LeaferAdapter]",...Th},this.ownerDocument=null,this.mode=this.options.mode||"hybrid-back",this.frontSurface=null,this.backSurface=null,this._frontLeaferCanvas=null,this._backLeaferCanvas=null}getLeaferRuntime(){return resolveLeaferRuntime(this.options)}_log(Th,Fh,Wh){var zh,Hh;if(!((zh=this.options)!=null&&zh.enableLogs))return;const Uh=(console==null?void 0:console[Th])||(console==null?void 0:console.log);if(!Uh)return;const Yh=((Hh=this.options)==null?void 0:Hh.logPrefix)||"[LiteGraph][LeaferAdapter]";if(Wh!==void 0){Uh(`${Yh} ${Fh}`,Wh);return}Uh(`${Yh} ${Fh}`)}init({canvas:Th,ownerDocument:Fh}){var Wh,zh,Hh,Uh;const Yh=(Wh=this.options)!=null&&Wh.leaferRuntime?"options.leaferRuntime":"globalThis.LeaferUI";this._log("info","init start",{mode:this.options.mode||"hybrid-back",runtimeSource:Yh}),this.destroy(),this.ownerDocument=(zh=Fh!=null?Fh:Th==null?void 0:Th.ownerDocument)!=null?zh:null,this.mode=this.options.mode||"hybrid-back";const Xh=this.getLeaferRuntime(),jh=ensureLeaferCanvasRuntime(Xh),qh=Th.width,Vh=Th.height;this.mode==="full-leafer"?(this._frontLeaferCanvas=createLeaferCanvas(jh,Th,qh,Vh,!0),this.frontSurface=new LeaferSurface(this._frontLeaferCanvas),this._log("info","front surface created with LeaferCanvas",{width:qh,height:Vh})):(this.frontSurface=new Canvas2DSurface(Th),this._log("info","front surface created with Canvas2D (hybrid mode)",{width:qh,height:Vh}));const Zh=createCanvasElement(this.ownerDocument,Th);return Zh.width=qh,Zh.height=Vh,this._backLeaferCanvas=createLeaferCanvas(jh,Zh,qh,Vh,!1),this.backSurface=new LeaferSurface(this._backLeaferCanvas),this._log("info","back surface created with LeaferCanvas",{width:qh,height:Vh}),this.getFrontCtx(),this.getBackCtx(),this._log("info","init complete",{mode:this.mode,frontCanvasShared:((Hh=this.frontSurface)==null?void 0:Hh.canvas)===Th,backCanvasShared:((Uh=this.backSurface)==null?void 0:Uh.canvas)===Th}),this}destroy(){var Th,Fh,Wh,zh;const Hh=!!this._frontLeaferCanvas,Uh=!!this._backLeaferCanvas;(Fh=(Th=this._frontLeaferCanvas)==null?void 0:Th.destroy)==null||Fh.call(Th),(zh=(Wh=this._backLeaferCanvas)==null?void 0:Wh.destroy)==null||zh.call(Wh),this._frontLeaferCanvas=null,this._backLeaferCanvas=null,this.frontSurface=null,this.backSurface=null,(Hh||Uh)&&this._log("info","destroy complete",{destroyedFrontLeafer:Hh,destroyedBackLeafer:Uh})}resize(Th,Fh){var Wh,zh;(Wh=this.frontSurface)==null||Wh.resize(Th,Fh),(zh=this.backSurface)==null||zh.resize(Th,Fh),this._log("info","resize",{width:Th,height:Fh,mode:this.mode})}beginFrame(Th){}endFrame(Th){}isLayerNative(Th){return Th==="front"?this.mode==="full-leafer":!0}syncLayer(Th){}getFrontCtx(){var Th,Fh,Wh;return applyRenderContextCompatAliases((Wh=(Fh=(Th=this.frontSurface)==null?void 0:Th.getContextCompat)==null?void 0:Fh.call(Th))!=null?Wh:null)}getBackCtx(){var Th,Fh,Wh;return applyRenderContextCompatAliases((Wh=(Fh=(Th=this.backSurface)==null?void 0:Th.getContextCompat)==null?void 0:Fh.call(Th))!=null?Wh:null)}getFrontSurface(){return this.frontSurface}getBackSurface(){return this.backSurface}blitBackToFront(Th=this.getFrontCtx()){var Fh,Wh;const zh=(Fh=this.frontSurface)==null?void 0:Fh.canvas,Hh=(Wh=this.backSurface)==null?void 0:Wh.canvas;!Th||!zh||!Hh||Hh===zh||typeof Th.drawImage=="function"&&Th.drawImage(Hh,0,0)}adoptExternalContexts({frontCanvas:Th,backCanvas:Fh,frontContext:Wh,backContext:zh}){this._log("warn","adopting external contexts (legacy/webgl interoperability path)"),this.destroy(),this.mode="external",this.frontSurface=new Canvas2DSurface(Th,Wh),this.backSurface=new Canvas2DSurface(Fh,zh),this.getFrontCtx(),this.getBackCtx(),this._log("info","external contexts adopted",{sharedCanvas:Th===Fh})}}const loggingMethods={logging_set_level($h){this.debug_level=Number($h)},logging($h){if($h>this.debug_level)return;function Th(Wh){let zh=[];for(let Hh=1;Hh<Wh.length;Hh++)typeof Wh[Hh]!="undefined"&&zh.push(Wh[Hh]);return zh}let Fh="debug";if($h>=0&&$h<=4&&(Fh=["error","warn","info","log","debug"][$h]),typeof console[Fh]!="function")throw console.warn("[LG-log] invalid console method",Fh,Th(arguments)),new RangeError;console[Fh]("[LG]",...Th(arguments))},error(){this.logging(0,...arguments)},warn(){this.logging(1,...arguments)},info(){this.logging(2,...arguments)},log(){this.logging(3,...arguments)},debug(){this.logging(4,...arguments)}};let LiteGraph$5=null;function setNodeRegistryMethodsLiteGraph($h){LiteGraph$5=$h}const nodeRegistryMethods={registerNodeType($h,Th){var Fh,Wh,zh,Hh,Uh,Yh,Xh;if(!Th.prototype)throw new Error("Cannot register a simple object, it must be a class with a prototype");Th.type=$h,(Fh=this.debug)==null||Fh.call(this,"registerNodeType","start",$h);const jh=Th.name,qh=$h.lastIndexOf("/");Th.category=$h.substring(0,qh),Th.title||(Th.title=jh);const Vh=Object.getOwnPropertyDescriptors(LiteGraph$5.LGraphNode.prototype);Object.keys(Vh).forEach(Jh=>{Th.prototype.hasOwnProperty(Jh)||Object.defineProperty(Th.prototype,Jh,Vh[Jh])});const Zh=this.registered_node_types[$h];if(Zh&&((Wh=this.debug)==null||Wh.call(this,"registerNodeType","replacing node type",$h,Zh)),!Object.prototype.hasOwnProperty.call(Th.prototype,"shape")&&(Object.defineProperty(Th.prototype,"shape",{set:function(Jh){switch(Jh){case"default":delete this._shape;break;case"box":this._shape=LiteGraph$5.BOX_SHAPE;break;case"round":this._shape=LiteGraph$5.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph$5.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph$5.CARD_SHAPE;break;default:this._shape=Jh}},get:function(){return this._shape},enumerable:!0,configurable:!0}),Th.supported_extensions))for(let Jh in Th.supported_extensions){const td=Th.supported_extensions[Jh];td&&td.constructor===String&&(this.node_types_by_file_extension[td.toLowerCase()]=Th)}if(this.registered_node_types[$h]=Th,Th.constructor.name&&(this.Nodes[jh]=Th),(zh=LiteGraph$5.onNodeTypeRegistered)==null||zh.call(LiteGraph$5,$h,Th),Zh&&((Hh=LiteGraph$5.onNodeTypeReplaced)==null||Hh.call(LiteGraph$5,$h,Th,Zh)),Th.prototype.onPropertyChange&&LiteGraph$5.warn("LiteGraph node class "+$h+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),Th.supported_extensions)for(var Kh=0;Kh<Th.supported_extensions.length;Kh++){var Qh=Th.supported_extensions[Kh];Qh&&Qh.constructor===String&&(this.node_types_by_file_extension[Qh.toLowerCase()]=Th)}(Uh=this.debug)==null||Uh.call(this,"registerNodeType","type registered",$h),this.auto_load_slot_types&&((Yh=this.debug)==null||Yh.call(this,"registerNodeType","do auto_load_slot_types",$h)),new Th((Xh=Th.title)!=null?Xh:"tmpnode")},unregisterNodeType($h){const Th=$h.constructor===String?this.registered_node_types[$h]:$h;if(!Th)throw new Error("node type not found: "+$h);delete this.registered_node_types[Th.type],Th.constructor.name&&delete this.Nodes[Th.constructor.name]},clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}},addNodeMethod($h,Th){LiteGraph$5.LGraphNode.prototype[$h]=Th;for(var Fh in this.registered_node_types){var Wh=this.registered_node_types[Fh];Wh.prototype[$h]&&(Wh.prototype["_"+$h]=Wh.prototype[$h]),Wh.prototype[$h]=Th}},reloadNodes($h){var Th,Fh,Wh,zh=document.getElementsByTagName("script"),Hh=[];for(let jh=0;jh<zh.length;jh++)Hh.push(zh[jh]);var Uh=document.getElementsByTagName("head")[0];$h=document.location.href+$h;for(let jh=0;jh<Hh.length;jh++){var Yh=Hh[jh].src;if(!(!Yh||Yh.substr(0,$h.length)!=$h))try{(Th=this.log)==null||Th.call(this,"Reloading: "+Yh);var Xh=document.createElement("script");Xh.type="text/javascript",Xh.src=Yh,Uh.appendChild(Xh),Uh.removeChild(Hh[jh])}catch(qh){if(LiteGraph$5.throw_errors)throw qh;(Fh=this.log)==null||Fh.call(this,"Error while reloading "+Yh)}}(Wh=this.log)==null||Wh.call(this,"Nodes reloaded")}};let LiteGraph$4=null;function setNodeFactoryMethodsLiteGraph($h){LiteGraph$4=$h}const nodeFactoryMethods={buildNodeClassFromObject($h,Th){var Fh="";if(Th.inputs)for(let zh=0;zh<Th.inputs.length;++zh){let Hh=Th.inputs[zh][0],Uh=Th.inputs[zh][1];Uh&&Uh.constructor===String&&(Uh='"'+Uh+'"'),Fh+="this.addInput('"+Hh+"',"+Uh+`);
`}if(Th.outputs)for(let zh=0;zh<Th.outputs.length;++zh){let Hh=Th.outputs[zh][0],Uh=Th.outputs[zh][1];Uh&&Uh.constructor===String&&(Uh='"'+Uh+'"'),Fh+="this.addOutput('"+Hh+"',"+Uh+`);
`}if(Th.properties)for(let zh in Th.properties){let Hh=Th.properties[zh];Hh&&Hh.constructor===String&&(Hh='"'+Hh+'"'),Fh+="this.addProperty('"+zh+"',"+Hh+`);
`}Fh+="if(this.onCreate)this.onCreate()";var Wh=Function(Fh);for(let zh in Th)zh!="inputs"&&zh!="outputs"&&zh!="properties"&&(Wh.prototype[zh]=Th[zh]);return Wh.title=Th.title||$h.split("/").pop(),Wh.desc=Th.desc||"Generated from object",this.registerNodeType($h,Wh),Wh},wrapFunctionAsNode($h,Th,Fh,Wh,zh){const Hh=LiteGraph$4.getParameterNames(Th),Uh=Hh.map((qh,Vh)=>{const Zh=Fh!=null&&Fh[Vh]?`'${Fh[Vh]}'`:"0";return`this.addInput('${qh}', ${Zh});`}).join(`
`),Yh=Wh?`'${Wh}'`:0,Xh=zh?`this.properties = ${JSON.stringify(zh)};`:"",jh=new Function(`
            ${Uh}
            this.addOutput('out', ${Yh});
            ${Xh}
        `);return jh.title=$h.split("/").pop(),jh.desc=`Generated from ${Th.name}`,jh.prototype.onExecute=function(){const qh=Hh.map((Zh,Kh)=>this.getInputData(Kh)),Vh=Th.apply(this,qh);this.setOutputData(0,Vh)},this.registerNodeType($h,jh),jh},createNode($h,Th,Fh={}){var Wh,zh,Hh,Uh,Yh,Xh,jh,qh,Vh,Zh,Kh,Qh;const Jh=(Wh=this.registered_node_types[$h])!=null?Wh:null;if(!Jh)return(zh=this.log)==null||zh.call(this,`GraphNode type "${$h}" not registered.`),null;Th=(Hh=Th!=null?Th:Jh.title)!=null?Hh:$h;let td=null;if(LiteGraph$4.catch_exceptions)try{td=new Jh(Th)}catch(ed){return(Uh=this.error)==null||Uh.call(this,ed),null}else td=new Jh(Th);return td.type=$h,(Yh=td.title)!=null||(td.title=Th),(Xh=td.properties)!=null||(td.properties={}),(jh=td.properties_info)!=null||(td.properties_info=[]),(qh=td.flags)!=null||(td.flags={}),(Vh=td.size)!=null||(td.size=td.computeSize()),(Zh=td.pos)!=null||(td.pos=LiteGraph$4.DEFAULT_POSITION.concat()),(Kh=td.mode)!=null||(td.mode=LiteGraph$4.ALWAYS),Object.assign(td,Fh),(Qh=td.onNodeCreated)==null||Qh.call(td),td},getNodeType($h){return this.registered_node_types[$h]},getNodeTypesInCategory($h,Th){const Fh=Object.values(this.registered_node_types).filter(Wh=>Wh.filter!==Th?!1:$h===""?Wh.category===null:Wh.category===$h);return this.auto_sort_node_types&&Fh.sort((Wh,zh)=>Wh.title.localeCompare(zh.title)),Fh},getNodeTypesCategories($h){const Th={"":1};Object.values(this.registered_node_types).forEach(Wh=>{Wh.category&&!Wh.skip_list&&Wh.filter===$h&&(Th[Wh.category]=1)});const Fh=Object.keys(Th);return this.auto_sort_node_types?Fh.sort():Fh}},slotTypesMethods={registerNodeAndSlotType($h,Th,Fh=!1){const Wh=($h.constructor===String&&this.registered_node_types[$h]!=="anonymous"?this.registered_node_types[$h]:$h).constructor.type;let zh=[];typeof Th=="string"?zh=Th.split(","):Th==this.EVENT||Th==this.ACTION?zh=["_event_"]:zh=["*"];for(let Hh=0;Hh<zh.length;++Hh){let Uh=zh[Hh];Uh===""&&(Uh="*");const Yh=Fh?"registered_slot_out_types":"registered_slot_in_types";this[Yh][Uh]===void 0&&(this[Yh][Uh]={nodes:[]}),this[Yh][Uh].nodes.includes(Wh)||this[Yh][Uh].nodes.push(Wh),Fh?this.slot_types_out.includes(Uh.toLowerCase())||(this.slot_types_out.push(Uh.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(Uh.toLowerCase())||(this.slot_types_in.push(Uh.toLowerCase()),this.slot_types_in.sort())}},registerSearchboxExtra($h,Th,Fh){this.searchbox_extras[Th.toLowerCase()]={type:$h,desc:Th,data:Fh}}};let LiteGraph$3=null;function setTypeCompatMethodsLiteGraph($h){LiteGraph$3=$h}const typeCompatMethods={isValidConnection($h,Th){if(($h===""||$h==="*")&&($h=0),(Th===""||Th==="*")&&(Th=0),!$h||!Th||$h===Th||$h===LiteGraph$3.EVENT&&Th===LiteGraph$3.ACTION)return!0;if($h=String($h).toLowerCase(),Th=String(Th).toLowerCase(),!$h.includes(",")&&!Th.includes(","))return $h===Th;const Fh=$h.split(","),Wh=Th.split(",");for(const zh of Fh)for(const Hh of Wh)if(this.isValidConnection(zh,Hh))return!0;return!1}};let LiteGraph$2=null;function setFileUtilsMethodsLiteGraph($h){LiteGraph$2=$h}const fileUtilsMethods={fetchFile($h,Th,Fh,Wh){if(!$h)return null;if(Th=Th||"text",$h.constructor===String)return $h.substr(0,4)=="http"&&LiteGraph$2.proxy&&($h=LiteGraph$2.proxy+$h.substr($h.indexOf(":")+3)),fetch($h).then(Hh=>{if(!Hh.ok)throw new Error("File not found");if(Th=="arraybuffer")return Hh.arrayBuffer();if(Th=="text"||Th=="string")return Hh.text();if(Th=="json")return Hh.json();if(Th=="blob")return Hh.blob()}).then(Hh=>{Fh&&Fh(Hh)}).catch(Hh=>{var Uh;(Uh=this.error)==null||Uh.call(this,"error fetching file:",$h),Wh&&Wh(Hh)});if($h.constructor===File||$h.constructor===Blob){var zh=new FileReader;if(zh.onload=Hh=>{var Uh=Hh.target.result;Th=="json"&&(Uh=JSON.parse(Uh)),Fh&&Fh(Uh)},Th=="arraybuffer")return zh.readAsArrayBuffer($h);if(Th=="text"||Th=="json")return zh.readAsText($h);if(Th=="blob")return zh.readAsBinaryString($h)}return null}},pointerEventsMethods={applyPointerDefaults(){typeof window=="undefined"||typeof window.matchMedia!="function"||window.matchMedia("(pointer: coarse)").matches&&(this.dialog_close_on_mouse_leave=!1,this.search_hide_on_mouse_leave=!1)},resolvePointerEventName($h){if(typeof $h!="string")return $h;const Th=$h.toLowerCase(),Fh=this.pointerevents_method;return Fh==="mouse"?this.pointer_to_mouse_events[Th]||Th:Fh==="pointer"&&this.mouse_to_pointer_events[Th]||Th},pointerAddListener($h,Th,Fh,Wh){if(!($h!=null&&$h.addEventListener)||typeof Fh!="function")return!1;const zh=this.resolvePointerEventName(Th);return $h.addEventListener(zh,Fh,Wh),!0},pointerRemoveListener($h,Th,Fh,Wh){if(!($h!=null&&$h.removeEventListener)||typeof Fh!="function")return!1;const zh=this.resolvePointerEventName(Th);return $h.removeEventListener(zh,Fh,Wh),!0},set pointerevents_method($h){const Th=typeof $h=="string"?$h.toLowerCase():"";if(Th==="mouse"||Th==="pointer"){this._pointerevents_method=Th;return}this._pointerevents_method="pointer"},get pointerevents_method(){return this._pointerevents_method||"pointer"}},objectUtilsMethods={cloneObject($h,Th){if($h==null)return null;const Fh=JSON.parse(JSON.stringify($h));if(!Th)return Fh;for(const Wh in Fh)Object.prototype.hasOwnProperty.call(Fh,Wh)&&(Th[Wh]=Fh[Wh]);return Th},uuidv4(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,$h=>($h^Math.random()*16>>$h/4).toString(16))},compareObjects($h,Th){const Fh=Object.keys($h);return Fh.length!==Object.keys(Th).length?!1:Fh.every(Wh=>$h[Wh]===Th[Wh])}},mathColorUtilsMethods={distance($h,Th){const[Fh,Wh]=$h,[zh,Hh]=Th;return Math.sqrt((zh-Fh)**2+(Hh-Wh)**2)},colorToString($h){return"rgba("+Math.round($h[0]*255).toFixed()+","+Math.round($h[1]*255).toFixed()+","+Math.round($h[2]*255).toFixed()+","+($h.length==4?$h[3].toFixed(2):"1.0")+")"},isInsideRectangle($h,Th,Fh,Wh,zh,Hh){return $h>Fh&&$h<Fh+zh&&Th>Wh&&Th<Wh+Hh},growBounding($h,Th,Fh){Th<$h[0]?$h[0]=Th:Th>$h[2]&&($h[2]=Th),Fh<$h[1]?$h[1]=Fh:Fh>$h[3]&&($h[3]=Fh)},isInsideBounding($h,Th){return $h[0]>=Th[0][0]&&$h[1]>=Th[0][1]&&$h[0]<=Th[1][0]&&$h[1]<=Th[1][1]},overlapBounding($h,Th){const Fh=$h[0]+$h[2],Wh=$h[1]+$h[3],zh=Th[0]+Th[2],Hh=Th[1]+Th[3];return!($h[0]>zh||$h[1]>Hh||Fh<Th[0]||Wh<Th[1])},hex2num($h){$h.charAt(0)=="#"&&($h=$h.slice(1)),$h=$h.toUpperCase();for(var Th="0123456789ABCDEF",Fh=new Array(3),Wh=0,zh,Hh,Uh=0;Uh<6;Uh+=2)zh=Th.indexOf($h.charAt(Uh)),Hh=Th.indexOf($h.charAt(Uh+1)),Fh[Wh]=zh*16+Hh,Wh++;return Fh},num2hex($h){for(var Th="0123456789ABCDEF",Fh="#",Wh,zh,Hh=0;Hh<3;Hh++)Wh=$h[Hh]/16,zh=$h[Hh]%16,Fh+=Th.charAt(Wh)+Th.charAt(zh);return Fh},clamp:($h,Th,Fh)=>Th>$h?Th:Fh<$h?Fh:$h},canvasTextUtilsMethods={canvasFillTextMultiline($h,Th,Fh,Wh,zh,Hh){var Uh=(Th+"").trim().split(" "),Yh="",Xh={lines:[],maxW:0,height:0};if(Uh.length>1)for(var jh=0;jh<Uh.length;jh++){var qh=Yh+Uh[jh]+" ",Vh=$h.measureText(qh),Zh=Vh.width;Zh>zh&&jh>0?($h.fillText(Yh,Fh,Wh+Hh*Xh.lines.length),Yh=Uh[jh]+" ",Xh.max=Zh,Xh.lines.push(Yh)):Yh=qh}else Yh=Uh[0];return $h.fillText(Yh,Fh,Wh+Hh*Xh.lines.length),Xh.lines.push(Yh),Xh.height=Hh*Xh.lines.length||Hh,Xh}},classUtilsMethods={extendClass:($h,Th)=>{for(let Fh in Th)$h.hasOwnProperty(Fh)||($h[Fh]=Th[Fh]);if(Th.prototype)for(let Fh in Th.prototype)Th.prototype.hasOwnProperty(Fh)&&($h.prototype.hasOwnProperty(Fh)||(Th.prototype.__lookupGetter__(Fh)?$h.prototype.__defineGetter__(Fh,Th.prototype.__lookupGetter__(Fh)):$h.prototype[Fh]=Th.prototype[Fh],Th.prototype.__lookupSetter__(Fh)&&$h.prototype.__defineSetter__(Fh,Th.prototype.__lookupSetter__(Fh))))},getParameterNames:$h=>($h+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)};let LiteGraph$1=null;function setLegacyCompatMethodsLiteGraph($h){LiteGraph$1=$h}const legacyCompatMethods={closeAllContextMenus:()=>{LiteGraph$1.warn("LiteGraph.closeAllContextMenus is deprecated in favor of LiteGraph.ContextMenu.closeAll()"),LiteGraph$1.ContextMenu.closeAll()}};function installLiteGraphDelegates($h){const Th=Object.getPrototypeOf($h);Th.__litegraph_delegates_installed||(setNodeRegistryMethodsLiteGraph($h),setNodeFactoryMethodsLiteGraph($h),setTypeCompatMethodsLiteGraph($h),setFileUtilsMethodsLiteGraph($h),setLegacyCompatMethodsLiteGraph($h),[loggingMethods,nodeRegistryMethods,nodeFactoryMethods,slotTypesMethods,typeCompatMethods,fileUtilsMethods,pointerEventsMethods,objectUtilsMethods,mathColorUtilsMethods,canvasTextUtilsMethods,classUtilsMethods,legacyCompatMethods].forEach(Fh=>{const Wh=Object.getOwnPropertyDescriptors(Fh);delete Wh.__proto__,Object.entries(Wh).forEach(([zh,Hh])=>{Object.defineProperty(Th,zh,{...Hh,configurable:!0})})}),Object.defineProperty(Th,"__litegraph_delegates_installed",{value:!0,writable:!1,enumerable:!1,configurable:!1}))}function applyCoreDefaults($h){$h.VERSION="0.10.2",$h.CANVAS_GRID_SIZE=10,$h.NODE_TITLE_HEIGHT=30,$h.NODE_TITLE_TEXT_Y=20,$h.NODE_SLOT_HEIGHT=20,$h.NODE_WIDGET_HEIGHT=20,$h.NODE_WIDTH=140,$h.NODE_MIN_WIDTH=50,$h.NODE_COLLAPSED_RADIUS=10,$h.NODE_COLLAPSED_WIDTH=80,$h.NODE_TITLE_COLOR="#999",$h.NODE_SELECTED_TITLE_COLOR="#FFF",$h.NODE_TEXT_SIZE=14,$h.NODE_TEXT_COLOR="#AAA",$h.NODE_SUBTEXT_SIZE=12,$h.NODE_DEFAULT_COLOR="#333",$h.NODE_DEFAULT_BGCOLOR="#353535",$h.NODE_DEFAULT_BOXCOLOR="#666",$h.NODE_DEFAULT_SHAPE="box",$h.NODE_BOX_OUTLINE_COLOR="#FFF",$h.DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)",$h.DEFAULT_GROUP_FONT=24,$h.WIDGET_BGCOLOR="#222",$h.WIDGET_OUTLINE_COLOR="#666",$h.WIDGET_TEXT_COLOR="#DDD",$h.WIDGET_SECONDARY_TEXT_COLOR="#999",$h.LINK_COLOR="#9A9",$h.EVENT_LINK_COLOR="#A86",$h.CONNECTING_LINK_COLOR="#AFA",$h.MAX_NUMBER_OF_NODES=1e3,$h.DEFAULT_POSITION=[100,100],$h.VALID_SHAPES=["default","box","round","card"],$h.BOX_SHAPE=1,$h.ROUND_SHAPE=2,$h.CIRCLE_SHAPE=3,$h.CARD_SHAPE=4,$h.ARROW_SHAPE=5,$h.GRID_SHAPE=6,$h.INPUT=1,$h.OUTPUT=2,$h.EVENT=-1,$h.ACTION=-1,$h.NODE_MODES=["Always","On Event","Never","On Trigger","On Request"],$h.NODE_MODES_COLORS=["#666","#422","#333","#224","#626"],$h.ALWAYS=0,$h.ON_EVENT=1,$h.NEVER=2,$h.ON_TRIGGER=3,$h.ON_REQUEST=4,$h.UP=1,$h.DOWN=2,$h.LEFT=3,$h.RIGHT=4,$h.CENTER=5,$h.LINK_RENDER_MODES=["Straight","Linear","Spline"],$h.STRAIGHT_LINK=0,$h.LINEAR_LINK=1,$h.SPLINE_LINK=2,$h.NORMAL_TITLE=0,$h.NO_TITLE=1,$h.TRANSPARENT_TITLE=2,$h.AUTOHIDE_TITLE=3,$h.VERTICAL_LAYOUT="vertical",$h.proxy=null,$h.node_images_path="",$h.catch_exceptions=!0,$h.throw_errors=!0,$h.allow_scripts=!1,$h.use_deferred_actions=!0,$h.registered_node_types={},$h.node_types_by_file_extension={},$h.Nodes={},$h.Globals={}}function applyUiDefaults($h){$h.searchbox_extras={},$h.auto_sort_node_types=!1,$h.node_box_coloured_when_on=!1,$h.node_box_coloured_by_mode=!1,$h.dialog_close_on_mouse_leave=!0,$h.dialog_close_on_mouse_leave_delay=500,$h.search_hide_on_mouse_leave=!0,$h.search_filter_enabled=!1,$h.search_show_all_on_open=!0,$h.show_node_tooltip=!1,$h.show_node_tooltip_use_descr_property=!1,$h.showCanvasOptions=!1,$h.availableCanvasOptions=["allow_addOutSlot_onExecuted","free_resize","highquality_render","use_gradients","pause_rendering","clear_background","read_only","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","move_destination_link_without_shift","set_canvas_dirty_on_mouse_event","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip"]}function applyBehaviorDefaults($h){$h.shift_click_do_break_link_from=!1,$h.click_do_break_link_to=!1,$h.pointer_to_mouse_events=Object.freeze({pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mouseup",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"}),$h.mouse_to_pointer_events=Object.freeze({mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseenter:"pointerenter",mouseleave:"pointerleave"}),$h.applyPointerDefaults(),$h.alt_drag_do_clone_nodes=!1,$h.alt_shift_drag_connect_clone_with_input=!0,$h.do_add_triggers_slots=!1,$h.allow_multi_output_for_events=!0,$h.middle_click_slot_add_default_node=!1,$h.release_link_on_empty_shows_menu=!1,$h.two_fingers_opens_menu=!1,$h.backspace_delete=!0,$h.ctrl_shift_v_paste_connect_unselected_outputs=!1,$h.actionHistory_enabled=!1,$h.actionHistoryMaxSave=40,$h.refreshAncestorsOnTriggers=!1,$h.refreshAncestorsOnActions=!1,$h.ensureUniqueExecutionAndActionCall=!1,$h.use_uuids=!1,$h.context_menu_filter_enabled=!1,$h.actionHistoryMaxSave=40,$h.canRemoveSlots=!0,$h.canRemoveSlots_onlyOptional=!0,$h.canRenameSlots=!0,$h.canRenameSlots_onlyOptional=!0,$h.ensureNodeSingleExecution=!1,$h.ensureNodeSingleAction=!1,$h.preventAncestorRecalculation=!1,$h.ensureUniqueExecutionAndActionCall=!0,$h.allowMultiOutputForEvents=!1,$h.log_methods=["error","warn","info","log","debug"]}function applySlotsDefaults($h){$h.auto_load_slot_types=!1,$h.registered_slot_in_types={},$h.registered_slot_out_types={},$h.slot_types_in=[],$h.slot_types_out=[],$h.slot_types_default_in=[],$h.slot_types_default_out=[],$h.graphDefaultConfig={align_to_grid:!0,links_ontop:!1}}var LiteGraph=new class{constructor(){this.LLink=LLink,this.LGraph=LGraph,setupLGraphDelegates(this),this.LGraphNode=LGraphNode,setupLGraphNodeDelegates(this),this.LGraphGroup=LGraphGroup,this.LGraphCanvas=LGraphCanvas,this.Canvas2DRendererAdapter=Canvas2DRendererAdapter,this.LeaferUIRendererAdapter=LeaferUIRendererAdapter,this.DragAndScale=DragAndScale,this.ContextMenu=ContextMenu,installLiteGraphDelegates(this),applyCoreDefaults(this),applyUiDefaults(this),applyBehaviorDefaults(this),applySlotsDefaults(this),this.logging_set_level(2)}};typeof performance!="undefined"?LiteGraph.getTime=performance.now.bind(performance):typeof Date!="undefined"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process!="undefined"?LiteGraph.getTime=()=>{var $h=process.hrtime();return $h[0]*.001+$h[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()},typeof window!="undefined"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||($h=>{window.setTimeout($h,1e3/60)})),typeof globalThis!="undefined"&&!globalThis.LeaferUI&&(globalThis.LeaferUI=LeaferUIRuntime);export{ContextMenu,DragAndScale,LGraph,LGraphCanvas,LGraphGroup,LGraphNode,LLink,LiteGraph};
