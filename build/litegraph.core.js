var le=Object.defineProperty,ee=n=>{throw TypeError(n)},he=(n,o,s)=>o in n?le(n,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[o]=s,H=(n,o,s)=>he(n,typeof o!="symbol"?o+"":o,s),ue=(n,o,s)=>o.has(n)||ee("Cannot "+s),te=(n,o,s)=>o.has(n)?ee("Cannot add the same private member more than once"):o instanceof WeakSet?o.add(n):o.set(n,s),K=(n,o,s)=>(ue(n,o,"access private method"),s);class LLink{constructor(o,s,a,r,l,p){this.id=o,this.type=s,this.origin_id=a,this.origin_slot=r,this.target_id=l,this.target_slot=p,this._data=null,this._pos=new Float32Array(2)}configure(o){o.constructor===Array?(this.id=o[0],this.origin_id=o[1],this.origin_slot=o[2],this.target_id=o[3],this.target_slot=o[4],this.type=o[5]):(this.id=o.id,this.type=o.type,this.origin_id=o.origin_id,this.origin_slot=o.origin_slot,this.target_id=o.target_id,this.target_slot=o.target_slot)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}}function initializeGraphState(n){n.last_node_id=0,n.last_link_id=0,n._version=-1,n._nodes=[],n._nodes_by_id={},n._nodes_in_order=[],n._nodes_executable=null,n._groups=[],n.links={},n.iteration=0,n.config={},n.vars={},n.extra={},n.globaltime=0,n.runningtime=0,n.fixedtime=0,n.fixedtime_lapse=.01,n.elapsed_time=.01,n.last_update_time=0,n.starttime=0,n.catch_errors=!0,n.history={actionHistory:[],actionHistoryVersions:[],actionHistoryPtr:0},n.nodes_executing=[],n.nodes_actioning=[],n.node_ancestorsCalculated=[],n.nodes_executedAction=[],n._configuring=!1,n.inputs={},n.outputs={}}function mergeOptions(n,o){return Object.assign({},n,o)}let LiteGraph$j=null;function setLifecycleMethodsLiteGraph(n){LiteGraph$j=n}const lifecycleMethods={getSupportedTypes(){var n;return(n=this.supported_types)!=null?n:this.constructor.supported_types},clear(){var n;this.stop(),this.status=this.constructor.STATUS_STOPPED,(n=this._nodes)==null||n.forEach(o=>{var s;(s=o.onRemoved)==null||s.call(o)}),initializeGraphState(this),this.configApplyDefaults(),this.change(),this.sendActionToCanvas("clear")},configApply(n){this.config=mergeOptions(this.config,n)},configApplyDefaults(){var n=LiteGraph$j.graphDefaultConfig;this.configApply(n)}};let LiteGraph$i=null;function setCanvasBindingMethodsLiteGraph(n){LiteGraph$i=n}const canvasBindingMethods={attachCanvas(n){var o;if(!n instanceof LiteGraph$i.LGraphCanvas)throw new Error("attachCanvas expects a LiteGraph.LGraphCanvas instance");n.graph&&n.graph!=this&&n.graph.detachCanvas(n),n.graph=this,(o=this.list_of_graphcanvas)!=null||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(n)},detachCanvas(n){if(this.list_of_graphcanvas){var o=this.list_of_graphcanvas.indexOf(n);o!=-1&&(n.graph=null,this.list_of_graphcanvas.splice(o,1))}},sendActionToCanvas(n,o){if(this.list_of_graphcanvas)for(const s of this.list_of_graphcanvas)s[n]&&o&&s[n](...o)},change(){var n,o;(n=LiteGraph$i.log)==null||n.call(LiteGraph$i,"Graph visually changed"),this.sendActionToCanvas("setDirty",[!0,!0]),(o=this.on_change)==null||o.call(this,this)},setDirtyCanvas(n,o){this.sendActionToCanvas("setDirty",[n,o])},isLive(){if(!this.list_of_graphcanvas)return!1;for(var n=0;n<this.list_of_graphcanvas.length;++n){var o=this.list_of_graphcanvas[n];if(o.live_mode)return!0}return!1}};let LiteGraph$h=null;function setRuntimeLoopMethodsLiteGraph(n){LiteGraph$h=n}const runtimeLoopMethods={start(n=0){var o;if(this.status===this.constructor.STATUS_RUNNING)return;this.status=this.constructor.STATUS_RUNNING,(o=this.onPlayEvent)==null||o.call(this),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph$h.getTime(),this.last_update_time=this.starttime;const s=()=>{var a,r;this.execution_timer_id===-1&&(window.requestAnimationFrame(s),(a=this.onBeforeStep)==null||a.call(this),this.runStep(1,!this.catch_errors),(r=this.onAfterStep)==null||r.call(this))};n===0&&typeof window=="object"&&window.requestAnimationFrame?(this.execution_timer_id=-1,s()):this.execution_timer_id=setInterval(()=>{var a,r;(a=this.onBeforeStep)==null||a.call(this),this.runStep(1,!this.catch_errors),(r=this.onAfterStep)==null||r.call(this)},n)},stop(){var n;this.status!=this.constructor.STATUS_STOPPED&&(this.status=this.constructor.STATUS_STOPPED,(n=this.onStopEvent)==null||n.call(this),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))},runStep(n=1,o,s){var a,r,l,p,h,c,u=LiteGraph$h.getTime();this.globaltime=.001*(u-this.starttime);var d=(a=this._nodes_executable)!=null?a:this._nodes;if(d){if(s||(s=d.length),o){for(let g=0;g<n;g++)d.forEach(_=>{var b,G;LiteGraph$h.use_deferred_actions&&(b=_._waiting_actions)!=null&&b.length&&_.executePendingActions(),_.mode===LiteGraph$h.ALWAYS&&((G=_.doExecute)==null||G.call(_))}),this.fixedtime+=this.fixedtime_lapse,(r=this.onExecuteStep)==null||r.call(this);(l=this.onAfterExecute)==null||l.call(this)}else try{for(let g=0;g<n;g++)d.forEach(_=>{var b,G;LiteGraph$h.use_deferred_actions&&(b=_._waiting_actions)!=null&&b.length&&_.executePendingActions(),_.mode===LiteGraph$h.ALWAYS&&((G=_.doExecute)==null||G.call(_))}),this.fixedtime+=this.fixedtime_lapse,(p=this.onExecuteStep)==null||p.call(this);(h=this.onAfterExecute)==null||h.call(this),this.errors_in_execution=!1}catch(g){if(this.errors_in_execution=!0,LiteGraph$h.throw_errors)throw g;(c=LiteGraph$h.log)==null||c.call(LiteGraph$h,`Error during execution: ${g}`),this.stop()}var f=LiteGraph$h.getTime(),L=f-u;L==0&&(L=1),this.execution_time=.001*L,this.globaltime+=.001*L,this.iteration+=1,this.elapsed_time=(f-this.last_update_time)*.001,this.last_update_time=f,this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[]}},getTime(){return this.globaltime},getFixedTime(){return this.fixedtime},getElapsedTime(){return this.elapsed_time},clearTriggeredSlots(){for(var n in this.links){var o=this.links[n];o&&o._last_time&&(o._last_time=0)}}};let LiteGraph$g=null;function setExecutionOrderMethodsLiteGraph(n){LiteGraph$g=n}const executionOrderMethods={updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var n=0;n<this._nodes_in_order.length;++n)this._nodes_in_order[n].onExecute&&this._nodes_executable.push(this._nodes_in_order[n])},computeExecutionOrder(n,o){var s,a=[],r=[],l={},p={},h={};for(let g=0,_=this._nodes.length;g<_;++g){let b=this._nodes[g];if(!(n&&!b.onExecute)){l[b.id]=b;var c=0;if(b.inputs)for(var u=0,d=b.inputs.length;u<d;u++)b.inputs[u]&&b.inputs[u].link!=null&&(c+=1);c==0?(r.push(b),o&&(b._level=1)):(o&&(b._level=0),h[b.id]=c)}}for(;r.length!=0;){var f=r.shift();if(a.push(f),delete l[f.id],!!f.outputs)for(let g=0;g<f.outputs.length;g++){let _=f.outputs[g];if(!(_==null||_.links==null||_.links.length==0))for(let b=0;b<_.links.length;b++){let G=_.links[b],C=this.links[G];if(!C||p[C.id])continue;let T=this.getNodeById(C.target_id);if(T==null){p[C.id]=!0;continue}o&&(!T._level||T._level<=f._level)&&(T._level=f._level+1),p[C.id]=!0,h[T.id]-=1,h[T.id]==0&&r.push(T)}}}for(let g in l)a.push(l[g]);a.length!=this._nodes.length&&LiteGraph$g.debug&&((s=LiteGraph$g.warn)==null||s.call(LiteGraph$g,"something went wrong, nodes missing"));var L=a.length;for(let g=0;g<L;++g)a[g].order=g;a=a.sort((g,_)=>{let b=g.constructor.priority||g.priority||0,G=_.constructor.priority||_.priority||0;return b==G?g.order-_.order:b-G});for(let g=0;g<L;++g)a[g].order=g;return a},getAncestors(n,o={}){for(var s={modesSkip:[],modesOnly:[],typesSkip:[],typesOnly:[]},a=Object.assign(s,o),r=[],l=[],p=[n],h={};p.length;){var c=p.shift();if(c&&!h[c.id]){if(h[c.id]=!0,c.id!=n.id){if(a.modesSkip&&a.modesSkip.length&&a.modesSkip.indexOf(c.mode)!=-1||a.modesOnly&&a.modesOnly.length&&a.modesOnly.indexOf(c.mode)==-1)continue;l.indexOf(c.id)==-1&&(r.push(c),l.push(c.id))}if(c.inputs)for(var u=0;u<c.inputs.length;++u){var d=c.getInputNode(u);if(d){var f=c.inputs[u].type;a.typesSkip&&a.typesSkip.length&&a.typesSkip.indexOf(f)!=-1||a.typesOnly&&a.typesOnly.length&&a.typesOnly.indexOf(d.mode)==-1||l.indexOf(d.id)==-1&&(h[d.id]||p.push(d))}}}}return r.sort((L,g)=>L.order-g.order),r},arrange(n=100,o){var s;const a=this.computeExecutionOrder(!1,!0),r=[];for(let p=0;p<a.length;++p){const h=a[p],c=h._level||1;(s=r[c])!=null||(r[c]=[]),r[c].push(h)}let l=n;for(let p=0;p<r.length;++p){const h=r[p];if(!h)continue;let c=100,u=n+LiteGraph$g.NODE_TITLE_HEIGHT;for(let d=0;d<h.length;++d){const f=h[d];f.pos[0]=o==LiteGraph$g.VERTICAL_LAYOUT?u:l,f.pos[1]=o==LiteGraph$g.VERTICAL_LAYOUT?l:u;const L=o==LiteGraph$g.VERTICAL_LAYOUT?1:0;f.size[L]>c&&(c=f.size[L]);const g=o==LiteGraph$g.VERTICAL_LAYOUT?0:1;u+=f.size[g]+n+LiteGraph$g.NODE_TITLE_HEIGHT}l+=c+n}this.setDirtyCanvas(!0,!0)}};let LiteGraph$f=null;function setNodeMutationMethodsLiteGraph(n){LiteGraph$f=n}const nodeMutationMethods={add(n,o,s={}){var a,r,l,p={doProcessChange:!0,doCalcSize:!0},h=Object.assign(p,s);if(n){if(n.constructor===LiteGraph$f.LGraphGroup){this._groups.push(n),this.setDirtyCanvas(!0),this.change(),n.graph=this,this.onGraphChanged({action:"groupAdd",doSave:h.doProcessChange});return}if(n.id!=-1&&this._nodes_by_id[n.id]!=null&&((a=LiteGraph$f.warn)==null||a.call(LiteGraph$f,"LiteGraph: there is already a node with this ID, changing it"),LiteGraph$f.use_uuids?n.id=LiteGraph$f.uuidv4():n.id=++this.last_node_id),this._nodes.length>=LiteGraph$f.MAX_NUMBER_OF_NODES)throw new Error("LiteGraph: max number of nodes in a graph reached");return LiteGraph$f.use_uuids?(n.id==null||n.id==-1)&&(n.id=LiteGraph$f.uuidv4()):n.id==null||n.id==-1?n.id=++this.last_node_id:this.last_node_id<n.id&&(this.last_node_id=n.id),n.graph=this,this.onGraphChanged({action:"nodeAdd",doSave:h.doProcessChange}),this._nodes.push(n),this._nodes_by_id[n.id]=n,(r=n.onAdded)==null||r.call(n,this),this.config.align_to_grid&&n.alignToGrid(),o||this.updateExecutionOrder(),(l=this.onNodeAdded)==null||l.call(this,n),h.doCalcSize&&n.setSize(n.computeSize()),this.setDirtyCanvas(!0),this.change(),n}},remove(n){var o,s;if(n.constructor===LiteGraph$f.LGraphGroup){var a=this._groups.indexOf(n);a!=-1&&this._groups.splice(a,1),n.graph=null,this.onGraphChanged({action:"groupRemove"}),this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[n.id]!=null&&!n.ignore_remove){if(n.inputs)for(let l=0;l<n.inputs.length;l++)n.inputs[l].link!=null&&n.disconnectInput(l,{doProcessChange:!1});if(n.outputs)for(let l=0;l<n.outputs.length;l++){let p=n.outputs[l];p.links!=null&&p.links.length&&n.disconnectOutput(l,!1,{doProcessChange:!1})}if((o=n.onRemoved)==null||o.call(n),n.graph=null,this.onGraphChanged({action:"nodeRemove"}),this.list_of_graphcanvas)for(let l=0;l<this.list_of_graphcanvas.length;++l){let p=this.list_of_graphcanvas[l];p.selected_nodes[n.id]&&delete p.selected_nodes[n.id],p.node_dragged==n&&(p.node_dragged=null)}var r=this._nodes.indexOf(n);r!=-1&&this._nodes.splice(r,1),delete this._nodes_by_id[n.id],(s=this.onNodeRemoved)==null||s.call(this,n),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}},removeLink(n){var o=this.links[n];if(o){var s=this.getNodeById(o.target_id);s&&(this.beforeChange(),s.disconnectInput(o.target_slot),this.afterChange())}},checkNodeTypes(){for(var n,o=0;o<this._nodes.length;o++){var s=this._nodes[o],a=LiteGraph$f.registered_node_types[s.type];if(s.constructor!=a){LiteGraph$f.debug&&((n=LiteGraph$f.log)==null||n.call(LiteGraph$f,`node being replaced by newer version: ${s.type}`));var r=LiteGraph$f.createNode(s.type);this._nodes[o]=r,r.configure(s.serialize()),r.graph=this,this._nodes_by_id[r.id]=r,s.inputs&&(r.inputs=s.inputs.concat()),s.outputs&&(r.outputs=s.outputs.concat())}}this.updateExecutionOrder()}},nodeQueryMethods={getNodeById(n){return n==null?null:this._nodes_by_id[n]},findNodesByClass(n,o=[]){return o=this._nodes.filter(s=>s.constructor===n),o},findNodesByType(n,o=[]){const s=n.toLowerCase();return o=this._nodes.filter(a=>a.type.toLowerCase()===s),o},findNodeByTitle(n){var o;return(o=this._nodes.find(s=>s.title===n))!=null?o:null},findNodesByTitle(n){return this._nodes.filter(o=>o.title===n)},getNodeOnPos(n,o,s=this._nodes,a=0){var r;return(r=s.reverse().find(l=>l.isPointInside(n,o,a)))!=null?r:null},getGroupOnPos(n,o){var s;return(s=this._groups.find(a=>a.isPointInside(n,o,2,!0)))!=null?s:null}};let LiteGraph$e=null;function setGraphPortsMethodsLiteGraph(n){LiteGraph$e=n}const graphPortsMethods={addInput(n,o,s){var a,r,l=this.inputs[n];l||(this.beforeChange(),this.inputs[n]={name:n,type:o,value:s},this.onGraphChanged({action:"addInput"}),this.afterChange(),(a=this.onInputAdded)==null||a.call(this,n,o),(r=this.onInputsOutputsChange)==null||r.call(this))},setInputData(n,o){var s=this.inputs[n];s&&(s.value=o)},getInputData(n){var o=this.inputs[n];return o?o.value:null},renameInput(n,o){var s,a,r;if(o!=n){if(!this.inputs[n])return!1;if(this.inputs[o])return(s=LiteGraph$e.error)==null||s.call(LiteGraph$e,"there is already one input with that name"),!1;this.inputs[o]=this.inputs[n],delete this.inputs[n],this.onGraphChanged({action:"renameInput"}),(a=this.onInputRenamed)==null||a.call(this,n,o),(r=this.onInputsOutputsChange)==null||r.call(this)}},changeInputType(n,o){var s;if(!this.inputs[n])return!1;this.inputs[n].type&&String(this.inputs[n].type).toLowerCase()==String(o).toLowerCase()||(this.inputs[n].type=o,this.onGraphChanged({action:"changeInputType"}),(s=this.onInputTypeChanged)==null||s.call(this,n,o))},removeInput(n){var o,s;return this.inputs[n]?(delete this.inputs[n],this.onGraphChanged({action:"graphRemoveInput"}),(o=this.onInputRemoved)==null||o.call(this,n),(s=this.onInputsOutputsChange)==null||s.call(this),!0):!1},addOutput(n,o,s){var a,r;this.outputs[n]={name:n,type:o,value:s},this.onGraphChanged({action:"addOutput"}),(a=this.onOutputAdded)==null||a.call(this,n,o),(r=this.onInputsOutputsChange)==null||r.call(this)},setOutputData(n,o){var s=this.outputs[n];s&&(s.value=o)},getOutputData(n){var o=this.outputs[n];return o?o.value:null},renameOutput(n,o){var s,a,r;if(!this.outputs[n])return!1;if(this.outputs[o])return(s=LiteGraph$e.error)==null||s.call(LiteGraph$e,"there is already one output with that name"),!1;this.outputs[o]=this.outputs[n],delete this.outputs[n],this._version++,(a=this.onOutputRenamed)==null||a.call(this,n,o),(r=this.onInputsOutputsChange)==null||r.call(this)},changeOutputType(n,o){var s;if(!this.outputs[n])return!1;this.outputs[n].type&&String(this.outputs[n].type).toLowerCase()==String(o).toLowerCase()||(this.outputs[n].type=o,this.onGraphChanged({action:"changeOutputType"}),(s=this.onOutputTypeChanged)==null||s.call(this,n,o))},removeOutput(n){var o,s;return this.outputs[n]?(delete this.outputs[n],this.onGraphChanged({action:"removeOutput"}),(o=this.onOutputRemoved)==null||o.call(this,n),(s=this.onInputsOutputsChange)==null||s.call(this),!0):!1},triggerInput(n,o){for(var s=this.findNodesByTitle(n),a=0;a<s.length;++a)s[a].onTrigger(o)},setCallback(n,o){for(var s=this.findNodesByTitle(n),a=0;a<s.length;++a)s[a].setTrigger(o)}};let LiteGraph$d=null;function setGraphEventsMethodsLiteGraph(n){LiteGraph$d=n}const graphEventsMethods={sendEventToAllNodes(n,o,s=LiteGraph$d.ALWAYS){var a=this._nodes_in_order?this._nodes_in_order:this._nodes;if(a)for(let r=0,l=a.length;r<l;++r){const p=a[r];if(p.constructor===LiteGraph$d.Subgraph&&n!=="onExecute"){p.mode==s&&p.sendEventToAllNodes(n,o,s);continue}!p[n]||p.mode!==s||(o===void 0?p[n]():Array.isArray(o)?p[n].apply(p,o):p[n](o))}},onAction(n,o,s){this._input_nodes=this.findNodesByClass(LiteGraph$d.GraphInput,this._input_nodes);for(var a=0;a<this._input_nodes.length;++a){var r=this._input_nodes[a];if(r.properties.name==n){r.actionDo(n,o,s);break}}},trigger(n,o){var s;(s=this.onTrigger)==null||s.call(this,n,o)},beforeChange(n){var o;(o=this.onBeforeChange)==null||o.call(this,this,n),this.sendActionToCanvas("onBeforeChange",this)},afterChange(n){var o;(o=this.onAfterChange)==null||o.call(this,this,n),this.sendActionToCanvas("onAfterChange",this)},connectionChange(n){var o;this.updateExecutionOrder(),(o=this.onConnectionChange)==null||o.call(this,n),this.onGraphChanged({action:"connectionChange",doSave:!1}),this.sendActionToCanvas("onConnectionChange")}};let LiteGraph$c=null;function setSerializationLoadMethodsLiteGraph(n){LiteGraph$c=n}const serializationLoadMethods={serialize(){var n,o;const s=this._nodes.map(d=>d.serialize());var a=[];for(var r in this.links){var l=this.links[r];if(!l.serialize){(n=LiteGraph$c.warn)==null||n.call(LiteGraph$c,"weird LLink bug, link info is not a LLink but a regular object");var p=new LiteGraph$c.LLink;for(var h in l)p[h]=l[h];this.links[r]=p,l=p}a.push(l.serialize())}const c=this._groups.map(d=>d.serialize());var u={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:s,links:a,groups:c,config:this.config,extra:this.extra,version:LiteGraph$c.VERSION};return(o=this.onSerialize)==null||o.call(this,u),u},configure(n,o){var s,a,r,l,p;if(n){o||this.clear();var h=n.nodes;if(n.links&&n.links.constructor===Array){for(var c=[],u=0;u<n.links.length;++u){var d=n.links[u];if(!d){(s=LiteGraph$c.warn)==null||s.call(LiteGraph$c,"serialized graph link data contains errors, skipping.");continue}var f=new LiteGraph$c.LLink;f.configure(d),c[f.id]=f}n.links=c}for(let b in n)["nodes","groups"].includes(b)||(this[b]=n[b]);var L=!1;this._configuring=!0;try{if(this._nodes=[],h){for(let b=0,G=h.length;b<G;++b){var g=h[b],_=LiteGraph$c.createNode(g.type,g.title);_||((a=LiteGraph$c.log)==null||a.call(LiteGraph$c,`Node not found or has errors: ${g.type}`),_=new LiteGraph$c.LGraphNode,_.last_serialization=g,_.has_errors=!0,L=!0),_.id=g.id,this.add(_,!0,{doProcessChange:!1})}h.forEach(b=>{const G=this.getNodeById(b.id);G==null||G.configure(b)})}this._groups.length=0,n.groups&&n.groups.forEach(b=>{const G=new LiteGraph$c.LGraphGroup;G.configure(b),this.add(G,!0,{doProcessChange:!1})})}finally{this._configuring=!1}return this.updateExecutionOrder(),this.extra=(r=n.extra)!=null?r:{},(l=this.onConfigure)==null||l.call(this,n),n._version?(p=LiteGraph$c.debug)==null||p.call(LiteGraph$c,"skip onGraphChanged when configure passing version too!"):this.onGraphChanged({action:"graphConfigure",doSave:!1}),this.setDirtyCanvas(!0,!0),L}},load(n,o){var s=this;if(n.constructor===File||n.constructor===Blob){var a=new FileReader;a.addEventListener("load",l=>{var p=JSON.parse(l.target.result);s.configure(p),o==null||o()}),a.readAsText(n);return}var r=new XMLHttpRequest;r.open("GET",n,!0),r.send(null),r.onload=l=>{var p;if(r.status!==200){(p=LiteGraph$c.error)==null||p.call(LiteGraph$c,"Error loading graph:",r.status,r.response);return}var h=JSON.parse(r.response);s.configure(h),o==null||o()},r.onerror=l=>{var p;(p=LiteGraph$c.error)==null||p.call(LiteGraph$c,"Error loading graph:",l)}}};let LiteGraph$b=null;function setHistoryMethodsLiteGraph(n){LiteGraph$b=n}const historyMethods={onGraphSaved(n={}){var o={};Object.assign(o,n),this.savedVersion=this._version},onGraphLoaded(n={}){var o={};Object.assign(o,n),this.savedVersion=this._version},onGraphChanged(n={}){var o,s,a,r,l,p,h={action:"",doSave:!0,doSaveGraph:!0},c=Object.assign(h,n);if(!(this._configuring&&c.action!=="graphConfigure")&&(this._version++,c.action?(o=LiteGraph$b.debug)==null||o.call(LiteGraph$b,"Graph change",c.action):(s=LiteGraph$b.debug)==null||s.call(LiteGraph$b,"Graph change, no action",c),c.doSave&&LiteGraph$b.actionHistory_enabled)){(a=LiteGraph$b.debug)==null||a.call(LiteGraph$b,"onGraphChanged SAVE :: "+c.action);var u={actionName:c.action};c.doSaveGraph&&(u=Object.assign(u,{graphSave:this.serialize()}));for(var d=this.history;d.actionHistoryPtr<d.actionHistoryVersions.length-1;)(r=LiteGraph$b.debug)==null||r.call(LiteGraph$b,"popping: gone back? "+(d.actionHistoryPtr+" < "+(d.actionHistoryVersions.length-1))),d.actionHistoryVersions.pop();if(d.actionHistoryVersions.length>=LiteGraph$b.actionHistoryMaxSave){var f=d.actionHistoryVersions.shift();(l=LiteGraph$b.debug)==null||l.call(LiteGraph$b,"maximum saves reached: "+d.actionHistoryVersions.length+", remove older: "+f),d.actionHistory[f]=!1}d.actionHistoryPtr=d.actionHistoryVersions.length,d.actionHistoryVersions.push(d.actionHistoryPtr),d.actionHistory[d.actionHistoryPtr]=u,(p=LiteGraph$b.debug)==null||p.call(LiteGraph$b,"history saved: "+d.actionHistoryPtr,u.actionName)}},actionHistoryBack(n={}){var o,s,a,r,l,p={};Object.assign(p,n);var h=this.history;return h.actionHistoryPtr!=null&&h.actionHistoryPtr>=0?(h.actionHistoryPtr--,(o=LiteGraph$b.debug)==null||o.call(LiteGraph$b,"history step back: "+h.actionHistoryPtr),this.actionHistoryLoad({iVersion:h.actionHistoryPtr})?((a=LiteGraph$b.debug)==null||a.call(LiteGraph$b,"history loaded back: "+h.actionHistoryPtr),(r=LiteGraph$b.debug)==null||r.call(LiteGraph$b,this.history),!0):((s=LiteGraph$b.warn)==null||s.call(LiteGraph$b,"historyLoad failed, restore pointer? "+h.actionHistoryPtr),h.actionHistoryPtr++,!1)):((l=LiteGraph$b.debug)==null||l.call(LiteGraph$b,"history is already at older state"),!1)},actionHistoryForward(n={}){var o,s,a,r,l={};Object.assign(l,n);var p=this.history;return p.actionHistoryPtr<p.actionHistoryVersions.length?(p.actionHistoryPtr++,(o=LiteGraph$b.debug)==null||o.call(LiteGraph$b,"history step forward: "+p.actionHistoryPtr),this.actionHistoryLoad({iVersion:p.actionHistoryPtr})?((a=LiteGraph$b.debug)==null||a.call(LiteGraph$b,"history loaded forward: "+p.actionHistoryPtr),!0):((s=LiteGraph$b.warn)==null||s.call(LiteGraph$b,"historyLoad failed, restore pointer? "+p.actionHistoryPtr),p.actionHistoryPtr--,!1)):((r=LiteGraph$b.debug)==null||r.call(LiteGraph$b,"history is already at newer state"),!1)},actionHistoryLoad(n={}){var o,s={iVersion:!1,backStep:!1},a=Object.assign(s,n),r=this.history;if(r.actionHistory[a.iVersion]&&r.actionHistory[a.iVersion].graphSave){var l=JSON.stringify(this.history);return this.configure(r.actionHistory[a.iVersion].graphSave),this.history=JSON.parse(l),(o=LiteGraph$b.debug)==null||o.call(LiteGraph$b,"history loaded: "+a.iVersion,r.actionHistory[a.iVersion].actionName),!0}else return!1}};function installLGraphDelegates(n,o){n.__delegates_installed||(setLifecycleMethodsLiteGraph(o),setCanvasBindingMethodsLiteGraph(o),setRuntimeLoopMethodsLiteGraph(o),setExecutionOrderMethodsLiteGraph(o),setNodeMutationMethodsLiteGraph(o),setGraphPortsMethodsLiteGraph(o),setGraphEventsMethodsLiteGraph(o),setSerializationLoadMethodsLiteGraph(o),setHistoryMethodsLiteGraph(o),[lifecycleMethods,canvasBindingMethods,runtimeLoopMethods,executionOrderMethods,nodeMutationMethods,nodeQueryMethods,graphPortsMethods,graphEventsMethods,serializationLoadMethods,historyMethods].forEach(s=>{Object.entries(s).forEach(([a,r])=>{Object.defineProperty(n.prototype,a,{value:r,writable:!0,configurable:!0})})}),Object.defineProperty(n,"__delegates_installed",{value:!0,writable:!1,configurable:!1}))}class LGraph{constructor(o){var s;(s=LiteGraph.log)==null||s.call(LiteGraph,"Graph created"),this.list_of_graphcanvas=null,this.clear(),o&&this.configure(o)}}H(LGraph,"supported_types",["number","string","boolean"]),H(LGraph,"STATUS_STOPPED",1),H(LGraph,"STATUS_RUNNING",2);function setupLGraphDelegates(n=LiteGraph){installLGraphDelegates(LGraph,n)}let LiteGraph$a=null;function setLifecycleSerializationMethodsLiteGraph(n){LiteGraph$a=n}const lifecycleSerializationMethods={configure(n){var o,s,a,r,l;Object.entries(n).forEach(([p,h])=>{var c;if(p==="properties"){for(var u in h)this.properties[u]=h[u],(c=this.onPropertyChanged)==null||c.call(this,u,h[u]);return}h!==null&&(typeof h=="object"?this[p]&&this[p].configure?this[p].configure(h):this[p]=LiteGraph$a.cloneObject(h,this[p]):this[p]=h)}),n.title||(this.title=this.constructor.title),(o=this.inputs)==null||o.forEach((p,h)=>{var c,u;if(!p.link)return;const d=this.graph?this.graph.links[p.link]:null;(c=this.onConnectionsChange)==null||c.call(this,LiteGraph$a.INPUT,h,!0,d,p),(u=this.onInputAdded)==null||u.call(this,p)}),(s=this.outputs)==null||s.forEach((p,h)=>{var c;p.links&&(p.links.forEach(()=>{var u;const d=this.graph;(u=this.onConnectionsChange)==null||u.call(this,LiteGraph$a.OUTPUT,h,!0,d,p)}),(c=this.onOutputAdded)==null||c.call(this,p))}),this.widgets&&(this.widgets.forEach(p=>{p&&p.options&&p.options.property&&this.properties[p.options.property]!==void 0&&(p.value=JSON.parse(JSON.stringify(this.properties[p.options.property])))}),(a=n.widgets_values)==null||a.forEach((p,h)=>{this.widgets[h]&&(this.widgets[h].value=p)})),(r=this.onConfigure)==null||r.call(this,n),(l=this.graph)==null||l.onGraphChanged({action:"nodeConfigure",doSave:!1})},serialize(){var n,o,s,a={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph$a.cloneObject(this.flags),order:this.order,mode:this.mode};return this.constructor===LiteGraph$a.LGraphNode&&this.last_serialization?this.last_serialization:(this.inputs&&(a.inputs=LiteGraph$a.cloneObject(this.inputs)),this.outputs&&(this.outputs.forEach(r=>{delete r._data}),a.outputs=LiteGraph$a.cloneObject(this.outputs)),this.title&&this.title!=this.constructor.title&&(a.title=this.title),this.properties&&(a.properties=LiteGraph$a.cloneObject(this.properties)),this.widgets&&this.serialize_widgets&&(a.widgets_values=this.widgets.map(r=>{var l;return(l=r==null?void 0:r.value)!=null?l:null})),(n=a.type)!=null||(a.type=this.constructor.type),this.color&&(a.color=this.color),this.bgcolor&&(a.bgcolor=this.bgcolor),this.boxcolor&&(a.boxcolor=this.boxcolor),this.shape&&(a.shape=this.shape),(o=this.onSerialize)!=null&&o.call(this,a)&&((s=LiteGraph$a.warn)==null||s.call(LiteGraph$a,"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter")),a)},clone(){var n,o,s=LiteGraph$a.createNode(this.type);if(!s)return null;var a=LiteGraph$a.cloneObject(this.serialize());return(n=a.inputs)==null||n.forEach(r=>{r.link=null}),(o=a.outputs)==null||o.forEach(r=>{r.links&&(r.links.length=0)}),delete a.id,LiteGraph$a.use_uuids&&(a.id=LiteGraph$a.uuidv4()),s.configure(a),s},toString(){return JSON.stringify(this.serialize())},getTitle(){var n;return(n=this.title)!=null?n:this.constructor.title}};let LiteGraph$9=null;function setPropertiesWidgetsMethodsLiteGraph(n){LiteGraph$9=n}const propertiesWidgetsMethods={setProperty(n,o){var s,a;if(this.properties||(this.properties={}),o===this.properties[n])return;const r=this.properties[n];this.properties[n]=o,((s=this.onPropertyChanged)==null?void 0:s.call(this,n,o,r))===!1&&(this.properties[n]=r);const l=(a=this.widgets)==null?void 0:a.find(p=>{var h;return p&&((h=p.options)==null?void 0:h.property)===n});l&&(l.value=o)},addProperty(n,o,s,a){var r,l;const p={name:n,type:s,default_value:o,...a};return this.properties_info=(r=this.properties_info)!=null?r:[],this.properties_info.push(p),this.properties=(l=this.properties)!=null?l:{},this.properties[n]=o,p},getPropertyInfo(n){var o=null;if(this.properties_info){for(var s=0;s<this.properties_info.length;++s)if(this.properties_info[s].name==n){o=this.properties_info[s];break}}return this.constructor[`@${n}`]&&(o=this.constructor[`@${n}`]),this.constructor.widgets_info&&this.constructor.widgets_info[n]&&(o=this.constructor.widgets_info[n]),!o&&this.onGetPropertyInfo&&(o=this.onGetPropertyInfo(n)),o||(o={}),o.type||(o.type=typeof this.properties[n]),o.widget=="combo"&&(o.type="enum"),o},addWidget(n,o,s,a,r){var l,p,h;(l=this.widgets)!=null||(this.widgets=[]),!r&&a&&a.constructor===Object&&(r=a,a=null),r&&r.constructor===String&&(r={property:r}),a&&a.constructor===String&&(r!=null||(r={}),r.property=a,a=null),a&&a.constructor!==Function&&((p=LiteGraph$9.warn)==null||p.call(LiteGraph$9,"addWidget: callback must be a function"),a=null);var c={type:n.toLowerCase(),name:o,value:s,callback:a,options:r||{}};if(c.options.y!==void 0&&(c.y=c.options.y),!a&&!c.options.callback&&!c.options.property&&((h=LiteGraph$9.warn)==null||h.call(LiteGraph$9,"LiteGraph addWidget(...) without a callback or property assigned")),n=="combo"&&!c.options.values)throw Error("LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }");return this.widgets.push(c),this.setSize(this.computeSize()),c},addCustomWidget(n){var o;return(o=this.widgets)!=null||(this.widgets=[]),this.widgets.push(n),n}},ioDataMethods={setOutputData(n,o){var s;if(this.outputs){if((n==null?void 0:n.constructor)===String)n=this.findOutputSlot(n);else if(n==-1||n>=this.outputs.length)return;var a=this.outputs[n];a&&(a._data=o,(s=this.outputs[n].links)==null||s.forEach(r=>{const l=this.graph.links[r];l&&(l.data=o)}))}},setOutputDataType(n,o){var s,a;if(this.outputs&&!(n==-1||n>=this.outputs.length)){var r=this.outputs[n];r&&(r.type=o,(a=(s=this.outputs[n])==null?void 0:s.links)==null||a.forEach(l=>{this.graph.links[l]&&(this.graph.links[l].type=o)}))}},getInputData(n,o,s){var a;if(this.inputs&&!(n>=this.inputs.length||this.inputs[n].link==null)){var r=this.inputs[n].link,l=this.graph.links[r];if(!l)return null;if(!o)return l.data;var p=this.graph.getNodeById(l.origin_id);if(!p)return l.data;if(s){var h=this.id+"_getInputData_forced_"+Math.floor(Math.random()*9999),c={action:h,options:{action_call:h}};this.refreshAncestors(c)}return p.updateOutputData?p.updateOutputData(l.origin_slot):(a=p.doExecute)==null||a.call(p),l.data}},getInputDataType(n){if(!this.inputs||n>=this.inputs.length||this.inputs[n].link==null)return null;var o=this.inputs[n].link,s=this.graph.links[o];if(!s)return null;var a=this.graph.getNodeById(s.origin_id);if(!a)return s.type;var r=a.outputs[s.origin_slot];return r?r.type:null},getInputDataByName(n,o){var s=this.findInputSlot(n);return s==-1?null:this.getInputData(s,o)},isInputConnected(n){return this.inputs?n<this.inputs.length&&this.inputs[n].link!=null:!1},getInputInfo(n){return this.inputs&&n<this.inputs.length?this.inputs[n]:null},getInputLink(n){if(!this.inputs)return null;if(n<this.inputs.length){var o=this.inputs[n];return this.graph.links[o.link]}return null},getInputNode(n){if(!this.inputs||n>=this.inputs.length)return null;var o=this.inputs[n];if(!o||o.link===null)return null;var s=this.graph.links[o.link];return s?this.graph.getNodeById(s.origin_id):null},getInputOrProperty(n){if(this.inputs)for(var o=0,s=this.inputs.length;o<s;++o){var a=this.inputs[o];if(n==a.name&&a.link!=null){var r=this.graph.links[a.link];if(r)return r.data}}return this.properties?this.properties[n]:null},getOutputData(n){if(!this.outputs||n>=this.outputs.length)return null;var o=this.outputs[n];return o._data},getOutputInfo(n){return this.outputs&&n<this.outputs.length?this.outputs[n]:null},isOutputConnected(n){return this.outputs?n<this.outputs.length&&this.outputs[n].links&&this.outputs[n].links.length:!1},isAnyOutputConnected(){return this.outputs?this.outputs.some(n=>n.links&&n.links.length):!1},getOutputNodes(n){if(!this.outputs||n>=this.outputs.length)return null;const o=this.outputs[n];return!o.links||o.links.length===0?null:o.links.map(s=>this.graph.links[s]).filter(s=>s).map(s=>this.graph.getNodeById(s.target_id)).filter(s=>s)}};let LiteGraph$8=null;function setExecutionActionsMethodsLiteGraph(n){LiteGraph$8=n}const executionActionsMethods={addOnTriggerInput(){var n=this.findInputSlot("onTrigger");return n==-1?(this.addInput("onTrigger",LiteGraph$8.EVENT,{removable:!0,nameLocked:!0}),this.findInputSlot("onTrigger")):n},addOnExecutedOutput(){var n=this.findOutputSlot("onExecuted");return n==-1?(this.addOutput("onExecuted",LiteGraph$8.ACTION,{removable:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")):n},onAfterExecuteNode(n,o){var s,a=this.findOutputSlot("onExecuted");a!=-1&&((s=LiteGraph$8.debug)==null||s.call(LiteGraph$8,this.id+":"+this.order+" triggering slot onAfterExecute",n,o),this.triggerSlot(a,n,null,o))},changeMode(n){switch(n){case LiteGraph$8.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph$8.ON_EVENT:break;case LiteGraph$8.NEVER:break;case LiteGraph$8.ALWAYS:break;case LiteGraph$8.ON_REQUEST:break;default:return!1}return this.mode=n,!0},executePendingActions(){!this._waiting_actions||!this._waiting_actions.length||(this._waiting_actions.forEach(n=>{this.onAction(n[0],n[1],n[2],n[3],n[4])}),this._waiting_actions.length=0)},doExecute(n,o={}){var s,a,r,l,p;if(this.onExecute){if((s=o.action_call)!=null||(o.action_call=`${this.id}_exec_${Math.floor(Math.random()*9999)}`),this.graph.nodes_executing&&this.graph.nodes_executing[this.id]){(a=LiteGraph$8.debug)==null||a.call(LiteGraph$8,"NODE already executing! Prevent! "+this.id+":"+this.order);return}if(LiteGraph$8.ensureNodeSingleExecution&&this.exec_version&&this.exec_version>=this.graph.iteration&&this.exec_version!==void 0){(r=LiteGraph$8.debug)==null||r.call(LiteGraph$8,"!! NODE already EXECUTED THIS STEP !! "+this.exec_version);return}if(LiteGraph$8.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&o&&o.action_call&&this.graph.nodes_executedAction[this.id]==o.action_call){(l=LiteGraph$8.debug)==null||l.call(LiteGraph$8,"!! NODE already ACTION THIS STEP !! "+o.action_call);return}this.graph.nodes_executing[this.id]=!0,this.onExecute(n,o),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,o&&o.action_call&&(this.action_call=o.action_call,this.graph.nodes_executedAction[this.id]=o.action_call)}this.execute_triggered=2,(p=this.onAfterExecuteNode)==null||p.call(this,n,o)},execute(n,o={}){return this.doExecute(n,o)},actionDo(n,o,s={},a){var r,l,p,h;if(this.onAction){if((r=s.action_call)!=null||(s.action_call=`${this.id}_${n||"action"}_${Math.floor(Math.random()*9999)}`),LiteGraph$8.ensureNodeSingleAction&&this.graph.nodes_actioning&&this.graph.nodes_actioning[this.id]==s.action_call)return;if((l=LiteGraph$8.debug)==null||l.call(LiteGraph$8,"CheckActioned ? "+this.id+":"+this.order+" :: "+this.action_call),LiteGraph$8.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&s&&s.action_call&&this.graph.nodes_executedAction[this.id]==s.action_call){(p=LiteGraph$8.debug)==null||p.call(LiteGraph$8,"!! NODE already ACTION THIS STEP !! "+s.action_call),\u00E7;return}this.graph.nodes_actioning[this.id]=n||"actioning",this.onAction(n,o,s,a),this.graph.nodes_actioning[this.id]=!1,s&&s.action_call&&(this.action_call=s.action_call,this.graph.nodes_executedAction[this.id]=s.action_call)}this.action_triggered=2,(h=this.onAfterExecuteNode)==null||h.call(this,o,s)},trigger(n,o,s){!this.outputs||this.outputs.length===0||(this.graph&&(this.graph._last_trigger_time=LiteGraph$8.getTime()),this.outputs.forEach((a,r)=>{a&&a.type===LiteGraph$8.EVENT&&(!n||a.name===n)&&this.triggerSlot(r,o,null,s)}))},triggerSlot(n,o,s,a={}){var r,l,p,h;if(this.outputs){if(n==null){(r=LiteGraph$8.error)==null||r.call(LiteGraph$8,"triggerSlot","slot must be a number");return}n.constructor!==Number&&((l=LiteGraph$8.warn)==null||l.call(LiteGraph$8,"triggerSlot","slot must be a number, use node.trigger('name') if you want to use a string"));var c=this.outputs[n];if(c){var u=c.links;if(!(!u||!u.length)&&!(this.graph&&this.graph.ancestorsCall)){this.graph&&(this.graph._last_trigger_time=LiteGraph$8.getTime());for(var d=0;d<u.length;++d){var f=u[d];if(!(s!=null&&s!=f)){var L=this.graph.links[u[d]];if(L){L._last_time=LiteGraph$8.getTime();var g=this.graph.getNodeById(L.target_id);if(g){if(g.mode===LiteGraph$8.ON_TRIGGER)a.action_call||(a.action_call=`${this.id}_trigg_${Math.floor(Math.random()*9999)}`),LiteGraph$8.refreshAncestorsOnTriggers&&g.refreshAncestors({action:"trigger",param:o,options:a}),g.onExecute&&g.doExecute(o,a);else if(g.onAction){a.action_call||(a.action_call=`${this.id}_act_${Math.floor(Math.random()*9999)}`);let _=g.inputs[L.target_slot];(p=LiteGraph$8.debug)==null||p.call(LiteGraph$8,"triggerSlot","will call onACTION: "+this.id+":"+this.order+" :: "+_.name),LiteGraph$8.refreshAncestorsOnActions&&g.refreshAncestors({action:_.name,param:o,options:a}),LiteGraph$8.use_deferred_actions&&g.onExecute?((h=g._waiting_actions)!=null||(g._waiting_actions=[]),g._waiting_actions.push([_.name,o,a,L.target_slot])):g.actionDo(_.name,o,a,L.target_slot)}}}}}}}}},clearTriggeredSlot(n,o){!this.outputs||!this.outputs[n]||!this.outputs[n].links||this.outputs[n].links.forEach(s=>{if(o!==null&&o!==s)return;const a=this.graph.links[s];a&&(a._last_time=0)})}};let LiteGraph$7=null;function setSlotsMutationMethodsLiteGraph(n){LiteGraph$7=n}const slotsMutationMethods={setSize(n){var o;this.size=n,(o=this.onResize)==null||o.call(this,this.size)},addInput(n,o,s){return this.addSlot(n,o,s,!0)},addOutput(n,o,s){return this.addSlot(n,o,s,!1)},addSlot(n,o,s,a){var r,l,p,h;const c=a?{name:n,type:o,link:null,...s}:{name:n,type:o,links:null,...s};return a?(this.inputs=(r=this.inputs)!=null?r:[],this.inputs.push(c),(l=this.onInputAdded)==null||l.call(this,c),LiteGraph$7.registerNodeAndSlotType(this,o)):(this.outputs=(p=this.outputs)!=null?p:[],this.outputs.push(c),(h=this.onOutputAdded)==null||h.call(this,c),LiteGraph$7.auto_load_slot_types&&LiteGraph$7.registerNodeAndSlotType(this,o,!0)),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),c},addInputs(n){this.addSlots(n,!0)},addOutputs(n){this.addSlots(n,!1)},addSlots(n,o){var s;typeof n=="string"&&(n=[n]),n.forEach(a=>{var r,l,p,h,c,u;const d=o?{name:a[0],type:a[1],link:null,...(r=a[2])!=null?r:{}}:{name:a[0],type:a[1],links:null,...(l=a[2])!=null?l:{}};o?(this.inputs=(p=this.inputs)!=null?p:[],this.inputs.push(d),(h=this.onInputAdded)==null||h.call(this,d),LiteGraph$7.registerNodeAndSlotType(this,a[1])):(this.outputs=(c=this.outputs)!=null?c:[],this.outputs.push(d),(u=this.onOutputAdded)==null||u.call(this,d),LiteGraph$7.auto_load_slot_types&&LiteGraph$7.registerNodeAndSlotType(this,a[1],!0))}),this.setSize(this.computeSize()),(s=this.setDirtyCanvas)==null||s.call(this,!0,!0)},removeInput(n){var o;this.disconnectInput(n);const s=this.inputs.splice(n,1)[0];this.inputs.slice(n).filter(a=>!!a).forEach(a=>{const r=this.graph.links[a.link];r!=null&&r.target_slot&&r.target_slot--}),this.setSize(this.computeSize()),(o=this.onInputRemoved)==null||o.call(this,n,s),this.setDirtyCanvas(!0,!0)},removeOutput(n){var o;this.disconnectOutput(n),this.outputs=this.outputs.filter((s,a)=>a!==n),this.outputs.slice(n).forEach(s=>{!s||!s.links||s.links.forEach(a=>{const r=this.graph.links[a];r&&(r.origin_slot-=1)})}),this.setSize(this.computeSize()),(o=this.onOutputRemoved)==null||o.call(this,n),this.setDirtyCanvas(!0,!0)},addConnection(n,o,s,a){var r={name:n,type:o,pos:s,direction:a,links:null};return this.connections.push(r),r}};let LiteGraph$6=null;function setSlotsQueryMethodsLiteGraph(n){LiteGraph$6=n}const slotsQueryMethods={findInputSlot(n,o){if(!this.inputs)return-1;for(var s=0,a=this.inputs.length;s<a;++s)if(n==this.inputs[s].name)return o?this.inputs[s]:s;return-1},findOutputSlot(n,o=!1){if(!this.outputs)return-1;for(var s=0,a=this.outputs.length;s<a;++s)if(n==this.outputs[s].name)return o?this.outputs[s]:s;return-1},findInputSlotFree(n={}){var o={returnObj:!1,typesNotAccepted:[]},s=Object.assign(o,n);if(!this.inputs)return-1;for(var a=0,r=this.inputs.length;a<r;++a)if(!(this.inputs[a].link&&this.inputs[a].link!=null)&&!(s.typesNotAccepted&&s.typesNotAccepted.includes&&s.typesNotAccepted.includes(this.inputs[a].type)))return s.returnObj?this.inputs[a]:a;return-1},findOutputSlotFree(n={}){var o={returnObj:!1,typesNotAccepted:[]},s=Object.assign(o,n);if(!this.outputs)return-1;for(let a=0,r=this.outputs.length;a<r;++a)if(!(this.outputs[a].links&&this.outputs[a].links!=null)&&!(s.typesNotAccepted&&s.typesNotAccepted.includes&&s.typesNotAccepted.includes(this.outputs[a].type)))return s.returnObj?this.outputs[a]:a;return-1},findInputSlotByType(n,o,s,a){return this.findSlotByType(!0,n,o,s,a)},findOutputSlotByType(n,o,s,a){return this.findSlotByType(!1,n,o,s,a)},findSlotByType(n=!1,o,s=!1,a=!1,r=!1){var l=n?this.inputs:this.outputs;if(!l)return-1;(o==""||o=="*")&&(o=0);for(let p=0,h=l.length;p<h;++p){let c=(o+"").toLowerCase().split(","),u=l[p].type=="0"||l[p].type=="*"?"0":l[p].type;u=(u+"").toLowerCase().split(",");for(let d=0;d<c.length;d++)for(let f=0;f<u.length;f++)if(c[d]=="_event_"&&(c[d]=LiteGraph$6.EVENT),u[d]=="_event_"&&(u[d]=LiteGraph$6.EVENT),c[d]=="*"&&(c[d]=0),u[d]=="*"&&(u[d]=0),c[d]==u[f]){if(a&&l[p].links&&l[p].links!==null)continue;return s?l[p]:p}}if(a&&!r)for(let p=0,h=l.length;p<h;++p){let c=(o+"").toLowerCase().split(","),u=l[p].type=="0"||l[p].type=="*"?"0":l[p].type;u=(u+"").toLowerCase().split(",");for(let d=0;d<c.length;d++)for(let f=0;f<u.length;f++)if(c[d]=="*"&&(c[d]=0),u[d]=="*"&&(u[d]=0),c[d]==u[f])return s?l[p]:p}return-1},getSlotInPosition(n,o){var s=new Float32Array(2);if(this.inputs)for(let a=0,r=this.inputs.length;a<r;++a){let l=this.inputs[a];if(this.getConnectionPos(!0,a,s),LiteGraph$6.isInsideRectangle(n,o,s[0]-10,s[1]-5,20,10))return{input:l,slot:a,link_pos:s}}if(this.outputs)for(let a=0,r=this.outputs.length;a<r;++a){let l=this.outputs[a];if(this.getConnectionPos(!1,a,s),LiteGraph$6.isInsideRectangle(n,o,s[0]-10,s[1]-5,20,10))return{output:l,slot:a,link_pos:s}}return null}};let LiteGraph$5=null;function setConnectionsMethodsLiteGraph(n){LiteGraph$5=n}const connectionsMethods={connectByType(n,o,s="*",a={}){var r,l,p,h,c,u={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},d=Object.assign(u,a);o&&o.constructor===Number&&(o=this.graph.getNodeById(o));var f=o.findInputSlotByType(s,!1,!0);return f>=0&&f!==null?((r=LiteGraph$5.debug)==null||r.call(LiteGraph$5,"CONNbyTYPE type "+s+" for "+f),this.connect(n,o,f)):d.createEventInCase&&s==LiteGraph$5.EVENT?((l=LiteGraph$5.debug)==null||l.call(LiteGraph$5,"connect WILL CREATE THE onTrigger "+s+" to "+o),this.connect(n,o,-1)):d.generalTypeInCase&&(f=o.findInputSlotByType(0,!1,!0,!0),(p=LiteGraph$5.debug)==null||p.call(LiteGraph$5,"connect TO a general type (*, 0), if not found the specific type ",s," to ",o,"RES_SLOT:",f),f>=0)?this.connect(n,o,f):d.firstFreeIfOutputGeneralInCase&&(s==0||s=="*"||s=="")&&(f=o.findInputSlotFree({typesNotAccepted:[LiteGraph$5.EVENT]}),(h=LiteGraph$5.debug)==null||h.call(LiteGraph$5,"connect TO TheFirstFREE ",s," to ",o,"RES_SLOT:",f),f>=0)?this.connect(n,o,f):((c=LiteGraph$5.debug)==null||c.call(LiteGraph$5,"no way to connect type: ",s," to targetNODE ",o),null)},connectByTypeOutput(n,o,s="*",a={}){var r,l,p,h={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},c=Object.assign(h,a);o&&o.constructor===Number&&(o=this.graph.getNodeById(o));var u=o.findOutputSlotByType(s,!1,!0);return u>=0&&u!==null?((r=LiteGraph$5.debug)==null||r.call(LiteGraph$5,"CONNbyTYPE OUT! type "+s+" for "+u),o.connect(u,this,n)):c.generalTypeInCase&&(u=o.findOutputSlotByType(0,!1,!0,!0),u>=0)?o.connect(u,this,n):c.createEventInCase&&s==LiteGraph$5.EVENT&&LiteGraph$5.do_add_triggers_slots?(u=o.addOnExecutedOutput(),o.connect(u,this,n)):c.firstFreeIfInputGeneralInCase&&(s==0||s=="*"||s==""||s=="undefined")&&(u=o.findOutputSlotFree({typesNotAccepted:[LiteGraph$5.EVENT]}),u>=0)?o.connect(u,this,n):((l=LiteGraph$5.debug)==null||l.call(LiteGraph$5,"no way to connect byOUT type: ",s," to sourceNODE ",o),(p=LiteGraph$5.log)==null||p.call(LiteGraph$5,"type OUT! "+s+" not found or not free?"),null)},connect(n,o,s=0){var a,r,l,p,h,c,u,d,f,L,g,_,b,G;if(!this.graph)return(a=LiteGraph$5.log)==null||a.call(LiteGraph$5,"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(n.constructor===String){if(n=this.findOutputSlot(n),n==-1)return(r=LiteGraph$5.log)==null||r.call(LiteGraph$5,`Connect: Error, no slot of name ${n}`),null}else if(!this.outputs||n>=this.outputs.length)return(l=LiteGraph$5.log)==null||l.call(LiteGraph$5,"Connect: Error, slot number not found"),null;if(o&&o.constructor===Number&&(o=this.graph.getNodeById(o)),!o)throw new Error("target node is null");if(o==this)return null;if(s.constructor===String){if(s=o.findInputSlot(s),s==-1)return(p=LiteGraph$5.log)==null||p.call(LiteGraph$5,`Connect: Error, no slot of name ${s}`),null}else if(s===LiteGraph$5.EVENT)if(LiteGraph$5.do_add_triggers_slots)o.changeMode(LiteGraph$5.ON_TRIGGER),s=o.findInputSlot("onTrigger");else return null;else if(!o.inputs||s>=o.inputs.length)return(h=LiteGraph$5.log)==null||h.call(LiteGraph$5,"Connect: Error, slot number not found"),null;var C=!1,T=o.inputs[s],E=null,N=this.outputs[n];if(!this.outputs[n])return(c=LiteGraph$5.log)==null||c.call(LiteGraph$5,"Invalid slot passed: ",n,this.outputs),null;if(o.onBeforeConnectInput&&(s=o.onBeforeConnectInput(o)),((u=this.onConnectOutput)==null?void 0:u.call(this,n,T.type,T,o,s))===!1)return null;if(s===!1||s===null||!LiteGraph$5.isValidConnection(N.type,T.type))return this.setDirtyCanvas(!1,!0),C&&this.graph.connectionChange(this,E),null;if((d=LiteGraph$5.debug)==null||d.call(LiteGraph$5,"DBG targetSlot",s),((f=o.onConnectInput)==null?void 0:f.call(o,s,N.type,N,this,n))===!1||((L=this.onConnectOutput)==null?void 0:L.call(this,n,T.type,T,o,s))===!1)return null;o.inputs[s]&&o.inputs[s].link!=null&&(this.graph.beforeChange(),o.disconnectInput(s,{doProcessChange:!1}),C=!0),(g=N.links)!=null&&g.length&&N.type===LiteGraph$5.EVENT&&(LiteGraph$5.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(n,!1,{doProcessChange:!1}),C=!0));var A;return LiteGraph$5.use_uuids?A=LiteGraph$5.uuidv4():A=++this.graph.last_link_id,E=new LiteGraph$5.LLink(A,T.type||N.type,this.id,n,o.id,s),this.graph.links[E.id]=E,N.links==null&&(N.links=[]),N.links.push(E.id),!o.inputs||typeof o.inputs[s]=="undefined"?((_=LiteGraph$5.warn)==null||_.call(LiteGraph$5,"connect aborted: target slot does not exist on target node",o,s),N.links.pop(),delete this.graph.links[E.id],null):(o.inputs[s].link=E.id,(b=this.onConnectionsChange)==null||b.call(this,LiteGraph$5.OUTPUT,n,!0,E,N),(G=o.onConnectionsChange)==null||G.call(o,LiteGraph$5.INPUT,s,!0,E,T),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,o,s,this,n),this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,this,n,o,s)),this.graph.onGraphChanged({action:"connect"}),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,E),E)},disconnectOutput(n,o,s={}){var a,r,l,p,h,c,u={doProcessChange:!0},d=Object.assign(u,s);if(n.constructor===String){if(n=this.findOutputSlot(n),n==-1)return(a=LiteGraph$5.log)==null||a.call(LiteGraph$5,`Connect: Error, no slot of name ${n}`),!1}else if(!this.outputs||n>=this.outputs.length)return(r=LiteGraph$5.log)==null||r.call(LiteGraph$5,"Connect: Error, slot number not found"),!1;var f=this.outputs[n];if(!f||!f.links||f.links.length==0)return!1;if(o){if(o.constructor===Number&&(o=this.graph.getNodeById(o)),!o)throw new Error("Target Node not found");for(let g=0,_=f.links.length;g<_;g++){let b=f.links[g],G=this.graph.links[b];if(G.target_id==o.id){f.links.splice(g,1);var L=o.inputs[G.target_slot];L.link=null,delete this.graph.links[b],(l=this.graph)==null||l.onGraphChanged({action:"disconnectOutput",doSave:d.doProcessChange}),(p=o.onConnectionsChange)==null||p.call(o,LiteGraph$5.INPUT,G.target_slot,!1,G,L),(h=this.onConnectionsChange)==null||h.call(this,LiteGraph$5.OUTPUT,n,!1,G,f),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,this,n),this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,this,n),this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,o,G.target_slot));break}}}else{for(let g=0,_=f.links.length;g<_;g++){let b=f.links[g],G=this.graph.links[b];G&&(o=this.graph.getNodeById(G.target_id),L=null,(c=this.graph)==null||c.onGraphChanged({action:"disconnectOutput",doSave:d.doProcessChange}),o&&(L=o.inputs[G.target_slot],L.link=null,o.onConnectionsChange&&o.onConnectionsChange(LiteGraph$5.INPUT,G.target_slot,!1,G,L),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,o,G.target_slot)),delete this.graph.links[b],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$5.OUTPUT,n,!1,G,f),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,this,n),this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,o,G.target_slot)))}f.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0},disconnectInput(n,o={}){var s,a,r,l={doProcessChange:!0},p=Object.assign(l,o);if(n.constructor===String){if(n=this.findInputSlot(n),n==-1)return(s=LiteGraph$5.log)==null||s.call(LiteGraph$5,`Connect: Error, no slot of name ${n}`),!1}else if(!this.inputs||n>=this.inputs.length)return(a=LiteGraph$5.log)==null||a.call(LiteGraph$5,"Connect: Error, slot number not found"),!1;var h=this.inputs[n];if(!h)return!1;var c=this.inputs[n].link;if(c!=null){this.inputs[n].link=null;var u=this.graph.links[c];if(u){var d=this.graph.getNodeById(u.origin_id);if(!d)return!1;var f=d.outputs[u.origin_slot];if(!f||!f.links||f.links.length==0)return!1;for(var L=0,g=f.links.length;L<g;L++)if(f.links[L]==c){f.links.splice(L,1);break}delete this.graph.links[c],(r=this.graph)==null||r.onGraphChanged({action:"disconnectInput",doSave:p.doProcessChange}),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph$5.INPUT,n,!1,u,h),d.onConnectionsChange&&d.onConnectionsChange(LiteGraph$5.OUTPUT,L,!1,u,f),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph$5.OUTPUT,d,L),this.graph.onNodeConnectionChange(LiteGraph$5.INPUT,this,n))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0}};let LiteGraph$4=null;function setGeometryHitMethodsLiteGraph(n){LiteGraph$4=n}const geometryHitMethods={computeSize(n){if(this.constructor.size)return this.constructor.size.concat();var o=n||new Float32Array([0,0]),s=LiteGraph$4.NODE_TEXT_SIZE;const a=f=>f?s*f.length*.6:0;var r=a(this.title),l=0,p=0;this.inputs&&(l=this.inputs.reduce((f,L)=>{const g=L.label||L.name||"",_=a(g);return Math.max(f,_)},0)),this.outputs&&(p=this.outputs.reduce((f,L)=>{const g=L.label||L.name||"",_=a(g);return Math.max(f,_)},0)),o[0]=Math.max(l+p+10,r),o[0]=Math.max(o[0],LiteGraph$4.NODE_WIDTH),this.widgets&&this.widgets.length&&(o[0]=Math.max(o[0],LiteGraph$4.NODE_WIDTH*1.5));const h=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1,1)*LiteGraph$4.NODE_SLOT_HEIGHT;o[1]=h+(this.constructor.slot_start_y||0);let c=0;if(this.widgets&&this.widgets.length){for(var u=0,d=this.widgets.length;u<d;++u)this.widgets[u].computeSize?c+=this.widgets[u].computeSize(o[0])[1]+4:c+=LiteGraph$4.NODE_WIDGET_HEIGHT+4;c+=8}return this.widgets_up?o[1]=Math.max(o[1],c):this.widgets_start_y!=null?o[1]=Math.max(o[1],c+this.widgets_start_y):o[1]+=c,this.constructor.min_height&&o[1]<this.constructor.min_height&&(o[1]=this.constructor.min_height),o[1]+=6,o},getBounding(n=new Float32Array(4),o){const s=this.pos,a=this.flags.collapsed,r=this.size;let l=0,p=1,h=0,c=0;return o&&(l=4,p=6+l,h=4,c=5+h),n[0]=s[0]-l,n[1]=s[1]-LiteGraph$4.NODE_TITLE_HEIGHT-h,n[2]=a?(this._collapsed_width||LiteGraph$4.NODE_COLLAPSED_WIDTH)+p:r[0]+p,n[3]=a?LiteGraph$4.NODE_TITLE_HEIGHT+c:r[1]+LiteGraph$4.NODE_TITLE_HEIGHT+c,this.onBounding&&this.onBounding(n),n},isPointInside(n,o,s=0,a){var r=this.graph&&this.graph.isLive()?0:LiteGraph$4.NODE_TITLE_HEIGHT;if(a&&(r=0),this.flags&&this.flags.collapsed){if(LiteGraph$4.isInsideRectangle(n,o,this.pos[0]-s,this.pos[1]-LiteGraph$4.NODE_TITLE_HEIGHT-s,(this._collapsed_width||LiteGraph$4.NODE_COLLAPSED_WIDTH)+2*s,LiteGraph$4.NODE_TITLE_HEIGHT+2*s))return!0}else if(this.pos[0]-4-s<n&&this.pos[0]+this.size[0]+4+s>n&&this.pos[1]-r-s<o&&this.pos[1]+this.size[1]+s>o)return!0;return!1},getConnectionPos(n,o,s=new Float32Array(2)){var a=0;n&&this.inputs&&(a=this.inputs.length),!n&&this.outputs&&(a=this.outputs.length);var r=LiteGraph$4.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var l=this._collapsed_width||LiteGraph$4.NODE_COLLAPSED_WIDTH;return this.horizontal?(s[0]=this.pos[0]+l*.5,n?s[1]=this.pos[1]-LiteGraph$4.NODE_TITLE_HEIGHT:s[1]=this.pos[1]):(n?s[0]=this.pos[0]:s[0]=this.pos[0]+l,s[1]=this.pos[1]-LiteGraph$4.NODE_TITLE_HEIGHT*.5),s}return n&&o==-1?(s[0]=this.pos[0]+LiteGraph$4.NODE_TITLE_HEIGHT*.5,s[1]=this.pos[1]+LiteGraph$4.NODE_TITLE_HEIGHT*.5,s):n&&a>o&&this.inputs[o].pos?(s[0]=this.pos[0]+this.inputs[o].pos[0],s[1]=this.pos[1]+this.inputs[o].pos[1],s):!n&&a>o&&this.outputs[o].pos?(s[0]=this.pos[0]+this.outputs[o].pos[0],s[1]=this.pos[1]+this.outputs[o].pos[1],s):this.horizontal?(s[0]=this.pos[0]+(o+.5)*(this.size[0]/a),n?s[1]=this.pos[1]-LiteGraph$4.NODE_TITLE_HEIGHT:s[1]=this.pos[1]+this.size[1],s):(n?s[0]=this.pos[0]+r:s[0]=this.pos[0]+this.size[0]+1-r,s[1]=this.pos[1]+(o+.7)*LiteGraph$4.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),s)},localToScreen(n,o,s){return[(n+this.pos[0])*s.scale+s.offset[0],(o+this.pos[1])*s.scale+s.offset[1]]}};let LiteGraph$3=null;function setCanvasIntegrationMethodsLiteGraph(n){LiteGraph$3=n}const canvasIntegrationMethods={trace(n){var o,s,a,r;this.console||(this.console=[]),(s=(o=this.console).push)==null||s.call(o,n),this.console.length>this.constructor.MAX_CONSOLE&&((r=(a=this.console).shift)==null||r.call(a)),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,n)},setDirtyCanvas(n,o){this.graph&&this.graph.sendActionToCanvas("setDirty",[n,o])},loadImage(n){var o=new Image;o.src=LiteGraph$3.node_images_path+n,o.ready=!1;var s=this;return o.onload=function(){this.ready=!0,s.setDirtyCanvas(!0)},o},captureInput(n){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var o=this.graph.list_of_graphcanvas,s=0;s<o.length;++s){var a=o[s];!n&&a.node_capturing_input!=this||(a.node_capturing_input=n?this:null)}},collapse(n){this.graph.onGraphChanged({action:"collapse"}),!(this.constructor.collapsable===!1&&!n)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))},pin(n){this.graph.onGraphChanged({action:"pin"}),n===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=n}};let LiteGraph$2=null;function setAncestorRefreshMethodsLiteGraph(n){LiteGraph$2=n}const ancestorRefreshMethods={refreshAncestors(n={}){var o={action:"",param:null,options:null,passParam:!0},s=Object.assign(o,n);if(this.inputs&&!(LiteGraph$2.preventAncestorRecalculation&&this.graph.node_ancestorsCalculated&&this.graph.node_ancestorsCalculated[this.id])){(!s.action||s.action=="")&&(s.action=this.id+"_ancestors"),(!s.param||s.param=="")&&(s.param=this.id+"_ancestors"),s.options||(s.options={}),s.options=Object.assign({action_call:s.action},s.options),this.graph.ancestorsCall=!0;var a={modesSkip:[LiteGraph$2.NEVER,LiteGraph$2.ON_EVENT,LiteGraph$2.ON_TRIGGER],modesOnly:[LiteGraph$2.ALWAYS,LiteGraph$2.ON_REQUEST],typesSkip:[LiteGraph$2.ACTION],typesOnly:[]},r=this.graph.getAncestors(this,a);for(iN in r)r[iN].doExecute(s.param,s.options),this.graph.node_ancestorsCalculated[r[iN].id]=!0;return this.graph.ancestorsCall=!1,this.graph.node_ancestorsCalculated[this.id]=!0,!0}}};let LiteGraph$1=null;function setMiscMethodsLiteGraph(n){LiteGraph$1=n}const miscMethods={alignToGrid(){this.pos[0]=LiteGraph$1.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph$1.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph$1.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph$1.CANVAS_GRID_SIZE)}};function installLGraphNodeDelegates(n,o){setLifecycleSerializationMethodsLiteGraph(o),setPropertiesWidgetsMethodsLiteGraph(o),setExecutionActionsMethodsLiteGraph(o),setSlotsMutationMethodsLiteGraph(o),setSlotsQueryMethodsLiteGraph(o),setConnectionsMethodsLiteGraph(o),setGeometryHitMethodsLiteGraph(o),setCanvasIntegrationMethodsLiteGraph(o),setAncestorRefreshMethodsLiteGraph(o),setMiscMethodsLiteGraph(o),[lifecycleSerializationMethods,propertiesWidgetsMethods,ioDataMethods,executionActionsMethods,slotsMutationMethods,slotsQueryMethods,connectionsMethods,geometryHitMethods,canvasIntegrationMethods,ancestorRefreshMethods,miscMethods].forEach(s=>{Object.entries(s).forEach(([a,r])=>{Object.defineProperty(n.prototype,a,{value:r,writable:!0,configurable:!0})})})}class LGraphNode{constructor(o="Unnamed"){this.title=o,this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}}set pos(o){var s;!o||o.length<2||((s=this._pos)!=null||(this._pos=new Float32Array(10,10)),this._pos[0]=o[0],this._pos[1]=o[1])}get pos(){return this._pos}}function setupLGraphNodeDelegates(n=LiteGraph){installLGraphNodeDelegates(LGraphNode,n)}class LGraphGroup{constructor(o="Group"){H(this,"isPointInside",LiteGraph.LGraphNode.prototype.isPointInside),H(this,"setDirtyCanvas",LiteGraph.LGraphNode.prototype.setDirtyCanvas);var s,a;this.title=o,this.font_size=24,this.color=(a=(s=LiteGraph.LGraphCanvas.node_colors.pale_blue)==null?void 0:s.groupcolor)!=null?a:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null}set pos(o){!o||o.length<2||(this._pos[0]=o[0],this._pos[1]=o[1])}get pos(){return this._pos}set size(o){!o||o.length<2||(this._size[0]=Math.max(140,o[0]),this._size[1]=Math.max(80,o[1]))}get size(){return this._size}configure(o){this.title=o.title,this._bounding.set(o.bounding),this.color=o.color,o.font_size&&(this.font_size=o.font_size)}serialize(){var o=this._bounding;return{title:this.title,bounding:o.map(s=>Math.round(s)),color:this.color,font_size:this.font_size}}move(o,s,a){var r,l;isNaN(o)&&((r=console.error)==null||r.call(console,"LGraphGroup.move() deltax NaN")),isNaN(s)&&((l=console.error)==null||l.call(console,"LGraphGroup.move() deltay NaN")),this._pos[0]+=o,this._pos[1]+=s,!a&&this._nodes.forEach(p=>{p.pos[0]+=o,p.pos[1]+=s})}recomputeInsideNodes(){this._nodes.length=0;var o=this.graph._nodes,s=new Float32Array(4);this._nodes=o.filter(a=>(a.getBounding(s),LiteGraph.overlapBounding(this._bounding,s)))}}function clear(){var n;this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.low_quality_rendering_counter=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),(n=this.onClear)==null||n.call(this)}function setGraph(n,o){var s;if(this.graph!=n){if(o||this.clear(),!n){(s=this.graph)==null||s.detachCanvas(this);return}n.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}}function getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}function openSubgraph(n){if(!n)throw new Error("graph cannot be null");if(this.graph==n)throw new Error("graph cannot be the same");this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),n.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)}function closeSubgraph(){if(!(!this._graph_stack||this._graph_stack.length==0)){var n=this.graph._subgraph_node,o=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},o.attachCanvas(this),this.setDirty(!0,!0),n&&(this.centerOnNode(n),this.selectNodes([n])),this.ds.offset=[0,0],this.ds.scale=1}}function getCurrentGraph(){return this.graph}function setCanvas(n,o){var s;if(n&&n.constructor===String&&(n=document.getElementById(n),!n))throw new Error("Error creating LiteGraph canvas: Canvas not found");if(n!==this.canvas&&(!n&&this.canvas&&(o||this.unbindEvents()),this.canvas=n,this.ds.element=n,!!n)){if(n.className+=" lgraphcanvas",n.data=this,n.tabindex="1",this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,n.getContext==null)throw n.localName!="canvas"?new Error("Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+n.localName):new Error("This browser doesn't support Canvas");var a=this.ctx=n.getContext("2d");a==null&&(n.webgl_enabled||(s=LiteGraph.info)==null||s.call(LiteGraph,"This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),o||this.bindEvents()}}function _doNothing(n){return n.preventDefault(),!1}function _doReturnTrue(n){return n.preventDefault(),!0}function bindEvents(){var n;if(this._events_binded){(n=LiteGraph.warn)==null||n.call(LiteGraph,"LGraphCanvas: events already binded");return}this._events_binded=!0;var o=this.canvas,s=this.getCanvasWindow(),a=s.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),o.addEventListener("pointerdown",this._mousedown_callback,!0),o.addEventListener("pointermove",this._mousemove_callback),o.addEventListener("pointerup",this._mouseup_callback,!0),o.addEventListener("contextmenu",this._doNothing),o.addEventListener("wheel",this.processMouseWheel),o.addEventListener("keydown",this.processKey),a.addEventListener("keyup",this.processKey),o.addEventListener("dragover",this._doNothing,!1),o.addEventListener("dragend",this._doNothing,!1),o.addEventListener("drop",this.processDrop),o.addEventListener("dragenter",this._doReturnTrue,!1)}function unbindEvents(){var n;if(!this._events_binded){(n=LiteGraph.warn)==null||n.call(LiteGraph,"LGraphCanvas: no events binded");return}this._events_binded=!1;var o=this.canvas,s=this.getCanvasWindow(),a=s.document;o.removeEventListener("pointerdown",this._mousedown_callback),o.removeEventListener("pointermove",this._mousemove_callback),o.removeEventListener("pointerup",this._mouseup_callback),o.removeEventListener("contextmenu",this._doNothing),o.removeEventListener("wheel",this.processMouseWheel),o.removeEventListener("keydown",this.processKey),a.removeEventListener("keyup",this.processKey),o.removeEventListener("dragover",this._doNothing,!1),o.removeEventListener("dragend",this._doNothing,!1),o.removeEventListener("drop",this.processDrop),o.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null}function enableWebGL(){if(typeof GL=="undefined")throw new Error("litegl.js must be included to use a WebGL canvas");if(typeof enableWebGLCanvas=="undefined")throw new Error("webglCanvas.js must be included to use this feature");this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0}function setDirty(n,o){n&&(this.dirty_canvas=!0),o&&(this.dirty_bgcanvas=!0)}function getCanvasWindow(){var n;if(!this.canvas)return window;var o=this.canvas.ownerDocument;return(n=o.defaultView)!=null?n:o.parentWindow}function startRendering(){if(this.is_rendering)return;this.is_rendering=!0,n.call(this);function n(){this.pause_rendering||this.draw();var o=this.getCanvasWindow();this.is_rendering&&o.requestAnimationFrame(n.bind(this))}}function stopRendering(){this.is_rendering=!1}function resize(n,o){if(!n&&!o){var s=this.canvas.parentNode;n=s.offsetWidth,o=s.offsetHeight}this.canvas.width==n&&this.canvas.height==o||(this.canvas.width=n,this.canvas.height=o,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))}function switchLiveMode(n){if(!n){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var o=this,s=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var a=setInterval(function(){o.editor_alpha*=s,o.dirty_canvas=!0,o.dirty_bgcanvas=!0,s<1&&o.editor_alpha<.01&&(clearInterval(a),s<1&&(o.live_mode=!0)),s>1&&o.editor_alpha>.99&&(clearInterval(a),o.editor_alpha=1)},1)}function centerOnNode(n){this.ds.offset[0]=-n.pos[0]-n.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-n.pos[1]-n.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)}function adjustMouseEvent(n){var o=0,s=0;if(this.canvas){var a=this.canvas.getBoundingClientRect();o=n.clientX-a.left,s=n.clientY-a.top}else o=n.clientX,s=n.clientY;this.last_mouse_position[0]=o,this.last_mouse_position[1]=s,n.canvasX=o/this.ds.scale-this.ds.offset[0],n.canvasY=s/this.ds.scale-this.ds.offset[1]}function setZoom(n,o){this.ds.changeScale(n,o),this.dirty_canvas=!0,this.dirty_bgcanvas=!0}function convertOffsetToCanvas(n,o){return this.ds.convertOffsetToCanvas(n,o)}function convertCanvasToOffset(n,o){return this.ds.convertCanvasToOffset(n,o)}function convertEventToCanvasOffset(n){var o=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([n.clientX-o.left,n.clientY-o.top])}const temp=new Float32Array(4),temp_vec2=new Float32Array(2),tmp_area=new Float32Array(4),margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);function isOverNodeBox(n,o,s){var a=LiteGraph.NODE_TITLE_HEIGHT;return!!LiteGraph.isInsideRectangle(o,s,n.pos[0]+2,n.pos[1]+2-a,a-4,a-4)}function isOverNodeInput(n,o,s,a){if(n.inputs)for(let p=0,h=n.inputs.length;p<h;++p){var r=n.getConnectionPos(!0,p),l=!1;if(n.horizontal?l=LiteGraph.isInsideRectangle(o,s,r[0]-5,r[1]-10,10,20):l=LiteGraph.isInsideRectangle(o,s,r[0]-10,r[1]-5,40,10),l)return a&&(a[0]=r[0],a[1]=r[1]),p}return-1}function isOverNodeOutput(n,o,s,a){if(n.outputs)for(let p=0,h=n.outputs.length;p<h;++p){var r=n.getConnectionPos(!1,p),l=!1;if(n.horizontal?l=LiteGraph.isInsideRectangle(o,s,r[0]-5,r[1]-10,10,20):l=LiteGraph.isInsideRectangle(o,s,r[0]-10,r[1]-5,40,10),l)return a&&(a[0]=r[0],a[1]=r[1]),p}return-1}function bringToFront(n){var o=this.graph._nodes.indexOf(n);o!=-1&&(this.graph._nodes.splice(o,1),this.graph._nodes.push(n))}function sendToBack(n){var o=this.graph._nodes.indexOf(n);o!=-1&&(this.graph._nodes.splice(o,1),this.graph._nodes.unshift(n))}function computeVisibleNodes(n,o){var s=o||[];s.length=0,n=n||this.graph._nodes;for(var a=0,r=n.length;a<r;++a){var l=n[a];this.live_mode&&!l.onDrawBackground&&!l.onDrawForeground||LiteGraph.overlapBounding(this.visible_area,l.getBounding(temp,!0))&&s.push(l)}return s}class CoreController{constructor(o){this.host=o}clear(...o){return clear.apply(this.host,o)}setGraph(...o){return setGraph.apply(this.host,o)}getTopGraph(...o){return getTopGraph.apply(this.host,o)}openSubgraph(...o){return openSubgraph.apply(this.host,o)}closeSubgraph(...o){return closeSubgraph.apply(this.host,o)}getCurrentGraph(...o){return getCurrentGraph.apply(this.host,o)}setCanvas(...o){return setCanvas.apply(this.host,o)}_doNothing(...o){return _doNothing.apply(this.host,o)}_doReturnTrue(...o){return _doReturnTrue.apply(this.host,o)}bindEvents(...o){return bindEvents.apply(this.host,o)}unbindEvents(...o){return unbindEvents.apply(this.host,o)}enableWebGL(...o){return enableWebGL.apply(this.host,o)}setDirty(...o){return setDirty.apply(this.host,o)}getCanvasWindow(...o){return getCanvasWindow.apply(this.host,o)}startRendering(...o){return startRendering.apply(this.host,o)}stopRendering(...o){return stopRendering.apply(this.host,o)}resize(...o){return resize.apply(this.host,o)}switchLiveMode(...o){return switchLiveMode.apply(this.host,o)}centerOnNode(...o){return centerOnNode.apply(this.host,o)}adjustMouseEvent(...o){return adjustMouseEvent.apply(this.host,o)}setZoom(...o){return setZoom.apply(this.host,o)}convertOffsetToCanvas(...o){return convertOffsetToCanvas.apply(this.host,o)}convertCanvasToOffset(...o){return convertCanvasToOffset.apply(this.host,o)}convertEventToCanvasOffset(...o){return convertEventToCanvasOffset.apply(this.host,o)}isOverNodeBox(...o){return isOverNodeBox.apply(this.host,o)}isOverNodeInput(...o){return isOverNodeInput.apply(this.host,o)}isOverNodeOutput(...o){return isOverNodeOutput.apply(this.host,o)}bringToFront(...o){return bringToFront.apply(this.host,o)}sendToBack(...o){return sendToBack.apply(this.host,o)}computeVisibleNodes(...o){return computeVisibleNodes.apply(this.host,o)}}function processUserInputDown(n){var o,s;if(this.pointer_is_down&&n.isPrimary!==void 0&&!n.isPrimary?this.userInput_isNotPrimary=!0:this.userInput_isNotPrimary=!1,this.userInput_type=n.pointerType?n.pointerType:!1,this.userInput_id=n.pointerId?n.pointerId:!1,n.pointerType)switch(n.pointerType){case"mouse":break;case"pen":break;case"touch":break;default:(o=LiteGraph.log)==null||o.call(LiteGraph,"pointerType unknown "+ev.pointerType)}return n.button!==void 0&&(this.userInput_button=n.button,n.button),n.buttons!==void 0&&(this.userInput_button_s=n.buttons),this.userInput_touches=n.changedTouches!==void 0&&n.changedTouches.length!==void 0?n.changedTouches:!1,this.userInput_touches&&this.userInput_touches.length&&((s=LiteGraph.debug)==null||s.call(LiteGraph,"check multiTouches",n.changedTouches)),this.processMouseDown(n)}function processMouseDown(n){var o,s,a,r,l,p,h,c,u;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(n);var d=this.getCanvasWindow();LGraphCanvas.active_canvas=this;var f=n.clientX,L=n.clientY;(o=LiteGraph.log)==null||o.call(LiteGraph,"pointerevents: processMouseDown pointerId:"+n.pointerId+" which:"+n.which+" isPrimary:"+n.isPrimary+" :: x y "+f+" "+L,"previousClick",this.last_mouseclick,"diffTimeClick",this.last_mouseclick?LiteGraph.getTime()-this.last_mouseclick:"notlast"),this.ds.viewport=this.viewport;var g=!this.viewport||this.viewport&&f>=this.viewport[0]&&f<this.viewport[0]+this.viewport[2]&&L>=this.viewport[1]&&L<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(this.canvas.removeEventListener("pointermove",this._mousemove_callback),d.document.addEventListener("pointermove",this._mousemove_callback,!0),d.document.addEventListener("pointerup",this._mouseup_callback,!0)),!!g){var _=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes,5),b=!1,G=LiteGraph.getTime(),C=n.isPrimary===void 0||n.isPrimary,T=G-this.last_mouseclick<300&&C;if(this.mouse[0]=n.clientX,this.mouse[1]=n.clientY,this.graph_mouse[0]=n.canvasX,this.graph_mouse[1]=n.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&C?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.ContextMenu.closeAll(d),!((s=this.onMouse)!=null&&s.call(this,n))){if(n.which==1&&!this.userInput_isNotPrimary){if(n.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=n.canvasX,this.dragging_rectangle[1]=n.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,b=!0),LiteGraph.alt_drag_do_clone_nodes&&n.altKey&&_&&this.allow_interaction&&!b&&!this.read_only){let M=_,W=_.clone();if(W){if(W.pos[0]+=5,W.pos[1]+=5,this.graph.add(W,!1,{doCalcSize:!1}),_=W,LiteGraph.alt_shift_drag_connect_clone_with_input&&n.shiftKey&&M.inputs&&M.inputs.length)for(var E=0;E<M.inputs.length;++E){var N=M.inputs[E];if(!(!N||N.link==null)){var A=this.graph.links[N.link];if(A&&A.type!==LiteGraph.EVENT){var D;A.origin_id&&(D=this.graph.getNodeById(A.origin_id));var I=_;D&&I&&D.connect(A.origin_slot,I,A.target_slot)}}}b=!0,k||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=_),this.selected_nodes[_.id]||this.processNodeSelected(_,n))}}var O=!1;if(_&&(this.allow_interaction||_.flags.allow_interaction)&&!b&&!this.read_only){if(!this.live_mode&&!_.flags.pinned&&this.bringToFront(_),this.allow_interaction&&!this.connecting_node&&!_.flags.collapsed&&!this.live_mode)if(!b&&_.resizable!==!1&&LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,_.pos[0]+_.size[0]-5,_.pos[1]+_.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=_,this.canvas.style.cursor="se-resize",b=!0;else{if(_.outputs)for(let M=0,W=_.outputs.length;M<W;++M){let Y=_.outputs[M],F=_.getConnectionPos(!1,M);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,F[0]-15,F[1]-10,30,20)){this.connecting_node=_,this.connecting_output=Y,this.connecting_output.slot_index=M,this.connecting_pos=_.getConnectionPos(!1,M),this.connecting_slot=M,LiteGraph.shift_click_do_break_link_from&&n.shiftKey&&_.disconnectOutput(M),T?(a=_.onOutputDblClick)==null||a.call(_,M,n):(r=_.onOutputClick)==null||r.call(_,M,n),b=!0;break}}if(_.inputs)for(let M=0,W=_.inputs.length;M<W;++M){let Y=_.inputs[M],F=_.getConnectionPos(!0,M);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,F[0]-15,F[1]-10,30,20)){if(T?(l=_.onInputDblClick)==null||l.call(_,M,n):(p=_.onInputClick)==null||p.call(_,M,n),Y.link!==null){var S=this.graph.links[Y.link];LiteGraph.click_do_break_link_to&&(_.disconnectInput(M),this.dirty_bgcanvas=!0,b=!0),n.shiftKey&&(LiteGraph.click_do_break_link_to||_.disconnectInput(M),this.connecting_node=this.graph._nodes_by_id[S.origin_id],this.connecting_slot=S.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,b=!0)}b||(this.connecting_node=_,this.connecting_input=Y,this.connecting_input.slot_index=M,this.connecting_pos=_.getConnectionPos(!0,M),this.connecting_slot=M,this.dirty_bgcanvas=!0,b=!0)}}}if(!b){var k=!1,m=[n.canvasX-_.pos[0],n.canvasY-_.pos[1]],P=this.processNodeWidgets(_,this.graph_mouse,n);P&&(k=!0,this.node_widget=[_,P]),this.allow_interaction&&T&&this.selected_nodes[_.id]&&((h=_.onDblClick)==null||h.call(_,n,m,this),this.processNodeDblClicked(_),k=!0),_.onMouseDown&&_.onMouseDown(n,m,this)?k=!0:(_.subgraph&&!_.skip_subgraph_button&&!_.flags.collapsed&&m[0]>_.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&m[1]<0&&setTimeout(()=>{this.openSubgraph(_.subgraph)},10),this.live_mode&&(O=!0,k=!0)),k?_.is_selected||this.processNodeSelected(_,n):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=_),this.processNodeSelected(_,n)),this.dirty_canvas=!0}}else if(!b){if(!this.read_only)for(let M=0;M<this.visible_links.length;++M){var j=this.visible_links[M],V=j._pos;if(!(!V||n.canvasX<V[0]-4||n.canvasX>V[0]+4||n.canvasY<V[1]-4||n.canvasY>V[1]+4)){this.showLinkMenu(j,n),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(n.canvasX,n.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){n.ctrlKey&&(this.dragging_rectangle=null);var q=LiteGraph.distance([n.canvasX,n.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);q*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}T&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(n),n.preventDefault(),n.stopPropagation()),(c=LiteGraph.debug)==null||c.call(LiteGraph,"DEBUG canvas click is_double_click,this.allow_searchbox",T,this.allow_searchbox),O=!0}!b&&O&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(n.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(_&&this.allow_interaction&&!b&&!this.read_only&&!this.connecting_node&&!_.flags.collapsed&&!this.live_mode){var Z=!1,B=!1,R=!1;if(_.outputs)for(let M=0,W=_.outputs.length;M<W;++M){var U=_.outputs[M];let Y=_.getConnectionPos(!1,M);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,Y[0]-15,Y[1]-10,30,20)){Z=U,B=M,R=!0;break}}if(_.inputs)for(let M=0,W=_.inputs.length;M<W;++M){var N=_.inputs[M];let F=_.getConnectionPos(!0,M);if(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,F[0]-15,F[1]-10,30,20)){Z=N,B=M,R=!1;break}}if(Z&&B!==!1){var $=.5-(B+1)/(R?_.outputs.length:_.inputs.length),X=_.getBounding(),pe=[R?X[0]+X[2]:X[0],n.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:R?_:null,slotFrom:R?B:null,nodeTo:R?null:_,slotTo:R?null:B,position:pe,nodeType:"AUTO",posAdd:[R?30:-30,-$*130],posSizeFix:[R?0:-1,0]})}}}else!b&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(n.which==3||LiteGraph.two_fingers_opens_menu&&this.userInput_isNotPrimary)&&this.allow_interaction&&!b&&!this.read_only&&(_&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[_.id]||n.shiftKey||n.ctrlKey||n.metaKey)?this.selected_nodes[_.id]||this.selectNodes([_],!0):this.selectNodes([_])),this.processContextMenu(_,n));return this.last_mouse[0]=n.clientX,this.last_mouse[1]=n.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!d.document.activeElement||d.document.activeElement.nodeName.toLowerCase()!="input"&&d.document.activeElement.nodeName.toLowerCase()!="textarea")&&n.preventDefault(),n.stopPropagation(),(u=this.onMouseDown)==null||u.call(this,n),!1}}}}function processMouseMove(n){var o,s;if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){LGraphCanvas.active_canvas=this,this.adjustMouseEvent(n);var a=[n.clientX,n.clientY];this.mouse[0]=a[0],this.mouse[1]=a[1];var r=[a[0]-this.last_mouse[0],a[1]-this.last_mouse[1]];if(this.last_mouse=a,this.graph_mouse[0]=n.canvasX,this.graph_mouse[1]=n.canvasY,this.block_click)return n.preventDefault(),!1;n.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,n,this.node_widget[1]),this.dirty_canvas=!0);var l=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=n.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=n.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[n.canvasX-this.selected_group.pos[0],n.canvasY-this.selected_group.pos[1]];else{var p=r[0]/this.ds.scale,h=r[1]/this.ds.scale;this.selected_group.move(p,h,n.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=r[0]/this.ds.scale,this.ds.offset[1]+=r[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||l&&l.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(let g=0,_=this.graph._nodes.length;g<_;++g)this.graph._nodes[g].mouseOver&&l!=this.graph._nodes[g]&&(this.graph._nodes[g].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(n),this.node_over=null,this.dirty_canvas=!0);if(l){if(l.redraw_on_mouse&&(this.dirty_canvas=!0),l.mouseOver||(l.mouseOver=!0,this.node_over=l,this.dirty_canvas=!0,(o=l.onMouseEnter)==null||o.call(l,n)),(s=l.onMouseMove)==null||s.call(l,n,[n.canvasX-l.pos[0],n.canvasY-l.pos[1]],this),this.connecting_node){let g;if(this.connecting_output){if(g=this._highlight_input||[0,0],!this.isOverNodeBox(l,n.canvasX,n.canvasY)){let _=this.isOverNodeInput(l,n.canvasX,n.canvasY,g);if(_!=-1&&l.inputs[_]){let b=l.inputs[_].type;LiteGraph.isValidConnection(this.connecting_output.type,b)&&(this._highlight_input=g,this._highlight_input_slot=l.inputs[_])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input&&(g=this._highlight_output||[0,0],this.isOverNodeBox(l,n.canvasX,n.canvasY))){let _=this.isOverNodeOutput(l,n.canvasX,n.canvasY,g);if(_!=-1&&l.outputs[_]){let b=l.outputs[_].type;LiteGraph.isValidConnection(this.connecting_input.type,b)&&(this._highlight_output=g)}else this._highlight_output=null}}this.canvas&&(LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,l.pos[0]+l.size[0]-5,l.pos[1]+l.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var c=null;for(let g=0;g<this.visible_links.length;++g){var u=this.visible_links[g],d=u._pos;if(!(!d||n.canvasX<d[0]-4||n.canvasX>d[0]+4||n.canvasY<d[1]-4||n.canvasY>d[1]+4)){c=u;break}}c!=this.over_link_center&&(this.over_link_center=c,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=l&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(n,[n.canvasX-this.node_capturing_input.pos[0],n.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(let g in this.selected_nodes){let _=this.selected_nodes[g];_.pos[0]+=r[0]/this.ds.scale,_.pos[1]+=r[1]/this.ds.scale,_.is_selected||this.processNodeSelected(_,n)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var f=[n.canvasX-this.resizing_node.pos[0],n.canvasY-this.resizing_node.pos[1]],L=this.resizing_node.computeSize();f[0]=Math.max(L[0],f[0]),f[1]=Math.max(L[1],f[1]),this.resizing_node.setSize(f),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return n.preventDefault(),!1}}function processMouseUp(n){var o,s=n.isPrimary===void 0||n.isPrimary;if(!s)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var a=this.getCanvasWindow(),r=a.document;LGraphCanvas.active_canvas=this,this.options.skip_events||(r.removeEventListener("pointermove",this._mousemove_callback,!0),this.canvas.addEventListener("pointermove",this._mousemove_callback,!0),r.removeEventListener("pointerup",this._mouseup_callback,!0)),this.adjustMouseEvent(n);var l=LiteGraph.getTime();if(n.click_time=l-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),n.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,n),this.node_widget=null,this.selected_group){var p=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),h=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(p,h,n.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var c=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var u=this.graph._nodes,d=new Float32Array(4),f=Math.abs(this.dragging_rectangle[2]),L=Math.abs(this.dragging_rectangle[3]),g=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-f:this.dragging_rectangle[0],_=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-L:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=g,this.dragging_rectangle[1]=_,this.dragging_rectangle[2]=f,this.dragging_rectangle[3]=L,!c||f>10&&L>10){var b=[];for(let E=0;E<u.length;++E){var G=u[E];G.getBounding(d),LiteGraph.overlapBounding(this.dragging_rectangle,d)&&b.push(G)}b.length&&this.selectNodes(b,n.shiftKey)}else this.selectNodes([c],n.shiftKey||n.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var C=this.connecting_output||this.connecting_input,T=C.type;if(c=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes),c){let E;this.connecting_output?(E=this.isOverNodeInput(c,n.canvasX,n.canvasY),E!=-1?this.connecting_node.connect(this.connecting_slot,c,E):this.connecting_node.connectByType(this.connecting_slot,c,T)):this.connecting_input&&(E=this.isOverNodeOutput(c,n.canvasX,n.canvasY),E!=-1?c.connect(E,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,c,T))}else LiteGraph.release_link_on_empty_shows_menu&&(n.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(n,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(n,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:n}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:n}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null):this.node_dragged?(c=this.node_dragged,c&&n.click_time<300&&LiteGraph.isInsideRectangle(n.canvasX,n.canvasY,c.pos[0],c.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&c.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),(o=this.onNodeMoved)==null||o.call(this,this.node_dragged),this.graph.onGraphChanged({action:"nodeDrag",doSave:!0}),this.graph.afterChange(this.node_dragged),this.node_dragged=null):(c=this.graph.getNodeOnPos(n.canvasX,n.canvasY,this.visible_nodes),!c&&n.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(n,[n.canvasX-this.node_over.pos[0],n.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(n,[n.canvasX-this.node_capturing_input.pos[0],n.canvasY-this.node_capturing_input.pos[1]]))}else n.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):n.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return s&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),n.stopPropagation(),n.preventDefault(),!1}}function processMouseWheel(n){if(!(!this.graph||!this.allow_dragcanvas)){var o=n.wheelDeltaY!=null?n.wheelDeltaY:n.detail*-60;this.adjustMouseEvent(n);var s=n.clientX,a=n.clientY,r=!this.viewport||this.viewport&&s>=this.viewport[0]&&s<this.viewport[0]+this.viewport[2]&&a>=this.viewport[1]&&a<this.viewport[1]+this.viewport[3];if(r){var l=this.ds.scale;return l*=Math.pow(1.1,o*.01),this.ds.changeScale(l,[n.clientX,n.clientY]),this.graph.change(),n.preventDefault(),!1}}}function blockClick(){this.block_click=!0,this.last_mouseclick=0}function processKey(n){var o,s,a,r,l;if(this.graph){var p=!1;if(n.target.localName!="input"){if(n.type=="keydown"){if(n.keyCode==32&&(this.dragging_canvas=!0,p=!0),n.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),p=!0),n.keyCode==65&&n.ctrlKey&&(this.selectNodes(),p=!0),n.keyCode===67&&(n.metaKey||n.ctrlKey)&&!n.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),p=!0),n.keyCode===86&&(n.metaKey||n.ctrlKey)&&this.pasteFromClipboard(n.shiftKey),(n.keyCode==46||LiteGraph.backspace_delete&&n.keyCode==8)&&n.target.localName!="input"&&n.target.localName!="textarea"&&(this.deleteSelectedNodes(),p=!0),LiteGraph.actionHistory_enabled&&(n.keyCode==89&&n.ctrlKey||n.keyCode==90&&n.ctrlKey&&n.shiftKey?this.graph.actionHistoryForward():n.keyCode==90&&n.ctrlKey&&this.graph.actionHistoryBack()),(o=LiteGraph.debug)==null||o.call(LiteGraph,"Canvas keydown "+n.keyCode),this.selected_nodes)for(let h in this.selected_nodes)(a=(s=this.selected_nodes[h]).onKeyDown)==null||a.call(s,n)}else if(n.type=="keyup"&&(n.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(let h in this.selected_nodes)(l=(r=this.selected_nodes[h]).onKeyUp)==null||l.call(r,n);if(this.graph.change(),p)return n.preventDefault(),n.stopImmediatePropagation(),!1}}}function processDrop(n){n.preventDefault(),this.adjustMouseEvent(n);var o=n.clientX,s=n.clientY,a=!this.viewport||this.viewport&&o>=this.viewport[0]&&o<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3];if(a){o=n.localX,s=n.localY;var a=!this.viewport||this.viewport&&o>=this.viewport[0]&&o<this.viewport[0]+this.viewport[2]&&s>=this.viewport[1]&&s<this.viewport[1]+this.viewport[3];if(a){var r=[n.canvasX,n.canvasY],l=this.graph?this.graph.getNodeOnPos(r[0],r[1]):null;if(!l){var p=null;this.onDropItem&&(p=this.onDropItem(event)),p||this.checkDropItem(n);return}if(l.onDropFile||l.onDropData){var h=n.dataTransfer.files;if(h&&h.length)for(let g=0;g<h.length;g++){var c=n.dataTransfer.files[0],u=c.name;if(l.onDropFile&&l.onDropFile(c),l.onDropData){var d=new FileReader;d.onload=function(_){var b=_.target.result;l.onDropData(b,u,c)};var f=c.type.split("/")[0];f=="text"||f==""?d.readAsText(c):f=="image"?d.readAsDataURL(c):d.readAsArrayBuffer(c)}}}return l.onDropItem&&l.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}}}function checkDropItem(n){var o;if(n.dataTransfer.files.length){var s=n.dataTransfer.files[0],a=LGraphCanvas.getFileExtension(s.name).toLowerCase(),r=LiteGraph.node_types_by_file_extension[a];if(r){this.graph.beforeChange();var l=LiteGraph.createNode(r.type);l.pos=[n.canvasX,n.canvasY],this.graph.add(l,!1,{doProcessChange:!1}),(o=l.onDropFile)==null||o.call(l,s),this.graph.onGraphChanged({action:"fileDrop",doSave:!0}),this.graph.afterChange()}}}class EventsController{constructor(o){this.host=o}processUserInputDown(...o){return processUserInputDown.apply(this.host,o)}processMouseDown(...o){return processMouseDown.apply(this.host,o)}processMouseMove(...o){return processMouseMove.apply(this.host,o)}processMouseUp(...o){return processMouseUp.apply(this.host,o)}processMouseWheel(...o){return processMouseWheel.apply(this.host,o)}blockClick(...o){return blockClick.apply(this.host,o)}processKey(...o){return processKey.apply(this.host,o)}processDrop(...o){return processDrop.apply(this.host,o)}checkDropItem(...o){return checkDropItem.apply(this.host,o)}}function draw(n,o){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var s=LiteGraph.getTime();this.render_time=(s-this.last_draw_time)*.001,this.last_draw_time=s,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||o||this.always_render_background||this.graph&&this.graph._last_trigger_time&&s-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas();var a=this.dirty_canvas||n;if(a&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1,this.ds.scale<.7){if(a){var r=this.low_quality_rendering_threshold;const l=45;this.fps<l?(this.low_quality_rendering_counter+=l/this.fps,this.low_quality_rendering_counter=Math.min(this.low_quality_rendering_counter,2*r)):(this.low_quality_rendering_counter-=this.fps/l*.01,this.low_quality_rendering_counter=Math.max(this.low_quality_rendering_counter,0))}}else this.low_quality_rendering_counter=0}}function drawFrontCanvas(){var n,o,s,a,r;this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var l=this.ctx;if(l){var p=this.canvas;l.start2D&&!this.viewport&&(l.start2D(),l.restore(),l.setTransform(1,0,0,1,0,0));var h=this.viewport||this.dirty_area;if(h&&(l.save(),l.beginPath(),l.rect(h[0],h[1],h[2],h[3]),l.clip()),this.clear_background&&(h?l.clearRect(h[0],h[1],h[2],h[3]):l.clearRect(0,0,p.width,p.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():l.drawImage(this.bgcanvas,0,0),(n=this.onRender)==null||n.call(this,p,l),this.show_info&&this.renderInfo(l,h?h[0]:0,h?h[1]:0),this.graph){l.save(),this.ds.toCanvasContext(l);var c=this.computeVisibleNodes(null,this.visible_nodes);for(let b=0;b<c.length;++b){let G=c[b];l.save(),l.translate(G.pos[0],G.pos[1]),this.drawNode(G,l),l.restore()}if(this.render_execution_order&&this.drawExecutionOrder(l),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(l)),this.connecting_pos!=null){l.lineWidth=this.connections_width;var u=null,d=this.connecting_output||this.connecting_input,f=d.type,L=d.dir;L==null&&(this.connecting_output?L=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:L=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var g=d.shape;switch(f){case LiteGraph.EVENT:case LiteGraph.ACTION:u=LiteGraph.EVENT_LINK_COLOR;break;default:u=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(l,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,u,L,LiteGraph.CENTER),l.beginPath(),f===LiteGraph.EVENT||f===LiteGraph.ACTION||g===LiteGraph.BOX_SHAPE?(l.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),l.fill(),l.beginPath(),l.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):g===LiteGraph.ARROW_SHAPE?(l.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),l.closePath()):(l.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),l.fill(),l.beginPath(),l.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),l.fill(),l.fillStyle="#ffcc00",this._highlight_input){l.beginPath();var _=this._highlight_input_slot.shape;_===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),l.closePath()):l.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),l.fill()}this._highlight_output&&(l.beginPath(),_===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),l.closePath()):l.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),l.fill())}this.dragging_rectangle&&(l.strokeStyle="#FFF",l.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(l,this.over_link_center):(o=this.onDrawLinkTooltip)==null||o.call(this,l,null),(s=this.onDrawForeground)==null||s.call(this,l,this.visible_rect),l.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(l),(a=this.onDrawOverlay)==null||a.call(this,l),h&&l.restore(),(r=l.finish2D)==null||r.call(l)}}function lowQualityRenderingRequired(n){return this.ds.scale<n?this.low_quality_rendering_counter>this.low_quality_rendering_threshold:!1}function drawNode(n,o){var s,a,r;this.current_node=n;var l=n.color||n.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,p=n.bgcolor||n.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR,h=this.ds.scale<.6;if(this.live_mode){n.flags.collapsed||(o.shadowColor="transparent",(s=n.onDrawForeground)==null||s.call(n,o,this,this.canvas));return}var c=this.editor_alpha;if(o.globalAlpha=c,this.render_shadows&&!h?(o.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,o.shadowOffsetX=2*this.ds.scale,o.shadowOffsetY=2*this.ds.scale,o.shadowBlur=3*this.ds.scale):o.shadowColor="transparent",!(n.flags.collapsed&&(a=n.onDrawCollapsed)!=null&&a.call(n,o,this))){var u=n._shape||LiteGraph.BOX_SHAPE,d=temp_vec2;temp_vec2.set(n.size);var f=n.horizontal;if(n.flags.collapsed){o.font=this.inner_text_font;var L=n.getTitle?n.getTitle():n.title;L!=null&&(n._collapsed_width=Math.min(n.size[0],o.measureText(L).width+LiteGraph.NODE_TITLE_HEIGHT*2),d[0]=n._collapsed_width,d[1]=0)}(n.clip_area||this.clip_all_nodes)&&(o.save(),o.beginPath(),u==LiteGraph.BOX_SHAPE?o.rect(0,0,d[0],d[1]):u==LiteGraph.ROUND_SHAPE?o.roundRect(0,0,d[0],d[1],[10]):u==LiteGraph.CIRCLE_SHAPE&&o.arc(d[0]*.5,d[1]*.5,d[0]*.5,0,Math.PI*2),o.clip()),n.has_errors&&(p="red"),this.drawNodeShape(n,o,d,l,p,n.is_selected,n.mouseOver),o.shadowColor="transparent",(r=n.onDrawForeground)==null||r.call(n,o,this,this.canvas),LiteGraph.show_node_tooltip&&n.mouseOver&&n.is_selected&&(!this.selected_nodes||Object.keys(this.selected_nodes).length<=1)&&this.drawNodeTooltip(o,n),o.textAlign=f?"center":"left",o.font=this.inner_text_font;var g=!this.lowQualityRenderingRequired(.6),_=this.connecting_output,b=this.connecting_input;o.lineWidth=1;var G=0,C=new Float32Array(2),T;if(n.flags.collapsed){if(this.render_collapsed_slots){var E=null,N=null;if(n.inputs)for(let I=0;I<n.inputs.length;I++){var A=n.inputs[I];if(A.link!=null){E=A;break}}if(n.outputs)for(let I=0;I<n.outputs.length;I++){var A=n.outputs[I];!A.links||!A.links.length||(N=A)}if(E){let I=0,O=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(I=n._collapsed_width*.5,O=-LiteGraph.NODE_TITLE_HEIGHT),o.fillStyle="#686",o.beginPath(),A.type===LiteGraph.EVENT||A.type===LiteGraph.ACTION||A.shape===LiteGraph.BOX_SHAPE?o.rect(I-7+.5,O-4,14,8):A.shape===LiteGraph.ARROW_SHAPE?(o.moveTo(I+8,O),o.lineTo(I+-4,O-4),o.lineTo(I+-4,O+4),o.closePath()):o.arc(I,O,4,0,Math.PI*2),o.fill()}if(N){let I=n._collapsed_width,O=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(I=n._collapsed_width*.5,O=0),o.fillStyle="#686",o.strokeStyle="black",o.beginPath(),A.type===LiteGraph.EVENT||A.type===LiteGraph.ACTION||A.shape===LiteGraph.BOX_SHAPE?o.rect(I-7+.5,O-4,14,8):A.shape===LiteGraph.ARROW_SHAPE?(o.moveTo(I+6,O),o.lineTo(I-6,O-4),o.lineTo(I-6,O+4),o.closePath()):o.arc(I,O,4,0,Math.PI*2),o.fill()}}}else{if(n.inputs)for(let I=0;I<n.inputs.length;I++){let O=n.inputs[I],S=O.type,k=O.shape;o.globalAlpha=c,this.connecting_output&&!LiteGraph.isValidConnection(O.type,_.type)&&(o.globalAlpha=.4*c),o.fillStyle=O.link!=null?O.color_on||this.default_connection_color_byType[S]||this.default_connection_color.input_on:O.color_off||this.default_connection_color_byTypeOff[S]||this.default_connection_color_byType[S]||this.default_connection_color.input_off;let m=n.getConnectionPos(!0,I,C);if(m[0]-=n.pos[0],m[1]-=n.pos[1],G<m[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(G=m[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),o.beginPath(),S=="array"?k=LiteGraph.GRID_SHAPE:O.name=="onTrigger"||O.name=="onExecuted"?k=LiteGraph.ARROW_SHAPE:(S===LiteGraph.EVENT||S===LiteGraph.ACTION)&&(k=LiteGraph.BOX_SHAPE),T=!0,k===LiteGraph.BOX_SHAPE?f?o.rect(m[0]-5+.5,m[1]-8+.5,10,14):o.rect(m[0]-6+.5,m[1]-5+.5,14,10):k===LiteGraph.ARROW_SHAPE?(o.moveTo(m[0]+8,m[1]+.5),o.lineTo(m[0]-4,m[1]+6+.5),o.lineTo(m[0]-4,m[1]-6+.5),o.closePath()):k===LiteGraph.GRID_SHAPE?(o.rect(m[0]-4,m[1]-4,2,2),o.rect(m[0]-1,m[1]-4,2,2),o.rect(m[0]+2,m[1]-4,2,2),o.rect(m[0]-4,m[1]-1,2,2),o.rect(m[0]-1,m[1]-1,2,2),o.rect(m[0]+2,m[1]-1,2,2),o.rect(m[0]-4,m[1]+2,2,2),o.rect(m[0]-1,m[1]+2,2,2),o.rect(m[0]+2,m[1]+2,2,2),T=!1):h?o.rect(m[0]-4,m[1]-4,8,8):o.arc(m[0],m[1],4,0,Math.PI*2),o.fill(),g&&!(O.name=="onTrigger"||O.name=="onExecuted")){let P=O.label!=null?O.label:O.name;P&&(o.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||O.dir==LiteGraph.UP?o.fillText(P,m[0],m[1]-10):o.fillText(P,m[0]+10,m[1]+5))}}if(o.textAlign=f?"center":"right",o.strokeStyle="black",n.outputs)for(let I=0;I<n.outputs.length;I++){let O=n.outputs[I],S=O.type,k=O.shape;this.connecting_input&&!LiteGraph.isValidConnection(S,b.type)&&(o.globalAlpha=.4*c);let m=n.getConnectionPos(!1,I,C);if(m[0]-=n.pos[0],m[1]-=n.pos[1],G<m[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(G=m[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),o.fillStyle=O.links&&O.links.length?O.color_on||this.default_connection_color_byType[S]||this.default_connection_color.output_on:O.color_off||this.default_connection_color_byTypeOff[S]||this.default_connection_color_byType[S]||this.default_connection_color.output_off,o.beginPath(),S=="array"?k=LiteGraph.GRID_SHAPE:O.name=="onTrigger"||O.name=="onExecuted"?k=LiteGraph.ARROW_SHAPE:(S===LiteGraph.EVENT||S===LiteGraph.ACTION)&&(k=LiteGraph.BOX_SHAPE),T=!0,k===LiteGraph.BOX_SHAPE?f?o.rect(m[0]-5+.5,m[1]-8+.5,10,14):o.rect(m[0]-6+.5,m[1]-5+.5,14,10):k===LiteGraph.ARROW_SHAPE?(o.moveTo(m[0]+8,m[1]+.5),o.lineTo(m[0]-4,m[1]+6+.5),o.lineTo(m[0]-4,m[1]-6+.5),o.closePath()):k===LiteGraph.GRID_SHAPE?(o.rect(m[0]-4,m[1]-4,2,2),o.rect(m[0]-1,m[1]-4,2,2),o.rect(m[0]+2,m[1]-4,2,2),o.rect(m[0]-4,m[1]-1,2,2),o.rect(m[0]-1,m[1]-1,2,2),o.rect(m[0]+2,m[1]-1,2,2),o.rect(m[0]-4,m[1]+2,2,2),o.rect(m[0]-1,m[1]+2,2,2),o.rect(m[0]+2,m[1]+2,2,2),T=!1):h?o.rect(m[0]-4,m[1]-4,8,8):o.arc(m[0],m[1],4,0,Math.PI*2),o.fill(),!h&&T&&o.stroke(),g&&!(O.name=="onTrigger"||O.name=="onExecuted")){let P=O.label!=null?O.label:O.name;P&&(o.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||O.dir==LiteGraph.DOWN?o.fillText(P,m[0],m[1]-8):o.fillText(P,m[0]-10,m[1]+5))}}if(o.textAlign="left",o.globalAlpha=1,n.widgets){var D=G;(f||n.widgets_up)&&(D=2),n.widgets_start_y!=null&&(D=n.widgets_start_y),this.drawNodeWidgets(n,D,o,this.node_widget&&this.node_widget[0]==n?this.node_widget[1]:null)}}(n.clip_area||this.clip_all_nodes)&&o.restore(),o.globalAlpha=1}}function drawNodeTooltip(n,o){var s;if(!o||!n){(s=LiteGraph.warn)==null||s.call(LiteGraph,"drawNodeTooltip: invalid node or ctx",o,n);return}var a=o.properties.tooltip!=null?o.properties.tooltip:"";if((!a||a=="")&&LiteGraph.show_node_tooltip_use_descr_property&&o.constructor.desc&&(a=o.constructor.desc),a=(a+"").trim(),!(!a||a=="")){var r=[0,-LiteGraph.NODE_TITLE_HEIGHT],l=o.flags.collapsed?[LiteGraph.NODE_COLLAPSED_WIDTH,LiteGraph.NODE_TITLE_HEIGHT]:o.size;n.font="14px Courier New",n.measureText(a);var p=Math.max(o.size[0],160)+20,h=o.ttip_oTMultiRet?o.ttip_oTMultiRet.height+15:21;n.globalAlpha=.7*this.editor_alpha,n.shadowColor=o.ttip_oTMultiRet?"black":"transparent",n.shadowOffsetX=2,n.shadowOffsetY=2,n.shadowBlur=3,n.fillStyle=o.ttip_oTMultiRet?"#454":"transparent",n.beginPath(),n.roundRect(r[0]-p*.5+l[0]/2,r[1]-15-h,p,h,[3]),n.moveTo(r[0]-10+l[0]/2,r[1]-15),n.lineTo(r[0]+10+l[0]/2,r[1]-15),n.lineTo(r[0]+l[0]/2,r[1]-5),n.fill(),n.shadowColor="transparent",n.textAlign="center",n.fillStyle=o.ttip_oTMultiRet?"#CEC":"transparent",n.globalAlpha=this.editor_alpha;var c=LiteGraph.canvasFillTextMultiline(n,a,r[0]+l[0]/2,r[1]-h,p,14);o.ttip_oTMultiRet=c,n.closePath()}}function drawNodeShape(n,o,s,a,r,l,p){var h;o.strokeStyle=a,o.fillStyle=r;var c=LiteGraph.NODE_TITLE_HEIGHT,u=this.lowQualityRenderingRequired(.5),d=n._shape||n.constructor.shape||LiteGraph.ROUND_SHAPE,f=n.constructor.title_mode,L=!0;f==LiteGraph.TRANSPARENT_TITLE||f==LiteGraph.NO_TITLE?L=!1:f==LiteGraph.AUTOHIDE_TITLE&&p&&(L=!0);var g=tmp_area;g[0]=0,g[1]=L?-c:0,g[2]=s[0]+1,g[3]=L?s[1]+c:s[1];var _=o.globalAlpha;if(o.beginPath(),d==LiteGraph.BOX_SHAPE||u?o.fillRect(g[0],g[1],g[2],g[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE?o.roundRect(g[0],g[1],g[2],g[3],d==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):d==LiteGraph.CIRCLE_SHAPE&&o.arc(s[0]*.5,s[1]*.5,s[0]*.5,0,Math.PI*2),o.fill(),!n.flags.collapsed&&L&&(o.shadowColor="transparent",o.fillStyle="rgba(0,0,0,0.2)",o.fillRect(0,-1,g[2],2)),o.shadowColor="transparent",(h=n.onDrawBackground)==null||h.call(n,o,this,this.canvas,this.graph_mouse),L||f==LiteGraph.TRANSPARENT_TITLE){if(n.onDrawTitleBar)n.onDrawTitleBar(o,c,s,this.ds.scale,a);else if(f!=LiteGraph.TRANSPARENT_TITLE&&(n.constructor.title_color||this.render_title_colored)){var b=n.constructor.title_color||a;if(n.flags.collapsed&&(o.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var G=LGraphCanvas.gradients[b];if(!G){G=LGraphCanvas.gradients[b]=o.createLinearGradient(0,0,400,0);try{G.addColorStop(0,b)}catch{G.addColorStop(0,LiteGraph.NODE_DEFAULT_COLOR)}G.addColorStop(1,"#000")}o.fillStyle=G}else o.fillStyle=b;o.beginPath(),d==LiteGraph.BOX_SHAPE||u?o.rect(0,-c,s[0]+1,c):(d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE)&&o.roundRect(0,-c,s[0]+1,c,n.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),o.fill(),o.shadowColor="transparent"}let D=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[n.mode]&&(D=LiteGraph.NODE_MODES_COLORS[n.mode]),LiteGraph.node_box_coloured_when_on&&(D=n.action_triggered?"#FFF":n.execute_triggered?"#AAA":D);var C=10;if(n.onDrawTitleBox?n.onDrawTitleBox(o,c,s,this.ds.scale):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CIRCLE_SHAPE||d==LiteGraph.CARD_SHAPE?(u&&(o.fillStyle="black",o.beginPath(),o.arc(c*.5,c*-.5,C*.5+1,0,Math.PI*2),o.fill()),o.fillStyle=n.boxcolor||D||LiteGraph.NODE_DEFAULT_BOXCOLOR,u?o.fillRect(c*.5-C*.5,c*-.5-C*.5,C,C):(o.beginPath(),o.arc(c*.5,c*-.5,C*.5,0,Math.PI*2),o.fill())):(u&&(o.fillStyle="black",o.fillRect((c-C)*.5-1,(c+C)*-.5-1,C+2,C+2)),o.fillStyle=n.boxcolor||D||LiteGraph.NODE_DEFAULT_BOXCOLOR,o.fillRect((c-C)*.5,(c+C)*-.5,C,C)),o.globalAlpha=_,n.onDrawTitleText&&n.onDrawTitleText(o,c,s,this.ds.scale,this.title_text_font,l),!u){o.font=this.title_text_font;var T=String(n.getTitle());T&&(l?o.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:o.fillStyle=n.constructor.title_text_color||this.node_title_color,n.flags.collapsed?(o.textAlign="left",o.fillText(T.substring(0,20),c,LiteGraph.NODE_TITLE_TEXT_Y-c),o.textAlign="left"):(o.textAlign="left",o.fillText(T,c,LiteGraph.NODE_TITLE_TEXT_Y-c)))}if(!n.flags.collapsed&&n.subgraph&&!n.skip_subgraph_button){var E=LiteGraph.NODE_TITLE_HEIGHT,N=n.size[0]-E,A=LiteGraph.isInsideRectangle(this.graph_mouse[0]-n.pos[0],this.graph_mouse[1]-n.pos[1],N+2,-E+2,E-4,E-4);o.fillStyle=A?"#888":"#555",d==LiteGraph.BOX_SHAPE||u?o.fillRect(N+2,-E+2,E-4,E-4):(o.beginPath(),o.roundRect(N+2,-E+2,E-4,E-4,[4]),o.fill()),o.fillStyle="#333",o.beginPath(),o.moveTo(N+E*.2,-E*.6),o.lineTo(N+E*.8,-E*.6),o.lineTo(N+E*.5,-E*.3),o.fill()}n.onDrawTitle&&n.onDrawTitle(o)}l&&(n.onBounding&&n.onBounding(g),f==LiteGraph.TRANSPARENT_TITLE&&(g[1]-=c,g[3]+=c),o.lineWidth=1,o.globalAlpha=.8,o.beginPath(),d==LiteGraph.BOX_SHAPE?o.rect(-6+g[0],-6+g[1],12+g[2],12+g[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE&&n.flags.collapsed?o.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],[this.round_radius*2]):d==LiteGraph.CARD_SHAPE?o.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],[this.round_radius*2,2,this.round_radius*2,2]):d==LiteGraph.CIRCLE_SHAPE&&o.arc(s[0]*.5,s[1]*.5,s[0]*.5+6,0,Math.PI*2),o.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,o.stroke(),o.strokeStyle=a,o.globalAlpha=1),n.execute_triggered>0&&n.execute_triggered--,n.action_triggered>0&&n.action_triggered--}function drawExecutionOrder(n){n.shadowColor="transparent",n.globalAlpha=.25,n.textAlign="center",n.strokeStyle="white",n.globalAlpha=.75;var o=this.visible_nodes;for(let a=0;a<o.length;++a){var s=o[a];n.fillStyle="black",n.fillRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),s.order==0&&n.strokeRect(s.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,s.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),n.fillStyle="#FFF",n.fillText(s.order,s.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,s.pos[1]-6)}n.globalAlpha=1}function drawNodeWidgets(n,o,s,a){if(!n.widgets||!n.widgets.length)return 0;var r=n.size[0],l=n.widgets;o+=2;var p=LiteGraph.NODE_WIDGET_HEIGHT,h=!this.lowQualityRenderingRequired(.5);s.save(),s.globalAlpha=this.editor_alpha;var c=LiteGraph.WIDGET_OUTLINE_COLOR,u=LiteGraph.WIDGET_BGCOLOR,d=LiteGraph.WIDGET_TEXT_COLOR,f=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,L=15;for(let A=0;A<l.length;++A){var g=l[A],_=o;g.y&&(_=g.y),g.last_y=_,s.strokeStyle=c,s.fillStyle="#222",s.textAlign="left",g.disabled&&(s.globalAlpha*=.5);var b=g.width||r;switch(g.type){case"button":g.clicked&&(s.fillStyle="#AAA",g.clicked=!1,this.dirty_canvas=!0),s.fillRect(L,_,b-L*2,p),h&&!g.disabled&&s.strokeRect(L,_,b-L*2,p),h&&(s.textAlign="center",s.fillStyle=d,s.fillText(g.label||g.name,b*.5,_+p*.7));break;case"toggle":if(s.textAlign="left",s.strokeStyle=c,s.fillStyle=u,s.beginPath(),h?s.roundRect(L,_,b-L*2,p,[p*.5]):s.rect(L,_,b-L*2,p),s.fill(),h&&!g.disabled&&s.stroke(),s.fillStyle=g.value?"#89A":"#333",s.beginPath(),s.arc(b-L*2,_+p*.5,p*.36,0,Math.PI*2),s.fill(),h){s.fillStyle=f;const D=g.label||g.name;D!=null&&s.fillText(D,L*2,_+p*.7),s.fillStyle=g.value?d:f,s.textAlign="right",s.fillText(g.value?g.options.on||"true":g.options.off||"false",b-40,_+p*.7)}break;case"slider":s.fillStyle=u,s.fillRect(L,_,b-L*2,p);var G=g.options.max-g.options.min,C=(g.value-g.options.min)/G;if(C<0&&(C=0),C>1&&(C=1),s.fillStyle=g.options.hasOwnProperty("slider_color")?g.options.slider_color:a==g?"#89A":"#678",s.fillRect(L,_,C*(b-L*2),p),h&&!g.disabled&&s.strokeRect(L,_,b-L*2,p),g.marker){var T=(g.marker-g.options.min)/G;T<0&&(T=0),T>1&&(T=1),s.fillStyle=g.options.hasOwnProperty("marker_color")?g.options.marker_color:"#AA9",s.fillRect(L+T*(b-L*2),_,2,p)}h&&(s.textAlign="center",s.fillStyle=d,s.fillText(g.label||g.name+"  "+Number(g.value).toFixed(g.options.precision!=null?g.options.precision:3),b*.5,_+p*.7));break;case"number":case"combo":if(s.textAlign="left",s.strokeStyle=c,s.fillStyle=u,s.beginPath(),h?s.roundRect(L,_,b-L*2,p,[p*.5]):s.rect(L,_,b-L*2,p),s.fill(),h)if(g.disabled||s.stroke(),s.fillStyle=d,g.disabled||(s.beginPath(),s.moveTo(L+16,_+5),s.lineTo(L+6,_+p*.5),s.lineTo(L+16,_+p-5),s.fill(),s.beginPath(),s.moveTo(b-L-16,_+5),s.lineTo(b-L-6,_+p*.5),s.lineTo(b-L-16,_+p-5),s.fill()),s.fillStyle=f,s.fillText(g.label||g.name,L*2+5,_+p*.7),s.fillStyle=d,s.textAlign="right",g.type=="number")s.fillText(Number(g.value).toFixed(g.options.precision!==void 0?g.options.precision:3),b-L*2-20,_+p*.7);else{var E=g.value;if(g.options.values){var N=g.options.values;N.constructor===Function&&(N=N()),N&&N.constructor!==Array&&(E=N[g.value])}s.fillText(E,b-L*2-20,_+p*.7)}break;case"string":case"text":if(s.textAlign="left",s.strokeStyle=c,s.fillStyle=u,s.beginPath(),h?s.roundRect(L,_,b-L*2,p,[p*.5]):s.rect(L,_,b-L*2,p),s.fill(),h){g.disabled||s.stroke(),s.save(),s.beginPath(),s.rect(L,_,b-L*2,p),s.clip(),s.fillStyle=f;const D=g.label||g.name;D!=null&&s.fillText(D,L*2,_+p*.7),s.fillStyle=d,s.textAlign="right",s.fillText(String(g.value).substr(0,30),b-L*2,_+p*.7),s.restore()}break;default:g.draw&&g.draw(s,n,b,_,p);break}o+=(g.computeSize?g.computeSize(b)[1]:p)+4,s.globalAlpha=this.editor_alpha}s.restore(),s.textAlign="left"}function processNodeWidgets(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow();for(let i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type==="pointerdown"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var nvalue=LiteGraph.clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value,old_value)},20),this.dirty_canvas=!0;break;case"number":case"combo":case"enum":if(event.type=="pointermove"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type=="pointerdown"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));let n=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=n*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(n){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+n:index=values_list.indexOf(w.value)+n,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let o=function(s){return values!=values_list&&(s=text_values.indexOf(s)),this.value=s,inner_value_change(this,s,old_value),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:o.bind(w)},ref_window)}}else if(event.type=="pointerup"&&w.type=="number"){let delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,function(v){var t;if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(n){(t=LiteGraph.warn)==null||t.call(LiteGraph,n)}this.value=Number(v),inner_value_change(this,this.value,old_value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value,old_value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type=="pointerdown"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type=="pointerdown"&&this.prompt("Value",w.value,function(n){inner_value_change(this,n)}.bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return w}}}function inner_value_change(n,o,s){var a;(a=LiteGraph.debug)==null||a.call(LiteGraph,"inner_value_change for processNodeWidgets",n,o),s!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,s,w),node.graph.onGraphChanged({action:"widgetChanged",doSave:!0})),n.type=="number"&&(o=Number(o)),n.value=o,n.options&&n.options.property&&node.properties[n.options.property]!==void 0&&node.setProperty(n.options.property,o),n.callback&&n.callback(n.value,that,node,pos,event)}return null}function adjustNodesSize(){var n=this.graph._nodes;for(let o=0;o<n.length;++o)n[o].size=n[o].computeSize();this.setDirty(!0,!0)}function drawLinkTooltip(n,o){var s,a=o._pos;if(n.fillStyle="black",n.beginPath(),n.arc(a[0],a[1],3,0,Math.PI*2),n.fill(),o.data!=null&&!((s=this.onDrawLinkTooltip)!=null&&s.call(this,n,o,this))){var r=o.data,l=null;if(r.constructor===Number?l=r.toFixed(2):r.constructor===String?l='"'+r+'"':r.constructor===Boolean?l=String(r):r.toToolTip?l=r.toToolTip():l="["+r.constructor.name+"]",l!=null){l=l.substr(0,30),n.font="14px Courier New";var p=n.measureText(l),h=p.width+20,c=24;n.shadowColor="black",n.shadowOffsetX=2,n.shadowOffsetY=2,n.shadowBlur=3,n.fillStyle="#454",n.beginPath(),n.roundRect(a[0]-h*.5,a[1]-15-c,h,c,[3]),n.moveTo(a[0]-10,a[1]-15),n.lineTo(a[0]+10,a[1]-15),n.lineTo(a[0],a[1]-5),n.fill(),n.shadowColor="transparent",n.textAlign="center",n.fillStyle="#CEC",n.fillText(l,a[0],a[1]-15-c*.3)}}}function drawConnections(n){var o=LiteGraph.getTime(),s=this.visible_area;margin_area[0]=s[0]-20,margin_area[1]=s[1]-20,margin_area[2]=s[2]+40,margin_area[3]=s[3]+40,n.lineWidth=this.connections_width,n.fillStyle="#AAA",n.strokeStyle="#AAA",n.globalAlpha=this.editor_alpha;for(var a=this.graph._nodes,r=0,l=a.length;r<l;++r){var p=a[r];if(!(!p.inputs||!p.inputs.length))for(let N=0;N<p.inputs.length;++N){var h=p.inputs[N];if(!(!h||h.link==null)){var c=h.link,u=this.graph.links[c];if(u){var d=this.graph.getNodeById(u.origin_id);if(d!=null){var f=u.origin_slot,L=null;f==-1?L=[d.pos[0]+10,d.pos[1]+10]:L=d.getConnectionPos(!1,f,tempA);var g=p.getConnectionPos(!0,N,tempB);if(link_bounding[0]=L[0],link_bounding[1]=L[1],link_bounding[2]=g[0]-L[0],link_bounding[3]=g[1]-L[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!LiteGraph.overlapBounding(link_bounding,margin_area)){var _=d.outputs[f],b=p.inputs[N];if(!(!_||!b)){var G=_.dir||(d.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),C=b.dir||(p.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(n,L,g,u,!1,0,null,G,C),u&&u._last_time&&o-u._last_time<1e3){var T=2-(o-u._last_time)*.002,E=n.globalAlpha;n.globalAlpha=E*T,this.renderLink(n,L,g,u,!0,T,"white",G,C),n.globalAlpha=E}}}}}}}}n.globalAlpha=1}function renderLink(n,o,s,a,r,l,p,h,c,u){a&&this.visible_links.push(a),!p&&a&&(p=a.color||LGraphCanvas.link_type_colors[a.type]),p||(p=this.default_link_color),a!=null&&this.highlighted_links[a.id]&&(p="#FFF"),h=h||LiteGraph.RIGHT,c=c||LiteGraph.LEFT;var d=LiteGraph.distance(o,s);this.render_connections_border&&this.ds.scale>.6&&(n.lineWidth=this.connections_width+4),n.lineJoin="round",u=u||1,u>1&&(n.lineWidth=.5),n.beginPath();for(let S=0;S<u;S+=1){var f=(S-(u-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){n.moveTo(o[0],o[1]+f);let k=0,m=0,P=0,j=0;switch(h){case LiteGraph.LEFT:k=d*-.25;break;case LiteGraph.RIGHT:k=d*.25;break;case LiteGraph.UP:m=d*-.25;break;case LiteGraph.DOWN:m=d*.25;break}switch(c){case LiteGraph.LEFT:P=d*-.25;break;case LiteGraph.RIGHT:P=d*.25;break;case LiteGraph.UP:j=d*-.25;break;case LiteGraph.DOWN:j=d*.25;break}n.bezierCurveTo(o[0]+k,o[1]+m+f,s[0]+P,s[1]+j+f,s[0],s[1]+f)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){n.moveTo(o[0],o[1]+f);let k=0,m=0,P=0,j=0;switch(h){case LiteGraph.LEFT:k=-1;break;case LiteGraph.RIGHT:k=1;break;case LiteGraph.UP:m=-1;break;case LiteGraph.DOWN:m=1;break}switch(c){case LiteGraph.LEFT:P=-1;break;case LiteGraph.RIGHT:P=1;break;case LiteGraph.UP:j=-1;break;case LiteGraph.DOWN:j=1;break}var L=15;n.lineTo(o[0]+k*L,o[1]+m*L+f),n.lineTo(s[0]+P*L,s[1]+j*L+f),n.lineTo(s[0],s[1]+f)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){n.moveTo(o[0],o[1]);var g=o[0],_=o[1],b=s[0],G=s[1];h==LiteGraph.RIGHT?g+=10:_+=10,c==LiteGraph.LEFT?b-=10:G-=10,n.lineTo(g,_),n.lineTo((g+b)*.5,_),n.lineTo((g+b)*.5,G),n.lineTo(b,G),n.lineTo(s[0],s[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!r&&(n.strokeStyle="rgba(0,0,0,0.5)",n.stroke()),n.lineWidth=this.connections_width,n.fillStyle=n.strokeStyle=p,n.stroke();var C=this.computeConnectionPoint(o,s,.5,h,c);if(a&&a._pos&&(a._pos[0]=C[0],a._pos[1]=C[1]),this.ds.scale>=.6&&this.highquality_render&&c!=LiteGraph.CENTER){if(this.render_connection_arrows){var T=this.computeConnectionPoint(o,s,.25,h,c),E=this.computeConnectionPoint(o,s,.26,h,c),N=this.computeConnectionPoint(o,s,.75,h,c),A=this.computeConnectionPoint(o,s,.76,h,c),D=0,I=0;this.render_curved_connections?(D=-Math.atan2(E[0]-T[0],E[1]-T[1]),I=-Math.atan2(A[0]-N[0],A[1]-N[1])):I=D=s[1]>o[1]?0:Math.PI,n.save(),n.translate(T[0],T[1]),n.rotate(D),n.beginPath(),n.moveTo(-5,-3),n.lineTo(0,7),n.lineTo(5,-3),n.fill(),n.restore(),n.save(),n.translate(N[0],N[1]),n.rotate(I),n.beginPath(),n.moveTo(-5,-3),n.lineTo(0,7),n.lineTo(5,-3),n.fill(),n.restore()}n.beginPath(),n.arc(C[0],C[1],5,0,Math.PI*2),n.fill()}if(l){n.fillStyle=p;for(let S=0;S<5;++S){var O=(LiteGraph.getTime()*.001+S*.2)%1;C=this.computeConnectionPoint(o,s,O,h,c),n.beginPath(),n.arc(C[0],C[1],5,0,2*Math.PI),n.fill()}}}function computeConnectionPoint(n,o,s,a,r){a=a||LiteGraph.RIGHT,r=r||LiteGraph.LEFT;var l=LiteGraph.distance(n,o),p=n,h=[n[0],n[1]],c=[o[0],o[1]],u=o;switch(a){case LiteGraph.LEFT:h[0]+=l*-.25;break;case LiteGraph.RIGHT:h[0]+=l*.25;break;case LiteGraph.UP:h[1]+=l*-.25;break;case LiteGraph.DOWN:h[1]+=l*.25;break}switch(r){case LiteGraph.LEFT:c[0]+=l*-.25;break;case LiteGraph.RIGHT:c[0]+=l*.25;break;case LiteGraph.UP:c[1]+=l*-.25;break;case LiteGraph.DOWN:c[1]+=l*.25;break}var d=(1-s)*(1-s)*(1-s),f=3*((1-s)*(1-s))*s,L=3*(1-s)*(s*s),g=s*s*s,_=d*p[0]+f*h[0]+L*c[0]+g*u[0],b=d*p[1]+f*h[1]+L*c[1]+g*u[1];return[_,b]}function drawSubgraphPanel(n){var o,s=this.graph;if(s){var a=s._subgraph_node;if(!a){(o=LiteGraph.warn)==null||o.call(LiteGraph,"subgraph without subnode");return}this.drawSubgraphPanelLeft(s,a,n),this.drawSubgraphPanelRight(s,a,n)}}function drawSubgraphPanelLeft(n,o,s){var a,r=o.inputs?o.inputs.length:0,l=200,p=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(10,10,l,(r+1)*p+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left",s.fillText("Graph Inputs",20,34),this.drawButton(l-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var h=50;if(s.font="14px Arial",o.inputs)for(var c=0;c<o.inputs.length;++c){var u=o.inputs[c];if(!u.not_subgraph_input){if(this.drawButton(20,h+2,l-20,p-2)){var d=o.constructor.input_node_type||"graph/input";this.graph.beforeChange();var f=LiteGraph.createNode(d);f?(n.add(f,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([f]),this.node_dragged=f,this.dragging_canvas=!1,f.setProperty("name",u.name),f.setProperty("type",u.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(a=LiteGraph.error)==null||a.call(LiteGraph,"graph input node not found:",d)}s.fillStyle="#9C9",s.beginPath(),s.arc(l-16,h+p*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(u.name,30,h+p*.75),s.fillStyle="#777",s.fillText(u.type,130,h+p*.75),h+=p}}this.drawButton(20,h+2,l-20,p-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(o)}function drawSubgraphPanelRight(n,o,s){var a,r=o.outputs?o.outputs.length:0,l=this.bgcanvas.width,p=200,h=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);s.fillStyle="#111",s.globalAlpha=.8,s.beginPath(),s.roundRect(l-p-10,10,p,(r+1)*h+50,[8]),s.fill(),s.globalAlpha=1,s.fillStyle="#888",s.font="14px Arial",s.textAlign="left";const c="Graph Outputs";var u=s.measureText(c).width;if(s.fillText(c,l-u-20,34),this.drawButton(l-p,20,20,20,"X","#151515")){this.closeSubgraph();return}var d=50;if(s.font="14px Arial",o.outputs)for(var f=0;f<o.outputs.length;++f){var L=o.outputs[f];if(!L.not_subgraph_input){if(this.drawButton(l-p,d+2,p-20,h-2)){var g=o.constructor.output_node_type||"graph/output";this.graph.beforeChange();var _=LiteGraph.createNode(g);_?(n.add(_,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([_]),this.node_dragged=_,this.dragging_canvas=!1,_.setProperty("name",L.name),_.setProperty("type",L.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(a=LiteGraph.error)==null||a.call(LiteGraph,"graph input node not found:",g)}s.fillStyle="#9C9",s.beginPath(),s.arc(l-p+16,d+h*.5,5,0,2*Math.PI),s.fill(),s.fillStyle="#AAA",s.fillText(L.name,l-p+30,d+h*.75),s.fillStyle="#777",s.fillText(L.type,l-p+130,d+h*.75),d+=h}}this.drawButton(l-p,d+2,p-20,h-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(o)}function drawButton(n,o,s,a,r,l,p,h){var c=this.ctx;l=l||LiteGraph.NODE_DEFAULT_COLOR,p=p||"#555",h=h||LiteGraph.NODE_TEXT_COLOR;var u=this.ds.convertOffsetToCanvas(this.graph_mouse),d=LiteGraph.isInsideRectangle(u[0],u[1],n,o,s,a);if(u=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,u){var f=this.canvas.getBoundingClientRect();u[0]-=f.left,u[1]-=f.top}var L=u&&LiteGraph.isInsideRectangle(u[0],u[1],n,o,s,a);c.fillStyle=d?p:l,L&&(c.fillStyle="#AAA"),c.beginPath(),c.roundRect(n,o,s,a,[4]),c.fill(),r!=null&&r.constructor==String&&(c.fillStyle=h,c.textAlign="center",c.font=(a*.65|0)+"px Arial",c.fillText(r,n+s*.5,o+a*.75),c.textAlign="left");var g=L&&!this.block_click;return L&&this.blockClick(),g}function isAreaClicked(n,o,s,a,r){var l=this.last_click_position,p=l&&LiteGraph.isInsideRectangle(l[0],l[1],n,o,s,a),h=p&&!this.block_click;return p&&r&&this.blockClick(),h}function renderInfo(n,o,s){o=o||10,s=s||this.canvas.height-80,n.save(),n.translate(o,s),n.font="10px Arial",n.fillStyle="#888",n.textAlign="left",this.graph?(n.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),n.fillText("I: "+this.graph.iteration,5,26),n.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),n.fillText("V: "+this.graph._version,5,52),n.fillText("FPS:"+this.fps.toFixed(2),5,65)):n.fillText("No graph selected",5,13),n.restore()}function drawBackCanvas(){var n,o,s,a=this.bgcanvas;this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var r=this.bgctx;r.start&&r.start();var l=this.viewport||[0,0,r.canvas.width,r.canvas.height];if(this.clear_background&&r.clearRect(l[0],l[1],l[2],l[3]),this._graph_stack&&this._graph_stack.length){r.save();var p=this.graph._subgraph_node;r.strokeStyle=p.bgcolor,r.lineWidth=10,r.strokeRect(1,1,a.width-2,a.height-2),r.lineWidth=1,r.font="40px Arial",r.textAlign="center",r.fillStyle=p.bgcolor||"#AAA";let d="";this._graph_stack.slice(1).forEach((f,L)=>{d+=`${f._subgraph_node.getTitle()} ${L<this._graph_stack.length-2?">> ":""}`}),r.fillText(d+p.getTitle(),a.width*.5,40),r.restore()}var h=!1;if(this.onRenderBackground&&(h=this.onRenderBackground(a,r)),this.viewport||(r.restore(),r.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(r.save(),this.ds.toCanvasContext(r),this.ds.scale<1.5&&!h&&this.clear_background_color&&(r.fillStyle=this.clear_background_color,r.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!h){if(this.zoom_modify_alpha?r.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:r.globalAlpha=this.editor_alpha,r.imageSmoothingEnabled=r.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var c=this;this._bg_img.onload=function(){c.draw(!0,!0)}}var u=null;this._pattern==null&&this._bg_img.width>0?(u=r.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=u):u=this._pattern,u&&(r.fillStyle=u,r.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),r.fillStyle="transparent"),r.globalAlpha=1,r.imageSmoothingEnabled=r.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(a,r),(n=this.onDrawBackground)==null||n.call(this,r,this.visible_area),this.onBackgroundRender&&((o=LiteGraph.error)==null||o.call(LiteGraph,"WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(r.strokeStyle="#235",r.strokeRect(0,0,a.width,a.height)),this.render_connections_shadows?(r.shadowColor="#000",r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=6):r.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(r),r.shadowColor="rgba(0,0,0,0)",r.restore()}(s=r.finish)==null||s.call(r),this.dirty_bgcanvas=!1,this.dirty_canvas=!0}function drawGroups(n,o){if(this.graph){var s=this.graph._groups;o.save(),o.globalAlpha=.5*this.editor_alpha;for(let h=0;h<s.length;++h){var a=s[h];if(LiteGraph.overlapBounding(this.visible_area,a._bounding)){o.fillStyle=a.color||"#335",o.strokeStyle=a.color||"#335";var r=a._pos,l=a._size;o.globalAlpha=.25*this.editor_alpha,o.beginPath(),o.rect(r[0]+.5,r[1]+.5,l[0],l[1]),o.fill(),o.globalAlpha=this.editor_alpha,o.stroke(),o.beginPath(),o.moveTo(r[0]+l[0],r[1]+l[1]),o.lineTo(r[0]+l[0]-10,r[1]+l[1]),o.lineTo(r[0]+l[0],r[1]+l[1]-10),o.fill();var p=a.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;o.font=p+"px Arial",o.textAlign="left",o.fillText(a.title,r[0]+4,r[1]+p)}}o.restore()}}class RenderController{constructor(o){this.host=o}draw(...o){return draw.apply(this.host,o)}drawFrontCanvas(...o){return drawFrontCanvas.apply(this.host,o)}lowQualityRenderingRequired(...o){return lowQualityRenderingRequired.apply(this.host,o)}drawNode(...o){return drawNode.apply(this.host,o)}drawNodeTooltip(...o){return drawNodeTooltip.apply(this.host,o)}drawNodeShape(...o){return drawNodeShape.apply(this.host,o)}drawExecutionOrder(...o){return drawExecutionOrder.apply(this.host,o)}drawNodeWidgets(...o){return drawNodeWidgets.apply(this.host,o)}processNodeWidgets(...o){return processNodeWidgets.apply(this.host,o)}adjustNodesSize(...o){return adjustNodesSize.apply(this.host,o)}drawConnections(...o){return drawConnections.apply(this.host,o)}renderLink(...o){return renderLink.apply(this.host,o)}computeConnectionPoint(...o){return computeConnectionPoint.apply(this.host,o)}drawLinkTooltip(...o){return drawLinkTooltip.apply(this.host,o)}drawBackCanvas(...o){return drawBackCanvas.apply(this.host,o)}drawSubgraphPanel(...o){return drawSubgraphPanel.apply(this.host,o)}drawSubgraphPanelLeft(...o){return drawSubgraphPanelLeft.apply(this.host,o)}drawSubgraphPanelRight(...o){return drawSubgraphPanelRight.apply(this.host,o)}drawButton(...o){return drawButton.apply(this.host,o)}isAreaClicked(...o){return isAreaClicked.apply(this.host,o)}renderInfo(...o){return renderInfo.apply(this.host,o)}drawGroups(...o){return drawGroups.apply(this.host,o)}}function copyToClipboard(){var n,o={nodes:[],links:[]},s=0,a=[];for(let u in this.selected_nodes){let d=this.selected_nodes[u];d.clonable!==!1&&(d._relative_id=s,a.push(d),s+=1)}for(let u=0;u<a.length;++u){let d=a[u];if(d.clonable!==!1){var r=d.clone();if(!r){(n=LiteGraph.warn)==null||n.call(LiteGraph,"node type not found: "+d.type);continue}if(o.nodes.push(r.serialize()),d.inputs&&d.inputs.length)for(var l=0;l<d.inputs.length;++l){var p=d.inputs[l];if(!(!p||p.link==null)){var h=this.graph.links[p.link];if(h){var c=this.graph.getNodeById(h.origin_id);c&&o.links.push([c._relative_id,h.origin_slot,d._relative_id,h.target_slot,c.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(o))}function pasteFromClipboard(n=!1){var o;if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&n)){var s=localStorage.getItem("litegrapheditor_clipboard");if(s){this.graph.beforeChange();var a=JSON.parse(s),r=!1,l=!1;for(let _=0;_<a.nodes.length;++_)r?(r[0]>a.nodes[_].pos[0]&&(r[0]=a.nodes[_].pos[0],l[0]=_),r[1]>a.nodes[_].pos[1]&&(r[1]=a.nodes[_].pos[1],l[1]=_)):(r=[a.nodes[_].pos[0],a.nodes[_].pos[1]],l=[_,_]);var p=[];for(let _=0;_<a.nodes.length;++_){var h=a.nodes[_],c=LiteGraph.createNode(h.type);c&&(c.configure(h),c.pos[0]+=this.graph_mouse[0]-r[0],c.pos[1]+=this.graph_mouse[1]-r[1],this.graph.add(c,{doProcessChange:!1}),p.push(c))}for(let _=0;_<a.links.length;++_){var u=a.links[_],d=void 0,f=u[0];if(f!=null)d=p[f];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&n){var L=u[4];L&&(d=this.graph.getNodeById(L))}var g=p[u[2]];d&&g?d.connect(u[1],g,u[3]):(o=LiteGraph.warn)==null||o.call(LiteGraph,"Warning, nodes missing on pasting")}this.selectNodes(p),this.graph.onGraphChanged({action:"paste",doSave:!0}),this.graph.afterChange()}}}function processNodeDblClicked(n){var o;this.onShowNodePanel?this.onShowNodePanel(n):this.showShowNodePanel(n),(o=this.onNodeDblClicked)==null||o.call(this,n),this.setDirty(!0)}function processNodeSelected(n,o){var s;this.selectNode(n,o&&(o.shiftKey||o.ctrlKey||this.multi_select)),(s=this.onNodeSelected)==null||s.call(this,n)}function selectNode(n,o){n==null?this.deselectAllNodes():this.selectNodes([n],o)}function selectNodes(n,o){var s;o||this.deselectAllNodes(),n=n||this.graph._nodes,typeof n=="string"&&(n=[n]),Object.values(n).forEach(a=>{var r,l,p;if(a.is_selected){this.deselectNode(a);return}a.is_selected=!0,this.selected_nodes[a.id]=a,(r=a.onSelected)==null||r.call(a),(l=a.inputs)==null||l.forEach(h=>{this.highlighted_links[h.link]=!0}),(p=a.outputs)==null||p.forEach(h=>{var c;(c=h.links)==null||c.forEach(u=>{this.highlighted_links[u]=!0})})}),(s=this.onSelectionChange)==null||s.call(this,this.selected_nodes),this.setDirty(!0)}function deselectNode(n){var o,s,a,r;n.is_selected&&((o=n.onDeselected)==null||o.call(n),n.is_selected=!1,(s=this.onNodeDeselected)==null||s.call(this,n),(a=n.inputs)==null||a.forEach(l=>{var p;(p=this.highlighted_links)==null||delete p[l.link]}),(r=n.outputs)==null||r.forEach(l=>{var p;(p=l.links)==null||p.forEach(h=>{var c;return(c=this.highlighted_links)==null?!0:delete c[h]})}))}function deselectAllNodes(){var n,o;this.graph&&((n=this.graph._nodes)==null||n.forEach(s=>{var a,r;s.is_selected&&((a=s.onDeselected)==null||a.call(s),s.is_selected=!1,(r=this.onNodeDeselected)==null||r.call(this,s))}),this.selected_nodes={},this.current_node=null,this.highlighted_links={},(o=this.onSelectionChange)==null||o.call(this,this.selected_nodes),this.setDirty(!0))}function deleteSelectedNodes(){this.graph.beforeChange();for(let l in this.selected_nodes){var n=this.selected_nodes[l];if(!n.block_delete){if(n.inputs&&n.inputs.length&&n.outputs&&n.outputs.length&&LiteGraph.isValidConnection(n.inputs[0].type,n.outputs[0].type)&&n.inputs[0].link&&n.outputs[0].links&&n.outputs[0].links.length){var o=n.graph.links[n.inputs[0].link],s=n.graph.links[n.outputs[0].links[0]],a=n.getInputNode(0),r=n.getOutputNodes(0)[0];a&&r&&a.connect(o.origin_slot,r,s.target_slot)}this.graph.remove(n),this.onNodeDeselected&&this.onNodeDeselected(n)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()}function onNodeSelectionChange(){}function boundaryNodesForSelection(){return LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))}class SelectionController{constructor(o){this.host=o}copyToClipboard(...o){return copyToClipboard.apply(this.host,o)}pasteFromClipboard(...o){return pasteFromClipboard.apply(this.host,o)}processNodeDblClicked(...o){return processNodeDblClicked.apply(this.host,o)}processNodeSelected(...o){return processNodeSelected.apply(this.host,o)}selectNode(...o){return selectNode.apply(this.host,o)}selectNodes(...o){return selectNodes.apply(this.host,o)}deselectNode(...o){return deselectNode.apply(this.host,o)}deselectAllNodes(...o){return deselectAllNodes.apply(this.host,o)}deleteSelectedNodes(...o){return deleteSelectedNodes.apply(this.host,o)}onNodeSelectionChange(...o){return onNodeSelectionChange.apply(this.host,o)}boundaryNodesForSelection(...o){return boundaryNodesForSelection.apply(this.host,o)}}function showLinkMenu(n,o){var s=this,a=s.graph.getNodeById(n.origin_id),r=s.graph.getNodeById(n.target_id),l=!1;a&&a.outputs&&a.outputs[n.origin_slot]&&(l=a.outputs[n.origin_slot].type);var p=!1;r&&r.outputs&&r.outputs[n.target_slot]&&(p=r.inputs[n.target_slot].type);var h=["Add Node",null,"Delete"],c=new LiteGraph.ContextMenu(h,{event:o,title:n.data!=null?n.data.constructor.name:null,callback:u});function u(d,f,L){switch(d){case"Add Node":LGraphCanvas.onMenuAdd(null,null,L,c,function(g){var _;(_=LiteGraph.debug)==null||_.call(LiteGraph,"node autoconnect"),!(!g.inputs||!g.inputs.length||!g.outputs||!g.outputs.length)&&a.connectByType(n.origin_slot,g,l)&&(g.connectByType(n.target_slot,r,p),g.pos[0]-=g.size[0]*.5)});break;case"Delete":s.graph.removeLink(n.id);break}}return!1}function createDefaultNodeForSlot(n={}){var o,s,a,r,l,p=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},n),h=this,c=p.nodeFrom&&p.slotFrom!==null,u=!c&&p.nodeTo&&p.slotTo!==null;if(!c&&!u)return(o=LiteGraph.warn)==null||o.call(LiteGraph,"No data passed to createDefaultNodeForSlot "+p.nodeFrom+" "+p.slotFrom+" "+p.nodeTo+" "+p.slotTo),!1;if(!p.nodeType)return(s=LiteGraph.warn)==null||s.call(LiteGraph,"No type to createDefaultNodeForSlot"),!1;var d=c?p.nodeFrom:p.nodeTo,f=c?p.slotFrom:p.slotTo,L=!1;switch(typeof f){case"string":L=c?d.findOutputSlot(f,!1):d.findInputSlot(f,!1),f=c?d.outputs[f]:d.inputs[f];break;case"object":L=c?d.findOutputSlot(f.name):d.findInputSlot(f.name);break;case"number":L=f,f=c?d.outputs[f]:d.inputs[f];break;default:return(a=LiteGraph.warn)==null||a.call(LiteGraph,"Cant get slot information "+f),!1}(f===!1||L===!1)&&((r=LiteGraph.warn)==null||r.call(LiteGraph,"createDefaultNodeForSlot bad slotX "+f+" "+L));var g=f.type==LiteGraph.EVENT?"_event_":f.type,_=c?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(_&&_[g]){f.link;var b=!1;if(typeof _[g]=="object"){for(var G in _[g])if(p.nodeType==_[g][G]||p.nodeType=="AUTO"){b=_[g][G];break}}else(p.nodeType==_[g]||p.nodeType=="AUTO")&&(b=_[g]);if(b){var C=!1;typeof b=="object"&&b.node&&(C=b,b=b.node);var T=LiteGraph.createNode(b);if(T){if(C){if(C.properties)for(const[E,N]of Object.entries(C.properties))T.addProperty(E,N);C.inputs&&(T.inputs=[],Object.values(C.inputs).forEach(E=>{T.addOutput(E[0],E[1])})),C.outputs&&(T.outputs=[],Object.values(C.outputs).forEach(E=>{T.addOutput(E[0],E[1])})),C.title&&(T.title=C.title),C.json&&T.configure(C.json)}return h.graph.add(T),T.pos=[p.position[0]+p.posAdd[0]+(p.posSizeFix[0]?p.posSizeFix[0]*T.size[0]:0),p.position[1]+p.posAdd[1]+(p.posSizeFix[1]?p.posSizeFix[1]*T.size[1]:0)],c?p.nodeFrom.connectByType(L,T,g):p.nodeTo.connectByTypeOutput(L,T,g),!0}else(l=LiteGraph.warn)==null||l.call(LiteGraph,"failed creating "+b)}}return!1}function showConnectionMenu(n={}){var o,s,a=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},n),r=this,l=a.nodeFrom&&a.slotFrom,p=!l&&a.nodeTo&&a.slotTo;if(!l&&!p)return(o=LiteGraph.warn)==null||o.call(LiteGraph,"No data passed to showConnectionMenu"),!1;var h=l?a.nodeFrom:a.nodeTo,c=l?a.slotFrom:a.slotTo,u=!1;switch(typeof c){case"string":u=l?h.findOutputSlot(c,!1):h.findInputSlot(c,!1),c=l?h.outputs[c]:h.inputs[c];break;case"object":u=l?h.findOutputSlot(c.name):h.findInputSlot(c.name);break;case"number":u=c,c=l?h.outputs[c]:h.inputs[c];break;default:return(s=LiteGraph.warn)==null||s.call(LiteGraph,"Cant get slot information "+c),!1}var d=["Add Node",null];r.allow_searchbox&&(d.push("Search"),d.push(null));const f=c.type===LiteGraph.EVENT?"_event_":c.type,L=l?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(L&&L[f]){const _=L[f];Array.isArray(_)||typeof _=="object"?Object.values(_).forEach(b=>{d.push(b)}):d.push(_)}var g=new LiteGraph.ContextMenu(d,{event:a.e,title:(c&&c.name!=""?c.name+(f?" | ":""):"")+(c&&f?f:""),callback:(_,b,G)=>{const C={"Add Node":()=>{LGraphCanvas.onMenuAdd(null,null,G,g,T=>{l?a.nodeFrom.connectByType(u,T,f):a.nodeTo.connectByTypeOutput(u,T,f)})},Search:()=>{l?r.showSearchBox(G,{node_from:a.nodeFrom,slot_from:c,type_filter_in:f}):r.showSearchBox(G,{node_to:a.nodeTo,slot_from:c,type_filter_out:f})},default:()=>{r.createDefaultNodeForSlot(Object.assign(a,{position:[a.e.canvasX,a.e.canvasY],nodeType:_}))}};(C[_]||C.default)()}});return!1}function getCanvasMenuOptions(){var n=null;if(this.getMenuOptions?n=this.getMenuOptions():(n=[{content:"Add Node",has_submenu:!0,callback:LGraphCanvas.onMenuAdd},{content:"Add Group",callback:LGraphCanvas.onGroupAdd}],LiteGraph.showCanvasOptions&&n.push({content:"Options",callback:this.showShowGraphOptionsPanel}),Object.keys(this.selected_nodes).length>1&&n.push({content:"Align",has_submenu:!0,callback:LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&n.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var o=this.getExtraMenuOptions(this,n);o&&(n=n.concat(o))}return n}function getNodeMenuOptions(n){var o=null;if(n.getMenuOptions?o=n.getMenuOptions(this):(o=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:LGraphCanvas.onMenuNodeMode}],n.resizable!==!1&&o.push({content:"Resize",callback:LGraphCanvas.onMenuResizeNode}),o.push({content:"Collapse",callback:LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:LGraphCanvas.onMenuNodeShapes},null)),n.onGetInputs){var s=n.onGetInputs();s&&s.length&&(o[0].disabled=!1)}if(n.onGetOutputs){var a=n.onGetOutputs();a&&a.length&&(o[1].disabled=!1)}if(LiteGraph.do_add_triggers_slots&&(o[1].disabled=!1),n.getExtraMenuOptions){var r=n.getExtraMenuOptions(this,o);r&&(r.push(null),o=r.concat(o))}return n.clonable!==!1&&o.push({content:"Clone",callback:LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&o.push({content:"Align Selected To",has_submenu:!0,callback:LGraphCanvas.onNodeAlign}),o.push(null,{content:"Remove",disabled:!(n.removable!==!1&&!n.block_delete),callback:LGraphCanvas.onMenuNodeRemove}),n.graph&&n.graph.onGetNodeMenuOptions&&n.graph.onGetNodeMenuOptions(o,n),o}function getGroupMenuOptions(){var n=[{content:"Title",callback:LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:LGraphCanvas.onMenuNodeRemove}];return n}function processContextMenu(n,o){var s,a,r,l=this,p=LGraphCanvas.active_canvas,h=p.getCanvasWindow(),c=null,u={event:o,callback:_,extra:n};n&&(u.title=n.type);var d=null;if(n&&(d=n.getSlotInPosition(o.canvasX,o.canvasY),LGraphCanvas.active_node=n),d){if(c=[],n.getSlotMenuOptions)c=n.getSlotMenuOptions(d);else{((a=(s=d==null?void 0:d.output)==null?void 0:s.links)!=null&&a.length||(r=d.input)!=null&&r.link)&&c.push({content:"Disconnect Links",slot:d});var f=d.input||d.output;f.removable&&LiteGraph.canRemoveSlots&&c.push(f.locked?"Cannot remove":{content:"Remove Slot",slot:d}),!f.nameLocked&&LiteGraph.canRenameSlots&&c.push({content:"Rename Slot",slot:d})}var L=d.input||d.output;u.title=L.type||"*",L.type==LiteGraph.ACTION?u.title="Action":L.type==LiteGraph.EVENT&&(u.title="Event")}else if(n)c=this.getNodeMenuOptions(n);else{c=this.getCanvasMenuOptions();var g=this.graph.getGroupOnPos(o.canvasX,o.canvasY);g&&c.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:g,options:this.getGroupMenuOptions(g)}})}if(!c)return;new LiteGraph.ContextMenu(c,u,h);function _(b,G){if(!b)return;let C;if(b.content=="Remove Slot"){C=b.slot,n.graph.beforeChange(),C.input?n.removeInput(C.slot):C.output&&n.removeOutput(C.slot),n.graph.afterChange();return}else if(b.content=="Disconnect Links"){C=b.slot,n.graph.beforeChange(),C.output?n.disconnectOutput(C.slot):C.input&&n.disconnectInput(C.slot),n.graph.afterChange();return}else if(b.content=="Rename Slot"){C=b.slot;var T=C.input?n.getInputInfo(C.slot):n.getOutputInfo(C.slot),E=l.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",G),N=E.querySelector("input");N&&T&&(N.value=T.label||"");var A=function(){n.graph.beforeChange(),N.value&&(T&&(T.label=N.value),l.setDirty(!0)),E.close(),n.graph.afterChange()};E.querySelector("button").addEventListener("click",A),N.addEventListener("keydown",function(D){if(E.is_modified=!0,D.keyCode==27)E.close();else if(D.keyCode==13)A();else if(D.keyCode!=13&&D.target.localName!="textarea")return;D.preventDefault(),D.stopPropagation()}),N.focus()}}}function prompt(n="",o,s,a,r){var l,p=document.createElement("div");p.is_modified=!1,p.className="graphdialog rounded",r?p.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":p.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",p.close=()=>{var T;this.prompt_box=null,(T=p.parentNode)==null||T.removeChild(p)};var h=LGraphCanvas.active_canvas,c=h.canvas;c.parentNode.appendChild(p),this.ds.scale>1&&(p.style.transform=`scale(${this.ds.scale})`);var u=null,d=0;p.addEventListener("pointerleave",T=>{d>0||LiteGraph.dialog_close_on_mouse_leave&&!p.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(p.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),p.addEventListener("pointerenter",T=>{LiteGraph.dialog_close_on_mouse_leave&&u&&clearTimeout(u)});const f=p.querySelectorAll("select");f&&(d=0,f.forEach(T=>{T.addEventListener("pointerdown",E=>{d++}),T.addEventListener("focus",E=>{d++}),T.addEventListener("blur",E=>{d=Math.max(0,d-1)}),T.addEventListener("change",E=>{d=0})})),(l=this.prompt_box)==null||l.close(),this.prompt_box=p;var L=p.querySelector(".name");L.innerText=n;var g=p.querySelector(".value");g.value=o;const _=g;_.addEventListener("keydown",T=>{var E;switch(p.is_modified=!0,T.key){case"Escape":p.close();break;case"Enter":T.target.localName!=="textarea"&&typeof s=="function"&&(s(_.value),this.setDirty(!0)),(E=LiteGraph.debug)==null||E.call(LiteGraph,"prompt v2 ENTER",_.value,T.target.localName,s),p.close();break;default:return}T.preventDefault(),T.stopPropagation()}),p.querySelector("button").addEventListener("click",T=>{var E;typeof s=="function"&&(s(_.value),this.setDirty(!0)),(E=LiteGraph.debug)==null||E.call(LiteGraph,"prompt v2 OK",_.value,s),p.close()});var b=c.getBoundingClientRect(),G=-20,C=-20;return b&&(G-=b.left,C-=b.top),a?(p.style.left=a.clientX+G+"px",p.style.top=a.clientY+C+"px"):(p.style.left=c.width*.5+G+"px",p.style.top=c.height*.5+C+"px"),setTimeout(function(){_.focus()},10),p}function showSearchBox(n,o){var s={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled&&(Object.keys(LiteGraph.registered_slot_in_types||{}).length>0||Object.keys(LiteGraph.registered_slot_out_types||{}).length>0),type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};o=Object.assign(s,o||{});var a=this,r=LGraphCanvas.active_canvas,l=r.canvas,p=l.ownerDocument||document,h=document.createElement("div");if(h.className="litegraph litesearchbox graphdialog rounded",h.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",o.do_type_filter&&(h.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",h.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),o.show_close_button&&(h.innerHTML+="<button class='close_searchbox close'>X</button>"),h.innerHTML+="<div class='helper'></div>",p.fullscreenElement?p.fullscreenElement.appendChild(h):(p.body.appendChild(h),p.body.style.overflow="hidden"),o.do_type_filter)var c=h.querySelector(".slot_in_type_filter"),u=h.querySelector(".slot_out_type_filter");if(h.close=function(){a.search_box=null,this.blur(),l.focus(),p.body.style.overflow="",setTimeout(function(){a.canvas.focus()},20),h.parentNode&&h.parentNode.removeChild(h)},this.ds.scale>1&&(h.style.transform=`scale(${this.ds.scale})`),o.hide_on_mouse_leave){var d=0,f=null;if(h.addEventListener("pointerenter",function(O){f&&(clearTimeout(f),f=null)}),h.addEventListener("pointerleave",function(O){d>0||(f=setTimeout(function(){h.close()},500))}),o.do_type_filter){const O=function(S){S&&(S.addEventListener("pointerdown",function(k){d++}),S.addEventListener("focus",function(k){d++}),S.addEventListener("blur",function(k){d=Math.max(0,d-1)}),S.addEventListener("change",function(k){d=0}))};O(c),O(u)}}a.search_box&&a.search_box.close(),a.search_box=h;var L=h.querySelector(".helper"),g=null,_=null,b=null,G=h.querySelector("input");if(G&&(G.addEventListener("blur",function(O){a.search_box&&this.focus()}),G.addEventListener("keydown",function(O){if(O.key==="ArrowUp")D(!1);else if(O.key==="ArrowDown")D(!0);else if(O.key==="Escape")h.close();else if(O.key==="Enter")I(),b?A(b.innerHTML):g?A(g):h.close();else{_&&clearInterval(_),_=setTimeout(I,250);return}return O.preventDefault(),O.stopPropagation(),O.stopImmediatePropagation(),!0})),o.do_type_filter){if(c){let O=LiteGraph.slot_types_in,S=O.length;(o.type_filter_in==LiteGraph.EVENT||o.type_filter_in==LiteGraph.ACTION)&&(o.type_filter_in="_event_");for(let k=0;k<S;k++){let m=document.createElement("option");m.value=O[k],m.innerHTML=O[k],c.appendChild(m),o.type_filter_in!==!1&&(o.type_filter_in+"").toLowerCase()==(O[k]+"").toLowerCase()&&(m.selected=!0)}c.addEventListener("change",function(){I()})}if(u){let O=LiteGraph.slot_types_out,S=O.length;(o.type_filter_out==LiteGraph.EVENT||o.type_filter_out==LiteGraph.ACTION)&&(o.type_filter_out="_event_");for(let k=0;k<S;k++){let m=document.createElement("option");m.value=O[k],m.innerHTML=O[k],u.appendChild(m),o.type_filter_out!==!1&&(o.type_filter_out+"").toLowerCase()==(O[k]+"").toLowerCase()&&(m.selected=!0)}u.addEventListener("change",function(){I()})}}if(o.show_close_button){var C=h.querySelector(".close");C.addEventListener("click",h.close)}var T=l.getBoundingClientRect(),E=(n?n.clientX:T.left+T.width*.5)-80,N=(n?n.clientY:T.top+T.height*.5)-20;T.width-E<470&&(E=T.width-470),T.height-N<220&&(N=T.height-220),E<T.left+20&&(E=T.left+20),N<T.top+20&&(N=T.top+20),h.style.left=E+"px",h.style.top=N+"px",G.focus(),o.show_all_on_open&&I();function A(O){if(O)if(a.onSearchBoxSelection)a.onSearchBoxSelection(O,n,r);else{var S=LiteGraph.searchbox_extras[O.toLowerCase()];S&&(O=S.type),r.graph.beforeChange();var k=LiteGraph.createNode(O);if(k&&(k.pos=r.convertEventToCanvasOffset(n),r.graph.add(k,!1,{doProcessChange:!1})),S&&S.data){if(S.data.properties)for(let P in S.data.properties)k.addProperty(P,S.data.properties[P]);if(S.data.inputs){k.inputs=[];for(let P in S.data.inputs)k.addOutput(S.data.inputs[P][0],S.data.inputs[P][1])}if(S.data.outputs){k.outputs=[];for(let P in S.data.outputs)k.addOutput(S.data.outputs[P][0],S.data.outputs[P][1])}S.data.title&&(k.title=S.data.title),S.data.json&&k.configure(S.data.json)}let m;if(o.node_from){switch(m=!1,typeof o.slot_from){case"string":m=o.node_from.findOutputSlot(o.slot_from);break;case"object":o.slot_from.name?m=o.node_from.findOutputSlot(o.slot_from.name):m=-1,m==-1&&typeof o.slot_from.slot_index!="undefined"&&(m=o.slot_from.slot_index);break;case"number":m=o.slot_from;break;default:m=0}typeof o.node_from.outputs[m]!="undefined"&&m!==!1&&m>-1&&o.node_from.connectByType(m,k,o.node_from.outputs[m].type)}if(o.node_to){switch(m=!1,typeof o.slot_from){case"string":m=o.node_to.findInputSlot(o.slot_from);break;case"object":o.slot_from.name?m=o.node_to.findInputSlot(o.slot_from.name):m=-1,m==-1&&typeof o.slot_from.slot_index!="undefined"&&(m=o.slot_from.slot_index);break;case"number":m=o.slot_from;break;default:m=0}typeof o.node_to.inputs[m]!="undefined"&&m!==!1&&m>-1&&o.node_to.connectByTypeOutput(m,k,o.node_to.inputs[m].type)}r.graph.afterChange()}h.close()}function D(O){var S=b;b&&b.classList.remove("selected"),b?(b=O?b.nextSibling:b.previousSibling,b||(b=S)):b=O?L.childNodes[0]:L.childNodes[L.childNodes.length],b&&(b.classList.add("selected"),b.scrollIntoView({block:"end",behavior:"smooth"}))}function I(){_=null;var O=G.value;if(g=null,L.innerHTML="",!O&&!o.show_all_if_empty)return;if(a.onSearchBox){var S=a.onSearchBox(L,O,r);if(S)for(let B=0;B<S.length;++B)Z(S[B])}else{let B=function($,X={}){var pe={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},M=Object.assign(pe,X),W=LiteGraph.registered_node_types[$];if(m&&W.filter!=m||(!o.show_all_if_empty||O)&&$.toLowerCase().indexOf(O)===-1)return!1;if(o.do_type_filter&&!M.skipFilter){var Y=$;let Q;var F=R.value;if(M.inTypeOverride!==!1&&(F=M.inTypeOverride),R&&F&&LiteGraph.registered_slot_in_types[F]&&LiteGraph.registered_slot_in_types[F].nodes&&(Q=LiteGraph.registered_slot_in_types[F].nodes.includes(Y),Q===!1)||(F=U.value,M.outTypeOverride!==!1&&(F=M.outTypeOverride),U&&F&&LiteGraph.registered_slot_out_types[F]&&LiteGraph.registered_slot_out_types[F].nodes&&(Q=LiteGraph.registered_slot_out_types[F].nodes.includes(Y),Q===!1)))return!1}return!0};var k=0;O=O.toLowerCase();var m=r.filter||r.graph.filter;let R,U;o.do_type_filter&&a.search_box?(R=a.search_box.querySelector(".slot_in_type_filter"),U=a.search_box.querySelector(".slot_out_type_filter")):(R=!1,U=!1);for(let $ in LiteGraph.searchbox_extras){var P=LiteGraph.searchbox_extras[$];if(!((!o.show_all_if_empty||O)&&P.desc.toLowerCase().indexOf(O)===-1)){var j=LiteGraph.registered_node_types[P.type];if(!(j&&j.filter!=m)&&B(P.type)&&(Z(P.desc,"searchbox_extra"),LGraphCanvas.search_limit!==-1&&k++>LGraphCanvas.search_limit))break}}var V=null;if(Array.prototype.filter)V=Object.keys(LiteGraph.registered_node_types).filter(B);else{V=[];for(let $ in LiteGraph.registered_node_types)B($)&&V.push($)}for(let $=0;$<V.length&&(Z(V[$]),!(LGraphCanvas.search_limit!==-1&&k++>LGraphCanvas.search_limit));$++);if(o.show_general_after_typefiltered&&(R.value||U.value)){var q=[];for(let $ in LiteGraph.registered_node_types)B($,{inTypeOverride:R&&R.value?"*":!1,outTypeOverride:U&&U.value?"*":!1})&&q.push($);for(let $=0;$<q.length&&(Z(q[$],"generic_type"),!(LGraphCanvas.search_limit!==-1&&k++>LGraphCanvas.search_limit));$++);}if((R.value||U.value)&&L.childNodes.length==0&&o.show_general_if_none_on_typefilter){var q=[];for(let X in LiteGraph.registered_node_types)B(X,{skipFilter:!0})&&q.push(X);for(let X=0;X<q.length&&(Z(q[X],"not_in_filter"),!(LGraphCanvas.search_limit!==-1&&k++>LGraphCanvas.search_limit));X++);}}function Z(B,R){var U=document.createElement("div");g||(g=B),U.innerText=B,U.dataset.type=encodeURIComponent(B),U.className="litegraph lite-search-item",R&&(U.className+=" "+R),U.addEventListener("click",function($){A(decodeURIComponent(this.dataset.type))}),L.appendChild(U)}}return h}function showEditPropertyValue(n,o,s){var a,r,l,p,h;if(!n||n.properties[o]===void 0)return;s=s||{};var c=n.getPropertyInfo(o),u=c.type;let d;if(u=="string"||u=="number"||u=="array"||u=="object")d="<input autofocus type='text' class='value'/>";else if((u=="enum"||u=="combo")&&c.values){(a=LiteGraph.debug)==null||a.call(LiteGraph,"CREATING showEditPropertyValue ENUM COMBO",g,u,L),d="<select autofocus type='text' class='value'>";for(let C in c.values){var f=C;c.values.constructor===Array&&(f=c.values[C]),d+="<option value='"+f+"' "+(f==n.properties[o]?"selected":"")+">"+c.values[C]+"</option>"}d+="</select>"}else if(u=="boolean"||u=="toggle")d="<input autofocus type='checkbox' class='value' "+(n.properties[o]?"checked":"")+"/>";else{(r=LiteGraph.warn)==null||r.call(LiteGraph,"unknown type: "+u);return}var L=this.createDialog("<span class='name'>"+(c.label?c.label:o)+"</span>"+d+"<button>OK</button>",s),g=!1;(u=="enum"||u=="combo")&&c.values?((l=LiteGraph.debug)==null||l.call(LiteGraph,"showEditPropertyValue ENUM COMBO",g,u,L),g=L.querySelector("select"),g.addEventListener("change",function(C){var T;L.modified(),(T=LiteGraph.debug)==null||T.call(LiteGraph,"Enum change",g,c,C.target),G(C.target.value)})):u=="boolean"||u=="toggle"?((p=LiteGraph.debug)==null||p.call(LiteGraph,"showEditPropertyValue TOGGLE",g,u,L),g=L.querySelector("input"),g&&g.addEventListener("click",function(C){L.modified(),G(!!g.checked)})):(g=L.querySelector("input"),(h=LiteGraph.debug)==null||h.call(LiteGraph,"showEditPropertyValue",g,u,L),g&&(g.addEventListener("blur",function(C){this.focus()}),f=n.properties[o]!==void 0?n.properties[o]:"",u!=="string"&&(f=JSON.stringify(f)),g.value=f,g.addEventListener("keydown",function(C){if(C.keyCode==27)L.close();else if(C.keyCode==13)b();else if(C.keyCode!=13){L.modified();return}C.preventDefault(),C.stopPropagation()}))),g&&g.focus();var _=L.querySelector("button");_.addEventListener("click",b);function b(){G(g.value)}function G(C){var T;c&&c.values&&c.values.constructor===Object&&c.values[C]!=null&&(C=c.values[C]),typeof n.properties[o]=="number"&&(C=Number(C)),(u=="array"||u=="object")&&(C=JSON.parse(C)),n.properties[o]=C,(T=n.graph)==null||T.onGraphChanged({action:"propertyChanged",doSave:!0}),n.onPropertyChanged&&n.onPropertyChanged(o,C),s.onclose&&s.onclose(),L.close(),n.setDirtyCanvas(!0,!0)}return L}function createDialog(n,o){var s={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};o=Object.assign(s,o||{});var a=document.createElement("div");a.className="graphdialog",a.innerHTML=n,a.is_modified=!1;var r=this.canvas.getBoundingClientRect(),l=-20,p=-20;if(r&&(l-=r.left,p-=r.top),o.position?(l+=o.position[0],p+=o.position[1]):o.event?(l+=o.event.clientX,p+=o.event.clientY):(l+=this.canvas.width*.5,p+=this.canvas.height*.5),a.style.left=l+"px",a.style.top=p+"px",this.canvas.parentNode.appendChild(a),o.checkForInput){var h=[],c=!1;h=a.querySelectorAll("input"),h&&h.forEach(function(L){L.addEventListener("keydown",function(g){if(a.modified(),g.keyCode==27)a.close();else if(g.keyCode!=13)return;g.preventDefault(),g.stopPropagation()}),c||L.focus()})}a.modified=function(){a.is_modified=!0},a.close=function(){a.parentNode&&a.parentNode.removeChild(a)};var u=null,d=0;a.addEventListener("pointerleave",function(L){d>0||(o.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!a.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(a.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),a.addEventListener("pointerenter",function(L){(o.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&u&&clearTimeout(u)});var f=a.querySelectorAll("select");return f&&f.forEach(function(L){L.addEventListener("pointerdown",function(g){d++}),L.addEventListener("focus",function(g){d++}),L.addEventListener("blur",function(g){d=Math.max(0,d-1)}),L.addEventListener("change",function(g){d=0})}),a}function createPanel(n,o){o=o||{};var s=o.window||window,a=document.createElement("div");if(a.className="litegraph dialog",a.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",a.header=a.querySelector(".dialog-header"),o.width&&(a.style.width=o.width+(o.width.constructor===Number?"px":"")),o.height&&(a.style.height=o.height+(o.height.constructor===Number?"px":"")),o.closable){var r=document.createElement("span");r.innerHTML="&#10005;",r.classList.add("close"),r.addEventListener("click",function(){a.close()}),a.header.appendChild(r)}return a.title_element=a.querySelector(".dialog-title"),a.title_element.innerText=n,a.content=a.querySelector(".dialog-content"),a.alt_content=a.querySelector(".dialog-alt-content"),a.footer=a.querySelector(".dialog-footer"),a.close=function(){a.onClose&&typeof a.onClose=="function"&&a.onClose(),a.parentNode&&a.parentNode.removeChild(a)},a.toggleAltContent=function(l){let p,h;typeof l!="undefined"?(p=l?"block":"none",h=l?"none":"block"):(p=a.alt_content.style.display!="block"?"block":"none",h=a.alt_content.style.display!="block"?"none":"block"),a.alt_content.style.display=p,a.content.style.display=h},a.toggleFooterVisibility=function(l){let p;typeof l!="undefined"?p=l?"block":"none":p=a.footer.style.display!="block"?"block":"none",a.footer.style.display=p},a.clear=function(){this.content.innerHTML=""},a.addHTML=function(l,p,h){var c=document.createElement("div");return p&&(c.className=p),c.innerHTML=l,h?a.footer.appendChild(c):a.content.appendChild(c),c},a.addButton=function(l,p,h){var c=document.createElement("button");return c.innerText=l,c.options=h,c.classList.add("btn"),c.addEventListener("click",p),a.footer.appendChild(c),c},a.addSeparator=function(){var l=document.createElement("div");l.className="separator",a.content.appendChild(l)},a.addWidget=function(l,p,h,c,u){var d,f;c=c||{};var L=String(h);l=l.toLowerCase(),l=="number"&&(L=h.toFixed(3));var g=document.createElement("div");g.className="property",g.innerHTML="<span class='property_name'></span><span class='property_value'></span>",g.querySelector(".property_name").innerText=c.label||p;var _=g.querySelector(".property_value");_.innerText=L,g.dataset.property=p,g.dataset.type=c.type||l,g.options=c,g.value=h,(d=LiteGraph.debug)==null||d.call(LiteGraph,"addWidget",l,h,_,c),l=="code"?g.addEventListener("click",function(G){a.inner_showCodePad(this.dataset.property)}):l=="boolean"?(g.classList.add("boolean"),h&&g.classList.add("bool-on"),g.addEventListener("click",function(){var G=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",b(G,this.value)})):l=="string"||l=="number"?(_.setAttribute("contenteditable",!0),_.addEventListener("keydown",function(G){G.code=="Enter"&&(l!="string"||!G.shiftKey)&&(G.preventDefault(),this.blur())}),_.addEventListener("blur",function(){var G=this.innerText,C=this.parentNode.dataset.property,T=this.parentNode.dataset.type;T=="number"&&(G=Number(G)),b(C,G)})):(l=="enum"||l=="combo")&&(L=LGraphCanvas.getPropertyPrintableValue(h,c.values),_.innerText=L,(f=LiteGraph.debug)==null||f.call(LiteGraph,"addWidget ENUM COMBO",l,L,_,c),_.addEventListener("click",function(G){var C=c.values||[],T=this.parentNode.dataset.property,E=this;new LiteGraph.ContextMenu(C,{event:G,className:"dark",callback:N},s);function N(A){return E.innerText=A,b(T,A),!1}})),a.content.appendChild(g);function b(G,C){var T;(T=LiteGraph.debug)==null||T.call(LiteGraph,"widgetInnerChange",G,C,c),c.callback&&c.callback(G,C,c),u&&u(G,C,c)}return g},a.onOpen&&typeof a.onOpen=="function"&&a.onOpen(),a}function closePanels(){var n=document.querySelector("#node-panel");n&&n.close(),n=document.querySelector("#option-panel"),n&&n.close()}function showShowGraphOptionsPanel(n,o){var s,a,r,l;let p;if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!((a=(s=o==null?void 0:o.event)==null?void 0:s.target)!=null&&a.lgraphcanvas)){(r=LiteGraph.warn)==null||r.call(LiteGraph,"References not found to add optionPanel",n,o),LiteGraph.debug&&((l=LiteGraph.debug)==null||l.call(LiteGraph,"!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas",o,o.event,o.event.target,o.event.target.lgraphcanvas));return}p=o.event.target.lgraphcanvas}else p=this;p.closePanels();var h=p.getCanvasWindow();panel=p.createPanel("Options",{closable:!0,window:h,onOpen:function(){p.OPTIONPANEL_IS_OPEN=!0},onClose:function(){p.OPTIONPANEL_IS_OPEN=!1,p.options_panel=null}}),p.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function c(){panel.content.innerHTML="";const u=(g,_,b)=>{b&&b.key&&(g=b.key),b.values&&(_=Object.values(b.values).indexOf(_)),p[g]=_};var d=LiteGraph.availableCanvasOptions;d.sort();for(var f in d){var L=d[f];panel.addWidget("boolean",L,p[L],{key:L,on:"True",off:"False"},u)}panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[p.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},u),panel.addSeparator(),panel.footer.innerHTML=""}c(),p.canvas.parentNode.appendChild(panel)}function showShowNodePanel(n){this.SELECTED_NODE=n,this.closePanels();var o=this.getCanvasWindow(),s=this,a=this.createPanel(n.title||"",{closable:!0,window:o,onOpen:function(){s.NODEPANEL_IS_OPEN=!0},onClose:function(){s.NODEPANEL_IS_OPEN=!1,s.node_panel=null}});s.node_panel=a,a.id="node-panel",a.node=n,a.classList.add("settings");function r(){a.content.innerHTML="",a.addHTML("<span class='node_type'>"+n.type+"</span><span class='node_desc'>"+(n.constructor.desc||"")+"</span><span class='separator'></span>"),a.addHTML("<h3>Properties</h3>");const l=(d,f)=>{var L,g;switch(s.graph.beforeChange(n),d){case"Title":n.title=f;break;case"Mode":var _=Object.values(LiteGraph.NODE_MODES).indexOf(f);_>=0&&LiteGraph.NODE_MODES[_]?n.changeMode(_):(L=LiteGraph.warn)==null||L.call(LiteGraph,"unexpected mode: "+f);break;case"Color":LGraphCanvas.node_colors[f]?(n.color=LGraphCanvas.node_colors[f].color,n.bgcolor=LGraphCanvas.node_colors[f].bgcolor):(g=LiteGraph.warn)==null||g.call(LiteGraph,"unexpected color: "+f);break;default:n.setProperty(d,f);break}s.graph.afterChange(),s.dirty_canvas=!0};a.addWidget("string","Title",n.title,{},l),a.addWidget("combo","Mode",LiteGraph.NODE_MODES[n.mode],{values:LiteGraph.NODE_MODES},l);var p="";n.color!==void 0&&(p=Object.keys(LGraphCanvas.node_colors).filter(function(d){return LGraphCanvas.node_colors[d].color==n.color})),a.addWidget("combo","Color",p,{values:Object.keys(LGraphCanvas.node_colors)},l);for(var h in n.properties){var c=n.properties[h],u=n.getPropertyInfo(h);n.onAddPropertyToPanel&&n.onAddPropertyToPanel(h,a,c,u,l)||a.addWidget(u.widget||u.type,h,c,u,l)}a.addSeparator(),n.onShowCustomPanelInfo&&n.onShowCustomPanelInfo(a),a.footer.innerHTML="",a.addButton("Delete",function(){n.block_delete||(n.graph.remove(n),a.close())}).classList.add("delete")}a.inner_showCodePad=function(l){a.classList.remove("settings"),a.classList.add("centered"),a.alt_content.innerHTML="<textarea class='code'></textarea>";var p=a.alt_content.querySelector("textarea"),h=()=>{a.toggleAltContent(!1),a.toggleFooterVisibility(!0),p.parentNode.removeChild(p),a.classList.add("settings"),a.classList.remove("centered"),r()};p.value=n.properties[l],p.addEventListener("keydown",function(d){d.code=="Enter"&&d.ctrlKey&&(n.setProperty(l,p.value),h())}),a.toggleAltContent(!0),a.toggleFooterVisibility(!1),p.style.height="calc(100% - 40px)";var c=a.addButton("Assign",function(){n.setProperty(l,p.value),h()});a.alt_content.appendChild(c);var u=a.addButton("Close",h);u.style.float="right",a.alt_content.appendChild(u)},r(),this.canvas.parentNode.appendChild(a)}function showSubgraphPropertiesDialog(n){var o;(o=LiteGraph.log)==null||o.call(LiteGraph,"showing subgraph properties dialog");var s=this.canvas.parentNode.querySelector(".subgraph_dialog");s&&s.close();var a=this.createPanel("Subgraph Inputs",{closable:!0,width:500});a.node=n,a.classList.add("subgraph_dialog");function r(){if(a.clear(),n.inputs)for(let d=0;d<n.inputs.length;++d){var h=n.inputs[d];if(!h.not_subgraph_input){var c="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",u=a.addHTML(c,"subgraph_property");u.dataset.name=h.name,u.dataset.slot=d,u.querySelector(".name").innerText=h.name,u.querySelector(".type").innerText=h.type,u.querySelector("button").addEventListener("click",function(f){n.removeInput(Number(this.parentNode.dataset.slot)),r()})}}}var l=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",p=a.addHTML(l,"subgraph_property extra",!0);return p.querySelector("button").addEventListener("click",function(h){var c=this.parentNode,u=c.querySelector(".name").value,d=c.querySelector(".type").value;!u||n.findInputSlot(u)!=-1||(n.addInput(u,d),c.querySelector(".name").value="",c.querySelector(".type").value="",r())}),r(),this.canvas.parentNode.appendChild(a),a}function showSubgraphPropertiesDialogRight(n){var o=this.canvas.parentNode.querySelector(".subgraph_dialog");o&&o.close();var s=this.createPanel("Subgraph Outputs",{closable:!0,width:500});s.node=n,s.classList.add("subgraph_dialog");function a(){if(s.clear(),n.outputs)for(let d=0;d<n.outputs.length;++d){var h=n.outputs[d];if(!h.not_subgraph_output){var c="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",u=s.addHTML(c,"subgraph_property");u.dataset.name=h.name,u.dataset.slot=d,u.querySelector(".name").innerText=h.name,u.querySelector(".type").innerText=h.type,u.querySelector("button").addEventListener("click",function(f){n.removeOutput(Number(this.parentNode.dataset.slot)),a()})}}}var r=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",l=s.addHTML(r,"subgraph_property extra",!0);l.querySelector(".name").addEventListener("keydown",function(h){e.keyCode==13&&p.apply(this)}),l.querySelector("button").addEventListener("click",function(h){p.apply(this)});function p(){var h=this.parentNode,c=h.querySelector(".name").value,u=h.querySelector(".type").value;!c||n.findOutputSlot(c)!=-1||(n.addOutput(c,u),h.querySelector(".name").value="",h.querySelector(".type").value="",a())}return a(),this.canvas.parentNode.appendChild(s),s}function checkPanels(){if(this.canvas){var n=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(let s=0;s<n.length;++s){var o=n[s];o.node&&(!o.node.graph||o.graph!=this.graph)&&o.close()}}}class UiController{constructor(o){this.host=o}showLinkMenu(...o){return showLinkMenu.apply(this.host,o)}createDefaultNodeForSlot(...o){return createDefaultNodeForSlot.apply(this.host,o)}showConnectionMenu(...o){return showConnectionMenu.apply(this.host,o)}getCanvasMenuOptions(...o){return getCanvasMenuOptions.apply(this.host,o)}getNodeMenuOptions(...o){return getNodeMenuOptions.apply(this.host,o)}getGroupMenuOptions(...o){return getGroupMenuOptions.apply(this.host,o)}processContextMenu(...o){return processContextMenu.apply(this.host,o)}prompt(...o){return prompt.apply(this.host,o)}showSearchBox(...o){return showSearchBox.apply(this.host,o)}showEditPropertyValue(...o){return showEditPropertyValue.apply(this.host,o)}createDialog(...o){return createDialog.apply(this.host,o)}createPanel(...o){return createPanel.apply(this.host,o)}closePanels(...o){return closePanels.apply(this.host,o)}showShowGraphOptionsPanel(...o){return showShowGraphOptionsPanel.apply(this.host,o)}showShowNodePanel(...o){return showShowNodePanel.apply(this.host,o)}showSubgraphPropertiesDialog(...o){return showSubgraphPropertiesDialog.apply(this.host,o)}showSubgraphPropertiesDialogRight(...o){return showSubgraphPropertiesDialogRight.apply(this.host,o)}checkPanels(...o){return checkPanels.apply(this.host,o)}}function createLGraphCanvasControllers(n){return{core:new CoreController(n),events:new EventsController(n),render:new RenderController(n),selection:new SelectionController(n),ui:new UiController(n)}}const delegateMap={clear:"core",setGraph:"core",getTopGraph:"core",openSubgraph:"core",closeSubgraph:"core",getCurrentGraph:"core",setCanvas:"core",_doNothing:"core",_doReturnTrue:"core",bindEvents:"core",unbindEvents:"core",enableWebGL:"core",setDirty:"core",getCanvasWindow:"core",startRendering:"core",stopRendering:"core",blockClick:"events",processUserInputDown:"events",processMouseDown:"events",processMouseMove:"events",processMouseUp:"events",processMouseWheel:"events",isOverNodeBox:"core",isOverNodeInput:"core",isOverNodeOutput:"core",processKey:"events",copyToClipboard:"selection",pasteFromClipboard:"selection",processDrop:"events",checkDropItem:"events",processNodeDblClicked:"selection",processNodeSelected:"selection",selectNode:"selection",selectNodes:"selection",deselectNode:"selection",deselectAllNodes:"selection",deleteSelectedNodes:"selection",centerOnNode:"core",adjustMouseEvent:"core",setZoom:"core",convertOffsetToCanvas:"core",convertCanvasToOffset:"core",convertEventToCanvasOffset:"core",bringToFront:"core",sendToBack:"core",computeVisibleNodes:"core",draw:"render",drawFrontCanvas:"render",drawSubgraphPanel:"render",drawSubgraphPanelLeft:"render",drawSubgraphPanelRight:"render",drawButton:"render",isAreaClicked:"render",renderInfo:"render",drawBackCanvas:"render",drawNode:"render",drawNodeTooltip:"render",drawLinkTooltip:"render",drawNodeShape:"render",drawConnections:"render",renderLink:"render",computeConnectionPoint:"render",drawExecutionOrder:"render",drawNodeWidgets:"render",processNodeWidgets:"render",drawGroups:"render",adjustNodesSize:"render",resize:"core",switchLiveMode:"core",onNodeSelectionChange:"selection",boundaryNodesForSelection:"selection",showLinkMenu:"ui",createDefaultNodeForSlot:"ui",showConnectionMenu:"ui",prompt:"ui",showSearchBox:"ui",showEditPropertyValue:"ui",createDialog:"ui",createPanel:"ui",closePanels:"ui",showShowGraphOptionsPanel:"ui",showShowNodePanel:"ui",showSubgraphPropertiesDialog:"ui",showSubgraphPropertiesDialogRight:"ui",checkPanels:"ui",getCanvasMenuOptions:"ui",getNodeMenuOptions:"ui",getGroupMenuOptions:"ui",processContextMenu:"ui",lowQualityRenderingRequired:"render"};function ensureControllers(n){return n.controllers||(n.controllers=createLGraphCanvasControllers(n)),n.controllers}function installLGraphCanvasDelegates(n){for(const[o,s]of Object.entries(delegateMap))Object.defineProperty(n.prototype,o,{value:function(...a){return ensureControllers(this)[s][o](...a)},writable:!0,configurable:!0})}function getFileExtension(n){const o=new URL(n).pathname,s=o.lastIndexOf(".");return s===-1?"":o.slice(s+1).toLowerCase()}function onGroupAdd(n,o,s){var a=LGraphCanvas.active_canvas,r=new LiteGraph.LGraphGroup;r.pos=a.convertEventToCanvasOffset(s),a.graph.add(r)}function getBoundaryNodes(n){let o=null,s=null,a=null,r=null;for(const l in n){const p=n[l],[h,c]=p.pos,[u,d]=p.size;(o===null||c<o.pos[1])&&(o=p),(s===null||h+u>s.pos[0]+s.size[0])&&(s=p),(a===null||c+d>a.pos[1]+a.size[1])&&(a=p),(r===null||h<r.pos[0])&&(r=p)}return{top:o,right:s,bottom:a,left:r}}function alignNodes(n,o,s){if(!n)return;const a=LGraphCanvas.active_canvas;let r=[];s===void 0?r=LGraphCanvas.getBoundaryNodes(n):r={top:s,right:s,bottom:s,left:s};for(const[l,p]of Object.entries(a.selected_nodes))switch(o){case"right":p.pos[0]=r.right.pos[0]+r.right.size[0]-p.size[0];break;case"left":p.pos[0]=r.left.pos[0];break;case"top":p.pos[1]=r.top.pos[1];break;case"bottom":p.pos[1]=r.bottom.pos[1]+r.bottom.size[1]-p.size[1];break}a.dirty_canvas=!0,a.dirty_bgcanvas=!0}function onNodeAlign(n,o,s,a,r){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:l,parentMenu:a});function l(p){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,p.toLowerCase(),r)}}function onGroupAlign(n,o,s,a){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:s,callback:r,parentMenu:a});function r(l){LGraphCanvas.alignNodes(LGraphCanvas.active_canvas.selected_nodes,l.toLowerCase())}}function onMenuAdd(n,o,s,a,r){var l=LGraphCanvas.active_canvas,p=l.getCanvasWindow(),h=l.graph;if(!h)return;function c(u,d){var f=LiteGraph.getNodeTypesCategories(l.filter||h.filter).filter(function(_){return _.startsWith(u)}),L=[];f.map(function(_){if(_){var b=new RegExp("^("+u+")"),G=_.replace(b,"").split("/")[0],C=u===""?G+"/":u+G+"/",T=G;T.indexOf("::")!=-1&&(T=T.split("::")[1]);var E=L.findIndex(function(N){return N.value===C});E===-1&&L.push({value:C,content:T,has_submenu:!0,callback:function(N,A,D,I){c(N.value,I)}})}});var g=LiteGraph.getNodeTypesInCategory(u.slice(0,-1),l.filter||h.filter);g.map(function(_){if(!_.skip_list){var b={value:_.type,content:_.title,has_submenu:!1,callback:function(G,C,T,E){var N=E.getFirstEvent();l.graph.beforeChange();var A=LiteGraph.createNode(G.value);A&&(A.pos=l.convertEventToCanvasOffset(N),l.graph.add(A)),r&&r(A),l.graph.afterChange()}};L.push(b)}}),new LiteGraph.ContextMenu(L,{event:s,parentMenu:d},p)}return c("",a),!1}function onMenuCollapseAll(){}function onMenuNodeEdit(){}function showMenuNodeOptionalInputs(n,o,s,a,r){var l;if(!r)return;var p=this,h=LGraphCanvas.active_canvas,c=h.getCanvasWindow();o=r.optional_inputs,r.onGetInputs&&(o=r.onGetInputs());var u=[];if(o)for(let b=0;b<o.length;b++){var d=o[b];if(!d){u.push(null);continue}var f=d[0];d[2]||(d[2]={}),d[2].label&&(f=d[2].label),d[2].removable=!0;var L={content:f,value:d};d[1]==LiteGraph.ACTION&&(L.className="event"),u.push(L)}if(r.onMenuNodeInputs){var g=r.onMenuNodeInputs(u);g&&(u=g)}if(LiteGraph.do_add_triggers_slots&&r.findInputSlot("onTrigger")==-1&&u.push({content:"On Trigger",value:["onTrigger",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),!u.length){LiteGraph.debug&&((l=LiteGraph.log)==null||l.call(LiteGraph,"no input entries"));return}new LiteGraph.ContextMenu(u,{event:s,callback:_,parentMenu:a,node:r},c);function _(b,G,C){var T;if(r&&(b.callback&&b.callback.call(p,r,b,G,C),b.value)){r.graph.beforeChange();const E=b.value[2]?Object.assign({},b.value[2]):{};r.addInput(b.value[0],b.value[1],E),(T=r.onNodeInputAdd)==null||T.call(r,b.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()}}return!1}function showMenuNodeOptionalOutputs(n,o,s,a,r){if(!r)return;var l=this,p=LGraphCanvas.active_canvas,h=p.getCanvasWindow();o=r.optional_outputs,r.onGetOutputs&&(o=r.onGetOutputs());var c=[];if(o)for(let _=0;_<o.length;_++){var u=o[_];if(!u){c.push(null);continue}if(!(r.flags&&r.flags.skip_repeated_outputs&&r.findOutputSlot(u[0])!=-1)){var d=u[0];u[2]||(u[2]={}),u[2].label&&(d=u[2].label),u[2].removable=!0;var f={content:d,value:u};u[1]==LiteGraph.EVENT&&(f.className="event"),c.push(f)}}if(this.onMenuNodeOutputs&&(c=this.onMenuNodeOutputs(c)),LiteGraph.do_add_triggers_slots&&r.findOutputSlot("onExecuted")==-1&&c.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),r.onMenuNodeOutputs){var L=r.onMenuNodeOutputs(c);L&&(c=L)}if(!c.length)return;new LiteGraph.ContextMenu(c,{event:s,callback:g,parentMenu:a,node:r},h);function g(_,b,G){var C;if(r&&(_.callback&&_.callback.call(l,r,_,b,G),!!_.value)){var T=_.value[1];if(T&&(T.constructor===Object||T.constructor===Array)){var E=[];for(let N in T)E.push({content:N,value:T[N]});return new LiteGraph.ContextMenu(E,{event:b,callback:g,parentMenu:a,node:r}),!1}else{r.graph.beforeChange();const N=_.value[2]?Object.assign({},_.value[2]):{};r.addOutput(_.value[0],_.value[1],N),(C=r.onNodeOutputAdd)==null||C.call(r,_.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()}}}return!1}function onShowMenuNodeProperties(n,o,s,a,r){if(!r||!r.properties)return;var l=LGraphCanvas.active_canvas,p=l.getCanvasWindow(),h=[];for(let d in r.properties){n=r.properties[d]!==void 0?r.properties[d]:" ",typeof n=="object"&&(n=JSON.stringify(n));var c=r.getPropertyInfo(d);(c.type=="enum"||c.type=="combo")&&(n=LGraphCanvas.getPropertyPrintableValue(n,c.values)),n=LGraphCanvas.decodeHTML(n),h.push({content:"<span class='property_name'>"+(c.label?c.label:d)+"</span><span class='property_value'>"+n+"</span>",value:d})}if(!h.length)return;new LiteGraph.ContextMenu(h,{event:s,callback:u,parentMenu:a,allow_html:!0,node:r},p);function u(d){if(r){var f=this.getBoundingClientRect();l.showEditPropertyValue(r,d.value,{position:[f.left,f.top]})}}return!1}function decodeHTML(n){var o=document.createElement("div");return o.innerText=n,o.innerHTML}function onMenuResizeNode(n,o,s,a,r){if(!r)return;const l=h=>{h.size=h.computeSize(),h.onResize&&h.onResize(h.size)};var p=LGraphCanvas.active_canvas;if(!p.selected_nodes||Object.keys(p.selected_nodes).length<=1)l(r);else for(let h in p.selected_nodes)l(p.selected_nodes[h]);r.setDirtyCanvas(!0,!0)}function onShowPropertyEditor(n,o,s,a,r){var l=n.property||"title",p=r[l],h=document.createElement("div");h.is_modified=!1,h.className="graphdialog",h.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",h.close=()=>{var E;(E=h.parentNode)==null||E.removeChild(h)};var c=h.querySelector(".name");c.innerText=l;var u=h.querySelector(".value");const d=()=>{u&&T(u.value)};u&&(u.value=p,u.addEventListener("blur",function(E){this.focus()}),u.addEventListener("keydown",function(E){if(h.is_modified=!0,E.keyCode==27)h.close();else if(E.keyCode==13)d();else if(E.keyCode!=13&&E.target.localName!="textarea")return;E.preventDefault(),E.stopPropagation()}));var f=LGraphCanvas.active_canvas,L=f.canvas,g=L.getBoundingClientRect(),_=-20,b=-20;g&&(_-=g.left,b-=g.top),event?(h.style.left=event.clientX+_+"px",h.style.top=event.clientY+b+"px"):(h.style.left=L.width*.5+_+"px",h.style.top=L.height*.5+b+"px");var G=h.querySelector("button");G.addEventListener("click",d),L.parentNode.appendChild(h),u&&u.focus();let C=null;h.addEventListener("pointerleave",E=>{LiteGraph.dialog_close_on_mouse_leave&&!h.is_modified&&(C=setTimeout(h.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),h.addEventListener("pointerenter",E=>{LiteGraph.dialog_close_on_mouse_leave&&C&&clearTimeout(C)});const T=E=>{var N;switch(n.type){case"Number":E=Number(E);break;case"Boolean":E=!!E;break}r[l]=E,(N=h.parentNode)==null||N.removeChild(h),r.setDirtyCanvas(!0,!0)}}function getPropertyPrintableValue(n,o){if(!o||o.constructor===Array)return String(n);if(o.constructor===Object){var s="";for(var a in o)if(o[a]==n){s=a;break}return String(n)+" ("+s+")"}}function onMenuNodeCollapse(n,o,s,a,r){r.graph.beforeChange();var l=function(h){h.collapse()},p=LGraphCanvas.active_canvas;if(!p.selected_nodes||Object.keys(p.selected_nodes).length<=1)l(r);else for(let h in p.selected_nodes)l(p.selected_nodes[h]);r.graph.afterChange()}function onMenuNodePin(n,o,s,a,r){r.pin()}function onMenuNodeMode(n,o,s,a,r){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:s,callback:l,parentMenu:a,node:r});function l(p){if(!r)return;var h=Object.values(LiteGraph.NODE_MODES).indexOf(p);const c=d=>{var f;h>=0&&LiteGraph.NODE_MODES[h]?d.changeMode(h):((f=LiteGraph.warn)==null||f.call(LiteGraph,"unexpected mode: "+p),d.changeMode(LiteGraph.ALWAYS))};var u=LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)c(r);else for(let d in u.selected_nodes)c(u.selected_nodes[d])}return!1}function onMenuNodeColors(n,o,s,a,r){if(!r)throw new Error("no node for color");var l=[];l.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(let h in LGraphCanvas.node_colors){let c=LGraphCanvas.node_colors[h];n={value:h,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+c.color+"; background-color:"+c.bgcolor+"'>"+h+"</span>"},l.push(n)}new LiteGraph.ContextMenu(l,{event:s,callback:p,parentMenu:a,node:r});function p(h){if(!r)return;let c=h.value?LGraphCanvas.node_colors[h.value]:null;const u=f=>{c?f.constructor===LiteGraph.LGraphGroup?f.color=c.groupcolor:(f.color=c.color,f.bgcolor=c.bgcolor):(delete f.color,delete f.bgcolor)};var d=LGraphCanvas.active_canvas;if(!d.selected_nodes||Object.keys(d.selected_nodes).length<=1)u(r);else for(let f in d.selected_nodes)u(d.selected_nodes[f]);r.setDirtyCanvas(!0,!0)}return!1}function onMenuNodeShapes(n,o,s,a,r){if(!r)throw new Error("no node passed");new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:s,callback:l,parentMenu:a,node:r});function l(p){if(!r)return;r.graph.beforeChange();const h=u=>{u.shape=p};var c=LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)h(r);else for(let u in c.selected_nodes)h(c.selected_nodes[u]);r.graph.afterChange(),r.setDirtyCanvas(!0)}return!1}function onMenuNodeRemove(n,o,s,a,r){if(!r)throw new Error("no node passed");var l=r.graph;l.beforeChange();const p=c=>{c.removable!==!1&&l.remove(c)};var h=LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)p(r);else for(let c in h.selected_nodes)p(h.selected_nodes[c]);l.afterChange(),r.setDirtyCanvas(!0,!0)}function onMenuNodeToSubgraph(n,o,s,a,r){var l=r.graph,p=LGraphCanvas.active_canvas;if(p){var h=Object.values(p.selected_nodes||{});h.length||(h=[r]);var c=LiteGraph.createNode("graph/subgraph");c.pos=r.pos.concat(),l.add(c),c.buildFromNodes(h),p.deselectAllNodes(),r.setDirtyCanvas(!0,!0)}}function onMenuNodeClone(n,o,s,a,r){r.graph.beforeChange();var l={};const p=c=>{if(c.clonable!==!1){var u=c.clone();u&&(u.pos=[c.pos[0]+5,c.pos[1]+5],c.graph.add(u),l[u.id]=u)}};var h=LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)p(r);else for(let c in h.selected_nodes)p(h.selected_nodes[c]);Object.keys(l).length&&h.selectNodes(l),r.graph.afterChange(),r.setDirtyCanvas(!0,!0)}const DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=",link_type_colors={"-1":"#A86",number:"#AAA",node:"#DCA",string:"#77F",boolean:"#F77"},gradients={},search_limit=-1,node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};function applyLGraphCanvasStatics(n){Object.assign(n,{getFileExtension,onGroupAdd,getBoundaryNodes,alignNodes,onNodeAlign,onGroupAlign,onMenuAdd,onMenuCollapseAll,onMenuNodeEdit,showMenuNodeOptionalInputs,showMenuNodeOptionalOutputs,onShowMenuNodeProperties,decodeHTML,onMenuResizeNode,onShowPropertyEditor,getPropertyPrintableValue,onMenuNodeCollapse,onMenuNodePin,onMenuNodeMode,onMenuNodeColors,onMenuNodeShapes,onMenuNodeRemove,onMenuNodeToSubgraph,onMenuNodeClone}),n.DEFAULT_BACKGROUND_IMAGE=DEFAULT_BACKGROUND_IMAGE,n.link_type_colors=link_type_colors,n.gradients=gradients,n.search_limit=search_limit,n.node_colors=node_colors}class LGraphCanvas{constructor(o,s,a){a!=null||(a={skip_render:!1,autoresize:!1,clip_all_nodes:!1}),this.options=a,this.background_image=LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,o&&o.constructor===String&&(o=document.querySelector(o)),this.ds=new LiteGraph.DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=`${LiteGraph.NODE_TEXT_SIZE}px Arial`,this.inner_text_font=`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.move_destination_link_without_shift=!1,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.free_resize=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.autoresize=a.autoresize,this.skip_render=a.skip_render,this.clip_all_nodes=a.clip_all_nodes,this.free_resize=a.free_resize,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=a.viewport||null,this.low_quality_rendering_threshold=5,this.controllers=createLGraphCanvasControllers(this),this.processMouseWheel=this.processMouseWheel.bind(this),this.processKey=this.processKey.bind(this),this.processDrop=this.processDrop.bind(this),s==null||s.attachCanvas(this),this.setCanvas(o,a.skip_events),this.clear(),!this.skip_render&&!a.skip_render&&this.startRendering()}}installLGraphCanvasDelegates(LGraphCanvas),applyLGraphCanvasStatics(LGraphCanvas);class DragAndScale{constructor(o,s){H(this,"onMouseDown",a=>{if(!this.enabled)return;const r=this.element.getBoundingClientRect();var l=a.clientX-r.left,p=a.clientY-r.top;a.canvasx=l,a.canvasy=p,a.dragging=this.dragging;var h=!this.viewport||this.viewport&&l>=this.viewport[0]&&l<this.viewport[0]+this.viewport[2]&&p>=this.viewport[1]&&p<this.viewport[1]+this.viewport[3];h&&(this.dragging=!0,this.abortController=new AbortController,document.addEventListener("pointermove",this.onMouseMove,{signal:this.abortController.signal}),document.addEventListener("pointerup",this.onMouseUp,{signal:this.abortController.signal})),this.last_mouse[0]=l,this.last_mouse[1]=p}),H(this,"onMouseMove",a=>{if(!this.enabled)return;const r=this.element.getBoundingClientRect();var l=a.clientX-r.left,p=a.clientY-r.top;a.canvasx=l,a.canvasy=p,a.dragging=this.dragging;var h=l-this.last_mouse[0],c=p-this.last_mouse[1];this.dragging&&this.mouseDrag(h,c),this.last_mouse[0]=l,this.last_mouse[1]=p}),H(this,"onMouseUp",a=>{var r;this.dragging=!1,(r=this.abortController)==null||r.abort()}),H(this,"onWheel",a=>{a.wheel=-a.deltaY,a.delta=a.wheelDelta?a.wheelDelta/40:a.deltaY?-a.deltaY/3:0,this.changeDeltaScale(1+a.delta*.05)}),this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),o&&(this.element=o,s||this.bindEvents(o))}bindEvents(o){this.last_mouse=new Float32Array(2),o.addEventListener("pointerdown",this.onMouseDown),o.addEventListener("wheel",this.onWheel)}computeVisibleArea(o){if(!this.element){this.visible_area.set([0,0,0,0]);return}let s=this.element.width,a=this.element.height,r=-this.offset[0],l=-this.offset[1];if(o){r+=o[0]/this.scale,l+=o[1]/this.scale;const[c,u]=o.slice(2);s=c,a=u}const p=r+s/this.scale,h=l+a/this.scale;this.visible_area.set([r,l,p-r,h-l])}toCanvasContext(o){o.scale(this.scale,this.scale),o.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(o){return[(o[0]+this.offset[0])*this.scale,(o[1]+this.offset[1])*this.scale]}convertCanvasToOffset(o,s=[0,0]){return s[0]=o[0]/this.scale-this.offset[0],s[1]=o[1]/this.scale-this.offset[1],s}mouseDrag(o,s){var a;this.offset[0]+=o/this.scale,this.offset[1]+=s/this.scale,(a=this.onredraw)==null||a.call(this,this)}changeScale(o,s){var a;if(o=LiteGraph.clamp(o,this.min_scale,this.max_scale),o==this.scale||!this.element)return;const r=this.element.getBoundingClientRect();if(r){s=s||[r.width*.5,r.height*.5];var l=this.convertCanvasToOffset(s);this.scale=o,Math.abs(this.scale-1)<.01&&(this.scale=1);var p=this.convertCanvasToOffset(s),h=[p[0]-l[0],p[1]-l[1]];this.offset[0]+=h[0],this.offset[1]+=h[1],(a=this.onredraw)==null||a.call(this,this)}}changeDeltaScale(o,s){this.changeScale(this.scale*o,s)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}var z,ie,se,re,ne,ae,oe;const J=class ce{constructor(o,s={}){te(this,z);var a;this.options=s,(a=s.scroll_speed)!=null||(s.scroll_speed=.1),this.menu_elements=[],K(this,z,re).call(this),K(this,z,ne).call(this),K(this,z,ie).call(this),K(this,z,se).call(this),this.setTitle(this.options.title),this.addItems(o),K(this,z,ae).call(this),K(this,z,oe).call(this)}setTitle(o){var s;if(!o)return;(s=this.titleElement)!=null||(this.titleElement=document.createElement("div"));const a=this.titleElement;a.className="litemenu-title",a.innerHTML=o,this.root.parentElement||this.root.appendChild(a)}addItems(o){for(let s=0;s<o.length;s++){let a=o[s];typeof a!="string"&&(a=a&&a.content!==void 0?String(a.content):String(a));let r=o[s];this.menu_elements.push(this.addItem(a,r,this.options))}}addItem(o,s,a={}){var r;const l=document.createElement("div");l.className="litemenu-entry submenu";let p=!1;s===null?l.classList.add("separator"):(l.innerHTML=(r=s==null?void 0:s.title)!=null?r:o,l.value=s,s&&(s.disabled&&(p=!0,l.classList.add("disabled")),(s.submenu||s.has_submenu)&&l.classList.add("has_submenu")),typeof s=="function"?(l.dataset.value=o,l.onclick_callback=s):l.dataset.value=s,s.className&&(l.className+=" "+s.className)),this.root.appendChild(l),p||l.addEventListener("click",c),!p&&a.autoopen&&l.addEventListener("pointerenter",u=>{const d=this.value;!d||!d.has_submenu||c.call(this,u)});var h=this;function c(u){var d,f,L,g,_;const b=this.value;let G=!0;if((d=LiteGraph.debug)==null||d.call(LiteGraph,"ContextMenu handleMenuItemClick",b,a,G,this.current_submenu,this),(f=h.current_submenu)==null||f.close(u),a.callback&&((L=LiteGraph.debug)==null||L.call(LiteGraph,"ContextMenu handleMenuItemClick callback",this,b,a,u,h,a.node),a.callback.call(this,b,a,u,h,a.node)===!0&&(G=!1)),b&&(b.callback&&!a.ignore_item_callbacks&&b.disabled!==!0&&((g=LiteGraph.debug)==null||g.call(LiteGraph,"ContextMenu using value callback and !ignore_item_callbacks",this,b,a,u,h,a.node),b.callback.call(this,b,a,u,h,a.extra)===!0&&(G=!1)),b.submenu)){if((_=LiteGraph.debug)==null||_.call(LiteGraph,"ContextMenu SUBMENU",this,b,b.submenu.options,e,h,a),!b.submenu.options)throw new Error("ContextMenu submenu needs options");new h.constructor(b.submenu.options,{callback:b.submenu.callback,event:u,parentMenu:h,ignore_item_callbacks:b.submenu.ignore_item_callbacks,title:b.submenu.title,extra:b.submenu.extra,autoopen:a.autoopen}),G=!1}G&&!h.lock&&h.close()}return l}close(o,s){var a,r;if(this.root.f_textfilter){const l=this._filterDoc||((a=o==null?void 0:o.target)==null?void 0:a.ownerDocument)||document;l.removeEventListener("keydown",this.root.f_textfilter,!0),l.removeEventListener("keydown",this.root.f_textfilter,!1),this._filterDoc=null}this.parentMenu&&!s&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,o===void 0?this.parentMenu.close():o&&!ce.isCursorOverElement(o,this.parentMenu.root)&&ce.trigger(this.parentMenu.root,"pointerleave",o)),(r=this.current_submenu)==null||r.close(o,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer),this.root.parentNode&&this.root.parentNode.removeChild(this.root)}static trigger(o,s,a,r){const l=new CustomEvent(s,{bubbles:!0,cancelable:!0,detail:a});return r&&Object.defineProperty(l,"litegraphTarget",{value:r}),o.dispatchEvent?o.dispatchEvent(l):o.__events&&o.__events.dispatchEvent(l),l}getTopMenu(){var o,s;return(s=(o=this.options.parentMenu)==null?void 0:o.getTopMenu())!=null?s:this}getFirstEvent(){var o,s;return(s=(o=this.options.parentMenu)==null?void 0:o.getFirstEvent())!=null?s:this.options.event}static isCursorOverElement(o,s){return LiteGraph.isInsideRectangle(o.clientX,o.clientY,s.left,s.top,s.width,s.height)}};z=new WeakSet,ie=function(){const n=this.root=document.createElement("div");return this.options.className&&(n.className=this.options.className),n.classList.add("litegraph","litecontextmenu","litemenubar-panel"),n.style.minWidth="80px",n.style.minHeight="10px",n},se=function(){const n=this.root;n.style.pointerEvents="none",setTimeout(()=>{n.style.pointerEvents="auto"},100),n.addEventListener("pointerup",o=>(o.preventDefault(),!0)),n.addEventListener("contextmenu",o=>(o.button!=2||o.preventDefault(),!1)),n.addEventListener("pointerdown",o=>{if(o.button==2)return this.close(),o.preventDefault(),!0}),n.addEventListener("wheel",o=>{var s=parseInt(n.style.top);return n.style.top=(s+o.deltaY*this.options.scroll_speed).toFixed()+"px",o.preventDefault(),!0}),n.addEventListener("pointerenter",o=>{n.closing_timer&&clearTimeout(n.closing_timer)})},re=function(){var n;const o=this.options.parentMenu;if(o){if(o.constructor!==this.constructor){(n=LiteGraph.error)==null||n.call(LiteGraph,"parentMenu must be of class ContextMenu, ignoring it"),this.options.parentMenu=null;return}this.parentMenu=o,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this}},ne=function(){var n;if(!this.options.event)return;const o=this.options.event.constructor.name;o!=="MouseEvent"&&o!=="CustomEvent"&&o!=="PointerEvent"&&((n=LiteGraph.error)==null||n.call(LiteGraph,`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${o})`),this.options.event=null)},ae=function(){var n,o,s,a;const r=(o=(n=this.options.event)==null?void 0:n.target.ownerDocument)!=null?o:document,l=(s=r.fullscreenElement)!=null?s:r.body,p=this.root,h=this;LiteGraph.context_menu_filter_enabled&&!this.options.parentMenu&&(r?(p.f_textfilter&&(r.removeEventListener("keydown",p.f_textfilter,!1),r.removeEventListener("keydown",p.f_textfilter,!0),p.f_textfilter=!1),p.f_textfilter=function(c){var u,d,f,L,g,_,b;if(h.current_submenu){(u=LiteGraph.debug)==null||u.call(LiteGraph,"Prevent filtering on ParentMenu",h);return}if(h.allOptions||(h.allOptions=h.menu_elements,h.selectedOption=!1),h.currentOptions||(h.currentOptions=h.allOptions),h.filteringText||(h.filteringText=""),c.key){var G=!1;switch(c.key){case"Backspace":h.filteringText.length&&(h.filteringText=h.filteringText.substring(0,h.filteringText.length-1),G=!0);break;case"Escape":p.f_textfilter&&(r.removeEventListener("keydown",p.f_textfilter,!1),r.removeEventListener("keydown",p.f_textfilter,!0),p.f_textfilter=!1),h.close();break;case"ArrowDown":do h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption+1,0),h.allOptions.length-1):0;while(h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.selectedOption<h.allOptions.length-1);h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&(h.selectedOption=h.currentOptions[h.currentOptions.length-1].menu_index),G=!0;break;case"ArrowUp":do h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption-1,0),h.allOptions.length-1):0;while(h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.selectedOption>0);h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&(h.currentOptions&&h.currentOptions.length?h.selectedOption=h.currentOptions[0].menu_index:h.selectedOption=!1),G=!0;break;case"ArrowLeft":break;case"ArrowRight":case"Enter":if(h.selectedOption!==!1)h.allOptions[h.selectedOption]?((d=LiteGraph.debug)==null||d.call(LiteGraph,"ContextElement simCLICK",h.allOptions[h.selectedOption]),h.allOptions[h.selectedOption].do_click&&h.allOptions[h.selectedOption].do_click(h.options.event,C)):((f=LiteGraph.debug)==null||f.call(LiteGraph,"ContextElement selection wrong",h.selectedOption),h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption,0),h.allOptions.length-1):0);else if(h.filteringText.length){for(let m in h.allOptions)if(h.allOptions[m].style.display!=="none"&&!(h.allOptions[m].classList+"").includes("separator")&&h.allOptions[m].textContent!=="Search"){(L=LiteGraph.debug)==null||L.call(LiteGraph,"ContextElement simCLICK",h.allOptions[m]),p.f_textfilter&&r&&(r.removeEventListener("keydown",p.f_textfilter,!1),r.removeEventListener("keydown",p.f_textfilter,!0),(g=LiteGraph.debug)==null||g.call(LiteGraph,"Cleaned ParentContextMenu listener",r,h));var C=!1;h.allOptions[m].do_click(c,C);break}}G=!0;break;default:(_=LiteGraph.debug)==null||_.call(LiteGraph,"ContextMenu filter: keyEvent",c.key);break}!G&&c.key.length==1&&(h.filteringText+=c.key,h.parentMenu)}if(h.filteringText&&h.filteringText!==""){var T=[];h.currentOptions=[];for(let m in h.allOptions){var E=h.allOptions[m].textContent,N=E.toLocaleLowerCase().includes(h.filteringText.toLocaleLowerCase()),A=E.toLocaleLowerCase().startsWith(h.filteringText.toLocaleLowerCase()),D=E.split("/"),I=!1;I=D.length>1&&D[D.length-1].toLocaleLowerCase().startsWith(h.filteringText.toLocaleLowerCase())||D.length==1&&A;var O=(h.allOptions[m].classList+"").includes("separator")||E==="Search";h.allOptions[m].menu_index=m,N&&!O?(T.push(h.allOptions[m]),h.allOptions[m].style.display="block",h.allOptions[m].hidden=!1,h.currentOptions.push(h.allOptions[m]),h.allOptions[m].filtered_index=h.currentOptions.length-1):(h.allOptions[m].hidden=!0,h.allOptions[m].style.display="none",h.allOptions[m].filtered_index=!1),I?h.allOptions[m].style.fontWeight="bold":A&&(h.allOptions[m].style.fontStyle="italic")}h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption,0),h.allOptions.length-1):0,h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.currentOptions.length&&(h.selectedOption=h.currentOptions[0].menu_index)}else{T=h.allOptions,h.currentOptions=h.allOptions;for(let m in h.allOptions)h.allOptions[m].style.display="block",h.allOptions[m].style.fontStyle="inherit",h.allOptions[m].style.fontWeight="inherit",h.allOptions[m].hidden=!1,h.allOptions[m].filtered_index=!1,h.allOptions[m].menu_index=m}var S=h.selectedOption!==!1;if(S){(b=LiteGraph.debug)==null||b.call(LiteGraph,"ContextMenu selection: ",h.selectedOption);for(let m in h.allOptions){var k=h.selectedOption+""==m+"";k?h.allOptions[m].classList.add("selected"):h.allOptions[m].classList.remove("selected")}}document.body.getBoundingClientRect(),p.getBoundingClientRect(),p.style.top=h.top_original+"px"},r.removeEventListener("keydown",p.f_textfilter,!0),r.addEventListener("keydown",p.f_textfilter,!0),this._filterDoc=r):(a=LiteGraph.warn)==null||a.call(LiteGraph,"NO root document to add context menu and event",r,options)),l.appendChild(this.root)},oe=function(){var n;const o=this.options,s=this.root;let a=o.left||0,r=o.top||0;if(this.top_original=r,o.event){if(a=o.event.clientX-10,r=o.event.clientY-10,o.title&&(r-=20),this.top_original=r,o.parentMenu){const h=o.parentMenu.root.getBoundingClientRect();a=h.left+h.width}const l=document.body.getBoundingClientRect(),p=s.getBoundingClientRect();l.height===0&&((n=LiteGraph.error)==null||n.call(LiteGraph,"document.body height is 0. That is dangerous, set html,body { height: 100%; }")),l.width&&a>l.width-p.width-10&&(a=l.width-p.width-10),l.height&&r>l.height-p.height-10&&(r=l.height-p.height-10)}s.style.left=`${a}px`,s.style.top=`${r}px`,o.scale&&(s.style.transform=`scale(${o.scale})`)},H(J,"closeAll",(n=window)=>{const o=n.document.querySelectorAll(".litecontextmenu");o.length&&o.forEach(s=>{var a;s.close?s.close():(a=s.parentNode)==null||a.removeChild(s)})});let ContextMenu=J;var LiteGraph=new class{constructor(){H(this,"extendClass",(n,o)=>{for(let s in o)n.hasOwnProperty(s)||(n[s]=o[s]);if(o.prototype)for(let s in o.prototype)o.prototype.hasOwnProperty(s)&&(n.prototype.hasOwnProperty(s)||(o.prototype.__lookupGetter__(s)?n.prototype.__defineGetter__(s,o.prototype.__lookupGetter__(s)):n.prototype[s]=o.prototype[s],o.prototype.__lookupSetter__(s)&&n.prototype.__defineSetter__(s,o.prototype.__lookupSetter__(s))))}),H(this,"getParameterNames",n=>(n+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)),H(this,"clamp",(n,o,s)=>o>n?o:s<n?s:n),H(this,"pointer_to_mouse_events",Object.freeze({pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mouseup",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"})),H(this,"mouse_to_pointer_events",Object.freeze({mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseenter:"pointerenter",mouseleave:"pointerleave"})),H(this,"pointerAddListener",(n,o,s,a)=>{if(!(n!=null&&n.addEventListener)||typeof s!="function")return!1;const r=this.resolvePointerEventName(o);return n.addEventListener(r,s,a),!0}),H(this,"pointerRemoveListener",(n,o,s,a)=>{if(!(n!=null&&n.removeEventListener)||typeof s!="function")return!1;const r=this.resolvePointerEventName(o);return n.removeEventListener(r,s,a),!0}),H(this,"closeAllContextMenus",()=>{LiteGraph.warn("LiteGraph.closeAllContextMenus is deprecated in favor of ContextMenu.closeAll()"),ContextMenu.closeAll()}),this.VERSION="0.10.2",this.LLink=LLink,this.LGraph=LGraph,setupLGraphDelegates(this),this.LGraphNode=LGraphNode,setupLGraphNodeDelegates(this),this.LGraphGroup=LGraphGroup,this.LGraphCanvas=LGraphCanvas,this.DragAndScale=DragAndScale,this.ContextMenu=ContextMenu,this.CANVAS_GRID_SIZE=10,this.NODE_TITLE_HEIGHT=30,this.NODE_TITLE_TEXT_Y=20,this.NODE_SLOT_HEIGHT=20,this.NODE_WIDGET_HEIGHT=20,this.NODE_WIDTH=140,this.NODE_MIN_WIDTH=50,this.NODE_COLLAPSED_RADIUS=10,this.NODE_COLLAPSED_WIDTH=80,this.NODE_TITLE_COLOR="#999",this.NODE_SELECTED_TITLE_COLOR="#FFF",this.NODE_TEXT_SIZE=14,this.NODE_TEXT_COLOR="#AAA",this.NODE_SUBTEXT_SIZE=12,this.NODE_DEFAULT_COLOR="#333",this.NODE_DEFAULT_BGCOLOR="#353535",this.NODE_DEFAULT_BOXCOLOR="#666",this.NODE_DEFAULT_SHAPE="box",this.NODE_BOX_OUTLINE_COLOR="#FFF",this.DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)",this.DEFAULT_GROUP_FONT=24,this.WIDGET_BGCOLOR="#222",this.WIDGET_OUTLINE_COLOR="#666",this.WIDGET_TEXT_COLOR="#DDD",this.WIDGET_SECONDARY_TEXT_COLOR="#999",this.LINK_COLOR="#9A9",this.EVENT_LINK_COLOR="#A86",this.CONNECTING_LINK_COLOR="#AFA",this.MAX_NUMBER_OF_NODES=1e3,this.DEFAULT_POSITION=[100,100],this.VALID_SHAPES=["default","box","round","card"],this.BOX_SHAPE=1,this.ROUND_SHAPE=2,this.CIRCLE_SHAPE=3,this.CARD_SHAPE=4,this.ARROW_SHAPE=5,this.GRID_SHAPE=6,this.INPUT=1,this.OUTPUT=2,this.EVENT=-1,this.ACTION=-1,this.NODE_MODES=["Always","On Event","Never","On Trigger","On Request"],this.NODE_MODES_COLORS=["#666","#422","#333","#224","#626"],this.ALWAYS=0,this.ON_EVENT=1,this.NEVER=2,this.ON_TRIGGER=3,this.ON_REQUEST=4,this.UP=1,this.DOWN=2,this.LEFT=3,this.RIGHT=4,this.CENTER=5,this.LINK_RENDER_MODES=["Straight","Linear","Spline"],this.STRAIGHT_LINK=0,this.LINEAR_LINK=1,this.SPLINE_LINK=2,this.NORMAL_TITLE=0,this.NO_TITLE=1,this.TRANSPARENT_TITLE=2,this.AUTOHIDE_TITLE=3,this.VERTICAL_LAYOUT="vertical",this.proxy=null,this.node_images_path="",this.catch_exceptions=!0,this.throw_errors=!0,this.allow_scripts=!1,this.use_deferred_actions=!0,this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.Globals={},this.searchbox_extras={},this.auto_sort_node_types=!1,this.node_box_coloured_when_on=!1,this.node_box_coloured_by_mode=!1,this.dialog_close_on_mouse_leave=!0,this.dialog_close_on_mouse_leave_delay=500,this.shift_click_do_break_link_from=!1,this.click_do_break_link_to=!1,this.search_hide_on_mouse_leave=!0,this.search_filter_enabled=!1,this.search_show_all_on_open=!0,this.applyPointerDefaults(),this.show_node_tooltip=!1,this.show_node_tooltip_use_descr_property=!1,this.auto_load_slot_types=!1,this.registered_slot_in_types={},this.registered_slot_out_types={},this.slot_types_in=[],this.slot_types_out=[],this.slot_types_default_in=[],this.slot_types_default_out=[],this.graphDefaultConfig={align_to_grid:!0,links_ontop:!1},this.alt_drag_do_clone_nodes=!1,this.alt_shift_drag_connect_clone_with_input=!0,this.do_add_triggers_slots=!1,this.allow_multi_output_for_events=!0,this.middle_click_slot_add_default_node=!1,this.release_link_on_empty_shows_menu=!1,this.two_fingers_opens_menu=!1,this.backspace_delete=!0,this.ctrl_shift_v_paste_connect_unselected_outputs=!1,this.actionHistory_enabled=!1,this.actionHistoryMaxSave=40,this.refreshAncestorsOnTriggers=!1,this.refreshAncestorsOnActions=!1,this.ensureUniqueExecutionAndActionCall=!1,this.use_uuids=!1,this.context_menu_filter_enabled=!1,this.showCanvasOptions=!1,this.availableCanvasOptions=["allow_addOutSlot_onExecuted","free_resize","highquality_render","use_gradients","pause_rendering","clear_background","read_only","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","move_destination_link_without_shift","set_canvas_dirty_on_mouse_event","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip"],this.actionHistoryMaxSave=40,this.canRemoveSlots=!0,this.canRemoveSlots_onlyOptional=!0,this.canRenameSlots=!0,this.canRenameSlots_onlyOptional=!0,this.ensureNodeSingleExecution=!1,this.ensureNodeSingleAction=!1,this.preventAncestorRecalculation=!1,this.ensureUniqueExecutionAndActionCall=!0,this.allowMultiOutputForEvents=!1,this.log_methods=["error","warn","info","log","debug"],this.logging_set_level(2)}logging_set_level(n){this.debug_level=Number(n)}logging(n){if(n>this.debug_level)return;function o(a){let r=[];for(let l=1;l<a.length;l++)typeof a[l]!="undefined"&&r.push(a[l]);return r}let s="debug";if(n>=0&&n<=4&&(s=["error","warn","info","log","debug"][n]),typeof console[s]!="function")throw console.warn("[LG-log] invalid console method",s,o(arguments)),new RangeError;console[s]("[LG]",...o(arguments))}error(){this.logging(0,...arguments)}warn(){this.logging(1,...arguments)}info(){this.logging(2,...arguments)}log(){this.logging(3,...arguments)}debug(){this.logging(4,...arguments)}registerNodeType(n,o){var s,a,r,l,p,h,c;if(!o.prototype)throw new Error("Cannot register a simple object, it must be a class with a prototype");o.type=n,(s=this.debug)==null||s.call(this,"registerNodeType","start",n);const u=o.name,d=n.lastIndexOf("/");o.category=n.substring(0,d),o.title||(o.title=u);const f=Object.getOwnPropertyDescriptors(LGraphNode.prototype);Object.keys(f).forEach(b=>{o.prototype.hasOwnProperty(b)||Object.defineProperty(o.prototype,b,f[b])});const L=this.registered_node_types[n];if(L&&((a=this.debug)==null||a.call(this,"registerNodeType","replacing node type",n,L)),!Object.prototype.hasOwnProperty.call(o.prototype,"shape")&&(Object.defineProperty(o.prototype,"shape",{set:function(b){switch(b){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=b}},get:function(){return this._shape},enumerable:!0,configurable:!0}),o.supported_extensions))for(let b in o.supported_extensions){const G=o.supported_extensions[b];G&&G.constructor===String&&(this.node_types_by_file_extension[G.toLowerCase()]=o)}if(this.registered_node_types[n]=o,o.constructor.name&&(this.Nodes[u]=o),(r=LiteGraph.onNodeTypeRegistered)==null||r.call(LiteGraph,n,o),L&&((l=LiteGraph.onNodeTypeReplaced)==null||l.call(LiteGraph,n,o,L)),o.prototype.onPropertyChange&&LiteGraph.warn("LiteGraph node class "+n+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),o.supported_extensions)for(var g=0;g<o.supported_extensions.length;g++){var _=o.supported_extensions[g];_&&_.constructor===String&&(this.node_types_by_file_extension[_.toLowerCase()]=o)}(p=this.debug)==null||p.call(this,"registerNodeType","type registered",n),this.auto_load_slot_types&&((h=this.debug)==null||h.call(this,"registerNodeType","do auto_load_slot_types",n)),new o((c=o.title)!=null?c:"tmpnode")}unregisterNodeType(n){const o=n.constructor===String?this.registered_node_types[n]:n;if(!o)throw new Error("node type not found: "+n);delete this.registered_node_types[o.type],o.constructor.name&&delete this.Nodes[o.constructor.name]}registerNodeAndSlotType(n,o,s=!1){const a=(n.constructor===String&&this.registered_node_types[n]!=="anonymous"?this.registered_node_types[n]:n).constructor.type;let r=[];typeof o=="string"?r=o.split(","):o==this.EVENT||o==this.ACTION?r=["_event_"]:r=["*"];for(let l=0;l<r.length;++l){let p=r[l];p===""&&(p="*");const h=s?"registered_slot_out_types":"registered_slot_in_types";this[h][p]===void 0&&(this[h][p]={nodes:[]}),this[h][p].nodes.includes(a)||this[h][p].nodes.push(a),s?this.slot_types_out.includes(p.toLowerCase())||(this.slot_types_out.push(p.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(p.toLowerCase())||(this.slot_types_in.push(p.toLowerCase()),this.slot_types_in.sort())}}buildNodeClassFromObject(n,o){var s="";if(o.inputs)for(let r=0;r<o.inputs.length;++r){let l=o.inputs[r][0],p=o.inputs[r][1];p&&p.constructor===String&&(p='"'+p+'"'),s+="this.addInput('"+l+"',"+p+`);
`}if(o.outputs)for(let r=0;r<o.outputs.length;++r){let l=o.outputs[r][0],p=o.outputs[r][1];p&&p.constructor===String&&(p='"'+p+'"'),s+="this.addOutput('"+l+"',"+p+`);
`}if(o.properties)for(let r in o.properties){let l=o.properties[r];l&&l.constructor===String&&(l='"'+l+'"'),s+="this.addProperty('"+r+"',"+l+`);
`}s+="if(this.onCreate)this.onCreate()";var a=Function(s);for(let r in o)r!="inputs"&&r!="outputs"&&r!="properties"&&(a.prototype[r]=o[r]);return a.title=o.title||n.split("/").pop(),a.desc=o.desc||"Generated from object",this.registerNodeType(n,a),a}wrapFunctionAsNode(n,o,s,a,r){const l=LiteGraph.getParameterNames(o),p=l.map((d,f)=>{const L=s!=null&&s[f]?`'${s[f]}'`:"0";return`this.addInput('${d}', ${L});`}).join(`
`),h=a?`'${a}'`:0,c=r?`this.properties = ${JSON.stringify(r)};`:"",u=new Function(`
            ${p}
            this.addOutput('out', ${h});
            ${c}
        `);return u.title=n.split("/").pop(),u.desc=`Generated from ${o.name}`,u.prototype.onExecute=function(){const d=l.map((L,g)=>this.getInputData(g)),f=o.apply(this,d);this.setOutputData(0,f)},this.registerNodeType(n,u),u}clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}}addNodeMethod(n,o){LGraphNode.prototype[n]=o;for(var s in this.registered_node_types){var a=this.registered_node_types[s];a.prototype[n]&&(a.prototype["_"+n]=a.prototype[n]),a.prototype[n]=o}}createNode(n,o,s={}){var a,r,l,p,h,c,u,d,f,L,g,_;const b=(a=this.registered_node_types[n])!=null?a:null;if(!b)return(r=this.log)==null||r.call(this,`GraphNode type "${n}" not registered.`),null;o=(l=o!=null?o:b.title)!=null?l:n;let G=null;if(LiteGraph.catch_exceptions)try{G=new b(o)}catch(C){return(p=this.error)==null||p.call(this,C),null}else G=new b(o);return G.type=n,(h=G.title)!=null||(G.title=o),(c=G.properties)!=null||(G.properties={}),(u=G.properties_info)!=null||(G.properties_info=[]),(d=G.flags)!=null||(G.flags={}),(f=G.size)!=null||(G.size=G.computeSize()),(L=G.pos)!=null||(G.pos=LiteGraph.DEFAULT_POSITION.concat()),(g=G.mode)!=null||(G.mode=LiteGraph.ALWAYS),Object.assign(G,s),(_=G.onNodeCreated)==null||_.call(G),G}getNodeType(n){return this.registered_node_types[n]}getNodeTypesInCategory(n,o){const s=Object.values(this.registered_node_types).filter(a=>a.filter!==o?!1:n===""?a.category===null:a.category===n);return this.auto_sort_node_types&&s.sort((a,r)=>a.title.localeCompare(r.title)),s}getNodeTypesCategories(n){const o={"":1};Object.values(this.registered_node_types).forEach(a=>{a.category&&!a.skip_list&&a.filter===n&&(o[a.category]=1)});const s=Object.keys(o);return this.auto_sort_node_types?s.sort():s}reloadNodes(n){var o,s,a,r=document.getElementsByTagName("script"),l=[];for(let u=0;u<r.length;u++)l.push(r[u]);var p=document.getElementsByTagName("head")[0];n=document.location.href+n;for(let u=0;u<l.length;u++){var h=l[u].src;if(!(!h||h.substr(0,n.length)!=n))try{(o=this.log)==null||o.call(this,"Reloading: "+h);var c=document.createElement("script");c.type="text/javascript",c.src=h,p.appendChild(c),p.removeChild(l[u])}catch(d){if(LiteGraph.throw_errors)throw d;(s=this.log)==null||s.call(this,"Error while reloading "+h)}}(a=this.log)==null||a.call(this,"Nodes reloaded")}cloneObject(n,o){if(n==null)return null;const s=JSON.parse(JSON.stringify(n));if(!o)return s;for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&(o[a]=s[a]);return o}uuidv4(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,n=>(n^Math.random()*16>>n/4).toString(16))}isValidConnection(n,o){if((n===""||n==="*")&&(n=0),(o===""||o==="*")&&(o=0),!n||!o||n===o||n===LiteGraph.EVENT&&o===LiteGraph.ACTION)return!0;if(n=String(n).toLowerCase(),o=String(o).toLowerCase(),!n.includes(",")&&!o.includes(","))return n===o;const s=n.split(","),a=o.split(",");for(const r of s)for(const l of a)if(this.isValidConnection(r,l))return!0;return!1}registerSearchboxExtra(n,o,s){this.searchbox_extras[o.toLowerCase()]={type:n,desc:o,data:s}}fetchFile(n,o,s,a){if(!n)return null;if(o=o||"text",n.constructor===String)return n.substr(0,4)=="http"&&LiteGraph.proxy&&(n=LiteGraph.proxy+n.substr(n.indexOf(":")+3)),fetch(n).then(l=>{if(!l.ok)throw new Error("File not found");if(o=="arraybuffer")return l.arrayBuffer();if(o=="text"||o=="string")return l.text();if(o=="json")return l.json();if(o=="blob")return l.blob()}).then(l=>{s&&s(l)}).catch(l=>{var p;(p=this.error)==null||p.call(this,"error fetching file:",n),a&&a(l)});if(n.constructor===File||n.constructor===Blob){var r=new FileReader;if(r.onload=l=>{var p=l.target.result;o=="json"&&(p=JSON.parse(p)),s&&s(p)},o=="arraybuffer")return r.readAsArrayBuffer(n);if(o=="text"||o=="json")return r.readAsText(n);if(o=="blob")return r.readAsBinaryString(n)}return null}applyPointerDefaults(){typeof window=="undefined"||typeof window.matchMedia!="function"||window.matchMedia("(pointer: coarse)").matches&&(this.dialog_close_on_mouse_leave=!1,this.search_hide_on_mouse_leave=!1)}compareObjects(n,o){const s=Object.keys(n);return s.length!==Object.keys(o).length?!1:s.every(a=>n[a]===o[a])}distance(n,o){const[s,a]=n,[r,l]=o;return Math.sqrt((r-s)**2+(l-a)**2)}colorToString(n){return"rgba("+Math.round(n[0]*255).toFixed()+","+Math.round(n[1]*255).toFixed()+","+Math.round(n[2]*255).toFixed()+","+(n.length==4?n[3].toFixed(2):"1.0")+")"}canvasFillTextMultiline(n,o,s,a,r,l){var p=(o+"").trim().split(" "),h="",c={lines:[],maxW:0,height:0};if(p.length>1)for(var u=0;u<p.length;u++){var d=h+p[u]+" ",f=n.measureText(d),L=f.width;L>r&&u>0?(n.fillText(h,s,a+l*c.lines.length),h=p[u]+" ",c.max=L,c.lines.push(h)):h=d}else h=p[0];return n.fillText(h,s,a+l*c.lines.length),c.lines.push(h),c.height=l*c.lines.length||l,c}isInsideRectangle(n,o,s,a,r,l){return n>s&&n<s+r&&o>a&&o<a+l}growBounding(n,o,s){o<n[0]?n[0]=o:o>n[2]&&(n[2]=o),s<n[1]?n[1]=s:s>n[3]&&(n[3]=s)}isInsideBounding(n,o){return n[0]>=o[0][0]&&n[1]>=o[0][1]&&n[0]<=o[1][0]&&n[1]<=o[1][1]}overlapBounding(n,o){const s=n[0]+n[2],a=n[1]+n[3],r=o[0]+o[2],l=o[1]+o[3];return!(n[0]>r||n[1]>l||s<o[0]||a<o[1])}hex2num(n){n.charAt(0)=="#"&&(n=n.slice(1)),n=n.toUpperCase();for(var o="0123456789ABCDEF",s=new Array(3),a=0,r,l,p=0;p<6;p+=2)r=o.indexOf(n.charAt(p)),l=o.indexOf(n.charAt(p+1)),s[a]=r*16+l,a++;return s}num2hex(n){for(var o="0123456789ABCDEF",s="#",a,r,l=0;l<3;l++)a=n[l]/16,r=n[l]%16,s+=o.charAt(a)+o.charAt(r);return s}resolvePointerEventName(n){if(typeof n!="string")return n;const o=n.toLowerCase(),s=this.pointerevents_method;return s==="mouse"?this.pointer_to_mouse_events[o]||o:s==="pointer"&&this.mouse_to_pointer_events[o]||o}set pointerevents_method(n){const o=typeof n=="string"?n.toLowerCase():"";if(o==="mouse"||o==="pointer"){this._pointerevents_method=o;return}this._pointerevents_method="pointer"}get pointerevents_method(){return this._pointerevents_method||"pointer"}};typeof performance!="undefined"?LiteGraph.getTime=performance.now.bind(performance):typeof Date!="undefined"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process!="undefined"?LiteGraph.getTime=()=>{var n=process.hrtime();return n[0]*.001+n[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()},typeof window!="undefined"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||(n=>{window.setTimeout(n,1e3/60)}));export{ContextMenu,DragAndScale,LGraph,LGraphCanvas,LGraphGroup,LGraphNode,LLink,LiteGraph};
