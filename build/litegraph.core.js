var he=Object.defineProperty,te=o=>{throw TypeError(o)},ue=(o,t,n)=>t in o?he(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,M=(o,t,n)=>ue(o,typeof t!="symbol"?t+"":t,n),pe=(o,t,n)=>t.has(o)||te("Cannot "+n),ie=(o,t,n)=>t.has(o)?te("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,n),J=(o,t,n)=>(pe(o,t,"access private method"),n);class LLink{constructor(t,n,a,r,l,p){this.id=t,this.type=n,this.origin_id=a,this.origin_slot=r,this.target_id=l,this.target_slot=p,this._data=null,this._pos=new Float32Array(2)}configure(t){t.constructor===Array?(this.id=t[0],this.origin_id=t[1],this.origin_slot=t[2],this.target_id=t[3],this.target_slot=t[4],this.type=t[5]):(this.id=t.id,this.type=t.type,this.origin_id=t.origin_id,this.origin_slot=t.origin_slot,this.target_id=t.target_id,this.target_slot=t.target_slot)}serialize(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]}}const V=class ee{constructor(t){var n;(n=LiteGraph.log)==null||n.call(LiteGraph,"Graph created"),this.list_of_graphcanvas=null,this.clear(),t&&this.configure(t)}getSupportedTypes(){var t;return(t=this.supported_types)!=null?t:ee.supported_types}clear(){var t;this.stop(),this.status=ee.STATUS_STOPPED,this.last_node_id=0,this.last_link_id=0,this._version=-1,(t=this._nodes)==null||t.forEach(n=>{var a;(a=n.onRemoved)==null||a.call(n)}),this._nodes=[],this._nodes_by_id={},this._nodes_in_order=[],this._nodes_executable=null,this._groups=[],this.links={},this.iteration=0,this.config={},this.configApplyDefaults(),this.vars={},this.extra={},this.globaltime=0,this.runningtime=0,this.fixedtime=0,this.fixedtime_lapse=.01,this.elapsed_time=.01,this.last_update_time=0,this.starttime=0,this.catch_errors=!0,this.history={actionHistory:[],actionHistoryVersions:[],actionHistoryPtr:0},this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[],this.inputs={},this.outputs={},this.change(),this.sendActionToCanvas("clear")}configApply(t){this.config=Object.assign(this.config,t)}configApplyDefaults(){var t=LiteGraph.graphDefaultConfig;this.configApply(t)}attachCanvas(t){var n;if(!t instanceof LiteGraph.LGraphCanvas)throw new Error("attachCanvas expects a LiteGraph.LGraphCanvas instance");t.graph&&t.graph!=this&&t.graph.detachCanvas(t),t.graph=this,(n=this.list_of_graphcanvas)!=null||(this.list_of_graphcanvas=[]),this.list_of_graphcanvas.push(t)}detachCanvas(t){if(this.list_of_graphcanvas){var n=this.list_of_graphcanvas.indexOf(t);n!=-1&&(t.graph=null,this.list_of_graphcanvas.splice(n,1))}}start(t=0){var n;if(this.status===ee.STATUS_RUNNING)return;this.status=ee.STATUS_RUNNING,(n=this.onPlayEvent)==null||n.call(this),this.sendEventToAllNodes("onStart"),this.starttime=LiteGraph.getTime(),this.last_update_time=this.starttime;const a=()=>{var r,l;this.execution_timer_id===-1&&(window.requestAnimationFrame(a),(r=this.onBeforeStep)==null||r.call(this),this.runStep(1,!this.catch_errors),(l=this.onAfterStep)==null||l.call(this))};t===0&&typeof window=="object"&&window.requestAnimationFrame?(this.execution_timer_id=-1,a()):this.execution_timer_id=setInterval(()=>{var r,l;(r=this.onBeforeStep)==null||r.call(this),this.runStep(1,!this.catch_errors),(l=this.onAfterStep)==null||l.call(this)},t)}stop(){var t;this.status!=ee.STATUS_STOPPED&&(this.status=ee.STATUS_STOPPED,(t=this.onStopEvent)==null||t.call(this),this.execution_timer_id!=null&&(this.execution_timer_id!=-1&&clearInterval(this.execution_timer_id),this.execution_timer_id=null),this.sendEventToAllNodes("onStop"))}runStep(t=1,n,a){var r,l,p,h,c,u,d=LiteGraph.getTime();this.globaltime=.001*(d-this.starttime);var f=(r=this._nodes_executable)!=null?r:this._nodes;if(f){if(a||(a=f.length),n){for(let _=0;_<t;_++)f.forEach(m=>{var G,b;LiteGraph.use_deferred_actions&&(G=m._waiting_actions)!=null&&G.length&&m.executePendingActions(),m.mode===LiteGraph.ALWAYS&&((b=m.doExecute)==null||b.call(m))}),this.fixedtime+=this.fixedtime_lapse,(l=this.onExecuteStep)==null||l.call(this);(p=this.onAfterExecute)==null||p.call(this)}else try{for(let _=0;_<t;_++)f.forEach(m=>{var G,b;LiteGraph.use_deferred_actions&&(G=m._waiting_actions)!=null&&G.length&&m.executePendingActions(),m.mode===LiteGraph.ALWAYS&&((b=m.doExecute)==null||b.call(m))}),this.fixedtime+=this.fixedtime_lapse,(h=this.onExecuteStep)==null||h.call(this);(c=this.onAfterExecute)==null||c.call(this),this.errors_in_execution=!1}catch(_){if(this.errors_in_execution=!0,LiteGraph.throw_errors)throw _;(u=LiteGraph.log)==null||u.call(LiteGraph,`Error during execution: ${_}`),this.stop()}var L=LiteGraph.getTime(),g=L-d;g==0&&(g=1),this.execution_time=.001*g,this.globaltime+=.001*g,this.iteration+=1,this.elapsed_time=(L-this.last_update_time)*.001,this.last_update_time=L,this.nodes_executing=[],this.nodes_actioning=[],this.node_ancestorsCalculated=[],this.nodes_executedAction=[]}}updateExecutionOrder(){this._nodes_in_order=this.computeExecutionOrder(!1),this._nodes_executable=[];for(var t=0;t<this._nodes_in_order.length;++t)this._nodes_in_order[t].onExecute&&this._nodes_executable.push(this._nodes_in_order[t])}computeExecutionOrder(t,n){var a,r=[],l=[],p={},h={},c={};for(let _=0,m=this._nodes.length;_<m;++_){let G=this._nodes[_];if(!(t&&!G.onExecute)){p[G.id]=G;var u=0;if(G.inputs)for(var d=0,f=G.inputs.length;d<f;d++)G.inputs[d]&&G.inputs[d].link!=null&&(u+=1);u==0?(l.push(G),n&&(G._level=1)):(n&&(G._level=0),c[G.id]=u)}}for(;l.length!=0;){var L=l.shift();if(r.push(L),delete p[L.id],!!L.outputs)for(let _=0;_<L.outputs.length;_++){let m=L.outputs[_];if(!(m==null||m.links==null||m.links.length==0))for(let G=0;G<m.links.length;G++){let b=m.links[G],T=this.links[b];if(!T||h[T.id])continue;let E=this.getNodeById(T.target_id);if(E==null){h[T.id]=!0;continue}n&&(!E._level||E._level<=L._level)&&(E._level=L._level+1),h[T.id]=!0,c[E.id]-=1,c[E.id]==0&&l.push(E)}}}for(let _ in p)r.push(p[_]);r.length!=this._nodes.length&&LiteGraph.debug&&((a=LiteGraph.warn)==null||a.call(LiteGraph,"something went wrong, nodes missing"));var g=r.length;for(let _=0;_<g;++_)r[_].order=_;r=r.sort((_,m)=>{let G=_.constructor.priority||_.priority||0,b=m.constructor.priority||m.priority||0;return G==b?_.order-m.order:G-b});for(let _=0;_<g;++_)r[_].order=_;return r}getAncestors(t,n={}){for(var a={modesSkip:[],modesOnly:[],typesSkip:[],typesOnly:[]},r=Object.assign(a,n),l=[],p=[],h=[t],c={};h.length;){var u=h.shift();if(u&&!c[u.id]){if(c[u.id]=!0,u.id!=t.id){if(r.modesSkip&&r.modesSkip.length&&r.modesSkip.indexOf(u.mode)!=-1||r.modesOnly&&r.modesOnly.length&&r.modesOnly.indexOf(u.mode)==-1)continue;p.indexOf(u.id)==-1&&(l.push(u),p.push(u.id))}if(u.inputs)for(var d=0;d<u.inputs.length;++d){var f=u.getInputNode(d);if(f){var L=u.inputs[d].type;r.typesSkip&&r.typesSkip.length&&r.typesSkip.indexOf(L)!=-1||r.typesOnly&&r.typesOnly.length&&r.typesOnly.indexOf(f.mode)==-1||p.indexOf(f.id)==-1&&(c[f.id]||h.push(f))}}}}return l.sort((g,_)=>g.order-_.order),l}arrange(t=100,n){var a;const r=this.computeExecutionOrder(!1,!0),l=[];for(let h=0;h<r.length;++h){const c=r[h],u=c._level||1;(a=l[u])!=null||(l[u]=[]),l[u].push(c)}let p=t;for(let h=0;h<l.length;++h){const c=l[h];if(!c)continue;let u=100,d=t+LiteGraph.NODE_TITLE_HEIGHT;for(let f=0;f<c.length;++f){const L=c[f];L.pos[0]=n==LiteGraph.VERTICAL_LAYOUT?d:p,L.pos[1]=n==LiteGraph.VERTICAL_LAYOUT?p:d;const g=n==LiteGraph.VERTICAL_LAYOUT?1:0;L.size[g]>u&&(u=L.size[g]);const _=n==LiteGraph.VERTICAL_LAYOUT?0:1;d+=L.size[_]+t+LiteGraph.NODE_TITLE_HEIGHT}p+=u+t}this.setDirtyCanvas(!0,!0)}getTime(){return this.globaltime}getFixedTime(){return this.fixedtime}getElapsedTime(){return this.elapsed_time}sendEventToAllNodes(t,n,a=LiteGraph.ALWAYS){var r=this._nodes_in_order?this._nodes_in_order:this._nodes;if(r)for(let l=0,p=r.length;l<p;++l){const h=r[l];if(h.constructor===LiteGraph.Subgraph&&t!=="onExecute"){h.mode==a&&h.sendEventToAllNodes(t,n,a);continue}!h[t]||h.mode!==a||(n===void 0?h[t]():Array.isArray(n)?h[t].apply(h,n):h[t](n))}}sendActionToCanvas(t,n){if(this.list_of_graphcanvas)for(const a of this.list_of_graphcanvas)a[t]&&n&&a[t](...n)}add(t,n,a={}){var r,l,p,h={doProcessChange:!0,doCalcSize:!0},c=Object.assign(h,a);if(t){if(t.constructor===LiteGraph.LGraphGroup){this._groups.push(t),this.setDirtyCanvas(!0),this.change(),t.graph=this,this.onGraphChanged({action:"groupAdd",doSave:c.doProcessChange});return}if(t.id!=-1&&this._nodes_by_id[t.id]!=null&&((r=LiteGraph.warn)==null||r.call(LiteGraph,"LiteGraph: there is already a node with this ID, changing it"),LiteGraph.use_uuids?t.id=LiteGraph.uuidv4():t.id=++this.last_node_id),this._nodes.length>=LiteGraph.MAX_NUMBER_OF_NODES)throw new Error("LiteGraph: max number of nodes in a graph reached");return LiteGraph.use_uuids?(t.id==null||t.id==-1)&&(t.id=LiteGraph.uuidv4()):t.id==null||t.id==-1?t.id=++this.last_node_id:this.last_node_id<t.id&&(this.last_node_id=t.id),t.graph=this,this.onGraphChanged({action:"nodeAdd",doSave:c.doProcessChange}),this._nodes.push(t),this._nodes_by_id[t.id]=t,(l=t.onAdded)==null||l.call(t,this),this.config.align_to_grid&&t.alignToGrid(),n||this.updateExecutionOrder(),(p=this.onNodeAdded)==null||p.call(this,t),c.doCalcSize&&t.setSize(t.computeSize()),this.setDirtyCanvas(!0),this.change(),t}}remove(t){var n,a;if(t.constructor===LiteGraph.LGraphGroup){var r=this._groups.indexOf(t);r!=-1&&this._groups.splice(r,1),t.graph=null,this.onGraphChanged({action:"groupRemove"}),this.setDirtyCanvas(!0,!0),this.change();return}if(this._nodes_by_id[t.id]!=null&&!t.ignore_remove){if(t.inputs)for(let p=0;p<t.inputs.length;p++)t.inputs[p].link!=null&&t.disconnectInput(p,{doProcessChange:!1});if(t.outputs)for(let p=0;p<t.outputs.length;p++){let h=t.outputs[p];h.links!=null&&h.links.length&&t.disconnectOutput(p,!1,{doProcessChange:!1})}if((n=t.onRemoved)==null||n.call(t),t.graph=null,this.onGraphChanged({action:"nodeRemove"}),this.list_of_graphcanvas)for(let p=0;p<this.list_of_graphcanvas.length;++p){let h=this.list_of_graphcanvas[p];h.selected_nodes[t.id]&&delete h.selected_nodes[t.id],h.node_dragged==t&&(h.node_dragged=null)}var l=this._nodes.indexOf(t);l!=-1&&this._nodes.splice(l,1),delete this._nodes_by_id[t.id],(a=this.onNodeRemoved)==null||a.call(this,t),this.sendActionToCanvas("checkPanels"),this.setDirtyCanvas(!0,!0),this.change(),this.updateExecutionOrder()}}getNodeById(t){return t==null?null:this._nodes_by_id[t]}findNodesByClass(t,n=[]){return n=this._nodes.filter(a=>a.constructor===t),n}findNodesByType(t,n=[]){const a=t.toLowerCase();return n=this._nodes.filter(r=>r.type.toLowerCase()===a),n}findNodeByTitle(t){var n;return(n=this._nodes.find(a=>a.title===t))!=null?n:null}findNodesByTitle(t){return this._nodes.filter(n=>n.title===t)}getNodeOnPos(t,n,a=this._nodes,r=0){var l;return(l=a.reverse().find(p=>p.isPointInside(t,n,r)))!=null?l:null}getGroupOnPos(t,n){var a;return(a=this._groups.find(r=>r.isPointInside(t,n,2,!0)))!=null?a:null}checkNodeTypes(){for(var t,n=0;n<this._nodes.length;n++){var a=this._nodes[n],r=LiteGraph.registered_node_types[a.type];if(a.constructor!=r){LiteGraph.debug&&((t=LiteGraph.log)==null||t.call(LiteGraph,`node being replaced by newer version: ${a.type}`));var l=LiteGraph.createNode(a.type);this._nodes[n]=l,l.configure(a.serialize()),l.graph=this,this._nodes_by_id[l.id]=l,a.inputs&&(l.inputs=a.inputs.concat()),a.outputs&&(l.outputs=a.outputs.concat())}}this.updateExecutionOrder()}onAction(t,n,a){this._input_nodes=this.findNodesByClass(LiteGraph.GraphInput,this._input_nodes);for(var r=0;r<this._input_nodes.length;++r){var l=this._input_nodes[r];if(l.properties.name==t){l.actionDo(t,n,a);break}}}trigger(t,n){var a;(a=this.onTrigger)==null||a.call(this,t,n)}addInput(t,n,a){var r,l,p=this.inputs[t];p||(this.beforeChange(),this.inputs[t]={name:t,type:n,value:a},this.onGraphChanged({action:"addInput"}),this.afterChange(),(r=this.onInputAdded)==null||r.call(this,t,n),(l=this.onInputsOutputsChange)==null||l.call(this))}setInputData(t,n){var a=this.inputs[t];a&&(a.value=n)}getInputData(t){var n=this.inputs[t];return n?n.value:null}renameInput(t,n){var a,r,l;if(n!=t){if(!this.inputs[t])return!1;if(this.inputs[n])return(a=LiteGraph.error)==null||a.call(LiteGraph,"there is already one input with that name"),!1;this.inputs[n]=this.inputs[t],delete this.inputs[t],this.onGraphChanged({action:"renameInput"}),(r=this.onInputRenamed)==null||r.call(this,t,n),(l=this.onInputsOutputsChange)==null||l.call(this)}}changeInputType(t,n){var a;if(!this.inputs[t])return!1;this.inputs[t].type&&String(this.inputs[t].type).toLowerCase()==String(n).toLowerCase()||(this.inputs[t].type=n,this.onGraphChanged({action:"changeInputType"}),(a=this.onInputTypeChanged)==null||a.call(this,t,n))}removeInput(t){var n,a;return this.inputs[t]?(delete this.inputs[t],this.onGraphChanged({action:"graphRemoveInput"}),(n=this.onInputRemoved)==null||n.call(this,t),(a=this.onInputsOutputsChange)==null||a.call(this),!0):!1}addOutput(t,n,a){var r,l;this.outputs[t]={name:t,type:n,value:a},this.onGraphChanged({action:"addOutput"}),(r=this.onOutputAdded)==null||r.call(this,t,n),(l=this.onInputsOutputsChange)==null||l.call(this)}setOutputData(t,n){var a=this.outputs[t];a&&(a.value=n)}getOutputData(t){var n=this.outputs[t];return n?n.value:null}renameOutput(t,n){var a,r,l;if(!this.outputs[t])return!1;if(this.outputs[n])return(a=LiteGraph.error)==null||a.call(LiteGraph,"there is already one output with that name"),!1;this.outputs[n]=this.outputs[t],delete this.outputs[t],this._version++,(r=this.onOutputRenamed)==null||r.call(this,t,n),(l=this.onInputsOutputsChange)==null||l.call(this)}changeOutputType(t,n){var a;if(!this.outputs[t])return!1;this.outputs[t].type&&String(this.outputs[t].type).toLowerCase()==String(n).toLowerCase()||(this.outputs[t].type=n,this.onGraphChanged({action:"changeOutputType"}),(a=this.onOutputTypeChanged)==null||a.call(this,t,n))}removeOutput(t){var n,a;return this.outputs[t]?(delete this.outputs[t],this.onGraphChanged({action:"removeOutput"}),(n=this.onOutputRemoved)==null||n.call(this,t),(a=this.onInputsOutputsChange)==null||a.call(this),!0):!1}triggerInput(t,n){for(var a=this.findNodesByTitle(t),r=0;r<a.length;++r)a[r].onTrigger(n)}setCallback(t,n){for(var a=this.findNodesByTitle(t),r=0;r<a.length;++r)a[r].setTrigger(n)}beforeChange(t){var n;(n=this.onBeforeChange)==null||n.call(this,this,t),this.sendActionToCanvas("onBeforeChange",this)}afterChange(t){var n;(n=this.onAfterChange)==null||n.call(this,this,t),this.sendActionToCanvas("onAfterChange",this)}connectionChange(t){var n;this.updateExecutionOrder(),(n=this.onConnectionChange)==null||n.call(this,t),this.onGraphChanged({action:"connectionChange",doSave:!1}),this.sendActionToCanvas("onConnectionChange")}isLive(){if(!this.list_of_graphcanvas)return!1;for(var t=0;t<this.list_of_graphcanvas.length;++t){var n=this.list_of_graphcanvas[t];if(n.live_mode)return!0}return!1}clearTriggeredSlots(){for(var t in this.links){var n=this.links[t];n&&n._last_time&&(n._last_time=0)}}change(){var t,n;(t=LiteGraph.log)==null||t.call(LiteGraph,"Graph visually changed"),this.sendActionToCanvas("setDirty",[!0,!0]),(n=this.on_change)==null||n.call(this,this)}setDirtyCanvas(t,n){this.sendActionToCanvas("setDirty",[t,n])}removeLink(t){var n=this.links[t];if(n){var a=this.getNodeById(n.target_id);a&&(this.beforeChange(),a.disconnectInput(n.target_slot),this.afterChange())}}serialize(){var t,n;const a=this._nodes.map(f=>f.serialize());var r=[];for(var l in this.links){var p=this.links[l];if(!p.serialize){(t=LiteGraph.warn)==null||t.call(LiteGraph,"weird LLink bug, link info is not a LLink but a regular object");var h=new LiteGraph.LLink;for(var c in p)h[c]=p[c];this.links[l]=h,p=h}r.push(p.serialize())}const u=this._groups.map(f=>f.serialize());var d={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:a,links:r,groups:u,config:this.config,extra:this.extra,version:LiteGraph.VERSION};return(n=this.onSerialize)==null||n.call(this,d),d}configure(t,n){var a,r,l,p,h;if(t){n||this.clear();var c=t.nodes;if(t.links&&t.links.constructor===Array){for(var u=[],d=0;d<t.links.length;++d){var f=t.links[d];if(!f){(a=LiteGraph.warn)==null||a.call(LiteGraph,"serialized graph link data contains errors, skipping.");continue}var L=new LiteGraph.LLink;L.configure(f),u[L.id]=L}t.links=u}for(let G in t)["nodes","groups"].includes(G)||(this[G]=t[G]);var g=!1;if(this._nodes=[],c){for(let G=0,b=c.length;G<b;++G){var _=c[G],m=LiteGraph.createNode(_.type,_.title);m||((r=LiteGraph.log)==null||r.call(LiteGraph,`Node not found or has errors: ${_.type}`),m=new LiteGraph.LGraphNode,m.last_serialization=_,m.has_errors=!0,g=!0),m.id=_.id,this.add(m,!0,{doProcessChange:!1})}c.forEach(G=>{const b=this.getNodeById(G.id);b==null||b.configure(G)})}return this._groups.length=0,t.groups&&t.groups.forEach(G=>{const b=new LiteGraph.LGraphGroup;b.configure(G),this.add(b,!0,{doProcessChange:!1})}),this.updateExecutionOrder(),this.extra=(l=t.extra)!=null?l:{},(p=this.onConfigure)==null||p.call(this,t),t._version?(h=LiteGraph.debug)==null||h.call(LiteGraph,"skip onGraphChanged when configure passing version too!"):this.onGraphChanged({action:"graphConfigure",doSave:!1}),this.setDirtyCanvas(!0,!0),g}}load(t,n){var a=this;if(t.constructor===File||t.constructor===Blob){var r=new FileReader;r.addEventListener("load",p=>{var h=JSON.parse(p.target.result);a.configure(h),n==null||n()}),r.readAsText(t);return}var l=new XMLHttpRequest;l.open("GET",t,!0),l.send(null),l.onload=p=>{var h;if(l.status!==200){(h=LiteGraph.error)==null||h.call(LiteGraph,"Error loading graph:",l.status,l.response);return}var c=JSON.parse(l.response);a.configure(c),n==null||n()},l.onerror=p=>{var h;(h=LiteGraph.error)==null||h.call(LiteGraph,"Error loading graph:",p)}}onGraphSaved(t={}){var n={};Object.assign(n,t),this.savedVersion=this._version}onGraphLoaded(t={}){var n={};Object.assign(n,t),this.savedVersion=this._version}onGraphChanged(t={}){var n,a,r,l,p,h,c={action:"",doSave:!0,doSaveGraph:!0},u=Object.assign(c,t);if(this._version++,u.action?(n=LiteGraph.debug)==null||n.call(LiteGraph,"Graph change",u.action):(a=LiteGraph.debug)==null||a.call(LiteGraph,"Graph change, no action",u),u.doSave&&LiteGraph.actionHistory_enabled){(r=LiteGraph.debug)==null||r.call(LiteGraph,"onGraphChanged SAVE :: "+u.action);var d={actionName:u.action};u.doSaveGraph&&(d=Object.assign(d,{graphSave:this.serialize()}));for(var f=this.history;f.actionHistoryPtr<f.actionHistoryVersions.length-1;)(l=LiteGraph.debug)==null||l.call(LiteGraph,"popping: gone back? "+(f.actionHistoryPtr+" < "+(f.actionHistoryVersions.length-1))),f.actionHistoryVersions.pop();if(f.actionHistoryVersions.length>=LiteGraph.actionHistoryMaxSave){var L=f.actionHistoryVersions.shift();(p=LiteGraph.debug)==null||p.call(LiteGraph,"maximum saves reached: "+f.actionHistoryVersions.length+", remove older: "+L),f.actionHistory[L]=!1}f.actionHistoryPtr=f.actionHistoryVersions.length,f.actionHistoryVersions.push(f.actionHistoryPtr),f.actionHistory[f.actionHistoryPtr]=d,(h=LiteGraph.debug)==null||h.call(LiteGraph,"history saved: "+f.actionHistoryPtr,d.actionName)}}actionHistoryBack(t={}){var n,a,r,l,p,h={};Object.assign(h,t);var c=this.history;return c.actionHistoryPtr!=null&&c.actionHistoryPtr>=0?(c.actionHistoryPtr--,(n=LiteGraph.debug)==null||n.call(LiteGraph,"history step back: "+c.actionHistoryPtr),this.actionHistoryLoad({iVersion:c.actionHistoryPtr})?((r=LiteGraph.debug)==null||r.call(LiteGraph,"history loaded back: "+c.actionHistoryPtr),(l=LiteGraph.debug)==null||l.call(LiteGraph,this.history),!0):((a=LiteGraph.warn)==null||a.call(LiteGraph,"historyLoad failed, restore pointer? "+c.actionHistoryPtr),c.actionHistoryPtr++,!1)):((p=LiteGraph.debug)==null||p.call(LiteGraph,"history is already at older state"),!1)}actionHistoryForward(t={}){var n,a,r,l,p={};Object.assign(p,t);var h=this.history;return h.actionHistoryPtr<h.actionHistoryVersions.length?(h.actionHistoryPtr++,(n=LiteGraph.debug)==null||n.call(LiteGraph,"history step forward: "+h.actionHistoryPtr),this.actionHistoryLoad({iVersion:h.actionHistoryPtr})?((r=LiteGraph.debug)==null||r.call(LiteGraph,"history loaded forward: "+h.actionHistoryPtr),!0):((a=LiteGraph.warn)==null||a.call(LiteGraph,"historyLoad failed, restore pointer? "+h.actionHistoryPtr),h.actionHistoryPtr--,!1)):((l=LiteGraph.debug)==null||l.call(LiteGraph,"history is already at newer state"),!1)}actionHistoryLoad(t={}){var n,a={iVersion:!1,backStep:!1},r=Object.assign(a,t),l=this.history;if(l.actionHistory[r.iVersion]&&l.actionHistory[r.iVersion].graphSave){var p=JSON.stringify(this.history);return this.configure(l.actionHistory[r.iVersion].graphSave),this.history=JSON.parse(p),(n=LiteGraph.debug)==null||n.call(LiteGraph,"history loaded: "+r.iVersion,l.actionHistory[r.iVersion].actionName),!0}else return!1}};M(V,"supported_types",["number","string","boolean"]),M(V,"STATUS_STOPPED",1),M(V,"STATUS_RUNNING",2);let LGraph=V;class LGraphNode{constructor(t="Unnamed"){this.title=t,this.size=[LiteGraph.NODE_WIDTH,60],this.graph=null,this._pos=new Float32Array(10,10),LiteGraph.use_uuids?this.id=LiteGraph.uuidv4():this.id=-1,this.type=null,this.inputs=[],this.outputs=[],this.connections=[],this.properties={},this.properties_info=[],this.flags={}}set pos(t){var n;!t||t.length<2||((n=this._pos)!=null||(this._pos=new Float32Array(10,10)),this._pos[0]=t[0],this._pos[1]=t[1])}get pos(){return this._pos}configure(t){var n,a,r,l,p;Object.entries(t).forEach(([h,c])=>{var u;if(h==="properties"){for(var d in c)this.properties[d]=c[d],(u=this.onPropertyChanged)==null||u.call(this,d,c[d]);return}c!==null&&(typeof c=="object"?this[h]&&this[h].configure?this[h].configure(c):this[h]=LiteGraph.cloneObject(c,this[h]):this[h]=c)}),t.title||(this.title=this.constructor.title),(n=this.inputs)==null||n.forEach((h,c)=>{var u,d;if(!h.link)return;const f=this.graph?this.graph.links[h.link]:null;(u=this.onConnectionsChange)==null||u.call(this,LiteGraph.INPUT,c,!0,f,h),(d=this.onInputAdded)==null||d.call(this,h)}),(a=this.outputs)==null||a.forEach((h,c)=>{var u;h.links&&(h.links.forEach(()=>{var d;const f=this.graph;(d=this.onConnectionsChange)==null||d.call(this,LiteGraph.OUTPUT,c,!0,f,h)}),(u=this.onOutputAdded)==null||u.call(this,h))}),this.widgets&&(this.widgets.forEach(h=>{h&&h.options&&h.options.property&&this.properties[h.options.property]!==void 0&&(h.value=JSON.parse(JSON.stringify(this.properties[h.options.property])))}),(r=t.widgets_values)==null||r.forEach((h,c)=>{this.widgets[c]&&(this.widgets[c].value=h)})),(l=this.onConfigure)==null||l.call(this,t),(p=this.graph)==null||p.onGraphChanged({action:"nodeConfigure",doSave:!1})}serialize(){var t,n,a,r={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:LiteGraph.cloneObject(this.flags),order:this.order,mode:this.mode};return this.constructor===LGraphNode&&this.last_serialization?this.last_serialization:(this.inputs&&(r.inputs=LiteGraph.cloneObject(this.inputs)),this.outputs&&(this.outputs.forEach(l=>{delete l._data}),r.outputs=LiteGraph.cloneObject(this.outputs)),this.title&&this.title!=this.constructor.title&&(r.title=this.title),this.properties&&(r.properties=LiteGraph.cloneObject(this.properties)),this.widgets&&this.serialize_widgets&&(r.widgets_values=this.widgets.map(l=>{var p;return(p=l==null?void 0:l.value)!=null?p:null})),(t=r.type)!=null||(r.type=this.constructor.type),this.color&&(r.color=this.color),this.bgcolor&&(r.bgcolor=this.bgcolor),this.boxcolor&&(r.boxcolor=this.boxcolor),this.shape&&(r.shape=this.shape),(n=this.onSerialize)!=null&&n.call(this,r)&&((a=LiteGraph.warn)==null||a.call(LiteGraph,"node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter")),r)}clone(){var t,n,a=LiteGraph.createNode(this.type);if(!a)return null;var r=LiteGraph.cloneObject(this.serialize());return(t=r.inputs)==null||t.forEach(l=>{l.link=null}),(n=r.outputs)==null||n.forEach(l=>{l.links&&(l.links.length=0)}),delete r.id,LiteGraph.use_uuids&&(r.id=LiteGraph.uuidv4()),a.configure(r),a}toString(){return JSON.stringify(this.serialize())}getTitle(){var t;return(t=this.title)!=null?t:this.constructor.title}setProperty(t,n){var a,r;if(this.properties||(this.properties={}),n===this.properties[t])return;const l=this.properties[t];this.properties[t]=n,((a=this.onPropertyChanged)==null?void 0:a.call(this,t,n,l))===!1&&(this.properties[t]=l);const p=(r=this.widgets)==null?void 0:r.find(h=>{var c;return h&&((c=h.options)==null?void 0:c.property)===t});p&&(p.value=n)}setOutputData(t,n){var a;if(this.outputs){if((t==null?void 0:t.constructor)===String)t=this.findOutputSlot(t);else if(t==-1||t>=this.outputs.length)return;var r=this.outputs[t];r&&(r._data=n,(a=this.outputs[t].links)==null||a.forEach(l=>{const p=this.graph.links[l];p&&(p.data=n)}))}}setOutputDataType(t,n){var a,r;if(this.outputs&&!(t==-1||t>=this.outputs.length)){var l=this.outputs[t];l&&(l.type=n,(r=(a=this.outputs[t])==null?void 0:a.links)==null||r.forEach(p=>{this.graph.links[p]&&(this.graph.links[p].type=n)}))}}getInputData(t,n,a){var r;if(this.inputs&&!(t>=this.inputs.length||this.inputs[t].link==null)){var l=this.inputs[t].link,p=this.graph.links[l];if(!p)return null;if(!n)return p.data;var h=this.graph.getNodeById(p.origin_id);if(!h)return p.data;if(a){var c=this.id+"_getInputData_forced_"+Math.floor(Math.random()*9999),u={action:c,options:{action_call:c}};this.refreshAncestors(u)}return h.updateOutputData?h.updateOutputData(p.origin_slot):(r=h.doExecute)==null||r.call(h),p.data}}getInputDataType(t){if(!this.inputs||t>=this.inputs.length||this.inputs[t].link==null)return null;var n=this.inputs[t].link,a=this.graph.links[n];if(!a)return null;var r=this.graph.getNodeById(a.origin_id);if(!r)return a.type;var l=r.outputs[a.origin_slot];return l?l.type:null}getInputDataByName(t,n){var a=this.findInputSlot(t);return a==-1?null:this.getInputData(a,n)}isInputConnected(t){return this.inputs?t<this.inputs.length&&this.inputs[t].link!=null:!1}getInputInfo(t){return this.inputs&&t<this.inputs.length?this.inputs[t]:null}getInputLink(t){if(!this.inputs)return null;if(t<this.inputs.length){var n=this.inputs[t];return this.graph.links[n.link]}return null}getInputNode(t){if(!this.inputs||t>=this.inputs.length)return null;var n=this.inputs[t];if(!n||n.link===null)return null;var a=this.graph.links[n.link];return a?this.graph.getNodeById(a.origin_id):null}getInputOrProperty(t){if(this.inputs)for(var n=0,a=this.inputs.length;n<a;++n){var r=this.inputs[n];if(t==r.name&&r.link!=null){var l=this.graph.links[r.link];if(l)return l.data}}return this.properties?this.properties[t]:null}getOutputData(t){if(!this.outputs||t>=this.outputs.length)return null;var n=this.outputs[t];return n._data}getOutputInfo(t){return this.outputs&&t<this.outputs.length?this.outputs[t]:null}isOutputConnected(t){return this.outputs?t<this.outputs.length&&this.outputs[t].links&&this.outputs[t].links.length:!1}isAnyOutputConnected(){return this.outputs?this.outputs.some(t=>t.links&&t.links.length):!1}getOutputNodes(t){if(!this.outputs||t>=this.outputs.length)return null;const n=this.outputs[t];return!n.links||n.links.length===0?null:n.links.map(a=>this.graph.links[a]).filter(a=>a).map(a=>this.graph.getNodeById(a.target_id)).filter(a=>a)}addOnTriggerInput(){var t=this.findInputSlot("onTrigger");return t==-1?(this.addInput("onTrigger",LiteGraph.EVENT,{removable:!0,nameLocked:!0}),this.findInputSlot("onTrigger")):t}addOnExecutedOutput(){var t=this.findOutputSlot("onExecuted");return t==-1?(this.addOutput("onExecuted",LiteGraph.ACTION,{removable:!0,nameLocked:!0}),this.findOutputSlot("onExecuted")):t}onAfterExecuteNode(t,n){var a,r=this.findOutputSlot("onExecuted");r!=-1&&((a=LiteGraph.debug)==null||a.call(LiteGraph,this.id+":"+this.order+" triggering slot onAfterExecute",t,n),this.triggerSlot(r,t,null,n))}changeMode(t){switch(t){case LiteGraph.ON_TRIGGER:this.addOnTriggerInput(),this.addOnExecutedOutput();break;case LiteGraph.ON_EVENT:break;case LiteGraph.NEVER:break;case LiteGraph.ALWAYS:break;case LiteGraph.ON_REQUEST:break;default:return!1}return this.mode=t,!0}executePendingActions(){!this._waiting_actions||!this._waiting_actions.length||(this._waiting_actions.forEach(t=>{this.onAction(t[0],t[1],t[2],t[3],t[4])}),this._waiting_actions.length=0)}doExecute(t,n={}){var a,r,l,p,h;if(this.onExecute){if((a=n.action_call)!=null||(n.action_call=`${this.id}_exec_${Math.floor(Math.random()*9999)}`),this.graph.nodes_executing&&this.graph.nodes_executing[this.id]){(r=LiteGraph.debug)==null||r.call(LiteGraph,"NODE already executing! Prevent! "+this.id+":"+this.order);return}if(LiteGraph.ensureNodeSingleExecution&&this.exec_version&&this.exec_version>=this.graph.iteration&&this.exec_version!==void 0){(l=LiteGraph.debug)==null||l.call(LiteGraph,"!! NODE already EXECUTED THIS STEP !! "+this.exec_version);return}if(LiteGraph.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&n&&n.action_call&&this.graph.nodes_executedAction[this.id]==n.action_call){(p=LiteGraph.debug)==null||p.call(LiteGraph,"!! NODE already ACTION THIS STEP !! "+n.action_call);return}this.graph.nodes_executing[this.id]=!0,this.onExecute(t,n),this.graph.nodes_executing[this.id]=!1,this.exec_version=this.graph.iteration,n&&n.action_call&&(this.action_call=n.action_call,this.graph.nodes_executedAction[this.id]=n.action_call)}this.execute_triggered=2,(h=this.onAfterExecuteNode)==null||h.call(this,t,n)}execute(t,n={}){return this.doExecute(t,n)}actionDo(t,n,a={},r){var l,p,h,c;if(this.onAction){if((l=a.action_call)!=null||(a.action_call=`${this.id}_${t||"action"}_${Math.floor(Math.random()*9999)}`),LiteGraph.ensureNodeSingleAction&&this.graph.nodes_actioning&&this.graph.nodes_actioning[this.id]==a.action_call)return;if((p=LiteGraph.debug)==null||p.call(LiteGraph,"CheckActioned ? "+this.id+":"+this.order+" :: "+this.action_call),LiteGraph.ensureUniqueExecutionAndActionCall&&this.graph.nodes_executedAction[this.id]&&a&&a.action_call&&this.graph.nodes_executedAction[this.id]==a.action_call){(h=LiteGraph.debug)==null||h.call(LiteGraph,"!! NODE already ACTION THIS STEP !! "+a.action_call),\u00E7;return}this.graph.nodes_actioning[this.id]=t||"actioning",this.onAction(t,n,a,r),this.graph.nodes_actioning[this.id]=!1,a&&a.action_call&&(this.action_call=a.action_call,this.graph.nodes_executedAction[this.id]=a.action_call)}this.action_triggered=2,(c=this.onAfterExecuteNode)==null||c.call(this,n,a)}trigger(t,n,a){!this.outputs||this.outputs.length===0||(this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime()),this.outputs.forEach((r,l)=>{r&&r.type===LiteGraph.EVENT&&(!t||r.name===t)&&this.triggerSlot(l,n,null,a)}))}triggerSlot(t,n,a,r={}){var l,p,h,c;if(this.outputs){if(t==null){(l=LiteGraph.error)==null||l.call(LiteGraph,"triggerSlot","slot must be a number");return}t.constructor!==Number&&((p=LiteGraph.warn)==null||p.call(LiteGraph,"triggerSlot","slot must be a number, use node.trigger('name') if you want to use a string"));var u=this.outputs[t];if(u){var d=u.links;if(!(!d||!d.length)&&!(this.graph&&this.graph.ancestorsCall)){this.graph&&(this.graph._last_trigger_time=LiteGraph.getTime());for(var f=0;f<d.length;++f){var L=d[f];if(!(a!=null&&a!=L)){var g=this.graph.links[d[f]];if(g){g._last_time=LiteGraph.getTime();var _=this.graph.getNodeById(g.target_id);if(_){if(_.mode===LiteGraph.ON_TRIGGER)r.action_call||(r.action_call=`${this.id}_trigg_${Math.floor(Math.random()*9999)}`),LiteGraph.refreshAncestorsOnTriggers&&_.refreshAncestors({action:"trigger",param:n,options:r}),_.onExecute&&_.doExecute(n,r);else if(_.onAction){r.action_call||(r.action_call=`${this.id}_act_${Math.floor(Math.random()*9999)}`);let m=_.inputs[g.target_slot];(h=LiteGraph.debug)==null||h.call(LiteGraph,"triggerSlot","will call onACTION: "+this.id+":"+this.order+" :: "+m.name),LiteGraph.refreshAncestorsOnActions&&_.refreshAncestors({action:m.name,param:n,options:r}),LiteGraph.use_deferred_actions&&_.onExecute?((c=_._waiting_actions)!=null||(_._waiting_actions=[]),_._waiting_actions.push([m.name,n,r,g.target_slot])):_.actionDo(m.name,n,r,g.target_slot)}}}}}}}}}clearTriggeredSlot(t,n){!this.outputs||!this.outputs[t]||!this.outputs[t].links||this.outputs[t].links.forEach(a=>{if(n!==null&&n!==a)return;const r=this.graph.links[a];r&&(r._last_time=0)})}setSize(t){var n;this.size=t,(n=this.onResize)==null||n.call(this,this.size)}addProperty(t,n,a,r){var l,p;const h={name:t,type:a,default_value:n,...r};return this.properties_info=(l=this.properties_info)!=null?l:[],this.properties_info.push(h),this.properties=(p=this.properties)!=null?p:{},this.properties[t]=n,h}addInput(t,n,a){return this.addSlot(t,n,a,!0)}addOutput(t,n,a){return this.addSlot(t,n,a,!1)}addSlot(t,n,a,r){var l,p,h,c;const u=r?{name:t,type:n,link:null,...a}:{name:t,type:n,links:null,...a};return r?(this.inputs=(l=this.inputs)!=null?l:[],this.inputs.push(u),(p=this.onInputAdded)==null||p.call(this,u),LiteGraph.registerNodeAndSlotType(this,n)):(this.outputs=(h=this.outputs)!=null?h:[],this.outputs.push(u),(c=this.onOutputAdded)==null||c.call(this,u),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,n,!0)),this.setSize(this.computeSize()),this.setDirtyCanvas(!0,!0),u}addInputs(t){this.addSlots(t,!0)}addOutputs(t){this.addSlots(t,!1)}addSlots(t,n){var a;typeof t=="string"&&(t=[t]),t.forEach(r=>{var l,p,h,c,u,d;const f=n?{name:r[0],type:r[1],link:null,...(l=r[2])!=null?l:{}}:{name:r[0],type:r[1],links:null,...(p=r[2])!=null?p:{}};n?(this.inputs=(h=this.inputs)!=null?h:[],this.inputs.push(f),(c=this.onInputAdded)==null||c.call(this,f),LiteGraph.registerNodeAndSlotType(this,r[1])):(this.outputs=(u=this.outputs)!=null?u:[],this.outputs.push(f),(d=this.onOutputAdded)==null||d.call(this,f),LiteGraph.auto_load_slot_types&&LiteGraph.registerNodeAndSlotType(this,r[1],!0))}),this.setSize(this.computeSize()),(a=this.setDirtyCanvas)==null||a.call(this,!0,!0)}removeInput(t){var n;this.disconnectInput(t);const a=this.inputs.splice(t,1)[0];this.inputs.slice(t).filter(r=>!!r).forEach(r=>{const l=this.graph.links[r.link];l!=null&&l.target_slot&&l.target_slot--}),this.setSize(this.computeSize()),(n=this.onInputRemoved)==null||n.call(this,t,a),this.setDirtyCanvas(!0,!0)}removeOutput(t){var n;this.disconnectOutput(t),this.outputs=this.outputs.filter((a,r)=>r!==t),this.outputs.slice(t).forEach(a=>{!a||!a.links||a.links.forEach(r=>{const l=this.graph.links[r];l&&(l.origin_slot-=1)})}),this.setSize(this.computeSize()),(n=this.onOutputRemoved)==null||n.call(this,t),this.setDirtyCanvas(!0,!0)}addConnection(t,n,a,r){var l={name:t,type:n,pos:a,direction:r,links:null};return this.connections.push(l),l}computeSize(t){if(this.constructor.size)return this.constructor.size.concat();var n=t||new Float32Array([0,0]),a=LiteGraph.NODE_TEXT_SIZE;const r=L=>L?a*L.length*.6:0;var l=r(this.title),p=0,h=0;this.inputs&&(p=this.inputs.reduce((L,g)=>{const _=g.label||g.name||"",m=r(_);return Math.max(L,m)},0)),this.outputs&&(h=this.outputs.reduce((L,g)=>{const _=g.label||g.name||"",m=r(_);return Math.max(L,m)},0)),n[0]=Math.max(p+h+10,l),n[0]=Math.max(n[0],LiteGraph.NODE_WIDTH),this.widgets&&this.widgets.length&&(n[0]=Math.max(n[0],LiteGraph.NODE_WIDTH*1.5));const c=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1,1)*LiteGraph.NODE_SLOT_HEIGHT;n[1]=c+(this.constructor.slot_start_y||0);let u=0;if(this.widgets&&this.widgets.length){for(var d=0,f=this.widgets.length;d<f;++d)this.widgets[d].computeSize?u+=this.widgets[d].computeSize(n[0])[1]+4:u+=LiteGraph.NODE_WIDGET_HEIGHT+4;u+=8}return this.widgets_up?n[1]=Math.max(n[1],u):this.widgets_start_y!=null?n[1]=Math.max(n[1],u+this.widgets_start_y):n[1]+=u,this.constructor.min_height&&n[1]<this.constructor.min_height&&(n[1]=this.constructor.min_height),n[1]+=6,n}getPropertyInfo(t){var n=null;if(this.properties_info){for(var a=0;a<this.properties_info.length;++a)if(this.properties_info[a].name==t){n=this.properties_info[a];break}}return this.constructor[`@${t}`]&&(n=this.constructor[`@${t}`]),this.constructor.widgets_info&&this.constructor.widgets_info[t]&&(n=this.constructor.widgets_info[t]),!n&&this.onGetPropertyInfo&&(n=this.onGetPropertyInfo(t)),n||(n={}),n.type||(n.type=typeof this.properties[t]),n.widget=="combo"&&(n.type="enum"),n}addWidget(t,n,a,r,l){var p,h,c;(p=this.widgets)!=null||(this.widgets=[]),!l&&r&&r.constructor===Object&&(l=r,r=null),l&&l.constructor===String&&(l={property:l}),r&&r.constructor===String&&(l!=null||(l={}),l.property=r,r=null),r&&r.constructor!==Function&&((h=LiteGraph.warn)==null||h.call(LiteGraph,"addWidget: callback must be a function"),r=null);var u={type:t.toLowerCase(),name:n,value:a,callback:r,options:l||{}};if(u.options.y!==void 0&&(u.y=u.options.y),!r&&!u.options.callback&&!u.options.property&&((c=LiteGraph.warn)==null||c.call(LiteGraph,"LiteGraph addWidget(...) without a callback or property assigned")),t=="combo"&&!u.options.values)throw Error("LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }");return this.widgets.push(u),this.setSize(this.computeSize()),u}addCustomWidget(t){var n;return(n=this.widgets)!=null||(this.widgets=[]),this.widgets.push(t),t}getBounding(t=new Float32Array(4),n){const a=this.pos,r=this.flags.collapsed,l=this.size;let p=0,h=1,c=0,u=0;return n&&(p=4,h=6+p,c=4,u=5+c),t[0]=a[0]-p,t[1]=a[1]-LiteGraph.NODE_TITLE_HEIGHT-c,t[2]=r?(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+h:l[0]+h,t[3]=r?LiteGraph.NODE_TITLE_HEIGHT+u:l[1]+LiteGraph.NODE_TITLE_HEIGHT+u,this.onBounding&&this.onBounding(t),t}isPointInside(t,n,a=0,r){var l=this.graph&&this.graph.isLive()?0:LiteGraph.NODE_TITLE_HEIGHT;if(r&&(l=0),this.flags&&this.flags.collapsed){if(LiteGraph.isInsideRectangle(t,n,this.pos[0]-a,this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT-a,(this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH)+2*a,LiteGraph.NODE_TITLE_HEIGHT+2*a))return!0}else if(this.pos[0]-4-a<t&&this.pos[0]+this.size[0]+4+a>t&&this.pos[1]-l-a<n&&this.pos[1]+this.size[1]+a>n)return!0;return!1}getSlotInPosition(t,n){var a=new Float32Array(2);if(this.inputs)for(let r=0,l=this.inputs.length;r<l;++r){let p=this.inputs[r];if(this.getConnectionPos(!0,r,a),LiteGraph.isInsideRectangle(t,n,a[0]-10,a[1]-5,20,10))return{input:p,slot:r,link_pos:a}}if(this.outputs)for(let r=0,l=this.outputs.length;r<l;++r){let p=this.outputs[r];if(this.getConnectionPos(!1,r,a),LiteGraph.isInsideRectangle(t,n,a[0]-10,a[1]-5,20,10))return{output:p,slot:r,link_pos:a}}return null}findInputSlot(t,n){if(!this.inputs)return-1;for(var a=0,r=this.inputs.length;a<r;++a)if(t==this.inputs[a].name)return n?this.inputs[a]:a;return-1}findOutputSlot(t,n=!1){if(!this.outputs)return-1;for(var a=0,r=this.outputs.length;a<r;++a)if(t==this.outputs[a].name)return n?this.outputs[a]:a;return-1}findInputSlotFree(t={}){var n={returnObj:!1,typesNotAccepted:[]},a=Object.assign(n,t);if(!this.inputs)return-1;for(var r=0,l=this.inputs.length;r<l;++r)if(!(this.inputs[r].link&&this.inputs[r].link!=null)&&!(a.typesNotAccepted&&a.typesNotAccepted.includes&&a.typesNotAccepted.includes(this.inputs[r].type)))return a.returnObj?this.inputs[r]:r;return-1}findOutputSlotFree(t={}){var n={returnObj:!1,typesNotAccepted:[]},a=Object.assign(n,t);if(!this.outputs)return-1;for(let r=0,l=this.outputs.length;r<l;++r)if(!(this.outputs[r].links&&this.outputs[r].links!=null)&&!(a.typesNotAccepted&&a.typesNotAccepted.includes&&a.typesNotAccepted.includes(this.outputs[r].type)))return a.returnObj?this.outputs[r]:r;return-1}findInputSlotByType(t,n,a,r){return this.findSlotByType(!0,t,n,a,r)}findOutputSlotByType(t,n,a,r){return this.findSlotByType(!1,t,n,a,r)}findSlotByType(t=!1,n,a=!1,r=!1,l=!1){var p=t?this.inputs:this.outputs;if(!p)return-1;(n==""||n=="*")&&(n=0);for(let h=0,c=p.length;h<c;++h){let u=(n+"").toLowerCase().split(","),d=p[h].type=="0"||p[h].type=="*"?"0":p[h].type;d=(d+"").toLowerCase().split(",");for(let f=0;f<u.length;f++)for(let L=0;L<d.length;L++)if(u[f]=="_event_"&&(u[f]=LiteGraph.EVENT),d[f]=="_event_"&&(d[f]=LiteGraph.EVENT),u[f]=="*"&&(u[f]=0),d[f]=="*"&&(d[f]=0),u[f]==d[L]){if(r&&p[h].links&&p[h].links!==null)continue;return a?p[h]:h}}if(r&&!l)for(let h=0,c=p.length;h<c;++h){let u=(n+"").toLowerCase().split(","),d=p[h].type=="0"||p[h].type=="*"?"0":p[h].type;d=(d+"").toLowerCase().split(",");for(let f=0;f<u.length;f++)for(let L=0;L<d.length;L++)if(u[f]=="*"&&(u[f]=0),d[f]=="*"&&(d[f]=0),u[f]==d[L])return a?p[h]:h}return-1}connectByType(t,n,a="*",r={}){var l,p,h,c,u,d={createEventInCase:!0,firstFreeIfOutputGeneralInCase:!0,generalTypeInCase:!0},f=Object.assign(d,r);n&&n.constructor===Number&&(n=this.graph.getNodeById(n));var L=n.findInputSlotByType(a,!1,!0);return L>=0&&L!==null?((l=LiteGraph.debug)==null||l.call(LiteGraph,"CONNbyTYPE type "+a+" for "+L),this.connect(t,n,L)):f.createEventInCase&&a==LiteGraph.EVENT?((p=LiteGraph.debug)==null||p.call(LiteGraph,"connect WILL CREATE THE onTrigger "+a+" to "+n),this.connect(t,n,-1)):f.generalTypeInCase&&(L=n.findInputSlotByType(0,!1,!0,!0),(h=LiteGraph.debug)==null||h.call(LiteGraph,"connect TO a general type (*, 0), if not found the specific type ",a," to ",n,"RES_SLOT:",L),L>=0)?this.connect(t,n,L):f.firstFreeIfOutputGeneralInCase&&(a==0||a=="*"||a=="")&&(L=n.findInputSlotFree({typesNotAccepted:[LiteGraph.EVENT]}),(c=LiteGraph.debug)==null||c.call(LiteGraph,"connect TO TheFirstFREE ",a," to ",n,"RES_SLOT:",L),L>=0)?this.connect(t,n,L):((u=LiteGraph.debug)==null||u.call(LiteGraph,"no way to connect type: ",a," to targetNODE ",n),null)}connectByTypeOutput(t,n,a="*",r={}){var l,p,h,c={createEventInCase:!0,firstFreeIfInputGeneralInCase:!0,generalTypeInCase:!0},u=Object.assign(c,r);n&&n.constructor===Number&&(n=this.graph.getNodeById(n));var d=n.findOutputSlotByType(a,!1,!0);return d>=0&&d!==null?((l=LiteGraph.debug)==null||l.call(LiteGraph,"CONNbyTYPE OUT! type "+a+" for "+d),n.connect(d,this,t)):u.generalTypeInCase&&(d=n.findOutputSlotByType(0,!1,!0,!0),d>=0)?n.connect(d,this,t):u.createEventInCase&&a==LiteGraph.EVENT&&LiteGraph.do_add_triggers_slots?(d=n.addOnExecutedOutput(),n.connect(d,this,t)):u.firstFreeIfInputGeneralInCase&&(a==0||a=="*"||a==""||a=="undefined")&&(d=n.findOutputSlotFree({typesNotAccepted:[LiteGraph.EVENT]}),d>=0)?n.connect(d,this,t):((p=LiteGraph.debug)==null||p.call(LiteGraph,"no way to connect byOUT type: ",a," to sourceNODE ",n),(h=LiteGraph.log)==null||h.call(LiteGraph,"type OUT! "+a+" not found or not free?"),null)}connect(t,n,a=0){var r,l,p,h,c,u,d,f,L,g,_,m,G,b;if(!this.graph)return(r=LiteGraph.log)==null||r.call(LiteGraph,"Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return(l=LiteGraph.log)==null||l.call(LiteGraph,`Connect: Error, no slot of name ${t}`),null}else if(!this.outputs||t>=this.outputs.length)return(p=LiteGraph.log)==null||p.call(LiteGraph,"Connect: Error, slot number not found"),null;if(n&&n.constructor===Number&&(n=this.graph.getNodeById(n)),!n)throw new Error("target node is null");if(n==this)return null;if(a.constructor===String){if(a=n.findInputSlot(a),a==-1)return(h=LiteGraph.log)==null||h.call(LiteGraph,`Connect: Error, no slot of name ${a}`),null}else if(a===LiteGraph.EVENT)if(LiteGraph.do_add_triggers_slots)n.changeMode(LiteGraph.ON_TRIGGER),a=n.findInputSlot("onTrigger");else return null;else if(!n.inputs||a>=n.inputs.length)return(c=LiteGraph.log)==null||c.call(LiteGraph,"Connect: Error, slot number not found"),null;var T=!1,E=n.inputs[a],k=null,N=this.outputs[t];if(!this.outputs[t])return(u=LiteGraph.log)==null||u.call(LiteGraph,"Invalid slot passed: ",t,this.outputs),null;if(n.onBeforeConnectInput&&(a=n.onBeforeConnectInput(n)),((d=this.onConnectOutput)==null?void 0:d.call(this,t,E.type,E,n,a))===!1)return null;if(a===!1||a===null||!LiteGraph.isValidConnection(N.type,E.type))return this.setDirtyCanvas(!1,!0),T&&this.graph.connectionChange(this,k),null;if((f=LiteGraph.debug)==null||f.call(LiteGraph,"DBG targetSlot",a),((L=n.onConnectInput)==null?void 0:L.call(n,a,N.type,N,this,t))===!1||((g=this.onConnectOutput)==null?void 0:g.call(this,t,E.type,E,n,a))===!1)return null;n.inputs[a]&&n.inputs[a].link!=null&&(this.graph.beforeChange(),n.disconnectInput(a,{doProcessChange:!1}),T=!0),(_=N.links)!=null&&_.length&&N.type===LiteGraph.EVENT&&(LiteGraph.allow_multi_output_for_events||(this.graph.beforeChange(),this.disconnectOutput(t,!1,{doProcessChange:!1}),T=!0));var P;return LiteGraph.use_uuids?P=LiteGraph.uuidv4():P=++this.graph.last_link_id,k=new LiteGraph.LLink(P,E.type||N.type,this.id,t,n.id,a),this.graph.links[k.id]=k,N.links==null&&(N.links=[]),N.links.push(k.id),typeof n.inputs[a]=="undefined"&&((m=LiteGraph.warn)==null||m.call(LiteGraph,"FIXME error, target_slot does not exists on target_node",n,a)),n.inputs[a].link=k.id,(G=this.onConnectionsChange)==null||G.call(this,LiteGraph.OUTPUT,t,!0,k,N),(b=n.onConnectionsChange)==null||b.call(n,LiteGraph.INPUT,a,!0,k,E),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.INPUT,n,a,this,t),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t,n,a)),this.graph.onGraphChanged({action:"connect"}),this.setDirtyCanvas(!1,!0),this.graph.afterChange(),this.graph.connectionChange(this,k),k}disconnectOutput(t,n,a={}){var r,l,p,h,c,u,d={doProcessChange:!0},f=Object.assign(d,a);if(t.constructor===String){if(t=this.findOutputSlot(t),t==-1)return(r=LiteGraph.log)==null||r.call(LiteGraph,`Connect: Error, no slot of name ${t}`),!1}else if(!this.outputs||t>=this.outputs.length)return(l=LiteGraph.log)==null||l.call(LiteGraph,"Connect: Error, slot number not found"),!1;var L=this.outputs[t];if(!L||!L.links||L.links.length==0)return!1;if(n){if(n.constructor===Number&&(n=this.graph.getNodeById(n)),!n)throw new Error("Target Node not found");for(let _=0,m=L.links.length;_<m;_++){let G=L.links[_],b=this.graph.links[G];if(b.target_id==n.id){L.links.splice(_,1);var g=n.inputs[b.target_slot];g.link=null,delete this.graph.links[G],(p=this.graph)==null||p.onGraphChanged({action:"disconnectOutput",doSave:f.doProcessChange}),(h=n.onConnectionsChange)==null||h.call(n,LiteGraph.INPUT,b.target_slot,!1,b,g),(c=this.onConnectionsChange)==null||c.call(this,LiteGraph.OUTPUT,t,!1,b,L),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,n,b.target_slot));break}}}else{for(let _=0,m=L.links.length;_<m;_++){let G=L.links[_],b=this.graph.links[G];b&&(n=this.graph.getNodeById(b.target_id),g=null,(u=this.graph)==null||u.onGraphChanged({action:"disconnectOutput",doSave:f.doProcessChange}),n&&(g=n.inputs[b.target_slot],g.link=null,n.onConnectionsChange&&n.onConnectionsChange(LiteGraph.INPUT,b.target_slot,!1,b,g),this.graph&&this.graph.onNodeConnectionChange&&this.graph.onNodeConnectionChange(LiteGraph.INPUT,n,b.target_slot)),delete this.graph.links[G],this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.OUTPUT,t,!1,b,L),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,this,t),this.graph.onNodeConnectionChange(LiteGraph.INPUT,n,b.target_slot)))}L.links=null}return this.setDirtyCanvas(!1,!0),this.graph.connectionChange(this),!0}disconnectInput(t,n={}){var a,r,l,p={doProcessChange:!0},h=Object.assign(p,n);if(t.constructor===String){if(t=this.findInputSlot(t),t==-1)return(a=LiteGraph.log)==null||a.call(LiteGraph,`Connect: Error, no slot of name ${t}`),!1}else if(!this.inputs||t>=this.inputs.length)return(r=LiteGraph.log)==null||r.call(LiteGraph,"Connect: Error, slot number not found"),!1;var c=this.inputs[t];if(!c)return!1;var u=this.inputs[t].link;if(u!=null){this.inputs[t].link=null;var d=this.graph.links[u];if(d){var f=this.graph.getNodeById(d.origin_id);if(!f)return!1;var L=f.outputs[d.origin_slot];if(!L||!L.links||L.links.length==0)return!1;for(var g=0,_=L.links.length;g<_;g++)if(L.links[g]==u){L.links.splice(g,1);break}delete this.graph.links[u],(l=this.graph)==null||l.onGraphChanged({action:"disconnectInput",doSave:h.doProcessChange}),this.onConnectionsChange&&this.onConnectionsChange(LiteGraph.INPUT,t,!1,d,c),f.onConnectionsChange&&f.onConnectionsChange(LiteGraph.OUTPUT,g,!1,d,L),this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(LiteGraph.OUTPUT,f,g),this.graph.onNodeConnectionChange(LiteGraph.INPUT,this,t))}}return this.setDirtyCanvas(!1,!0),this.graph&&this.graph.connectionChange(this),!0}getConnectionPos(t,n,a=new Float32Array(2)){var r=0;t&&this.inputs&&(r=this.inputs.length),!t&&this.outputs&&(r=this.outputs.length);var l=LiteGraph.NODE_SLOT_HEIGHT*.5;if(this.flags.collapsed){var p=this._collapsed_width||LiteGraph.NODE_COLLAPSED_WIDTH;return this.horizontal?(a[0]=this.pos[0]+p*.5,t?a[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:a[1]=this.pos[1]):(t?a[0]=this.pos[0]:a[0]=this.pos[0]+p,a[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT*.5),a}return t&&n==-1?(a[0]=this.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*.5,a[1]=this.pos[1]+LiteGraph.NODE_TITLE_HEIGHT*.5,a):t&&r>n&&this.inputs[n].pos?(a[0]=this.pos[0]+this.inputs[n].pos[0],a[1]=this.pos[1]+this.inputs[n].pos[1],a):!t&&r>n&&this.outputs[n].pos?(a[0]=this.pos[0]+this.outputs[n].pos[0],a[1]=this.pos[1]+this.outputs[n].pos[1],a):this.horizontal?(a[0]=this.pos[0]+(n+.5)*(this.size[0]/r),t?a[1]=this.pos[1]-LiteGraph.NODE_TITLE_HEIGHT:a[1]=this.pos[1]+this.size[1],a):(t?a[0]=this.pos[0]+l:a[0]=this.pos[0]+this.size[0]+1-l,a[1]=this.pos[1]+(n+.7)*LiteGraph.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0),a)}alignToGrid(){this.pos[0]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[0]/LiteGraph.CANVAS_GRID_SIZE),this.pos[1]=LiteGraph.CANVAS_GRID_SIZE*Math.round(this.pos[1]/LiteGraph.CANVAS_GRID_SIZE)}trace(t){var n,a,r,l;this.console||(this.console=[]),(a=(n=this.console).push)==null||a.call(n,t),this.console.length>LGraphNode.MAX_CONSOLE&&((l=(r=this.console).shift)==null||l.call(r)),this.graph.onNodeTrace&&this.graph.onNodeTrace(this,t)}setDirtyCanvas(t,n){this.graph&&this.graph.sendActionToCanvas("setDirty",[t,n])}loadImage(t){var n=new Image;n.src=LiteGraph.node_images_path+t,n.ready=!1;var a=this;return n.onload=function(){this.ready=!0,a.setDirtyCanvas(!0)},n}captureInput(t){if(!(!this.graph||!this.graph.list_of_graphcanvas))for(var n=this.graph.list_of_graphcanvas,a=0;a<n.length;++a){var r=n[a];!t&&r.node_capturing_input!=this||(r.node_capturing_input=t?this:null)}}collapse(t){this.graph.onGraphChanged({action:"collapse"}),!(this.constructor.collapsable===!1&&!t)&&(this.flags.collapsed?this.flags.collapsed=!1:this.flags.collapsed=!0,this.setDirtyCanvas(!0,!0))}pin(t){this.graph.onGraphChanged({action:"pin"}),t===void 0?this.flags.pinned=!this.flags.pinned:this.flags.pinned=t}localToScreen(t,n,a){return[(t+this.pos[0])*a.scale+a.offset[0],(n+this.pos[1])*a.scale+a.offset[1]]}refreshAncestors(t={}){var n={action:"",param:null,options:null,passParam:!0},a=Object.assign(n,t);if(this.inputs&&!(LiteGraph.preventAncestorRecalculation&&this.graph.node_ancestorsCalculated&&this.graph.node_ancestorsCalculated[this.id])){(!a.action||a.action=="")&&(a.action=this.id+"_ancestors"),(!a.param||a.param=="")&&(a.param=this.id+"_ancestors"),a.options||(a.options={}),a.options=Object.assign({action_call:a.action},a.options),this.graph.ancestorsCall=!0;var r={modesSkip:[LiteGraph.NEVER,LiteGraph.ON_EVENT,LiteGraph.ON_TRIGGER],modesOnly:[LiteGraph.ALWAYS,LiteGraph.ON_REQUEST],typesSkip:[LiteGraph.ACTION],typesOnly:[]},l=this.graph.getAncestors(this,r);for(iN in l)l[iN].doExecute(a.param,a.options),this.graph.node_ancestorsCalculated[l[iN].id]=!0;return this.graph.ancestorsCall=!1,this.graph.node_ancestorsCalculated[this.id]=!0,!0}}}class LGraphGroup{constructor(t="Group"){M(this,"isPointInside",LiteGraph.LGraphNode.prototype.isPointInside),M(this,"setDirtyCanvas",LiteGraph.LGraphNode.prototype.setDirtyCanvas);var n,a;this.title=t,this.font_size=24,this.color=(a=(n=LiteGraph.LGraphCanvas.node_colors.pale_blue)==null?void 0:n.groupcolor)!=null?a:"#AAA",this._bounding=new Float32Array([10,10,140,80]),this._pos=this._bounding.subarray(0,2),this._size=this._bounding.subarray(2,4),this._nodes=[],this.graph=null}set pos(t){!t||t.length<2||(this._pos[0]=t[0],this._pos[1]=t[1])}get pos(){return this._pos}set size(t){!t||t.length<2||(this._size[0]=Math.max(140,t[0]),this._size[1]=Math.max(80,t[1]))}get size(){return this._size}configure(t){this.title=t.title,this._bounding.set(t.bounding),this.color=t.color,t.font_size&&(this.font_size=t.font_size)}serialize(){var t=this._bounding;return{title:this.title,bounding:t.map(n=>Math.round(n)),color:this.color,font_size:this.font_size}}move(t,n,a){var r,l;isNaN(t)&&((r=console.error)==null||r.call(console,"LGraphGroup.move() deltax NaN")),isNaN(n)&&((l=console.error)==null||l.call(console,"LGraphGroup.move() deltay NaN")),this._pos[0]+=t,this._pos[1]+=n,!a&&this._nodes.forEach(p=>{p.pos[0]+=t,p.pos[1]+=n})}recomputeInsideNodes(){this._nodes.length=0;var t=this.graph._nodes,n=new Float32Array(4);this._nodes=t.filter(a=>(a.getBounding(n),LiteGraph.overlapBounding(this._bounding,n)))}}const _LGraphCanvas=class __LGraphCanvas{constructor(o,t,n){M(this,"processMouseWheel",a=>{if(!(!this.graph||!this.allow_dragcanvas)){var r=a.wheelDeltaY!=null?a.wheelDeltaY:a.detail*-60;this.adjustMouseEvent(a);var l=a.clientX,p=a.clientY,h=!this.viewport||this.viewport&&l>=this.viewport[0]&&l<this.viewport[0]+this.viewport[2]&&p>=this.viewport[1]&&p<this.viewport[1]+this.viewport[3];if(h){var c=this.ds.scale;return c*=Math.pow(1.1,r*.01),this.ds.changeScale(c,[a.clientX,a.clientY]),this.graph.change(),a.preventDefault(),!1}}}),M(this,"processKey",a=>{var r,l,p,h,c;if(this.graph){var u=!1;if(a.target.localName!="input"){if(a.type=="keydown"){if(a.keyCode==32&&(this.dragging_canvas=!0,u=!0),a.keyCode==27&&(this.node_panel&&this.node_panel.close(),this.options_panel&&this.options_panel.close(),u=!0),a.keyCode==65&&a.ctrlKey&&(this.selectNodes(),u=!0),a.keyCode===67&&(a.metaKey||a.ctrlKey)&&!a.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),u=!0),a.keyCode===86&&(a.metaKey||a.ctrlKey)&&this.pasteFromClipboard(a.shiftKey),(a.keyCode==46||LiteGraph.backspace_delete&&a.keyCode==8)&&a.target.localName!="input"&&a.target.localName!="textarea"&&(this.deleteSelectedNodes(),u=!0),LiteGraph.actionHistory_enabled&&(a.keyCode==89&&a.ctrlKey||a.keyCode==90&&a.ctrlKey&&a.shiftKey?this.graph.actionHistoryForward():a.keyCode==90&&a.ctrlKey&&this.graph.actionHistoryBack()),(r=LiteGraph.debug)==null||r.call(LiteGraph,"Canvas keydown "+a.keyCode),this.selected_nodes)for(let d in this.selected_nodes)(p=(l=this.selected_nodes[d]).onKeyDown)==null||p.call(l,a)}else if(a.type=="keyup"&&(a.keyCode==32&&(this.dragging_canvas=!1),this.selected_nodes))for(let d in this.selected_nodes)(c=(h=this.selected_nodes[d]).onKeyUp)==null||c.call(h,a);if(this.graph.change(),u)return a.preventDefault(),a.stopImmediatePropagation(),!1}}}),M(this,"processDrop",a=>{a.preventDefault(),this.adjustMouseEvent(a);var r=a.clientX,l=a.clientY,p=!this.viewport||this.viewport&&r>=this.viewport[0]&&r<this.viewport[0]+this.viewport[2]&&l>=this.viewport[1]&&l<this.viewport[1]+this.viewport[3];if(p){r=a.localX,l=a.localY;var p=!this.viewport||this.viewport&&r>=this.viewport[0]&&r<this.viewport[0]+this.viewport[2]&&l>=this.viewport[1]&&l<this.viewport[1]+this.viewport[3];if(p){var h=[a.canvasX,a.canvasY],c=this.graph?this.graph.getNodeOnPos(h[0],h[1]):null;if(!c){var u=null;this.onDropItem&&(u=this.onDropItem(event)),u||this.checkDropItem(a);return}if(c.onDropFile||c.onDropData){var d=a.dataTransfer.files;if(d&&d.length)for(let G=0;G<d.length;G++){var f=a.dataTransfer.files[0],L=f.name;if(c.onDropFile&&c.onDropFile(f),c.onDropData){var g=new FileReader;g.onload=function(b){var T=b.target.result;c.onDropData(T,L,f)};var _=f.type.split("/")[0];_=="text"||_==""?g.readAsText(f):_=="image"?g.readAsDataURL(f):g.readAsArrayBuffer(f)}}}return c.onDropItem&&c.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}}}),n!=null||(n={skip_render:!1,autoresize:!1,clip_all_nodes:!1}),this.options=n,this.background_image=__LGraphCanvas.DEFAULT_BACKGROUND_IMAGE,o&&o.constructor===String&&(o=document.querySelector(o)),this.ds=new LiteGraph.DragAndScale,this.zoom_modify_alpha=!0,this.title_text_font=`${LiteGraph.NODE_TEXT_SIZE}px Arial`,this.inner_text_font=`normal ${LiteGraph.NODE_SUBTEXT_SIZE}px Arial`,this.node_title_color=LiteGraph.NODE_TITLE_COLOR,this.default_link_color=LiteGraph.LINK_COLOR,this.default_connection_color={input_off:"#778",input_on:"#7F7",output_off:"#778",output_on:"#7F7"},this.default_connection_color_byType={},this.default_connection_color_byTypeOff={},this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.highquality_render=!0,this.use_gradients=!1,this.editor_alpha=1,this.pause_rendering=!1,this.clear_background=!0,this.clear_background_color="#222",this.read_only=!1,this.live_mode=!1,this.show_info=!0,this.allow_dragcanvas=!0,this.allow_dragnodes=!0,this.allow_interaction=!0,this.multi_select=!1,this.allow_searchbox=!0,this.move_destination_link_without_shift=!1,this.align_to_grid=!1,this.drag_mode=!1,this.dragging_rectangle=null,this.filter=null,this.set_canvas_dirty_on_mouse_event=!0,this.always_render_background=!1,this.render_shadows=!0,this.render_canvas_border=!0,this.render_connections_shadows=!1,this.render_connections_border=!0,this.render_curved_connections=!0,this.render_connection_arrows=!1,this.render_collapsed_slots=!0,this.render_execution_order=!1,this.render_title_colored=!0,this.render_link_tooltip=!0,this.free_resize=!0,this.links_render_mode=LiteGraph.SPLINE_LINK,this.autoresize=n.autoresize,this.skip_render=n.skip_render,this.clip_all_nodes=n.clip_all_nodes,this.free_resize=n.free_resize,this.mouse=[0,0],this.graph_mouse=[0,0],this.canvas_mouse=this.graph_mouse,this.onSearchBox=null,this.onSearchBoxSelection=null,this.onMouse=null,this.onDrawBackground=null,this.onDrawForeground=null,this.onDrawOverlay=null,this.onDrawLinkTooltip=null,this.onNodeMoved=null,this.onSelectionChange=null,this.onConnectingChange=null,this.onBeforeChange=null,this.onAfterChange=null,this.connections_width=3,this.round_radius=8,this.current_node=null,this.node_widget=null,this.over_link_center=null,this.last_mouse_position=[0,0],this.visible_area=this.ds.visible_area,this.visible_links=[],this.viewport=n.viewport||null,this.low_quality_rendering_threshold=5,t==null||t.attachCanvas(this),this.setCanvas(o,n.skip_events),this.clear(),!this.skip_render&&!n.skip_render&&this.startRendering()}clear(){var o;this.frame=0,this.last_draw_time=0,this.render_time=0,this.fps=0,this.low_quality_rendering_counter=0,this.dragging_rectangle=null,this.selected_nodes={},this.selected_group=null,this.visible_nodes=[],this.node_dragged=null,this.node_over=null,this.node_capturing_input=null,this.connecting_node=null,this.highlighted_links={},this.dragging_canvas=!1,this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.dirty_area=null,this.node_in_panel=null,this.node_widget=null,this.last_mouse=[0,0],this.last_mouseclick=0,this.pointer_is_down=!1,this.pointer_is_double=!1,this.visible_area.set([0,0,0,0]),(o=this.onClear)==null||o.call(this)}setGraph(o,t){var n;if(this.graph!=o){if(t||this.clear(),!o){(n=this.graph)==null||n.detachCanvas(this);return}o.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)}}getTopGraph(){return this._graph_stack.length?this._graph_stack[0]:this.graph}openSubgraph(o){if(!o)throw new Error("graph cannot be null");if(this.graph==o)throw new Error("graph cannot be the same");this.clear(),this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph)),o.attachCanvas(this),this.checkPanels(),this.setDirty(!0,!0)}closeSubgraph(){if(!(!this._graph_stack||this._graph_stack.length==0)){var o=this.graph._subgraph_node,t=this._graph_stack.pop();this.selected_nodes={},this.highlighted_links={},t.attachCanvas(this),this.setDirty(!0,!0),o&&(this.centerOnNode(o),this.selectNodes([o])),this.ds.offset=[0,0],this.ds.scale=1}}getCurrentGraph(){return this.graph}setCanvas(o,t){var n;if(o&&o.constructor===String&&(o=document.getElementById(o),!o))throw new Error("Error creating LiteGraph canvas: Canvas not found");if(o!==this.canvas&&(!o&&this.canvas&&(t||this.unbindEvents()),this.canvas=o,this.ds.element=o,!!o)){if(o.className+=" lgraphcanvas",o.data=this,o.tabindex="1",this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,o.getContext==null)throw o.localName!="canvas"?new Error("Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+o.localName):new Error("This browser doesn't support Canvas");var a=this.ctx=o.getContext("2d");a==null&&(o.webgl_enabled||(n=LiteGraph.info)==null||n.call(LiteGraph,"This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL()),t||this.bindEvents()}}_doNothing(o){return o.preventDefault(),!1}_doReturnTrue(o){return o.preventDefault(),!0}bindEvents(){var o;if(this._events_binded){(o=LiteGraph.warn)==null||o.call(LiteGraph,"LGraphCanvas: events already binded");return}this._events_binded=!0;var t=this.canvas,n=this.getCanvasWindow(),a=n.document;this._mousedown_callback=this.processMouseDown.bind(this),this._mousemove_callback=this.processMouseMove.bind(this),this._mouseup_callback=this.processMouseUp.bind(this),t.addEventListener("pointerdown",this._mousedown_callback,!0),t.addEventListener("pointermove",this._mousemove_callback),t.addEventListener("pointerup",this._mouseup_callback,!0),t.addEventListener("contextmenu",this._doNothing),t.addEventListener("wheel",this.processMouseWheel),t.addEventListener("keydown",this.processKey),a.addEventListener("keyup",this.processKey),t.addEventListener("dragover",this._doNothing,!1),t.addEventListener("dragend",this._doNothing,!1),t.addEventListener("drop",this.processDrop),t.addEventListener("dragenter",this._doReturnTrue,!1)}unbindEvents(){var o;if(!this._events_binded){(o=LiteGraph.warn)==null||o.call(LiteGraph,"LGraphCanvas: no events binded");return}this._events_binded=!1;var t=this.canvas,n=this.getCanvasWindow(),a=n.document;t.removeEventListener("pointerdown",this._mousedown_callback),t.removeEventListener("pointermove",this._mousemove_callback),t.removeEventListener("pointerup",this._mouseup_callback),t.removeEventListener("contextmenu",this._doNothing),t.removeEventListener("wheel",this.processMouseWheel),t.removeEventListener("keydown",this.processKey),a.removeEventListener("keyup",this.processKey),t.removeEventListener("dragover",this._doNothing,!1),t.removeEventListener("dragend",this._doNothing,!1),t.removeEventListener("drop",this.processDrop),t.removeEventListener("dragenter",this._doReturnTrue),this._mousedown_callback=null}static getFileExtension(o){const t=new URL(o).pathname,n=t.lastIndexOf(".");return n===-1?"":t.slice(n+1).toLowerCase()}enableWebGL(){if(typeof GL=="undefined")throw new Error("litegl.js must be included to use a WebGL canvas");if(typeof enableWebGLCanvas=="undefined")throw new Error("webglCanvas.js must be included to use this feature");this.gl=this.ctx=enableWebGLCanvas(this.canvas),this.ctx.webgl=!0,this.bgcanvas=this.canvas,this.bgctx=this.gl,this.canvas.webgl_enabled=!0}setDirty(o,t){o&&(this.dirty_canvas=!0),t&&(this.dirty_bgcanvas=!0)}getCanvasWindow(){var o;if(!this.canvas)return window;var t=this.canvas.ownerDocument;return(o=t.defaultView)!=null?o:t.parentWindow}startRendering(){if(this.is_rendering)return;this.is_rendering=!0,o.call(this);function o(){this.pause_rendering||this.draw();var t=this.getCanvasWindow();this.is_rendering&&t.requestAnimationFrame(o.bind(this))}}stopRendering(){this.is_rendering=!1}blockClick(){this.block_click=!0,this.last_mouseclick=0}processUserInputDown(o){var t,n;if(this.pointer_is_down&&o.isPrimary!==void 0&&!o.isPrimary?this.userInput_isNotPrimary=!0:this.userInput_isNotPrimary=!1,this.userInput_type=o.pointerType?o.pointerType:!1,this.userInput_id=o.pointerId?o.pointerId:!1,o.pointerType)switch(o.pointerType){case"mouse":break;case"pen":break;case"touch":break;default:(t=LiteGraph.log)==null||t.call(LiteGraph,"pointerType unknown "+ev.pointerType)}return o.button!==void 0&&(this.userInput_button=o.button,o.button),o.buttons!==void 0&&(this.userInput_button_s=o.buttons),this.userInput_touches=o.changedTouches!==void 0&&o.changedTouches.length!==void 0?o.changedTouches:!1,this.userInput_touches&&this.userInput_touches.length&&((n=LiteGraph.debug)==null||n.call(LiteGraph,"check multiTouches",o.changedTouches)),this.processMouseDown(o)}processMouseDown(o){var t,n,a,r,l,p,h,c,u;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){this.adjustMouseEvent(o);var d=this.getCanvasWindow();__LGraphCanvas.active_canvas=this;var f=o.clientX,L=o.clientY;(t=LiteGraph.log)==null||t.call(LiteGraph,"pointerevents: processMouseDown pointerId:"+o.pointerId+" which:"+o.which+" isPrimary:"+o.isPrimary+" :: x y "+f+" "+L,"previousClick",this.last_mouseclick,"diffTimeClick",this.last_mouseclick?LiteGraph.getTime()-this.last_mouseclick:"notlast"),this.ds.viewport=this.viewport;var g=!this.viewport||this.viewport&&f>=this.viewport[0]&&f<this.viewport[0]+this.viewport[2]&&L>=this.viewport[1]&&L<this.viewport[1]+this.viewport[3];if(this.options.skip_events||(this.canvas.removeEventListener("pointermove",this._mousemove_callback),d.document.addEventListener("pointermove",this._mousemove_callback,!0),d.document.addEventListener("pointerup",this._mouseup_callback,!0)),!!g){var _=this.graph.getNodeOnPos(o.canvasX,o.canvasY,this.visible_nodes,5),m=!1,G=LiteGraph.getTime(),b=o.isPrimary===void 0||o.isPrimary,T=G-this.last_mouseclick<300&&b;if(this.mouse[0]=o.clientX,this.mouse[1]=o.clientY,this.graph_mouse[0]=o.canvasX,this.graph_mouse[1]=o.canvasY,this.last_click_position=[this.mouse[0],this.mouse[1]],this.pointer_is_down&&b?this.pointer_is_double=!0:this.pointer_is_double=!1,this.pointer_is_down=!0,this.canvas.focus(),LiteGraph.ContextMenu.closeAll(d),!((n=this.onMouse)!=null&&n.call(this,o))){if(o.which==1&&!this.userInput_isNotPrimary){if(o.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),this.dragging_rectangle[0]=o.canvasX,this.dragging_rectangle[1]=o.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,m=!0),LiteGraph.alt_drag_do_clone_nodes&&o.altKey&&_&&this.allow_interaction&&!m&&!this.read_only){let D=_,j=_.clone();if(j){if(j.pos[0]+=5,j.pos[1]+=5,this.graph.add(j,!1,{doCalcSize:!1}),_=j,LiteGraph.alt_shift_drag_connect_clone_with_input&&o.shiftKey&&D.inputs&&D.inputs.length)for(var E=0;E<D.inputs.length;++E){var k=D.inputs[E];if(!(!k||k.link==null)){var N=this.graph.links[k.link];if(N&&N.type!==LiteGraph.EVENT){var P;N.origin_id&&(P=this.graph.getNodeById(N.origin_id));var I=_;P&&I&&P.connect(N.origin_slot,I,N.target_slot)}}}m=!0,S||(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=_),this.selected_nodes[_.id]||this.processNodeSelected(_,o))}}var O=!1;if(_&&(this.allow_interaction||_.flags.allow_interaction)&&!m&&!this.read_only){if(!this.live_mode&&!_.flags.pinned&&this.bringToFront(_),this.allow_interaction&&!this.connecting_node&&!_.flags.collapsed&&!this.live_mode)if(!m&&_.resizable!==!1&&LiteGraph.isInsideRectangle(o.canvasX,o.canvasY,_.pos[0]+_.size[0]-5,_.pos[1]+_.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=_,this.canvas.style.cursor="se-resize",m=!0;else{if(_.outputs)for(let D=0,j=_.outputs.length;D<j;++D){let K=_.outputs[D],z=_.getConnectionPos(!1,D);if(LiteGraph.isInsideRectangle(o.canvasX,o.canvasY,z[0]-15,z[1]-10,30,20)){this.connecting_node=_,this.connecting_output=K,this.connecting_output.slot_index=D,this.connecting_pos=_.getConnectionPos(!1,D),this.connecting_slot=D,LiteGraph.shift_click_do_break_link_from&&o.shiftKey&&_.disconnectOutput(D),T?(a=_.onOutputDblClick)==null||a.call(_,D,o):(r=_.onOutputClick)==null||r.call(_,D,o),m=!0;break}}if(_.inputs)for(let D=0,j=_.inputs.length;D<j;++D){let K=_.inputs[D],z=_.getConnectionPos(!0,D);if(LiteGraph.isInsideRectangle(o.canvasX,o.canvasY,z[0]-15,z[1]-10,30,20)){if(T?(l=_.onInputDblClick)==null||l.call(_,D,o):(p=_.onInputClick)==null||p.call(_,D,o),K.link!==null){var A=this.graph.links[K.link];LiteGraph.click_do_break_link_to&&(_.disconnectInput(D),this.dirty_bgcanvas=!0,m=!0),o.shiftKey&&(LiteGraph.click_do_break_link_to||_.disconnectInput(D),this.connecting_node=this.graph._nodes_by_id[A.origin_id],this.connecting_slot=A.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot),this.dirty_bgcanvas=!0,m=!0)}m||(this.connecting_node=_,this.connecting_input=K,this.connecting_input.slot_index=D,this.connecting_pos=_.getConnectionPos(!0,D),this.connecting_slot=D,this.dirty_bgcanvas=!0,m=!0)}}}if(!m){var S=!1,C=[o.canvasX-_.pos[0],o.canvasY-_.pos[1]],R=this.processNodeWidgets(_,this.graph_mouse,o);R&&(S=!0,this.node_widget=[_,R]),this.allow_interaction&&T&&this.selected_nodes[_.id]&&((h=_.onDblClick)==null||h.call(_,o,C,this),this.processNodeDblClicked(_),S=!0),_.onMouseDown&&_.onMouseDown(o,C,this)?S=!0:(_.subgraph&&!_.skip_subgraph_button&&!_.flags.collapsed&&C[0]>_.size[0]-LiteGraph.NODE_TITLE_HEIGHT&&C[1]<0&&setTimeout(()=>{this.openSubgraph(_.subgraph)},10),this.live_mode&&(O=!0,S=!0)),S?_.is_selected||this.processNodeSelected(_,o):(this.allow_dragnodes&&(this.graph.beforeChange(),this.node_dragged=_),this.processNodeSelected(_,o)),this.dirty_canvas=!0}}else if(!m){if(!this.read_only)for(let D=0;D<this.visible_links.length;++D){var X=this.visible_links[D],q=X._pos;if(!(!q||o.canvasX<q[0]-4||o.canvasX>q[0]+4||o.canvasY<q[1]-4||o.canvasY>q[1]+4)){this.showLinkMenu(X,o),this.over_link_center=null;break}}if(this.selected_group=this.graph.getGroupOnPos(o.canvasX,o.canvasY),this.selected_group_resizing=!1,this.selected_group&&!this.read_only){o.ctrlKey&&(this.dragging_rectangle=null);var $=LiteGraph.distance([o.canvasX,o.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]]);$*this.ds.scale<10?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes()}T&&!this.read_only&&this.allow_searchbox&&(this.showSearchBox(o),o.preventDefault(),o.stopPropagation()),(c=LiteGraph.debug)==null||c.call(LiteGraph,"DEBUG canvas click is_double_click,this.allow_searchbox",T,this.allow_searchbox),O=!0}!m&&O&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else if(o.which==2)if(LiteGraph.middle_click_slot_add_default_node){if(_&&this.allow_interaction&&!m&&!this.read_only&&!this.connecting_node&&!_.flags.collapsed&&!this.live_mode){var Q=!1,F=!1,H=!1;if(_.outputs)for(let D=0,j=_.outputs.length;D<j;++D){var U=_.outputs[D];let K=_.getConnectionPos(!1,D);if(LiteGraph.isInsideRectangle(o.canvasX,o.canvasY,K[0]-15,K[1]-10,30,20)){Q=U,F=D,H=!0;break}}if(_.inputs)for(let D=0,j=_.inputs.length;D<j;++D){var k=_.inputs[D];let z=_.getConnectionPos(!0,D);if(LiteGraph.isInsideRectangle(o.canvasX,o.canvasY,z[0]-15,z[1]-10,30,20)){Q=k,F=D,H=!1;break}}if(Q&&F!==!1){var B=.5-(F+1)/(H?_.outputs.length:_.inputs.length),Y=_.getBounding(),de=[H?Y[0]+Y[2]:Y[0],o.canvasY-80];this.createDefaultNodeForSlot({nodeFrom:H?_:null,slotFrom:H?F:null,nodeTo:H?null:_,slotTo:H?null:F,position:de,nodeType:"AUTO",posAdd:[H?30:-30,-B*130],posSizeFix:[H?0:-1,0]})}}}else!m&&this.allow_dragcanvas&&(this.dragging_canvas=!0);else(o.which==3||LiteGraph.two_fingers_opens_menu&&this.userInput_isNotPrimary)&&this.allow_interaction&&!m&&!this.read_only&&(_&&(Object.keys(this.selected_nodes).length&&(this.selected_nodes[_.id]||o.shiftKey||o.ctrlKey||o.metaKey)?this.selected_nodes[_.id]||this.selectNodes([_],!0):this.selectNodes([_])),this.processContextMenu(_,o));return this.last_mouse[0]=o.clientX,this.last_mouse[1]=o.clientY,this.last_mouseclick=LiteGraph.getTime(),this.last_mouse_dragging=!0,this.graph.change(),(!d.document.activeElement||d.document.activeElement.nodeName.toLowerCase()!="input"&&d.document.activeElement.nodeName.toLowerCase()!="textarea")&&o.preventDefault(),o.stopPropagation(),(u=this.onMouseDown)==null||u.call(this,o),!1}}}}processMouseMove(o){var t,n;if(this.autoresize&&this.resize(),this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){__LGraphCanvas.active_canvas=this,this.adjustMouseEvent(o);var a=[o.clientX,o.clientY];this.mouse[0]=a[0],this.mouse[1]=a[1];var r=[a[0]-this.last_mouse[0],a[1]-this.last_mouse[1]];if(this.last_mouse=a,this.graph_mouse[0]=o.canvasX,this.graph_mouse[1]=o.canvasY,this.block_click)return o.preventDefault(),!1;o.dragging=this.last_mouse_dragging,this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,o,this.node_widget[1]),this.dirty_canvas=!0);var l=this.graph.getNodeOnPos(o.canvasX,o.canvasY,this.visible_nodes);if(this.dragging_rectangle)this.dragging_rectangle[2]=o.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=o.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only){if(this.selected_group_resizing)this.selected_group.size=[o.canvasX-this.selected_group.pos[0],o.canvasY-this.selected_group.pos[1]];else{var p=r[0]/this.ds.scale,h=r[1]/this.ds.scale;this.selected_group.move(p,h,o.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)}this.dirty_bgcanvas=!0}else if(this.dragging_canvas)this.ds.offset[0]+=r[0]/this.ds.scale,this.ds.offset[1]+=r[1]/this.ds.scale,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;else if((this.allow_interaction||l&&l.flags.allow_interaction)&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);for(let g=0,_=this.graph._nodes.length;g<_;++g)this.graph._nodes[g].mouseOver&&l!=this.graph._nodes[g]&&(this.graph._nodes[g].mouseOver=!1,this.node_over&&this.node_over.onMouseLeave&&this.node_over.onMouseLeave(o),this.node_over=null,this.dirty_canvas=!0);if(l){if(l.redraw_on_mouse&&(this.dirty_canvas=!0),l.mouseOver||(l.mouseOver=!0,this.node_over=l,this.dirty_canvas=!0,(t=l.onMouseEnter)==null||t.call(l,o)),(n=l.onMouseMove)==null||n.call(l,o,[o.canvasX-l.pos[0],o.canvasY-l.pos[1]],this),this.connecting_node){let g;if(this.connecting_output){if(g=this._highlight_input||[0,0],!this.isOverNodeBox(l,o.canvasX,o.canvasY)){let _=this.isOverNodeInput(l,o.canvasX,o.canvasY,g);if(_!=-1&&l.inputs[_]){let m=l.inputs[_].type;LiteGraph.isValidConnection(this.connecting_output.type,m)&&(this._highlight_input=g,this._highlight_input_slot=l.inputs[_])}else this._highlight_input=null,this._highlight_input_slot=null}}else if(this.connecting_input&&(g=this._highlight_output||[0,0],this.isOverNodeBox(l,o.canvasX,o.canvasY))){let _=this.isOverNodeOutput(l,o.canvasX,o.canvasY,g);if(_!=-1&&l.outputs[_]){let m=l.outputs[_].type;LiteGraph.isValidConnection(this.connecting_input.type,m)&&(this._highlight_output=g)}else this._highlight_output=null}}this.canvas&&(LiteGraph.isInsideRectangle(o.canvasX,o.canvasY,l.pos[0]+l.size[0]-5,l.pos[1]+l.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{var c=null;for(let g=0;g<this.visible_links.length;++g){var u=this.visible_links[g],d=u._pos;if(!(!d||o.canvasX<d[0]-4||o.canvasX>d[0]+4||o.canvasY<d[1]-4||o.canvasY>d[1]+4)){c=u;break}}c!=this.over_link_center&&(this.over_link_center=c,this.dirty_canvas=!0),this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=l&&this.node_capturing_input.onMouseMove&&this.node_capturing_input.onMouseMove(o,[o.canvasX-this.node_capturing_input.pos[0],o.canvasY-this.node_capturing_input.pos[1]],this),this.node_dragged&&!this.live_mode){for(let g in this.selected_nodes){let _=this.selected_nodes[g];_.pos[0]+=r[0]/this.ds.scale,_.pos[1]+=r[1]/this.ds.scale,_.is_selected||this.processNodeSelected(_,o)}this.dirty_canvas=!0,this.dirty_bgcanvas=!0}if(this.resizing_node&&!this.live_mode){var f=[o.canvasX-this.resizing_node.pos[0],o.canvasY-this.resizing_node.pos[1]],L=this.resizing_node.computeSize();f[0]=Math.max(L[0],f[0]),f[1]=Math.max(L[1],f[1]),this.resizing_node.setSize(f),this.canvas.style.cursor="se-resize",this.dirty_canvas=!0,this.dirty_bgcanvas=!0}}return o.preventDefault(),!1}}processMouseUp(o){var t,n=o.isPrimary===void 0||o.isPrimary;if(!n)return!1;if(this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0),!!this.graph){var a=this.getCanvasWindow(),r=a.document;__LGraphCanvas.active_canvas=this,this.options.skip_events||(r.removeEventListener("pointermove",this._mousemove_callback,!0),this.canvas.addEventListener("pointermove",this._mousemove_callback,!0),r.removeEventListener("pointerup",this._mouseup_callback,!0)),this.adjustMouseEvent(o);var l=LiteGraph.getTime();if(o.click_time=l-this.last_mouseclick,this.last_mouse_dragging=!1,this.last_click_position=null,this.block_click&&(this.block_click=!1),o.which==1){if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,o),this.node_widget=null,this.selected_group){var p=this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),h=this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]);this.selected_group.move(p,h,o.ctrlKey),this.selected_group.pos[0]=Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null}this.selected_group_resizing=!1;var c=this.graph.getNodeOnPos(o.canvasX,o.canvasY,this.visible_nodes);if(this.dragging_rectangle){if(this.graph){var u=this.graph._nodes,d=new Float32Array(4),f=Math.abs(this.dragging_rectangle[2]),L=Math.abs(this.dragging_rectangle[3]),g=this.dragging_rectangle[2]<0?this.dragging_rectangle[0]-f:this.dragging_rectangle[0],_=this.dragging_rectangle[3]<0?this.dragging_rectangle[1]-L:this.dragging_rectangle[1];if(this.dragging_rectangle[0]=g,this.dragging_rectangle[1]=_,this.dragging_rectangle[2]=f,this.dragging_rectangle[3]=L,!c||f>10&&L>10){var m=[];for(let E=0;E<u.length;++E){var G=u[E];G.getBounding(d),LiteGraph.overlapBounding(this.dragging_rectangle,d)&&m.push(G)}m.length&&this.selectNodes(m,o.shiftKey)}else this.selectNodes([c],o.shiftKey||o.ctrlKey)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_canvas=!0,this.dirty_bgcanvas=!0;var b=this.connecting_output||this.connecting_input,T=b.type;if(c=this.graph.getNodeOnPos(o.canvasX,o.canvasY,this.visible_nodes),c){let E;this.connecting_output?(E=this.isOverNodeInput(c,o.canvasX,o.canvasY),E!=-1?this.connecting_node.connect(this.connecting_slot,c,E):this.connecting_node.connectByType(this.connecting_slot,c,T)):this.connecting_input&&(E=this.isOverNodeOutput(c,o.canvasX,o.canvasY),E!=-1?c.connect(E,this.connecting_node,this.connecting_slot):this.connecting_node.connectByTypeOutput(this.connecting_slot,c,T))}else LiteGraph.release_link_on_empty_shows_menu&&(o.shiftKey&&this.allow_searchbox?this.connecting_output?this.showSearchBox(o,{node_from:this.connecting_node,slot_from:this.connecting_output,type_filter_in:this.connecting_output.type}):this.connecting_input&&this.showSearchBox(o,{node_to:this.connecting_node,slot_from:this.connecting_input,type_filter_out:this.connecting_input.type}):this.connecting_output?this.showConnectionMenu({nodeFrom:this.connecting_node,slotFrom:this.connecting_output,e:o}):this.connecting_input&&this.showConnectionMenu({nodeTo:this.connecting_node,slotTo:this.connecting_input,e:o}));this.connecting_output=null,this.connecting_input=null,this.connecting_pos=null,this.connecting_node=null,this.connecting_slot=-1}else this.resizing_node?(this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null):this.node_dragged?(c=this.node_dragged,c&&o.click_time<300&&LiteGraph.isInsideRectangle(o.canvasX,o.canvasY,c.pos[0],c.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT)&&c.collapse(),this.dirty_canvas=!0,this.dirty_bgcanvas=!0,this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]),this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]),(this.graph.config.align_to_grid||this.align_to_grid)&&this.node_dragged.alignToGrid(),(t=this.onNodeMoved)==null||t.call(this,this.node_dragged),this.graph.onGraphChanged({action:"nodeDrag",doSave:!0}),this.graph.afterChange(this.node_dragged),this.node_dragged=null):(c=this.graph.getNodeOnPos(o.canvasX,o.canvasY,this.visible_nodes),!c&&o.click_time<300&&this.deselectAllNodes(),this.dirty_canvas=!0,this.dragging_canvas=!1,this.node_over&&this.node_over.onMouseUp&&this.node_over.onMouseUp(o,[o.canvasX-this.node_over.pos[0],o.canvasY-this.node_over.pos[1]],this),this.node_capturing_input&&this.node_capturing_input.onMouseUp&&this.node_capturing_input.onMouseUp(o,[o.canvasX-this.node_capturing_input.pos[0],o.canvasY-this.node_capturing_input.pos[1]]))}else o.which==2?(this.dirty_canvas=!0,this.dragging_canvas=!1):o.which==3&&(this.dirty_canvas=!0,this.dragging_canvas=!1);return n&&(this.pointer_is_down=!1,this.pointer_is_double=!1),this.graph.change(),o.stopPropagation(),o.preventDefault(),!1}}isOverNodeBox(o,t,n){var a=LiteGraph.NODE_TITLE_HEIGHT;return!!LiteGraph.isInsideRectangle(t,n,o.pos[0]+2,o.pos[1]+2-a,a-4,a-4)}isOverNodeInput(o,t,n,a){if(o.inputs)for(let p=0,h=o.inputs.length;p<h;++p){var r=o.getConnectionPos(!0,p),l=!1;if(o.horizontal?l=LiteGraph.isInsideRectangle(t,n,r[0]-5,r[1]-10,10,20):l=LiteGraph.isInsideRectangle(t,n,r[0]-10,r[1]-5,40,10),l)return a&&(a[0]=r[0],a[1]=r[1]),p}return-1}isOverNodeOutput(o,t,n,a){if(o.outputs)for(let p=0,h=o.outputs.length;p<h;++p){var r=o.getConnectionPos(!1,p),l=!1;if(o.horizontal?l=LiteGraph.isInsideRectangle(t,n,r[0]-5,r[1]-10,10,20):l=LiteGraph.isInsideRectangle(t,n,r[0]-10,r[1]-5,40,10),l)return a&&(a[0]=r[0],a[1]=r[1]),p}return-1}copyToClipboard(){var o,t={nodes:[],links:[]},n=0,a=[];for(let u in this.selected_nodes){let d=this.selected_nodes[u];d.clonable!==!1&&(d._relative_id=n,a.push(d),n+=1)}for(let u=0;u<a.length;++u){let d=a[u];if(d.clonable!==!1){var r=d.clone();if(!r){(o=LiteGraph.warn)==null||o.call(LiteGraph,"node type not found: "+d.type);continue}if(t.nodes.push(r.serialize()),d.inputs&&d.inputs.length)for(var l=0;l<d.inputs.length;++l){var p=d.inputs[l];if(!(!p||p.link==null)){var h=this.graph.links[p.link];if(h){var c=this.graph.getNodeById(h.origin_id);c&&t.links.push([c._relative_id,h.origin_slot,d._relative_id,h.target_slot,c.id])}}}}}localStorage.setItem("litegrapheditor_clipboard",JSON.stringify(t))}pasteFromClipboard(o=!1){var t;if(!(!LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&o)){var n=localStorage.getItem("litegrapheditor_clipboard");if(n){this.graph.beforeChange();var a=JSON.parse(n),r=!1,l=!1;for(let _=0;_<a.nodes.length;++_)r?(r[0]>a.nodes[_].pos[0]&&(r[0]=a.nodes[_].pos[0],l[0]=_),r[1]>a.nodes[_].pos[1]&&(r[1]=a.nodes[_].pos[1],l[1]=_)):(r=[a.nodes[_].pos[0],a.nodes[_].pos[1]],l=[_,_]);var p=[];for(let _=0;_<a.nodes.length;++_){var h=a.nodes[_],c=LiteGraph.createNode(h.type);c&&(c.configure(h),c.pos[0]+=this.graph_mouse[0]-r[0],c.pos[1]+=this.graph_mouse[1]-r[1],this.graph.add(c,{doProcessChange:!1}),p.push(c))}for(let _=0;_<a.links.length;++_){var u=a.links[_],d=void 0,f=u[0];if(f!=null)d=p[f];else if(LiteGraph.ctrl_shift_v_paste_connect_unselected_outputs&&o){var L=u[4];L&&(d=this.graph.getNodeById(L))}var g=p[u[2]];d&&g?d.connect(u[1],g,u[3]):(t=LiteGraph.warn)==null||t.call(LiteGraph,"Warning, nodes missing on pasting")}this.selectNodes(p),this.graph.onGraphChanged({action:"paste",doSave:!0}),this.graph.afterChange()}}}checkDropItem(o){var t;if(o.dataTransfer.files.length){var n=o.dataTransfer.files[0],a=__LGraphCanvas.getFileExtension(n.name).toLowerCase(),r=LiteGraph.node_types_by_file_extension[a];if(r){this.graph.beforeChange();var l=LiteGraph.createNode(r.type);l.pos=[o.canvasX,o.canvasY],this.graph.add(l,!1,{doProcessChange:!1}),(t=l.onDropFile)==null||t.call(l,n),this.graph.onGraphChanged({action:"fileDrop",doSave:!0}),this.graph.afterChange()}}}processNodeDblClicked(o){var t;this.onShowNodePanel?this.onShowNodePanel(o):this.showShowNodePanel(o),(t=this.onNodeDblClicked)==null||t.call(this,o),this.setDirty(!0)}processNodeSelected(o,t){var n;this.selectNode(o,t&&(t.shiftKey||t.ctrlKey||this.multi_select)),(n=this.onNodeSelected)==null||n.call(this,o)}selectNode(o,t){o==null?this.deselectAllNodes():this.selectNodes([o],t)}selectNodes(o,t){var n;t||this.deselectAllNodes(),o=o||this.graph._nodes,typeof o=="string"&&(o=[o]),Object.values(o).forEach(a=>{var r,l,p;if(a.is_selected){this.deselectNode(a);return}a.is_selected=!0,this.selected_nodes[a.id]=a,(r=a.onSelected)==null||r.call(a),(l=a.inputs)==null||l.forEach(h=>{this.highlighted_links[h.link]=!0}),(p=a.outputs)==null||p.forEach(h=>{var c;(c=h.links)==null||c.forEach(u=>{this.highlighted_links[u]=!0})})}),(n=this.onSelectionChange)==null||n.call(this,this.selected_nodes),this.setDirty(!0)}deselectNode(o){var t,n,a,r;o.is_selected&&((t=o.onDeselected)==null||t.call(o),o.is_selected=!1,(n=this.onNodeDeselected)==null||n.call(this,o),(a=o.inputs)==null||a.forEach(l=>{var p;(p=this.highlighted_links)==null||delete p[l.link]}),(r=o.outputs)==null||r.forEach(l=>{var p;(p=l.links)==null||p.forEach(h=>{var c;return(c=this.highlighted_links)==null?!0:delete c[h]})}))}deselectAllNodes(){var o,t;this.graph&&((o=this.graph._nodes)==null||o.forEach(n=>{var a,r;n.is_selected&&((a=n.onDeselected)==null||a.call(n),n.is_selected=!1,(r=this.onNodeDeselected)==null||r.call(this,n))}),this.selected_nodes={},this.current_node=null,this.highlighted_links={},(t=this.onSelectionChange)==null||t.call(this,this.selected_nodes),this.setDirty(!0))}deleteSelectedNodes(){this.graph.beforeChange();for(let l in this.selected_nodes){var o=this.selected_nodes[l];if(!o.block_delete){if(o.inputs&&o.inputs.length&&o.outputs&&o.outputs.length&&LiteGraph.isValidConnection(o.inputs[0].type,o.outputs[0].type)&&o.inputs[0].link&&o.outputs[0].links&&o.outputs[0].links.length){var t=o.graph.links[o.inputs[0].link],n=o.graph.links[o.outputs[0].links[0]],a=o.getInputNode(0),r=o.getOutputNodes(0)[0];a&&r&&a.connect(t.origin_slot,r,n.target_slot)}this.graph.remove(o),this.onNodeDeselected&&this.onNodeDeselected(o)}}this.selected_nodes={},this.current_node=null,this.highlighted_links={},this.setDirty(!0),this.graph.afterChange()}centerOnNode(o){this.ds.offset[0]=-o.pos[0]-o.size[0]*.5+this.canvas.width*.5/this.ds.scale,this.ds.offset[1]=-o.pos[1]-o.size[1]*.5+this.canvas.height*.5/this.ds.scale,this.setDirty(!0,!0)}adjustMouseEvent(o){var t=0,n=0;if(this.canvas){var a=this.canvas.getBoundingClientRect();t=o.clientX-a.left,n=o.clientY-a.top}else t=o.clientX,n=o.clientY;this.last_mouse_position[0]=t,this.last_mouse_position[1]=n,o.canvasX=t/this.ds.scale-this.ds.offset[0],o.canvasY=n/this.ds.scale-this.ds.offset[1]}setZoom(o,t){this.ds.changeScale(o,t),this.dirty_canvas=!0,this.dirty_bgcanvas=!0}convertOffsetToCanvas(o,t){return this.ds.convertOffsetToCanvas(o,t)}convertCanvasToOffset(o,t){return this.ds.convertCanvasToOffset(o,t)}convertEventToCanvasOffset(o){var t=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([o.clientX-t.left,o.clientY-t.top])}bringToFront(o){var t=this.graph._nodes.indexOf(o);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.push(o))}sendToBack(o){var t=this.graph._nodes.indexOf(o);t!=-1&&(this.graph._nodes.splice(t,1),this.graph._nodes.unshift(o))}computeVisibleNodes(o,t){var n=t||[];n.length=0,o=o||this.graph._nodes;for(var a=0,r=o.length;a<r;++a){var l=o[a];this.live_mode&&!l.onDrawBackground&&!l.onDrawForeground||LiteGraph.overlapBounding(this.visible_area,l.getBounding(temp,!0))&&n.push(l)}return n}draw(o,t){if(!(!this.canvas||this.canvas.width==0||this.canvas.height==0)){var n=LiteGraph.getTime();this.render_time=(n-this.last_draw_time)*.001,this.last_draw_time=n,this.graph&&this.ds.computeVisibleArea(this.viewport),(this.dirty_bgcanvas||t||this.always_render_background||this.graph&&this.graph._last_trigger_time&&n-this.graph._last_trigger_time<1e3)&&this.drawBackCanvas();var a=this.dirty_canvas||o;if(a&&this.drawFrontCanvas(),this.fps=this.render_time?1/this.render_time:0,this.frame+=1,this.ds.scale<.7){if(a){var r=this.low_quality_rendering_threshold;const l=45;this.fps<l?(this.low_quality_rendering_counter+=l/this.fps,this.low_quality_rendering_counter=Math.min(this.low_quality_rendering_counter,2*r)):(this.low_quality_rendering_counter-=this.fps/l*.01,this.low_quality_rendering_counter=Math.max(this.low_quality_rendering_counter,0))}}else this.low_quality_rendering_counter=0}}drawFrontCanvas(){var o,t,n,a,r;this.dirty_canvas=!1,this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var l=this.ctx;if(l){var p=this.canvas;l.start2D&&!this.viewport&&(l.start2D(),l.restore(),l.setTransform(1,0,0,1,0,0));var h=this.viewport||this.dirty_area;if(h&&(l.save(),l.beginPath(),l.rect(h[0],h[1],h[2],h[3]),l.clip()),this.clear_background&&(h?l.clearRect(h[0],h[1],h[2],h[3]):l.clearRect(0,0,p.width,p.height)),this.bgcanvas==this.canvas?this.drawBackCanvas():l.drawImage(this.bgcanvas,0,0),(o=this.onRender)==null||o.call(this,p,l),this.show_info&&this.renderInfo(l,h?h[0]:0,h?h[1]:0),this.graph){l.save(),this.ds.toCanvasContext(l);var c=this.computeVisibleNodes(null,this.visible_nodes);for(let m=0;m<c.length;++m){let G=c[m];l.save(),l.translate(G.pos[0],G.pos[1]),this.drawNode(G,l),l.restore()}if(this.render_execution_order&&this.drawExecutionOrder(l),this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(l)),this.connecting_pos!=null){l.lineWidth=this.connections_width;var u=null,d=this.connecting_output||this.connecting_input,f=d.type,L=d.dir;L==null&&(this.connecting_output?L=this.connecting_node.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT:L=this.connecting_node.horizontal?LiteGraph.UP:LiteGraph.LEFT);var g=d.shape;switch(f){case LiteGraph.EVENT:case LiteGraph.ACTION:u=LiteGraph.EVENT_LINK_COLOR;break;default:u=LiteGraph.CONNECTING_LINK_COLOR}if(this.renderLink(l,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,u,L,LiteGraph.CENTER),l.beginPath(),f===LiteGraph.EVENT||f===LiteGraph.ACTION||g===LiteGraph.BOX_SHAPE?(l.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10),l.fill(),l.beginPath(),l.rect(this.graph_mouse[0]-6+.5,this.graph_mouse[1]-5+.5,14,10)):g===LiteGraph.ARROW_SHAPE?(l.moveTo(this.connecting_pos[0]+8,this.connecting_pos[1]+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]+6+.5),l.lineTo(this.connecting_pos[0]-4,this.connecting_pos[1]-6+.5),l.closePath()):(l.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,Math.PI*2),l.fill(),l.beginPath(),l.arc(this.graph_mouse[0],this.graph_mouse[1],4,0,Math.PI*2)),l.fill(),l.fillStyle="#ffcc00",this._highlight_input){l.beginPath();var _=this._highlight_input_slot.shape;_===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_input[0]+8,this._highlight_input[1]+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]+6+.5),l.lineTo(this._highlight_input[0]-4,this._highlight_input[1]-6+.5),l.closePath()):l.arc(this._highlight_input[0],this._highlight_input[1],6,0,Math.PI*2),l.fill()}this._highlight_output&&(l.beginPath(),_===LiteGraph.ARROW_SHAPE?(l.moveTo(this._highlight_output[0]+8,this._highlight_output[1]+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]+6+.5),l.lineTo(this._highlight_output[0]-4,this._highlight_output[1]-6+.5),l.closePath()):l.arc(this._highlight_output[0],this._highlight_output[1],6,0,Math.PI*2),l.fill())}this.dragging_rectangle&&(l.strokeStyle="#FFF",l.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3])),this.over_link_center&&this.render_link_tooltip?this.drawLinkTooltip(l,this.over_link_center):(t=this.onDrawLinkTooltip)==null||t.call(this,l,null),(n=this.onDrawForeground)==null||n.call(this,l,this.visible_rect),l.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(l),(a=this.onDrawOverlay)==null||a.call(this,l),h&&l.restore(),(r=l.finish2D)==null||r.call(l)}}drawSubgraphPanel(o){var t,n=this.graph;if(n){var a=n._subgraph_node;if(!a){(t=LiteGraph.warn)==null||t.call(LiteGraph,"subgraph without subnode");return}this.drawSubgraphPanelLeft(n,a,o),this.drawSubgraphPanelRight(n,a,o)}}drawSubgraphPanelLeft(o,t,n){var a,r=t.inputs?t.inputs.length:0,l=200,p=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);if(n.fillStyle="#111",n.globalAlpha=.8,n.beginPath(),n.roundRect(10,10,l,(r+1)*p+50,[8]),n.fill(),n.globalAlpha=1,n.fillStyle="#888",n.font="14px Arial",n.textAlign="left",n.fillText("Graph Inputs",20,34),this.drawButton(l-20,20,20,20,"X","#151515")){this.closeSubgraph();return}var h=50;if(n.font="14px Arial",t.inputs)for(var c=0;c<t.inputs.length;++c){var u=t.inputs[c];if(!u.not_subgraph_input){if(this.drawButton(20,h+2,l-20,p-2)){var d=t.constructor.input_node_type||"graph/input";this.graph.beforeChange();var f=LiteGraph.createNode(d);f?(o.add(f,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([f]),this.node_dragged=f,this.dragging_canvas=!1,f.setProperty("name",u.name),f.setProperty("type",u.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(a=LiteGraph.error)==null||a.call(LiteGraph,"graph input node not found:",d)}n.fillStyle="#9C9",n.beginPath(),n.arc(l-16,h+p*.5,5,0,2*Math.PI),n.fill(),n.fillStyle="#AAA",n.fillText(u.name,30,h+p*.75),n.fillStyle="#777",n.fillText(u.type,130,h+p*.75),h+=p}}this.drawButton(20,h+2,l-20,p-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(t)}drawSubgraphPanelRight(o,t,n){var a,r=t.outputs?t.outputs.length:0,l=this.bgcanvas.width,p=200,h=Math.floor(LiteGraph.NODE_SLOT_HEIGHT*1.6);n.fillStyle="#111",n.globalAlpha=.8,n.beginPath(),n.roundRect(l-p-10,10,p,(r+1)*h+50,[8]),n.fill(),n.globalAlpha=1,n.fillStyle="#888",n.font="14px Arial",n.textAlign="left";const c="Graph Outputs";var u=n.measureText(c).width;if(n.fillText(c,l-u-20,34),this.drawButton(l-p,20,20,20,"X","#151515")){this.closeSubgraph();return}var d=50;if(n.font="14px Arial",t.outputs)for(var f=0;f<t.outputs.length;++f){var L=t.outputs[f];if(!L.not_subgraph_input){if(this.drawButton(l-p,d+2,p-20,h-2)){var g=t.constructor.output_node_type||"graph/output";this.graph.beforeChange();var _=LiteGraph.createNode(g);_?(o.add(_,!1,{doProcessChange:!1}),this.block_click=!1,this.last_click_position=null,this.selectNodes([_]),this.node_dragged=_,this.dragging_canvas=!1,_.setProperty("name",L.name),_.setProperty("type",L.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):(a=LiteGraph.error)==null||a.call(LiteGraph,"graph input node not found:",g)}n.fillStyle="#9C9",n.beginPath(),n.arc(l-p+16,d+h*.5,5,0,2*Math.PI),n.fill(),n.fillStyle="#AAA",n.fillText(L.name,l-p+30,d+h*.75),n.fillStyle="#777",n.fillText(L.type,l-p+130,d+h*.75),d+=h}}this.drawButton(l-p,d+2,p-20,h-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialogRight(t)}drawButton(o,t,n,a,r,l,p,h){var c=this.ctx;l=l||LiteGraph.NODE_DEFAULT_COLOR,p=p||"#555",h=h||LiteGraph.NODE_TEXT_COLOR;var u=this.ds.convertOffsetToCanvas(this.graph_mouse),d=LiteGraph.isInsideRectangle(u[0],u[1],o,t,n,a);if(u=this.last_click_position?[this.last_click_position[0],this.last_click_position[1]]:null,u){var f=this.canvas.getBoundingClientRect();u[0]-=f.left,u[1]-=f.top}var L=u&&LiteGraph.isInsideRectangle(u[0],u[1],o,t,n,a);c.fillStyle=d?p:l,L&&(c.fillStyle="#AAA"),c.beginPath(),c.roundRect(o,t,n,a,[4]),c.fill(),r!=null&&r.constructor==String&&(c.fillStyle=h,c.textAlign="center",c.font=(a*.65|0)+"px Arial",c.fillText(r,o+n*.5,t+a*.75),c.textAlign="left");var g=L&&!this.block_click;return L&&this.blockClick(),g}isAreaClicked(o,t,n,a,r){var l=this.last_click_position,p=l&&LiteGraph.isInsideRectangle(l[0],l[1],o,t,n,a),h=p&&!this.block_click;return p&&r&&this.blockClick(),h}renderInfo(o,t,n){t=t||10,n=n||this.canvas.height-80,o.save(),o.translate(t,n),o.font="10px Arial",o.fillStyle="#888",o.textAlign="left",this.graph?(o.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),o.fillText("I: "+this.graph.iteration,5,26),o.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),o.fillText("V: "+this.graph._version,5,52),o.fillText("FPS:"+this.fps.toFixed(2),5,65)):o.fillText("No graph selected",5,13),o.restore()}drawBackCanvas(){var o,t,n,a=this.bgcanvas;this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var r=this.bgctx;r.start&&r.start();var l=this.viewport||[0,0,r.canvas.width,r.canvas.height];if(this.clear_background&&r.clearRect(l[0],l[1],l[2],l[3]),this._graph_stack&&this._graph_stack.length){r.save();var p=this.graph._subgraph_node;r.strokeStyle=p.bgcolor,r.lineWidth=10,r.strokeRect(1,1,a.width-2,a.height-2),r.lineWidth=1,r.font="40px Arial",r.textAlign="center",r.fillStyle=p.bgcolor||"#AAA";let d="";this._graph_stack.slice(1).forEach((f,L)=>{d+=`${f._subgraph_node.getTitle()} ${L<this._graph_stack.length-2?">> ":""}`}),r.fillText(d+p.getTitle(),a.width*.5,40),r.restore()}var h=!1;if(this.onRenderBackground&&(h=this.onRenderBackground(a,r)),this.viewport||(r.restore(),r.setTransform(1,0,0,1,0,0)),this.visible_links.length=0,this.graph){if(r.save(),this.ds.toCanvasContext(r),this.ds.scale<1.5&&!h&&this.clear_background_color&&(r.fillStyle=this.clear_background_color,r.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3])),this.background_image&&this.ds.scale>.5&&!h){if(this.zoom_modify_alpha?r.globalAlpha=(1-.5/this.ds.scale)*this.editor_alpha:r.globalAlpha=this.editor_alpha,r.imageSmoothingEnabled=r.imageSmoothingEnabled=!1,!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image,this._bg_img.name=this.background_image,this._bg_img.src=this.background_image;var c=this;this._bg_img.onload=function(){c.draw(!0,!0)}}var u=null;this._pattern==null&&this._bg_img.width>0?(u=r.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=u):u=this._pattern,u&&(r.fillStyle=u,r.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),r.fillStyle="transparent"),r.globalAlpha=1,r.imageSmoothingEnabled=r.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(a,r),(o=this.onDrawBackground)==null||o.call(this,r,this.visible_area),this.onBackgroundRender&&((t=LiteGraph.error)==null||t.call(LiteGraph,"WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null),this.render_canvas_border&&(r.strokeStyle="#235",r.strokeRect(0,0,a.width,a.height)),this.render_connections_shadows?(r.shadowColor="#000",r.shadowOffsetX=0,r.shadowOffsetY=0,r.shadowBlur=6):r.shadowColor="rgba(0,0,0,0)",this.live_mode||this.drawConnections(r),r.shadowColor="rgba(0,0,0,0)",r.restore()}(n=r.finish)==null||n.call(r),this.dirty_bgcanvas=!1,this.dirty_canvas=!0}drawNode(o,t){var n,a,r;this.current_node=o;var l=o.color||o.constructor.color||LiteGraph.NODE_DEFAULT_COLOR,p=o.bgcolor||o.constructor.bgcolor||LiteGraph.NODE_DEFAULT_BGCOLOR,h=this.ds.scale<.6;if(this.live_mode){o.flags.collapsed||(t.shadowColor="transparent",(n=o.onDrawForeground)==null||n.call(o,t,this,this.canvas));return}var c=this.editor_alpha;if(t.globalAlpha=c,this.render_shadows&&!h?(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR,t.shadowOffsetX=2*this.ds.scale,t.shadowOffsetY=2*this.ds.scale,t.shadowBlur=3*this.ds.scale):t.shadowColor="transparent",!(o.flags.collapsed&&(a=o.onDrawCollapsed)!=null&&a.call(o,t,this))){var u=o._shape||LiteGraph.BOX_SHAPE,d=temp_vec2;temp_vec2.set(o.size);var f=o.horizontal;if(o.flags.collapsed){t.font=this.inner_text_font;var L=o.getTitle?o.getTitle():o.title;L!=null&&(o._collapsed_width=Math.min(o.size[0],t.measureText(L).width+LiteGraph.NODE_TITLE_HEIGHT*2),d[0]=o._collapsed_width,d[1]=0)}(o.clip_area||this.clip_all_nodes)&&(t.save(),t.beginPath(),u==LiteGraph.BOX_SHAPE?t.rect(0,0,d[0],d[1]):u==LiteGraph.ROUND_SHAPE?t.roundRect(0,0,d[0],d[1],[10]):u==LiteGraph.CIRCLE_SHAPE&&t.arc(d[0]*.5,d[1]*.5,d[0]*.5,0,Math.PI*2),t.clip()),o.has_errors&&(p="red"),this.drawNodeShape(o,t,d,l,p,o.is_selected,o.mouseOver),t.shadowColor="transparent",(r=o.onDrawForeground)==null||r.call(o,t,this,this.canvas),LiteGraph.show_node_tooltip&&o.mouseOver&&o.is_selected&&(!this.selected_nodes||Object.keys(this.selected_nodes).length<=1)&&this.drawNodeTooltip(t,o),t.textAlign=f?"center":"left",t.font=this.inner_text_font;var g=!this.lowQualityRenderingRequired(.6),_=this.connecting_output,m=this.connecting_input;t.lineWidth=1;var G=0,b=new Float32Array(2),T;if(o.flags.collapsed){if(this.render_collapsed_slots){var E=null,k=null;if(o.inputs)for(let I=0;I<o.inputs.length;I++){var N=o.inputs[I];if(N.link!=null){E=N;break}}if(o.outputs)for(let I=0;I<o.outputs.length;I++){var N=o.outputs[I];!N.links||!N.links.length||(k=N)}if(E){let I=0,O=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(I=o._collapsed_width*.5,O=-LiteGraph.NODE_TITLE_HEIGHT),t.fillStyle="#686",t.beginPath(),N.type===LiteGraph.EVENT||N.type===LiteGraph.ACTION||N.shape===LiteGraph.BOX_SHAPE?t.rect(I-7+.5,O-4,14,8):N.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(I+8,O),t.lineTo(I+-4,O-4),t.lineTo(I+-4,O+4),t.closePath()):t.arc(I,O,4,0,Math.PI*2),t.fill()}if(k){let I=o._collapsed_width,O=LiteGraph.NODE_TITLE_HEIGHT*-.5;f&&(I=o._collapsed_width*.5,O=0),t.fillStyle="#686",t.strokeStyle="black",t.beginPath(),N.type===LiteGraph.EVENT||N.type===LiteGraph.ACTION||N.shape===LiteGraph.BOX_SHAPE?t.rect(I-7+.5,O-4,14,8):N.shape===LiteGraph.ARROW_SHAPE?(t.moveTo(I+6,O),t.lineTo(I-6,O-4),t.lineTo(I-6,O+4),t.closePath()):t.arc(I,O,4,0,Math.PI*2),t.fill()}}}else{if(o.inputs)for(let I=0;I<o.inputs.length;I++){let O=o.inputs[I],A=O.type,S=O.shape;t.globalAlpha=c,this.connecting_output&&!LiteGraph.isValidConnection(O.type,_.type)&&(t.globalAlpha=.4*c),t.fillStyle=O.link!=null?O.color_on||this.default_connection_color_byType[A]||this.default_connection_color.input_on:O.color_off||this.default_connection_color_byTypeOff[A]||this.default_connection_color_byType[A]||this.default_connection_color.input_off;let C=o.getConnectionPos(!0,I,b);if(C[0]-=o.pos[0],C[1]-=o.pos[1],G<C[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(G=C[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.beginPath(),A=="array"?S=LiteGraph.GRID_SHAPE:O.name=="onTrigger"||O.name=="onExecuted"?S=LiteGraph.ARROW_SHAPE:(A===LiteGraph.EVENT||A===LiteGraph.ACTION)&&(S=LiteGraph.BOX_SHAPE),T=!0,S===LiteGraph.BOX_SHAPE?f?t.rect(C[0]-5+.5,C[1]-8+.5,10,14):t.rect(C[0]-6+.5,C[1]-5+.5,14,10):S===LiteGraph.ARROW_SHAPE?(t.moveTo(C[0]+8,C[1]+.5),t.lineTo(C[0]-4,C[1]+6+.5),t.lineTo(C[0]-4,C[1]-6+.5),t.closePath()):S===LiteGraph.GRID_SHAPE?(t.rect(C[0]-4,C[1]-4,2,2),t.rect(C[0]-1,C[1]-4,2,2),t.rect(C[0]+2,C[1]-4,2,2),t.rect(C[0]-4,C[1]-1,2,2),t.rect(C[0]-1,C[1]-1,2,2),t.rect(C[0]+2,C[1]-1,2,2),t.rect(C[0]-4,C[1]+2,2,2),t.rect(C[0]-1,C[1]+2,2,2),t.rect(C[0]+2,C[1]+2,2,2),T=!1):h?t.rect(C[0]-4,C[1]-4,8,8):t.arc(C[0],C[1],4,0,Math.PI*2),t.fill(),g&&!(O.name=="onTrigger"||O.name=="onExecuted")){let R=O.label!=null?O.label:O.name;R&&(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||O.dir==LiteGraph.UP?t.fillText(R,C[0],C[1]-10):t.fillText(R,C[0]+10,C[1]+5))}}if(t.textAlign=f?"center":"right",t.strokeStyle="black",o.outputs)for(let I=0;I<o.outputs.length;I++){let O=o.outputs[I],A=O.type,S=O.shape;this.connecting_input&&!LiteGraph.isValidConnection(A,m.type)&&(t.globalAlpha=.4*c);let C=o.getConnectionPos(!1,I,b);if(C[0]-=o.pos[0],C[1]-=o.pos[1],G<C[1]+LiteGraph.NODE_SLOT_HEIGHT*.5&&(G=C[1]+LiteGraph.NODE_SLOT_HEIGHT*.5),t.fillStyle=O.links&&O.links.length?O.color_on||this.default_connection_color_byType[A]||this.default_connection_color.output_on:O.color_off||this.default_connection_color_byTypeOff[A]||this.default_connection_color_byType[A]||this.default_connection_color.output_off,t.beginPath(),A=="array"?S=LiteGraph.GRID_SHAPE:O.name=="onTrigger"||O.name=="onExecuted"?S=LiteGraph.ARROW_SHAPE:(A===LiteGraph.EVENT||A===LiteGraph.ACTION)&&(S=LiteGraph.BOX_SHAPE),T=!0,S===LiteGraph.BOX_SHAPE?f?t.rect(C[0]-5+.5,C[1]-8+.5,10,14):t.rect(C[0]-6+.5,C[1]-5+.5,14,10):S===LiteGraph.ARROW_SHAPE?(t.moveTo(C[0]+8,C[1]+.5),t.lineTo(C[0]-4,C[1]+6+.5),t.lineTo(C[0]-4,C[1]-6+.5),t.closePath()):S===LiteGraph.GRID_SHAPE?(t.rect(C[0]-4,C[1]-4,2,2),t.rect(C[0]-1,C[1]-4,2,2),t.rect(C[0]+2,C[1]-4,2,2),t.rect(C[0]-4,C[1]-1,2,2),t.rect(C[0]-1,C[1]-1,2,2),t.rect(C[0]+2,C[1]-1,2,2),t.rect(C[0]-4,C[1]+2,2,2),t.rect(C[0]-1,C[1]+2,2,2),t.rect(C[0]+2,C[1]+2,2,2),T=!1):h?t.rect(C[0]-4,C[1]-4,8,8):t.arc(C[0],C[1],4,0,Math.PI*2),t.fill(),!h&&T&&t.stroke(),g&&!(O.name=="onTrigger"||O.name=="onExecuted")){let R=O.label!=null?O.label:O.name;R&&(t.fillStyle=LiteGraph.NODE_TEXT_COLOR,f||O.dir==LiteGraph.DOWN?t.fillText(R,C[0],C[1]-8):t.fillText(R,C[0]-10,C[1]+5))}}if(t.textAlign="left",t.globalAlpha=1,o.widgets){var P=G;(f||o.widgets_up)&&(P=2),o.widgets_start_y!=null&&(P=o.widgets_start_y),this.drawNodeWidgets(o,P,t,this.node_widget&&this.node_widget[0]==o?this.node_widget[1]:null)}}(o.clip_area||this.clip_all_nodes)&&t.restore(),t.globalAlpha=1}}drawNodeTooltip(o,t){var n;if(!t||!o){(n=LiteGraph.warn)==null||n.call(LiteGraph,"drawNodeTooltip: invalid node or ctx",t,o);return}var a=t.properties.tooltip!=null?t.properties.tooltip:"";if((!a||a=="")&&LiteGraph.show_node_tooltip_use_descr_property&&t.constructor.desc&&(a=t.constructor.desc),a=(a+"").trim(),!(!a||a=="")){var r=[0,-LiteGraph.NODE_TITLE_HEIGHT],l=t.flags.collapsed?[LiteGraph.NODE_COLLAPSED_WIDTH,LiteGraph.NODE_TITLE_HEIGHT]:t.size;o.font="14px Courier New",o.measureText(a);var p=Math.max(t.size[0],160)+20,h=t.ttip_oTMultiRet?t.ttip_oTMultiRet.height+15:21;o.globalAlpha=.7*this.editor_alpha,o.shadowColor=t.ttip_oTMultiRet?"black":"transparent",o.shadowOffsetX=2,o.shadowOffsetY=2,o.shadowBlur=3,o.fillStyle=t.ttip_oTMultiRet?"#454":"transparent",o.beginPath(),o.roundRect(r[0]-p*.5+l[0]/2,r[1]-15-h,p,h,[3]),o.moveTo(r[0]-10+l[0]/2,r[1]-15),o.lineTo(r[0]+10+l[0]/2,r[1]-15),o.lineTo(r[0]+l[0]/2,r[1]-5),o.fill(),o.shadowColor="transparent",o.textAlign="center",o.fillStyle=t.ttip_oTMultiRet?"#CEC":"transparent",o.globalAlpha=this.editor_alpha;var c=LiteGraph.canvasFillTextMultiline(o,a,r[0]+l[0]/2,r[1]-h,p,14);t.ttip_oTMultiRet=c,o.closePath()}}drawLinkTooltip(o,t){var n,a=t._pos;if(o.fillStyle="black",o.beginPath(),o.arc(a[0],a[1],3,0,Math.PI*2),o.fill(),t.data!=null&&!((n=this.onDrawLinkTooltip)!=null&&n.call(this,o,t,this))){var r=t.data,l=null;if(r.constructor===Number?l=r.toFixed(2):r.constructor===String?l='"'+r+'"':r.constructor===Boolean?l=String(r):r.toToolTip?l=r.toToolTip():l="["+r.constructor.name+"]",l!=null){l=l.substr(0,30),o.font="14px Courier New";var p=o.measureText(l),h=p.width+20,c=24;o.shadowColor="black",o.shadowOffsetX=2,o.shadowOffsetY=2,o.shadowBlur=3,o.fillStyle="#454",o.beginPath(),o.roundRect(a[0]-h*.5,a[1]-15-c,h,c,[3]),o.moveTo(a[0]-10,a[1]-15),o.lineTo(a[0]+10,a[1]-15),o.lineTo(a[0],a[1]-5),o.fill(),o.shadowColor="transparent",o.textAlign="center",o.fillStyle="#CEC",o.fillText(l,a[0],a[1]-15-c*.3)}}}drawNodeShape(o,t,n,a,r,l,p){var h;t.strokeStyle=a,t.fillStyle=r;var c=LiteGraph.NODE_TITLE_HEIGHT,u=this.lowQualityRenderingRequired(.5),d=o._shape||o.constructor.shape||LiteGraph.ROUND_SHAPE,f=o.constructor.title_mode,L=!0;f==LiteGraph.TRANSPARENT_TITLE||f==LiteGraph.NO_TITLE?L=!1:f==LiteGraph.AUTOHIDE_TITLE&&p&&(L=!0);var g=tmp_area;g[0]=0,g[1]=L?-c:0,g[2]=n[0]+1,g[3]=L?n[1]+c:n[1];var _=t.globalAlpha;if(t.beginPath(),d==LiteGraph.BOX_SHAPE||u?t.fillRect(g[0],g[1],g[2],g[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE?t.roundRect(g[0],g[1],g[2],g[3],d==LiteGraph.CARD_SHAPE?[this.round_radius,this.round_radius,0,0]:[this.round_radius]):d==LiteGraph.CIRCLE_SHAPE&&t.arc(n[0]*.5,n[1]*.5,n[0]*.5,0,Math.PI*2),t.fill(),!o.flags.collapsed&&L&&(t.shadowColor="transparent",t.fillStyle="rgba(0,0,0,0.2)",t.fillRect(0,-1,g[2],2)),t.shadowColor="transparent",(h=o.onDrawBackground)==null||h.call(o,t,this,this.canvas,this.graph_mouse),L||f==LiteGraph.TRANSPARENT_TITLE){if(o.onDrawTitleBar)o.onDrawTitleBar(t,c,n,this.ds.scale,a);else if(f!=LiteGraph.TRANSPARENT_TITLE&&(o.constructor.title_color||this.render_title_colored)){var m=o.constructor.title_color||a;if(o.flags.collapsed&&(t.shadowColor=LiteGraph.DEFAULT_SHADOW_COLOR),this.use_gradients){var G=__LGraphCanvas.gradients[m];G||(G=__LGraphCanvas.gradients[m]=t.createLinearGradient(0,0,400,0),G.addColorStop(0,m),G.addColorStop(1,"#000")),t.fillStyle=G}else t.fillStyle=m;t.beginPath(),d==LiteGraph.BOX_SHAPE||u?t.rect(0,-c,n[0]+1,c):(d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE)&&t.roundRect(0,-c,n[0]+1,c,o.flags.collapsed?[this.round_radius]:[this.round_radius,this.round_radius,0,0]),t.fill(),t.shadowColor="transparent"}let P=!1;LiteGraph.node_box_coloured_by_mode&&LiteGraph.NODE_MODES_COLORS[o.mode]&&(P=LiteGraph.NODE_MODES_COLORS[o.mode]),LiteGraph.node_box_coloured_when_on&&(P=o.action_triggered?"#FFF":o.execute_triggered?"#AAA":P);var b=10;if(o.onDrawTitleBox?o.onDrawTitleBox(t,c,n,this.ds.scale):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CIRCLE_SHAPE||d==LiteGraph.CARD_SHAPE?(u&&(t.fillStyle="black",t.beginPath(),t.arc(c*.5,c*-.5,b*.5+1,0,Math.PI*2),t.fill()),t.fillStyle=o.boxcolor||P||LiteGraph.NODE_DEFAULT_BOXCOLOR,u?t.fillRect(c*.5-b*.5,c*-.5-b*.5,b,b):(t.beginPath(),t.arc(c*.5,c*-.5,b*.5,0,Math.PI*2),t.fill())):(u&&(t.fillStyle="black",t.fillRect((c-b)*.5-1,(c+b)*-.5-1,b+2,b+2)),t.fillStyle=o.boxcolor||P||LiteGraph.NODE_DEFAULT_BOXCOLOR,t.fillRect((c-b)*.5,(c+b)*-.5,b,b)),t.globalAlpha=_,o.onDrawTitleText&&o.onDrawTitleText(t,c,n,this.ds.scale,this.title_text_font,l),!u){t.font=this.title_text_font;var T=String(o.getTitle());T&&(l?t.fillStyle=LiteGraph.NODE_SELECTED_TITLE_COLOR:t.fillStyle=o.constructor.title_text_color||this.node_title_color,o.flags.collapsed?(t.textAlign="left",t.fillText(T.substr(0,20),c,LiteGraph.NODE_TITLE_TEXT_Y-c),t.textAlign="left"):(t.textAlign="left",t.fillText(T,c,LiteGraph.NODE_TITLE_TEXT_Y-c)))}if(!o.flags.collapsed&&o.subgraph&&!o.skip_subgraph_button){var E=LiteGraph.NODE_TITLE_HEIGHT,k=o.size[0]-E,N=LiteGraph.isInsideRectangle(this.graph_mouse[0]-o.pos[0],this.graph_mouse[1]-o.pos[1],k+2,-E+2,E-4,E-4);t.fillStyle=N?"#888":"#555",d==LiteGraph.BOX_SHAPE||u?t.fillRect(k+2,-E+2,E-4,E-4):(t.beginPath(),t.roundRect(k+2,-E+2,E-4,E-4,[4]),t.fill()),t.fillStyle="#333",t.beginPath(),t.moveTo(k+E*.2,-E*.6),t.lineTo(k+E*.8,-E*.6),t.lineTo(k+E*.5,-E*.3),t.fill()}o.onDrawTitle&&o.onDrawTitle(t)}l&&(o.onBounding&&o.onBounding(g),f==LiteGraph.TRANSPARENT_TITLE&&(g[1]-=c,g[3]+=c),t.lineWidth=1,t.globalAlpha=.8,t.beginPath(),d==LiteGraph.BOX_SHAPE?t.rect(-6+g[0],-6+g[1],12+g[2],12+g[3]):d==LiteGraph.ROUND_SHAPE||d==LiteGraph.CARD_SHAPE&&o.flags.collapsed?t.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],[this.round_radius*2]):d==LiteGraph.CARD_SHAPE?t.roundRect(-6+g[0],-6+g[1],12+g[2],12+g[3],[this.round_radius*2,2,this.round_radius*2,2]):d==LiteGraph.CIRCLE_SHAPE&&t.arc(n[0]*.5,n[1]*.5,n[0]*.5+6,0,Math.PI*2),t.strokeStyle=LiteGraph.NODE_BOX_OUTLINE_COLOR,t.stroke(),t.strokeStyle=a,t.globalAlpha=1),o.execute_triggered>0&&o.execute_triggered--,o.action_triggered>0&&o.action_triggered--}drawConnections(o){var t=LiteGraph.getTime(),n=this.visible_area;margin_area[0]=n[0]-20,margin_area[1]=n[1]-20,margin_area[2]=n[2]+40,margin_area[3]=n[3]+40,o.lineWidth=this.connections_width,o.fillStyle="#AAA",o.strokeStyle="#AAA",o.globalAlpha=this.editor_alpha;for(var a=this.graph._nodes,r=0,l=a.length;r<l;++r){var p=a[r];if(!(!p.inputs||!p.inputs.length))for(let k=0;k<p.inputs.length;++k){var h=p.inputs[k];if(!(!h||h.link==null)){var c=h.link,u=this.graph.links[c];if(u){var d=this.graph.getNodeById(u.origin_id);if(d!=null){var f=u.origin_slot,L=null;f==-1?L=[d.pos[0]+10,d.pos[1]+10]:L=d.getConnectionPos(!1,f,tempA);var g=p.getConnectionPos(!0,k,tempB);if(link_bounding[0]=L[0],link_bounding[1]=L[1],link_bounding[2]=g[0]-L[0],link_bounding[3]=g[1]-L[1],link_bounding[2]<0&&(link_bounding[0]+=link_bounding[2],link_bounding[2]=Math.abs(link_bounding[2])),link_bounding[3]<0&&(link_bounding[1]+=link_bounding[3],link_bounding[3]=Math.abs(link_bounding[3])),!!LiteGraph.overlapBounding(link_bounding,margin_area)){var _=d.outputs[f],m=p.inputs[k];if(!(!_||!m)){var G=_.dir||(d.horizontal?LiteGraph.DOWN:LiteGraph.RIGHT),b=m.dir||(p.horizontal?LiteGraph.UP:LiteGraph.LEFT);if(this.renderLink(o,L,g,u,!1,0,null,G,b),u&&u._last_time&&t-u._last_time<1e3){var T=2-(t-u._last_time)*.002,E=o.globalAlpha;o.globalAlpha=E*T,this.renderLink(o,L,g,u,!0,T,"white",G,b),o.globalAlpha=E}}}}}}}}o.globalAlpha=1}renderLink(o,t,n,a,r,l,p,h,c,u){a&&this.visible_links.push(a),!p&&a&&(p=a.color||__LGraphCanvas.link_type_colors[a.type]),p||(p=this.default_link_color),a!=null&&this.highlighted_links[a.id]&&(p="#FFF"),h=h||LiteGraph.RIGHT,c=c||LiteGraph.LEFT;var d=LiteGraph.distance(t,n);this.render_connections_border&&this.ds.scale>.6&&(o.lineWidth=this.connections_width+4),o.lineJoin="round",u=u||1,u>1&&(o.lineWidth=.5),o.beginPath();for(let A=0;A<u;A+=1){var f=(A-(u-1)*.5)*5;if(this.links_render_mode==LiteGraph.SPLINE_LINK){o.moveTo(t[0],t[1]+f);let S=0,C=0,R=0,X=0;switch(h){case LiteGraph.LEFT:S=d*-.25;break;case LiteGraph.RIGHT:S=d*.25;break;case LiteGraph.UP:C=d*-.25;break;case LiteGraph.DOWN:C=d*.25;break}switch(c){case LiteGraph.LEFT:R=d*-.25;break;case LiteGraph.RIGHT:R=d*.25;break;case LiteGraph.UP:X=d*-.25;break;case LiteGraph.DOWN:X=d*.25;break}o.bezierCurveTo(t[0]+S,t[1]+C+f,n[0]+R,n[1]+X+f,n[0],n[1]+f)}else if(this.links_render_mode==LiteGraph.LINEAR_LINK){o.moveTo(t[0],t[1]+f);let S=0,C=0,R=0,X=0;switch(h){case LiteGraph.LEFT:S=-1;break;case LiteGraph.RIGHT:S=1;break;case LiteGraph.UP:C=-1;break;case LiteGraph.DOWN:C=1;break}switch(c){case LiteGraph.LEFT:R=-1;break;case LiteGraph.RIGHT:R=1;break;case LiteGraph.UP:X=-1;break;case LiteGraph.DOWN:X=1;break}var L=15;o.lineTo(t[0]+S*L,t[1]+C*L+f),o.lineTo(n[0]+R*L,n[1]+X*L+f),o.lineTo(n[0],n[1]+f)}else if(this.links_render_mode==LiteGraph.STRAIGHT_LINK){o.moveTo(t[0],t[1]);var g=t[0],_=t[1],m=n[0],G=n[1];h==LiteGraph.RIGHT?g+=10:_+=10,c==LiteGraph.LEFT?m-=10:G-=10,o.lineTo(g,_),o.lineTo((g+m)*.5,_),o.lineTo((g+m)*.5,G),o.lineTo(m,G),o.lineTo(n[0],n[1])}else return}this.render_connections_border&&this.ds.scale>.6&&!r&&(o.strokeStyle="rgba(0,0,0,0.5)",o.stroke()),o.lineWidth=this.connections_width,o.fillStyle=o.strokeStyle=p,o.stroke();var b=this.computeConnectionPoint(t,n,.5,h,c);if(a&&a._pos&&(a._pos[0]=b[0],a._pos[1]=b[1]),this.ds.scale>=.6&&this.highquality_render&&c!=LiteGraph.CENTER){if(this.render_connection_arrows){var T=this.computeConnectionPoint(t,n,.25,h,c),E=this.computeConnectionPoint(t,n,.26,h,c),k=this.computeConnectionPoint(t,n,.75,h,c),N=this.computeConnectionPoint(t,n,.76,h,c),P=0,I=0;this.render_curved_connections?(P=-Math.atan2(E[0]-T[0],E[1]-T[1]),I=-Math.atan2(N[0]-k[0],N[1]-k[1])):I=P=n[1]>t[1]?0:Math.PI,o.save(),o.translate(T[0],T[1]),o.rotate(P),o.beginPath(),o.moveTo(-5,-3),o.lineTo(0,7),o.lineTo(5,-3),o.fill(),o.restore(),o.save(),o.translate(k[0],k[1]),o.rotate(I),o.beginPath(),o.moveTo(-5,-3),o.lineTo(0,7),o.lineTo(5,-3),o.fill(),o.restore()}o.beginPath(),o.arc(b[0],b[1],5,0,Math.PI*2),o.fill()}if(l){o.fillStyle=p;for(let A=0;A<5;++A){var O=(LiteGraph.getTime()*.001+A*.2)%1;b=this.computeConnectionPoint(t,n,O,h,c),o.beginPath(),o.arc(b[0],b[1],5,0,2*Math.PI),o.fill()}}}computeConnectionPoint(o,t,n,a,r){a=a||LiteGraph.RIGHT,r=r||LiteGraph.LEFT;var l=LiteGraph.distance(o,t),p=o,h=[o[0],o[1]],c=[t[0],t[1]],u=t;switch(a){case LiteGraph.LEFT:h[0]+=l*-.25;break;case LiteGraph.RIGHT:h[0]+=l*.25;break;case LiteGraph.UP:h[1]+=l*-.25;break;case LiteGraph.DOWN:h[1]+=l*.25;break}switch(r){case LiteGraph.LEFT:c[0]+=l*-.25;break;case LiteGraph.RIGHT:c[0]+=l*.25;break;case LiteGraph.UP:c[1]+=l*-.25;break;case LiteGraph.DOWN:c[1]+=l*.25;break}var d=(1-n)*(1-n)*(1-n),f=3*((1-n)*(1-n))*n,L=3*(1-n)*(n*n),g=n*n*n,_=d*p[0]+f*h[0]+L*c[0]+g*u[0],m=d*p[1]+f*h[1]+L*c[1]+g*u[1];return[_,m]}drawExecutionOrder(o){o.shadowColor="transparent",o.globalAlpha=.25,o.textAlign="center",o.strokeStyle="white",o.globalAlpha=.75;var t=this.visible_nodes;for(let a=0;a<t.length;++a){var n=t[a];o.fillStyle="black",o.fillRect(n.pos[0]-LiteGraph.NODE_TITLE_HEIGHT,n.pos[1]-LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),n.order==0&&o.strokeRect(n.pos[0]-LiteGraph.NODE_TITLE_HEIGHT+.5,n.pos[1]-LiteGraph.NODE_TITLE_HEIGHT+.5,LiteGraph.NODE_TITLE_HEIGHT,LiteGraph.NODE_TITLE_HEIGHT),o.fillStyle="#FFF",o.fillText(n.order,n.pos[0]+LiteGraph.NODE_TITLE_HEIGHT*-.5,n.pos[1]-6)}o.globalAlpha=1}drawNodeWidgets(o,t,n,a){if(!o.widgets||!o.widgets.length)return 0;var r=o.size[0],l=o.widgets;t+=2;var p=LiteGraph.NODE_WIDGET_HEIGHT,h=!this.lowQualityRenderingRequired(.5);n.save(),n.globalAlpha=this.editor_alpha;var c=LiteGraph.WIDGET_OUTLINE_COLOR,u=LiteGraph.WIDGET_BGCOLOR,d=LiteGraph.WIDGET_TEXT_COLOR,f=LiteGraph.WIDGET_SECONDARY_TEXT_COLOR,L=15;for(let N=0;N<l.length;++N){var g=l[N],_=t;g.y&&(_=g.y),g.last_y=_,n.strokeStyle=c,n.fillStyle="#222",n.textAlign="left",g.disabled&&(n.globalAlpha*=.5);var m=g.width||r;switch(g.type){case"button":g.clicked&&(n.fillStyle="#AAA",g.clicked=!1,this.dirty_canvas=!0),n.fillRect(L,_,m-L*2,p),h&&!g.disabled&&n.strokeRect(L,_,m-L*2,p),h&&(n.textAlign="center",n.fillStyle=d,n.fillText(g.label||g.name,m*.5,_+p*.7));break;case"toggle":if(n.textAlign="left",n.strokeStyle=c,n.fillStyle=u,n.beginPath(),h?n.roundRect(L,_,m-L*2,p,[p*.5]):n.rect(L,_,m-L*2,p),n.fill(),h&&!g.disabled&&n.stroke(),n.fillStyle=g.value?"#89A":"#333",n.beginPath(),n.arc(m-L*2,_+p*.5,p*.36,0,Math.PI*2),n.fill(),h){n.fillStyle=f;const P=g.label||g.name;P!=null&&n.fillText(P,L*2,_+p*.7),n.fillStyle=g.value?d:f,n.textAlign="right",n.fillText(g.value?g.options.on||"true":g.options.off||"false",m-40,_+p*.7)}break;case"slider":n.fillStyle=u,n.fillRect(L,_,m-L*2,p);var G=g.options.max-g.options.min,b=(g.value-g.options.min)/G;if(b<0&&(b=0),b>1&&(b=1),n.fillStyle=g.options.hasOwnProperty("slider_color")?g.options.slider_color:a==g?"#89A":"#678",n.fillRect(L,_,b*(m-L*2),p),h&&!g.disabled&&n.strokeRect(L,_,m-L*2,p),g.marker){var T=(g.marker-g.options.min)/G;T<0&&(T=0),T>1&&(T=1),n.fillStyle=g.options.hasOwnProperty("marker_color")?g.options.marker_color:"#AA9",n.fillRect(L+T*(m-L*2),_,2,p)}h&&(n.textAlign="center",n.fillStyle=d,n.fillText(g.label||g.name+"  "+Number(g.value).toFixed(g.options.precision!=null?g.options.precision:3),m*.5,_+p*.7));break;case"number":case"combo":if(n.textAlign="left",n.strokeStyle=c,n.fillStyle=u,n.beginPath(),h?n.roundRect(L,_,m-L*2,p,[p*.5]):n.rect(L,_,m-L*2,p),n.fill(),h)if(g.disabled||n.stroke(),n.fillStyle=d,g.disabled||(n.beginPath(),n.moveTo(L+16,_+5),n.lineTo(L+6,_+p*.5),n.lineTo(L+16,_+p-5),n.fill(),n.beginPath(),n.moveTo(m-L-16,_+5),n.lineTo(m-L-6,_+p*.5),n.lineTo(m-L-16,_+p-5),n.fill()),n.fillStyle=f,n.fillText(g.label||g.name,L*2+5,_+p*.7),n.fillStyle=d,n.textAlign="right",g.type=="number")n.fillText(Number(g.value).toFixed(g.options.precision!==void 0?g.options.precision:3),m-L*2-20,_+p*.7);else{var E=g.value;if(g.options.values){var k=g.options.values;k.constructor===Function&&(k=k()),k&&k.constructor!==Array&&(E=k[g.value])}n.fillText(E,m-L*2-20,_+p*.7)}break;case"string":case"text":if(n.textAlign="left",n.strokeStyle=c,n.fillStyle=u,n.beginPath(),h?n.roundRect(L,_,m-L*2,p,[p*.5]):n.rect(L,_,m-L*2,p),n.fill(),h){g.disabled||n.stroke(),n.save(),n.beginPath(),n.rect(L,_,m-L*2,p),n.clip(),n.fillStyle=f;const P=g.label||g.name;P!=null&&n.fillText(P,L*2,_+p*.7),n.fillStyle=d,n.textAlign="right",n.fillText(String(g.value).substr(0,30),m-L*2,_+p*.7),n.restore()}break;default:g.draw&&g.draw(n,o,m,_,p);break}t+=(g.computeSize?g.computeSize(m)[1]:p)+4,n.globalAlpha=this.editor_alpha}n.restore(),n.textAlign="left"}processNodeWidgets(node,pos,event,active_widget){if(!node.widgets||!node.widgets.length||!this.allow_interaction&&!node.flags.allow_interaction)return null;var x=pos[0]-node.pos[0],y=pos[1]-node.pos[1],width=node.size[0],deltaX=event.deltaX||event.deltax||0,that=this,ref_window=this.getCanvasWindow();for(let i=0;i<node.widgets.length;++i){var w=node.widgets[i];if(!(!w||w.disabled)){var widget_height=w.computeSize?w.computeSize(width)[1]:LiteGraph.NODE_WIDGET_HEIGHT,widget_width=w.width||width;if(!(w!=active_widget&&(x<6||x>widget_width-12||y<w.last_y||y>w.last_y+widget_height||w.last_y===void 0))){var old_value=w.value;switch(w.type){case"button":event.type==="pointerdown"&&(w.callback&&setTimeout(function(){w.callback(w,that,node,pos,event)},20),w.clicked=!0,this.dirty_canvas=!0);break;case"slider":var nvalue=LiteGraph.clamp((x-15)/(widget_width-30),0,1);if(w.options.read_only)break;w.value=w.options.min+(w.options.max-w.options.min)*nvalue,old_value!=w.value&&setTimeout(function(){inner_value_change(w,w.value,old_value)},20),this.dirty_canvas=!0;break;case"number":case"combo":case"enum":if(event.type=="pointermove"&&w.type=="number")deltaX&&(w.value+=deltaX*.1*(w.options.step||1)),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(event.type=="pointerdown"){var values=w.options.values;values&&values.constructor===Function&&(values=w.options.values(w,node));var values_list=null;w.type!="number"&&(values_list=values.constructor===Array?values:Object.keys(values));let o=x<40?-1:x>widget_width-40?1:0;if(w.type=="number")w.value+=o*.1*(w.options.step||1),w.options.min!=null&&w.value<w.options.min&&(w.value=w.options.min),w.options.max!=null&&w.value>w.options.max&&(w.value=w.options.max);else if(o){var index=-1;this.last_mouseclick=0,values.constructor===Object?index=values_list.indexOf(String(w.value))+o:index=values_list.indexOf(w.value)+o,index>=values_list.length&&(index=values_list.length-1),index<0&&(index=0),values.constructor===Array?w.value=values[index]:w.value=index}else{let t=function(n){return values!=values_list&&(n=text_values.indexOf(n)),this.value=n,inner_value_change(this,n,old_value),that.dirty_canvas=!0,!1};var text_values=values!=values_list?Object.values(values):values;new LiteGraph.ContextMenu(text_values,{scale:Math.max(1,this.ds.scale),event,className:"dark",callback:t.bind(w)},ref_window)}}else if(event.type=="pointerup"&&w.type=="number"){let delta=x<40?-1:x>widget_width-40?1:0;event.click_time<200&&delta==0&&this.prompt("Value",w.value,function(v){var s;if(/^[0-9+\-*/()\s]+|\d+\.\d+$/.test(v))try{v=eval(v)}catch(o){(s=LiteGraph.warn)==null||s.call(LiteGraph,o)}this.value=Number(v),inner_value_change(this,this.value,old_value)}.bind(w),event)}old_value!=w.value&&setTimeout(function(){inner_value_change(this,this.value,old_value)}.bind(w),20),this.dirty_canvas=!0;break;case"toggle":event.type=="pointerdown"&&(w.value=!w.value,setTimeout(function(){inner_value_change(w,w.value)},20));break;case"string":case"text":event.type=="pointerdown"&&this.prompt("Value",w.value,function(o){inner_value_change(this,o)}.bind(w),event,w.options?w.options.multiline:!1);break;default:w.mouse&&(this.dirty_canvas=w.mouse(event,[x,y],node));break}return w}}}function inner_value_change(o,t,n){var a;(a=LiteGraph.debug)==null||a.call(LiteGraph,"inner_value_change for processNodeWidgets",o,t),n!=w.value&&(node.onWidgetChanged&&node.onWidgetChanged(w.name,w.value,n,w),node.graph.onGraphChanged({action:"widgetChanged",doSave:!0})),o.type=="number"&&(t=Number(t)),o.value=t,o.options&&o.options.property&&node.properties[o.options.property]!==void 0&&node.setProperty(o.options.property,t),o.callback&&o.callback(o.value,that,node,pos,event)}return null}drawGroups(o,t){if(this.graph){var n=this.graph._groups;t.save(),t.globalAlpha=.5*this.editor_alpha;for(let h=0;h<n.length;++h){var a=n[h];if(LiteGraph.overlapBounding(this.visible_area,a._bounding)){t.fillStyle=a.color||"#335",t.strokeStyle=a.color||"#335";var r=a._pos,l=a._size;t.globalAlpha=.25*this.editor_alpha,t.beginPath(),t.rect(r[0]+.5,r[1]+.5,l[0],l[1]),t.fill(),t.globalAlpha=this.editor_alpha,t.stroke(),t.beginPath(),t.moveTo(r[0]+l[0],r[1]+l[1]),t.lineTo(r[0]+l[0]-10,r[1]+l[1]),t.lineTo(r[0]+l[0],r[1]+l[1]-10),t.fill();var p=a.font_size||LiteGraph.DEFAULT_GROUP_FONT_SIZE;t.font=p+"px Arial",t.textAlign="left",t.fillText(a.title,r[0]+4,r[1]+p)}}t.restore()}}adjustNodesSize(){var o=this.graph._nodes;for(let t=0;t<o.length;++t)o[t].size=o[t].computeSize();this.setDirty(!0,!0)}resize(o,t){if(!o&&!t){var n=this.canvas.parentNode;o=n.offsetWidth,t=n.offsetHeight}this.canvas.width==o&&this.canvas.height==t||(this.canvas.width=o,this.canvas.height=t,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0))}switchLiveMode(o){if(!o){this.live_mode=!this.live_mode,this.dirty_canvas=!0,this.dirty_bgcanvas=!0;return}var t=this,n=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var a=setInterval(function(){t.editor_alpha*=n,t.dirty_canvas=!0,t.dirty_bgcanvas=!0,n<1&&t.editor_alpha<.01&&(clearInterval(a),n<1&&(t.live_mode=!0)),n>1&&t.editor_alpha>.99&&(clearInterval(a),t.editor_alpha=1)},1)}static onGroupAdd(o,t,n){var a=__LGraphCanvas.active_canvas,r=new LiteGraph.LGraphGroup;r.pos=a.convertEventToCanvasOffset(n),a.graph.add(r)}static getBoundaryNodes(o){let t=null,n=null,a=null,r=null;for(const l in o){const p=o[l],[h,c]=p.pos,[u,d]=p.size;(t===null||c<t.pos[1])&&(t=p),(n===null||h+u>n.pos[0]+n.size[0])&&(n=p),(a===null||c+d>a.pos[1]+a.size[1])&&(a=p),(r===null||h<r.pos[0])&&(r=p)}return{top:t,right:n,bottom:a,left:r}}boundaryNodesForSelection(){return __LGraphCanvas.getBoundaryNodes(Object.values(this.selected_nodes))}static alignNodes(o,t,n){if(!o)return;const a=__LGraphCanvas.active_canvas;let r=[];n===void 0?r=__LGraphCanvas.getBoundaryNodes(o):r={top:n,right:n,bottom:n,left:n};for(const[l,p]of Object.entries(a.selected_nodes))switch(t){case"right":p.pos[0]=r.right.pos[0]+r.right.size[0]-p.size[0];break;case"left":p.pos[0]=r.left.pos[0];break;case"top":p.pos[1]=r.top.pos[1];break;case"bottom":p.pos[1]=r.bottom.pos[1]+r.bottom.size[1]-p.size[1];break}a.dirty_canvas=!0,a.dirty_bgcanvas=!0}static onNodeAlign(o,t,n,a,r){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:n,callback:l,parentMenu:a});function l(p){__LGraphCanvas.alignNodes(__LGraphCanvas.active_canvas.selected_nodes,p.toLowerCase(),r)}}static onGroupAlign(o,t,n,a){new LiteGraph.ContextMenu(["Top","Bottom","Left","Right"],{event:n,callback:r,parentMenu:a});function r(l){__LGraphCanvas.alignNodes(__LGraphCanvas.active_canvas.selected_nodes,l.toLowerCase())}}static onMenuAdd(o,t,n,a,r){var l=__LGraphCanvas.active_canvas,p=l.getCanvasWindow(),h=l.graph;if(!h)return;function c(u,d){var f=LiteGraph.getNodeTypesCategories(l.filter||h.filter).filter(function(_){return _.startsWith(u)}),L=[];f.map(function(_){if(_){var m=new RegExp("^("+u+")"),G=_.replace(m,"").split("/")[0],b=u===""?G+"/":u+G+"/",T=G;T.indexOf("::")!=-1&&(T=T.split("::")[1]);var E=L.findIndex(function(k){return k.value===b});E===-1&&L.push({value:b,content:T,has_submenu:!0,callback:function(k,N,P,I){c(k.value,I)}})}});var g=LiteGraph.getNodeTypesInCategory(u.slice(0,-1),l.filter||h.filter);g.map(function(_){if(!_.skip_list){var m={value:_.type,content:_.title,has_submenu:!1,callback:function(G,b,T,E){var k=E.getFirstEvent();l.graph.beforeChange();var N=LiteGraph.createNode(G.value);N&&(N.pos=l.convertEventToCanvasOffset(k),l.graph.add(N)),r&&r(N),l.graph.afterChange()}};L.push(m)}}),new LiteGraph.ContextMenu(L,{event:n,parentMenu:d},p)}return c("",a),!1}static onMenuCollapseAll(){}static onMenuNodeEdit(){}static showMenuNodeOptionalInputs(o,t,n,a,r){var l;if(!r)return;var p=this,h=__LGraphCanvas.active_canvas,c=h.getCanvasWindow();t=r.optional_inputs,r.onGetInputs&&(t=r.onGetInputs());var u=[];if(t)for(let m=0;m<t.length;m++){var d=t[m];if(!d){u.push(null);continue}var f=d[0];d[2]||(d[2]={}),d[2].label&&(f=d[2].label),d[2].removable=!0;var L={content:f,value:d};d[1]==LiteGraph.ACTION&&(L.className="event"),u.push(L)}if(r.onMenuNodeInputs){var g=r.onMenuNodeInputs(u);g&&(u=g)}if(LiteGraph.do_add_triggers_slots&&r.findInputSlot("onTrigger")==-1&&u.push({content:"On Trigger",value:["onTrigger",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),!u.length){LiteGraph.debug&&((l=LiteGraph.log)==null||l.call(LiteGraph,"no input entries"));return}new LiteGraph.ContextMenu(u,{event:n,callback:_,parentMenu:a,node:r},c);function _(m,G,b){var T;if(r&&(m.callback&&m.callback.call(p,r,m,G,b),m.value)){r.graph.beforeChange();var E={};m.value[2]&&(E=Object.assign(E,m.value[2])),r.addInput(m.value[0],m.value[1],E),(T=r.onNodeInputAdd)==null||T.call(r,m.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()}}return!1}static showMenuNodeOptionalOutputs(o,t,n,a,r){if(!r)return;var l=this,p=__LGraphCanvas.active_canvas,h=p.getCanvasWindow();t=r.optional_outputs,r.onGetOutputs&&(t=r.onGetOutputs());var c=[];if(t)for(let _=0;_<t.length;_++){var u=t[_];if(!u){c.push(null);continue}if(!(r.flags&&r.flags.skip_repeated_outputs&&r.findOutputSlot(u[0])!=-1)){var d=u[0];u[2]||(u[2]={}),u[2].label&&(d=u[2].label),u[2].removable=!0;var f={content:d,value:u};u[1]==LiteGraph.EVENT&&(f.className="event"),c.push(f)}}if(this.onMenuNodeOutputs&&(c=this.onMenuNodeOutputs(c)),LiteGraph.do_add_triggers_slots&&r.findOutputSlot("onExecuted")==-1&&c.push({content:"On Executed",value:["onExecuted",LiteGraph.EVENT,{nameLocked:!0,removable:!0}],className:"event"}),r.onMenuNodeOutputs){var L=r.onMenuNodeOutputs(c);L&&(c=L)}if(!c.length)return;new LiteGraph.ContextMenu(c,{event:n,callback:g,parentMenu:a,node:r},h);function g(_,m,G){var b;if(r&&(_.callback&&_.callback.call(l,r,_,m,G),!!_.value)){var T=_.value[1];if(T&&(T.constructor===Object||T.constructor===Array)){var E=[];for(let N in T)E.push({content:N,value:T[N]});return new LiteGraph.ContextMenu(E,{event:m,callback:g,parentMenu:a,node:r}),!1}else{r.graph.beforeChange();var k={};_.value[2]&&(k=Object.assign(k,_.value[2])),r.addOutput(_.value[0],_.value[1],k),(b=r.onNodeOutputAdd)==null||b.call(r,_.value),r.setDirtyCanvas(!0,!0),r.graph.afterChange()}}}return!1}static onShowMenuNodeProperties(o,t,n,a,r){if(!r||!r.properties)return;var l=__LGraphCanvas.active_canvas,p=l.getCanvasWindow(),h=[];for(let d in r.properties){o=r.properties[d]!==void 0?r.properties[d]:" ",typeof o=="object"&&(o=JSON.stringify(o));var c=r.getPropertyInfo(d);(c.type=="enum"||c.type=="combo")&&(o=__LGraphCanvas.getPropertyPrintableValue(o,c.values)),o=__LGraphCanvas.decodeHTML(o),h.push({content:"<span class='property_name'>"+(c.label?c.label:d)+"</span><span class='property_value'>"+o+"</span>",value:d})}if(!h.length)return;new LiteGraph.ContextMenu(h,{event:n,callback:u,parentMenu:a,allow_html:!0,node:r},p);function u(d){if(r){var f=this.getBoundingClientRect();l.showEditPropertyValue(r,d.value,{position:[f.left,f.top]})}}return!1}static decodeHTML(o){var t=document.createElement("div");return t.innerText=o,t.innerHTML}static onMenuResizeNode(o,t,n,a,r){if(!r)return;const l=h=>{h.size=h.computeSize(),h.onResize&&h.onResize(h.size)};var p=__LGraphCanvas.active_canvas;if(!p.selected_nodes||Object.keys(p.selected_nodes).length<=1)l(r);else for(let h in p.selected_nodes)l(p.selected_nodes[h]);r.setDirtyCanvas(!0,!0)}showLinkMenu(o,t){var n=this,a=n.graph.getNodeById(o.origin_id),r=n.graph.getNodeById(o.target_id),l=!1;a&&a.outputs&&a.outputs[o.origin_slot]&&(l=a.outputs[o.origin_slot].type);var p=!1;r&&r.outputs&&r.outputs[o.target_slot]&&(p=r.inputs[o.target_slot].type);var h=new LiteGraph.ContextMenu(options,{event:t,title:o.data!=null?o.data.constructor.name:null,callback:c});function c(u,d,f){switch(u){case"Add Node":__LGraphCanvas.onMenuAdd(null,null,f,h,function(L){var g;(g=LiteGraph.debug)==null||g.call(LiteGraph,"node autoconnect"),!(!L.inputs||!L.inputs.length||!L.outputs||!L.outputs.length)&&a.connectByType(o.origin_slot,L,l)&&(L.connectByType(o.target_slot,r,p),L.pos[0]-=L.size[0]*.5)});break;case"Delete":n.graph.removeLink(o.id);break}}return!1}createDefaultNodeForSlot(o={}){var t,n,a,r,l,p=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,position:[],nodeType:null,posAdd:[0,0],posSizeFix:[0,0]},o),h=this,c=p.nodeFrom&&p.slotFrom!==null,u=!c&&p.nodeTo&&p.slotTo!==null;if(!c&&!u)return(t=LiteGraph.warn)==null||t.call(LiteGraph,"No data passed to createDefaultNodeForSlot "+p.nodeFrom+" "+p.slotFrom+" "+p.nodeTo+" "+p.slotTo),!1;if(!p.nodeType)return(n=LiteGraph.warn)==null||n.call(LiteGraph,"No type to createDefaultNodeForSlot"),!1;var d=c?p.nodeFrom:p.nodeTo,f=c?p.slotFrom:p.slotTo,L=!1;switch(typeof f){case"string":L=c?d.findOutputSlot(f,!1):d.findInputSlot(f,!1),f=c?d.outputs[f]:d.inputs[f];break;case"object":L=c?d.findOutputSlot(f.name):d.findInputSlot(f.name);break;case"number":L=f,f=c?d.outputs[f]:d.inputs[f];break;default:return(a=LiteGraph.warn)==null||a.call(LiteGraph,"Cant get slot information "+f),!1}(f===!1||L===!1)&&((r=LiteGraph.warn)==null||r.call(LiteGraph,"createDefaultNodeForSlot bad slotX "+f+" "+L));var g=f.type==LiteGraph.EVENT?"_event_":f.type,_=c?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(_&&_[g]){f.link;var m=!1;if(typeof _[g]=="object"){for(var G in _[g])if(p.nodeType==_[g][G]||p.nodeType=="AUTO"){m=_[g][G];break}}else(p.nodeType==_[g]||p.nodeType=="AUTO")&&(m=_[g]);if(m){var b=!1;typeof m=="object"&&m.node&&(b=m,m=m.node);var T=LiteGraph.createNode(m);if(T){if(b){if(b.properties)for(const[E,k]of Object.entries(b.properties))T.addProperty(E,k);b.inputs&&(T.inputs=[],Object.values(b.inputs).forEach(E=>{T.addOutput(E[0],E[1])})),b.outputs&&(T.outputs=[],Object.values(b.outputs).forEach(E=>{T.addOutput(E[0],E[1])})),b.title&&(T.title=b.title),b.json&&T.configure(b.json)}return h.graph.add(T),T.pos=[p.position[0]+p.posAdd[0]+(p.posSizeFix[0]?p.posSizeFix[0]*T.size[0]:0),p.position[1]+p.posAdd[1]+(p.posSizeFix[1]?p.posSizeFix[1]*T.size[1]:0)],c?p.nodeFrom.connectByType(L,T,g):p.nodeTo.connectByTypeOutput(L,T,g),!0}else(l=LiteGraph.warn)==null||l.call(LiteGraph,"failed creating "+m)}}return!1}showConnectionMenu(o={}){var t,n,a=Object.assign({nodeFrom:null,slotFrom:null,nodeTo:null,slotTo:null,e:null},o),r=this,l=a.nodeFrom&&a.slotFrom,p=!l&&a.nodeTo&&a.slotTo;if(!l&&!p)return(t=LiteGraph.warn)==null||t.call(LiteGraph,"No data passed to showConnectionMenu"),!1;var h=l?a.nodeFrom:a.nodeTo,c=l?a.slotFrom:a.slotTo,u=!1;switch(typeof c){case"string":u=l?h.findOutputSlot(c,!1):h.findInputSlot(c,!1),c=l?h.outputs[c]:h.inputs[c];break;case"object":u=l?h.findOutputSlot(c.name):h.findInputSlot(c.name);break;case"number":u=c,c=l?h.outputs[c]:h.inputs[c];break;default:return(n=LiteGraph.warn)==null||n.call(LiteGraph,"Cant get slot information "+c),!1}var d=["Add Node",null];r.allow_searchbox&&(d.push("Search"),d.push(null));const f=c.type===LiteGraph.EVENT?"_event_":c.type,L=l?LiteGraph.slot_types_default_out:LiteGraph.slot_types_default_in;if(L&&L[f]){const _=L[f];Array.isArray(_)||typeof _=="object"?Object.values(_).forEach(m=>{d.push(m)}):d.push(_)}var g=new LiteGraph.ContextMenu(d,{event:a.e,title:(c&&c.name!=""?c.name+(f?" | ":""):"")+(c&&f?f:""),callback:(_,m,G)=>{const b={"Add Node":()=>{__LGraphCanvas.onMenuAdd(null,null,G,g,T=>{l?a.nodeFrom.connectByType(u,T,f):a.nodeTo.connectByTypeOutput(u,T,f)})},Search:()=>{l?r.showSearchBox(G,{node_from:a.nodeFrom,slot_from:c,type_filter_in:f}):r.showSearchBox(G,{node_to:a.nodeTo,slot_from:c,type_filter_out:f})},default:()=>{r.createDefaultNodeForSlot(Object.assign(a,{position:[a.e.canvasX,a.e.canvasY],nodeType:_}))}};(b[_]||b.default)()}});return!1}static onShowPropertyEditor(o,t,n,a,r){var l=o.property||"title",p=r[l],h=document.createElement("div");h.is_modified=!1,h.className="graphdialog",h.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>",h.close=()=>{var E;(E=h.parentNode)==null||E.removeChild(h)};var c=h.querySelector(".name");c.innerText=l;var u=h.querySelector(".value");const d=()=>{u&&T(u.value)};u&&(u.value=p,u.addEventListener("blur",function(E){this.focus()}),u.addEventListener("keydown",function(E){if(h.is_modified=!0,E.keyCode==27)h.close();else if(E.keyCode==13)d();else if(E.keyCode!=13&&E.target.localName!="textarea")return;E.preventDefault(),E.stopPropagation()}));var f=__LGraphCanvas.active_canvas,L=f.canvas,g=L.getBoundingClientRect(),_=-20,m=-20;g&&(_-=g.left,m-=g.top),event?(h.style.left=event.clientX+_+"px",h.style.top=event.clientY+m+"px"):(h.style.left=L.width*.5+_+"px",h.style.top=L.height*.5+m+"px");var G=h.querySelector("button");G.addEventListener("click",d),L.parentNode.appendChild(h),u&&u.focus();let b=null;h.addEventListener("pointerleave",E=>{LiteGraph.dialog_close_on_mouse_leave&&!h.is_modified&&(b=setTimeout(h.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),h.addEventListener("pointerenter",E=>{LiteGraph.dialog_close_on_mouse_leave&&b&&clearTimeout(b)});const T=E=>{var k;switch(o.type){case"Number":E=Number(E);break;case"Boolean":E=!!E;break}r[l]=E,(k=h.parentNode)==null||k.removeChild(h),r.setDirtyCanvas(!0,!0)}}prompt(o="",t,n,a,r){var l,p=document.createElement("div");p.is_modified=!1,p.className="graphdialog rounded",r?p.innerHTML="<span class='name'></span> <textarea autofocus class='value'></textarea><button class='rounded'>OK</button>":p.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>",p.close=()=>{var b;this.prompt_box=null,(b=p.parentNode)==null||b.removeChild(p)};var h=__LGraphCanvas.active_canvas,c=h.canvas;c.parentNode.appendChild(p),this.ds.scale>1&&(p.style.transform=`scale(${this.ds.scale})`);var u=null;p.addEventListener("pointerleave",b=>{LiteGraph.dialog_close_on_mouse_leave&&!p.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(p.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),p.addEventListener("pointerenter",b=>{LiteGraph.dialog_close_on_mouse_leave&&u&&clearTimeout(u)});const d=p.querySelectorAll("select");d&&d.forEach(b=>{b.addEventListener("click",T=>{}),b.addEventListener("blur",T=>{}),b.addEventListener("change",T=>{})}),(l=this.prompt_box)==null||l.close(),this.prompt_box=p;var f=p.querySelector(".name");f.innerText=o;var L=p.querySelector(".value");L.value=t;const g=L;g.addEventListener("keydown",b=>{var T;switch(p.is_modified=!0,b.keyCode){case 27:p.close();break;case 13:b.target.localName!=="textarea"&&typeof n=="function"&&(n(g.value),this.setDirty(!0)),(T=LiteGraph.debug)==null||T.call(LiteGraph,"prompt v2 ENTER",g.value,b.target.localName,n),p.close();break;default:return}b.preventDefault(),b.stopPropagation()}),p.querySelector("button").addEventListener("click",b=>{var T;typeof n=="function"&&(n(g.value),this.setDirty(!0)),(T=LiteGraph.debug)==null||T.call(LiteGraph,"prompt v2 OK",g.value,n),p.close()});var _=c.getBoundingClientRect(),m=-20,G=-20;return _&&(m-=_.left,G-=_.top),a?(p.style.left=a.clientX+m+"px",p.style.top=a.clientY+G+"px"):(p.style.left=c.width*.5+m+"px",p.style.top=c.height*.5+G+"px"),setTimeout(function(){g.focus()},10),p}showSearchBox(o,t){var n={slot_from:null,node_from:null,node_to:null,do_type_filter:LiteGraph.search_filter_enabled,type_filter_in:!1,type_filter_out:!1,show_general_if_none_on_typefilter:!0,show_general_after_typefiltered:!0,hide_on_mouse_leave:LiteGraph.search_hide_on_mouse_leave,show_all_if_empty:!0,show_all_on_open:LiteGraph.search_show_all_on_open};t=Object.assign(n,t||{});var a=this,r=__LGraphCanvas.active_canvas,l=r.canvas,p=l.ownerDocument||document,h=document.createElement("div");if(h.className="litegraph litesearchbox graphdialog rounded",h.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/>",t.do_type_filter&&(h.innerHTML+="<select class='slot_in_type_filter'><option value=''></option></select>",h.innerHTML+="<select class='slot_out_type_filter'><option value=''></option></select>"),t.show_close_button&&(h.innerHTML+="<button class='close_searchbox close'>X</button>"),h.innerHTML+="<div class='helper'></div>",p.fullscreenElement?p.fullscreenElement.appendChild(h):(p.body.appendChild(h),p.body.style.overflow="hidden"),t.do_type_filter)var c=h.querySelector(".slot_in_type_filter"),u=h.querySelector(".slot_out_type_filter");if(h.close=function(){a.search_box=null,this.blur(),l.focus(),p.body.style.overflow="",setTimeout(function(){a.canvas.focus()},20),h.parentNode&&h.parentNode.removeChild(h)},this.ds.scale>1&&(h.style.transform=`scale(${this.ds.scale})`),t.hide_on_mouse_leave){var d=!1,f=null;h.addEventListener("pointerenter",function(O){f&&(clearTimeout(f),f=null)}),h.addEventListener("pointerleave",function(O){d||(f=setTimeout(function(){h.close()},500))}),t.do_type_filter&&(c.addEventListener("click",function(O){d++}),c.addEventListener("blur",function(O){d=0}),c.addEventListener("change",function(O){d=-1}),u.addEventListener("click",function(O){d++}),u.addEventListener("blur",function(O){d=0}),u.addEventListener("change",function(O){d=-1}))}a.search_box&&a.search_box.close(),a.search_box=h;var L=h.querySelector(".helper"),g=null,_=null,m=null,G=h.querySelector("input");if(G&&(G.addEventListener("blur",function(O){a.search_box&&this.focus()}),G.addEventListener("keydown",function(O){if(O.keyCode==38)P(!1);else if(O.keyCode==40)P(!0);else if(O.keyCode==27)h.close();else if(O.keyCode==13)I(),m?N(m.innerHTML):g?N(g):h.close();else{_&&clearInterval(_),_=setTimeout(I,250);return}return O.preventDefault(),O.stopPropagation(),O.stopImmediatePropagation(),!0})),t.do_type_filter){if(c){let O=LiteGraph.slot_types_in,A=O.length;(t.type_filter_in==LiteGraph.EVENT||t.type_filter_in==LiteGraph.ACTION)&&(t.type_filter_in="_event_");for(let S=0;S<A;S++){let C=document.createElement("option");C.value=O[S],C.innerHTML=O[S],c.appendChild(C),t.type_filter_in!==!1&&(t.type_filter_in+"").toLowerCase()==(O[S]+"").toLowerCase()&&(C.selected=!0)}c.addEventListener("change",function(){I()})}if(u){let O=LiteGraph.slot_types_out,A=O.length;(t.type_filter_out==LiteGraph.EVENT||t.type_filter_out==LiteGraph.ACTION)&&(t.type_filter_out="_event_");for(let S=0;S<A;S++){let C=document.createElement("option");C.value=O[S],C.innerHTML=O[S],u.appendChild(C),t.type_filter_out!==!1&&(t.type_filter_out+"").toLowerCase()==(O[S]+"").toLowerCase()&&(C.selected=!0)}u.addEventListener("change",function(){I()})}}if(t.show_close_button){var b=h.querySelector(".close");b.addEventListener("click",h.close)}var T=l.getBoundingClientRect(),E=(o?o.clientX:T.left+T.width*.5)-80,k=(o?o.clientY:T.top+T.height*.5)-20;T.width-E<470&&(E=T.width-470),T.height-k<220&&(k=T.height-220),E<T.left+20&&(E=T.left+20),k<T.top+20&&(k=T.top+20),h.style.left=E+"px",h.style.top=k+"px",G.focus(),t.show_all_on_open&&I();function N(O){if(O)if(a.onSearchBoxSelection)a.onSearchBoxSelection(O,o,r);else{var A=LiteGraph.searchbox_extras[O.toLowerCase()];A&&(O=A.type),r.graph.beforeChange();var S=LiteGraph.createNode(O);if(S&&(S.pos=r.convertEventToCanvasOffset(o),r.graph.add(S,!1,{doProcessChange:!1})),A&&A.data){if(A.data.properties)for(let R in A.data.properties)S.addProperty(R,A.data.properties[R]);if(A.data.inputs){S.inputs=[];for(let R in A.data.inputs)S.addOutput(A.data.inputs[R][0],A.data.inputs[R][1])}if(A.data.outputs){S.outputs=[];for(let R in A.data.outputs)S.addOutput(A.data.outputs[R][0],A.data.outputs[R][1])}A.data.title&&(S.title=A.data.title),A.data.json&&S.configure(A.data.json)}let C;if(t.node_from){switch(C=!1,typeof t.slot_from){case"string":C=t.node_from.findOutputSlot(t.slot_from);break;case"object":t.slot_from.name?C=t.node_from.findOutputSlot(t.slot_from.name):C=-1,C==-1&&typeof t.slot_from.slot_index!="undefined"&&(C=t.slot_from.slot_index);break;case"number":C=t.slot_from;break;default:C=0}typeof t.node_from.outputs[C]!="undefined"&&C!==!1&&C>-1&&t.node_from.connectByType(C,S,t.node_from.outputs[C].type)}if(t.node_to){switch(C=!1,typeof t.slot_from){case"string":C=t.node_to.findInputSlot(t.slot_from);break;case"object":t.slot_from.name?C=t.node_to.findInputSlot(t.slot_from.name):C=-1,C==-1&&typeof t.slot_from.slot_index!="undefined"&&(C=t.slot_from.slot_index);break;case"number":C=t.slot_from;break;default:C=0}typeof t.node_to.inputs[C]!="undefined"&&C!==!1&&C>-1&&t.node_to.connectByTypeOutput(C,S,t.node_to.inputs[C].type)}r.graph.afterChange()}h.close()}function P(O){var A=m;m&&m.classList.remove("selected"),m?(m=O?m.nextSibling:m.previousSibling,m||(m=A)):m=O?L.childNodes[0]:L.childNodes[L.childNodes.length],m&&(m.classList.add("selected"),m.scrollIntoView({block:"end",behavior:"smooth"}))}function I(){_=null;var O=G.value;if(g=null,L.innerHTML="",!O&&!t.show_all_if_empty)return;if(a.onSearchBox){var A=a.onSearchBox(L,O,r);if(A)for(let F=0;F<A.length;++F)Q(A[F])}else{let F=function(B,Y={}){var de={skipFilter:!1,inTypeOverride:!1,outTypeOverride:!1},D=Object.assign(de,Y),j=LiteGraph.registered_node_types[B];if(C&&j.filter!=C||(!t.show_all_if_empty||O)&&B.toLowerCase().indexOf(O)===-1)return!1;if(t.do_type_filter&&!D.skipFilter){var K=B;let ce;var z=H.value;if(D.inTypeOverride!==!1&&(z=D.inTypeOverride),H&&z&&LiteGraph.registered_slot_in_types[z]&&LiteGraph.registered_slot_in_types[z].nodes&&(ce=LiteGraph.registered_slot_in_types[z].nodes.includes(K),ce===!1)||(z=U.value,D.outTypeOverride!==!1&&(z=D.outTypeOverride),U&&z&&LiteGraph.registered_slot_out_types[z]&&LiteGraph.registered_slot_out_types[z].nodes&&(ce=LiteGraph.registered_slot_out_types[z].nodes.includes(K),ce===!1)))return!1}return!0};var S=0;O=O.toLowerCase();var C=r.filter||r.graph.filter;let H,U;t.do_type_filter&&a.search_box?(H=a.search_box.querySelector(".slot_in_type_filter"),U=a.search_box.querySelector(".slot_out_type_filter")):(H=!1,U=!1);for(let B in LiteGraph.searchbox_extras){var R=LiteGraph.searchbox_extras[B];if(!((!t.show_all_if_empty||O)&&R.desc.toLowerCase().indexOf(O)===-1)){var X=LiteGraph.registered_node_types[R.type];if(!(X&&X.filter!=C)&&F(R.type)&&(Q(R.desc,"searchbox_extra"),__LGraphCanvas.search_limit!==-1&&S++>__LGraphCanvas.search_limit))break}}var q=null;if(Array.prototype.filter)q=Object.keys(LiteGraph.registered_node_types).filter(F);else{q=[];for(let B in LiteGraph.registered_node_types)F(B)&&q.push(B)}for(let B=0;B<q.length&&(Q(q[B]),!(__LGraphCanvas.search_limit!==-1&&S++>__LGraphCanvas.search_limit));B++);if(t.show_general_after_typefiltered&&(H.value||U.value)){var $=[];for(let B in LiteGraph.registered_node_types)F(B,{inTypeOverride:H&&H.value?"*":!1,outTypeOverride:U&&U.value?"*":!1})&&$.push(B);for(let B=0;B<$.length&&(Q($[B],"generic_type"),!(__LGraphCanvas.search_limit!==-1&&S++>__LGraphCanvas.search_limit));B++);}if((H.value||U.value)&&L.childNodes.length==0&&t.show_general_if_none_on_typefilter){var $=[];for(let Y in LiteGraph.registered_node_types)F(Y,{skipFilter:!0})&&$.push(Y);for(let Y=0;Y<$.length&&(Q($[Y],"not_in_filter"),!(__LGraphCanvas.search_limit!==-1&&S++>__LGraphCanvas.search_limit));Y++);}}function Q(F,H){var U=document.createElement("div");g||(g=F),U.innerText=F,U.dataset.type=escape(F),U.className="litegraph lite-search-item",H&&(U.className+=" "+H),U.addEventListener("click",function(B){N(unescape(this.dataset.type))}),L.appendChild(U)}}return h}showEditPropertyValue(o,t,n){var a,r,l,p,h;if(!o||o.properties[t]===void 0)return;n=n||{};var c=o.getPropertyInfo(t),u=c.type;let d;if(u=="string"||u=="number"||u=="array"||u=="object")d="<input autofocus type='text' class='value'/>";else if((u=="enum"||u=="combo")&&c.values){(a=LiteGraph.debug)==null||a.call(LiteGraph,"CREATING showEditPropertyValue ENUM COMBO",g,u,L),d="<select autofocus type='text' class='value'>";for(let b in c.values){var f=b;c.values.constructor===Array&&(f=c.values[b]),d+="<option value='"+f+"' "+(f==o.properties[t]?"selected":"")+">"+c.values[b]+"</option>"}d+="</select>"}else if(u=="boolean"||u=="toggle")d="<input autofocus type='checkbox' class='value' "+(o.properties[t]?"checked":"")+"/>";else{(r=LiteGraph.warn)==null||r.call(LiteGraph,"unknown type: "+u);return}var L=this.createDialog("<span class='name'>"+(c.label?c.label:t)+"</span>"+d+"<button>OK</button>",n),g=!1;(u=="enum"||u=="combo")&&c.values?((l=LiteGraph.debug)==null||l.call(LiteGraph,"showEditPropertyValue ENUM COMBO",g,u,L),g=L.querySelector("select"),g.addEventListener("change",function(b){var T;L.modified(),(T=LiteGraph.debug)==null||T.call(LiteGraph,"Enum change",g,c,b.target),G(b.target.value)})):u=="boolean"||u=="toggle"?((p=LiteGraph.debug)==null||p.call(LiteGraph,"showEditPropertyValue TOGGLE",g,u,L),g=L.querySelector("input"),g&&g.addEventListener("click",function(b){L.modified(),G(!!g.checked)})):(g=L.querySelector("input"),(h=LiteGraph.debug)==null||h.call(LiteGraph,"showEditPropertyValue",g,u,L),g&&(g.addEventListener("blur",function(b){this.focus()}),f=o.properties[t]!==void 0?o.properties[t]:"",u!=="string"&&(f=JSON.stringify(f)),g.value=f,g.addEventListener("keydown",function(b){if(b.keyCode==27)L.close();else if(b.keyCode==13)m();else if(b.keyCode!=13){L.modified();return}b.preventDefault(),b.stopPropagation()}))),g&&g.focus();var _=L.querySelector("button");_.addEventListener("click",m);function m(){G(g.value)}function G(b){var T;c&&c.values&&c.values.constructor===Object&&c.values[b]!=null&&(b=c.values[b]),typeof o.properties[t]=="number"&&(b=Number(b)),(u=="array"||u=="object")&&(b=JSON.parse(b)),o.properties[t]=b,(T=o.graph)==null||T.onGraphChanged({action:"propertyChanged",doSave:!0}),o.onPropertyChanged&&o.onPropertyChanged(t,b),n.onclose&&n.onclose(),L.close(),o.setDirtyCanvas(!0,!0)}return L}createDialog(o,t){var n={checkForInput:!1,closeOnLeave:!0,closeOnLeave_checkModified:!0};t=Object.assign(n,t||{});var a=document.createElement("div");a.className="graphdialog",a.innerHTML=o,a.is_modified=!1;var r=this.canvas.getBoundingClientRect(),l=-20,p=-20;if(r&&(l-=r.left,p-=r.top),t.position?(l+=t.position[0],p+=t.position[1]):t.event?(l+=t.event.clientX,p+=t.event.clientY):(l+=this.canvas.width*.5,p+=this.canvas.height*.5),a.style.left=l+"px",a.style.top=p+"px",this.canvas.parentNode.appendChild(a),t.checkForInput){var h=[],c=!1;h=a.querySelectorAll("input"),h&&h.forEach(function(L){L.addEventListener("keydown",function(g){if(a.modified(),g.keyCode==27)a.close();else if(g.keyCode!=13)return;g.preventDefault(),g.stopPropagation()}),c||L.focus()})}a.modified=function(){a.is_modified=!0},a.close=function(){a.parentNode&&a.parentNode.removeChild(a)};var u=null,d=!1;a.addEventListener("pointerleave",function(L){d||(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&!a.is_modified&&LiteGraph.dialog_close_on_mouse_leave&&(u=setTimeout(a.close,LiteGraph.dialog_close_on_mouse_leave_delay))}),a.addEventListener("pointerenter",function(L){(t.closeOnLeave||LiteGraph.dialog_close_on_mouse_leave)&&u&&clearTimeout(u)});var f=a.querySelectorAll("select");return f&&f.forEach(function(L){L.addEventListener("click",function(g){d++}),L.addEventListener("blur",function(g){d=0}),L.addEventListener("change",function(g){d=-1})}),a}createPanel(o,t){t=t||{};var n=t.window||window,a=document.createElement("div");if(a.className="litegraph dialog",a.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div style='display:none;' class='dialog-alt-content'></div><div class='dialog-footer'></div>",a.header=a.querySelector(".dialog-header"),t.width&&(a.style.width=t.width+(t.width.constructor===Number?"px":"")),t.height&&(a.style.height=t.height+(t.height.constructor===Number?"px":"")),t.closable){var r=document.createElement("span");r.innerHTML="&#10005;",r.classList.add("close"),r.addEventListener("click",function(){a.close()}),a.header.appendChild(r)}return a.title_element=a.querySelector(".dialog-title"),a.title_element.innerText=o,a.content=a.querySelector(".dialog-content"),a.alt_content=a.querySelector(".dialog-alt-content"),a.footer=a.querySelector(".dialog-footer"),a.close=function(){a.onClose&&typeof a.onClose=="function"&&a.onClose(),a.parentNode&&a.parentNode.removeChild(a),this.parentNode&&this.parentNode.removeChild(this)},a.toggleAltContent=function(l){let p,h;typeof l!="undefined"?(p=l?"block":"none",h=l?"none":"block"):(p=a.alt_content.style.display!="block"?"block":"none",h=a.alt_content.style.display!="block"?"none":"block"),a.alt_content.style.display=p,a.content.style.display=h},a.toggleFooterVisibility=function(l){let p;typeof l!="undefined"?p=l?"block":"none":p=a.footer.style.display!="block"?"block":"none",a.footer.style.display=p},a.clear=function(){this.content.innerHTML=""},a.addHTML=function(l,p,h){var c=document.createElement("div");return p&&(c.className=p),c.innerHTML=l,h?a.footer.appendChild(c):a.content.appendChild(c),c},a.addButton=function(l,p,h){var c=document.createElement("button");return c.innerText=l,c.options=h,c.classList.add("btn"),c.addEventListener("click",p),a.footer.appendChild(c),c},a.addSeparator=function(){var l=document.createElement("div");l.className="separator",a.content.appendChild(l)},a.addWidget=function(l,p,h,c,u){var d,f;c=c||{};var L=String(h);l=l.toLowerCase(),l=="number"&&(L=h.toFixed(3));var g=document.createElement("div");g.className="property",g.innerHTML="<span class='property_name'></span><span class='property_value'></span>",g.querySelector(".property_name").innerText=c.label||p;var _=g.querySelector(".property_value");_.innerText=L,g.dataset.property=p,g.dataset.type=c.type||l,g.options=c,g.value=h,(d=LiteGraph.debug)==null||d.call(LiteGraph,"addWidget",l,h,_,c),l=="code"?g.addEventListener("click",function(G){a.inner_showCodePad(this.dataset.property)}):l=="boolean"?(g.classList.add("boolean"),h&&g.classList.add("bool-on"),g.addEventListener("click",function(){var G=this.dataset.property;this.value=!this.value,this.classList.toggle("bool-on"),this.querySelector(".property_value").innerText=this.value?"true":"false",m(G,this.value)})):l=="string"||l=="number"?(_.setAttribute("contenteditable",!0),_.addEventListener("keydown",function(G){G.code=="Enter"&&(l!="string"||!G.shiftKey)&&(G.preventDefault(),this.blur())}),_.addEventListener("blur",function(){var G=this.innerText,b=this.parentNode.dataset.property,T=this.parentNode.dataset.type;T=="number"&&(G=Number(G)),m(b,G)})):(l=="enum"||l=="combo")&&(L=__LGraphCanvas.getPropertyPrintableValue(h,c.values),_.innerText=L,(f=LiteGraph.debug)==null||f.call(LiteGraph,"addWidget ENUM COMBO",l,L,_,c),_.addEventListener("click",function(G){var b=c.values||[],T=this.parentNode.dataset.property,E=this;new LiteGraph.ContextMenu(b,{event:G,className:"dark",callback:k},n);function k(N){return E.innerText=N,m(T,N),!1}})),a.content.appendChild(g);function m(G,b){var T;(T=LiteGraph.debug)==null||T.call(LiteGraph,"widgetInnerChange",G,b,c),c.callback&&c.callback(G,b,c),u&&u(G,b,c)}return g},a.onOpen&&typeof a.onOpen=="function"&&a.onOpen(),a}static getPropertyPrintableValue(o,t){if(!t||t.constructor===Array)return String(o);if(t.constructor===Object){var n="";for(var a in t)if(t[a]==o){n=a;break}return String(o)+" ("+n+")"}}closePanels(){var o=document.querySelector("#node-panel");o&&o.close(),o=document.querySelector("#option-panel"),o&&o.close()}showShowGraphOptionsPanel(o,t){var n,a,r,l;let p;if(this.constructor&&this.constructor.name=="HTMLDivElement"){if(!((a=(n=t==null?void 0:t.event)==null?void 0:n.target)!=null&&a.lgraphcanvas)){(r=LiteGraph.warn)==null||r.call(LiteGraph,"References not found to add optionPanel",o,t),LiteGraph.debug&&((l=LiteGraph.debug)==null||l.call(LiteGraph,"!obEv || !obEv.event || !obEv.event.target || !obEv.event.target.lgraphcanvas",t,t.event,t.event.target,t.event.target.lgraphcanvas));return}p=t.event.target.lgraphcanvas}else p=this;p.closePanels();var h=p.getCanvasWindow();panel=p.createPanel("Options",{closable:!0,window:h,onOpen:function(){p.OPTIONPANEL_IS_OPEN=!0},onClose:function(){p.OPTIONPANEL_IS_OPEN=!1,p.options_panel=null}}),p.options_panel=panel,panel.id="option-panel",panel.classList.add("settings");function c(){panel.content.innerHTML="";const u=(g,_,m)=>{m&&m.key&&(g=m.key),m.values&&(_=Object.values(m.values).indexOf(_)),p[g]=_};var d=LiteGraph.availableCanvasOptions;d.sort();for(var f in d){var L=d[f];panel.addWidget("boolean",L,p[L],{key:L,on:"True",off:"False"},u)}panel.addWidget("combo","Render mode",LiteGraph.LINK_RENDER_MODES[p.links_render_mode],{key:"links_render_mode",values:LiteGraph.LINK_RENDER_MODES},u),panel.addSeparator(),panel.footer.innerHTML=""}c(),p.canvas.parentNode.appendChild(panel)}showShowNodePanel(o){this.SELECTED_NODE=o,this.closePanels();var t=this.getCanvasWindow(),n=this,a=this.createPanel(o.title||"",{closable:!0,window:t,onOpen:function(){n.NODEPANEL_IS_OPEN=!0},onClose:function(){n.NODEPANEL_IS_OPEN=!1,n.node_panel=null}});n.node_panel=a,a.id="node-panel",a.node=o,a.classList.add("settings");function r(){a.content.innerHTML="",a.addHTML("<span class='node_type'>"+o.type+"</span><span class='node_desc'>"+(o.constructor.desc||"")+"</span><span class='separator'></span>"),a.addHTML("<h3>Properties</h3>");const l=(d,f)=>{var L,g;switch(n.graph.beforeChange(o),d){case"Title":o.title=f;break;case"Mode":var _=Object.values(LiteGraph.NODE_MODES).indexOf(f);_>=0&&LiteGraph.NODE_MODES[_]?o.changeMode(_):(L=LiteGraph.warn)==null||L.call(LiteGraph,"unexpected mode: "+f);break;case"Color":__LGraphCanvas.node_colors[f]?(o.color=__LGraphCanvas.node_colors[f].color,o.bgcolor=__LGraphCanvas.node_colors[f].bgcolor):(g=LiteGraph.warn)==null||g.call(LiteGraph,"unexpected color: "+f);break;default:o.setProperty(d,f);break}n.graph.afterChange(),n.dirty_canvas=!0};a.addWidget("string","Title",o.title,{},l),a.addWidget("combo","Mode",LiteGraph.NODE_MODES[o.mode],{values:LiteGraph.NODE_MODES},l);var p="";o.color!==void 0&&(p=Object.keys(__LGraphCanvas.node_colors).filter(function(d){return __LGraphCanvas.node_colors[d].color==o.color})),a.addWidget("combo","Color",p,{values:Object.keys(__LGraphCanvas.node_colors)},l);for(var h in o.properties){var c=o.properties[h],u=o.getPropertyInfo(h);o.onAddPropertyToPanel&&o.onAddPropertyToPanel(h,a,c,u,l)||a.addWidget(u.widget||u.type,h,c,u,l)}a.addSeparator(),o.onShowCustomPanelInfo&&o.onShowCustomPanelInfo(a),a.footer.innerHTML="",a.addButton("Delete",function(){o.block_delete||(o.graph.remove(o),a.close())}).classList.add("delete")}a.inner_showCodePad=function(l){a.classList.remove("settings"),a.classList.add("centered"),a.alt_content.innerHTML="<textarea class='code'></textarea>";var p=a.alt_content.querySelector("textarea"),h=()=>{a.toggleAltContent(!1),a.toggleFooterVisibility(!0),p.parentNode.removeChild(p),a.classList.add("settings"),a.classList.remove("centered"),r()};p.value=o.properties[l],p.addEventListener("keydown",function(d){d.code=="Enter"&&d.ctrlKey&&(o.setProperty(l,p.value),h())}),a.toggleAltContent(!0),a.toggleFooterVisibility(!1),p.style.height="calc(100% - 40px)";var c=a.addButton("Assign",function(){o.setProperty(l,p.value),h()});a.alt_content.appendChild(c);var u=a.addButton("Close",h);u.style.float="right",a.alt_content.appendChild(u)},r(),this.canvas.parentNode.appendChild(a)}showSubgraphPropertiesDialog(o){var t;(t=LiteGraph.log)==null||t.call(LiteGraph,"showing subgraph properties dialog");var n=this.canvas.parentNode.querySelector(".subgraph_dialog");n&&n.close();var a=this.createPanel("Subgraph Inputs",{closable:!0,width:500});a.node=o,a.classList.add("subgraph_dialog");function r(){if(a.clear(),o.inputs)for(let d=0;d<o.inputs.length;++d){var h=o.inputs[d];if(!h.not_subgraph_input){var c="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",u=a.addHTML(c,"subgraph_property");u.dataset.name=h.name,u.dataset.slot=d,u.querySelector(".name").innerText=h.name,u.querySelector(".type").innerText=h.type,u.querySelector("button").addEventListener("click",function(f){o.removeInput(Number(this.parentNode.dataset.slot)),r()})}}}var l=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",p=a.addHTML(l,"subgraph_property extra",!0);return p.querySelector("button").addEventListener("click",function(h){var c=this.parentNode,u=c.querySelector(".name").value,d=c.querySelector(".type").value;!u||o.findInputSlot(u)!=-1||(o.addInput(u,d),c.querySelector(".name").value="",c.querySelector(".type").value="",r())}),r(),this.canvas.parentNode.appendChild(a),a}showSubgraphPropertiesDialogRight(o){var t=this.canvas.parentNode.querySelector(".subgraph_dialog");t&&t.close();var n=this.createPanel("Subgraph Outputs",{closable:!0,width:500});n.node=o,n.classList.add("subgraph_dialog");function a(){if(n.clear(),o.outputs)for(let d=0;d<o.outputs.length;++d){var h=o.outputs[d];if(!h.not_subgraph_output){var c="<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>",u=n.addHTML(c,"subgraph_property");u.dataset.name=h.name,u.dataset.slot=d,u.querySelector(".name").innerText=h.name,u.querySelector(".type").innerText=h.type,u.querySelector("button").addEventListener("click",function(f){o.removeOutput(Number(this.parentNode.dataset.slot)),a()})}}}var r=" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>",l=n.addHTML(r,"subgraph_property extra",!0);l.querySelector(".name").addEventListener("keydown",function(h){e.keyCode==13&&p.apply(this)}),l.querySelector("button").addEventListener("click",function(h){p.apply(this)});function p(){var h=this.parentNode,c=h.querySelector(".name").value,u=h.querySelector(".type").value;!c||o.findOutputSlot(c)!=-1||(o.addOutput(c,u),h.querySelector(".name").value="",h.querySelector(".type").value="",a())}return a(),this.canvas.parentNode.appendChild(n),n}checkPanels(){if(this.canvas){var o=this.canvas.parentNode.querySelectorAll(".litegraph.dialog");for(let n=0;n<o.length;++n){var t=o[n];t.node&&(!t.node.graph||t.graph!=this.graph)&&t.close()}}}static onMenuNodeCollapse(o,t,n,a,r){r.graph.beforeChange();var l=function(h){h.collapse()},p=__LGraphCanvas.active_canvas;if(!p.selected_nodes||Object.keys(p.selected_nodes).length<=1)l(r);else for(let h in p.selected_nodes)l(p.selected_nodes[h]);r.graph.afterChange()}static onMenuNodePin(o,t,n,a,r){r.pin()}static onMenuNodeMode(o,t,n,a,r){new LiteGraph.ContextMenu(LiteGraph.NODE_MODES,{event:n,callback:l,parentMenu:a,node:r});function l(p){if(!r)return;var h=Object.values(LiteGraph.NODE_MODES).indexOf(p);const c=d=>{var f;h>=0&&LiteGraph.NODE_MODES[h]?d.changeMode(h):((f=LiteGraph.warn)==null||f.call(LiteGraph,"unexpected mode: "+p),d.changeMode(LiteGraph.ALWAYS))};var u=__LGraphCanvas.active_canvas;if(!u.selected_nodes||Object.keys(u.selected_nodes).length<=1)c(r);else for(let d in u.selected_nodes)c(u.selected_nodes[d])}return!1}static onMenuNodeColors(o,t,n,a,r){if(!r)throw new Error("no node for color");var l=[];l.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});for(let h in __LGraphCanvas.node_colors){let c=__LGraphCanvas.node_colors[h];o={value:h,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+c.color+"; background-color:"+c.bgcolor+"'>"+h+"</span>"},l.push(o)}new LiteGraph.ContextMenu(l,{event:n,callback:p,parentMenu:a,node:r});function p(h){if(!r)return;let c=h.value?__LGraphCanvas.node_colors[h.value]:null;const u=f=>{c?f.constructor===LiteGraph.LGraphGroup?f.color=c.groupcolor:(f.color=c.color,f.bgcolor=c.bgcolor):(delete f.color,delete f.bgcolor)};var d=__LGraphCanvas.active_canvas;if(!d.selected_nodes||Object.keys(d.selected_nodes).length<=1)u(r);else for(let f in d.selected_nodes)u(d.selected_nodes[f]);r.setDirtyCanvas(!0,!0)}return!1}static onMenuNodeShapes(o,t,n,a,r){if(!r)throw new Error("no node passed");new LiteGraph.ContextMenu(LiteGraph.VALID_SHAPES,{event:n,callback:l,parentMenu:a,node:r});function l(p){if(!r)return;r.graph.beforeChange();const h=u=>{u.shape=p};var c=__LGraphCanvas.active_canvas;if(!c.selected_nodes||Object.keys(c.selected_nodes).length<=1)h(r);else for(let u in c.selected_nodes)h(c.selected_nodes[u]);r.graph.afterChange(),r.setDirtyCanvas(!0)}return!1}static onMenuNodeRemove(o,t,n,a,r){if(!r)throw new Error("no node passed");var l=r.graph;l.beforeChange();const p=c=>{c.removable!==!1&&l.remove(c)};var h=__LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)p(r);else for(let c in h.selected_nodes)p(h.selected_nodes[c]);l.afterChange(),r.setDirtyCanvas(!0,!0)}static onMenuNodeToSubgraph(o,t,n,a,r){var l=r.graph,p=__LGraphCanvas.active_canvas;if(p){var h=Object.values(p.selected_nodes||{});h.length||(h=[r]);var c=LiteGraph.createNode("graph/subgraph");c.pos=r.pos.concat(),l.add(c),c.buildFromNodes(h),p.deselectAllNodes(),r.setDirtyCanvas(!0,!0)}}static onMenuNodeClone(o,t,n,a,r){r.graph.beforeChange();var l={};const p=c=>{if(c.clonable!==!1){var u=c.clone();u&&(u.pos=[c.pos[0]+5,c.pos[1]+5],c.graph.add(u),l[u.id]=u)}};var h=__LGraphCanvas.active_canvas;if(!h.selected_nodes||Object.keys(h.selected_nodes).length<=1)p(r);else for(let c in h.selected_nodes)p(h.selected_nodes[c]);Object.keys(l).length&&h.selectNodes(l),r.graph.afterChange(),r.setDirtyCanvas(!0,!0)}getCanvasMenuOptions(){var o=null;if(this.getMenuOptions?o=this.getMenuOptions():(o=[{content:"Add Node",has_submenu:!0,callback:__LGraphCanvas.onMenuAdd},{content:"Add Group",callback:__LGraphCanvas.onGroupAdd}],LiteGraph.showCanvasOptions&&o.push({content:"Options",callback:this.showShowGraphOptionsPanel}),Object.keys(this.selected_nodes).length>1&&o.push({content:"Align",has_submenu:!0,callback:__LGraphCanvas.onGroupAlign}),this._graph_stack&&this._graph_stack.length>0&&o.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)})),this.getExtraMenuOptions){var t=this.getExtraMenuOptions(this,o);t&&(o=o.concat(t))}return o}getNodeMenuOptions(o){var t=null;if(o.getMenuOptions?t=o.getMenuOptions(this):(t=[{content:"Inputs",has_submenu:!0,disabled:!0,callback:__LGraphCanvas.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,callback:__LGraphCanvas.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:__LGraphCanvas.onShowMenuNodeProperties},null,{content:"Title",callback:__LGraphCanvas.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:__LGraphCanvas.onMenuNodeMode}],o.resizable!==!1&&t.push({content:"Resize",callback:__LGraphCanvas.onMenuResizeNode}),t.push({content:"Collapse",callback:__LGraphCanvas.onMenuNodeCollapse},{content:"Pin",callback:__LGraphCanvas.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:__LGraphCanvas.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:__LGraphCanvas.onMenuNodeShapes},null)),o.onGetInputs){var n=o.onGetInputs();n&&n.length&&(t[0].disabled=!1)}if(o.onGetOutputs){var a=o.onGetOutputs();a&&a.length&&(t[1].disabled=!1)}if(LiteGraph.do_add_triggers_slots&&(t[1].disabled=!1),o.getExtraMenuOptions){var r=o.getExtraMenuOptions(this,t);r&&(r.push(null),t=r.concat(t))}return o.clonable!==!1&&t.push({content:"Clone",callback:__LGraphCanvas.onMenuNodeClone}),Object.keys(this.selected_nodes).length>1&&t.push({content:"Align Selected To",has_submenu:!0,callback:__LGraphCanvas.onNodeAlign}),t.push(null,{content:"Remove",disabled:!(o.removable!==!1&&!o.block_delete),callback:__LGraphCanvas.onMenuNodeRemove}),o.graph&&o.graph.onGetNodeMenuOptions&&o.graph.onGetNodeMenuOptions(t,o),t}getGroupMenuOptions(){var o=[{content:"Title",callback:__LGraphCanvas.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:__LGraphCanvas.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:__LGraphCanvas.onShowPropertyEditor},null,{content:"Remove",callback:__LGraphCanvas.onMenuNodeRemove}];return o}processContextMenu(o,t){var n,a,r,l=this,p=__LGraphCanvas.active_canvas,h=p.getCanvasWindow(),c=null,u={event:t,callback:_,extra:o};o&&(u.title=o.type);var d=null;if(o&&(d=o.getSlotInPosition(t.canvasX,t.canvasY),__LGraphCanvas.active_node=o),d){if(c=[],o.getSlotMenuOptions)c=o.getSlotMenuOptions(d);else{((a=(n=d==null?void 0:d.output)==null?void 0:n.links)!=null&&a.length||(r=d.input)!=null&&r.link)&&c.push({content:"Disconnect Links",slot:d});var f=d.input||d.output;f.removable&&LiteGraph.canRemoveSlots&&c.push(f.locked?"Cannot remove":{content:"Remove Slot",slot:d}),!f.nameLocked&&LiteGraph.canRenameSlots&&c.push({content:"Rename Slot",slot:d})}var L=d.input||d.output;u.title=L.type||"*",L.type==LiteGraph.ACTION?u.title="Action":L.type==LiteGraph.EVENT&&(u.title="Event")}else if(o)c=this.getNodeMenuOptions(o);else{c=this.getCanvasMenuOptions();var g=this.graph.getGroupOnPos(t.canvasX,t.canvasY);g&&c.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:g,options:this.getGroupMenuOptions(g)}})}if(!c)return;new LiteGraph.ContextMenu(c,u,h);function _(m,G){if(!m)return;let b;if(m.content=="Remove Slot"){b=m.slot,o.graph.beforeChange(),b.input?o.removeInput(b.slot):b.output&&o.removeOutput(b.slot),o.graph.afterChange();return}else if(m.content=="Disconnect Links"){b=m.slot,o.graph.beforeChange(),b.output?o.disconnectOutput(b.slot):b.input&&o.disconnectInput(b.slot),o.graph.afterChange();return}else if(m.content=="Rename Slot"){b=m.slot;var T=b.input?o.getInputInfo(b.slot):o.getOutputInfo(b.slot),E=l.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",G),k=E.querySelector("input");k&&T&&(k.value=T.label||"");var N=function(){o.graph.beforeChange(),k.value&&(T&&(T.label=k.value),l.setDirty(!0)),E.close(),o.graph.afterChange()};E.querySelector("button").addEventListener("click",N),k.addEventListener("keydown",function(P){if(E.is_modified=!0,P.keyCode==27)E.close();else if(P.keyCode==13)N();else if(P.keyCode!=13&&P.target.localName!="textarea")return;P.preventDefault(),P.stopPropagation()}),k.focus()}}}lowQualityRenderingRequired(o){return this.ds.scale<o?this.low_quality_rendering_counter>this.low_quality_rendering_threshold:!1}};M(_LGraphCanvas,"DEFAULT_BACKGROUND_IMAGE","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII="),M(_LGraphCanvas,"link_type_colors",{"-1":"#A86",number:"#AAA",node:"#DCA",string:"#77F",boolean:"#F77"}),M(_LGraphCanvas,"gradients",{}),M(_LGraphCanvas,"search_limit",-1),M(_LGraphCanvas,"node_colors",{red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}});let LGraphCanvas=_LGraphCanvas;var temp=new Float32Array(4),temp_vec2=new Float32Array(2),tmp_area=new Float32Array(4),margin_area=new Float32Array(4),link_bounding=new Float32Array(4),tempA=new Float32Array(2),tempB=new Float32Array(2);class DragAndScale{constructor(t,n){M(this,"onMouseDown",a=>{if(!this.enabled)return;const r=this.element.getBoundingClientRect();var l=a.clientX-r.left,p=a.clientY-r.top;a.canvasx=l,a.canvasy=p,a.dragging=this.dragging;var h=!this.viewport||this.viewport&&l>=this.viewport[0]&&l<this.viewport[0]+this.viewport[2]&&p>=this.viewport[1]&&p<this.viewport[1]+this.viewport[3];h&&(this.dragging=!0,this.abortController=new AbortController,document.addEventListener("pointermove",this.onMouseMove,{signal:this.abortController.signal}),document.addEventListener("pointerup",this.onMouseUp,{signal:this.abortController.signal})),this.last_mouse[0]=l,this.last_mouse[1]=p}),M(this,"onMouseMove",a=>{if(!this.enabled)return;const r=this.element.getBoundingClientRect();var l=a.clientX-r.left,p=a.clientY-r.top;a.canvasx=l,a.canvasy=p,a.dragging=this.dragging;var h=l-this.last_mouse[0],c=p-this.last_mouse[1];this.dragging&&this.mouseDrag(h,c),this.last_mouse[0]=l,this.last_mouse[1]=p}),M(this,"onMouseUp",a=>{var r;this.dragging=!1,(r=this.abortController)==null||r.abort()}),M(this,"onWheel",a=>{a.wheel=-a.deltaY,a.delta=a.wheelDelta?a.wheelDelta/40:a.deltaY?-a.deltaY/3:0,this.changeDeltaScale(1+a.delta*.05)}),this.offset=new Float32Array([0,0]),this.scale=1,this.max_scale=10,this.min_scale=.1,this.onredraw=null,this.enabled=!0,this.last_mouse=[0,0],this.element=null,this.visible_area=new Float32Array(4),t&&(this.element=t,n||this.bindEvents(t))}bindEvents(t){this.last_mouse=new Float32Array(2),t.addEventListener("pointerdown",this.onMouseDown),t.addEventListener("wheel",this.onWheel)}computeVisibleArea(t){if(!this.element){this.visible_area.set([0,0,0,0]);return}let n=this.element.width,a=this.element.height,r=-this.offset[0],l=-this.offset[1];if(t){r+=t[0]/this.scale,l+=t[1]/this.scale;const[c,u]=t.slice(2);n=c,a=u}const p=r+n/this.scale,h=l+a/this.scale;this.visible_area.set([r,l,p-r,h-l])}toCanvasContext(t){t.scale(this.scale,this.scale),t.translate(this.offset[0],this.offset[1])}convertOffsetToCanvas(t){return[(t[0]+this.offset[0])*this.scale,(t[1]+this.offset[1])*this.scale]}convertCanvasToOffset(t,n=[0,0]){return n[0]=t[0]/this.scale-this.offset[0],n[1]=t[1]/this.scale-this.offset[1],n}mouseDrag(t,n){var a;this.offset[0]+=t/this.scale,this.offset[1]+=n/this.scale,(a=this.onredraw)==null||a.call(this,this)}changeScale(t,n){var a;if(t=LiteGraph.clamp(t,this.min_scale,this.max_scale),t==this.scale||!this.element)return;const r=this.element.getBoundingClientRect();if(r){n=n||[r.width*.5,r.height*.5];var l=this.convertCanvasToOffset(n);this.scale=t,Math.abs(this.scale-1)<.01&&(this.scale=1);var p=this.convertCanvasToOffset(n),h=[p[0]-l[0],p[1]-l[1]];this.offset[0]+=h[0],this.offset[1]+=h[1],(a=this.onredraw)==null||a.call(this,this)}}changeDeltaScale(t,n){this.changeScale(this.scale*t,n)}reset(){this.scale=1,this.offset[0]=0,this.offset[1]=0}}var W,se,re,ne,ae,oe,le;const Z=class _e{constructor(t,n={}){ie(this,W);var a;this.options=n,(a=n.scroll_speed)!=null||(n.scroll_speed=.1),this.menu_elements=[],J(this,W,ne).call(this),J(this,W,ae).call(this),J(this,W,se).call(this),J(this,W,re).call(this),this.setTitle(this.options.title),this.addItems(t),J(this,W,oe).call(this),J(this,W,le).call(this)}setTitle(t){var n;if(!t)return;(n=this.titleElement)!=null||(this.titleElement=document.createElement("div"));const a=this.titleElement;a.className="litemenu-title",a.innerHTML=t,this.root.parentElement||this.root.appendChild(a)}addItems(t){for(let n=0;n<t.length;n++){let a=t[n];typeof a!="string"&&(a=a&&a.content!==void 0?String(a.content):String(a));let r=t[n];this.menu_elements.push(this.addItem(a,r,this.options))}}addItem(t,n,a={}){var r;const l=document.createElement("div");l.className="litemenu-entry submenu";let p=!1;n===null?l.classList.add("separator"):(l.innerHTML=(r=n==null?void 0:n.title)!=null?r:t,l.value=n,n&&(n.disabled&&(p=!0,l.classList.add("disabled")),(n.submenu||n.has_submenu)&&l.classList.add("has_submenu")),typeof n=="function"?(l.dataset.value=t,l.onclick_callback=n):l.dataset.value=n,n.className&&(l.className+=" "+n.className)),this.root.appendChild(l),p||l.addEventListener("click",c),!p&&a.autoopen&&l.addEventListener("pointerenter",u=>{const d=this.value;!d||!d.has_submenu||c.call(this,u)});var h=this;function c(u){var d,f,L,g,_;const m=this.value;let G=!0;if((d=LiteGraph.debug)==null||d.call(LiteGraph,"ContextMenu handleMenuItemClick",m,a,G,this.current_submenu,this),(f=h.current_submenu)==null||f.close(u),a.callback&&((L=LiteGraph.debug)==null||L.call(LiteGraph,"ContextMenu handleMenuItemClick callback",this,m,a,u,h,a.node),a.callback.call(this,m,a,u,h,a.node)===!0&&(G=!1)),m&&(m.callback&&!a.ignore_item_callbacks&&m.disabled!==!0&&((g=LiteGraph.debug)==null||g.call(LiteGraph,"ContextMenu using value callback and !ignore_item_callbacks",this,m,a,u,h,a.node),m.callback.call(this,m,a,u,h,a.extra)===!0&&(G=!1)),m.submenu)){if((_=LiteGraph.debug)==null||_.call(LiteGraph,"ContextMenu SUBMENU",this,m,m.submenu.options,e,h,a),!m.submenu.options)throw new Error("ContextMenu submenu needs options");new h.constructor(m.submenu.options,{callback:m.submenu.callback,event:u,parentMenu:h,ignore_item_callbacks:m.submenu.ignore_item_callbacks,title:m.submenu.title,extra:m.submenu.extra,autoopen:a.autoopen}),G=!1}G&&!h.lock&&h.close()}return l}close(t,n){var a;if(this.root.f_textfilter){let r=document;r.removeEventListener("keydown",this.root.f_textfilter,!0),r.removeEventListener("keydown",this.root.f_textfilter,!1),t&&t.target&&(r=t.target.ownerDocument),r||(r=document),r.removeEventListener("keydown",this.root.f_textfilter,!0),r.removeEventListener("keydown",this.root.f_textfilter,!1)}this.parentMenu&&!n&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,t===void 0?this.parentMenu.close():t&&!_e.isCursorOverElement(t,this.parentMenu.root)&&_e.trigger(this.parentMenu.root,"pointerleave",t)),(a=this.current_submenu)==null||a.close(t,!0),this.root.closing_timer&&clearTimeout(this.root.closing_timer),this.root.parentNode&&this.root.parentNode.removeChild(this.root)}static trigger(t,n,a,r){const l=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:a});return Object.defineProperty(l,"target",{value:r}),t.dispatchEvent?t.dispatchEvent(l):t.__events&&t.__events.dispatchEvent(l),l}getTopMenu(){var t,n;return(n=(t=this.options.parentMenu)==null?void 0:t.getTopMenu())!=null?n:this}getFirstEvent(){var t,n;return(n=(t=this.options.parentMenu)==null?void 0:t.getFirstEvent())!=null?n:this.options.event}static isCursorOverElement(t,n){return LiteGraph.isInsideRectangle(t.clientX,t.clientY,n.left,n.top,n.width,n.height)}};W=new WeakSet,se=function(){const o=this.root=document.createElement("div");return this.options.className&&(o.className=this.options.className),o.classList.add("litegraph","litecontextmenu","litemenubar-panel"),o.style.minWidth="80px",o.style.minHeight="10px",o},re=function(){const o=this.root;o.style.pointerEvents="none",setTimeout(()=>{o.style.pointerEvents="auto"},100),o.addEventListener("pointerup",t=>(t.preventDefault(),!0)),o.addEventListener("contextmenu",t=>(t.button!=2||t.preventDefault(),!1)),o.addEventListener("pointerdown",t=>{if(t.button==2)return this.close(),t.preventDefault(),!0}),o.addEventListener("wheel",t=>{var n=parseInt(o.style.top);return o.style.top=(n+t.deltaY*this.options.scroll_speed).toFixed()+"px",t.preventDefault(),!0}),o.addEventListener("pointerenter",t=>{o.closing_timer&&clearTimeout(o.closing_timer)})},ne=function(){var o;const t=this.options.parentMenu;if(t){if(t.constructor!==this.constructor){(o=LiteGraph.error)==null||o.call(LiteGraph,"parentMenu must be of class ContextMenu, ignoring it"),this.options.parentMenu=null;return}this.parentMenu=t,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this}},ae=function(){var o;if(!this.options.event)return;const t=this.options.event.constructor.name;t!=="MouseEvent"&&t!=="CustomEvent"&&t!=="PointerEvent"&&((o=LiteGraph.error)==null||o.call(LiteGraph,`Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it. (${t})`),this.options.event=null)},oe=function(){var o,t,n,a;const r=(t=(o=this.options.event)==null?void 0:o.target.ownerDocument)!=null?t:document,l=(n=r.fullscreenElement)!=null?n:r.body,p=this.root,h=this;LiteGraph.context_menu_filter_enabled&&(r?(p.f_textfilter&&(r.removeEventListener("keydown",p.f_textfilter,!1),r.removeEventListener("keydown",p.f_textfilter,!0),p.f_textfilter=!1),p.f_textfilter=function(c){var u,d,f,L,g,_,m;if(h.current_submenu){(u=LiteGraph.debug)==null||u.call(LiteGraph,"Prevent filtering on ParentMenu",h);return}if(h.allOptions||(h.allOptions=h.menu_elements,h.selectedOption=!1),h.currentOptions||(h.currentOptions=h.allOptions),h.filteringText||(h.filteringText=""),c.key){var G=!1;switch(c.key){case"Backspace":h.filteringText.length&&(h.filteringText=h.filteringText.substring(0,h.filteringText.length-1),G=!0);break;case"Escape":p.f_textfilter&&(r.removeEventListener("keydown",p.f_textfilter,!1),r.removeEventListener("keydown",p.f_textfilter,!0),p.f_textfilter=!1),h.close();break;case"ArrowDown":do h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption+1,0),h.allOptions.length-1):0;while(h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.selectedOption<h.allOptions.length-1);h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&(h.selectedOption=h.currentOptions[h.currentOptions.length-1].menu_index),G=!0;break;case"ArrowUp":do h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption-1,0),h.allOptions.length-1):0;while(h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.selectedOption>0);h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&(h.currentOptions&&h.currentOptions.length?h.selectedOption=h.currentOptions[0].menu_index:h.selectedOption=!1),G=!0;break;case"ArrowLeft":break;case"ArrowRight":case"Enter":if(h.selectedOption!==!1)h.allOptions[h.selectedOption]?((d=LiteGraph.debug)==null||d.call(LiteGraph,"ContextElement simCLICK",h.allOptions[iO]),h.allOptions[h.selectedOption].do_click&&h.allOptions[h.selectedOption].do_click(h.options.event,b)):((f=LiteGraph.debug)==null||f.call(LiteGraph,"ContextElement selection wrong",h.selectedOption),h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption,0),h.allOptions.length-1):0);else if(h.filteringText.length){for(let C in h.allOptions)if(h.allOptions[C].style.display!=="none"&&!(h.allOptions[C].classList+"").includes("separator")&&h.allOptions[C].textContent!=="Search"){(L=LiteGraph.debug)==null||L.call(LiteGraph,"ContextElement simCLICK",h.allOptions[C]),p.f_textfilter&&r&&(r.removeEventListener("keydown",p.f_textfilter,!1),r.removeEventListener("keydown",p.f_textfilter,!0),(g=LiteGraph.debug)==null||g.call(LiteGraph,"Cleaned ParentContextMenu listener",r,h));var b=!1;h.allOptions[C].do_click(c,b);break}}G=!0;break;default:(_=LiteGraph.debug)==null||_.call(LiteGraph,"ContextMenu filter: keyEvent",c.keyCode,c.key),String.fromCharCode(c.key).match(/(\w|\s)/g);break}!G&&c.key.length==1&&(h.filteringText+=c.key,h.parentMenu)}if(h.filteringText&&h.filteringText!==""){var T=[];h.currentOptions=[];for(let C in h.allOptions){var E=h.allOptions[C].textContent,k=E.toLocaleLowerCase().includes(h.filteringText.toLocaleLowerCase()),N=E.toLocaleLowerCase().startsWith(h.filteringText.toLocaleLowerCase()),P=E.split("/"),I=!1;I=P.length>1&&P[P.length-1].toLocaleLowerCase().startsWith(h.filteringText.toLocaleLowerCase())||P.length==1&&N;var O=(h.allOptions[C].classList+"").includes("separator")||E==="Search";h.allOptions[C].menu_index=C,k&&!O?(T.push(h.allOptions[C]),h.allOptions[C].style.display="block",h.allOptions[C].hidden=!1,h.currentOptions.push(h.allOptions[C]),h.allOptions[C].filtered_index=h.currentOptions.length-1):(h.allOptions[C].hidden=!0,h.allOptions[C].style.display="none",h.allOptions[C].filtered_index=!1),I?h.allOptions[C].style.fontWeight="bold":N&&(h.allOptions[C].style.fontStyle="italic")}h.selectedOption=h.selectedOption!==!1?Math.min(Math.max(h.selectedOption,0),h.allOptions.length-1):0,h.allOptions[h.selectedOption]&&h.allOptions[h.selectedOption].hidden&&h.currentOptions.length&&(h.selectedOption=h.currentOptions[0].menu_index)}else{T=h.allOptions,h.currentOptions=h.allOptions;for(let C in h.allOptions)h.allOptions[C].style.display="block",h.allOptions[C].style.fontStyle="inherit",h.allOptions[C].style.fontWeight="inherit",h.allOptions[C].hidden=!1,h.allOptions[C].filtered_index=!1,h.allOptions[C].menu_index=C}var A=h.selectedOption!==!1;if(A){(m=LiteGraph.debug)==null||m.call(LiteGraph,"ContextMenu selection: ",h.selectedOption);for(let C in h.allOptions){var S=h.selectedOption+""==C+"";S?h.allOptions[C].classList.add("selected"):h.allOptions[C].classList.remove("selected")}}document.body.getBoundingClientRect(),p.getBoundingClientRect(),p.style.top=h.top_original+"px"},r.addEventListener("keydown",p.f_textfilter,!0)):(a=LiteGraph.warn)==null||a.call(LiteGraph,"NO root document to add context menu and event",r,options)),l.appendChild(this.root)},le=function(){var o;const t=this.options,n=this.root;let a=t.left||0,r=t.top||0;if(this.top_original=r,t.event){if(a=t.event.clientX-10,r=t.event.clientY-10,t.title&&(r-=20),this.top_original=r,t.parentMenu){const h=t.parentMenu.root.getBoundingClientRect();a=h.left+h.width}const l=document.body.getBoundingClientRect(),p=n.getBoundingClientRect();l.height===0&&((o=LiteGraph.error)==null||o.call(LiteGraph,"document.body height is 0. That is dangerous, set html,body { height: 100%; }")),l.width&&a>l.width-p.width-10&&(a=l.width-p.width-10),l.height&&r>l.height-p.height-10&&(r=l.height-p.height-10)}n.style.left=`${a}px`,n.style.top=`${r}px`,t.scale&&(n.style.transform=`scale(${t.scale})`)},M(Z,"closeAll",(o=window)=>{const t=o.document.querySelectorAll(".litecontextmenu");t.length&&t.forEach(n=>{var a;n.close?n.close():(a=n.parentNode)==null||a.removeChild(n)})});let ContextMenu=Z;var LiteGraph=new class{constructor(){M(this,"extendClass",(o,t)=>{for(let n in t)o.hasOwnProperty(n)||(o[n]=t[n]);if(t.prototype)for(let n in t.prototype)t.prototype.hasOwnProperty(n)&&(o.prototype.hasOwnProperty(n)||(t.prototype.__lookupGetter__(n)?o.prototype.__defineGetter__(n,t.prototype.__lookupGetter__(n)):o.prototype[n]=t.prototype[n],t.prototype.__lookupSetter__(n)&&o.prototype.__defineSetter__(n,t.prototype.__lookupSetter__(n))))}),M(this,"getParameterNames",o=>(o+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)),M(this,"clamp",(o,t,n)=>t>o?t:n<o?n:o),M(this,"pointer_to_mouse_events",Object.freeze({pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointercancel:"mouseup",pointerover:"mouseover",pointerout:"mouseout",pointerenter:"mouseenter",pointerleave:"mouseleave"})),M(this,"mouse_to_pointer_events",Object.freeze({mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseenter:"pointerenter",mouseleave:"pointerleave"})),M(this,"pointerAddListener",(o,t,n,a)=>{if(!(o!=null&&o.addEventListener)||typeof n!="function")return!1;const r=this.resolvePointerEventName(t);return o.addEventListener(r,n,a),!0}),M(this,"pointerRemoveListener",(o,t,n,a)=>{if(!(o!=null&&o.removeEventListener)||typeof n!="function")return!1;const r=this.resolvePointerEventName(t);return o.removeEventListener(r,n,a),!0}),M(this,"closeAllContextMenus",()=>{LiteGraph.warn("LiteGraph.closeAllContextMenus is deprecated in favor of ContextMenu.closeAll()"),ContextMenu.closeAll()}),this.VERSION="0.10.2",this.LLink=LLink,this.LGraph=LGraph,this.LGraphNode=LGraphNode,this.LGraphGroup=LGraphGroup,this.LGraphCanvas=LGraphCanvas,this.DragAndScale=DragAndScale,this.ContextMenu=ContextMenu,this.CANVAS_GRID_SIZE=10,this.NODE_TITLE_HEIGHT=30,this.NODE_TITLE_TEXT_Y=20,this.NODE_SLOT_HEIGHT=20,this.NODE_WIDGET_HEIGHT=20,this.NODE_WIDTH=140,this.NODE_MIN_WIDTH=50,this.NODE_COLLAPSED_RADIUS=10,this.NODE_COLLAPSED_WIDTH=80,this.NODE_TITLE_COLOR="#999",this.NODE_SELECTED_TITLE_COLOR="#FFF",this.NODE_TEXT_SIZE=14,this.NODE_TEXT_COLOR="#AAA",this.NODE_SUBTEXT_SIZE=12,this.NODE_DEFAULT_COLOR="#333",this.NODE_DEFAULT_BGCOLOR="#353535",this.NODE_DEFAULT_BOXCOLOR="#666",this.NODE_DEFAULT_SHAPE="box",this.NODE_BOX_OUTLINE_COLOR="#FFF",this.DEFAULT_SHADOW_COLOR="rgba(0,0,0,0.5)",this.DEFAULT_GROUP_FONT=24,this.WIDGET_BGCOLOR="#222",this.WIDGET_OUTLINE_COLOR="#666",this.WIDGET_TEXT_COLOR="#DDD",this.WIDGET_SECONDARY_TEXT_COLOR="#999",this.LINK_COLOR="#9A9",this.EVENT_LINK_COLOR="#A86",this.CONNECTING_LINK_COLOR="#AFA",this.MAX_NUMBER_OF_NODES=1e3,this.DEFAULT_POSITION=[100,100],this.VALID_SHAPES=["default","box","round","card"],this.BOX_SHAPE=1,this.ROUND_SHAPE=2,this.CIRCLE_SHAPE=3,this.CARD_SHAPE=4,this.ARROW_SHAPE=5,this.GRID_SHAPE=6,this.INPUT=1,this.OUTPUT=2,this.EVENT=-1,this.ACTION=-1,this.NODE_MODES=["Always","On Event","Never","On Trigger","On Request"],this.NODE_MODES_COLORS=["#666","#422","#333","#224","#626"],this.ALWAYS=0,this.ON_EVENT=1,this.NEVER=2,this.ON_TRIGGER=3,this.ON_REQUEST=4,this.UP=1,this.DOWN=2,this.LEFT=3,this.RIGHT=4,this.CENTER=5,this.LINK_RENDER_MODES=["Straight","Linear","Spline"],this.STRAIGHT_LINK=0,this.LINEAR_LINK=1,this.SPLINE_LINK=2,this.NORMAL_TITLE=0,this.NO_TITLE=1,this.TRANSPARENT_TITLE=2,this.AUTOHIDE_TITLE=3,this.VERTICAL_LAYOUT="vertical",this.proxy=null,this.node_images_path="",this.catch_exceptions=!0,this.throw_errors=!0,this.allow_scripts=!1,this.use_deferred_actions=!0,this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.Globals={},this.searchbox_extras={},this.auto_sort_node_types=!1,this.node_box_coloured_when_on=!1,this.node_box_coloured_by_mode=!1,this.dialog_close_on_mouse_leave=!0,this.dialog_close_on_mouse_leave_delay=500,this.shift_click_do_break_link_from=!1,this.click_do_break_link_to=!1,this.search_hide_on_mouse_leave=!0,this.search_filter_enabled=!1,this.search_show_all_on_open=!0,this.show_node_tooltip=!1,this.show_node_tooltip_use_descr_property=!1,this.auto_load_slot_types=!1,this.registered_slot_in_types={},this.registered_slot_out_types={},this.slot_types_in=[],this.slot_types_out=[],this.slot_types_default_in=[],this.slot_types_default_out=[],this.graphDefaultConfig={align_to_grid:!0,links_ontop:!1},this.alt_drag_do_clone_nodes=!1,this.alt_shift_drag_connect_clone_with_input=!0,this.do_add_triggers_slots=!1,this.allow_multi_output_for_events=!0,this.middle_click_slot_add_default_node=!1,this.release_link_on_empty_shows_menu=!1,this.two_fingers_opens_menu=!1,this.backspace_delete=!0,this.ctrl_shift_v_paste_connect_unselected_outputs=!1,this.actionHistory_enabled=!1,this.actionHistoryMaxSave=40,this.refreshAncestorsOnTriggers=!1,this.refreshAncestorsOnActions=!1,this.ensureUniqueExecutionAndActionCall=!1,this.use_uuids=!1,this.context_menu_filter_enabled=!1,this.showCanvasOptions=!1,this.availableCanvasOptions=["allow_addOutSlot_onExecuted","free_resize","highquality_render","use_gradients","pause_rendering","clear_background","read_only","live_mode","show_info","allow_dragcanvas","allow_dragnodes","allow_interaction","allow_searchbox","move_destination_link_without_shift","set_canvas_dirty_on_mouse_event","always_render_background","render_shadows","render_canvas_border","render_connections_shadows","render_connections_border","render_connection_arrows","render_collapsed_slots","render_execution_order","render_title_colored","render_link_tooltip"],this.actionHistoryMaxSave=40,this.canRemoveSlots=!0,this.canRemoveSlots_onlyOptional=!0,this.canRenameSlots=!0,this.canRenameSlots_onlyOptional=!0,this.ensureNodeSingleExecution=!1,this.ensureNodeSingleAction=!1,this.preventAncestorRecalculation=!1,this.ensureUniqueExecutionAndActionCall=!0,this.allowMultiOutputForEvents=!1,this.log_methods=["error","warn","info","log","debug"],this.logging_set_level(2)}logging_set_level(o){this.debug_level=Number(o)}logging(o){if(o>this.debug_level)return;function t(a){let r=[];for(let l=1;l<a.length;l++)typeof a[l]!="undefined"&&r.push(a[l]);return r}let n="debug";if(o>=0&&o<=4&&(n=["error","warn","info","log","debug"][o]),typeof console[n]!="function")throw console.warn("[LG-log] invalid console method",n,t(arguments)),new RangeError;console[n]("[LG]",...t(arguments))}error(){this.logging(0,...arguments)}warn(){this.logging(1,...arguments)}info(){this.logging(2,...arguments)}log(){this.logging(3,...arguments)}debug(){this.logging(4,...arguments)}registerNodeType(o,t){var n,a,r,l,p,h,c;if(!t.prototype)throw new Error("Cannot register a simple object, it must be a class with a prototype");t.type=o,(n=this.debug)==null||n.call(this,"registerNodeType","start",o);const u=t.name,d=o.lastIndexOf("/");t.category=o.substring(0,d),t.title||(t.title=u);const f=Object.getOwnPropertyDescriptors(LGraphNode.prototype);Object.keys(f).forEach(m=>{t.prototype.hasOwnProperty(m)||Object.defineProperty(t.prototype,m,f[m])});const L=this.registered_node_types[o];if(L&&((a=this.debug)==null||a.call(this,"registerNodeType","replacing node type",o,L)),!Object.prototype.hasOwnProperty.call(t.prototype,"shape")&&(Object.defineProperty(t.prototype,"shape",{set:function(m){switch(m){case"default":delete this._shape;break;case"box":this._shape=LiteGraph.BOX_SHAPE;break;case"round":this._shape=LiteGraph.ROUND_SHAPE;break;case"circle":this._shape=LiteGraph.CIRCLE_SHAPE;break;case"card":this._shape=LiteGraph.CARD_SHAPE;break;default:this._shape=m}},get:function(){return this._shape},enumerable:!0,configurable:!0}),t.supported_extensions))for(let m in t.supported_extensions){const G=t.supported_extensions[m];G&&G.constructor===String&&(this.node_types_by_file_extension[G.toLowerCase()]=t)}if(this.registered_node_types[o]=t,t.constructor.name&&(this.Nodes[u]=t),(r=LiteGraph.onNodeTypeRegistered)==null||r.call(LiteGraph,o,t),L&&((l=LiteGraph.onNodeTypeReplaced)==null||l.call(LiteGraph,o,t,L)),t.prototype.onPropertyChange&&LiteGraph.warn("LiteGraph node class "+o+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),t.supported_extensions)for(var g=0;g<t.supported_extensions.length;g++){var _=t.supported_extensions[g];_&&_.constructor===String&&(this.node_types_by_file_extension[_.toLowerCase()]=t)}(p=this.debug)==null||p.call(this,"registerNodeType","type registered",o),this.auto_load_slot_types&&((h=this.debug)==null||h.call(this,"registerNodeType","do auto_load_slot_types",o)),new t((c=t.title)!=null?c:"tmpnode")}unregisterNodeType(o){const t=o.constructor===String?this.registered_node_types[o]:o;if(!t)throw new Error("node type not found: "+o);delete this.registered_node_types[t.type],t.constructor.name&&delete this.Nodes[t.constructor.name]}registerNodeAndSlotType(o,t,n=!1){const a=(o.constructor===String&&this.registered_node_types[o]!=="anonymous"?this.registered_node_types[o]:o).constructor.type;let r=[];typeof t=="string"?r=t.split(","):t==this.EVENT||t==this.ACTION?r=["_event_"]:r=["*"];for(let l=0;l<r.length;++l){let p=r[l];p===""&&(p="*");const h=n?"registered_slot_out_types":"registered_slot_in_types";this[h][p]===void 0&&(this[h][p]={nodes:[]}),this[h][p].nodes.includes(a)||this[h][p].nodes.push(a),n?this.slot_types_out.includes(p.toLowerCase())||(this.slot_types_out.push(p.toLowerCase()),this.slot_types_out.sort()):this.slot_types_in.includes(p.toLowerCase())||(this.slot_types_in.push(p.toLowerCase()),this.slot_types_in.sort())}}buildNodeClassFromObject(o,t){var n="";if(t.inputs)for(let r=0;r<t.inputs.length;++r){let l=t.inputs[r][0],p=t.inputs[r][1];p&&p.constructor===String&&(p='"'+p+'"'),n+="this.addInput('"+l+"',"+p+`);
`}if(t.outputs)for(let r=0;r<t.outputs.length;++r){let l=t.outputs[r][0],p=t.outputs[r][1];p&&p.constructor===String&&(p='"'+p+'"'),n+="this.addOutput('"+l+"',"+p+`);
`}if(t.properties)for(let r in t.properties){let l=t.properties[r];l&&l.constructor===String&&(l='"'+l+'"'),n+="this.addProperty('"+r+"',"+l+`);
`}n+="if(this.onCreate)this.onCreate()";var a=Function(n);for(let r in t)r!="inputs"&&r!="outputs"&&r!="properties"&&(a.prototype[r]=t[r]);return a.title=t.title||o.split("/").pop(),a.desc=t.desc||"Generated from object",this.registerNodeType(o,a),a}wrapFunctionAsNode(o,t,n,a,r){const l=LiteGraph.getParameterNames(t),p=l.map((d,f)=>{const L=n!=null&&n[f]?`'${n[f]}'`:"0";return`this.addInput('${d}', ${L});`}).join(`
`),h=a?`'${a}'`:0,c=r?`this.properties = ${JSON.stringify(r)};`:"",u=new Function(`
            ${p}
            this.addOutput('out', ${h});
            ${c}
        `);return u.title=o.split("/").pop(),u.desc=`Generated from ${t.name}`,u.prototype.onExecute=function(){const d=l.map((L,g)=>this.getInputData(g)),f=t.apply(this,d);this.setOutputData(0,f)},this.registerNodeType(o,u),u}clearRegisteredTypes(){this.registered_node_types={},this.node_types_by_file_extension={},this.Nodes={},this.searchbox_extras={}}addNodeMethod(o,t){LGraphNode.prototype[o]=t;for(var n in this.registered_node_types){var a=this.registered_node_types[n];a.prototype[o]&&(a.prototype["_"+o]=a.prototype[o]),a.prototype[o]=t}}createNode(o,t,n={}){var a,r,l,p,h,c,u,d,f,L,g,_;const m=(a=this.registered_node_types[o])!=null?a:null;if(!m)return(r=this.log)==null||r.call(this,`GraphNode type "${o}" not registered.`),null;t=(l=t!=null?t:m.title)!=null?l:o;let G=null;if(LiteGraph.catch_exceptions)try{G=new m(t)}catch(b){return(p=this.error)==null||p.call(this,b),null}else G=new m(t);return G.type=o,(h=G.title)!=null||(G.title=t),(c=G.properties)!=null||(G.properties={}),(u=G.properties_info)!=null||(G.properties_info=[]),(d=G.flags)!=null||(G.flags={}),(f=G.size)!=null||(G.size=G.computeSize()),(L=G.pos)!=null||(G.pos=LiteGraph.DEFAULT_POSITION.concat()),(g=G.mode)!=null||(G.mode=LiteGraph.ALWAYS),Object.assign(G,n),(_=G.onNodeCreated)==null||_.call(G),G}getNodeType(o){return this.registered_node_types[o]}getNodeTypesInCategory(o,t){const n=Object.values(this.registered_node_types).filter(a=>a.filter!==t?!1:o===""?a.category===null:a.category===o);return this.auto_sort_node_types&&n.sort((a,r)=>a.title.localeCompare(r.title)),n}getNodeTypesCategories(o){const t={"":1};Object.values(this.registered_node_types).forEach(a=>{a.category&&!a.skip_list&&a.filter===o&&(t[a.category]=1)});const n=Object.keys(t);return this.auto_sort_node_types?n.sort():n}reloadNodes(o){var t,n,a,r=document.getElementsByTagName("script"),l=[];for(let u=0;u<r.length;u++)l.push(r[u]);var p=document.getElementsByTagName("head")[0];o=document.location.href+o;for(let u=0;u<l.length;u++){var h=l[u].src;if(!(!h||h.substr(0,o.length)!=o))try{(t=this.log)==null||t.call(this,"Reloading: "+h);var c=document.createElement("script");c.type="text/javascript",c.src=h,p.appendChild(c),p.removeChild(l[u])}catch(d){if(LiteGraph.throw_errors)throw d;(n=this.log)==null||n.call(this,"Error while reloading "+h)}}(a=this.log)==null||a.call(this,"Nodes reloaded")}cloneObject(o,t){if(o==null)return null;const n=JSON.parse(JSON.stringify(o));if(!t)return n;for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t}uuidv4(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,o=>(o^Math.random()*16>>o/4).toString(16))}isValidConnection(o,t){if((o===""||o==="*")&&(o=0),(t===""||t==="*")&&(t=0),!o||!t||o===t||o===LiteGraph.EVENT&&t===LiteGraph.ACTION)return!0;if(o=String(o).toLowerCase(),t=String(t).toLowerCase(),!o.includes(",")&&!t.includes(","))return o===t;const n=o.split(","),a=t.split(",");for(const r of n)for(const l of a)if(this.isValidConnection(r,l))return!0;return!1}registerSearchboxExtra(o,t,n){this.searchbox_extras[t.toLowerCase()]={type:o,desc:t,data:n}}fetchFile(o,t,n,a){if(!o)return null;if(t=t||"text",o.constructor===String)return o.substr(0,4)=="http"&&LiteGraph.proxy&&(o=LiteGraph.proxy+o.substr(o.indexOf(":")+3)),fetch(o).then(l=>{if(!l.ok)throw new Error("File not found");if(t=="arraybuffer")return l.arrayBuffer();if(t=="text"||t=="string")return l.text();if(t=="json")return l.json();if(t=="blob")return l.blob()}).then(l=>{n&&n(l)}).catch(l=>{var p;(p=this.error)==null||p.call(this,"error fetching file:",o),a&&a(l)});if(o.constructor===File||o.constructor===Blob){var r=new FileReader;if(r.onload=l=>{var p=l.target.result;t=="json"&&(p=JSON.parse(p)),n&&n(p)},t=="arraybuffer")return r.readAsArrayBuffer(o);if(t=="text"||t=="json")return r.readAsText(o);if(t=="blob")return r.readAsBinaryString(o)}return null}compareObjects(o,t){const n=Object.keys(o);return n.length!==Object.keys(t).length?!1:n.every(a=>o[a]===t[a])}distance(o,t){const[n,a]=o,[r,l]=t;return Math.sqrt((r-n)**2+(l-a)**2)}colorToString(o){return"rgba("+Math.round(o[0]*255).toFixed()+","+Math.round(o[1]*255).toFixed()+","+Math.round(o[2]*255).toFixed()+","+(o.length==4?o[3].toFixed(2):"1.0")+")"}canvasFillTextMultiline(o,t,n,a,r,l){var p=(t+"").trim().split(" "),h="",c={lines:[],maxW:0,height:0};if(p.length>1)for(var u=0;u<p.length;u++){var d=h+p[u]+" ",f=o.measureText(d),L=f.width;L>r&&u>0?(o.fillText(h,n,a+l*c.lines.length),h=p[u]+" ",c.max=L,c.lines.push(h)):h=d}else h=p[0];return o.fillText(h,n,a+l*c.lines.length),c.lines.push(h),c.height=l*c.lines.length||l,c}isInsideRectangle(o,t,n,a,r,l){return o>n&&o<n+r&&t>a&&t<a+l}growBounding(o,t,n){t<o[0]?o[0]=t:t>o[2]&&(o[2]=t),n<o[1]?o[1]=n:n>o[3]&&(o[3]=n)}isInsideBounding(o,t){return o[0]>=t[0][0]&&o[1]>=t[0][1]&&o[0]<=t[1][0]&&o[1]<=t[1][1]}overlapBounding(o,t){const n=o[0]+o[2],a=o[1]+o[3],r=t[0]+t[2],l=t[1]+t[3];return!(o[0]>r||o[1]>l||n<t[0]||a<t[1])}hex2num(o){o.charAt(0)=="#"&&(o=o.slice(1)),o=o.toUpperCase();for(var t="0123456789ABCDEF",n=new Array(3),a=0,r,l,p=0;p<6;p+=2)r=t.indexOf(o.charAt(p)),l=t.indexOf(o.charAt(p+1)),n[a]=r*16+l,a++;return n}num2hex(o){for(var t="0123456789ABCDEF",n="#",a,r,l=0;l<3;l++)a=o[l]/16,r=o[l]%16,n+=t.charAt(a)+t.charAt(r);return n}resolvePointerEventName(o){if(typeof o!="string")return o;const t=o.toLowerCase(),n=this.pointerevents_method;return n==="mouse"?this.pointer_to_mouse_events[t]||t:n==="pointer"&&this.mouse_to_pointer_events[t]||t}set pointerevents_method(o){const t=typeof o=="string"?o.toLowerCase():"";if(t==="mouse"||t==="pointer"){this._pointerevents_method=t;return}this._pointerevents_method="pointer"}get pointerevents_method(){return this._pointerevents_method||"pointer"}};typeof performance!="undefined"?LiteGraph.getTime=performance.now.bind(performance):typeof Date!="undefined"&&Date.now?LiteGraph.getTime=Date.now.bind(Date):typeof process!="undefined"?LiteGraph.getTime=()=>{var o=process.hrtime();return o[0]*.001+o[1]*1e-6}:LiteGraph.getTime=function(){return new Date().getTime()},typeof window!="undefined"&&!window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||(o=>{window.setTimeout(o,1e3/60)}));export{ContextMenu,DragAndScale,LGraph,LGraphCanvas,LGraphGroup,LGraphNode,LLink,LiteGraph};
