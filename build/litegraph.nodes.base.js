var ve=Object.defineProperty,me=(n,t,e)=>t in n?ve(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,a=(n,t,e)=>me(n,typeof t!="symbol"?t+"":t,e);import{LiteGraph as i}from"./litegraph.core.js";class U{constructor(){this.addOutput("in ms","number"),this.addOutput("in sec","number")}onExecute(){this.setOutputData(0,this.graph.globaltime*1e3),this.setOutputData(1,this.graph.globaltime)}}a(U,"title","Time"),a(U,"desc","Time"),i.registerNodeType("basic/time",U);class T{constructor(){this.size=[140,80],this.properties={enabled:!0},this.enabled=!0,this.subgraph=new i.LGraph,this.subgraph._subgraph_node=this,this.subgraph._is_subgraph=!0,this.subgraph.onTrigger=this.onSubgraphTrigger.bind(this),this.subgraph.onInputAdded=this.onSubgraphNewInput.bind(this),this.subgraph.onInputRenamed=this.onSubgraphRenamedInput.bind(this),this.subgraph.onInputTypeChanged=this.onSubgraphTypeChangeInput.bind(this),this.subgraph.onInputRemoved=this.onSubgraphRemovedInput.bind(this),this.subgraph.onOutputAdded=this.onSubgraphNewOutput.bind(this),this.subgraph.onOutputRenamed=this.onSubgraphRenamedOutput.bind(this),this.subgraph.onOutputTypeChanged=this.onSubgraphTypeChangeOutput.bind(this),this.subgraph.onOutputRemoved=this.onSubgraphRemovedOutput.bind(this)}onGetInputs(){return[["enabled","boolean"]]}onDblClick(t,e,s){var r=this;setTimeout(function(){s.openSubgraph(r.subgraph)},10)}onAction(t,e){this.subgraph.onAction(t,e)}onExecute(){if(this.enabled=this.getInputOrProperty("enabled"),!!this.enabled){if(this.inputs)for(let t=0;t<this.inputs.length;t++){let e=this.inputs[t],s=this.getInputData(t);this.subgraph.setInputData(e.name,s)}if(this.subgraph.runStep(),this.outputs)for(let t=0;t<this.outputs.length;t++){let e=this.outputs[t],s=this.subgraph.getOutputData(e.name);this.setOutputData(t,s)}}}sendEventToAllNodes(t,e,s){this.enabled&&this.subgraph.sendEventToAllNodes(t,e,s)}onDrawBackground(t,e,s,r){if(this.flags.collapsed)return;var o=this.size[1]-i.NODE_TITLE_HEIGHT+.5,u=i.isInsideRectangle(r[0],r[1],this.pos[0],this.pos[1]+o,this.size[0],i.NODE_TITLE_HEIGHT);let h=i.isInsideRectangle(r[0],r[1],this.pos[0],this.pos[1]+o,this.size[0]/2,i.NODE_TITLE_HEIGHT);t.fillStyle=u?"#555":"#222",t.beginPath(),this._shape==i.BOX_SHAPE?h?t.rect(0,o,this.size[0]/2+1,i.NODE_TITLE_HEIGHT):t.rect(this.size[0]/2,o,this.size[0]/2+1,i.NODE_TITLE_HEIGHT):h?t.roundRect(0,o,this.size[0]/2+1,i.NODE_TITLE_HEIGHT,[0,0,8,8]):t.roundRect(this.size[0]/2,o,this.size[0]/2+1,i.NODE_TITLE_HEIGHT,[0,0,8,8]),u?t.fill():t.fillRect(0,o,this.size[0]+1,i.NODE_TITLE_HEIGHT),t.textAlign="center",t.font="24px Arial",t.fillStyle=u?"#DDD":"#999",t.fillText("+",this.size[0]*.25,o+24),t.fillText("+",this.size[0]*.75,o+24)}onMouseDown(t,e,s){var r,o,u,h=this.size[1]-i.NODE_TITLE_HEIGHT+.5;(r=console.log)==null||r.call(console,0),e[1]>h&&(e[0]<this.size[0]/2?((o=console.log)==null||o.call(console,1),s.showSubgraphPropertiesDialog(this)):((u=console.log)==null||u.call(console,2),s.showSubgraphPropertiesDialogRight(this)))}computeSize(){var t=this.inputs?this.inputs.length:0,e=this.outputs?this.outputs.length:0;return[200,Math.max(t,e)*i.NODE_SLOT_HEIGHT+i.NODE_TITLE_HEIGHT]}onSubgraphTrigger(t){var e=this.findOutputSlot(t);e!=-1&&this.triggerSlot(e)}onSubgraphNewInput(t,e){var s=this.findInputSlot(t);s==-1&&this.addInput(t,e)}onSubgraphRenamedInput(t,e){var s=this.findInputSlot(t);if(s!=-1){var r=this.getInputInfo(s);r.name=e}}onSubgraphTypeChangeInput(t,e){var s=this.findInputSlot(t);if(s!=-1){var r=this.getInputInfo(s);r.type=e}}onSubgraphRemovedInput(t){var e=this.findInputSlot(t);e!=-1&&this.removeInput(e)}onSubgraphNewOutput(t,e){var s=this.findOutputSlot(t);s==-1&&this.addOutput(t,e)}onSubgraphRenamedOutput(t,e){var s=this.findOutputSlot(t);if(s!=-1){var r=this.getOutputInfo(s);r.name=e}}onSubgraphTypeChangeOutput(t,e){var s=this.findOutputSlot(t);if(s!=-1){var r=this.getOutputInfo(s);r.type=e}}onSubgraphRemovedOutput(t){var e=this.findOutputSlot(t);e!=-1&&this.removeOutput(e)}getExtraMenuOptions(t){var e=this;return[{content:"Open",callback:function(){t.openSubgraph(e.subgraph)}}]}onResize(t){t[1]+=20}serialize(){var t=i.LGraphNode.prototype.serialize.call(this);return t.subgraph=this.subgraph.serialize(),t}reassignSubgraphUUIDs(t){const e={nodeIDs:{},linkIDs:{}};for(const s of t.nodes){const r=s.id,o=i.uuidv4();if(s.id=o,e.nodeIDs[r]||e.nodeIDs[o])throw new Error(`New/old node UUID wasn't unique in changed map! ${r} ${o}`);e.nodeIDs[r]=o,e.nodeIDs[o]=r}for(const s of t.links){const r=s[0],o=i.uuidv4();if(s[0]=o,e.linkIDs[r]||e.linkIDs[o])throw new Error(`New/old link UUID wasn't unique in changed map! ${r} ${o}`);e.linkIDs[r]=o,e.linkIDs[o]=r;const u=s[1],h=s[3];if(!e.nodeIDs[u])throw new Error(`Old node UUID not found in mapping! ${u}`);if(s[1]=e.nodeIDs[u],!e.nodeIDs[h])throw new Error(`Old node UUID not found in mapping! ${h}`);s[3]=e.nodeIDs[h]}for(const s of t.nodes){if(s.inputs)for(const r of s.inputs)r.link&&(r.link=e.linkIDs[r.link]);if(s.outputs)for(const r of s.outputs)r.links&&(r.links=r.links.map(o=>e.linkIDs[o]))}for(const s of t.nodes)if(s.type==="graph/subgraph"){const r=reassignGraphUUIDs(s.subgraph);e.nodeIDs.assign(r.nodeIDs),e.linkIDs.assign(r.linkIDs)}}clone(){var t=i.createNode(this.type),e=this.serialize();if(i.use_uuids){const s=i.cloneObject(e.subgraph);this.reassignSubgraphUUIDs(s),e.subgraph=s}return delete e.id,delete e.inputs,delete e.outputs,t.configure(e),t}buildFromNodes(t){var e={};for(let s=0;s<t.length;++s){const r=t[s];r&&r.id!=null&&(e[r.id]=r)}for(let s=0;s<t.length;++s){let r=t[s];if(r.inputs)for(let o=0;o<r.inputs.length;++o){let u=r.inputs[o];if(!u||!u.link)continue;let h=r.graph.links[u.link];h&&(e[h.origin_id]||this.subgraph.addInput(u.name,h.type))}if(r.outputs)for(let o=0;o<r.outputs.length;++o){let u=r.outputs[o];if(!(!u||!u.links||!u.links.length))for(let h=0;h<u.links.length;++h){let p=r.graph.links[u.links[h]];if(p&&!e[p.target_id])break}}}}}a(T,"title","Subgraph"),a(T,"desc","Graph inside a node"),a(T,"title_color","#334"),i.Subgraph=T,i.registerNodeType("graph/subgraph",T);class z{constructor(){this.addOutput("","number"),this.name_in_graph="",this.properties={name:"",type:"number",value:0};var t=this;this.name_widget=this.addWidget("text","Name",this.properties.name,function(e){e&&t.setProperty("name",e)}),this.type_widget=this.addWidget("text","Type",this.properties.type,function(e){t.setProperty("type",e)}),this.value_widget=this.addWidget("number","Value",this.properties.value,function(e){t.setProperty("value",e)}),this.widgets_up=!0,this.size=[180,90]}onConfigure(){this.updateType()}updateType(){var t=this.properties.type;this.type_widget.value=t,this.outputs[0].type!=t&&(i.isValidConnection(this.outputs[0].type,t)||this.disconnectOutput(0),this.outputs[0].type=t),t=="number"?(this.value_widget.type="number",this.value_widget.value=0):t=="boolean"?(this.value_widget.type="toggle",this.value_widget.value=!0):t=="string"?(this.value_widget.type="text",this.value_widget.value=""):(this.value_widget.type=null,this.value_widget.value=null),this.properties.value=this.value_widget.value,this.graph&&this.name_in_graph&&this.graph.changeInputType(this.name_in_graph,t)}onPropertyChanged(t,e){if(t=="name"){if(e==""||e==this.name_in_graph||e=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameInput(this.name_in_graph,e):this.graph.addInput(e,this.properties.type)),this.name_widget.value=e,this.name_in_graph=e}else t=="type"&&this.updateType()}getTitle(){return this.flags.collapsed?this.properties.name:this.title}onAction(t,e){this.properties.type==i.EVENT&&this.triggerSlot(0,e)}onExecute(){var t=this.properties.name,e=this.graph.inputs[t];if(!e){this.setOutputData(0,this.properties.value);return}this.setOutputData(0,e.value!==void 0?e.value:this.properties.value)}onRemoved(){this.name_in_graph&&this.graph.removeInput(this.name_in_graph)}}a(z,"title","Input"),a(z,"desc","Input of the graph"),i.GraphInput=z,i.registerNodeType("graph/input",z);class P{constructor(){this.addInput("",""),this.name_in_graph="",this.properties={name:"",type:""},this.name_widget=this.addWidget("text","Name",this.properties.name,"name"),this.type_widget=this.addWidget("text","Type",this.properties.type,"type"),this.widgets_up=!0,this.size=[180,60]}onPropertyChanged(t,e){if(t=="name"){if(e==""||e==this.name_in_graph||e=="enabled")return!1;this.graph&&(this.name_in_graph?this.graph.renameOutput(this.name_in_graph,e):this.graph.addOutput(e,this.properties.type)),this.name_widget.value=e,this.name_in_graph=e}else t=="type"&&this.updateType()}updateType(){var t=this.properties.type;this.type_widget&&(this.type_widget.value=t),this.inputs[0].type!=t&&((t=="action"||t=="event")&&(t=i.EVENT),i.isValidConnection(this.inputs[0].type,t)||this.disconnectInput(0),this.inputs[0].type=t),this.graph&&this.name_in_graph&&this.graph.changeOutputType(this.name_in_graph,t)}onExecute(){this._value=this.getInputData(0),this.graph.setOutputData(this.properties.name,this._value)}onAction(t,e){this.properties.type==i.ACTION&&this.graph.trigger(this.properties.name,e)}onRemoved(){this.name_in_graph&&this.graph.removeOutput(this.name_in_graph)}getTitle(){return this.flags.collapsed?this.properties.name:this.title}}a(P,"title","Output"),a(P,"desc","Output of the graph"),i.GraphOutput=P,i.registerNodeType("graph/output",P);class c{constructor(){this.addOutput("value","number"),this.addProperty("value",1),this.widget=this.addWidget("number","value",1,"value"),this.widgets_up=!0,this.size=[180,30]}onExecute(){this.setOutputData(0,parseFloat(this.properties.value))}getTitle(){return this.flags.collapsed?this.properties.value:this.title}setValue(t){this.setProperty("value",t)}onDrawBackground(){this.outputs[0].label=this.properties.value.toFixed(3)}}a(c,"title","Const Number"),a(c,"desc","Constant number"),i.registerNodeType("basic/const",c);class E{constructor(){this.addOutput("bool","boolean"),this.addProperty("value",!0),this.widget=this.addWidget("toggle","value",!0,"value"),this.serialize_widgets=!0,this.widgets_up=!0,this.size=[140,30]}onExecute(){this.setOutputData(0,this.properties.value)}onGetInputs(){return[["toggle",i.ACTION]]}onAction(){this.setValue(!this.properties.value)}}a(E,"title","Const Boolean"),a(E,"desc","Constant boolean"),E.prototype.getTitle=c.prototype.getTitle,E.prototype.setValue=c.prototype.setValue,i.registerNodeType("basic/boolean",E);class D{constructor(){this.addOutput("string","string"),this.addProperty("value",""),this.widget=this.addWidget("text","value","","value"),this.widgets_up=!0,this.size=[180,30]}onExecute(){this.setOutputData(0,this.properties.value)}onDropFile(t){var e=this,s=new FileReader;s.onload=function(r){e.setProperty("value",r.target.result)},s.readAsText(t)}}a(D,"title","Const String"),a(D,"desc","Constant string"),D.prototype.getTitle=c.prototype.getTitle,D.prototype.setValue=c.prototype.setValue,i.registerNodeType("basic/string",D);class q{constructor(){this.addOutput("obj","object"),this.size=[120,30],this._object={}}onExecute(){this.setOutputData(0,this._object)}}a(q,"title","Const Object"),a(q,"desc","Constant Object"),i.registerNodeType("basic/object",q);class w{constructor(){this.addInput("url","string"),this.addOutput("file","string"),this.addProperty("url",""),this.addProperty("type","text"),this.widget=this.addWidget("text","url","","url"),this._data=null}onPropertyChanged(t,e){t=="url"&&(e==null||e==""?this._data=null:this.fetchFile(e))}onExecute(){var t=this.getInputData(0)||this.properties.url;t&&(t!=this._url||this._type!=this.properties.type)&&this.fetchFile(t),this.setOutputData(0,this._data)}fetchFile(t){var e=this;if(!t||t.constructor!==String){e._data=null,e.boxcolor=null;return}this._url=t,this._type=this.properties.type,t.substr(0,4)=="http"&&i.proxy&&(t=i.proxy+t.substr(t.indexOf(":")+3)),fetch(t).then(function(s){if(!s.ok)throw new Error("File not found");if(e.properties.type=="arraybuffer")return s.arrayBuffer();if(e.properties.type=="text")return s.text();if(e.properties.type=="json")return s.json();if(e.properties.type=="blob")return s.blob()}).then(function(s){e._data=s,e.boxcolor="#AEA"}).catch(s=>{var r;e._data=null,e.boxcolor="red",(r=console.error)==null||r.call(console,"error fetching file:",t)})}onDropFile(t){var e=this;this._url=t.name,this._type=this.properties.type,this.properties.url=t.name;var s=new FileReader;if(s.onload=function(r){e.boxcolor="#AEA";var o=r.target.result;e.properties.type=="json"&&(o=JSON.parse(o)),e._data=o},e.properties.type=="arraybuffer")s.readAsArrayBuffer(t);else if(e.properties.type=="text"||e.properties.type=="json")s.readAsText(t);else if(e.properties.type=="blob")return s.readAsBinaryString(t)}}a(w,"title","Const File"),a(w,"desc","Fetches a file from an url"),a(w,"@type",{type:"enum",values:["text","arraybuffer","blob","json"]}),w.prototype.setValue=c.prototype.setValue,i.registerNodeType("basic/file",w);class Y{constructor(){this.addInput("parse",i.ACTION),this.addInput("json","string"),this.addOutput("done",i.EVENT),this.addOutput("object","object"),this.widget=this.addWidget("button","parse","",this.parse.bind(this)),this._str=null,this._obj=null}parse(){if(this._str)try{this._str=this.getInputData(1),this._obj=JSON.parse(this._str),this.boxcolor="#AEA",this.triggerSlot(0)}catch{this.boxcolor="red"}}onExecute(){this._str=this.getInputData(1),this.setOutputData(1,this._obj)}onAction(t){t=="parse"&&this.parse()}}a(Y,"title","JSON Parse"),a(Y,"desc","Parses JSON String into object"),i.registerNodeType("basic/jsonparse",Y);class C{constructor(){this.addOutput("data","object"),this.addProperty("value",""),this.widget=this.addWidget("text","json","","value"),this.widgets_up=!0,this.size=[140,30],this._value=null}onPropertyChanged(t,e){if(this.widget.value=e,!(e==null||e==""))try{this._value=JSON.parse(e),this.boxcolor="#AEA"}catch{this.boxcolor="red"}}onExecute(){this.setOutputData(0,this._value)}}a(C,"title","Const Data"),a(C,"desc","Constant Data"),C.prototype.setValue=c.prototype.setValue,i.registerNodeType("basic/data",C);class F{constructor(){this._value=[],this.addInput("json",""),this.addOutput("arrayOut","array"),this.addOutput("length","number"),this.addProperty("value","[]"),this.widget=this.addWidget("text","array",this.properties.value,"value"),this.widgets_up=!0,this.size=[140,50]}onPropertyChanged(t,e){if(this.widget.value=e,!(e==null||e==""))try{e[0]!="["?this._value=JSON.parse("["+e+"]"):this._value=JSON.parse(e),this.boxcolor="#AEA"}catch{this.boxcolor="red"}}onExecute(){var t=this.getInputData(0);if(t&&t.length){this._value||(this._value=new Array),this._value.length=t.length;for(var e=0;e<t.length;++e)this._value[e]=t[e];this.changeOutputType("arrayOut","array")}this.setOutputData(0,this._value),this.setOutputData(1,this._value&&this._value.length||0)}}a(F,"title","Const Array"),a(F,"desc","Constant Array"),F.prototype.setValue=c.prototype.setValue,i.registerNodeType("basic/array",F);class X{constructor(){this.addInput("arr","array"),this.addOutput("length","number")}onExecute(){var t,e=this.getInputData(0);e&&(["array","object"].includes(typeof e)&&typeof e.length!="undefined"?this.setOutputData(0,e.length):((t=console.debug)==null||t.call(console,"Not an array or object",typeof e,e),this.setOutputData(0,null)))}}a(X,"title","aLength"),a(X,"desc","Get the length of an array"),i.registerNodeType("basic/array_length",X);class J{constructor(){this.addInput("arr","array"),this.addInput("value",""),this.addOutput("arr","array"),this.properties={index:0},this.widget=this.addWidget("number","i",this.properties.index,"index",{precision:0,step:10,min:0})}onExecute(){var t=this.getInputData(0);if(t){var e=this.getInputData(1);e!==void 0&&(this.properties.index&&(t[Math.floor(this.properties.index)]=e),this.setOutputData(0,t))}}}a(J,"title","Set Array"),a(J,"desc","Sets index of array"),i.registerNodeType("basic/set_array",J);class ${constructor(){this.addInput("array","array,table,string"),this.addInput("index","number"),this.addOutput("value",""),this.addProperty("index",0)}onExecute(){var t=this.getInputData(0),e=this.getInputData(1);e==null&&(e=this.properties.index),!(t==null||e==null)&&this.setOutputData(0,t[Math.floor(Number(e))])}}a($,"title","Array[i]"),a($,"desc","Returns an element from an array"),i.registerNodeType("basic/array[]",$);class K{constructor(){this.addInput("table","table"),this.addInput("row","number"),this.addInput("col","number"),this.addOutput("value",""),this.addProperty("row",0),this.addProperty("column",0)}onExecute(){var t=this.getInputData(0),e=this.getInputData(1),s=this.getInputData(2);e==null&&(e=this.properties.row),s==null&&(s=this.properties.column),!(t==null||e==null||s==null)&&(e=t[Math.floor(Number(e))],e?this.setOutputData(0,e[Math.floor(Number(s))]):this.setOutputData(0,null))}}a(K,"title","Table[row][col]"),a(K,"desc","Returns an element from a table"),i.registerNodeType("basic/table[][]",K);class Z{constructor(){this.addInput("obj","object"),this.addOutput("property",0),this.addProperty("value",0),this.widget=this.addWidget("text","prop.","",this.setValue.bind(this)),this.widgets_up=!0,this.size=[140,30],this._value=null}setValue(t){this.properties.value=t,this.widget.value=t}getTitle(){return this.flags.collapsed?"in."+this.properties.value:this.title}onPropertyChanged(t,e){this.widget.value=e}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,t[this.properties.value])}}a(Z,"title","Object property"),a(Z,"desc","Outputs the property of an object"),i.registerNodeType("basic/object_property",Z);class Q{constructor(){this.addInput("obj",""),this.addOutput("keys","array"),this.size=[140,30]}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,Object.keys(t))}}a(Q,"title","Object keys"),a(Q,"desc","Outputs an array with the keys of an object"),i.registerNodeType("basic/object_keys",Q);class tt{constructor(){this.addInput("obj",""),this.addInput("value",""),this.addOutput("obj",""),this.properties={property:""},this.name_widget=this.addWidget("text","prop.",this.properties.property,"property")}onExecute(){var t=this.getInputData(0);if(t){var e=this.getInputData(1);e!==void 0&&(this.properties.property&&(t[this.properties.property]=e),this.setOutputData(0,t))}}}a(tt,"title","Set Object"),a(tt,"desc","Adds propertiesrty to object"),i.registerNodeType("basic/set_object",tt);class et{constructor(){this.addInput("A","object"),this.addInput("B","object"),this.addOutput("out","object"),this._result={};var t=this;this.addWidget("button","clear","",function(){t._result={}}),this.size=this.computeSize()}onExecute(){var t=this.getInputData(0),e=this.getInputData(1),s=this._result;if(t)for(let r in t)s[r]=t[r];if(e)for(let r in e)s[r]=e[r];this.setOutputData(0,s)}}a(et,"title","Merge Objects"),a(et,"desc","Creates an object copying properties from others"),i.registerNodeType("basic/merge_objects",et);const st=class H{constructor(){this.size=[60,30],this.addInput("in"),this.addOutput("out"),this.properties={varname:"myname",container:H.LITEGRAPH},this.value=null}onExecute(){var t=this.getContainer();if(this.isInputConnected(0)){this.value=this.getInputData(0),t[this.properties.varname]=this.value,this.setOutputData(0,this.value);return}this.setOutputData(0,t[this.properties.varname])}getContainer(){switch(this.properties.container){case H.GRAPH:return this.graph?this.graph.vars:{};case H.GLOBALSCOPE:return globalThis;default:return i.Globals}}getTitle(){return this.properties.varname}};a(st,"title","Variable"),a(st,"desc","store/read variable value");let b=st;b.LITEGRAPH=0,b.GRAPH=1,b.GLOBALSCOPE=2,b["@container"]={type:"enum",values:{litegraph:b.LITEGRAPH,graph:b.GRAPH,global:b.GLOBALSCOPE}},i.registerNodeType("basic/variable",b);function _e(n){return n&&n.length!=null?Number(n.length):0}i.wrapFunctionAsNode("basic/length",_e,[""],"number"),i.wrapFunctionAsNode("basic/not",function(n){return!n},[""],"boolean");class it{constructor(){this.size=[60,30],this.addInput("data",0),this.addInput("download",i.ACTION),this.properties={filename:"data.json"},this.value=null;var t=this;this.addWidget("button","Download","",()=>{t.value&&t.downloadAsFile()})}downloadAsFile(){if(this.value!=null){var t=null;this.value.constructor===String?t=this.value:t=JSON.stringify(this.value);var e=new Blob([t]),s=URL.createObjectURL(e),r=document.createElement("a");r.setAttribute("href",s),r.setAttribute("download",this.properties.filename),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),setTimeout(function(){URL.revokeObjectURL(s)},1e3*60)}}onAction(){var t=this;setTimeout(function(){t.downloadAsFile()},100)}onExecute(){this.inputs[0]&&(this.value=this.getInputData(0))}getTitle(){return this.flags.collapsed?this.properties.filename:this.title}}a(it,"title","Download"),a(it,"desc","Download some data"),i.registerNodeType("basic/download",it);const rt=class ue{constructor(){this.size=[60,30],this.addInput("value",0,{label:""}),this.value=0}onExecute(){this.inputs[0]&&(this.value=this.getInputData(0))}getTitle(){return this.flags.collapsed?this.inputs[0].label:this.title}static toString(t){if(t==null)return"null";if(t.constructor===Number)return t.toFixed(3);if(t.constructor===Array){for(var e="[",s=0;s<t.length;++s)e+=ue.toString(t[s])+(s+1!=t.length?",":"");return e+="]",e}else return String(t)}onDrawBackground(){this.inputs[0].label=ue.toString(this.value)}};a(rt,"title","Watch"),a(rt,"desc","Show value of input");let fe=rt;i.registerNodeType("basic/watch",fe);class at{constructor(){this.addInput("in",0),this.addOutput("out",0),this.size=[40,30]}onExecute(){this.setOutputData(0,this.getInputData(0))}}a(at,"title","Cast"),a(at,"desc","Allows to connect different types"),i.registerNodeType("basic/cast",at);class ot{constructor(){this.mode=i.ON_EVENT,this.size=[80,30],this.addProperty("msg",""),this.addInput("log",i.EVENT),this.addInput("msg",0)}onAction(t,e){var s,r,o,u=this.getInputData(1);u||(u=this.properties.msg),u||(u="Event: "+e),t=="log"?(s=console.log)==null||s.call(console,u):t=="warn"?(r=console.warn)==null||r.call(console,u):t=="error"&&((o=console.error)==null||o.call(console,u))}onExecute(){var t,e=this.getInputData(1);e||(e=this.properties.msg),e!=null&&typeof e!="undefined"&&(this.properties.msg=e,(t=console.log)==null||t.call(console,e))}onGetInputs(){return[["log",i.ACTION],["warn",i.ACTION],["error",i.ACTION]]}}a(ot,"title","Console"),a(ot,"desc","Show value inside the console"),i.registerNodeType("basic/console",ot);class B{constructor(){this.mode=i.ON_EVENT,this.addProperty("msg",""),this.addInput("",i.EVENT),this.widget=this.addWidget("text","Text","","msg"),this.widgets_up=!0,this.size=[200,30]}onConfigure(t){this.widget.value=t.properties.msg}onAction(){var t=this.properties.msg;setTimeout(function(){alert(t)},10)}}a(B,"title","Alert"),a(B,"desc","Show an alert window"),a(B,"color","#510"),i.registerNodeType("basic/alert",B);class V{constructor(){this.size=[60,30],this.addProperty("onExecute","return A;"),this.addInput("A",0),this.addInput("B",0),this.addOutput("out",0),this._func=null,this.data={}}onConfigure(t){var e;t.properties.onExecute&&i.allow_scripts?this.compileCode(t.properties.onExecute):(e=console.warn)==null||e.call(console,"Script not compiled, LiteGraph.allow_scripts is false")}onPropertyChanged(t,e){var s;t=="onExecute"&&i.allow_scripts?this.compileCode(e):(s=console.warn)==null||s.call(console,"Script not compiled, LiteGraph.allow_scripts is false")}compileCode(t){var e,s,r,o;if(this._func=null,t.length>256)(e=console.warn)==null||e.call(console,"Script too long, max 256 chars");else{for(var u=t.toLowerCase(),h=["script","body","document","eval","nodescript","function"],p=0;p<h.length;++p)if(u.indexOf(h[p])!=-1){(s=console.warn)==null||s.call(console,"invalid script");return}try{this._func=new Function("A","B","C","DATA","node",t)}catch(d){(r=console.error)==null||r.call(console,"Error parsing script"),(o=console.error)==null||o.call(console,d)}}}onExecute(){var t,e;if(this._func)try{var s=this.getInputData(0),r=this.getInputData(1),o=this.getInputData(2);this.setOutputData(0,this._func(s,r,o,this.data,this))}catch(u){(t=console.error)==null||t.call(console,"Error in script"),(e=console.error)==null||e.call(console,u)}}onGetOutputs(){return[["C",""]]}}a(V,"title","Script"),a(V,"desc","executes a code (max 256 characters)"),a(V,"widgets_info",{onExecute:{type:"code"}}),i.registerNodeType("basic/script",V);const f=class he{constructor(){this.addInput("A",0),this.addInput("B",0),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","==","enum",{values:he.values}),this.addWidget("combo","Op.",this.properties.OP,{property:"OP",values:he.values}),this.size=[80,60]}getTitle(){return"*A "+this.properties.OP+" *B"}onExecute(){var t=this.getInputData(0);t===void 0?t=this.properties.A:this.properties.A=t;var e=this.getInputData(1);e===void 0?e=this.properties.B:this.properties.B=e;var s=!1;if(typeof t==typeof e)switch(this.properties.OP){case"==":case"!=":switch(s=!0,typeof t){case"object":var r=Object.getOwnPropertyNames(t),o=Object.getOwnPropertyNames(e);if(r.length!=o.length){s=!1;break}for(var u=0;u<r.length;u++){var h=r[u];if(t[h]!==e[h]){s=!1;break}}break;default:s=t==e}this.properties.OP=="!="&&(s=!s);break}this.setOutputData(0,s),this.setOutputData(1,!s)}};a(f,"title","Compare *"),a(f,"desc","evaluates condition between A and B"),a(f,"values",["==","!="]),a(f,"@OP",{type:"enum",title:"operation",values:f.values});let ye=f;i.registerNodeType("basic/CompareValues",ye);class nt{constructor(){this.size=[60,30],this.addInput("event",i.ACTION)}onAction(t,e){var s;(s=console.log)==null||s.call(console,t,e)}}a(nt,"title","Log Event"),a(nt,"desc","Log event in console"),i.registerNodeType("events/log",nt);class ut{constructor(){this.size=[60,30],this.addInput("if",""),this.addOutput("true",i.EVENT),this.addOutput("change",i.EVENT),this.addOutput("false",i.EVENT),this.properties={only_on_change:!0,tooltip:"Triggers event if input evaluates to true"},this.prev=0}onExecute(t,e){var s=this.getInputData(0),r=s!=this.prev;this.prev===0&&(r=!1);var o=r&&this.properties.only_on_change||!r&&!this.properties.only_on_change;s&&o&&this.triggerSlot(0,t,null,e),!s&&o&&this.triggerSlot(2,t,null,e),r&&this.triggerSlot(1,t,null,e),this.prev=s}}a(ut,"title","TriggerEvent"),a(ut,"desc","Triggers event if input evaluates to true"),i.registerNodeType("events/trigger",ut);var G;let xe=(G=class{constructor(){var n=this;this.addInput("in_1",i.ACTION),this.addInput("in_2",i.ACTION),this.addInput("in_3",i.ACTION),this.addOutput("out_1",i.EVENT),this.addOutput("out_2",i.EVENT),this.addOutput("out_3",i.EVENT),this.addWidget("button","+",null,function(){var t;const e=(((t=n.outputs)==null?void 0:t.length)||0)+1;n.addInput(`in_${e}`,i.ACTION),n.addOutput(`out_${e}`,i.EVENT)}),this.size=[90,70],this.flags={horizontal:!0,render_box:!1}}getTitle(){return""}onAction(n,t,e){if(this.outputs){e=e||{};for(var s=0;s<this.outputs.length;++s)e.action_call?e.action_call=e.action_call+"_seq_"+s:e.action_call=this.id+"_"+(n||"action")+"_seq_"+s+"_"+Math.floor(Math.random()*9999),this.triggerSlot(s,t,null,e)}}},a(G,"title","Sequence"),a(G,"desc","Triggers a sequence of events when an event arrives"),G);i.registerNodeType("events/sequence",xe);class ht{constructor(){var t=this;this.addInput("",i.ACTION),this.addInput("",i.ACTION),this.addOutput("",i.EVENT),this.addWidget("button","+",null,function(){t.addInput("",i.ACTION),t.size[0]=90}),this.size=[90,70],this.ready=[]}getTitle(){return""}onDrawBackground(t){if(!this.flags.collapsed)for(var e=0;e<this.inputs.length;++e){var s=e*i.NODE_SLOT_HEIGHT+10;t.fillStyle=this.ready[e]?"#AFB":"#000",t.fillRect(20,s,10,10)}}onAction(t,e,s,r){if(r!=null){this.ready.length=this.outputs.length,this.ready[r]=!0;for(var o=0;o<this.ready.length;++o)if(!this.ready[o])return;this.reset(),this.triggerSlot(0)}}reset(){this.ready.length=0}}a(ht,"title","WaitAll"),a(ht,"desc","Wait until all input events arrive then triggers output"),i.registerNodeType("events/waitAll",ht);class pt{constructor(){var t=this;this.properties={index:0},this.addInput("index","number"),this.addInput("step",i.ACTION),this.addInput("reset",i.ACTION),this.addOutput("index","number"),this.addOutput("",i.EVENT),this.addOutput("",i.EVENT),this.addOutput("",i.EVENT,{removable:!0}),this.addWidget("button","+",null,function(){t.addOutput("",i.EVENT,{removable:!0})}),this.size=[120,120],this.flags={render_box:!1}}onDrawBackground(t){if(!this.flags.collapsed){var e=this.properties.index||0;t.fillStyle="#AFB";var s=this.size[0],r=(e+1)*i.NODE_SLOT_HEIGHT+4;t.beginPath(),t.moveTo(s-30,r),t.lineTo(s-30,r+i.NODE_SLOT_HEIGHT),t.lineTo(s-15,r+i.NODE_SLOT_HEIGHT*.5),t.fill()}}onExecute(){var t=this.getInputData(0);t!=null&&(t=Math.floor(t),t=i.clamp(t,0,this.outputs?this.outputs.length-2:0),t!=this.properties.index&&(this.properties.index=t,this.triggerSlot(t+1))),this.setOutputData(0,this.properties.index)}onAction(t,e){if(t=="reset")this.properties.index=0;else if(t=="step"){this.triggerSlot(this.properties.index+1,e);var s=this.outputs?this.outputs.length-1:0;this.properties.index=(this.properties.index+1)%s}}}a(pt,"title","Stepper"),a(pt,"desc","Trigger events sequentially when an tick arrives"),i.registerNodeType("events/stepper",pt);class lt{constructor(){this.size=[60,30],this.addInput("event",i.ACTION),this.addOutput("event",i.EVENT),this.properties={equal_to:"",has_property:"",property_equal_to:""}}onAction(t,e,s){if(e!=null&&!(this.properties.equal_to&&this.properties.equal_to!=e)){if(this.properties.has_property){var r=e[this.properties.has_property];if(r==null||this.properties.property_equal_to&&this.properties.property_equal_to!=r)return}this.triggerSlot(0,e,null,s)}}}a(lt,"title","Filter Event"),a(lt,"desc","Blocks events that do not match the filter"),i.registerNodeType("events/filter",lt);class dt{constructor(){this.addInput("in",i.ACTION),this.addInput("cond","boolean"),this.addOutput("true",i.EVENT),this.addOutput("false",i.EVENT),this.size=[120,60],this._value=!1}onExecute(){this._value=this.getInputData(1)}onAction(t,e,s){this._value=this.getInputData(1),this.triggerSlot(this._value?0:1,e,null,s)}}a(dt,"title","Branch"),a(dt,"desc","If condition is true, outputs triggers true, otherwise false"),i.registerNodeType("events/branch",dt);class ct{constructor(){this.addInput("inc",i.ACTION),this.addInput("dec",i.ACTION),this.addInput("reset",i.ACTION),this.addOutput("change",i.EVENT),this.addOutput("num","number"),this.addProperty("doCountExecution",!1,"boolean",{name:"Count Executions"}),this.addWidget("toggle","Count Exec.",this.properties.doCountExecution,"doCountExecution"),this.num=0}getTitle(){return this.flags.collapsed?String(this.num):this.title}onAction(t){var e=this.num;t=="inc"?this.num+=1:t=="dec"?this.num-=1:t=="reset"&&(this.num=0),this.num!=e&&this.trigger("change",this.num)}onDrawBackground(t){this.flags.collapsed||(t.fillStyle="#AAA",t.font="20px Arial",t.textAlign="center",t.fillText(this.num,this.size[0]*.5,this.size[1]*.5))}onExecute(){this.properties.doCountExecution&&(this.num+=1),this.setOutputData(1,this.num)}}a(ct,"title","Counter"),a(ct,"desc","Counts events"),i.registerNodeType("events/counter",ct);class gt{constructor(){this.size=[60,30],this.addProperty("time_in_ms",1e3),this.addInput("event",i.ACTION),this.addOutput("on_time",i.EVENT),this._pending=[]}onAction(t,e,s){var r=this.properties.time_in_ms;r<=0?this.trigger(null,e,s):this._pending.push([r,e])}onExecute(t,e){var s=this.graph.elapsed_time*1e3;this.isInputConnected(1)&&(this.properties.time_in_ms=this.getInputData(1));for(var r=0;r<this._pending.length;++r){var o=this._pending[r];o[0]-=s,!(o[0]>0)&&(this._pending.splice(r,1),--r,this.trigger(null,o[1],e))}}onGetInputs(){return[["event",i.ACTION],["time_in_ms","number"]]}}a(gt,"title","Delay"),a(gt,"desc","Delays one event"),i.registerNodeType("events/delay",gt);const bt=class pe{constructor(){this.addProperty("interval",1e3),this.addProperty("event","tick"),this.addOutput("on_tick",i.EVENT),this.time=0,this.last_interval=1e3,this.triggered=!1}onStart(){this.time=0}getTitle(){return"Timer: "+this.last_interval.toString()+"ms"}onDrawBackground(){this.boxcolor=this.triggered?pe.on_color:pe.off_color,this.triggered=!1}onExecute(){var t=this.graph.elapsed_time*1e3,e=this.time==0;if(this.time+=t,this.last_interval=Math.max(1,this.getInputOrProperty("interval")|0),!e&&(this.time<this.last_interval||isNaN(this.last_interval))){this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!1);return}this.triggered=!0,this.time=this.time%this.last_interval,this.trigger("on_tick",this.properties.event),this.inputs&&this.inputs.length>1&&this.inputs[1]&&this.setOutputData(1,!0)}onGetInputs(){return[["interval","number"]]}onGetOutputs(){return[["tick","boolean"]]}};a(bt,"title","Timer"),a(bt,"desc","Sends an event every N milliseconds");let vt=bt;vt.on_color="#AAA",vt.off_color="#222",i.registerNodeType("events/timer",vt);class mt{constructor(){this.addInput("go",i.ACTION),this.addInput("green",i.ACTION),this.addInput("red",i.ACTION),this.addOutput("continue",i.EVENT),this.addOutput("blocked",i.EVENT),this.addOutput("is_green","boolean"),this._ready=!1,this.properties={};var t=this;this.addWidget("button","reset","",function(){t._ready=!1})}onExecute(){this.setOutputData(1,this._ready),this.boxcolor=this._ready?"#9F9":"#FA5"}onAction(t){t=="go"?this.triggerSlot(this._ready?0:1):t=="green"?this._ready=!0:t=="red"&&(this._ready=!1)}}a(mt,"title","Semaphore Event"),a(mt,"desc","Until both events are not triggered, it doesnt continue."),i.registerNodeType("events/semaphore",mt);class _t{constructor(){this.addInput("in",i.ACTION),this.addInput("reset",i.ACTION),this.addOutput("out",i.EVENT),this._once=!1,this.properties={};var t=this;this.addWidget("button","reset","",function(){t._once=!1})}onAction(t,e){t=="in"&&!this._once?(this._once=!0,this.triggerSlot(0,e)):t=="reset"&&(this._once=!1)}}a(_t,"title","Once"),a(_t,"desc","Only passes an event once, then gets locked"),i.registerNodeType("events/once",_t);class ft{constructor(){this.addInput("data",0),this.addInput("assign",i.ACTION),this.addOutput("data",0),this._last_value=null,this.properties={data:null,serialize:!0};var t=this;this.addWidget("button","store","",function(){t.properties.data=t._last_value})}onExecute(){this._last_value=this.getInputData(0),this.setOutputData(0,this.properties.data)}onAction(){this.properties.data=this._last_value}onSerialize(t){t.data!=null&&(!this.properties.serialize||t.data.constructor!==String&&t.data.constructor!==Number&&t.data.constructor!==Boolean&&t.data.constructor!==Array&&t.data.constructor!==Object)&&(t.data=null)}}a(ft,"title","Data Store"),a(ft,"desc","Stores data and only changes when event is received"),i.registerNodeType("basic/data_store",ft);const M=class be{constructor(){this.addOutput("",i.EVENT),this.addOutput("","boolean"),this.addProperty("text","DO"),this.addProperty("font_size",30),this.addProperty("message",""),this.size=[84,84],this.clicked=!1}onDrawForeground(t){if(!this.flags.collapsed){var e=10;if(t.fillStyle="black",t.fillRect(e+1,e+1,this.size[0]-e*2,this.size[1]-e*2),t.fillStyle="#AAF",t.fillRect(e-1,e-1,this.size[0]-e*2,this.size[1]-e*2),t.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",t.fillRect(e,e,this.size[0]-e*2,this.size[1]-e*2),this.properties.text||this.properties.text===0){var s=this.properties.font_size||30;t.textAlign="center",t.fillStyle=this.clicked?"black":"white",t.font=s+"px "+be.font,t.fillText(this.properties.text,this.size[0]*.5,this.size[1]*.5+s*.3),t.textAlign="left"}}}onMouseDown(t,e){if(e[0]>1&&e[1]>1&&e[0]<this.size[0]-2&&e[1]<this.size[1]-2)return this.clicked=!0,this.setOutputData(1,this.clicked),this.triggerSlot(0,this.properties.message),!0}onExecute(){this.setOutputData(1,this.clicked)}onMouseUp(t){this.clicked=!1}};a(M,"title","Button"),a(M,"desc","Triggers an event"),a(M,"font","Arial");let Oe=M;i.registerNodeType("widget/button",Oe);class yt{constructor(){this.addInput("","boolean"),this.addInput("e",i.ACTION),this.addOutput("v","boolean"),this.addOutput("e",i.EVENT),this.properties={font:"",value:!1},this.size=[160,44]}onDrawForeground(t){if(!this.flags.collapsed){var e=this.size[1]*.5,s=.25,r=this.size[1]*.8;t.font=this.properties.font||(e*.8).toFixed(0)+"px Arial";var o=t.measureText(this.title).width,u=(this.size[0]-(o+e))*.5;t.fillStyle="#AAA",t.fillRect(u,r-e,e,e),t.fillStyle=this.properties.value?"#AEF":"#000",t.fillRect(u+e*s,r-e+e*s,e*(1-s*2),e*(1-s*2)),t.textAlign="left",t.fillStyle="#AAA",t.fillText(this.title,e*1.2+u,r*.85),t.textAlign="left"}}onAction(t){this.properties.value=!this.properties.value,this.trigger("e",this.properties.value)}onExecute(){var t=this.getInputData(0);t!=null&&(this.properties.value=t),this.setOutputData(0,this.properties.value)}onMouseDown(t,e){if(e[0]>1&&e[1]>1&&e[0]<this.size[0]-2&&e[1]<this.size[1]-2)return this.properties.value=!this.properties.value,this.graph._version++,this.trigger("e",this.properties.value),!0}}a(yt,"title","Toggle"),a(yt,"desc","Toggles between true or false"),i.registerNodeType("widget/toggle",yt);const N=class le{constructor(){this.addOutput("","number"),this.size=[80,60],this.properties={min:-1e3,max:1e3,value:1,step:1},this.old_y=-1,this._remainder=0,this._precision=0,this.mouse_captured=!1}onDrawForeground(t){var e=this.size[0]*.5,s=this.size[1];s>30?(t.fillStyle=le.markers_color,t.beginPath(),t.moveTo(e,s*.1),t.lineTo(e+s*.1,s*.2),t.lineTo(e+s*-.1,s*.2),t.fill(),t.beginPath(),t.moveTo(e,s*.9),t.lineTo(e+s*.1,s*.8),t.lineTo(e+s*-.1,s*.8),t.fill(),t.font=(s*.7).toFixed(1)+"px Arial"):t.font=(s*.8).toFixed(1)+"px Arial",t.textAlign="center",t.font=(s*.7).toFixed(1)+"px Arial",t.fillStyle="#EEE",t.fillText(this.properties.value.toFixed(this._precision),e,s*.75)}onExecute(){this.setOutputData(0,this.properties.value)}onPropertyChanged(t,e){var s=(this.properties.step+"").split(".");this._precision=s.length>1?s[1].length:0}onMouseDown(t,e){if(!(e[1]<0))return this.old_y=t.canvasY,this.captureInput(!0),this.mouse_captured=!0,!0}onMouseMove(t){if(this.mouse_captured){var e=this.old_y-t.canvasY;t.shiftKey&&(e*=10),(t.metaKey||t.altKey)&&(e*=.1),this.old_y=t.canvasY;var s=this._remainder+e/le.pixels_threshold;this._remainder=s%1,s=s|0;var r=i.clamp(this.properties.value+s*this.properties.step,this.properties.min,this.properties.max);this.properties.value=r,this.graph._version++,this.setDirtyCanvas(!0)}}onMouseUp(t,e){if(t.click_time<200){var s=e[1]>this.size[1]*.5?-1:1;this.properties.value=i.clamp(this.properties.value+s*this.properties.step,this.properties.min,this.properties.max),this.graph._version++,this.setDirtyCanvas(!0)}this.mouse_captured&&(this.mouse_captured=!1,this.captureInput(!1))}};a(N,"title","Number"),a(N,"desc","Widget to select number value"),a(N,"pixels_threshold",10),a(N,"markers_color","#666");let Ie=N;i.registerNodeType("widget/number",Ie);class xt{constructor(){this.addOutput("","string"),this.addOutput("change",i.EVENT),this.size=[80,60],this.properties={value:"A",values:"A;B;C"},this.old_y=-1,this.mouse_captured=!1,this._values=this.properties.values.split(";");var t=this;this.widgets_up=!0,this.widget=this.addWidget("combo","",this.properties.value,function(e){t.properties.value=e,t.triggerSlot(1,e)},{property:"value",values:this._values})}onExecute(){this.setOutputData(0,this.properties.value)}onPropertyChanged(t,e){t=="values"?(this._values=e.split(";"),this.widget.options.values=this._values):t=="value"&&(this.widget.value=e)}}a(xt,"title","Combo"),a(xt,"desc","Widget to select from a list"),i.registerNodeType("widget/combo",xt);class R{constructor(){this.addOutput("","number"),this.size=[64,84],this.properties={min:0,max:1,value:.5,color:"#7AF",precision:2},this.value=-1}onDrawForeground(t){if(!this.flags.collapsed){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min));var e=this.size[0]*.5,s=this.size[1]*.5,r=Math.min(this.size[0],this.size[1])*.5-5;t.globalAlpha=1,t.save(),t.translate(e,s),t.rotate(Math.PI*.75),t.fillStyle="rgba(0,0,0,0.5)",t.beginPath(),t.moveTo(0,0),t.arc(0,0,r,0,Math.PI*1.5),t.fill(),t.strokeStyle="black",t.fillStyle=this.properties.color,t.lineWidth=2,t.beginPath(),t.moveTo(0,0),t.arc(0,0,r-4,0,Math.PI*1.5*Math.max(.01,this.value)),t.closePath(),t.fill(),t.lineWidth=1,t.globalAlpha=1,t.restore(),t.fillStyle="black",t.beginPath(),t.arc(e,s,r*.75,0,Math.PI*2,!0),t.fill(),t.fillStyle=this.mouseOver?"white":this.properties.color,t.beginPath();var o=this.value*Math.PI*1.5+Math.PI*.75;t.arc(e+Math.cos(o)*r*.65,s+Math.sin(o)*r*.65,r*.05,0,Math.PI*2,!0),t.fill(),t.fillStyle=this.mouseOver?"white":"#AAA",t.font=Math.floor(r*.5)+"px Arial",t.textAlign="center",t.fillText(this.properties.value.toFixed(this.properties.precision),e,s+r*.15)}}onExecute(){this.setOutputData(0,this.properties.value),this.boxcolor=i.colorToString([this.value,this.value,this.value])}onMouseDown(t){return this.center=[this.size[0]*.5,this.size[1]*.5+20],this.radius=this.size[0]*.5,t.canvasY-this.pos[1]<20||i.distance([t.canvasX,t.canvasY],[this.pos[0]+this.center[0],this.pos[1]+this.center[1]])>this.radius?!1:(this.oldmouse=[t.canvasX-this.pos[0],t.canvasY-this.pos[1]],this.captureInput(!0),!0)}onMouseMove(t){if(this.oldmouse){var e=[t.canvasX-this.pos[0],t.canvasY-this.pos[1]],s=this.value;s-=(e[1]-this.oldmouse[1])*.01,s>1?s=1:s<0&&(s=0),this.value=s,this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.oldmouse=e,this.setDirtyCanvas(!0)}}onMouseUp(t){this.oldmouse&&(this.oldmouse=null,this.captureInput(!1))}onPropertyChanged(t,e){if(t=="min"||t=="max"||t=="value")return this.properties[t]=parseFloat(e),!0}}a(R,"title","Knob"),a(R,"desc","Circular controller"),a(R,"size",[80,100]),i.registerNodeType("widget/knob",R);class ge{constructor(){this.addOutput("","number"),this.properties={value:.5,min:0,max:1,text:"V"};var t=this;this.size=[140,40],this.slider=this.addWidget("slider","V",this.properties.value,function(e){t.properties.value=e},this.properties),this.widgets_up=!0}onPropertyChanged(t,e){t=="value"&&(this.slider.value=e)}onExecute(){this.setOutputData(0,this.properties.value)}}a(ge,"title","Inner Slider"),i.registerNodeType("widget/internal_slider",ge);class Ot{constructor(){this.size=[160,26],this.addOutput("","number"),this.properties={color:"#7AF",min:0,max:1,value:.5},this.value=-1}onDrawForeground(t){this.value==-1&&(this.value=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min)),t.globalAlpha=1,t.lineWidth=1,t.fillStyle="#000",t.fillRect(2,2,this.size[0]-4,this.size[1]-4),t.fillStyle=this.properties.color,t.beginPath(),t.rect(4,4,(this.size[0]-8)*this.value,this.size[1]-8),t.fill()}onExecute(){this.properties.value=this.properties.min+(this.properties.max-this.properties.min)*this.value,this.setOutputData(0,this.properties.value),this.boxcolor=i.colorToString([this.value,this.value,this.value])}onMouseDown(t){return t.canvasY-this.pos[1]<0?!1:(this.oldmouse=[t.canvasX-this.pos[0],t.canvasY-this.pos[1]],this.captureInput(!0),!0)}onMouseMove(t){if(this.oldmouse){var e=[t.canvasX-this.pos[0],t.canvasY-this.pos[1]],s=this.value,r=e[0]-this.oldmouse[0];s+=r/this.size[0],s>1?s=1:s<0&&(s=0),this.value=s,this.oldmouse=e,this.setDirtyCanvas(!0)}}onMouseUp(t){this.oldmouse=null,this.captureInput(!1)}}a(Ot,"title","H.Slider"),a(Ot,"desc","Linear slider controller"),i.registerNodeType("widget/hslider",Ot);class It{constructor(){this.size=[160,26],this.addInput("","number"),this.properties={min:0,max:1,value:0,color:"#AAF"}}onExecute(){var t=this.getInputData(0);t!=null&&(this.properties.value=t)}onDrawForeground(t){t.lineWidth=1,t.fillStyle=this.properties.color;var e=(this.properties.value-this.properties.min)/(this.properties.max-this.properties.min);e=Math.min(1,e),e=Math.max(0,e),t.fillRect(2,2,(this.size[0]-4)*e,this.size[1]-4)}}a(It,"title","Progress"),a(It,"desc","Shows data in linear progress"),i.registerNodeType("widget/progress",It);class j{constructor(){this.addInputs("",0),this.properties={value:"...",font:"Arial",fontsize:18,color:"#AAA",align:"left",glowSize:0,decimals:1}}onDrawForeground(t){t.fillStyle=this.properties.color;var e=this.properties.value;this.properties.glowSize?(t.shadowColor=this.properties.color,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=this.properties.glowSize):t.shadowColor="transparent";var s=this.properties.fontsize;if(t.textAlign=this.properties.align,t.font=s.toString()+"px "+this.properties.font,this.str=typeof e=="number"?e.toFixed(this.properties.decimals):e,typeof this.str=="string"){const r=this.str.replace(/[\r\n]/g,"\\n").split("\\n"),o=Math.max(0,this.size[0]-30),u=[];for(let d=0;d<r.length;d++){const O=r[d];if(t.measureText(O).width<=o){u.push(O);continue}const S=O.split(" ");let g="";for(let I=0;I<S.length;I++){const ce=g?`${g} ${S[I]}`:S[I];if(t.measureText(ce).width<=o){g=ce;continue}g&&u.push(g),g=S[I]}g&&u.push(g)}const h=u.length?u:[this.str],p=Math.max(1,Math.floor((this.size[1]-4)/s));for(let d=0;d<Math.min(h.length,p);d++)t.fillText(h[d],this.properties.align=="left"?15:this.properties.align=="center"?this.size[0]*.5:this.size[0]-15,s*-.15+s*(parseInt(d)+1));this.str=h.join("\\n")}t.shadowColor="transparent",this.last_ctx=t,t.textAlign="left"}onExecute(){var t=this.getInputData(0);t!=null&&(this.properties.value=t)}resize(){if(this.last_ctx){var t=this.str.split("\\n");this.last_ctx.font=this.properties.fontsize+"px "+this.properties.font;for(var e=0,s=0;s<t.length;s++){var r=this.last_ctx.measureText(t[s]).width;e<r&&(e=r)}this.size[0]=e+20,this.size[1]=4+t.length*this.properties.fontsize,this.setDirtyCanvas(!0)}}onPropertyChanged(t,e){return this.properties[t]=e,this.str=typeof e=="number"?e.toFixed(3):e,!0}}a(j,"title","Text"),a(j,"desc","Shows the input value"),a(j,"widgets",[{name:"resize",text:"Resize box",type:"button"},{name:"led_text",text:"LED",type:"minibutton"},{name:"normal_text",text:"Normal",type:"minibutton"}]),i.registerNodeType("widget/text",j);class Tt{constructor(){a(this,"widgets",[{name:"update",text:"Update",type:"button"}]),this.size=[200,100],this.properties={borderColor:"#ffffff",bgcolorTop:"#f0f0f0",bgcolorBottom:"#e0e0e0",shadowSize:2,borderRadius:3}}createGradient(t){if(this.properties.bgcolorTop==""||this.properties.bgcolorBottom==""){this.lineargradient=0;return}this.lineargradient=t.createLinearGradient(0,0,0,this.size[1]),this.lineargradient.addColorStop(0,this.properties.bgcolorTop),this.lineargradient.addColorStop(1,this.properties.bgcolorBottom)}onDrawForeground(t){this.flags.collapsed||(this.lineargradient==null&&this.createGradient(t),this.lineargradient&&(t.lineWidth=1,t.strokeStyle=this.properties.borderColor,t.fillStyle=this.lineargradient,this.properties.shadowSize?(t.shadowColor="#000",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=this.properties.shadowSize):t.shadowColor="transparent",t.roundRect(0,0,this.size[0]-1,this.size[1]-1,this.properties.shadowSize),t.fill(),t.shadowColor="transparent",t.stroke()))}}a(Tt,"title","Panel"),a(Tt,"desc","Non interactive panel"),i.registerNodeType("widget/panel",Tt);const _=class l{constructor(){this.addOutput("left_x_axis","number"),this.addOutput("left_y_axis","number"),this.addOutput("button_pressed",i.EVENT),this.properties={gamepad_index:0,threshold:.1},this._left_axis=new Float32Array(2),this._right_axis=new Float32Array(2),this._triggers=new Float32Array(2),this._previous_buttons=new Uint8Array(17),this._current_buttons=new Uint8Array(17)}onExecute(){var t=this.getGamepad(),e=this.properties.threshold||0;if(t&&(this._left_axis[0]=Math.abs(t.xbox.axes.lx)>e?t.xbox.axes.lx:0,this._left_axis[1]=Math.abs(t.xbox.axes.ly)>e?t.xbox.axes.ly:0,this._right_axis[0]=Math.abs(t.xbox.axes.rx)>e?t.xbox.axes.rx:0,this._right_axis[1]=Math.abs(t.xbox.axes.ry)>e?t.xbox.axes.ry:0,this._triggers[0]=Math.abs(t.xbox.axes.ltrigger)>e?t.xbox.axes.ltrigger:0,this._triggers[1]=Math.abs(t.xbox.axes.rtrigger)>e?t.xbox.axes.rtrigger:0),this.outputs)for(var s=0;s<this.outputs.length;s++){var r=this.outputs[s];if(!(!r.links||!r.links.length)){var o=null;if(t)switch(r.name){case"left_axis":o=this._left_axis;break;case"right_axis":o=this._right_axis;break;case"left_x_axis":o=this._left_axis[0];break;case"left_y_axis":o=this._left_axis[1];break;case"right_x_axis":o=this._right_axis[0];break;case"right_y_axis":o=this._right_axis[1];break;case"trigger_left":o=this._triggers[0];break;case"trigger_right":o=this._triggers[1];break;case"a_button":o=t.xbox.buttons.a?1:0;break;case"b_button":o=t.xbox.buttons.b?1:0;break;case"x_button":o=t.xbox.buttons.x?1:0;break;case"y_button":o=t.xbox.buttons.y?1:0;break;case"lb_button":o=t.xbox.buttons.lb?1:0;break;case"rb_button":o=t.xbox.buttons.rb?1:0;break;case"ls_button":o=t.xbox.buttons.ls?1:0;break;case"rs_button":o=t.xbox.buttons.rs?1:0;break;case"hat_left":o=t.xbox.hatmap&l.LEFT;break;case"hat_right":o=t.xbox.hatmap&l.RIGHT;break;case"hat_up":o=t.xbox.hatmap&l.UP;break;case"hat_down":o=t.xbox.hatmap&l.DOWN;break;case"hat":o=t.xbox.hatmap;break;case"start_button":o=t.xbox.buttons.start?1:0;break;case"back_button":o=t.xbox.buttons.back?1:0;break;case"button_pressed":for(var u=0;u<this._current_buttons.length;++u)this._current_buttons[u]&&!this._previous_buttons[u]&&this.triggerSlot(s,l.buttons[u]);break}else switch(r.name){case"button_pressed":break;case"left_axis":case"right_axis":o=l.zero;break;default:o=0}this.setOutputData(s,o)}}}getGamepad(){var t=navigator.getGamepads||navigator.webkitGetGamepads||navigator.mozGetGamepads;if(!t)return null;var e=t.call(navigator),s=null;this._previous_buttons.set(this._current_buttons);for(var r=this.properties.gamepad_index;r<4;r++)if(e[r]){s=e[r];var o=this.xbox_mapping;o||(o=this.xbox_mapping={axes:[],buttons:{},hat:"",hatmap:l.CENTER}),o.axes.lx=s.axes[0],o.axes.ly=s.axes[1],o.axes.rx=s.axes[2],o.axes.ry=s.axes[3],o.axes.ltrigger=s.buttons[6].value,o.axes.rtrigger=s.buttons[7].value,o.hat="",o.hatmap=l.CENTER;for(var u=0;u<s.buttons.length;u++)if(this._current_buttons[u]=s.buttons[u].pressed,u<12)o.buttons[l.mapping_array[u]]=s.buttons[u].pressed,s.buttons[u].was_pressed&&this.trigger(l.mapping_array[u]+"_button_event");else switch(u){case 12:s.buttons[u].pressed&&(o.hat+="up",o.hatmap|=l.UP);break;case 13:s.buttons[u].pressed&&(o.hat+="down",o.hatmap|=l.DOWN);break;case 14:s.buttons[u].pressed&&(o.hat+="left",o.hatmap|=l.LEFT);break;case 15:s.buttons[u].pressed&&(o.hat+="right",o.hatmap|=l.RIGHT);break;case 16:o.buttons.home=s.buttons[u].pressed;break}return s.xbox=o,s}}onDrawBackground(t){if(!this.flags.collapsed){var e=this._left_axis,s=this._right_axis;t.strokeStyle="#88A",t.strokeRect((e[0]+1)*.5*this.size[0]-4,(e[1]+1)*.5*this.size[1]-4,8,8),t.strokeStyle="#8A8",t.strokeRect((s[0]+1)*.5*this.size[0]-4,(s[1]+1)*.5*this.size[1]-4,8,8);var r=this.size[1]/this._current_buttons.length;t.fillStyle="#AEB";for(var o=0;o<this._current_buttons.length;++o)this._current_buttons[o]&&t.fillRect(0,r*o,6,r)}}onGetOutputs(){return[["left_axis","vec2"],["right_axis","vec2"],["left_x_axis","number"],["left_y_axis","number"],["right_x_axis","number"],["right_y_axis","number"],["trigger_left","number"],["trigger_right","number"],["a_button","number"],["b_button","number"],["x_button","number"],["y_button","number"],["lb_button","number"],["rb_button","number"],["ls_button","number"],["rs_button","number"],["start_button","number"],["back_button","number"],["a_button_event",i.EVENT],["b_button_event",i.EVENT],["x_button_event",i.EVENT],["y_button_event",i.EVENT],["lb_button_event",i.EVENT],["rb_button_event",i.EVENT],["ls_button_event",i.EVENT],["rs_button_event",i.EVENT],["start_button_event",i.EVENT],["back_button_event",i.EVENT],["hat_left","number"],["hat_right","number"],["hat_up","number"],["hat_down","number"],["hat","number"],["button_pressed",i.EVENT]]}};a(_,"title","Gamepad"),a(_,"desc","gets the input of the gamepad"),a(_,"zero",new Float32Array(2)),a(_,"buttons",["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs","home"]),a(_,"mapping",{a:0,b:1,x:2,y:3,lb:4,rb:5,lt:6,rt:7,back:8,start:9,ls:10,rs:11}),a(_,"mapping_array",["a","b","x","y","lb","rb","lt","rt","back","start","ls","rs"]);let y=_;y.CENTER=0,y.LEFT=1,y.RIGHT=2,y.UP=4,y.DOWN=8,i.registerNodeType("input/gamepad",y);class Et{constructor(){this.addInput("in",0),this.addOutput("out",0),this.size=[80,30]}onExecute(){var t=this.getInputData(0);if(t!=null&&this.outputs)for(var e=0;e<this.outputs.length;e++){var s=this.outputs[e];if(!(!s.links||!s.links.length)){var r=null;switch(s.name){case"number":r=t.length?t[0]:parseFloat(t);break;case"vec2":case"vec3":case"vec4":r=null;var o=1;switch(s.name){case"vec2":o=2;break;case"vec3":o=3;break;case"vec4":o=4;break}if(r=new Float32Array(o),t.length)for(var u=0;u<t.length&&u<r.length;u++)r[u]=t[u];else r[0]=parseFloat(t);break}this.setOutputData(e,r)}}}onGetOutputs(){return[["number","number"],["vec2","vec2"],["vec3","vec3"],["vec4","vec4"]]}}a(Et,"title","Converter"),a(Et,"desc","type A to type B"),i.registerNodeType("math/converter",Et);class Dt{constructor(){this.addInput("in"),this.addOutput("out"),this.size=[80,30]}onExecute(){var t=this.getInputData(0);this.setOutputData(0,t)}}a(Dt,"title","Bypass"),a(Dt,"desc","removes the type"),i.registerNodeType("math/bypass",Dt);class wt{constructor(){this.addInput("in"),this.addOutput("out")}onExecute(){var t=this.getInputData(0);this.setOutputData(0,Number(t))}}a(wt,"title","to Number"),a(wt,"desc","Cast to number"),i.registerNodeType("math/to_number",wt);class Nt{constructor(){this.addInput("in","number",{locked:!0}),this.addOutput("out","number",{locked:!0}),this.addOutput("clamped","number",{locked:!0}),this.addProperty("in",0),this.addProperty("in_min",0),this.addProperty("in_max",1),this.addProperty("out_min",0),this.addProperty("out_max",1),this.size=[120,50]}getTitle(){return this.flags.collapsed?(this._last_v||0).toFixed(2):this.title}onExecute(){let t;if(this.inputs)for(let u=0;u<this.inputs.length;u++){let h=this.inputs[u];t=this.getInputData(u),t!==void 0&&(this.properties[h.name]=t)}t=this.properties.in,(t==null||t.constructor!==Number)&&(t=0);var e=this.properties.in_min,s=this.properties.in_max,r=this.properties.out_min,o=this.properties.out_max;this._last_v=(t-e)/(s-e)*(o-r)+r,this.setOutputData(0,this._last_v),this.setOutputData(1,i.clamp(this._last_v,r,o))}onDrawBackground(t){this._last_v?this.outputs[0].label=this._last_v.toFixed(3):this.outputs[0].label="?"}onGetInputs(){return[["in_min","number"],["in_max","number"],["out_min","number"],["out_max","number"]]}}a(Nt,"title","Range"),a(Nt,"desc","Convert a number from one range to another"),i.registerNodeType("math/range",Nt);class At{constructor(){this.addOutput("value","number"),this.addProperty("min",0),this.addProperty("max",1),this.size=[80,30]}onExecute(){if(this.inputs)for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],s=this.getInputData(t);s!==void 0&&(this.properties[e.name]=s)}var r=this.properties.min,o=this.properties.max;this._last_v=Math.random()*(o-r)+r,this.setOutputData(0,this._last_v)}onDrawBackground(t){this.outputs[0].label=(this._last_v||0).toFixed(3)}onGetInputs(){return[["min","number"],["max","number"]]}}a(At,"title","Rand"),a(At,"desc","Random number"),i.registerNodeType("math/rand",At);const L=class m{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("min",0),this.addProperty("max",1),this.addProperty("smooth",!0),this.addProperty("seed",0),this.addProperty("octaves",1),this.addProperty("persistence",.8),this.addProperty("speed",1),this.size=[90,30]}static getValue(t,e){if(!m.data){m.data=new Float32Array(1024);for(var s=0;s<m.data.length;++s)m.data[s]=Math.random()}t=t%1024,t<0&&(t+=1024);var r=Math.floor(t);t-=r;var o=m.data[r],u=m.data[r==1023?0:r+1];return e&&(t=t*t*t*(t*(t*6-15)+10)),o*(1-t)+u*t}onExecute(){var t=this.getInputData(0)||0,e=this.properties.octaves||1,s=0,r=1,o=this.properties.seed||0;t+=o;for(var u=this.properties.speed||1,h=0,p=0;p<e&&(s+=m.getValue(t*(1+p)*u,this.properties.smooth)*r,h+=r,r*=this.properties.persistence,!(r<.001));++p);s/=h;var d=this.properties.min,O=this.properties.max;this._last_v=s*(O-d)+d,this.setOutputData(0,this._last_v)}onDrawBackground(t){this.outputs[0].label=(this._last_v||0).toFixed(3)}};a(L,"title","Noise"),a(L,"desc","Random number with temporal continuity"),a(L,"data",null);let Te=L;i.registerNodeType("math/noise",Te);class Ee{constructor(){this.addOutput("out","number"),this.addProperty("min_time",1),this.addProperty("max_time",2),this.addProperty("duration",.2),this.size=[90,30],this._remaining_time=0,this._blink_time=0}onExecute(){var t=this.graph.elapsed_time;this._remaining_time-=t,this._blink_time-=t;var e=0;if(this._blink_time>0){var s=this._blink_time/this.properties.duration;e=1/(Math.pow(s*8-4,4)+1)}this._remaining_time<0?(this._remaining_time=Math.random()*(this.properties.max_time-this.properties.min_time)+this.properties.min_time,this._blink_time=this.properties.duration,this.boxcolor="#FFF"):this.boxcolor="#000",this.setOutputData(0,e)}}i.registerNodeType("math/spikes",Ee);class St{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("min",0),this.addProperty("max",1)}onExecute(){var t=this.getInputData(0);t!=null&&(t=Math.max(this.properties.min,t),t=Math.min(this.properties.max,t),this.setOutputData(0,t))}getCode(){var t="";return this.isInputConnected(0)&&(t+="clamp({{0}},"+this.properties.min+","+this.properties.max+")"),t}}a(St,"title","Clamp"),a(St,"desc","Clamp number between min and max"),i.registerNodeType("math/clamp",St);class kt{constructor(){this.properties={f:.5},this.addInput("A","number"),this.addInput("B","number"),this.addOutput("out","number")}onExecute(){var t=this.getInputData(0);t==null&&(t=0);var e=this.getInputData(1);e==null&&(e=0);var s=this.properties.f,r=this.getInputData(2);r!==void 0&&(s=r),this.setOutputData(0,t*(1-s)+e*s)}onGetInputs(){return[["f","number"]]}}a(kt,"title","Lerp"),a(kt,"desc","Linear Interpolation"),i.registerNodeType("math/lerp",kt);class zt{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,Math.abs(t))}}a(zt,"title","Abs"),a(zt,"desc","Absolute"),i.registerNodeType("math/abs",zt);class Pt{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,Math.floor(t))}}a(Pt,"title","Floor"),a(Pt,"desc","Floor number to remove fractional part"),i.registerNodeType("math/floor",Pt);class Ct{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30]}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,t%1)}}a(Ct,"title","Frac"),a(Ct,"desc","Returns fractional part"),i.registerNodeType("math/frac",Ct);class Ft{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.properties={A:0,B:1}}onExecute(){var t=this.getInputData(0);if(t!==void 0){var e=this.properties.A,s=this.properties.B;t=i.clamp((t-e)/(s-e),0,1),t=t*t*(3-2*t),this.setOutputData(0,t)}}}a(Ft,"title","Smoothstep"),a(Ft,"desc","Smoothstep"),i.registerNodeType("math/smoothstep",Ft);class Bt{constructor(){this.addInput("in","number",{label:""}),this.addOutput("out","number",{label:""}),this.size=[80,30],this.addProperty("factor",1)}onExecute(){var t=this.getInputData(0);t!=null&&this.setOutputData(0,t*this.properties.factor)}}a(Bt,"title","Scale"),a(Bt,"desc","v * factor"),i.registerNodeType("math/scale",Bt);class Vt{constructor(){this.addInput("v","boolean"),this.addInput("A"),this.addInput("B"),this.addOutput("out")}onExecute(){var t=this.getInputData(0);this.setOutputData(0,this.getInputData(t?1:2))}}a(Vt,"title","Gate"),a(Vt,"desc","if v is true, then outputs A, otherwise B"),i.registerNodeType("math/gate",Vt);class Gt{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.size=[80,30],this.addProperty("samples",10),this._values=new Float32Array(10),this._current=0}onExecute(){var t=this.getInputData(0);t==null&&(t=0);var e=this._values.length;this._values[this._current%e]=t,this._current+=1,this._current>e&&(this._current=0);for(var s=0,r=0;r<e;++r)s+=this._values[r];this.setOutputData(0,s/e)}onPropertyChanged(t,e){e<1&&(e=1),this.properties.samples=Math.round(e);var s=this._values;this._values=new Float32Array(this.properties.samples),s.length<=this._values.length?this._values.set(s):this._values.set(s.subarray(0,this._values.length))}onPropertyChanged(t,e){t=="formula"&&(this.code_widget.value=e)}}a(Gt,"title","Average"),a(Gt,"desc","Average Filter"),i.registerNodeType("math/average",Gt);class Mt{constructor(){this.addInput("in","number"),this.addOutput("out","number"),this.addProperty("factor",.1),this.size=[80,30],this._value=null}onExecute(){var t=this.getInputData(0);t==null&&(t=0);var e=this.properties.factor;this._value==null?this._value=t:this._value=this._value*(1-e)+t*e,this.setOutputData(0,this._value)}}a(Mt,"title","TendTo"),a(Mt,"desc","moves the output value always closer to the input"),i.registerNodeType("math/tendTo",Mt);const v=class A{constructor(){this.addInput("A","number,array,object"),this.addInput("B","number"),this.addOutput("=","number"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP","+","enum",{values:A.values}),this._func=A.funcs[this.properties.OP],this._result=[]}getTitle(){return this.properties.OP=="max"||this.properties.OP=="min"?this.properties.OP+"(A,B)":"A "+this.properties.OP+" B"}setValue(t){typeof t=="string"&&(t=parseFloat(t)),this.properties.value=t}onPropertyChanged(t,e){var s;t=="OP"&&(this._func=A.funcs[this.properties.OP],this._func||((s=console.warn)==null||s.call(console,"Unknown operation: "+this.properties.OP),this._func=function(r){return r}))}onExecute(){var t=this.getInputData(0),e=this.getInputData(1);t!=null?t.constructor===Number&&(this.properties.A=t):t=this.properties.A,e!=null?this.properties.B=e:e=this.properties.B;var s=A.funcs[this.properties.OP],r;if(t.constructor===Number)r=0,r=s(t,e);else if(t.constructor===Array){r=this._result,r.length=t.length;for(let o=0;o<t.length;++o)r[o]=s(t[o],e)}else{r={};for(let o in t)r[o]=s(t[o],e)}this.setOutputData(0,r)}onDrawBackground(t){this.flags.collapsed||(t.font="40px Arial",t.fillStyle="#666",t.textAlign="center",t.fillText(this.properties.OP,this.size[0]*.5,(this.size[1]+i.NODE_TITLE_HEIGHT)*.5),t.textAlign="left")}};a(v,"title","Operation"),a(v,"desc","Easy math operators"),a(v,"values",["+","-","*","/","%","^","max","min"]),a(v,"funcs",{"+":function(n,t){return n+t},"-":function(n,t){return n-t},x:function(n,t){return n*t},X:function(n,t){return n*t},"*":function(n,t){return n*t},"/":function(n,t){return n/t},"%":function(n,t){return n%t},"^":function(n,t){return Math.pow(n,t)},max:function(n,t){return Math.max(n,t)},min:function(n,t){return Math.min(n,t)}}),a(v,"@OP",{type:"enum",title:"operation",values:v.values}),a(v,"size",[100,60]);let De=v;i.registerNodeType("math/operation",De),i.registerSearchboxExtra("math/operation","MAX",{properties:{OP:"max"},title:"MAX()"}),i.registerSearchboxExtra("math/operation","MIN",{properties:{OP:"min"},title:"MIN()"});class Rt{constructor(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("A==B","boolean"),this.addOutput("A!=B","boolean"),this.addProperty("A",0),this.addProperty("B",0)}onExecute(){var t=this.getInputData(0),e=this.getInputData(1);t!==void 0?this.properties.A=t:t=this.properties.A,e!==void 0?this.properties.B=e:e=this.properties.B;for(var s=0,r=this.outputs.length;s<r;++s){var o=this.outputs[s];if(!(!o.links||!o.links.length)){var u;switch(o.name){case"A==B":u=t==e;break;case"A!=B":u=t!=e;break;case"A>B":u=t>e;break;case"A<B":u=t<e;break;case"A<=B":u=t<=e;break;case"A>=B":u=t>=e;break}this.setOutputData(s,u)}}}onGetOutputs(){return[["A==B","boolean"],["A!=B","boolean"],["A>B","boolean"],["A<B","boolean"],["A>=B","boolean"],["A<=B","boolean"]]}}a(Rt,"title","Compare"),a(Rt,"desc","compares between two values"),i.registerNodeType("math/compare",Rt),i.registerSearchboxExtra("math/compare","==",{outputs:[["A==B","boolean"]],title:"A==B"}),i.registerSearchboxExtra("math/compare","!=",{outputs:[["A!=B","boolean"]],title:"A!=B"}),i.registerSearchboxExtra("math/compare",">",{outputs:[["A>B","boolean"]],title:"A>B"}),i.registerSearchboxExtra("math/compare","<",{outputs:[["A<B","boolean"]],title:"A<B"}),i.registerSearchboxExtra("math/compare",">=",{outputs:[["A>=B","boolean"]],title:"A>=B"}),i.registerSearchboxExtra("math/compare","<=",{outputs:[["A<=B","boolean"]],title:"A<=B"});const x=class de{constructor(){this.addInput("A","number"),this.addInput("B","number"),this.addOutput("true","boolean"),this.addOutput("false","boolean"),this.addProperty("A",1),this.addProperty("B",1),this.addProperty("OP",">","enum",{values:de.values}),this.addWidget("combo","Cond.",this.properties.OP,{property:"OP",values:de.values}),this.size=[80,60]}getTitle(){return"A "+this.properties.OP+" B"}onExecute(){var t=this.getInputData(0);t===void 0?t=this.properties.A:this.properties.A=t;var e=this.getInputData(1);e===void 0?e=this.properties.B:this.properties.B=e;var s=!0;switch(this.properties.OP){case">":s=t>e;break;case"<":s=t<e;break;case"==":s=t==e;break;case"!=":s=t!=e;break;case"<=":s=t<=e;break;case">=":s=t>=e;break;case"||":s=t||e;break;case"&&":s=t&&e;break}this.setOutputData(0,s),this.setOutputData(1,!s)}};a(x,"title","Condition"),a(x,"desc","evaluates condition between A and B"),a(x,"values",[">","<","==","!=","<=",">=","||","&&"]),a(x,"@OP",{type:"enum",title:"operation",values:x.values});let we=x;i.registerNodeType("math/condition",we);class jt{constructor(){this.addInput("in",0),this.addInput("cond","boolean"),this.addOutput("true",0),this.addOutput("false",0),this.size=[80,60]}onExecute(){var t=this.getInputData(0),e=this.getInputData(1);e?(this.setOutputData(0,t),this.setOutputData(1,null)):(this.setOutputData(0,null),this.setOutputData(1,t))}}a(jt,"title","Branch"),a(jt,"desc","If condition is true, outputs IN in true, otherwise in false"),i.registerNodeType("math/branch",jt);class Lt{constructor(){this.addInput("inc","number"),this.addOutput("total","number"),this.addProperty("increment",1),this.addProperty("value",0)}onExecute(){this.properties.value===null&&(this.properties.value=0);var t=this.getInputData(0);t!==null?this.properties.value+=t:this.properties.value+=this.properties.increment,this.setOutputData(0,this.properties.value)}}a(Lt,"title","Accumulate"),a(Lt,"desc","Increments a value every time"),i.registerNodeType("math/accumulate",Lt);class Wt{constructor(){this.addInput("v","number"),this.addOutput("sin","number"),this.addProperty("amplitude",1),this.addProperty("offset",0),this.bgImageUrl="nodes/imgs/icon-sin.png"}onExecute(){var t=this.getInputData(0);t==null&&(t=0);var e=this.properties.amplitude,s=this.findInputSlot("amplitude");s!=-1&&(e=this.getInputData(s));var r=this.properties.offset;s=this.findInputSlot("offset"),s!=-1&&(r=this.getInputData(s));for(var o=0,u=this.outputs.length;o<u;++o){var h=this.outputs[o],p;switch(h.name){case"sin":p=Math.sin(t);break;case"cos":p=Math.cos(t);break;case"tan":p=Math.tan(t);break;case"asin":p=Math.asin(t);break;case"acos":p=Math.acos(t);break;case"atan":p=Math.atan(t);break}this.setOutputData(o,e*p+r)}}onGetInputs(){return[["v","number"],["amplitude","number"],["offset","number"]]}onGetOutputs(){return[["sin","number"],["cos","number"],["tan","number"],["asin","number"],["acos","number"],["atan","number"]]}}a(Wt,"title","Trigonometry"),a(Wt,"desc","Sin Cos Tan"),i.registerNodeType("math/trigonometry",Wt),i.registerSearchboxExtra("math/trigonometry","SIN()",{outputs:[["sin","number"]],title:"SIN()"}),i.registerSearchboxExtra("math/trigonometry","COS()",{outputs:[["cos","number"]],title:"COS()"}),i.registerSearchboxExtra("math/trigonometry","TAN()",{outputs:[["tan","number"]],title:"TAN()"});class W{constructor(){this.addInput("x","number"),this.addInput("y","number"),this.addOutput("","number"),this.properties={x:1,y:1,formula:"x+y"},this.code_widget=this.addWidget("text","F(x,y)",this.properties.formula,function(t,e,s){s.properties.formula=t}),this.addWidget("toggle","allow",i.allow_scripts,function(t){i.allow_scripts=t}),this._func=null}onExecute(){if(i.allow_scripts){var t=this.getInputData(0),e=this.getInputData(1);t!=null?this.properties.x=t:t=this.properties.x,e!=null?this.properties.y=e:e=this.properties.y;var s;try{(!this._func||this._func_code!=this.properties.formula)&&(this._func=new Function("x","y","TIME","return "+this.properties.formula),this._func_code=this.properties.formula),s=this._func(t,e,this.graph.globaltime),this.boxcolor=null}catch{this.boxcolor="red"}this.setOutputData(0,s)}}getTitle(){return this._func_code||"Formula"}onDrawBackground(){var t=this.properties.formula;this.outputs&&this.outputs.length&&(this.outputs[0].label=t)}}a(W,"title","Formula"),a(W,"desc","Compute formula"),a(W,"size",[160,100]),i.registerNodeType("math/formula",W);class Ht{constructor(){this.addInput("vec2","vec2"),this.addOutput("x","number"),this.addOutput("y","number")}onExecute(){var t=this.getInputData(0);t!=null&&(this.setOutputData(0,t[0]),this.setOutputData(1,t[1]))}}a(Ht,"title","Vec2->XY"),a(Ht,"desc","vector 2 to components"),i.registerNodeType("math3d/vec2-to-xy",Ht);class Ut{constructor(){this.addInputs([["x","number"],["y","number"]]),this.addOutput("vec2","vec2"),this.properties={x:0,y:0},this._data=new Float32Array(2)}onExecute(){var t=this.getInputData(0);t==null&&(t=this.properties.x);var e=this.getInputData(1);e==null&&(e=this.properties.y);var s=this._data;s[0]=t,s[1]=e,this.setOutputData(0,s)}}a(Ut,"title","XY->Vec2"),a(Ut,"desc","components to vector2"),i.registerNodeType("math3d/xy-to-vec2",Ut);class qt{constructor(){this.addInput("vec3","vec3"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number")}onExecute(){var t=this.getInputData(0);t!=null&&(this.setOutputData(0,t[0]),this.setOutputData(1,t[1]),this.setOutputData(2,t[2]))}}a(qt,"title","Vec3->XYZ"),a(qt,"desc","vector 3 to components"),i.registerNodeType("math3d/vec3-to-xyz",qt);class Yt{constructor(){this.addInputs([["x","number"],["y","number"],["z","number"]]),this.addOutput("vec3","vec3"),this.properties={x:0,y:0,z:0},this._data=new Float32Array(3)}onExecute(){var t=this.getInputData(0);t==null&&(t=this.properties.x);var e=this.getInputData(1);e==null&&(e=this.properties.y);var s=this.getInputData(2);s==null&&(s=this.properties.z);var r=this._data;r[0]=t,r[1]=e,r[2]=s,this.setOutputData(0,r)}}a(Yt,"title","XYZ->Vec3"),a(Yt,"desc","components to vector3"),i.registerNodeType("math3d/xyz-to-vec3",Yt);class Xt{constructor(){this.addInput("vec4","vec4"),this.addOutput("x","number"),this.addOutput("y","number"),this.addOutput("z","number"),this.addOutput("w","number")}onExecute(){var t=this.getInputData(0);t!=null&&(this.setOutputData(0,t[0]),this.setOutputData(1,t[1]),this.setOutputData(2,t[2]),this.setOutputData(3,t[3]))}}a(Xt,"title","Vec4->XYZW"),a(Xt,"desc","vector 4 to components"),i.registerNodeType("math3d/vec4-to-xyzw",Xt);class Jt{constructor(){this.addInputs([["x","number"],["y","number"],["z","number"],["w","number"]]),this.addOutput("vec4","vec4"),this.properties={x:0,y:0,z:0,w:0},this._data=new Float32Array(4)}onExecute(){var t=this.getInputData(0);t==null&&(t=this.properties.x);var e=this.getInputData(1);e==null&&(e=this.properties.y);var s=this.getInputData(2);s==null&&(s=this.properties.z);var r=this.getInputData(3);r==null&&(r=this.properties.w);var o=this._data;o[0]=t,o[1]=e,o[2]=s,o[3]=r,this.setOutputData(0,o)}}a(Jt,"title","XYZW->Vec4"),a(Jt,"desc","components to vector4"),i.registerNodeType("math3d/xyzw-to-vec4",Jt);function Ne(n){if(n&&n.constructor===Object)try{return JSON.stringify(n)}catch{return String(n)}return String(n)}i.wrapFunctionAsNode("string/toString",Ne,[""],"string");function Ae(n,t){return n==t}i.wrapFunctionAsNode("string/compare",Ae,["string","string"],"boolean");function Se(n,t){return n===void 0?t:t===void 0?n:n+""+t}i.wrapFunctionAsNode("string/concatenate",Se,["string","string"],"string");function ke(n,t){return n===void 0||t===void 0?!1:n.indexOf(t)!=-1}i.wrapFunctionAsNode("string/contains",ke,["string","string"],"boolean");function ze(n){return n!=null&&n.constructor===String?n.toUpperCase():n}i.wrapFunctionAsNode("string/toUpperCase",ze,["string"],"string");function Pe(n,t){if(t==null&&(t=this.properties.separator),n==null)return[];if(n.constructor===String)return n.split(t||" ");if(n.constructor===Array){for(var e=[],s=0;s<n.length;++s)typeof n[s]=="string"&&(e[s]=n[s].split(t||" "));return e}return null}i.wrapFunctionAsNode("string/split",Pe,["string,array","string"],"array",{separator:","});function Ce(n){return n!=null&&n.constructor===Number?n.toFixed(this.properties.precision):n}i.wrapFunctionAsNode("string/toFixed",Ce,["number"],"string",{precision:0});class $t{constructor(){this.addInput("","string"),this.addOutput("table","table"),this.addOutput("rows","number"),this.addProperty("value",""),this.addProperty("separator",","),this._table=null}onExecute(){var t=this.getInputData(0);if(t){var e=this.properties.separator||",";(t!=this._str||e!=this._last_separator)&&(this._last_separator=e,this._str=t,this._table=t.split(`
`).map(function(s){return s.trim().split(e)})),this.setOutputData(0,this._table),this.setOutputData(1,this._table?this._table.length:0)}}}a($t,"title","toTable"),a($t,"desc","Splits a string to table"),i.registerNodeType("string/toTable",$t);class Kt{constructor(){this.addInput("sel","number"),this.addInput("A"),this.addInput("B"),this.addInput("C"),this.addInput("D"),this.addOutput("out"),this.selected=0}onDrawBackground(t){if(!this.flags.collapsed){t.fillStyle="#AFB";var e=(this.selected+1)*i.NODE_SLOT_HEIGHT+6;t.beginPath(),t.moveTo(50,e),t.lineTo(50,e+i.NODE_SLOT_HEIGHT),t.lineTo(34,e+i.NODE_SLOT_HEIGHT*.5),t.fill()}}onExecute(){var t=this.getInputData(0);(t==null||t.constructor!==Number)&&(t=0),this.selected=t=Math.round(t)%(this.inputs.length-1);var e=this.getInputData(t+1);e!==void 0&&this.setOutputData(0,e)}onGetInputs(){return[["E",0],["F",0],["G",0],["H",0]]}}a(Kt,"title","Selector"),a(Kt,"desc","selects an output"),i.registerNodeType("logic/selector",Kt);class Zt{constructor(){this.properties={sequence:"A,B,C"},this.addInput("index","number"),this.addInput("seq"),this.addOutput("out"),this.index=0,this.values=this.properties.sequence.split(",")}onPropertyChanged(t,e){t=="sequence"&&(this.values=e.split(","))}onExecute(){var t=this.getInputData(1);t&&t!=this.current_sequence&&(this.values=t.split(","),this.current_sequence=t);var e=this.getInputData(0);e==null&&(e=0),this.index=e=Math.round(e)%this.values.length,this.setOutputData(0,this.values[e])}}a(Zt,"title","Sequence"),a(Zt,"desc","select one element from a sequence from a string"),i.registerNodeType("logic/sequence",Zt);class Qt{constructor(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}onExecute(){let t=!0;for(let e in this.inputs)if(!this.getInputData(e)){t=!1;break}this.setOutputData(0,t)}onGetInputs(){return[["and","boolean"]]}}a(Qt,"title","AND"),a(Qt,"desc","Return true if all inputs are true"),i.registerNodeType("logic/AND",Qt);class te{constructor(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}onExecute(){var t=!1;for(var e in this.inputs)if(this.getInputData(e)){t=!0;break}this.setOutputData(0,t)}onGetInputs(){return[["or","boolean"]]}}a(te,"title","OR"),a(te,"desc","Return true if at least one input is true"),i.registerNodeType("logic/OR",te);class ee{constructor(){this.properties={},this.addInput("in","boolean"),this.addOutput("out","boolean")}onExecute(){var t=!this.getInputData(0);this.setOutputData(0,t)}}a(ee,"title","NOT"),a(ee,"desc","Return the logical negation"),i.registerNodeType("logic/NOT",ee);class se{constructor(){this.properties={},this.addInput("a","boolean"),this.addInput("b","boolean"),this.addOutput("out","boolean")}onExecute(){var t=null,e=!0;for(var s in this.inputs)if(t===null)t=this.getInputData(s);else if(t!=this.getInputData(s)){e=!1;break}this.setOutputData(0,e)}onGetInputs(){return[["bool","boolean"]]}}a(se,"title","bool == bool"),a(se,"desc","Compare for logical equality"),i.registerNodeType("logic/CompareBool",se);class ie{constructor(){this.properties={},this.addInput("onTrigger",i.ACTION),this.addInput("condition","boolean"),this.addOutput("true",i.EVENT),this.addOutput("false",i.EVENT),this.mode=i.ON_TRIGGER}onExecute(t,e){this.getInputData(1)?this.triggerSlot(0):this.triggerSlot(1)}}a(ie,"title","Branch"),a(ie,"desc","Branch execution on condition"),i.registerNodeType("logic/IF",ie);class re{constructor(){this.properties={},this.addInput("start","number"),this.addInput("nElements","number"),this.addInput("do",i.ACTION),this.addInput("break",i.ACTION),this.addOutput("do",i.EVENT),this.addOutput("index","number"),this.started=!1,this.stopped=!1}onExecute(t){var e,s;if(this.started){for(var r=this.getInputData(0),o=this.getInputData(1),u=r;u<r+o;u++){if((e=console.debug)==null||e.call(console,"for cycle "+u),this.triggerSlot(0,t),this.stopped){(s=console.debug)==null||s.call(console,"for cycle stopped on index "+u);break}this.setOutputData(1,u)}this.started=!1,this.stopped=!0}}onAction(t){switch(t){case"break":this.stopped=!0;break;case"do":this.started=!0,this.stopped=!1,this.execute();break}}}a(re,"title","FOR"),a(re,"desc","Cycle FOR"),i.registerNodeType("logic/CycleFOR",re);class ae{constructor(){this.properties={cycleLimit:999,checkOnStart:!0},this.addInput("do",i.ACTION),this.addInput("condition","boolean"),this.addInput("break",i.ACTION),this.addOutput("do",i.EVENT),this.addOutput("index","number"),this.started=!1,this.stopped=!1,this.k=0,this.cond=!1,this.addWidget("toggle","checkOnStart",this.properties.checkOnStart,"checkOnStart")}onExecute(){this.setOutputData(1,this.k),this.cond=this.getInputData(1)}onAction(t,e){var s,r;switch(t){case"break":this.stopped=!0;break;case"do":this.started=!0,this.stopped=!1;var o=this.getInputOrProperty("checkOnStart");for(this.cond=!o||this.getInputData(1),this.k=0,cycleLimit=this.properties.cycleLimit||999;this.cond&&this.k<cycleLimit;){if((s=console.debug)==null||s.call(console,"while cycle "+this.k),this.setOutputData(1,this.k),this.triggerSlot(0,e),this.stopped){(r=console.debug)==null||r.call(console,"while cycle stopped on index "+k);break}this.k++,this.cond=this.getInputData(1,!0,!0)}this.k=0,this.setOutputData(1,this.k),this.cond=this.getInputData(1),this.started=!1,this.stopped=!0;break}}}a(ae,"title","WHILE"),a(ae,"desc","Cycle WHILE"),i.registerNodeType("logic/CycleWHILE",ae);class oe{constructor(){this.size=[60,20],this.addInput("send",i.ACTION),this.addOutput("received",i.EVENT),this.addInput("in",0),this.addOutput("out",0),this.properties={url:"",room:"lgraph",only_send_changes:!0},this._ws=null,this._last_sent_data=[],this._last_received_data=[]}onPropertyChanged(t,e){t=="url"&&this.connectSocket()}onExecute(){if(!this._ws&&this.properties.url&&this.connectSocket(),!(!this._ws||this._ws.readyState!=WebSocket.OPEN)){var t=this.properties.room,e=this.properties.only_send_changes;for(let o=1;o<this.inputs.length;++o){var s=this.getInputData(o);if(s!=null){var r;try{r=JSON.stringify({type:0,room:t,channel:o,data:s})}catch{continue}e&&this._last_sent_data[o]==r||(this._last_sent_data[o]=r,this._ws.send(r))}}for(let o=1;o<this.outputs.length;++o)this.setOutputData(o,this._last_received_data[o]);this.boxcolor=="#AFA"&&(this.boxcolor="#6C6")}}connectSocket(){var t=this,e=this.properties.url;e.substr(0,2)!="ws"&&(e="ws://"+e),this._ws=new WebSocket(e),this._ws.onopen=function(){var s;(s=console.log)==null||s.call(console,"ready"),t.boxcolor="#6C6"},this._ws.onmessage=function(s){t.boxcolor="#AFA";var r=JSON.parse(s.data);if(!(r.room&&r.room!=t.properties.room))if(r.type==1)if(r.data.object_class&&i[r.data.object_class]){var o=null;try{o=new i[r.data.object_class](r.data),t.triggerSlot(0,o)}catch{return}}else t.triggerSlot(0,r.data);else t._last_received_data[r.channel||0]=r.data},this._ws.onerror=function(s){var r;(r=console.log)==null||r.call(console,"couldnt connect to websocket"),t.boxcolor="#E88"},this._ws.onclose=function(s){var r;(r=console.log)==null||r.call(console,"connection closed"),t.boxcolor="#000"}}send(t){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send(JSON.stringify({type:1,msg:t}))}onAction(t,e){!this._ws||this._ws.readyState!=WebSocket.OPEN||this._ws.send({type:1,room:this.properties.room,action:t,data:e})}onGetInputs(){return[["in",0]]}onGetOutputs(){return[["out",0]]}}a(oe,"title","WebSocket"),a(oe,"desc","Send data through a websocket"),i.registerNodeType("network/websocket",oe);class ne{constructor(){this.addInput("request",i.ACTION),this.addInput("url","string"),this.addProperty("url",""),this.addOutput("ready",i.EVENT),this.addOutput("data","string"),this.addWidget("button","Fetch",null,this.fetch.bind(this)),this._data=null,this._fetching=null}fetch(){var t=this.getInputOrProperty("url");if(t){this.boxcolor="#FF0";var e=this;this._fetching=fetch(t).then(s=>{if(!s.ok)this.boxcolor="#F00",e.trigger("error");else return this.boxcolor="#0F0",s.text()}).then(s=>{e._data=s,e._fetching=null,e.trigger("ready")})}}onAction(t){t=="request"&&this.fetch()}onExecute(){this.setOutputData(1,this._data)}onGetOutputs(){return[["error",i.EVENT]]}}a(ne,"title","HTTP Request"),a(ne,"desc","Fetch data through HTTP"),i.registerNodeType("network/httprequest",ne);
